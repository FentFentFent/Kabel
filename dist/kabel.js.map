{"version":3,"file":"kabel.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAe,MAAID,IAEnBD,EAAY,MAAIC,GACjB,CATD,CASGK,KAAM,I,MCLT,SAASC,EAAoBC,GAE5B,IAAIC,EAAeC,EAAyBF,GAC5C,QAAqBG,IAAjBF,EACH,OAAOA,EAAaP,QAGrB,IAAIC,EAASO,EAAyBF,GAAY,CAGjDN,QAAS,CAAC,GAOX,OAHAU,EAAoBJ,GAAUK,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASK,GAGpEJ,EAAOD,OACf,C,+ECrBA,mBAAgCY,EAAaC,GACzC,OAAOC,OAAOC,UAAUC,eAAeL,KAAKC,EAAKC,EACrD,C,oOCHA,mBAWyB,EAAAI,UAXlB,UACP,mBASI,EAAAC,SATG,UACP,mBAUI,EAAAC,YAVG,UACP,gBAUI,8EAVK,EAAAC,eAAe,G,6FCDxB,MAAMC,EACMC,MACAC,UAKR,WAAAC,GACIpB,KAAKkB,MAAQ,IAAIG,IACjBrB,KAAKmB,UAAY,IAAIG,GACzB,CAMA,QAAAC,CAASd,GACcT,KAAKkB,MAAMM,IAAIf,KAE9BT,KAAKkB,MAAMO,IAAIhB,GACfT,KAAK0B,iBAAiBjB,EAAM,GAEpC,CAMA,WAAAkB,CAAYlB,GACWT,KAAKkB,MAAMM,IAAIf,KAE9BT,KAAKkB,MAAMU,OAAOnB,GAClBT,KAAK0B,iBAAiBjB,EAAM,GAEpC,CAMA,QAAAoB,CAASpB,GACL,OAAOT,KAAKkB,MAAMM,IAAIf,EAC1B,CAOA,aAAAqB,CAAcrB,EAAcsB,GACnB/B,KAAKmB,UAAUK,IAAIf,IAAOT,KAAKmB,UAAUa,IAAIvB,EAAM,IACxDT,KAAKmB,UAAUc,IAAIxB,GAAOyB,KAAKH,EACnC,CAGQ,gBAAAL,CAAiBjB,EAAc0B,GACnC,MAAMC,EAAMpC,KAAKmB,UAAUc,IAAIxB,GAC/B,GAAK2B,EACL,IAAK,MAAML,KAAMK,EAAKL,EAAGI,EAC7B,EAKA,EAAAlB,UAAAA,EAHJ,MAAMoB,EAAY,IAAIpB,EACtB,UAAeoB,C,uKChEf,mBAGA,UAiKA,UA1JA,MACCC,UACAC,QACAC,QAEA,WAAApB,CAAYoB,GACXxC,KAAKwC,QAAUA,EAEfxC,KAAKsC,UAAYG,SAASC,cAAc,OACxC1C,KAAKsC,UAAUK,UAAY,cAE3B3C,KAAKuC,QAAU,EAEXC,EACHA,EAAQI,UAAUC,OAAOC,YAAY9C,KAAKsC,WAE1CG,SAASM,KAAKD,YAAY9C,KAAKsC,UAEjC,CAKA,IAAAU,CAAKC,GACJjD,KAAKkD,QACLD,EAAME,QAAQC,IACb,MAAMC,GAAe,aAAgBD,EAAKE,MAC1C,IAAKD,EAAc,OAEnB,MAAME,EAASvD,KAAKwD,kBAAkBH,GACtCrD,KAAKsC,UAAUQ,YAAYS,KAG5BvD,KAAKyD,MACN,CAKQ,iBAAAD,CAAkBH,GACzB,MAAME,EAASd,SAASC,cAAc,OAOtC,OANAa,EAAOZ,UAAY,kBACnBY,EAAOG,YAAcL,EAAaM,UAElC3D,KAAK4D,gBAAgBL,EAAQF,EAAaQ,OAAOC,SAEjDP,EAAOQ,iBAAiB,YAAaC,GAAKhE,KAAKiE,gBAAgBD,EAAGX,IAC3DE,CACR,CAKQ,eAAAK,CAAgBM,EAAiBC,GAKxC,GAJAD,EAAGE,MAAMC,iBAAkB,IAAAC,YAAWH,GACtCD,EAAGE,MAAMG,QAAU,UACnBL,EAAGE,MAAMI,OAAS,UAEdxE,KAAKwC,SAASI,WAAW6B,UAAUC,UAAW,CACjD,MAAMC,EAAI3E,KAAKwC,QAAQI,UAAU6B,SAASC,UAC1CR,EAAGE,MAAMQ,WAAaD,EAAEE,YACxBX,EAAGE,MAAMU,SAAW,GAAGH,EAAEI,cACzBb,EAAGE,MAAMY,OAAQ,IAAAV,YAAWK,EAAEM,WAC/B,CACD,CAKQ,eAAAhB,CAAgBD,EAAeX,GACtC,IAAKrD,KAAKwC,QAAS,OAEnB,MAAM0C,EAAUlF,KAAKmF,gBAAgB9B,GACrCZ,SAASM,KAAKD,YAAYoC,GAE1B,MAAME,EAAaC,IAClBH,EAAQd,MAAMkB,KAAOD,EAAGE,QAAU,EAAI,KACtCL,EAAQd,MAAMoB,IAAMH,EAAGI,QAAU,EAAI,MAGhCC,EAAgBL,IACrB5C,SAASkD,oBAAoB,YAAaP,GAC1C3C,SAASkD,oBAAoB,UAAWD,GAExC1F,KAAK4F,SAASP,EAAIhC,GAElB6B,EAAQW,UAGTpD,SAASsB,iBAAiB,YAAaqB,GACvC3C,SAASsB,iBAAiB,UAAW2B,GAErC1B,EAAE8B,gBACH,CAKQ,eAAAX,CAAgB9B,GACvB,MAAM6B,EAAUzC,SAASC,cAAc,OAOvC,OANAwC,EAAQvC,UAAY,iBACpBuC,EAAQxB,YAAcL,EAAaM,UACnCuB,EAAQd,MAAM2B,SAAW,WACzBb,EAAQd,MAAM4B,cAAgB,OAE9BhG,KAAK4D,gBAAgBsB,EAAS7B,EAAaQ,OAAOC,SAC3CoB,CACR,CAKQ,QAAAU,CAASP,EAAgBjC,GAChC,IAAKpD,KAAKwC,QAAS,OAEnB,MACMyD,EADMjG,KAAKwC,QAAQI,UAAUsD,IAAI9C,KACtB+C,wBAEjB,GACCd,EAAGE,SAAWU,EAAKX,MACnBD,EAAGE,SAAWU,EAAKG,OACnBf,EAAGI,SAAWQ,EAAKT,KACnBH,EAAGI,SAAWQ,EAAKI,OAClB,CACD,MAAQC,EAAGC,EAAKC,EAAGC,GAAQzG,KAAKwC,QAAQI,UAAU8D,kBACjDrB,EAAGE,QAAUU,EAAKX,KAClBD,EAAGI,QAAUQ,EAAKT,KAGbmB,EAAS3G,KAAKwC,QAAQI,UAAUgE,QAAQxD,EAAKE,KAAgBiD,EAAKE,GACxE,GAAIE,EAAQ,CACX,IAAK,IAAIE,KAAWzD,EAAK0D,UACxBH,EAAOI,cAAcF,EAASzD,EAAK0D,UAAUD,IAE9C7G,KAAKwC,QAAQI,UAAUoE,SAASL,EAAOM,GACxC,CACD,CACD,CAEA,IAAAxD,GACCzD,KAAKsC,UAAU8B,MAAM8C,QAAU,QAC/BlH,KAAKuC,QAAU,CAChB,CAEA,IAAA4E,GACCnH,KAAKsC,UAAU8B,MAAM8C,QAAU,OAC/BlH,KAAKuC,QAAU,CAChB,CAEA,KAAAW,GACClD,KAAKsC,UAAU8E,UAAY,EAC5B,E,67BCjKD,mBACA,aACA,aACA,aACA,aACA,aAWA,aACA,UAKA,aACA,aACA,aAUA,UACA,aACA,aACA,aACA,YACA,WACA,aACA,WACA,QACA,mBACA,aACA,UACA,aACA,aACA,aACA,UAEA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,UACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,WACA,YACA,aAEA,EAAAC,YAAqB,QAAIC,EAAMxG,SAC/B,EAAAuG,YAAYC,EAAMxG,SAASyG,MAAQD,EAAMxG,SACzC,EAAAuG,YAAYG,EAAO1G,SAASyG,MAAQC,EAAO1G,SAEvC,UAAI2G,WAEJC,EAAYC,eAAe,WAO/B,UAAMC,SAAW,SAAUnH,EAAcoH,GACrC,EAAAC,SAASrH,GAAQoH,CACrB,EAMA,UAAME,WAAa,SAAUtH,UAClB,EAAAqH,SAASrH,EACpB,EAKA,MAAMuH,EAAQ,CACVC,IAAA,UACAC,IAAK,CAEDC,OAAQ,UAERT,cAEArF,UAAA,UAEA+F,gBAAiB,CACbC,kBAAA,EAAAA,kBACAC,qBAAA,EAAAA,qBACAC,qBAAA,EAAAA,qBACAH,gBAAA,YAGRI,OAAQ,CACJC,QAAS,UACTC,KAAM,WAGVC,YAAA,EAAAA,YAMAC,MAAO,CACHC,OACAC,WAAA,UACAC,MACAzE,WAAA,EAAAA,WACA0E,MACAC,aAAA,UACAC,QAAA,UACAC,OAAA,UACAC,OAAA,EAAAA,OACAC,WAAY,UACZC,aAAc,WAElBC,OAAA,UACAC,eAAA,UACAC,WAAA,UACAC,YAAA,UACAC,MAAA,UACAC,WAAA,EAAAA,WACA9B,SAAA,EAAAA,SACA+B,YAAA,EAAAA,YACAC,gBAAA,EAAAA,gBACAC,UAAA,EAAAA,UACAC,OAAA,UACAC,eAAA,UACAC,mBAAA,UACAC,UAAA,EAAAA,UACAC,mBAAA,EAAAA,mBACAC,iBAAA,EAAAA,iBACAC,iBAAA,EAAAA,iBACAC,QAAA,UACAC,MAAO,UACPC,QAAS,UACTC,aAAA,UACAC,UAAA,UACAC,oBAAA,UACAC,eAAA,UACAC,cAAe,CACX/B,IAAKA,EACLgC,YAAa,EAAAC,KACbC,OAAQzD,EACR0D,MAAO5D,EACPxG,SAAU,UACVqK,kBAAmB,UACnBpK,YAAa,UACbC,gBAAiB,EAAAA,iBAErBsG,QACAE,SACA4D,iBAAkB,CAAEC,aAAA,UAAcC,gBAAA,WAClCC,SAAU,WAOd7K,OAAO8K,eAAexD,EAAO,iBAAkB,CAC3C/F,IAAG,KACQ,IAAAoI,oBAEXrI,IAAIyJ,GAEIA,SAEM,GAANA,GACM,IAANA,GACa,iBAANA,GAEA,IAAArB,uBAEJ,IAAAE,kBAAiBmB,KAIhC,UAAezD,C,2EC/Kf,UAtB8B,CAC7B0D,SAAU,CACHC,iBAAkB,UACxBC,oBAAqB,CACpB7F,SAAU,WACVT,KAAM,IACNE,IAAK,IACLqG,MAAO,MACPC,OAAQ,OACRC,WAAY,wBACZC,UAAW,QAEZC,gBAAiB,CAChBF,WAAY,wBACZC,UAAW,OACXzH,QAAS,MACT2H,aAAc,MACdC,UAAW,+B,mCCTd,SAASC,EAAiBC,EAAqBC,GAgB3C,SAASC,IAGL,MAAO,CAAEC,MAFKC,KAAKC,IAAIC,EAAWC,GAElBC,IADJJ,KAAKK,IAAIH,EAAWC,GAEpC,CAEA,SAASG,IACL,OAAOJ,IAAcC,CACzB,CAEA,SAASI,IACL,IAAKD,IAAgB,OAAO,EAC5B,MAAM,MAAEP,EAAK,IAAEK,GAAQN,IAIvB,OAHAU,EAASA,EAAOC,MAAM,EAAGV,GAASS,EAAOC,MAAML,GAC/CF,EAAYH,EACZI,EAAYJ,EACL,CACX,CAgBA,SAASW,EAAiBC,EAActI,EAAmBF,GAEvD,MAAMyI,EAAW5I,EAAS6I,SAASF,KAAKA,GAAMG,KAAK,CAAEC,KAAM1I,GAAY,GAAI2I,OAAQ7I,GAAc,UAC3F8I,EAAOjJ,EAASkJ,gBAAgBN,GAEtC,OADAA,EAASxH,SACF6H,EAAK7B,KAChB,CAEA,SAAS+B,IACL,MAAM,MAAEpB,EAAK,IAAEK,GAAQN,IACjBsB,EAASd,IAxBnB,IAI8B3J,EAuB1B0K,EAAI5K,QAAQ6K,MAAmBd,EA1BtBe,QAAQ,KAAM,KAAUA,QAAQ,MAAO,UA2BhDF,EAAIG,KAAK,CAAE,YAAa,aACxB,IAzB0B7K,EAyBC0K,EAAI1K,KAxB/B8K,MAAMC,KAAK/K,EAAKgL,YAAYjL,QAASkL,IACV,IAAnBA,EAAMC,UAAiBD,EAAkBE,aAAa,YAAa,aAuB1B,CAAE,MAAQ,CAI3D,GAHAT,EAAIU,QAAQ,KAGRX,EAAQ,CACR,MAAM/I,EAAW2J,WAAWX,EAAIG,KAAK,eAA2B,GAC1DrJ,EAAakJ,EAAIG,KAAK,gBAA4B,QAElDS,EAAkBzB,EAAOC,MAAM,EAAGV,GAClCmC,EAAgB1B,EAAOC,MAAM,EAAGL,GAEhCa,EAAOI,EAAIJ,OACXkB,EAAalB,EAAKpH,EAAI6G,EAAiBuB,EAAiB5J,EAAUF,GAClEiK,EAAiBpC,KAAKK,IACxBK,EAAiBwB,EAAe7J,EAAUF,GAAcuI,EAAiBuB,EAAiB5J,EAAUF,GACpG,GAEEkK,EAAapB,EAAKlH,EAClBuI,EAAarB,EAAK5B,OAEnBkD,EAODA,EAAcxB,KAAKqB,EAAgBE,IALnCC,EAAgB/I,EAAMgJ,SAAUhJ,OAAO4I,EAAgBE,GAClD/L,KAAK,WACLiL,KAAK,CAAE,eAAgB,MAC5Be,EAAe5L,KAAK8L,WAAYC,aAAaH,EAAe5L,KAAM0K,EAAI1K,OAK1E4L,EAAeI,KAAKR,EAAYE,EACpC,MACQE,IAAiBA,EAAcnJ,SAAUmJ,EAAgB,MAIjE,GAAIK,EAAS,CACT,MAAMvK,EAAW2J,WAAWX,EAAIG,KAAK,eAA2B,GAC1DrJ,EAAakJ,EAAIG,KAAK,gBAA4B,QAElDqB,EAAenC,EADGF,EAAOC,MAAM,EAAGP,GACe7H,EAAUF,GAE3D8I,EAAOI,EAAIJ,OACX6B,EAAS7B,EAAKlH,EACdgJ,EAAS9B,EAAK5B,OAGf2D,IAAWA,EAAYxJ,EAAKgJ,SAAShJ,KAAK,EAAGuJ,GAAQxM,KAAK,SAE/DyM,EAAWjC,KAAK,EAAGgC,GAAQJ,KAAK1B,EAAKpH,EAAIgJ,EAAcC,EAC3D,MACQE,IAAaA,EAAU5J,SAAU4J,EAAY,MAIrD,MAAM/B,EAAOI,EAAIJ,OAGXgC,EAAQjD,KAAKK,IAAI,GAAIL,KAAKkD,KAAKjC,EAAK7B,OADtB+D,GA5GN,GA8GRC,EAAQpD,KAAKK,IAAI,GAAIL,KAAKkD,KAAKjC,EAAK5B,QAAUgE,GACpD7J,EAAKuH,KAAKkC,EAAOG,GAEjBE,EAAQC,eAAiB,CACrBnE,MAAO6D,EACP5D,OAAQ+D,EACRI,MARgBL,GAShBM,MApHU,EAsHlB,CAGA,SAASC,EAAa9K,GAClB,IAAIgK,EAAJ,CAQA,GAPAA,EAAU,EACVpC,EAAS8C,EAAQK,WAAa,GAC9BzD,EAAYM,EAAOoD,OACnBzD,EAAYK,EAAOoD,OAEnB,UAAU9O,SAAS,UAEf8D,EAAI,CACJ,MAAMiL,EAAUxC,EAAI1K,KAAK+C,wBAEnBoK,EAAO9L,EAAS+L,QAAQC,UACxBC,GAAUrL,EAAGE,QAAU+K,EAAQhL,KAvI3B,GAuI+CiL,EAEzD,IAAII,EAAkB,EACtBhE,EAAY,EACZ,IAAK,IAAIiE,EAAI,EAAGA,EAAI3D,EAAOoD,OAAQO,IAAK,CACpC,MAAMC,EAAY1D,EAAiBF,EAAO2D,IAC1C,GAAID,EAAkBE,EAAY,GAAKH,EAAQ,MAC/CC,GAAmBE,EACnBlE,EAAYiE,EAAI,CACpB,CACJ,CAEAhE,EAAYD,EACZiB,IACAkD,EAAgB,EAEhBrO,SAASsB,iBAAiB,UAAWgN,GACrCtO,SAASsB,iBAAiB,YAAaiN,EA7BpB,CA8BvB,CAEA,SAASC,EAAYC,EAAS,GACrB7B,IACLA,EAAU,EACV,UAAU1N,YAAY,UACtBc,SAASkD,oBAAoB,UAAWoL,EAAW,CAAEI,QAAS,IAC9D1O,SAASkD,oBAAoB,YAAaqL,GAEtCE,GAAQnB,EAAQqB,gBAAgBnE,GACpCW,IACAmC,EAAQsB,gBAAgBC,WAC5B,CAGA,SAASP,EAAU/M,GACf,GAAKqL,EAAL,CAEA,GAAc,WAAVrL,EAAEuN,IAA4D,OAAxCvN,EAAE8B,sBAAkBmL,EAAY,GAE5C,UAAVjN,EAAEuN,KACFvN,EAAE8B,iBACFmL,EAAY,IACK,cAAVjN,EAAEuN,KACTvN,EAAE8B,iBACEiH,IACAC,IACOL,EAAY,IACnBM,EAASA,EAAOC,MAAM,EAAGP,EAAY,GAAKM,EAAOC,MAAMP,GACvDA,IACAC,EAAYD,IAEC,WAAV3I,EAAEuN,KACTvN,EAAE8B,iBACEiH,IACAC,IACOL,EAAYM,EAAOoD,SAC1BpD,EAASA,EAAOC,MAAM,EAAGP,GAAaM,EAAOC,MAAMP,EAAY,KAGpD,cAAV3I,EAAEuN,KACPvN,EAAE8B,iBACE9B,EAAEwN,SAEF7E,EAAYF,KAAKK,IAAI,EAAGH,EAAY,IAGpCA,EAAYF,KAAKK,IAAI,EAAGH,EAAY,GACpCC,EAAYD,IAEC,eAAV3I,EAAEuN,KACTvN,EAAE8B,iBACE9B,EAAEwN,SAEF7E,EAAYF,KAAKC,IAAIO,EAAOoD,OAAQ1D,EAAY,IAGhDA,EAAYF,KAAKC,IAAIO,EAAOoD,OAAQ1D,EAAY,GAChDC,EAAYD,IAEC,SAAV3I,EAAEuN,KACTvN,EAAE8B,iBACE9B,EAAEwN,SACF7E,EAAY,GAEZA,EAAY,EACZC,EAAYD,IAEC,QAAV3I,EAAEuN,KACTvN,EAAE8B,iBACE9B,EAAEwN,SACF7E,EAAYM,EAAOoD,QAEnB1D,EAAYM,EAAOoD,OACnBzD,EAAYD,IAEQ,IAAjB3I,EAAEuN,IAAIlB,QAAiBrM,EAAEyN,SAAYzN,EAAE0N,UAC9C1N,EAAE8B,iBACEiH,KAAgBC,IACpBC,EAASA,EAAOC,MAAM,EAAGP,GAAa3I,EAAEuN,IAAMtE,EAAOC,MAAMP,GAC3DA,IACAC,EAAYD,GAGhBiB,IACAmC,EAAQqB,gBAAgBnE,EArEJ,CAsExB,CAEA,SAAS+D,EAAe3L,GACpB,IAAKgK,EAAS,OACd,GAAIyB,EAAwC,YAAvBA,EAAgB,GACrC,MAAMa,EAAOtM,EAAGuM,OACZD,IAAS1L,EAAK7C,MAAQuO,IAAS7D,EAAI1K,MAAM6N,EAAY,EAC7D,CAlQA,MAAMY,EAAOvF,EACPyD,EAAU8B,EAAK9B,QACfjC,EAAM+D,EAAKzE,KACXnH,EAAOoG,EACP5H,EAAWoN,EAAKpN,SAEtB,IAAI4K,EAAU,EACVyB,EAAgB,EAChB7D,EAAS8C,EAAQK,WAAa,GAC9BzD,EAAYM,EAAOoD,OACnBzD,EAAYK,EAAOoD,OAkCnBZ,EAA4B,KAC5BT,EAAgC,KAuNpC,MAAM8C,EAAczM,GAAc8K,EAAa9K,GACzC0M,EAAc1M,GAAc8K,EAAa9K,GAO/C,OALAY,EAAK+L,GAAG,YAAaF,GACrBhE,EAAIkE,GAAG,YAAaD,GAEpBnE,IAEO,KACH3H,EAAKgM,IAAI,YAAaH,GACtBhE,EAAImE,IAAI,YAAaF,GACrBtP,SAASkD,oBAAoB,UAAWoL,EAAW,CAAEI,QAAS,IAC9D1O,SAASkD,oBAAoB,YAAaqL,GAElD,C,oIA7RA,mBACA,WA8RA,UAAQkB,cAAc,eAAgB9F,GACtC,UAAeA,C,2BCzQf,SAAS+F,EAAUC,GACf,GAAIC,GAAWC,gBAAiB,CAC5B,MAAMC,EAAM,IAAIC,WAAWJ,GAE3B,OADAC,EAAUC,gBAAgBC,GACnBA,CACX,CAEA,MAAMA,EAAM,IAAIC,WAAWJ,GAC3B,IAAK,IAAIxB,EAAI,EAAGA,EAAIwB,EAAKxB,IAAK2B,EAAI3B,GAAKnE,KAAKgG,MAAsB,IAAhBhG,KAAKiG,UACvD,OAAOH,CACX,CAQA,SAAgBI,IACZ,MAAMC,EAASC,WACf,GAAID,GAAGE,QAAQC,WAAY,OAAOH,EAAEE,OAAOC,aAE3C,MAAMC,EAAIb,EAAU,IAGpBa,EAAE,GAAa,GAAPA,EAAE,GAAa,GAEvBA,EAAE,GAAa,GAAPA,EAAE,GAAa,IAEvB,MAAMC,EAAgB,GACtB,IAAK,IAAIrC,EAAI,EAAGA,EAAI,IAAKA,IAAKqC,EAAI/Q,KAAK0O,EAAEsC,SAAS,IAAIC,SAAS,EAAG,MAElE,OAEIF,EAAID,EAAE,IAAMC,EAAID,EAAE,IAAMC,EAAID,EAAE,IAAMC,EAAID,EAAE,IAAM,IAEhDC,EAAID,EAAE,IAAMC,EAAID,EAAE,IAAM,IAExBC,EAAID,EAAE,IAAMC,EAAID,EAAE,IAAM,IAExBC,EAAID,EAAE,IAAMC,EAAID,EAAE,IAAM,IAExBC,EAAID,EAAE,KAAOC,EAAID,EAAE,KAAOC,EAAID,EAAE,KAAOC,EAAID,EAAE,KAAOC,EAAID,EAAE,KAAOC,EAAID,EAAE,IAE/E,CAWA,SAAgBI,EAAKC,GACa,iBAATA,GAA2BC,KAAKC,MACtC9G,KAAKgG,OAAuB,iBAATY,EAAoBA,EAAOC,KAAKC,OAAS,YAD3E,MAGMC,EAAS,IAAIhB,WAAW,GAE9B,IAAIiB,EAAIC,OAAuB,iBAATL,EAAoBA,EAAOC,KAAKC,OACtD,IAAK,IAAI3C,EAAI,EAAGA,GAAK,EAAGA,IACpB4C,EAAO5C,GAAK+C,OAAW,MAAJF,GACnBA,IAAM,GAGV,IAAIG,EAAM,GACNC,EAAM,EACNC,EAAO,EACX,IAAK,IAAIlD,EAAI,EAAGA,EAAI,EAAGA,IAInB,IAFAiD,EAAOA,GAAO,EAAKL,EAAO5C,GAC1BkD,GAAQ,EACDA,GAAQ,GACXA,GAAQ,EACRF,GAAOG,EAASF,IAAQC,EAAQ,IAGpCA,EAAO,IAAGF,GAAOG,EAASF,GAAQ,EAAIC,EAAS,KACnDF,EAAMA,EAAI1G,MAAM,EAAG,IAGnB,MAAM8G,EAAM7B,EAAU,IACtB0B,EAAM,EAAGC,EAAO,EAChB,IAAK,IAAIlD,EAAI,EAAGA,EAAIoD,EAAI3D,OAAQO,IAI5B,IAFAiD,EAAOA,GAAO,EAAKG,EAAIpD,GACvBkD,GAAQ,EACDA,GAAQ,GACXA,GAAQ,EACRF,GAAOG,EAASF,IAAQC,EAAQ,IAKxC,OAFIA,EAAO,IAAGF,GAAOG,EAASF,GAAQ,EAAIC,EAAS,KAE5CF,EAAI1G,MAAM,EAAG,GACxB,CAYA,SAAgB+G,EAAOzG,EAAe,GAAI0G,EAAmBC,GACzD,GAAI3G,GAAQ,EAAG,MAAM,IAAI4G,MAAM,oBAC/B,MAAMC,GAAQ,GAAK5H,KAAKkD,KAAKlD,KAAK6H,KAAKJ,EAAS7D,UAAY,EAC5D,IAAIpJ,EAAK,GACT,KAAOA,EAAGoJ,OAAS7C,GAAM,CACrB,MAEM+G,EAFQpC,EAAU,GAEN,GAAKkC,EACnBE,EAAML,EAAS7D,SAAQpJ,GAAMiN,EAASK,GAC9C,CACA,OAAOtN,CACX,CASA,SAAgBuN,IACZ,MAAMC,EAAKnB,KAAKC,MAAML,SAAS,IAO/B,OANAwB,EAAQA,EAAO,EAAK,KAMb,GAAGD,IALAC,EAAKxB,SAAS,IAAIC,SAAS,EAAG,OAC9BjF,MAAMC,KAAKgE,EAAU,IAC1BwC,IAAI3B,IAAU,GAAJA,GAAUE,SAAS,IAAIC,SAAS,EAAG,MAC7CyB,KAAK,IACL1H,MAAM,EAAG,IAElB,C,gDAxHA,WAqCA,SAsDA,WAoBA,YAkBA,uBAA4B2H,EAAwB,SAAUC,EAAmB,CAAC,GAC9E,OAAQD,GACJ,IAAK,SAIL,QAEI,OAAOlC,IALX,IAAK,OAAQ,OAAOS,IACpB,IAAK,SAAU,OAAOa,EAAOa,EAAKtH,MAAQ,GAAIsH,EAAKZ,UAAYC,GAC/D,IAAK,QAAS,OAAOK,IAM7B,EAxKA,MAAMnC,EACqB,oBAAfQ,YAA+BA,WAAmBC,QAAW,KAwDnEiB,EAAU,mCAqDVI,EACF,mEA2BJ,IAAIO,EAAO,C,4ECpIX,UARA,SAAoBK,GAChB,OAAOA,EAAE/G,QAAQ,KAAM,SACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,OAC3B,C,8LCjBA,mBACA,aACA,SAaA,MAAM3C,EAEF2J,MAGAC,oBAGAC,QAGAC,SAGAC,eAGAC,QAGArF,eAGA/I,GAMA,WAAA7F,CAAY6N,GACRjP,KAAKkV,QAAUjG,EACfjP,KAAKiV,oBAAsBhG,aAAkB,UAC7CjP,KAAKgV,MAAQ,GACbhV,KAAKoV,eAAiB,IAAI,UAAY,EAAG,GACzCpV,KAAKiH,IAAK,IAAAqO,aAAY,SAAU,CAC5BpB,SAAU,4EAElB,CAOA,eAAA9C,CAAgBmE,GACZ,OAAQvV,KAAKgV,MAAQO,CACzB,CAMA,OAAAnF,GACI,OAAOpQ,KAAKgV,KAChB,CAOA,OAAAQ,CAAQD,GACJ,MAAME,EAAOzV,KAAKgV,MAAQO,EAC1B,OAAIvV,KAAKqR,eAAeqE,aACxB1V,KAAKqR,eAAe5M,SAASkR,gBAC7B3V,KAAKqR,eAAe5M,SAASmR,gBAFcH,CAI/C,CAKA,aAAAI,GACI,OAAQ7V,KAAKiV,mBACjB,CAKA,kBAAAa,GACI,OAAO9V,KAAKiV,mBAChB,CAKA,YAAA5D,GACI,OAAIrR,KAAK8V,qBACE9V,KAAKkV,QAEJlV,KAAKkV,SAAqBtS,SAE1C,CAIA,MAAAmT,GACI,MAAO,CACH3I,KAAMpN,KAAKoQ,UACX4F,OAAQ,CAAE1P,EAAGtG,KAAKoV,eAAe9O,EAAGE,EAAGxG,KAAKoV,eAAe5O,GAC3DyI,OAAQjP,KAAK8V,qBAAuB,KAAQ9V,KAAKkV,QAAoBjO,GACrEA,GAAIjH,KAAKiH,GAEjB,CAQA,eAAOgP,CACHC,GAEA,MAAMnG,EAAU,IAAI1E,EAAa,MAKjC,OAJA0E,EAAQ9I,GAAKiP,EAAKjP,GAClB8I,EAAQqF,eAAiB,IAAI,UAAYc,EAAKF,OAAO1P,EAAG4P,EAAKF,OAAOxP,GACpEuJ,EAAQqB,gBAAgB8E,EAAK9I,MAEtB2C,CACX,EAIK,EAAA1E,aAAAA,EADT,UAAeA,C,wKC1If,mBAGA,aAEA,MAAMC,EACL,eAAW/D,GAAS,MAAO,UAAY,CACvC,wBAAW4O,GAAkB,MAAO,mBAAqB,CACzD,2BAAWC,GAAqB,MAAO,kBAAoB,CAC3D,0BAAWC,GAAoB,MAAO,kBAAoB,CAC1D,0BAAWC,GAAoB,MAAO,wBAA0B,CAChE,0BAAWC,GAAoB,MAAO,mBAAqB,CAE3D3T,UAEA,WAAAxB,CAAYwB,GACX5C,KAAK4C,UAAYA,CAClB,CAEA,YAAA4T,CAAazB,GACZ,OAAOA,EAAE/G,QAAQ,KAAM,IACxB,CAEA,oBAAAyI,CAAqBrT,GACpB8K,MAAMC,KAAK/K,EAAKgL,YAAYjL,QAASkL,IACb,IAAnBA,EAAMC,UACRD,EAAsBE,aAAa,YAAa,aAGpD,CAEA,eAAAZ,CAAgB+I,GACf,OAAOA,EAAOhJ,MACf,CAEA,WAAAiJ,CAAY5G,GACX,MAAM7J,EAAMlG,KAAKsN,SACjBtN,KAAK4W,wBAAwB7G,GAE7B,MAAM6C,EAAI1M,EAAI2Q,QAAQC,SAASxL,EAAgB6K,eAC/CvD,EAAE3E,KAAK,CACN,eAAgB8I,KAAKC,UAAU,CAC9B/P,GAAI8I,EAAQ9I,GACZgQ,KAAMlH,EAAQ+F,yBAGhB/F,EAAQoF,SAAWvC,EAEnB,MAIMsE,EAAiBlX,KAAKwW,aAAazG,EAAQK,WAC3CsG,EAAS1W,KAAKmX,mBAAmBvE,EAAGsE,EAHtB3S,GAFJ,GAOVmJ,EAAO1N,KAAK2N,gBAAgB+I,GAE5BzQ,EAAOjG,KAAKoX,sBAAsBxE,EAAGlF,EAT3B,EACK,GASf2J,EAAarX,KAAKsX,kBAAkB1E,EAAGlF,EAV7B,EACK,GAWrB1N,KAAKuX,YAAYtR,EAAMoR,EAAYtH,EAAS2G,GAE5C,MAAM,UAAEc,EAAS,KAAEjH,GAASvQ,KAAKyX,uBAAuB1H,GACxD6C,EAAE3E,KAAK,CAAEyJ,UAAW,aAAaF,EAAUlR,MAAMkR,EAAUhR,YAAY+J,OAEnER,EAAQmF,mBAAmB,WAAWnF,EAAQmF,QAAQC,UACzDnV,KAAK2X,gBAAgB5H,EAlBN,EAoBjB,CAEA,wBAAA6H,GACC,IAAK,MAAM7H,IAAW,IAClB/P,KAAK4C,UAAUiV,iBACf3J,MAAMC,KAAKnO,KAAK4C,UAAUkV,QAAQC,UACnCpD,IAAIqD,GAAKA,EAAEC,cACXC,OAAOvT,KAAOA,IACd,CACF,IAAKoL,EAAQoF,SAAU,SAEvB,MAAM,UAAEqC,EAAS,KAAEjH,GAASvQ,KAAKyX,uBAAuB1H,GACxDA,EAAQoF,SAASlH,KAAK,CAAEyJ,UAAW,aAAaF,EAAUlR,MAAMkR,EAAUhR,YAAY+J,OAElFR,EAAQsF,UACXtF,EAAQsF,QAAQxP,SAChBkK,EAAQsF,aAAUhV,GAGf0P,EAAQmF,mBAAmB,WAC9BlV,KAAK2X,gBAAgB5H,EAAS,EAEhC,CACD,CAEQ,uBAAA6G,CAAwB7G,GAC3BA,EAAQoF,UAAUpF,EAAQoF,SAAStP,SACnCkK,EAAQsF,SAAStF,EAAQsF,QAAQxP,QACtC,CAEQ,kBAAAsR,CAAmBlI,EAAiB7B,EAAc9G,EAAWE,GAEpE,MAAMkQ,EAASzH,EAAO7B,KAAKA,GACzBG,KAAK,CAAEE,OAAQ,QAASD,KAAM,KAC9BxK,KAAK,QACLoM,KAAK9I,EAAGE,GACRsQ,SAASxL,EAAgB+K,iBAS3B,OAPAK,EAAOtT,KAAKgB,MAAM+T,WAAa,OAE/BzB,EAAOtT,KAAKgB,MAAOgU,iBAAmB,OAEtC1B,EAAOtT,KAAKgB,MAAOiU,aAAe,OAElC3B,EAAOtT,KAAKgB,MAAOkU,cAAgB,OAC5B5B,CACR,CAEQ,qBAAAU,CAAsBnI,EAAiBvB,EAAWnJ,EAAiBgU,GAE1E,OAAOtJ,EAAOhJ,KAAKyH,EAAK7B,MAAkB,EAAVtH,EAA6B,EAAfgU,EAAmB,EAAG7K,EAAK5B,OAAmB,EAAVvH,GAChFvB,KAAK,WACLwV,OAAO,CAAExT,MAAO,UAAW6G,MAAO,IAClC4M,OAAO,GACPC,MACH,CAEQ,iBAAApB,CAAkBrI,EAAiBvB,EAAWnJ,EAAiBgU,GAEtE,OAAOtJ,EAAO0J,OAAsB,EAAfJ,GACnBvV,KAAK,WACLoM,KAAK7K,EAASA,EAAWmJ,EAAK5B,OAAS,EAAKyM,GAC5CzB,SAASxL,EAAgBgL,gBAC5B,CAEQ,WAAAiB,CAAYtR,EAAeoR,EAAqBtH,EAAuB2G,GAC9E,UAAQkC,WAAWvB,EAAY,eAAgB,CAAEtH,YAC/C8I,WAAWxB,EAAY/L,EAAgBiL,iBACzC,UAAQqC,WAAW3S,EAAM,eAAgB,CAAE8J,UAAS3C,KAAMsJ,EAAQjS,SAAUzE,OAC1E6Y,WAAW5S,EAAMqF,EAAgBiL,gBACpC,CAEQ,sBAAAkB,CAAuB1H,GAC9B,IAAI+I,EAAa/I,EAAQqF,eAAe9O,EACpCyS,EAAahJ,EAAQqF,eAAe5O,EAExC,GAAIuJ,EAAQmF,mBAAmB,UAAS,CACvC,MAAM8D,EAAUjJ,EAAQmF,QAAQE,eAChC0D,GAAcE,EAAQ1S,EACtByS,GAAcC,EAAQxS,CACvB,CAIA,MAAO,CAAEgR,UAFSxX,KAAK4C,UAAUqW,kBAAkBH,EAAYC,GAE3CxI,KADPvQ,KAAK4C,UAAU6N,UAE7B,CAEQ,eAAAkH,CAAgB5H,EAAuBxL,GAC9C,KAAKwL,GAAaA,EAAQmF,mBAAmB,WAAanF,EAAQoF,UAAU,OAC5E,MAAMjP,EAAMlG,KAAKsN,SACX4L,EAAKlZ,KAAK4C,UAEZmN,EAAQsF,SAAStF,EAAQsF,QAAQxP,SAErC,MAAMsT,EAAYpJ,EAAQmF,QAAQE,eAC5BgE,EAAWrJ,EAAQmF,QAAQC,SAAUzH,OACrC2L,EAAgBH,EAAGD,kBACxBE,EAAU7S,EAAI8S,EAASvN,MAAQ,EAC/BsN,EAAU3S,GAGL8S,EAAcvJ,EAAQmF,QAAQE,eAC9BmE,EAAgBxJ,EAAQqF,eACxBoE,EAAcF,EAAYhT,EAAIiT,EAAcjT,EAC5CmT,EAAcH,EAAY9S,EAAI+S,EAAc/S,EAC5CkT,EAAc3J,EAAQoF,SAAUzH,OAChCiM,EAAmBT,EAAGD,kBAC3BO,GAAeE,EAAY7N,MAAkB,EAAVtH,GAAe,EAClDkV,GAGD1J,EAAQsF,QAAUnP,EAAI0T,KACrBP,EAAc/S,EAAG+S,EAAc7S,EAC/BmT,EAAiBrT,EAAGqT,EAAiBnT,GAEpCgS,OAAO,CAAExT,MAAO,OAAQ6G,MAAO,EAAGgO,UAAW,QAC7C/C,SAASxL,EAAgB8K,kBACzBsC,MACH,CAEA,gBAAAoB,GACC,MAAM5T,EAAMlG,KAAKsN,SACjBpH,EAAI6T,KAAK,IAAIzO,EAAgB6K,iBAAiBhT,QAAQe,GAAMA,EAAG2B,UAC/DK,EAAI6T,KAAK,IAAIzO,EAAgB8K,oBAAoBjT,QAAQe,GAAMA,EAAG2B,UAClE,UAAQmU,aAAa1O,EAAgBiL,iBAErC,IAAK,IAAK0D,EAAG7W,KAASpD,KAAK4C,UAAUkV,QAAS,CAC7C,MAAM/H,EAAU3M,EAAK6U,aACjBlI,IAASA,EAAQoF,cAAW9U,EACjC,CAEA,IAAK,MAAM0P,KAAW/P,KAAK4C,UAAUiV,cACpC9H,EAAQoF,cAAW9U,CAErB,CAEA,iBAAA6Z,GACala,KAAKsN,SACbyM,KAAK,IAAIzO,EAAgB8K,oBAAoBjT,QAAQe,GAAMA,EAAG2B,SACnE,CAEA,eAAAsU,GACC,IAAK,MAAMpK,KAAW/P,KAAK4C,UAAUiV,cAAe7X,KAAK2W,YAAY5G,GACrE,IAAK,IAAKkK,EAAG7W,KAASpD,KAAK4C,UAAUkV,QAAS,CAC7C,MAAM/H,EAAU3M,EAAK6U,aACjBlI,GAAS/P,KAAK2W,YAAY5G,EAC/B,CACD,CAEA,MAAAzC,GACC,OAAOtN,KAAK4C,UAAUsD,GACvB,CACG,KAAAsK,GACI,OAAOxQ,KAAK4C,SAChB,EAGJ,UAAe0I,C,sOClOf,mBAcsB,EAAAxK,SAdf,UACP,mBAcuB,EAAAD,UAdhB,UACP,mBAeI,EAAAE,YAfG,UACP,gBAeI,8EAfK,EAAAC,eAAe,G,87BCJxB,mBACA,aACA,aACA,aACA,UAGA,aACA,aAEA,aACA,aACA,aA+uCA,UAjtCA,MAIIoZ,WAIAC,aAIAC,WAIAC,UAIAC,IAIAC,YAIAC,eAIAC,YAIAC,kBAIA,qBAAWC,GACP,MAAO,cACX,CAIA,sBAAWC,GACP,MAAO,cACX,CAIA,wBAAWC,GACP,MAAO,qBACX,CAIA,wBAAWC,GACP,MAAO,uBACX,CAIA,0BAAWC,GACP,MAAO,gBACX,CAIA,6BAAWC,GAEP,MAAO,oBACX,CAIA,eAAW3T,GACP,MAAO,OACX,CAMA,WAAAnG,CAAYwB,EAAyBuY,EAAwC,CAAC,GAC1Enb,KAAKwa,IAAM5X,EACX5C,KAAKqa,aAAe,KACpBra,KAAKsa,WAAa,KAClBta,KAAKua,UAAY,KACjBva,KAAKya,YAAc,GACnBza,KAAK4a,kBAAoBO,EACzBnb,KAAKob,MACT,CAIA,IAAAA,GACIpb,KAAKqb,sBACLrb,KAAKsb,kBACLtb,KAAKub,eACT,CAIA,aAAAA,GACIvb,KAAKoa,WAAa,IAAI,UAAkBpa,KAAK4a,kBACjD,CAIA,eAAAU,GACI,MAAMva,EAAe,QAAgC,QACrDf,KAAK2a,YAAc,IAAI5Z,CAC3B,CAIA,mBAAAsa,GACIrb,KAAK0a,eAAiB,IAAI,UAAgB1a,KAAKwQ,QACnD,CAKA,UAAAgL,CAAW7W,GACP3E,KAAKkB,OAAOua,oBAAoBvZ,OAAOyC,EAC3C,CAMA,YAAA+W,CAAa/W,EAAgC,CAAC,GAC1C,OAAOjE,OAAOib,OAAO3b,KAAKoa,WAAYzV,EAC1C,CAIA,aAAID,GACA,IAAK1E,KAAKoD,KAAM,OAAOpD,KAAKoa,WAE5B,MAAM,QAAEtW,EAAO,UAAE8X,EAAS,SAAEC,KAAaC,GAAe9b,KAAKoD,KAAKS,OAElE,MAAO,IACA7D,KAAKoa,cACL0B,EAEX,CAIA,aAAIpX,CAAUC,GACV3E,KAAK0b,aAAa/W,EACtB,CAIA,QAAIvB,GACA,OAAOpD,KAAKqa,YAChB,CAIA,OAAInU,GACA,OAAOlG,KAAKwQ,QAAQtK,GACxB,CAIA,SAAIhF,GACA,OAAOlB,KAAKua,SAChB,CAKA,KAAA/J,GACI,OAAOxQ,KAAKwa,GAChB,CAOA,uBAAAuB,GACI,MAAMpX,EAAI3E,KAAK0E,UACf,MAAO,CACHmH,MAAOlH,EAAEqX,gBACTlQ,OAAQnH,EAAEsX,iBAElB,CAQA,gBAAA9O,CAAiBC,EAActI,EAAmBF,GAC9C,MAAMD,EAAI3E,KAAK0E,UAGf,IAAK1E,KAAKkG,IAAK,OAAOkH,EAAKiD,QAAUvL,GAAYH,EAAEI,WAAa,GAEhE,MAAM+I,EAAM9N,KAAKkG,IAAIkH,KAAKA,GACrBG,KAAK,CACFE,OAAQ7I,GAAcD,EAAEE,YACxB2I,KAAM1I,GAAYH,EAAEI,UACpBmX,OAAQ,UAEXC,QAAQ,GAEPtQ,EAAQiC,EAAIJ,OAAO7B,MAEzB,OADAiC,EAAIjI,SACGgG,CACX,CAQA,iBAAAuQ,CAAkBhP,EAActI,EAAmBF,GAC/C,MAAMD,EAAI3E,KAAK0E,UAGf,IAAK1E,KAAKkG,IAAK,OAAQpB,GAAYH,EAAEI,UAErC,MAAM+I,EAAM9N,KAAKkG,IAAIkH,KAAKA,GACrBG,KAAK,CACFE,OAAQ7I,GAAcD,EAAEE,YACxB2I,KAAM1I,GAAYH,EAAEI,UACpBmX,OAAQ,UAEXC,QAAQ,GAEPrQ,EAASgC,EAAIJ,OAAO5B,OAE1B,OADAgC,EAAIjI,SACGiG,CACX,CAMA,eAAAuQ,CAAgBjP,EAAe,IAC3B,MAAMzI,EAAI3E,KAAK0E,UACT4X,EAAQtc,KAAKmN,iBAAiBC,GAGpC,MAAO,CAAEvB,MAFKY,KAAKK,IAAInI,EAAE4X,qBAAsBD,EAA8B,EAAtB3X,EAAE6X,mBAEzC1Q,OADDnH,EAAE8X,sBAErB,CAMA,YAAAC,CAAaC,GACC3c,KAAK0E,UAAf,MACMkY,EAAQD,EAAME,aACpB,OAAKD,EAKE,CAAE/Q,MAHK7L,KAAKmN,iBAAiByP,GAGpB9Q,OAFD9L,KAAKoc,kBAAkBQ,IAHnB,CAAE/Q,MAAO,EAAGC,OAAQ,EAM3C,CAMA,UAAAgR,CAAWH,GACP,IAAKA,EAAMI,SAAU,MAAO,CAAElR,MAAO,EAAGC,OAAQ,GAEtC9L,KAAK0E,UAAf,MACMsY,EAAMhd,KAAKqc,gBAAgBM,EAAMM,cAAgB,IACvD,MAAO,CACHpR,MAAOmR,EAAInR,MACXC,OAAQkR,EAAIlR,OAEpB,CAMA,aAAAoR,CAAcP,GACV,IAAKA,EAAMQ,iBAAkB,MAAO,CAAEtR,MAAO,EAAGC,OAAQ,GAE9C9L,KAAK0E,UAAf,MACM0Y,EAAIT,EAAMU,gBAChB,OAAKD,EAKE,CAAEvR,MAHGuR,EAAEvR,MAGEC,OAFHsR,EAAEtR,QAHA,CAAED,MAAO,EAAGC,OAAQ,EAMvC,CAKA,0BAAAwR,GACI,MAAO,CAAEzR,MAAO7L,KAAK0E,UAAU6Y,aAAczR,OAAQ,EACzD,CAMA,YAAA0R,CAAab,GAET,MAAMc,EAAQ,CACVzd,KAAKsd,6BACLtd,KAAK0c,aAAaC,GAClB3c,KAAK8c,WAAWH,GAChB3c,KAAKkd,cAAcP,GACnB3c,KAAKsd,8BAGT,IAAIzR,EAAQ,EAAGC,EAAS,EACxB,IAAK,MAAQD,MAAO6R,EAAG5R,OAAQ6R,KAAOF,EAClC5R,GAAS6R,EACT5R,EAASW,KAAKK,IAAIhB,EAAQ6R,GAG9B,MAAO,CAAE9R,QAAOC,SACpB,CAKA,qBAAA8R,GACI,IAAK5d,KAAKoD,KAAM,OAEhB,MAAMuB,EAAI3E,KAAK0E,UAETmZ,EAAO7d,KAAK8d,sBAEZC,EAAc/d,KAAKge,cACrBrZ,EAAEsZ,cAAgBtZ,EAAEuZ,aACpBL,EAAKhS,MACLgS,EAAK/R,QAGT,MAAO,CACHD,MAAOkS,EAAYlS,MACnBC,OAAQiS,EAAYjS,OAASnH,EAAEwZ,cAC/BC,OAAQL,EAAYK,OAE5B,CAQA,aAAAJ,CACIK,EACAC,EACAC,GAMA,MAAM5Z,EAAI3E,KAAK0E,UACTtB,EAAOpD,KAAKoD,KAElB,IAAIoD,EAAI6X,EACJG,EAAaF,EACbG,EAAcF,EAClB,MAAMH,EAA8C,GAEpD,IAAK,MAAMzB,KAASvZ,EAAKsb,YAAa,CAClC,MAAMtB,EAAIpd,KAAKwd,aAAab,GAC5ByB,EAAOlc,KAAKkb,GAEZoB,EAAa/R,KAAKK,IACd0R,EACApB,EAAEvR,MAA2B,EAAnBlH,EAAEga,gBAGhB,MAAMtY,EAASG,EAAI4W,EAAEtR,OACjBzF,EAAS1B,EAAEia,eAAiBH,IAC5BA,EAAcpY,EAAS1B,EAAEia,gBAG7BpY,GAAK4W,EAAEtR,OAASnH,EAAEia,cACtB,CAEA,MAAO,CAAE/S,MAAO2S,EAAY1S,OAAQ2S,EAAaL,SACrD,CAKQ,mBAAAN,GACJ,MAAMnZ,EAAI3E,KAAK0E,UACTtB,EAAOpD,KAAKoD,KAEZya,EAAO7d,KAAK+b,0BAClB,IAAIlQ,EAAQgS,EAAKhS,MACbC,EAAS+R,EAAK/R,OAElB,GAAI1I,EAAKO,UAAW,CAChB,MAAMkb,EAAS7e,KAAKmN,iBAChB/J,EAAKO,UACLgB,EAAEI,UACFJ,EAAEE,aAGNgH,EAAQY,KAAKK,IACTjB,EACAgT,EAAmC,EAA1Bla,EAAEma,sBAEnB,CAEA,MAAO,CAAEjT,QAAOC,SACpB,CAOA,UAAAiT,CAAWC,GACPhf,KAAKif,UAAUD,GACVhf,KAAKoD,OACVpD,KAAKgH,WACLhH,KAAK2a,YAAYuE,MAAMlf,KAAKoD,KAAiBpD,KAAMA,KAAKkB,OACxDlB,KAAKmf,aACT,CAKA,SAAAF,CAAUD,GACN,MAAM9F,EAAKlZ,KAAKwQ,QAChB,GAAIwO,aAAwB,UACxBhf,KAAKqa,aAAe2E,MACjB,CACH,MAAM5b,EAAO8V,EAAGkG,QAAQJ,GACpB5b,aAAgB,UAChBpD,KAAKqa,aAAejX,EAEpBpD,KAAKqa,aAAe,IAE5B,CACJ,CAQA,SAAAgF,CAAUC,EAAcrY,GACpB,MAAO,CACHA,KACA4P,MAAOyI,EACPC,UAAW,EACX9D,mBAAoB,GAE5B,CAIA,UAAA0D,GACInf,KAAKya,YAAYvY,KAAKlC,KAAKkB,MAC/B,CASA,YAAAse,CAAaC,EAAe9C,EAAiB+C,EAAiB,GAC1D,MAAM/a,EAAI3E,KAAK0E,UACT6Q,EAAQoH,EAAMgD,qBAAuB,IACrC,MAAE9T,EAAK,OAAEC,GAAW9L,KAAKqc,gBAAgB9G,GAEzCtP,EAAOwZ,EAAWxZ,KAAK4F,EAAOC,GAC/B9I,MAAK,IAAAsB,YAAWK,EAAEib,kBAClBpH,OAAO,CAAExT,OAAO,IAAAV,YAAWK,EAAEkb,yBAA0BhU,MAAOlH,EAAEmb,2BAChErH,OAAO,GAEN3K,EAAM2R,EAAWrS,KAAKmI,GACvBhI,KAAK,CACFE,OAAQ9I,EAAEE,YACV2I,KAAM7I,EAAEI,UACRmX,OAAQvX,EAAEob,wBAEb/c,MAAK,IAAAsB,YAAWK,EAAEqb,uBACvBlS,EAAI1K,KAAKgB,MAAM+T,WAAa,OAE5B,MAAM8H,EAA0B,CAC5BC,IAAKja,EACL6H,OAIEqS,GAAWrU,EADAgC,EAAIJ,OACc5B,QAAU,EAY7C,OATA7F,EAAKmJ,KAAKsQ,EAAQ,GAClB5R,EAAIsB,KAAKsQ,EAAS/a,EAAE6X,kBAAmB2D,GACvC,UAAQvH,WAAW3S,EAAM,aAAc,CACnC0W,QACAvP,KAAMU,EACNrJ,SAAUzE,KACV0f,WACD7G,WAAW5S,EAAM,CAAEjG,KAAKoB,YAAgC0Z,YAAa,QAAQ9a,KAAKoD,KAAM6D,OAEpF,CAAEhB,OAAM6H,MAAKmS,SACxB,CASA,cAAAG,CAAeX,EAAe9C,EAAiB+C,EAAiB,GAC5D,MAAM/a,EAAI3E,KAAK0E,UACTkY,EAAQD,EAAME,aACpB,IAAKD,EAAO,OAAO,EAEnB,MAAM9O,EAAM2R,EAAWrS,KAAKwP,GACvBrP,KAAK,CACFE,OAAQ9I,EAAEE,YACV2I,KAAM7I,EAAEI,UACRmX,OAAQ,UAEXlZ,MAAK,IAAAsB,YAAWK,EAAEM,aACvB6I,EAAI1K,KAAKgB,MAAM+T,WAAa,OAC5B,MAAMzK,EAAOI,EAAIJ,OACXyS,GAAW1T,KAAKK,IAAInI,EAAE8X,sBAAuB/O,EAAK5B,QAAU4B,EAAK5B,QAAU,EAMjF,OAHAgC,EAAIsB,KAAKsQ,EAAQS,GAGVzS,EAAK7B,MAAQlH,EAAE0b,aAC1B,CAKA,eAAAC,GACI,MAAMld,EAAOpD,KAAKoD,KACZlC,EAAQlB,KAAKua,UACnB,IAAKnX,IAASlC,IAAUA,EAAM2V,MAAO,OAErC,MAAMlS,EAAI3E,KAAK0E,UAET6b,EAAevgB,KAAK4d,wBACpB/R,EAAQ0U,GAAc1U,OAASlH,EAAEqX,gBAEjCwE,EAA4B,GAAlB7b,EAAEsZ,cACZ1Z,GAAWI,EAAEsZ,cAAgBuC,GAAW,EAGxCC,EAASvf,EAAM2V,MAAMA,QAAQ5I,KAAK,CAAEyS,MAAO,gBACjD,UAAQ9H,WAAW6H,EAAQ,cAAe,CACtC7d,UAAW5C,KAAKwQ,QAChBpN,SACDyV,WAAW4H,EAAQ,CAAEzgB,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,OAEvFwZ,EAAOxa,KAAKua,EAASA,GAChBxd,KAAK,aACLyV,OAAO,GACPrJ,KAAKvD,EAAQ2U,EAAUjc,EAASA,GAGrC,MAAMuJ,EAAM2S,EAAOrT,KAAK,KACnBG,KAAK,CACFE,OAAQ9I,EAAEE,YACV2I,KAAgB,GAAVgT,EACNG,OAAQ,OACRzE,OAAQ,WAEXlZ,KAAK,QACLiL,KAAK,CACF,cAAe,SACf,oBAAqB,WAE7BH,EAAI1K,KAAKgB,MAAM+T,WAAa,OAE5BrK,EAAI4J,UAAU,CACVkJ,WAAY/U,EAAQ2U,EAAU,EAAIjc,EAClCsc,WAAYtc,EAAUic,EAAU,IAGpCtf,EAAM4f,QAAUL,CACpB,CAUA,aAAAM,CAAczB,EAAc0B,EAAiBxa,EAAWya,EAAwBjc,GAC5E,MAAML,EAAI3E,KAAK0E,UACf,IAAK4a,IAAc0B,EAAQ,OAAO,KAElC,MAAMtT,EAAOsT,EAAOtT,OACdmJ,EAAQyI,EACRhZ,EAAa,SAAT2a,EAAkB,EAAIvT,EAAK7B,MAErC,GAAIlH,EAAEuc,mBAAoB,CAEtB,MAAMC,EAAUxc,EAAEyc,mBAClB,IAAIC,EAAOxY,EAAKyY,WAAWH,EAASA,EAAS,GAGhC,SAATF,IAAiBI,EAAOxY,EAAK0Y,WAAWF,EAAM,IAAKF,EAAU,EAAGA,EAAU,IAE9E,MAAMK,EAAM3K,EAAMwK,KAAKA,GAClBre,MAAK,IAAAsB,YAAWU,IAChBwT,OAAO,CAAExT,OAAO,IAAAV,YAAW,aAAcuH,MAAO,IACrD2V,EAAIvT,KAAK,CACLyS,MAAQ1gB,KAAKoB,YAAgC4Z,gBAEjD,MAAMyG,EAAmB,SAATR,GAAmBE,EAAU,EAG7C,OAFAK,EAAI9J,UAAU,CAAEkJ,WAAYta,EAAImb,EAASZ,WAAYra,EAAI2a,EAAU,IAE5DK,CACX,CAAO,CAEH,MAAM/I,EAAS9T,EAAE+c,iBACXC,EAAa9Y,EAAK8P,OAAOF,GAEzBmJ,EAAO/K,EAAMwK,KAAKM,GACnB3e,MAAK,IAAAsB,YAAWU,IAChBwT,OAAO,CAAExT,OAAO,IAAAV,YAAW,aAAcuH,MAAO,IAChDuD,KAAK9I,EAAImS,EAAQjS,EAAIiS,GAI1B,OAHAmJ,EAAK3T,KAAK,CACNyS,MAAQ1gB,KAAKoB,YAAgC4Z,gBAE1C4G,CACX,CACJ,CAOA,aAAAC,CAAcvC,GACV,MAAMlc,EAAOpD,KAAKoD,KACZuB,EAAI3E,KAAK0E,UACf,GAAKtB,GAEDA,EAAKO,UAAW,CAChB,MAAMmK,EAAMwR,EAAUlS,KAAKhK,EAAKO,WAC3B4J,KAAK,CACFE,OAAQ9I,EAAEE,YACV2I,KAAM7I,EAAEI,UACRmX,OAAQ,QACRyE,OAAQhc,EAAEmd,oBAAsB,MAAQ,WAE3C9e,MAAK,IAAAsB,YAAWK,EAAEM,aAEvB6I,EAAI1K,KAAKgB,MAAM+T,WAAa,OAE5B,MAAMzK,EAAOI,EAAIJ,OACXyS,GAAWxb,EAAEsZ,cAAgBvQ,EAAK5B,QAAU,EAElDgC,EAAIsB,KAAKzK,EAAEma,sBAAuBqB,EAAUxb,EAAEod,sBAClD,CACJ,CAMA,QAAA/a,GACI,IAAKhH,KAAKoD,KAAM,OAEhB,MAAMA,EAAOpD,KAAKoD,KACZlC,EAAQlB,KAAKqf,UAAUrf,KAAKgiB,gBAAgB5e,GAAOA,EAAK6D,IAC9DjH,KAAKua,UAAYrZ,EAEjB,MAAMqf,EAAevgB,KAAK4d,wBAE1B5d,KAAKiiB,aAAa/gB,EAAOqf,GACzBvgB,KAAKkiB,eAAehhB,EAAOlB,KAAKmiB,gBAAiB5B,GACjDvgB,KAAKsgB,kBACLtgB,KAAK6hB,cAAc3gB,EAAM2V,OACzB7W,KAAKoiB,kBAAkBlhB,EAAM2V,MAAQ3V,EAAMmhB,OAASjf,GAEpDpD,KAAKsiB,iBAAiBphB,GACtBlB,KAAKuiB,qBAAqBhC,GAE1BvgB,KAAKwiB,4BAA4BthB,EAAOkC,EAAMlC,EAAM2V,MAAQ0J,EAChE,CAMA,eAAAyB,CAAgB5e,GACZ,MAAMkc,EAAYtf,KAAKkG,IAAI2Q,QAAQ5I,KAAK,CACpC,gBAAgB,aAAW7K,EAAK6D,IAChC,MAAUjH,KAAKoB,YAAgCyZ,aAE7CrD,EAAYxX,KAAKwa,IAAIvB,kBAAkB7V,EAAKgS,eAAe9O,EAAGlD,EAAKgS,eAAe5O,GAExF,OADA8Y,EAAUrR,KAAK,CAAEyJ,UAAW,aAAaF,EAAUlR,MAAMkR,EAAUhR,OAC5D8Y,CACX,CAMA,YAAA2C,CAAa/gB,EAAkBqf,GAC3B,MAAM5b,EAAI3E,KAAK0E,UACTmH,EAAQ0U,GAAc1U,OAASlH,EAAEqX,gBACjClQ,EAASyU,GAAczU,QAAUnH,EAAEsX,iBACnCxD,EAAS9T,EAAE8d,cACjBvhB,EAAMwhB,GAAKxhB,EAAM2V,MAAOwK,KAAKxY,EAAK8Z,YAAY9W,EAAOC,EAAQ2M,IACxDzV,MAAK,IAAAsB,YAAWK,EAAEie,gBAClBpK,OAAO,CAAExT,OAAO,IAAAV,YAAWK,EAAEke,oBAAqBhX,MAAO,IAC9D3K,EAAM4hB,OAAS5hB,EAAM2V,MAAOwK,KAAKxY,EAAK8Z,YAAY9W,EAAOC,EAAQ2M,IAC5DzV,KAAK,mBACLoM,KAAKuE,OAAOzS,EAAMwhB,GAAGpc,KAAO,EAAGqN,OAAOzS,EAAMwhB,GAAGlc,KAAO,GACtDkS,MACT,CAOA,cAAAwJ,CAAehhB,EAAkB2C,EAAoB0c,GACjD,MAAM5b,EAAI3E,KAAK0E,UACTmH,EAAQ0U,GAAc1U,OAASlH,EAAEqX,gBACjCvD,EAAS9T,EAAE8d,cACjBvhB,EAAMmhB,OAASnhB,EAAM2V,MAAOwK,KAAKxY,EAAK8Z,YAAY9W,EAAOlH,EAAEsZ,cAAexF,IACrEzV,MAAK,IAAAsB,YAAWT,EAAOC,UACvB0U,OAAO,CAAExT,OAAO,IAAAV,YAAWT,EAAOgY,UAAWhQ,MAAO,GAC7D,CAOA,iBAAAuW,CAAkB9C,EAAcjI,EAAqBjU,GACjD,UAAQwV,WAAW0G,EAAW,cAAe,CACzCyD,OAAQ1L,EACRR,MAAOyI,EACPlc,OACAE,KAAM,IACPuV,WAAWyG,EAAW,CAAEtf,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,MAC9F,CAEA,gBAAAqb,CAAiBphB,GACb,MAAMyD,EAAI3E,KAAK0E,UACTse,EAAc9hB,EAAM2V,MAAOA,QACjCmM,EAAY/U,KAAK,CAAEyJ,UAAW,gBAAgB/S,EAAEsZ,cAAgBtZ,EAAEuZ,kBAClEhd,EAAM+hB,SAAWD,CACrB,CASA,gBAAAE,CAAiBvG,EAAiB4D,EAAgChM,EAAa/N,GAC3E,MAAMpD,EAAOpD,KAAKoD,KACZlC,EAAQlB,KAAKkB,MACbyD,EAAI3E,KAAK0E,UACf,IAAKtB,IAASlC,IAAUA,EAAM+hB,SAAU,OACxC,MAAMD,EAAc9hB,EAAM+hB,SACpB3D,EAAYpe,EAAM2V,MAClBsM,EAAK5C,GAAcnC,OAAO7J,GAChC,IAAK4O,EAAI,OAGT,IAAIC,EAASze,EAAEga,eAEf,MAAMc,EAAauD,EAAYnM,QAC/B4I,EAAWxR,KAAK,CAAEyJ,UAAW,aAAa0L,MAAW5c,OACrDmW,EAAMxH,SAAWsK,EACjBve,EAAMqe,UAAY/Y,EAGlB,MAAM6c,EAAQrjB,KAAKogB,eAAeX,EAAY9C,GAC9C,GAAIA,EAAMQ,iBAENR,EAAM2G,WAAW,CACbC,cAAeJ,EAAGtX,MAClB2X,eAAgBL,EAAGrX,OACnBuX,QACA5D,aACAH,YACApZ,IAAKlG,KAAKkG,IACV6F,WAAY7K,EAAOwhB,SAEpB,CACH,IAAIe,EAASC,EAEb,GAAI/G,EAAMI,SAAU,CAChB,MAAM,OAAEkD,GAAWjgB,KAAKwf,aAAaC,EAAY9C,EAAO0G,GACxDI,EAAUxD,CACd,CACA,GAAItD,EAAMgH,kBAAqBhH,EAA4BiH,WAAY,CACnE,MAAMC,GAAcV,EAAGrX,QAAU6Q,EAAMI,SAAW,EAAIpY,EAAEia,iBAAmB,EACrEkF,EAAOnf,EAAEsZ,cAAgBtZ,EAAEuZ,aAAe1X,EAAIqd,EAG9CE,EAAK/jB,KAAK+gB,cACZzB,EACApe,EAAMwhB,GACNoB,EACA,SACA,IAAAxf,YAAWK,EAAEqf,mBAEjB,GAAID,EAAI,CACJ,MAAMpf,EAAI,CACNwJ,KAAOwO,EAA4BiH,WACnCK,GAAMtH,EAA4BiH,WAAWM,SAAqBC,mBAClEC,WAAYL,EACZM,aAAcN,EACdO,WAAa3H,EAA4BiH,YAE7CF,EAAc,CACVa,UAAWR,EACXS,UAAW7f,GAEf3E,KAAKwb,WAAW7W,GAChB,UAAQiU,WAAWmL,EAAI,kBAAmB,CACtCH,WAAajH,EAA4BiH,WACzCjH,UACD9D,WAAWkL,EAAI,CAAE/jB,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,MACvF,CACJ,CACA0V,EAAM8H,OAAOhB,EAASC,EAC1B,CACJ,CAMA,oBAAAnB,CAAqBmC,EAA4C,MAC7D,MAAMthB,EAAOpD,KAAKoD,KAClB,IAAIoD,EAAI,EACR,MAAMtF,EAAQlB,KAAKkB,MACbyD,EAAI3E,KAAK0E,UACf,IAAKtB,IAASlC,IAAUA,EAAM+hB,SAAU,OACpB/hB,EAAM+hB,SACR/hB,EAAM2V,MADxB,MAGM0J,EAAemE,GAAoB1kB,KAAK4d,wBAU9C,OARAxa,EAAKsb,YAAYvb,QAAQ,CAACwZ,EAAOpI,KAC7BvU,KAAKkjB,iBAAiBvG,EAAO4D,EAAkChM,EAAK/N,GACpE,MAAM2c,EAAK5C,GAAcnC,OAAO7J,GAC3B4O,IACL3c,GAAK2c,EAAGrX,OAASnH,EAAEia,kBAGvB1d,EAAMqe,UAAY/Y,EACXA,CACX,CASA,2BAAAgc,CAA4BthB,EAAkBkC,EAAekc,EAAciB,EAAyD,MAChI,IAAKrf,IAAUkC,EAAM,OACrB,IAAKlC,EAAMwhB,GAAI,OACf,MAAM/d,EAAI3E,KAAK0E,UACTb,EAAqB7D,KAAKmiB,gBAI1BzU,EAAOxM,EAAMwhB,IAAIhV,OACjBiX,GAAMjX,GAAM5B,QAAUyU,GAAczU,QAAUnH,EAAEwZ,cAGtD,GAAI/a,EAAK+gB,mBAAoB,CACzB,MAAMS,EAAK5kB,KAAK+gB,cAAczB,EAAWpe,EAAMwhB,GAAIiC,EAAI,QAAQ,IAAArgB,YAAWT,EAAOC,UACjF,GAAI8gB,EAAI,CACJ,MAAMjgB,EAAI,CACNwJ,KAAM/K,EAAK+gB,mBACXF,GAAIjkB,KAAK6kB,mBAAmBzhB,EAAK+gB,mBAAmBW,UAAW1hB,EAAK+gB,oBACpEC,WAAYQ,EACZN,WAAYlhB,EAAK+gB,mBACjBE,aAAcO,GAElB5kB,KAAKwb,WAAW7W,GAChB,UAAQiU,WAAWgM,EAAI,kBAAmB,CACtChB,WAAYxgB,EAAK+gB,mBACjB/gB,SACDyV,WAAW+L,EAAI,CAAE5kB,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,OAEnFjH,KAAK+kB,8BAA8B3hB,EAAK+gB,mBAAoBS,EAAe,EAC/E,CACJ,CAGA,GAAIxhB,EAAK4hB,eAAgB,CACrB,MAAMC,EAAKjlB,KAAK+gB,cAAczB,EAAWpe,EAAMwhB,GAAIiC,EAAI,SAAS,IAAArgB,YAAWT,EAAOC,UAClF,GAAImhB,EAAI,CACJ,MAAMtgB,EAAI,CACNwJ,KAAM/K,EAAK4hB,eACXf,GAAIjkB,KAAK6kB,mBAAmBzhB,EAAK4hB,eAAed,QAAS9gB,EAAK4hB,gBAC9DZ,WAAYa,EACZX,WAAYlhB,EAAK4hB,eACjBX,aAAcY,GAElBjlB,KAAKwb,WAAW7W,GAChB,UAAQiU,WAAWqM,EAAI,kBAAmB,CACtCrB,WAAYxgB,EAAK4hB,eACjB5hB,SACDyV,WAAWoM,EAAI,CAAEjlB,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,OAEnFjH,KAAK+kB,8BAA8B3hB,EAAK4hB,eAAgBC,EAAe,EAC3E,CACJ,CACJ,CAMA,eAAAC,GACI,OAAOllB,KAAK0a,gBAAgB9C,4BAChC,CAKA,aAAAjC,GACI,OAAO3V,KAAK0a,gBAAgBZ,oBAChC,CAKA,YAAAlE,GACI,OAAO5V,KAAK0a,gBAAgBP,mBAChC,CAKA,OAAA1J,GACI,OAAOzQ,KAAKwa,IAAI/J,WAAa,CACjC,CAMA,eAAA0U,CAAgBC,EAAUhiB,GACtB,MAAMmN,EAAOvQ,KAAKyQ,WACZ,EAAEnK,EAAC,EAAEE,GAAMxG,KAAKwa,IAAIvB,kBAAkB7V,EAAKgS,eAAe9O,EAAGlD,EAAKgS,eAAe5O,GACvF4e,EAAMnX,KAAK,CAAEyJ,UAAW,aAAapR,MAAME,YAAY+J,MAC3D,CAKA,qBAAA8U,GACI,MAAMC,EAAatlB,KAAKkG,IAAI6T,KAAK,IAAK/Z,KAAKoB,YAAgCyZ,cACrEtK,EAAOvQ,KAAKyQ,UAElB,IAAK,IAAI2U,KAASE,EAAY,CAC1B,MAAMliB,EAAOpD,KAAKwa,IAAI4E,SAAQ,aAAagG,EAAMnX,KAAK,kBACtD,IAAK7K,EAAM,SACX,MAAM,EAAEkD,EAAC,EAAEE,GAAMxG,KAAKwa,IAAIvB,kBAAkB7V,EAAKgS,eAAe9O,EAAGlD,EAAKgS,eAAe5O,GACvF4e,EAAMnX,KAAK,CAAEyJ,UAAW,aAAapR,MAAME,YAAY+J,MAC3D,CAEAvQ,KAAKulB,yBACLvlB,KAAKklB,iBACT,CAMA,sBAAAK,GACIvlB,KAAKwlB,aACLxlB,KAAKylB,sBACT,CAKA,aAAAtD,GAQI,OAPsBniB,KAAKoD,KACKS,QAAU,CACtCC,QAAS,OACT8X,UAAW,OACX8J,UAAW,OACXC,SAAU,GAGlB,CAKA,2BAAAC,GACI,IAAK,MAAM1kB,KAASlB,KAAKya,YACrB,IAAK,MAAMoL,KAAY3kB,EAAMua,mBAAoB,CAC7C,MAAM,WAAE6I,GAAeuB,EACvB,GAAKvB,EAAL,CAGA,IAAKuB,EAASzB,WAAY,CACtB,MAAM0B,EAAQ9lB,KAAKya,YACdsL,QAAQhR,GAAKA,EAAE0G,oBACf1B,KAAKiM,GAAKA,EAAE1B,aAAeuB,EAAS1X,MAAQ6X,EAAE3B,cAC/CyB,IAAOD,EAASzB,WAAa0B,EAAMzB,aAC3C,CAEA,IAAKwB,EAASI,SAAU,CACpB,MAAMH,EAAQ9lB,KAAKya,YACdsL,QAAQhR,GAAKA,EAAE0G,oBACf1B,KAAKiM,GAAKA,EAAE1B,aAAeuB,EAAS5B,IAAM+B,EAAE3B,cAC7CyB,IAAOD,EAASI,SAAWH,EAAMzB,aACzC,CAfyB,CAgB7B,CAER,CAOA,kBAAAQ,CAAmBqB,EAA0BC,GACzC,GAAKD,GAAgBC,EAArB,CAGA,GAAIA,EAASC,WAAY,CAErB,GAAIF,aAAuB,UAAS,OAAOA,EAAYlB,eAEvD,GAAIkB,aAAuB,UAAO,OAAOA,EAAYtC,UACzD,CAGA,IAAKuC,EAASC,WAAY,CACtB,GAAIF,aAAuB,UAAS,OAAOA,EAAY/B,mBAEvD,GAAI+B,aAAuB,UAAO,OAAOA,EAAYtC,UACzD,CAf+C,CAgBnD,CAOA,6BAAAmB,CAA8BsB,EAAkB1N,EAAiByN,GAC7D,IAAK,MAAMllB,KAASlB,KAAKya,YACrB,IAAK,MAAMoL,KAAY3kB,EAAMua,mBAErB2K,EAEIP,EAAS5B,KAAOoC,GAASR,EAASI,WAClCJ,EAASI,SAAWtN,GAIpBkN,EAAS1X,OAASkY,GAASR,EAASzB,aACpCyB,EAASzB,WAAazL,EAK1C,CAKA,oBAAA8M,GACI,MAAM9gB,EAAI3E,KAAK0E,UACT4hB,EAAQtmB,KAAKwa,IAAItU,IAEvBlG,KAAK4lB,8BACL,MAAMW,EAAe,IAAIllB,IAEzB,IAAK,MAAMH,KAASlB,KAAKya,YACrB,IAAK,MAAMoL,KAAY3kB,EAAMua,mBAAoB,CAC7C,MAAM,WAAE2I,EAAU,SAAE6B,GAAaJ,EACjC,GAAIA,EAAS1X,OAAS0X,EAASvB,WAAY,SAC3C,IAAKF,IAAe6B,EAAU,SAE9B,GAAIM,EAAa/kB,IAAI4iB,IAAemC,EAAa/kB,IAAIykB,GAAW,SAChEM,EAAa9kB,IAAI2iB,GACjBmC,EAAa9kB,IAAIwkB,GAGjB,MAAMO,EAAUpC,EAAWqC,KAAKH,GAC1BI,EAAQT,EAASQ,KAAKH,GAEtB5G,EAAS8G,EAAQG,GACjBtI,EAASmI,EAAQI,GACjBC,EAAOH,EAAMC,GACbG,EAAOJ,EAAME,GAEbhN,EAAO0M,EACRjF,KAAK,KAAK3B,KAAUrB,OAAYwI,KAAQC,KACxCtO,OAAO,CACJxT,OAAO,IAAAV,YAAW8f,EAAWphB,QAC7B6I,MAAOlH,EAAEoiB,uBAEZ/jB,KAAK,QACLwV,OAAO,CACJ3M,MAAOlH,EAAEoiB,qBAAuB/mB,KAAKwa,IAAI/J,YAE5CxC,KAAK,CACFyS,MAAQ1gB,KAAKoB,YAAgC2Z,gBAGrD,UACKnC,WAAWgB,EAAM,aAAc,CAC5BuM,SAAUN,EAAS1X,KACnB6Y,OAAQnB,EAAS5B,GACjBxf,SAAUzE,OAEb6Y,WAAWe,EAAM,CACb5Z,KAAKoB,YAAgC0Z,YACrC9a,KAAKoB,YAAgC6Z,iBAElD,CAER,CAMA,UAAAuK,GACI,IAAK,IAAI5L,KAAQ5Z,KAAKwQ,QAAQtK,IAAI6T,KAAK,IAAK/Z,KAAKoB,YAAgC2Z,iBAC7EnB,EAAK/T,SAET,IAAK,IAAIohB,KAAQjnB,KAAKwQ,QAAQtK,IAAI6T,KAAK,IAAK/Z,KAAKoB,YAAgC6Z,mBAC7EgM,EAAKphB,QAEb,CAIA,WAAAqhB,GAEI,UAAQlN,aAAcha,KAAKoB,YAAgC0Z,aAG3D9a,KAAKwa,IAAItU,IAAIihB,WAAWhkB,QAASe,IAC7B,MAAMkjB,EAAeljB,EAAGmjB,SAAUrnB,KAAKoB,YAAgC8Z,oBACjEoM,EAA4B,QAAnBpjB,EAAGd,KAAKmkB,QACjBC,EAAWtjB,EAAGujB,UAAUC,SAAS,UAAaC,kBAC/CP,GAAiBE,GAAWE,GAAUtjB,EAAG2B,WAIlD7F,KAAKya,YAAc,EACvB,CAKA,mBAAAmN,CAAoBvB,GAChB,IAAK,IAAInlB,KAASlB,KAAKya,YACnB,IAAK,IAAIoN,KAAS3mB,EAAMua,mBAChBoM,EAAM5B,UAAYI,EAAKhC,qBAChBwD,EAAM5B,SAEb4B,EAAMzD,YAAciC,EAAKhC,qBAClBwD,EAAMzD,UAI7B,CAOA,YAAA0D,CAAa1kB,GAET,MAAMmR,EAAMvU,KAAKya,YAAYsN,UAAUhT,GAAKA,EAAE9N,KAAO7D,EAAK6D,IAC1D,IAAa,IAATsN,EAAY,CACZ,MAAMrT,EAAQlB,KAAKya,YAAYlG,GAC/B,IAAK,IAAIyT,KAAe9mB,EAAOua,mBAC3Bzb,KAAK4nB,oBAAoBI,GAE7B9mB,EAAO2V,OAAOhR,SACd,UAAQmU,aAAa,QAAQ5W,EAAK6D,MAClCjH,KAAKya,YAAYwN,OAAO1T,EAAK,EACjC,CAUA,OAPAvU,KAAKif,UAAU7b,GACfpD,KAAKgH,WACLhH,KAAK2a,YAAYuE,MAAMlf,KAAKoD,KAAiBpD,KAAMA,KAAKkB,OACxDlB,KAAKmf,aAGLnf,KAAKqlB,wBACGjiB,EAAK8C,IAAwBgiB,QACzC,E,wBC7uCJ,SAASC,EAAQC,GACf,OAAe,KAAPA,GAAwB,KAAPA,GAAwB,OAAPA,GAA0B,OAAPA,GAEnD,KAAPA,GAAwB,IAAPA,GAAwB,KAAPA,GAAwB,KAAPA,GAAwB,MAAPA,GACpEA,GAAM,MAAUC,EAAeC,QAAQF,IAAO,CACnD,CAyBA,SAASG,EAAQC,GACf,OAAQA,GAAQ,IAAMA,GAAQ,EAChC,CAEA,SAASC,EAAaD,GACpB,OAAQA,GAAQ,IAAMA,GAAQ,IACb,KAATA,GACS,KAATA,GACS,KAATA,CACV,CAGA,SAASE,EAAMrH,GACbrhB,KAAK2oB,MAAS,EACd3oB,KAAKqhB,KAASA,EACdrhB,KAAK8M,IAASuU,EAAKhR,OACnBrQ,KAAK4oB,OAAS,GACd5oB,KAAK6oB,MAAS,EACd7oB,KAAK8oB,IAAS,GACd9oB,KAAK+oB,aAAe,EACpB/oB,KAAKkW,KAAS,EAChB,CAEA,SAAS8S,EAAW9nB,GAClB,KAAOA,EAAMynB,MAAQznB,EAAM4L,KAAOqb,EAAQjnB,EAAMmgB,KAAK4H,WAAW/nB,EAAMynB,SACpEznB,EAAMynB,OAEV,CAGA,SAASO,EAAShoB,GAChB,IAAIknB,EAAKlnB,EAAMmgB,KAAK4H,WAAW/nB,EAAMynB,OAErC,OAAW,KAAPP,GACFlnB,EAAM2nB,MAAQ,OACd3nB,EAAMynB,SAIG,KAAPP,GACFlnB,EAAM2nB,MAAQ,OACd3nB,EAAMynB,cAIRznB,EAAM4nB,IAAM,gDAAkD5nB,EAAMynB,MAAQ,IAC9E,CAGA,SAASQ,EAAUjoB,GACjB,IAOIknB,EAPA5b,EAAQtL,EAAMynB,MACdA,EAAQnc,EACRM,EAAM5L,EAAM4L,IACZsc,EAAY,EACZC,EAAa,EACbC,EAAa,EACbC,EAAS,EAGb,GAAIZ,GAAS7b,EACX5L,EAAM4nB,IAAM,iCAAmCH,EAAQ,SAazD,GARW,MAFXP,EAAKlnB,EAAMmgB,KAAK4H,WAAWN,KAEM,KAAPP,IAExBA,IADAO,EACc7b,EAAO5L,EAAMmgB,KAAK4H,WAAWN,GAAS,GAMjDJ,EAAQH,IAAc,KAAPA,EAApB,CAKA,GAAW,KAAPA,EAAoB,CAMtB,GALAgB,EAAoB,KAAPhB,EAGbA,IAFAO,EAEc7b,EAAO5L,EAAMmgB,KAAK4H,WAAWN,GAAS,EAEhDS,GAAaT,EAAQ7b,GAEnBsb,GAAMG,EAAQH,GAEhB,YADAlnB,EAAM4nB,IAAM,sEAAwEtc,EAAQ,KAKhG,KAAOmc,EAAQ7b,GAAOyb,EAAQrnB,EAAMmgB,KAAK4H,WAAWN,KAClDA,IACAU,EAAa,EAEfjB,EAAMO,EAAQ7b,EAAO5L,EAAMmgB,KAAK4H,WAAWN,GAAS,CACtD,CAEA,GAAW,KAAPP,EAAoB,CAGtB,IAFAmB,EAAS,EACTZ,IACOJ,EAAQrnB,EAAMmgB,KAAK4H,WAAWN,KACnCA,IACAW,EAAa,EAEflB,EAAMO,EAAQ7b,EAAO5L,EAAMmgB,KAAK4H,WAAWN,GAAS,CACtD,CAEA,GAAW,MAAPP,GAA6B,KAAPA,EAAoB,CAC5C,GAAImB,IAAWF,IAAeC,EAE5B,YADApoB,EAAM4nB,IAAM,2CAA6CH,EAAQ,KAUnE,GAHW,MADXP,IAFAO,EAEc7b,EAAO5L,EAAMmgB,KAAK4H,WAAWN,GAAS,IACnB,KAAPP,GACxBO,MAEEA,EAAQ7b,GAAOyb,EAAQrnB,EAAMmgB,KAAK4H,WAAWN,KAM/C,YADAznB,EAAM4nB,IAAM,2CAA6CH,EAAQ,KAJjE,KAAOA,EAAQ7b,GAAOyb,EAAQrnB,EAAMmgB,KAAK4H,WAAWN,KAClDA,GAMN,CAEAznB,EAAMynB,MAAQA,EACdznB,EAAM2nB,MAAQpa,WAAWvN,EAAMmgB,KAAKnU,MAAMV,EAAOmc,IAAU,CAxD3D,MAFEznB,EAAM4nB,IAAM,wDAA0DH,EAAQ,GA2DlF,CAGA,SAASa,EAAgBtoB,GACvB,IAAIuoB,EAAKC,EAQTA,GADAD,EAAQvoB,EAAMmgB,KAAKngB,EAAM6nB,eACbY,cAEZ,IAAIC,EAAS1oB,EAAMgV,KASnB,GAPc,MAAVwT,GAAiBE,EAAOvZ,OAAS,IACnCnP,EAAM0nB,OAAO1mB,KAAK,CAAEunB,EAAKG,EAAO,GAAIA,EAAO,KAC3CA,EAASA,EAAO1c,MAAM,GACtBwc,EAAQ,IACRD,EAAe,MAARA,EAAe,IAAM,KAGhB,MAAVC,EACFxoB,EAAM0nB,OAAO1mB,KAAK,CAAEunB,GAAMI,OAAOD,SAGjC,KAAOA,EAAOvZ,QAAUyZ,EAAYJ,KAClCxoB,EAAM0nB,OAAO1mB,KAAK,CAAEunB,GAAMI,OAAOD,EAAO3B,OAAO,EAAG6B,EAAYJ,MACzDI,EAAYJ,MAKvB,CAGA,SAASK,EAAY7oB,GACnB,IACI8oB,EAASC,EAAQC,EAAaC,EAAavZ,EAD3C9D,EAAM5L,EAAM4L,IAOhB,GAJA5L,EAAM6nB,aAAe7nB,EAAMynB,MAE3BsB,EAnLyB,KAAV,IAkLfD,EAAU9oB,EAAMmgB,KAAK4H,WAAW/nB,EAAMynB,SAtMxC,SAAmBH,GAEjB,OAAe,GAAPA,GACN,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,GACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,GACL,KAAK,IACH,OAAO,EAEX,OAAO,CACT,CAwLO4B,CAAUJ,GAYf,GAPAG,EAAcL,EAAY5oB,EAAMmgB,KAAKngB,EAAMynB,OAAOgB,eAElDzoB,EAAMynB,QACNK,EAAW9nB,GAEXA,EAAMgV,KAAO,GAERiU,EAAL,CAQA,IAFAD,EAAc,IAEL,CACP,IAAKtZ,EAAIuZ,EAAavZ,EAAI,EAAGA,IAAK,CAIhC,IAHIqZ,GAAiB,IAANrZ,GAAiB,IAANA,EACrBuY,EAAUjoB,GADqBgoB,EAAShoB,GAGzCA,EAAM4nB,IAAIzY,OAEZ,YADAmZ,EAAgBtoB,GAGlBA,EAAMgV,KAAKhU,KAAKhB,EAAM2nB,OAEtBG,EAAW9nB,GACXgpB,EAAc,EAEVhpB,EAAMynB,MAAQ7b,GAA8C,KAAvC5L,EAAMmgB,KAAK4H,WAAW/nB,EAAMynB,SACnDznB,EAAMynB,QACNK,EAAW9nB,GACXgpB,EAAc,EAElB,CAGA,IAAIA,EAAJ,CAIA,GAAIhpB,EAAMynB,OAASznB,EAAM4L,IACvB,MAIF,IAAK2b,EAAavnB,EAAMmgB,KAAK4H,WAAW/nB,EAAMynB,QAC5C,KARF,CAUF,CAEAa,EAAgBtoB,EAxChB,MAFEsoB,EAAgBtoB,QAbhBA,EAAM4nB,IAAM,wBAA0B5nB,EAAMmgB,KAAKngB,EAAMynB,OAAS,YAAcznB,EAAMynB,MAAQ,GAwDhG,CAhRA,IAAImB,EAAc,CAAEO,EAAG,EAAG1lB,EAAG,EAAGgZ,EAAG,EAAG2M,EAAG,EAAGlN,EAAG,EAAGmN,EAAG,EAAGC,EAAG,EAAGzV,EAAG,EAAGtB,EAAG,EAAGhI,EAAG,EAAGgf,EAAG,GAE/EpC,EAAiB,CACnB,KAAQ,KAAQ,KAAQ,KAAQ,KAAQ,KAAQ,KAAQ,KAAQ,KAChE,KAAQ,KAAQ,KAAQ,KAAQ,KAAQ,KAAQ,MAAQ,OAqR1DxoB,EAAOD,QAAU,SAAmB8qB,GAClC,IAAIxpB,EAAQ,IAAIwnB,EAAMgC,GAClB5d,EAAM5L,EAAM4L,IAIhB,IAFAkc,EAAW9nB,GAEJA,EAAMynB,MAAQ7b,IAAQ5L,EAAM4nB,IAAIzY,QACrC0Z,EAAY7oB,GAYd,OATIA,EAAM0nB,OAAOvY,SACX,KAAKiY,QAAQpnB,EAAM0nB,OAAO,GAAG,IAAM,GACrC1nB,EAAM4nB,IAAM,+CACZ5nB,EAAM0nB,OAAS,IAEf1nB,EAAM0nB,OAAO,GAAG,GAAK,KAIlB,CACLE,IAAK5nB,EAAM4nB,IACX6B,SAAUzpB,EAAM0nB,OAEpB,C,wKCnTA,kBACA,aAEMpgB,EAAS,CACXC,QAAS,UACTC,KAAM,WAGV,UAAeF,C,4ECaf,UARA,SAAsBuM,GACrB,OAAOA,EAAE/G,QAAQ,QAAS,KACvBA,QAAQ,QAAS,KACjBA,QAAQ,UAAW,KACnBA,QAAQ,UAAW,KACnBA,QAAQ,SAAU,IACtB,C,wKClBA,mBACA,SAyCA,MAAMzE,EACF3G,UACAN,UACA0T,OACAnK,MACAC,OACAvJ,QACA9B,KACAwG,GACA2jB,QACAC,wBAA0B,EAC1B,WAAAzpB,CAAYwB,EAAmCgoB,EAAyB,CAAEnqB,KAAM,YAAY8I,EAAOuhB,wBAC/F9qB,KAAK4C,UAAYA,EACjB5C,KAAKgW,OAAS4U,EAAQ5U,QAAU,IAAI,UAAY,EAAG,GACnDhW,KAAK6L,MAAQ+e,EAAQ/e,OAAS,IAC9B7L,KAAK8L,OAAS8e,EAAQ9e,QAAU,IAChC9L,KAAKuC,QAAU,EACfvC,KAAKS,KAAOmqB,EAAQnqB,KACpBT,KAAKiH,IAAK,IAAAqO,aAAY,SAAU,CAAEpB,SAAU,6EAC5ClU,KAAK4qB,QAAUA,EACf5qB,KAAKsC,UAAYG,SAASC,cAAc,OACxC1C,KAAKsC,UAAUK,UAAYioB,EAAQjoB,WAAa,cAChD3C,KAAKsC,UAAU8B,MAAM2B,SAAW,WAChC/F,KAAKsC,UAAU8B,MAAMkB,KAAO,GAAGtF,KAAKgW,OAAO1P,MAC3CtG,KAAKsC,UAAU8B,MAAMoB,IAAM,GAAGxF,KAAKgW,OAAOxP,MAC1CxG,KAAKsC,UAAU8B,MAAMyH,MAAQ,GAAG7L,KAAK6L,UACrC7L,KAAKsC,UAAU8B,MAAM0H,OAAS,GAAG9L,KAAK8L,WACtC9L,KAAKsC,UAAU8B,MAAM2H,WAAa,wBAClC/L,KAAKsC,UAAU8B,MAAM2mB,OAAS,iBAC9B/qB,KAAKsC,UAAU8B,MAAM8H,aAAe,MACpClM,KAAKsC,UAAU8B,MAAM+H,UAAY,4BACjCnM,KAAKsC,UAAU8B,MAAM4B,cAAgB,OACrChG,KAAKsC,UAAU8B,MAAM4mB,OAAS,OAE1BJ,EAAQK,OAAMjrB,KAAKsC,UAAU8E,UAAYwjB,EAAQK,MAEhDjrB,KAAK4C,UAAU8S,YAAa1V,KAAK4C,UAA2BC,OAAOC,YAAY9C,KAAKsC,WACzFtC,KAAKmH,YACuB,IAAjByjB,EAAQxP,MAAwBwP,EAAQxP,MAC/CwP,EAAQxP,KAAKpb,KAAMA,KAAKsC,UAEhC,CAGA,IAAAmB,GACIzD,KAAKsC,UAAU8B,MAAM8C,QAAU,QAC/BlH,KAAKuC,QAAU,CACnB,CAGA,IAAA4E,GACInH,KAAKsC,UAAU8B,MAAM8C,QAAU,OAC/BlH,KAAKuC,QAAU,CACnB,CAGA,SAAA2oB,CAAUlV,GACNhW,KAAKgW,OAASA,EACdhW,KAAKsC,UAAU8B,MAAMkB,KAAO,GAAG0Q,EAAO1P,MACtCtG,KAAKsC,UAAU8B,MAAMoB,IAAM,GAAGwQ,EAAOxP,KACzC,CAGA,OAAA2kB,CAAQF,GACJjrB,KAAKsC,UAAU8E,UAAY6jB,CAC/B,CAEA,SAAAG,GACIprB,KAAKsC,UAAYG,SAASC,cAAc,OACxC1C,KAAKsC,UAAUK,UAAY3C,KAAK4qB,QAAQjoB,WAAa,cACrD3C,KAAKsC,UAAU8B,MAAM2B,SAAW,WAChC/F,KAAKsC,UAAU8B,MAAMkB,KAAO,GAAGtF,KAAKgW,OAAO1P,MAC3CtG,KAAKsC,UAAU8B,MAAMoB,IAAM,GAAGxF,KAAKgW,OAAOxP,MAC1CxG,KAAKsC,UAAU8B,MAAMyH,MAAQ,GAAG7L,KAAK6L,UACrC7L,KAAKsC,UAAU8B,MAAM0H,OAAS,GAAG9L,KAAK8L,WACtC9L,KAAKsC,UAAU8B,MAAM2H,WAAa,wBAClC/L,KAAKsC,UAAU8B,MAAM2mB,OAAS,iBAC9B/qB,KAAKsC,UAAU8B,MAAM8H,aAAe,MACpClM,KAAKsC,UAAU8B,MAAM+H,UAAY,4BACjCnM,KAAKsC,UAAU8B,MAAM4B,cAAgB,OACrChG,KAAKsC,UAAU8B,MAAM4mB,OAAS,OAE1BhrB,KAAK4qB,QAAQK,OAAMjrB,KAAKsC,UAAU8E,UAAYpH,KAAK4qB,QAAQK,MAC3DjrB,KAAK4C,UAAU8S,aAElB1V,KAAK4C,UAA2BC,OAAOC,YAAY9C,KAAKsC,WACzDtC,KAAK4C,UAAUyoB,eAAerrB,MAClC,CAEA,OAAAsrB,GACItrB,KAAKsC,UAAUuD,SACf7F,KAAK4C,UAAU2oB,iBAAiBvrB,KACpC,EAGJ,UAAeuJ,C,4ECpIf,gBACS2P,GACAsS,UAA4B,GAC5BC,UAA4B,GAC5BC,YAAuB,EAE/B,WAAAtqB,CAAY8X,GACXlZ,KAAKkZ,GAAKA,CACX,CAEA,UAAAyS,GACC,IAAK3rB,KAAK0rB,YAAa,OACvB,IAAK1rB,KAAKkZ,GAAG0S,cAAe,OAE5B,MAAM1qB,EAAQlB,KAAKkZ,GAAGnD,OAAS/V,KAAKkZ,GAAGnD,OAAO,GAAQ,CAAC,EACvD/V,KAAKwrB,UAAUtpB,KAAK,CAAEhB,UACtBlB,KAAKyrB,UAAUpb,OAAS,CAGzB,CAEA,IAAAwb,GAGC,GAAI7rB,KAAKwrB,UAAUnb,QAAU,EAE5B,OAGD,MAAMyb,EAAU9rB,KAAKwrB,UAAUO,MAGzBC,EAAOhsB,KAAKwrB,UAAUxrB,KAAKwrB,UAAUnb,OAAS,GAG/C2b,IAKLhsB,KAAK0rB,YAAc,EACnB1rB,KAAKkZ,GAAGjD,WAAW+V,EAAK9qB,OACxBlB,KAAK0rB,YAAc,EAEnB1rB,KAAKyrB,UAAUvpB,KAAK4pB,GAErB,CAEA,IAAAG,GAGC,MAAMC,EAAQlsB,KAAKyrB,UAAUM,MACxBG,IAOLlsB,KAAK0rB,YAAc,EACnB1rB,KAAKkZ,GAAGjD,WAAWiW,EAAMhrB,OACzBlB,KAAK0rB,YAAc,EAEnB1rB,KAAKwrB,UAAUtpB,KAAKgqB,GAErB,CAEA,KAAAhpB,GACClD,KAAKwrB,UAAY,GACjBxrB,KAAKyrB,UAAY,EAElB,CAEA,OAAAU,GACC,OAAOnsB,KAAKwrB,UAAUnb,OAAS,CAChC,CAEA,OAAA+b,GACC,OAAOpsB,KAAKyrB,UAAUpb,OAAS,CAChC,E,wKCrFD,gBACA,UACA,aAeA,UAVA,WACI,IACI,MAAM6I,EAAK,IAAI,UAEf,OADA,IAAA5O,kBAAiB4O,GACVA,CACX,CAAE,MAAOlV,GACL,IAAI,EAAAmG,UAAU,mCAAoCnG,EAAYqoB,WAAWvD,KAC7E,CACJ,C,wBCAA,SAASwD,EAAQC,EAAIC,EAAIC,GACvB,KAAMzsB,gBAAgBssB,GAAY,OAAO,IAAIA,EAAQC,EAAIC,EAAIC,GAC7DzsB,KAAKusB,GAAKA,EACVvsB,KAAKwsB,GAAKA,EACVxsB,KAAKysB,GAAKA,CACZ,CAdA,IAAIC,EAAU,MAIVC,EAAQlgB,KAAKmgB,GAAK,IAmBtBN,EAAQ3rB,UAAU+W,UAAY,SAAU0F,GAItC,IAAIzY,EAAI8H,KAAKogB,IAAI7sB,KAAKysB,GAAKE,GAAQ5X,EAAItI,KAAKqgB,IAAI9sB,KAAKysB,GAAKE,GACtDI,EAAK,CACP/sB,KAAKusB,IAAMnP,EAAE,GAAGzY,EAAIyY,EAAE,GAAGrI,GACzB/U,KAAKusB,IAAMnP,EAAE,GAAGzY,EAAIyY,EAAE,GAAGrI,GACzB/U,KAAKwsB,KAAOpP,EAAE,GAAGrI,EAAIqI,EAAE,GAAGzY,GAC1B3E,KAAKwsB,KAAOpP,EAAE,GAAGrI,EAAIqI,EAAE,GAAGzY,IAMxBqoB,EAAID,EAAG,GAAGA,EAAG,GAAKA,EAAG,GAAGA,EAAG,GAC3BE,EAAIF,EAAG,GAAGA,EAAG,GAAKA,EAAG,GAAGA,EAAG,GAG3BG,IAAMH,EAAG,GAAGA,EAAG,KAAKA,EAAG,GAAGA,EAAG,KAAOA,EAAG,GAAGA,EAAG,KAAKA,EAAG,GAAGA,EAAG,OACrDA,EAAG,GAAGA,EAAG,KAAKA,EAAG,GAAGA,EAAG,KAAOA,EAAG,GAAGA,EAAG,KAAKA,EAAG,GAAGA,EAAG,KAG3DI,GAAMH,EAAIC,GAAK,EAGnB,GAAIC,EAAIR,EAAUS,EAIhB,OAFAntB,KAAKusB,GAAKvsB,KAAKwsB,GAAK/f,KAAK2gB,KAAKD,GAC9BntB,KAAKysB,GAAK,EACHzsB,KAIT,IAAIqtB,EAAIN,EAAG,GAAGA,EAAG,GAAKA,EAAG,GAAGA,EAAG,GAK3BO,EAAKH,GAHTD,EAAIzgB,KAAK2gB,KAAKF,IAGE,EACZK,EAAKJ,EAAKD,EAAE,EAyBhB,OAtBAltB,KAAKysB,GAAMhgB,KAAK+gB,IAAIH,GAAKX,GAAWjgB,KAAK+gB,IAAIF,EAAKL,GAAKP,EACrD,GAMI,IAJJjgB,KAAKghB,KAAKhhB,KAAK+gB,IAAIH,GAAK5gB,KAAK+gB,IAAIF,EAAKL,IACnCK,EAAKN,GAAKK,EAEXA,GAAKC,EAAKL,IACFxgB,KAAKmgB,GAIb5sB,KAAKysB,IAAM,GAEbzsB,KAAKusB,GAAK9f,KAAK2gB,KAAKE,GACpBttB,KAAKwsB,GAAK/f,KAAK2gB,KAAKG,KAGpBvtB,KAAKysB,IAAM,GACXzsB,KAAKusB,GAAK9f,KAAK2gB,KAAKG,GACpBvtB,KAAKwsB,GAAK/f,KAAK2gB,KAAKE,IAGfttB,IACT,EAIAssB,EAAQ3rB,UAAU+sB,aAAe,WAC/B,OAAQ1tB,KAAKusB,GAAKG,EAAU1sB,KAAKwsB,IAAMxsB,KAAKwsB,GAAKE,EAAU1sB,KAAKusB,EAClE,EAEA1sB,EAAOD,QAAU0sB,C,wKCvGjB,mBAQA,MAAMqB,UAAwB,UAC1B,WAAAvsB,CAAYkF,EAAI,EAAGE,EAAI,GACnBonB,MAAMtnB,EAAGE,EACb,EAEJ,UAAemnB,C,wKCZf,mBACA,UAGA,aACA,aACA,aACA,UACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,UACA,aAEA,aACA,aAEA,aACA,aAEA,UAoCA,MAAMjjB,UAAqB,UACvB,2BAAWid,GACP,MAAO,yBACX,CAIAkG,MAIAC,KAEAC,QAGAjW,QAGAkW,MAGAnrB,OAGAqD,IAEA+nB,gBAEAxpB,SAGAmmB,QAGAsD,SAIAC,WAIA3rB,QAIA4rB,UAKAC,SAIAC,WAIAC,QAIA3C,cAAyB,EAIzB4C,oBAIAC,SAAoB,EAIpBC,cAEAC,UAA+B,KAO/B,WAAAvtB,CAAY1B,EAAmBkvB,EAAoBhE,GAC/CgD,QACA5tB,KAAK0V,WAAa,EAClBkZ,EAAMxqB,MAAMyH,MAAQ,OACpB+iB,EAAMxqB,MAAM0H,OAAS,OAErB9L,KAAKguB,MAAQtuB,EACbM,KAAK6C,OAAS+rB,EACd5uB,KAAKkG,KAAM,IAAA6C,OAAM8lB,MAAM7uB,KAAK6C,QAAQ2K,KAAK,OAAQ,QACjDxN,KAAK4qB,QAAUA,EACf,IAAIkE,EAA0B,EAAA9jB,KAAK+jB,QAAQnE,EAAQnmB,UACnDzE,KAAKyE,SAAW,IAAIqqB,EAAO9uB,KAAMA,KAAK4qB,QAAQoE,mBAAqB,CAAC,GAEpE,MAAMC,EAAqC,iBAAlBrE,EAAQiD,OAAsBjD,EAAQiD,SAAS,UAClEjD,EAAQiD,MACR,UAEAA,EAAkC,iBAAlBjD,EAAQiD,OAAsBjD,EAAQiD,MACtDjD,EAAQiD,MACR,UAAOoB,GAETjvB,KAAK4qB,QAAQpoB,UACbxC,KAAKwC,QAAU,IAAI,UAAQxC,OAG/BA,KAAK+tB,QAAU,IAAI,UAAgB,EAAG,GACtC/tB,KAAK8X,QAAU,IAAIxW,IACnBtB,KAAKkuB,SAAW,EAChBluB,KAAKmuB,WAAa,IAAKvD,EAAQsE,YAtIvC,SAA2BtE,GACvB,OAAIA,GAASuE,UACLvE,GAASuE,SAASC,KACX,UAGR,SACX,CA+HqDC,CAAkBzE,IAAU5qB,MACzEA,KAAKouB,UAAY,IAAI9sB,IACrBtB,KAAKquB,SAAW,IAAI,UAAgBruB,MACpCA,KAAKsuB,WAAa,IAAIjtB,IACtBrB,KAAKuuB,QAAU,IAAI,UAAgBvuB,MACnCA,KAAKwuB,oBAAsB,GAC3BxuB,KAAK0uB,cAAgB,GACQ,GAAzB9D,EAAQ0E,cACRtvB,KAAKuuB,QAAQ5C,aAEjB3rB,KAAK6tB,MAAQ,CAAC,EACd7tB,KAAKuvB,kBAELvvB,KAAKwvB,SAAS3B,EAClB,CACA,QAAA2B,CAAS3B,GACL,IACI7tB,KAAK6tB,MAAQ4B,gBAAgB5B,EACjC,CAAE,MACE7tB,KAAK6tB,MAAQntB,OAAOib,OAAO,CAAC,EAAGkS,EACnC,CAEI7tB,KAAKwC,SAASxC,KAAKwC,QAAQktB,aAAa1vB,KAAK6tB,OAC7C7tB,KAAK6tB,MAAMniB,UACX1L,KAAKiuB,gBAAgBjrB,MAAK,IAAAsB,YAAWtE,KAAK6tB,MAAMniB,SAASC,kBAAoB,YAErF,CAIA,WAAIgkB,GAAY,OAAO3vB,KAAKyuB,QAAU,CACtC,WAAIkB,CAAQpa,GACRvV,KAAKyuB,SAAWlZ,EACZA,IACA,aAAW,EAAG,KAAQvV,KAAKyuB,SAAW,GAE9C,CAMA,YAAAmB,CAAahG,GAST,IAAKA,EAAOxmB,KAER,YADApD,KAAK2uB,UAAY,MAIrB,MAAM,KACFvrB,EAAI,OACJsc,EAAM,OACNrB,EAAM,SACNwR,EAAQ,SACRC,EAAQ,QACRrO,EAAU,EAAC,QACXtB,EAAU,GACVyJ,EAEJ5pB,KAAK2uB,UAAY,CACboB,WAAY,EACZ3sB,OACAsc,SACArB,SACAoD,UACAtB,UACA6P,MAAOH,EACPI,MAAOH,EACPI,OAAQL,EAAWnQ,EACnByQ,OAAQL,EAAWzR,EAE3B,CACA,SAAA+R,CAAUhtB,EAAesc,EAAgBrB,EAAgBoD,EAAkB,EAAGtB,EAAkB,GAC5FngB,KAAK2uB,UAAY,CACboB,WAAY,EACZ3sB,OACAsc,SACArB,SACAoD,UACAtB,UACA6P,MAAOtQ,EACPuQ,MAAO5R,EACP6R,OAAQ,EACRC,OAAQ,EAEhB,CAOA,UAAAE,CAAWR,EAAkBC,GACpB9vB,KAAK2uB,WAAc3uB,KAAK2uB,UAAUvrB,OAEvCpD,KAAK2uB,UAAUqB,MAAQH,EACvB7vB,KAAK2uB,UAAUsB,MAAQH,EACvB9vB,KAAK2uB,UAAUuB,OAASL,EAAW7vB,KAAK2uB,UAAUjP,OAClD1f,KAAK2uB,UAAUwB,OAASL,EAAW9vB,KAAK2uB,UAAUtQ,OACtD,CACA,OAAAiS,GAEQtwB,KAAK2uB,YAAW3uB,KAAK2uB,UAAUoB,WAAa,EACpD,CAMA,iBAAAQ,GACIvwB,KAAK0uB,cAAcvrB,QAAQa,GAAKA,IACpC,CAMA,eAAAwsB,CAAgBC,GAEZ,OADAzwB,KAAK0uB,cAAcxsB,KAAKuuB,GACjB,KACHzwB,KAAK0wB,mBAAmBD,GAEhC,CAKA,kBAAAC,CAAmBD,GACfzwB,KAAK0uB,cAAgB1uB,KAAK0uB,cAAcxW,OAAOlU,GAAKA,GAAKysB,EAC7D,CAKA,UAAA9E,GACI3rB,KAAKuuB,QAAQ5C,YACjB,CAQA,aAAAgF,CAAcpb,GACVvV,KAAKwuB,oBAAoBtsB,KAAKlC,KAAK4rB,eACnC5rB,KAAK4rB,cAAgBrW,CACzB,CAMA,eAAAqb,GAC2C,GAAnC5wB,KAAKwuB,oBAAoBne,QAAerQ,KAAKwuB,oBAAoBne,OAAS,IAC9ErQ,KAAK4rB,cAAgB5rB,KAAKwuB,oBAAoBzC,MAClD,CAKA,eAAAwD,GACI,IACIvvB,KAAKiuB,gBAAkBjuB,KAAKkG,IAAID,KAAKjG,KAAKkG,IAAI2F,QAAS7L,KAAKkG,IAAI4F,UAC3D9I,MAAK,IAAAsB,YAAWtE,KAAK6tB,MAAMniB,UAAUC,kBAAoB,YACzDmL,SAASpM,EAAaid,kBACtBkH,MAAM7uB,KAAKkG,KAGhBlG,KAAKkG,IAAIzE,IAAIzB,KAAKiuB,gBAGtB,CAAE,MAAOjqB,GACL6sB,QAAQC,MAAM9sB,EAClB,CACIhE,KAAK4qB,QAAQkD,OACb9tB,KAAK8tB,KAAO,IAAI,UAAK9tB,KAAMA,KAAKkG,IAAKlG,KAAK4qB,QAAQkD,OAEtD9tB,KAAKiuB,iBAAiBvV,MAC1B,CAIA,0BAAAqY,GACI/wB,KAAK8tB,MAAMkD,oBACX,IACIhxB,KAAKiuB,gBAAgBvV,MACzB,CAAE,MAAO1U,GACL6sB,QAAQC,MAAM9sB,EAClB,CACJ,CAMA,OAAAyM,GACI,OAAOzQ,KAAKmuB,WAAW1d,SAC3B,CAIA,eAAAyU,GACIllB,KAAKyE,SAASygB,iBAClB,CAKA,WAAArN,GACI,OAAO3J,MAAMC,KAAKnO,KAAKsuB,WAC3B,CAKA,SAAA2C,CAAUC,GACN,MAAMlZ,EAAI,IAAI,UAAQkZ,EAAQvwB,UAAWX,MACzCgY,EAAEoD,OACFpD,EAAEmZ,SAASD,GACXlxB,KAAKsR,QACT,CAKA,cAAA+Z,CAAe+F,GACXpxB,KAAKouB,UAAUpsB,IAAIovB,EAAKnqB,GAAImqB,EAChC,CAKA,gBAAA7F,CAAiB6F,GACbpxB,KAAKouB,UAAUxsB,OAAOwvB,EAAKnqB,GAC/B,CAMA,SAAAoqB,CAAU/tB,GACN,MAAMwR,EAAO,UAAiBxR,GAC9B,IAAKwR,EAAM,OACX,GAAIA,EAAKjN,IAAK,CACV,MAAMupB,EAAO,IAAKtc,EAAQ,IAAE9U,KAAM8U,GAElC,OADA9U,KAAKqrB,eAAe+F,GACbA,CACX,CACA,MAAMA,EAAO,IAAI,UAAOpxB,KAAM8U,GAE9B,OADA9U,KAAKqrB,eAAe+F,GACbA,CACX,CAMA,SAAAE,CAAUrqB,GACN,GAAIjH,KAAKouB,UAAU5sB,IAAIyF,GAAK,OAAOjH,KAAKouB,UAAUnsB,IAAIgF,EAE1D,CAKA,cAAAsqB,GACI,MAAM7jB,EAAO1N,KAAKkG,IAAIwH,OACtB,MAAO,CAAE7B,MAAO6B,EAAK7B,MAAOC,OAAQ4B,EAAK5B,OAC7C,CAKA,OAAA0lB,GACI,MAAMvrB,EAAOjG,KAAK6C,OAAOsD,wBACzB,MAAO,CAAE0F,MAAO5F,EAAK4F,MAAOC,OAAQ7F,EAAK6F,OAC7C,CAMA,OAAA2lB,GACIzxB,KAAKyE,SAAS4gB,wBACdrlB,KAAK+wB,4BACT,CAGA,YAAAW,GACI,IAAK,IAAKC,EAAQ1X,KAAMja,KAAK8X,QACzB9X,KAAKgH,SAAS2qB,EAEtB,CAGA,MAAArgB,GACQtR,KAAKkuB,WACTluB,KAAKyE,SAASyiB,cACdlnB,KAAK0xB,eACL1xB,KAAKyxB,UACLzxB,KAAKyE,SAASkR,gBACd3V,KAAKyE,SAASmR,eAClB,CAQA,iBAAAqD,CAAkB2Y,EAAeC,GAC7B,MAAMthB,EAAOvQ,KAAKyQ,UAIlB,MAAO,CAAEnK,GAFEsrB,EAAQ5xB,KAAK+tB,QAAQznB,GAAKiK,EAEzB/J,GADDqrB,EAAQ7xB,KAAK+tB,QAAQvnB,GAAK+J,EAEzC,CAQA,iBAAA7J,CAAkBorB,EAAiBC,GAC/B,MAAMxhB,EAAOvQ,KAAKyQ,UAGlB,MAAO,CAAEnK,EAFKwrB,EAAUvhB,EAAOvQ,KAAK+tB,QAAQznB,EAEzBE,EADLurB,EAAUxhB,EAAOvQ,KAAK+tB,QAAQvnB,EAEhD,CAOA,QAAAQ,CAASC,GACL,OAAOjH,KAAKyE,SAASqjB,aAAa9nB,KAAK8X,QAAQ7V,IAAIgF,GACvD,CAOA,OAAA+qB,CAAQ5uB,EAAeuuB,GACnB,IAAI1qB,EAAK0qB,GAAUvuB,EAAK6D,GACpBjH,KAAK8X,QAAQtW,IAAIyF,IACjB4pB,QAAQoB,KAAK,gBAAgBhrB,kCAE7B7D,EAAKR,YAAc5C,OACnBoD,EAAKR,UAAY5C,MAErBA,KAAK8X,QAAQ9V,IAAIiF,EAAI7D,GACrBpD,KAAKgH,SAASC,GACdjH,KAAKuuB,QAAQ5C,YAEjB,CAMA,OAAAuG,CAAQ5uB,EAAmC7B,EAAe,GACtD,IAAK,UAAe6B,GAAO,OAC3B,MAAMF,GAAO,aAAgBE,GAC7B,OAAKF,GACD3B,GAAKzB,KAAKgyB,QAAQ5uB,GACfA,QAFP,CAGJ,CAQA,OAAAwD,CAAQtD,EAAmCgD,EAAWE,GAClD,MAAMpD,EAAOpD,KAAKkyB,QAAQ5uB,EAAM,GAChC,GAAKF,EAIL,OAHAA,EAAKgS,eAAepT,IAAIsE,EAAGE,GAC3BxG,KAAKgyB,QAAQ5uB,GACbpD,KAAKgH,SAAS5D,EAAK6D,IACZ7D,CACX,CAIA,SAAA+uB,CAAU/uB,GAEN,MAAM4oB,EAAO5oB,EAAK+gB,oBAAoBW,YAClCkH,aAAgB,UAChBA,EAAKhH,gBAAgBoN,eACdpG,aAAgB,EAAAqG,kBAAoBrG,EAAKrI,kBAChDqI,EAAKsG,aAIT,MAAMC,EAAOnvB,EAAK4hB,gBAAgBd,UAC9BqO,aAAgB,WAChBA,EAAKpO,oBAAoBqO,iBAI7B,IAAK,IAAI7V,KAASvZ,EAAKsb,YACd/B,EAA2BgH,oBAC3BhH,EAA2B2V,YAGxC,CAKA,cAAAG,CAAexrB,GACX,MAAM7D,EAAOpD,KAAK8X,QAAQ7V,IAAIgF,GACzB7D,IAELpD,KAAKmyB,UAAU/uB,GACfpD,KAAK8X,QAAQlW,OAAOqF,GACpBjH,KAAKsR,SACLtR,KAAKuuB,QAAQ5C,aAEjB,CAOA,UAAA+G,CAAWtvB,GACFA,GACLpD,KAAKyyB,eAAervB,EAAK6D,GAC7B,CAOA,OAAAmY,CAAQnY,GACJ,OAAIA,aAAc,UAAgBA,EAC3BjH,KAAK8X,QAAQ7V,IAAIgF,EAC5B,CAOA,GAAA0rB,CAAIC,EAAYC,GACZ7yB,KAAKmuB,WAAWwE,IAAIC,EAAIC,EAC5B,CAQA,UAAAC,GACI,MAAMC,EAAQ,IAAI,UAAa/yB,MAG/B,OAFAA,KAAKsuB,WAAW7sB,IAAIsxB,GACpB/yB,KAAKgzB,iBACED,CACX,CAKA,UAAA9a,CAAWhR,GACP,OAAOiH,MAAMC,KAAKnO,KAAKsuB,YAAYvU,KAAK/V,GAAKA,EAAEiD,KAAOA,EAC1D,CAKA,aAAAgsB,CAAcC,GACV,IAAInjB,EAQJ,OALIA,EADuB,iBAAhBmjB,EACGlzB,KAAKiY,WAAWib,GAEhBA,EAGTnjB,GAEL/P,KAAKsuB,WAAW1sB,OAAOmO,GACvB/P,KAAKgzB,iBACE,GAJc,CAKzB,CAIA,cAAAA,GACIhzB,KAAKyE,SAASkR,gBACd3V,KAAKyE,SAASmR,cAClB,CAKA,QAAAK,CAASkd,EAA2CC,EAA0B,GAC1EpzB,KAAK2wB,cAAc,GAEnB,IAAK,IAAK1W,EAAG7W,KAASpD,KAAK8X,QAAQub,UAC/BrzB,KAAK0yB,WAAWtvB,GAEpB,GAAI+vB,EAAKG,SACL,IAAK,IAAIlwB,KAAQ+vB,EAAKlwB,MAClB,UAAQswB,YAAYnwB,EAAMpD,WAG9B,IAAK,IAAIoD,KAAQ+vB,EAAKlwB,MAClB,UAAQgT,SAAS7S,EAAMpD,MAI/BA,KAAK4wB,kBAGDwC,GAAkBpzB,KAAK4rB,eACvB5rB,KAAKuuB,QAAQ5C,YAErB,CAKA,MAAA5V,CAAOud,GACH,MAAMrwB,EAAQ,GACd,GAAIqwB,EACA,IAAK,IAAKrsB,EAAI7D,KAASpD,KAAK8X,QACpB1U,EAAKowB,UACLvwB,EAAMf,KAAKkB,EAAKqwB,kBAIxB,IAAK,IAAKxsB,EAAI7D,KAASpD,KAAK8X,QACpB1U,EAAKowB,UACLvwB,EAAMf,KAAKkB,EAAK2S,UAK5B,MAAO,CACHud,WACArwB,QAER,EAGJ,UAAeyH,C,4ECztBf,sBAA2B1F,GAC1B,GAAqB,iBAAVA,EAAoB,CAC9B,GAAIA,EAAM0uB,WAAW,KAAM,CAE1B,IAAIzgB,EAAMjO,EAAMkI,MAAM,GAEtB,OADmB,IAAf+F,EAAI5C,SAAc4C,EAAMA,EAAI0gB,MAAM,IAAIhf,IAAIhQ,GAAKA,EAAIA,GAAGiQ,KAAK,KACxD,IAAI3B,GACZ,CAAO,CAEN,MAAMwK,EAAQzY,EAAM2uB,MAAM,KAAKhf,IAAII,GAAK6e,SAAS7e,EAAE8e,OAAQ,KAC3D,GAAqB,IAAjBpW,EAAMpN,OAAc,MAAM,IAAI+D,MAAM,uBAAuBpP,KAC/D,MAAOulB,EAAG3X,EAAGI,GAAKyK,EACT,OAAM8M,GAAU,IAALA,IAAa3X,GAAU,IAALA,IAAaI,GAAW,IAANA,GAC3C6d,QAAQoB,KACJ,qBAEG,QAEb,IAAI1H,EAAErX,SAAS,IAAIC,SAAS,EAAG,OAAOP,EAAEM,SAAS,IAAIC,SAAS,EAAG,OAAOH,EAC7EE,SAAS,IACTC,SAAS,EAAG,MACf,CACD,CAAO,GAAIjF,MAAM4lB,QAAQ9uB,GAAQ,CAEhC,MAAOulB,EAAG3X,EAAGI,GAAKhO,EAClB,MAAO,IAAIulB,EAAErX,SAAS,IAAIC,SAAS,EAAG,OAAOP,EAAEM,SAAS,IAAIC,SAAS,EAAG,OAAOH,EAC7EE,SAAS,IACTC,SAAS,EAAG,MACf,CAAO,CAEN,MAAM,EAAEoX,EAAC,EAAE3X,EAAC,EAAEI,GAAMhO,EACpB,MAAO,IAAIulB,EAAErX,SAAS,IAAIC,SAAS,EAAG,OAAOP,EAAEM,SAAS,IAAIC,SAAS,EAAG,OAAOH,EAC7EE,SAAS,IACTC,SAAS,EAAG,MACf,CACD,C,wKCnCA,uBAA4BtH,EAAeC,EAAgB2M,GAE1D,MAAO,UADPA,EAAShM,KAAKC,IAAI+L,EAAQ5M,EAAQ,EAAGC,EAAS,cAG1CD,EAAQ4M,WACRA,KAAUA,WAAgB5M,KAAS4M,WACnC3M,EAAS2M,WACTA,KAAUA,WAAgB5M,EAAQ4M,KAAU3M,WAC5C2M,WACAA,KAAUA,aAAkB3M,EAAS2M,WACrCA,WACAA,KAAUA,WAAgBA,iBAE5BzK,QAAQ,OAAQ,KAAK6lB,MACxB,EAGA,sBAA2BhoB,EAAeC,EAAgB2M,GACzD,MAAMsb,EAAQloB,EAAQ,EAEtB,MAAO,UACHkoB,aACAloB,GAHJ4M,EAAShM,KAAKC,IAAI+L,EAAQsb,EAAOjoB,EAAS,OAGpBA,EAAS2M,WAC3BA,KAAUA,WAAgB5M,EAAe,EAAP4M,KAAY3M,WACvC,EAAP2M,KAAY3M,WACZ2M,KAAUA,WAAgBA,KAAU3M,EAAS2M,eAE/CzK,QAAQ,OAAQ,KAAK6lB,MACxB,EAGA,kBAAuBpb,GACtB,MAAO,UACHA,aACAA,KAAUA,YAAiBA,aAC3BA,KAAUA,WAAgBA,iBAE5BzK,QAAQ,OAAQ,KAAK6lB,MACxB,EAGA,mBAAwBtH,EAAYC,GACnC,MAAO,UACHD,aACAA,KAAMC,YAAaD,aACnBA,KAAMC,WAAYD,iBAEpBve,QAAQ,OAAQ,KAAK6lB,MACxB,EAGA,gBAAqBpb,EAAgBub,EAAiB,GACrD,GAAIA,EAAS,EAAG,MAAM,IAAI5f,MAAM,oCAChC,IAAIiN,EAAO,GACX,MAAM4S,EAAkB,EAAVxnB,KAAKmgB,IAAoB,EAAToH,GAC9B,IAAK,IAAIpjB,EAAI,EAAGA,EAAa,EAATojB,EAAYpjB,IAAK,CACpC,MAAM2Z,EAAI3Z,EAAI,GAAM,EAAI6H,EAASA,EAAS,EACpCnS,EAAIikB,EAAI9d,KAAKqgB,IAAIlc,EAAIqjB,GACrBztB,GAAK+jB,EAAI9d,KAAKogB,IAAIjc,EAAIqjB,GAC5B5S,GAAc,IAANzQ,EAAU,IAAItK,KAAKE,IAAM,KAAKF,KAAKE,GAC5C,CAEA,OADA6a,GAAQ,KACDA,CACR,EAGA,mBAAwB5I,EAAgByb,EAAgB,GACvD,GAAIA,EAAQ,EAAG,MAAM,IAAI9f,MAAM,sCAC/B,IAAIiN,EAAO,GACX,MAAM4S,EAAkB,EAAVxnB,KAAKmgB,GAAUsH,EAC7B,IAAK,IAAItjB,EAAI,EAAGA,EAAIsjB,EAAOtjB,IAAK,CAC/B,MAAMtK,EAAImS,EAAShM,KAAKogB,IAAIjc,EAAIqjB,EAAOxnB,KAAKmgB,GAAK,GAC3CpmB,EAAIiS,EAAShM,KAAKqgB,IAAIlc,EAAIqjB,EAAOxnB,KAAKmgB,GAAK,GACjDvL,GAAc,IAANzQ,EAAU,IAAItK,KAAKE,IAAM,KAAKF,KAAKE,GAC5C,CAEA,OADA6a,GAAQ,KACDA,CACR,EAWA,sBAA2BA,EAAc8S,EAAexN,EAAK,EAAGC,EAAK,GACpE,OAAO,IAAI,UAAQvF,GACjB+S,OAAOD,EAAOxN,EAAIC,GAClB1T,UACH,EAdA,kB,8BCjFA,IAAImhB,EAAS,EAAQ,MAEjBC,EAAa,CACfC,OAAQ,EACRC,MAAO,EACPJ,OAAQ,EACRK,UAAW,EACXC,MAAO,EACPC,MAAO,GAGLC,EAAkB,yEAClBC,EAAkB,SAGtBh1B,EAAOD,QAAU,SAAwBk1B,GACvC,IACIrL,EAAKG,EADL2K,EAAS,IAAIF,EAkEjB,OA9DAS,EAAgBnB,MAAMiB,GAAczxB,QAAQ,SAAU4xB,GAGpD,GAAKA,EAAK1kB,OAGV,QAAgC,IAArBikB,EAAWS,GAWtB,OALAnL,EAASmL,EAAKpB,MAAMkB,GAAiBlgB,IAAI,SAAU/D,GACjD,OAAQA,GAAK,CACf,GAGQ6Y,GACN,IAAK,SAIH,YAHsB,IAAlBG,EAAOvZ,QACTkkB,EAAOA,OAAO3K,IAIlB,IAAK,QAMH,YALsB,IAAlBA,EAAOvZ,OACTkkB,EAAOC,MAAM5K,EAAO,GAAIA,EAAO,IACJ,IAAlBA,EAAOvZ,QAChBkkB,EAAOC,MAAM5K,EAAO,GAAIA,EAAO,KAInC,IAAK,SAMH,YALsB,IAAlBA,EAAOvZ,OACTkkB,EAAOH,OAAOxK,EAAO,GAAI,EAAG,GACD,IAAlBA,EAAOvZ,QAChBkkB,EAAOH,OAAOxK,EAAO,GAAIA,EAAO,GAAIA,EAAO,KAI/C,IAAK,YAMH,YALsB,IAAlBA,EAAOvZ,OACTkkB,EAAOE,UAAU7K,EAAO,GAAI,GACD,IAAlBA,EAAOvZ,QAChBkkB,EAAOE,UAAU7K,EAAO,GAAIA,EAAO,KAIvC,IAAK,QAIH,YAHsB,IAAlBA,EAAOvZ,QACTkkB,EAAOG,MAAM9K,EAAO,KAIxB,IAAK,QAIH,YAHsB,IAAlBA,EAAOvZ,QACTkkB,EAAOI,MAAM/K,EAAO,UAjDxBH,EAAMsL,CAqDV,GAEOR,CACT,C,wKCtFA,mBAEA,WAIA,MAAqB1pB,UAAuB,UACxCmqB,UACAC,aACAC,WACAC,SACAC,SACA7kB,KAAe,EACf8kB,UACAC,QACAC,QACAC,UACA,WAAAp0B,CAAYwB,EAAyBoyB,GACjCpH,MAAMhrB,GACN5C,KAAKg1B,UAAYpyB,EAAUgoB,QAAQoK,WAAaA,GAAa,EAE7Dh1B,KAAKi1B,aAAeryB,EAAUgoB,SAASuE,UAAUsG,YAAc,EAC/Dz1B,KAAKk1B,WAAatyB,EAAUgoB,SAASuE,UAAUuG,gBAAkB,GACjE11B,KAAKm1B,SAAWvyB,EAAUgoB,SAASuE,UAAUwG,cAAgB,IAE7D31B,KAAKo1B,SAAW,CAAE9uB,EAAG,EAAGE,EAAG,GAC3BxG,KAAKw1B,UAAY,EAGjBx1B,KAAKq1B,UAAYzyB,EAAUgoB,SAASuE,UAAUkG,WAAa,GAC3Dr1B,KAAKs1B,QAAU1yB,EAAUgoB,SAASuE,UAAUmG,SAAW,GACvDt1B,KAAKu1B,QAAU3yB,EAAUgoB,SAASuE,UAAUoG,SAAW,EACvDv1B,KAAKuQ,KAAO,EAEZ3N,EAAUC,OAAOkB,iBAAiB,QAAS/D,KAAK41B,QAAQC,KAAK71B,MAAO,CAAE81B,QAAS,GACnF,CAEA,OAAAC,GACI,OAAQ,UAAUl0B,SAAS,SAC/B,CAEA,MAAAm0B,GAEI,GADApI,MAAMoI,UACDh2B,KAAK+1B,UAAW,OAErB,IAAIE,EAAS,EACTC,EAAS,EAOb,IALIl2B,KAAKm2B,SAAS30B,IAAI,MAAQxB,KAAKm2B,SAAS30B,IAAI,cAAY00B,GAAU,IAClEl2B,KAAKm2B,SAAS30B,IAAI,MAAQxB,KAAKm2B,SAAS30B,IAAI,gBAAc00B,GAAU,IACpEl2B,KAAKm2B,SAAS30B,IAAI,MAAQxB,KAAKm2B,SAAS30B,IAAI,gBAAcy0B,GAAU,IACpEj2B,KAAKm2B,SAAS30B,IAAI,MAAQxB,KAAKm2B,SAAS30B,IAAI,iBAAey0B,GAAU,GAErEj2B,KAAKi1B,aAELj1B,KAAKo1B,SAAS9uB,GAAK2vB,EAASj2B,KAAKk1B,WACjCl1B,KAAKo1B,SAAS5uB,GAAK0vB,EAASl2B,KAAKk1B,WAGjCl1B,KAAKo1B,SAAS9uB,GAAKtG,KAAKm1B,SACxBn1B,KAAKo1B,SAAS5uB,GAAKxG,KAAKm1B,SAEpBn1B,KAAKw1B,UADK,GAAVS,GAAyB,GAAVC,EACE,EAEA,GAGjBzpB,KAAK+gB,IAAIxtB,KAAKo1B,SAAS9uB,GAAK,KAAQmG,KAAK+gB,IAAIxtB,KAAKo1B,SAAS5uB,GAAK,MAChExG,KAAK2yB,IAAI3yB,KAAKo1B,SAAS9uB,EAAGtG,KAAKo1B,SAAS5uB,OAEzC,CAEH,MAAMosB,EAAKqD,EAASj2B,KAAKg1B,UACnBnC,EAAKqD,EAASl2B,KAAKg1B,UACd,IAAPpC,GAAmB,IAAPC,GAAU7yB,KAAK2yB,IAAIC,EAAIC,EAC3C,CACJ,CACA,GAAAF,CAAIC,EAAYC,GACZ,MAAMvsB,EAAItG,KAAK4C,UAAUmrB,QAAQznB,EAAGE,EAAIxG,KAAK4C,UAAUmrB,QAAQvnB,EAC/DxG,KAAK4C,UAAUmrB,QAAQznB,GAAKssB,EAC5B5yB,KAAK4C,UAAUmrB,QAAQvnB,GAAKqsB,EACxBvsB,GAAKtG,KAAK4C,UAAUmrB,QAAQznB,GAAKE,GAAKxG,KAAK4C,UAAUmrB,QAAQvnB,IAG5DxG,KAAKw1B,YACNx1B,KAAKo2B,wBACLp2B,KAAK4C,UAAU+sB,QAAU,EACzB3vB,KAAK4C,UAAU2tB,oBACfvwB,KAAKq2B,cAETr2B,KAAKq2B,aACT,CAKA,OAAAT,CAAQ5xB,GACJA,EAAE8B,iBAGF,IACIwwB,EAFYt2B,KAAKyQ,WAEI,GADZzM,EAAEmsB,OAASnwB,KAAKq1B,UAAY,KAIzCiB,EAAU7pB,KAAKK,IAAI9M,KAAKs1B,QAAS7oB,KAAKC,IAAI1M,KAAKu1B,QAASe,IAGxD,MAAMC,EAASvyB,EAAEuB,QACXixB,EAASxyB,EAAEyB,QAEXgxB,EAAUz2B,KAAK4C,UAAU8D,kBAAkB6vB,EAAQC,GAGzDx2B,KAAK02B,QAAQJ,GAGbt2B,KAAK4C,UAAUmrB,QAAQznB,EAAImwB,EAAQnwB,EAAIiwB,EAASD,EAChDt2B,KAAK4C,UAAUmrB,QAAQvnB,EAAIiwB,EAAQjwB,EAAIgwB,EAASF,EAEhDt2B,KAAK4C,UAAU6uB,SACnB,CAGA,OAAAhhB,GACI,OAAOzQ,KAAKuQ,IAChB,CAGA,OAAAmmB,CAAQnmB,GACJvQ,KAAKuQ,KAAOA,CAChB,EA5HJ,W,4ECIA,0BACC9P,EACAk2B,EAAoB,CAAC,IAAK,MAE1B,GAAIC,EAAYn2B,GAAO,OAAOm2B,EAAYn2B,GAE1C,MAAMo2B,EAAS,MAAMp2B,EAAKuN,QAAQ,OAAQ,OAC1C,IAAKvL,SAASq0B,eAAeD,GAAS,CACrC,MAAME,EAAOt0B,SAASC,cAAc,QACpCq0B,EAAK9vB,GAAK4vB,EACVE,EAAKC,IAAM,aACX,MAAMC,EAAeN,EAAQ/hB,KAAK,KAClCmiB,EAAKG,KAAO,4CAA4Cz2B,EAAKuN,QAC5D,OACA,aACSipB,iBACVx0B,SAAS00B,KAAKr0B,YAAYi0B,EAC3B,CAGA,MAAMK,EAAeT,EAAQhiB,IAAK+I,GACjCjb,SAAS40B,MAAMC,KAAK,GAAG5Z,SAASjd,MAG3B82B,EAAUC,QAAQC,IAAIL,GAAcM,KAAK,QAE/C,OADAd,EAAYn2B,GAAQ82B,EACbA,CACR,EAjCA,MAAMX,EAA6C,CAAC,C,wKCFpD,WAiEA,QAAQ1kB,cAAc,aAzDtB,SAA4B7F,EAAkBwF,GAE1C,MAAM8lB,EAAc,KAChB9lB,EAAKsU,SAASiM,eACdvgB,EAAKmV,OAAOwL,iBACZnmB,EAAQxG,SACR+xB,EAAM/xB,SACN,MAAMA,EAA4B,GAClC,IAAK,IAAI3E,KAAS2Q,EAAKpN,SAASgW,YAA4B,CACxD,IAAK,IAAIod,KAAQ32B,EAAMua,mBACfoc,EAAK1pB,MAAQ0D,EAAKsU,UAAY0R,EAAK5T,IAAMpS,EAAKmV,QAC9CnhB,EAAO3D,KAAK21B,IAEZA,EAAK1pB,KAAO0D,EAAKmV,QAAU6Q,EAAK5T,IAAMpS,EAAKsU,WAC3CtgB,EAAO3D,KAAK21B,GAGpB32B,EAAMua,mBAAqBva,EAAMua,mBAAmBvD,OAAOlU,IAAM6B,EAAO6hB,SAAS1jB,GACrF,GAIE0J,EAAOrB,EAAQqB,OACfoqB,EAAOpqB,EAAKpH,EAAIoH,EAAK7B,MAAQ,EAC7BksB,EAAOrqB,EAAKlH,EAAIkH,EAAK5B,OAAS,EAC9B8rB,EAASvrB,EAAQ4C,SAAkB7B,KAAK,KAAKG,KAAK,CACpDE,OAAQ,sBACRD,KAAM,GACNmT,OAAQ,MACRzE,OAAQ,SACR1N,QAAS,QAERsI,SAAUjF,EAAKpN,SAASrD,YAAgC6Z,iBACxD+c,OAAOF,EAAMC,GACb/0B,KAAK,QACLwV,OAAO,CAAExT,MAAO,OAAQ6G,MAAO,IAC/B1E,OAYL,OAVAywB,EAAM5lB,GAAG,QAAS2lB,GAClBC,EAAMx0B,KAAKgB,MAAM+T,WAAa,OAE9B9L,EAAQ2F,GAAG,YAAa,IAAM4lB,EAAMn0B,QACpC4I,EAAQ2F,GAAG,WAAY,IAAM4lB,EAAMzwB,QAGnCkF,EAAQ2F,GAAG,QAAS2lB,GAGb,KACHtrB,EAAQ4F,IAAI,QAAS0lB,GACrBtrB,EAAQ4F,IAAI,aACZ5F,EAAQ4F,IAAI,YACZ2lB,EAAM3lB,IAAI,QAAS0lB,GACnBC,EAAM/xB,SAEd,E,sRCjEA,mBAEA,aAEA,aAuCA,MAAM8D,EACFiT,MACAnc,KACA6C,KACAF,KACA60B,SACA9iB,SACUI,MACV,eAAO3N,CAASnH,EAAcoH,GAAiB,CAC/C,iBAAOE,CAAWtH,GAAgB,CAClC,WAAAW,GACIpB,KAAK4c,MAAQ,GACb5c,KAAKS,KAAO,GACZT,KAAKsD,KAAO,GACZtD,KAAKuV,MAAQ,KACbvV,KAAKi4B,SAAW,CACpB,CACA,MAAAxT,CAAOxE,EAA0BiY,GAEjC,CACA,gBAAAC,GACI,OAAO,CACX,CAKA,WAAAC,CAAYC,GACRr4B,KAAKi4B,SAAWI,EACZr4B,KAAKoD,MACLpD,KAAKoD,MAAMR,WAAW6B,UAAUqjB,eAAe9nB,KAAKoD,KAE5D,CAIA,OAAAk1B,GACI,OAAOt4B,KAAKi4B,QAChB,CAMA,OAAAM,CAAQ93B,GACJ,OAAOT,KAAKS,KAAOA,CACvB,CAKA,QAAAwV,CAASkd,EAAoBvwB,QACPvC,IAAd8yB,EAAK1yB,OAAoBT,KAAKS,KAAO0yB,EAAK1yB,WAC3BJ,IAAf8yB,EAAKvW,QAAqB5c,KAAK4c,MAAQuW,EAAKvW,YAC9Bvc,IAAd8yB,EAAK7vB,OAAoBtD,KAAKsD,KAAO6vB,EAAK7vB,WAC3BjD,IAAf8yB,EAAK5d,QAAqBvV,KAAKuV,MAAQ4d,EAAK5d,OAC5C4d,EAAK8E,UAAUj4B,KAAKo4B,YAAYI,QAAQrF,EAAK8E,UACrD,CAGA,OAAAQ,GACI,OAAOz4B,KAAKS,IAChB,CAGA,QAAAoc,GACI,OAAO7c,KAAK4c,KAChB,CAOA,QAAA8b,CAAS9b,GACL,OAAO5c,KAAK4c,MAAQA,CACxB,CAGA,MAAAG,GACI,OAAO,CACX,CAGA,cAAA4G,GACI,OAAO,CACX,CAEA,cAAAxG,GACI,OAAO,CACX,CAKA,UAAAmG,CAAWqV,GAEX,CAEA,aAAAtb,GACI,MAAO,CAAExR,MAAO,KAAMC,OAAQ,KAClC,CAEA,QAAAmR,GACI,OAAOjd,KAAKuV,KAChB,CAMA,QAAAqjB,CAASP,GACLr4B,KAAKuV,MAAQ8iB,CACjB,CAGA,eAAA1Y,GACI,OAAO3f,KAAKid,UAChB,CACA,MAAAlH,CAAO8iB,EAAeC,GAClB,MAAO,CACHr4B,KAAMT,KAAKS,KACXmc,MAAO5c,KAAK4c,MACZtZ,KAAMtD,KAAKsD,KACXiS,MAAOvV,KAAKid,WAEpB,EAKJ,MAAarT,EACTgT,MACAnc,KACA6C,KACAF,KACA60B,SACA9iB,SAEA,WAAA/T,GACIpB,KAAK4c,MAAQ,GACb5c,KAAKS,KAAO,GACZT,KAAKsD,KAAO,GACZtD,KAAKi4B,SAAW,CACpB,CACA,MAAAxT,CAAOxE,EAA0BiY,GAEjC,CACA,gBAAAC,GACI,OAAO,CACX,CAKA,WAAAC,CAAYC,GACRr4B,KAAKi4B,SAAWI,EACZr4B,KAAKoD,MACLpD,KAAKoD,MAAMR,WAAW6B,UAAUqjB,eAAe9nB,KAAKoD,KAE5D,CAIA,OAAAk1B,GACI,OAAOt4B,KAAKi4B,QAChB,CAMA,OAAAM,CAAQ93B,GACJ,OAAOT,KAAKS,KAAOA,CACvB,CAKA,QAAAwV,CAASkd,QACa9yB,IAAd8yB,EAAK1yB,OAAoBT,KAAKS,KAAO0yB,EAAK1yB,WAC3BJ,IAAf8yB,EAAKvW,QAAqB5c,KAAK4c,MAAQuW,EAAKvW,YAC9Bvc,IAAd8yB,EAAK7vB,OAAoBtD,KAAKsD,KAAO6vB,EAAK7vB,KAClD,CAEA,MAAAyZ,GACI,OAAO,CACX,CAGA,cAAA4G,GACI,OAAO,CACX,CAEA,OAAA8U,GACI,OAAOz4B,KAAKS,IAChB,CAGA,QAAAoc,GACI,OAAO7c,KAAK4c,KAChB,CAMA,QAAA8b,CAAS9b,GACL,OAAO5c,KAAK4c,MAAQA,CACxB,CAEA,cAAAO,GACI,OAAO,CACX,CAKA,UAAAmG,CAAWqV,GAEX,CAEA,aAAAtb,GACI,MAAO,CAAExR,MAAO,EAAGC,OAAQ,EAC/B,CAKA,QAAAmR,GACI,OAAO,IACX,CAIA,QAAA2b,CAAS3e,GAAU,CAEnB,eAAA0F,GACI,OAAO3f,KAAKid,UAChB,CACA,MAAAlH,CAAO8iB,EAAeC,GAClB,MAAO,CACHr4B,KAAMT,KAAKS,KACXmc,MAAO5c,KAAK4c,MACZtZ,KAAMtD,KAAKsD,KACXiS,MAAOvV,KAAKid,WAEpB,EApHJ,eA0HA,MAAaoV,UAAkC1oB,EAC3Cia,WAEA,WAAAxiB,GACIwsB,QACA5tB,KAAK4jB,WAAa,IAAI,UAAW5jB,KAAM,MACvCA,KAAKuV,MAAQ,IACjB,CACA,cAAAoO,GACI,OAAO,CACX,CAEA,MAAA5G,GACI,OAAO,CACX,CAGA,UAAAuV,GACI,MAAMrO,EAAKjkB,KAAK4jB,WAAWK,GACvBA,aAAc,WAAWA,GAAIE,oBAAoBhW,OACjD8V,EAAGE,mBAAmBhW,KAAO,KAC7BnO,KAAK4jB,WAAWK,GAAK,KAE7B,CACA,QAAAhO,CAASkd,EAAoBvwB,GAczB,OAbAgrB,MAAM3X,SAASkd,GAGXA,EAAK5d,OAA+B,iBAAf4d,EAAK5d,OAAsB4d,EAAK5d,MAAMtO,IAC3DjH,KAAKuV,MAAQ,UAAQwjB,aAAa5F,EAAK5d,MAAO,CAAC,EAAG3S,GAClD5C,KAAK4jB,WAAWoV,MAAMh5B,KAAKuV,QACpB4d,EAAK5d,iBAAiB,WAC7BvV,KAAKuV,MAAQ4d,EAAK5d,MAClBvV,KAAK4jB,WAAWoV,MAAMh5B,KAAKuV,QAE3BvV,KAAKuV,MAAQ4d,EAAK5d,MAGfvV,IACX,CACA,MAAA+V,CAAO8iB,EAAeC,GAClB,IAAIT,EAAWr4B,KAAKid,WAIpB,OAFIob,aAAe,YAASA,EAAM,CAAEj1B,KAAM01B,EAAiBT,EAAIpxB,IAAO4xB,EAAOC,EAAiBT,EAAIpxB,IAAMoxB,EAAIpxB,GAAMoxB,EAAI5E,UAAUqF,KAEzH,IACAlL,MAAM7X,OAAO,EAAM+iB,GACtBvjB,MAAO8iB,EAEf,EAjDJ,qBAqDA,MAAaxuB,UAAoBF,EAC7B,WAAAvI,GACIwsB,OACJ,CAEA,QAAA3X,CAASkd,GACLvF,MAAM3X,SAASkd,QACI9yB,IAAf8yB,EAAK5d,OAAqBvV,KAAK44B,SAASjlB,OAAOwf,EAAK5d,OAC5D,CACA,QAAAqjB,CAASP,GACLr4B,KAAKuV,MAAQ5B,OAAO0kB,EACxB,EAXJ,gBAeA,MAAatuB,UAAkBJ,EAC3B,WAAAvI,GACIwsB,OACJ,CACA,QAAA3X,CAASkd,GACLvF,MAAM3X,SAASkd,QACI9yB,IAAf8yB,EAAK5d,OAAqBvV,KAAK44B,SAASK,OAAO9F,EAAK5d,OAC5D,CACA,QAAAqjB,CAASP,GACLr4B,KAAKuV,MAAQ0jB,OAAOZ,EACxB,EAVJ,cAiBA,MAAavuB,UAAwBuoB,EACjC6G,QAEA,WAAA93B,GACIwsB,QACA5tB,KAAKk5B,QAAU,QACnB,CACA,gBAAAf,GACI,OAAO,CACX,CACA,OAAAG,GACI,OAAIt4B,KAAKid,qBAAsB,UACpB,EAEJjd,KAAKi4B,QAChB,CACA,QAAAhb,GACI,OAAIjd,KAAK4jB,YAAc5jB,KAAK4jB,WAAWM,QAC5BlkB,KAAK4jB,WAAWM,QAEhBlkB,KAAKuV,KAEpB,CACA,MAAAwH,GACI,OAAO,CACX,CACA,cAAA4G,GACI,OAAO,CACX,CAKA,YAAAwV,CAAa71B,GACTtD,KAAKk5B,QAAU51B,CACnB,CAKA,QAAA2S,CAASkd,EAAoBvwB,GAMzB,OALAgrB,MAAM3X,SAASkd,EAAMvwB,GACrB5C,KAAKk5B,QAAU/F,EAAKiG,UAAY,SACd,MAAdp5B,KAAKuV,cAAwBvV,KAAKuV,QAAUvV,KAAKk5B,SACjDl5B,KAAK44B,SAAS54B,KAAKuV,OAEhBvV,IACX,CAMA,QAAA44B,CAASP,GACgB,WAAjBr4B,KAAKk5B,QAAsBl5B,KAAKuV,MAAQ5B,OAAO0kB,GAC9Cr4B,KAAKuV,MAAQ0jB,OAAOZ,EAC7B,CAKA,eAAA1Y,GACI,OAAkB,MAAd3f,KAAKuV,MAAuC,WAAjBvV,KAAKk5B,QAAuB,IAAM,GAC7Dl5B,KAAKid,qBAAsB,UAAgB,SACxCgc,OAAOj5B,KAAKuV,MACvB,CACA,MAAAQ,CAAO8iB,EAAeC,GAClB,IAAIT,EAAWr4B,KAAKid,WAIpB,OAFIob,aAAe,YAASA,EAAM,CAAEj1B,KAAMy1B,EAAOR,EAAI5E,UAAUqF,GAAoBT,EAAIpxB,KAEhF,IACA2mB,MAAM7X,OAAO,EAAM+iB,GACtBM,SAAUp5B,KAAKk5B,QACf3jB,MAAO8iB,EAEf,EA5EJ,oBA+EA,MAAagB,UAAsB1vB,EAC/BihB,QACA0O,UACAC,QAEA,WAAAn4B,GACIwsB,QACA5tB,KAAK4qB,QAAU,KACf5qB,KAAKs5B,UAAY,KACjBt5B,KAAKu5B,QAAU,CACnB,CAEA,MAAA9U,CAAOxE,GACH,IAAKA,IAAWjgB,KAAK4qB,QAAS,OAE9B,MAAM,IAAE1K,EAAG,IAAEpS,GAAQmS,EACfuZ,EAAS,IAAMx5B,KAAKy5B,eAAexZ,GACzCC,EAAIwZ,MAAMF,GACV1rB,EAAI4rB,MAAMF,EACd,CAEQ,cAAAC,CAAexZ,GACf,UAAkB0Z,aAAe35B,KACjCA,KAAK45B,gBAEL55B,KAAK65B,aAAa5Z,GAEtBA,EAAOnS,IAAIV,KAAKpN,KAAK2f,kBACzB,CAEQ,YAAAka,CAAa5Z,GACjB,IAAKjgB,KAAK4qB,QAAS,OAEnB,MAAMkP,EAAQ95B,KAAK4qB,QAAQjW,IAAIolB,IAAU,CACrCnd,MAAyB,iBAAXmd,EAAsBA,EAASA,EAAO3sB,KACpDmI,MAAyB,iBAAXwkB,EAAsBA,EAASA,EAAOxkB,SAGxD,UAAkB9R,KAAKzD,KAAM,CACzB85B,QACAjuB,MAAiC,EAA1BoU,EAAOC,IAAIxS,OAAO7B,MACzBmuB,SAAWzkB,IACP,IAAKvV,KAAK4qB,QAAS,OACnB,MAAMqP,EAAWj6B,KAAK4qB,QAAQ7Q,KAC1B/V,GAAKA,IAAMuR,GAAuB,iBAANvR,GAAkBA,EAAEuR,QAAUA,GAE1D0kB,IACAj6B,KAAKs5B,UAAYW,EACjBj6B,KAAK44B,SAASrjB,GACdvV,KAAK45B,gBACL55B,MAAMoD,MAAMR,WAAW+oB,eACvB3rB,MAAMoD,MAAMR,WAAW6B,UAAUqjB,eAAe9nB,KAAKoD,SAIrE,CAEQ,aAAAw2B,GACJ,UAAkBM,YAAYl6B,KAClC,CAEA,OAAAs4B,GACI,OAAO,CACX,CAEA,WAAA6B,GACI,OAAOn6B,KAAKs5B,SAChB,CACA,QAAArjB,CAASkd,GACLvF,MAAM3X,SAASkd,GACfnzB,KAAK4qB,QAAUuI,EAAKvI,SAA6B,KACjD5qB,KAAKs5B,UAAYt5B,KAAK4qB,UAAU,IAAM,KAClC5qB,KAAKs5B,WAAWt5B,KAAK44B,SAAmC,iBAAnB54B,KAAKs5B,UAAyBt5B,KAAKs5B,UAAYt5B,KAAKs5B,UAAU/jB,MAC3G,CAMA,eAAAoK,GAGI,OAFuC,iBAAnB3f,KAAKs5B,UAAyBt5B,KAAKs5B,UAAYt5B,KAAKs5B,WAAWlsB,MAAQ,IAE7E,MADA,UAAkBusB,YAAc35B,KAAO,IAAM,IAE/D,CAMA,UAAAo6B,CAAWxP,GACP5qB,KAAK4qB,QAAUA,EACf5qB,KAAKs5B,UAAYt5B,KAAK4qB,UAAU,IAAM,KAClC5qB,KAAKs5B,WAAWt5B,KAAK44B,SACK,iBAAnB54B,KAAKs5B,UAAyBt5B,KAAKs5B,UAAYt5B,KAAKs5B,UAAU/jB,MAE7E,CAOA,MAAAQ,CAAO8iB,EAAeC,GAClB,MAAO,IAAKlL,MAAM7X,OAAO8iB,EAAMC,GAAmBlO,QAAS5qB,KAAK4qB,QACpE,EAxGJ,kBAmHa,EAAA9iB,SAQT,CACA,WAAcgC,EACd,aAAgBC,EAChB,UAAaF,EACb,YAAeD,EACf,UAAaG,EACb,WAAcsoB,EACd,SAAYgH,GAIhB,UAAe1vB,C,0GCvkBf,MAAMtC,EAAoC,CAAC,EA0E5B,EAAAA,YAAAA,EApEf,MAAM2D,EAMF,eAAOpD,CAASyyB,EAAkCC,GAC9C,MAAM75B,EAAO65B,GAAWD,EAAY9yB,KACpCF,EAAY5G,GAAQ45B,CACxB,CAQA,aAAO,CAAO55B,GACV,MAAa,YAATA,EAA2B,EAC3B4G,EAAY5G,WACL4G,EAAY5G,GACZ,GAEJ,CACX,CAQA,UAAOwB,CAAIxB,GACP,MAAMK,EAAW,gBACjB,OAAOuG,EAAY5G,IAAS4G,EAAqB,SAAKvG,CAC1D,CAMA,WAAOy5B,GACH,OAAO75B,OAAO85B,KAAKnzB,EACvB,CAUA,cAAO0nB,CAAQ0L,GACX,MAAM35B,EAAW,gBAEjB,OAAK25B,EAEgB,iBAAVA,EAA2BzvB,EAAK/I,IAAIw4B,GAE1B,mBAAVA,EAA6BA,EAEjCpzB,EAAqB,SAAKvG,EANduG,EAAqB,SAAKvG,CAOjD,EAKK,EAAAkK,KAAAA,C,8ECnFT,gBAsBA,gBACYkO,GACAhT,IACAw0B,QACAz0B,KAGA6nB,KAQR,WAAA1sB,CAAY8X,EAAkBhT,EAAU4O,GACpC9U,KAAKkZ,GAAKA,EACVlZ,KAAKkG,IAAMA,EAEXlG,KAAK8tB,KAAO,CACRxqB,KAAMwR,EAAKxR,MAAQ,SACnBq3B,QAAS7lB,EAAK6lB,SAAW,GACzBC,QAAS9lB,EAAK8lB,SAAW,EACzBC,YAAa/lB,EAAK+lB,aAAe,EACjC71B,MAAO8P,EAAK9P,OAAS,aAGzBhF,KAAKob,MACT,CAMQ,IAAAA,GACApb,KAAKiG,MACLjG,KAAKiG,KAAKJ,SAEd,MAAM,KAAEvC,EAAI,QAAEq3B,EAAO,QAAEC,EAAO,YAAEC,EAAW,MAAE71B,GAAUhF,KAAK8tB,KAE5D,IAAIgN,EAAO96B,KAAKkG,IAAI60B,QAAQ,QACvBD,IAAMA,EAAO96B,KAAKkG,IAAI40B,QAE3B96B,KAAK06B,QAAU16B,KAAKkG,IAAIw0B,QAAQC,EAASA,EAAUl5B,IAClC,WAAT6B,EACA7B,EACKkX,OAAiB,EAAViiB,GACP53B,KAAKgC,GACLoK,KAAKurB,EAAU,EAAIC,EAASD,EAAU,EAAIC,GAE/Cn5B,EAAIwE,KAAK00B,EAASA,GAASniB,OAAO,CAAExT,QAAO6G,MAAOgvB,IAAe73B,KAAK,UAG9EhD,KAAK06B,QAAQzsB,KAAK,CAAE+sB,aAAc,mBAClCF,EAAKr5B,IAAIzB,KAAK06B,SAEd,MAAM,MAAE7uB,EAAK,OAAEC,GAAW9L,KAAKkZ,GAAGsY,UAClCxxB,KAAKiG,KAAOjG,KAAKkG,IACZD,KAAK4F,EAAOC,GACZ9I,KAAKhD,KAAK06B,SACVhiB,OACA5B,SAAS,uBAEd,IAAAzO,mBAAkB,SAAU,IAAMrI,KAAKi7B,SAC3C,CAKA,MAAAA,GACI,IAAKj7B,KAAKiG,KAAM,OAChB,MAAM,MAAE4F,EAAK,OAAEC,GAAW9L,KAAKkZ,GAAGsY,UAClCxxB,KAAKiG,KAAKuH,KAAK3B,EAAOC,GAAQ4M,OAC9B1Y,KAAKkZ,GAAG+U,gBAAgBvV,MAC5B,CAMA,eAAAsY,GACI,IAAKhxB,KAAK06B,UAAY16B,KAAKiG,KAAM,OACjC,MAAM,KAAE3C,EAAI,QAAEq3B,EAAO,QAAEC,EAAO,YAAEC,EAAW,MAAE71B,GAAUhF,KAAK8tB,KAEtDvd,EAAOvQ,KAAKkZ,GAAGzI,UACfyqB,EAAgBP,EAAUpqB,EAKhC,GAHAvQ,KAAK06B,QAAQzsB,KAAK,CAAEpC,MAAOqvB,EAAepvB,OAAQovB,IAClDl7B,KAAK06B,QAAQx3B,QAEA,WAATI,EAAmB,CACnB,MAAM63B,EAAY1uB,KAAKK,IAAI8tB,EAAUrqB,EAAM,IAC3CvQ,KAAK06B,QACA/hB,OAAmB,EAAZwiB,GACPn4B,KAAKgC,GACLoK,KAAK8rB,EAAgB,EAAIC,EAAWD,EAAgB,EAAIC,EACjE,MACIn7B,KAAK06B,QACAz0B,KAAKi1B,EAAeA,GACpB1iB,OAAO,CAAExT,QAAO6G,MAAOgvB,EAActqB,IACrCvN,KAAK,QAGd,MAAMo4B,EAAMp7B,KAAKkZ,GAAG6U,QACpB/tB,KAAK06B,QAAQzsB,KAAK,CACdotB,iBAAkB,cAAcD,EAAI90B,EAAIiK,EAAO2qB,OAAmBE,EAAI50B,EAAI+J,EAAO2qB,OAGrFl7B,KAAKi7B,SACLj7B,KAAKkZ,GAAG+U,gBAAgBvV,MAC5B,CAKA,aAAA4iB,GACI,MAAMxmB,EAAO9U,KAAKkZ,GAAG0R,QAASkD,KAC9B9tB,KAAK8tB,KAAO,CACRxqB,KAAMwR,EAAMxR,MAAQ,SACpBq3B,QAAS7lB,EAAM6lB,SAAW,GAC1BC,QAAS9lB,EAAM8lB,SAAW,EAC1BC,YAAa/lB,EAAM+lB,aAAe,EAClC71B,MAAO8P,EAAM9P,OAAS,aAE1BhF,KAAKob,MACT,CAMA,UAAAgf,CAAWmB,GACP76B,OAAOib,OAAO3b,KAAK8tB,KAAMyN,GACzBv7B,KAAKiG,MAAMJ,WACX7F,KAAK06B,SAAS70B,WACd7F,KAAKob,MACT,E,wKC9JJ,WAsBA,QAAQlJ,cAAc,cAnBtB,SAAqB7F,EAAkBwF,GACtC,MAAM2pB,EAAYnvB,EACZ6M,EAAmBrH,EAAKjP,UAGxB64B,EAAU,KACfviB,EAAGwZ,WAAW7gB,EAAKzO,OAOpB,OAHAo4B,EAAUxpB,GAAG,QAASypB,GAGf,KACND,EAAUvpB,IAAI,QAASwpB,GAEzB,E,4ECFA,UAFsD,CAAC,C,wBCZvD,SAASC,EAAQC,EAAIC,GACnB,MAAO,CACLD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GACnCA,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAEvC,CAGA,SAAStH,IACP,KAAMr0B,gBAAgBq0B,GAAW,OAAO,IAAIA,EAC5Cr0B,KAAK67B,MAAQ,GACb77B,KAAK87B,MAAQ,IACf,CAGAzH,EAAO1zB,UAAU4zB,OAAS,SAAUnX,GAClC,OAAa,IAATA,EAAE,IAAqB,IAATA,EAAE,IAAqB,IAATA,EAAE,IAAqB,IAATA,EAAE,IAAqB,IAATA,EAAE,IAAqB,IAATA,EAAE,KAG5Epd,KAAK87B,MAAQ,KACb97B,KAAK67B,MAAM35B,KAAKkb,IAHPpd,IAKX,EAGAq0B,EAAO1zB,UAAU8zB,UAAY,SAAUsH,EAAIC,GAKzC,OAJW,IAAPD,GAAmB,IAAPC,IACdh8B,KAAK87B,MAAQ,KACb97B,KAAK67B,MAAM35B,KAAK,CAAE,EAAG,EAAG,EAAG,EAAG65B,EAAIC,KAE7Bh8B,IACT,EAGAq0B,EAAO1zB,UAAU6zB,MAAQ,SAAUyH,EAAIC,GAKrC,OAJW,IAAPD,GAAmB,IAAPC,IACdl8B,KAAK87B,MAAQ,KACb97B,KAAK67B,MAAM35B,KAAK,CAAE+5B,EAAI,EAAG,EAAGC,EAAI,EAAG,KAE9Bl8B,IACT,EAGAq0B,EAAO1zB,UAAUyzB,OAAS,SAAUD,EAAO5H,EAAIC,GAC7C,IAAI2P,EAAKtP,EAAKC,EAcd,OAZc,IAAVqH,IACFn0B,KAAKy0B,UAAUlI,EAAIC,GAEnB2P,EAAMhI,EAAQ1nB,KAAKmgB,GAAK,IACxBC,EAAMpgB,KAAKogB,IAAIsP,GACfrP,EAAMrgB,KAAKqgB,IAAIqP,GAEfn8B,KAAK67B,MAAM35B,KAAK,CAAE2qB,EAAKC,GAAMA,EAAKD,EAAK,EAAG,IAC1C7sB,KAAK87B,MAAQ,KAEb97B,KAAKy0B,WAAWlI,GAAKC,IAEhBxsB,IACT,EAGAq0B,EAAO1zB,UAAU+zB,MAAQ,SAAUP,GAKjC,OAJc,IAAVA,IACFn0B,KAAK87B,MAAQ,KACb97B,KAAK67B,MAAM35B,KAAK,CAAE,EAAG,EAAGuK,KAAK2vB,IAAIjI,EAAQ1nB,KAAKmgB,GAAK,KAAM,EAAG,EAAG,KAE1D5sB,IACT,EAGAq0B,EAAO1zB,UAAUg0B,MAAQ,SAAUR,GAKjC,OAJc,IAAVA,IACFn0B,KAAK87B,MAAQ,KACb97B,KAAK67B,MAAM35B,KAAK,CAAE,EAAGuK,KAAK2vB,IAAIjI,EAAQ1nB,KAAKmgB,GAAK,KAAM,EAAG,EAAG,EAAG,KAE1D5sB,IACT,EAKAq0B,EAAO1zB,UAAU07B,QAAU,WACzB,GAAIr8B,KAAK87B,MACP,OAAO97B,KAAK87B,MAGd,IAAK97B,KAAK67B,MAAMxrB,OAEd,OADArQ,KAAK87B,MAAQ,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,GACvB97B,KAAK87B,MAKd,GAFA97B,KAAK87B,MAAQ97B,KAAK67B,MAAM,GAEE,IAAtB77B,KAAK67B,MAAMxrB,OACb,OAAOrQ,KAAK87B,MAGd,IAAK,IAAIlrB,EAAI,EAAGA,EAAI5Q,KAAK67B,MAAMxrB,OAAQO,IACrC5Q,KAAK87B,MAAQJ,EAAQ17B,KAAK87B,MAAO97B,KAAK67B,MAAMjrB,IAG9C,OAAO5Q,KAAK87B,KACd,EAMAzH,EAAO1zB,UAAU27B,KAAO,SAAUh2B,EAAGE,EAAG+1B,GACtC,IAAInf,EAGJ,OAAKpd,KAAK67B,MAAMxrB,QAOXrQ,KAAK87B,QACR97B,KAAK87B,MAAQ97B,KAAKq8B,WAMb,CACL/1B,GAJF8W,EAAIpd,KAAK87B,OAID,GAAKt1B,EAAI4W,EAAE,IAAMmf,EAAa,EAAInf,EAAE,IAC1C9W,EAAI8W,EAAE,GAAK5W,EAAI4W,EAAE,IAAMmf,EAAa,EAAInf,EAAE,MAhBX,CAAE9W,EAAGE,EAkBxC,EAGA3G,EAAOD,QAAUy0B,C,4EC1IjB,gBACIzxB,UAEAuzB,SACAqG,UACAC,SACAC,aACA3M,WAEA4M,WACAC,eACAC,cAAgB,EAChBC,gBAAkB,IAClBC,YAAc,EACdC,aAAoB,KACpBC,WAEA,WAAA77B,CAAYwB,GACR5C,KAAK4C,UAAYA,EAEjB5C,KAAKm2B,SAAW,IAAI90B,IACpBrB,KAAKw8B,UAAY,IAAIn7B,IACrBrB,KAAKy8B,SAAW,CAAEn2B,EAAG,EAAGE,EAAG,GAC3BxG,KAAK08B,aAAe,CAAEp2B,EAAG,EAAGE,EAAG,GAC/BxG,KAAK+vB,WAAa,EAClB/vB,KAAK28B,WAAa,EAClB38B,KAAK48B,eAAiB,GAEtB58B,KAAKk9B,kBAELl9B,KAAKi9B,WAAaE,YAAY,IAAMn9B,KAAKg2B,SAAU,GACvD,CACA,eAAAxF,CAAgBzuB,GACZ/B,KAAK48B,eAAe16B,KAAKH,EAC7B,CAEA,kBAAA2uB,CAAmB3uB,GACf,MAAM6O,EAAI5Q,KAAK48B,eAAetU,QAAQvmB,IAC3B,IAAP6O,GAAU5Q,KAAK48B,eAAe3U,OAAOrX,EAAG,EAChD,CAEA,WAAAwsB,GACkC,oBAAnBC,eACPA,eAAe,KACX,IAAK,IAAIt7B,KAAM/B,KAAK48B,eAChB,IAAM76B,GAAM,CAAE,MAAOiC,GAAK6sB,QAAQC,MAAM9sB,EAAI,IAIpDwzB,QAAQzI,UAAU2I,KAAK,KACnB,IAAK,IAAI31B,KAAM/B,KAAK48B,eAChB,IAAM76B,GAAM,CAAE,MAAOiC,GAAK6sB,QAAQC,MAAM9sB,EAAI,GAI5D,CAEA,qBAAAoyB,GACI,MAAM7iB,EAAM+pB,YAAY/pB,MAGxB,GAAIA,EAAMvT,KAAK68B,eAAiB78B,KAAK88B,gBAGjC,OAFA98B,KAAK68B,cAAgBtpB,OACrBvT,KAAKo9B,cAKT,IAAKp9B,KAAK+8B,YAAa,CACnB/8B,KAAK+8B,YAAc,EACnB,MAAMQ,EAAOv9B,KAAK88B,iBAAmBvpB,EAAMvT,KAAK68B,eAEhD78B,KAAKg9B,aAAeQ,WAAW,KAC3Bx9B,KAAK+8B,YAAc,EACnB/8B,KAAK68B,cAAgBS,YAAY/pB,MACjCvT,KAAKo9B,eACNG,EACP,CACJ,CACA,OAAA9sB,GACI,OAAO,CACX,CACA,OAAAslB,GACI,OAAO,CACX,CACQ,eAAAmH,GACJO,OAAO15B,iBAAiB,UAAWC,GAAKhE,KAAKm2B,SAAS10B,IAAIuC,EAAEuN,MAC5DksB,OAAO15B,iBAAiB,QAASC,GAAKhE,KAAKm2B,SAASv0B,OAAOoC,EAAEuN,MAE7DksB,OAAO15B,iBAAiB,YAAaC,GAAKhE,KAAKw8B,UAAU/6B,IAAIuC,EAAE05B,SAC/DD,OAAO15B,iBAAiB,UAAWC,GAAKhE,KAAKw8B,UAAU56B,OAAOoC,EAAE05B,SAEhED,OAAO15B,iBAAiB,YAAaC,IACjChE,KAAK08B,aAAe,IAAK18B,KAAKy8B,UAC9Bz8B,KAAKy8B,SAAW,CAAEn2B,EAAGtC,EAAEuB,QAASiB,EAAGxC,EAAEyB,WAGzCg4B,OAAO15B,iBAAiB,QAASC,IAC7BhE,KAAK28B,WAAa34B,EAAEmsB,SAGxBsN,OAAO15B,iBAAiB,YAAaC,IAChB,IAAbA,EAAE05B,SAAc19B,KAAK+vB,WAAa,KAE1C0N,OAAO15B,iBAAiB,UAAWC,IACd,IAAbA,EAAE05B,SAAc19B,KAAK+vB,WAAa,IAE9C,CAEA,MAAAiG,GAEA,CAGA,GAAArD,CAAIC,EAAYC,GACZ,MAAMvsB,EAAItG,KAAK4C,UAAUmrB,QAAQznB,EAAGE,EAAIxG,KAAK4C,UAAUmrB,QAAQvnB,EAC/DxG,KAAK4C,UAAUmrB,QAAQznB,GAAKssB,EAC5B5yB,KAAK4C,UAAUmrB,QAAQvnB,GAAKqsB,EACxBvsB,GAAKtG,KAAK4C,UAAUmrB,QAAQznB,GAAKE,GAAKxG,KAAK4C,UAAUmrB,QAAQvnB,IAGjExG,KAAKo2B,wBACLp2B,KAAK4C,UAAU+sB,QAAU,EACzB3vB,KAAK4C,UAAU2tB,oBACfvwB,KAAKq2B,aACT,CAEA,SAAAsH,CAAUC,GACN,MAAMt3B,EAAItG,KAAK4C,UAAUmrB,QAAQznB,EAAGE,EAAIxG,KAAK4C,UAAUmrB,QAAQvnB,EAC/DxG,KAAK4C,UAAUmrB,QAAQznB,EAAIs3B,EAAIt3B,EAC/BtG,KAAK4C,UAAUmrB,QAAQvnB,EAAIo3B,EAAIp3B,EAC3BF,GAAKtG,KAAK4C,UAAUmrB,QAAQznB,GAAKE,GAAKxG,KAAK4C,UAAUmrB,QAAQvnB,IAGjExG,KAAKo2B,wBACLp2B,KAAK4C,UAAU+sB,QAAU,EACzB3vB,KAAK4C,UAAU2tB,oBACfvwB,KAAKq2B,aACT,CAEA,QAAAwH,CAASD,GACL,MAAME,EAAS99B,KAAK4C,UAAU4uB,aAAe,CAAE3lB,MAAO,EAAGC,OAAQ,GACjE9L,KAAK29B,UAAU,CACXr3B,EAAGs3B,EAAIt3B,EAAIw3B,EAAOjyB,MAAQ,EAC1BrF,EAAGo3B,EAAIp3B,EAAIs3B,EAAOhyB,OAAS,GAEnC,CAKA,iBAAApF,CAAkBJ,EAAWE,GACzB,MAAM40B,EAAMp7B,KAAK4C,UAAUmrB,QAC3B,MAAO,CACHznB,EAAGA,EAAI80B,EAAI90B,EACXE,EAAGA,EAAI40B,EAAI50B,EAEnB,CAEA,iBAAAyS,CAAkB3S,EAAWE,GACzB,MAAM40B,EAAMp7B,KAAK4C,UAAUmrB,QAC3B,MAAO,CACHznB,EAAIA,EAAI80B,EAAI90B,EACZE,EAAIA,EAAI40B,EAAI50B,EAEpB,CAGA,UAAA6vB,GACIr2B,KAAK4C,UAAU6uB,WACnB,CAEA,MAAAngB,GACItR,KAAK4C,UAAU0O,UACnB,CAGA,IAAAysB,GACIC,cAAch+B,KAAKi9B,WACvB,E,87BCtLJ,mBAGA,aACA,aACA,UACA,aAIApM,QAAQoN,IAAI,WAmCZ,MAAMC,UAAuB,UAGzB,eAAW32B,GACP,MAAO,QACX,CACA,sBAAW42B,GACP,MAAO,eACX,CAMA,WAAA/8B,CAAYwB,EAAyBuY,GACjCyS,MAAMhrB,EAAWuY,EACrB,CAKA,aAAIzW,GACA,OAAOkpB,MAAMlpB,SACjB,CAGA,aAAA6W,GACIvb,KAAKoa,WAAa,IAAI,UAAgBpa,KAAK4a,kBAC/C,CASA,cAAAsH,CAAehhB,EAAkB2C,EAAoB0c,GACjD,MAAM5b,EAAI3E,KAAK0E,UACTmH,EAAQ0U,GAAc1U,OAASlH,EAAEqX,gBACjCvD,EAAS9T,EAAE8d,cAEjBvhB,EAAMmhB,OAASnhB,EAAM2V,MAAOwK,KAAKxY,EAAK8Z,YAAY9W,EAAOlH,EAAEsZ,cAAexF,IACrEzV,KAAK,cACd,CAQA,YAAAif,CAAa/gB,EAAkBqf,GAC3B,MAAM5b,EAAI3E,KAAK0E,UACTmH,EAAQ0U,GAAc1U,OAASlH,EAAEqX,gBACjClQ,EAASyU,GAAczU,QAAUnH,EAAEsX,iBACnCsO,EAAI5lB,EAAE8d,cAEN2b,EAASp+B,KAAK0E,UAAU25B,OAAOC,OAC/BC,EAAOH,GAAQI,OAAS,EAIxB7b,EAAc,IAAI4H,QAAQ1e,EAAQ0e,MAAM1e,OAAWA,KAAS0e,MAAMze,GAH3DsyB,GAAQK,QAAU,OAG2D5yB,EAAQ0yB,KAAQzyB,MAAWye,QAAQze,OAAYA,EAASye,MAAMA,UAAUA,QAE5J1mB,EAAS7D,KAAKmiB,gBACdre,GAAU,IAAAQ,YAAWT,EAAOC,SAC5B0U,GAAS,IAAAlU,YAAWT,EAAO+X,WAGjC1a,EAAMwhB,GAAKxhB,EAAM2V,MAAOwK,KAAKsB,GACxB3f,KAAKc,GACL0U,OAAO,CAAExT,MAAOwT,EAAQ3M,MAAO,IAGpC7L,KAAK0+B,WAAWx9B,EAAOA,EAAM2V,MAAYhL,EAAOC,EAAQjI,GAGxD3C,EAAM4hB,OAAS5hB,EAAM2V,MAAOwK,KAAKsB,GAC5B3f,KAAK,mBACLwV,OAAO,QACPvK,KAAK,CAAE,iBAAkB,SACzBmB,KAAKuE,OAAOzS,EAAMwhB,GAAGpc,KAAO,EAAGqN,OAAOzS,EAAMwhB,GAAGlc,KAAO,GACtDkS,MACT,CAUA,UAAAgmB,CAAWx9B,EAAkBkkB,EAAU1H,EAAWC,EAAW9Z,GACzD,MAAM86B,EAAU3+B,KAAK0E,UAAU25B,OAAOC,QAAQM,SAC9C,IAAKD,EAAS,OAEd,MAAME,EAASzZ,EAAM/D,KAAKsd,GACrB37B,MAAK,IAAAsB,YAAWT,EAAO+X,YACvBpD,OAAO,CAAExT,OAAO,IAAAV,YAAWT,EAAOgY,UAAqBhQ,MAAO,IAE7D4V,EAAU/D,EAAI1d,KAAK0E,UAAU25B,OAAOC,OAAQE,MAC5Cre,EAAUxC,EAAI3d,KAAK0E,UAAU25B,OAAOC,OAAQG,OAClDI,EAAOzvB,KAAKqS,EAAStB,GACrB0e,EAAOC,OACX,CAUA,2BAAAtc,CAA4BthB,EAAkBkC,EAAekc,EAAciB,EAAyD,MAChI,GAAKrf,GAAUkC,GAASlC,EAAMwhB,GAA9B,CAOA,GALU1iB,KAAK0E,UACY1E,KAAKmiB,gBACnBjhB,EAAMwhB,GAAGhV,OAGlBtK,EAAK+gB,mBAAoB,CACzB,MAAMS,EAAK5kB,KAAK++B,qBAAqBzf,EAAWpe,EAAMwhB,GAAI,OAAO,IAAApe,YAAWtE,KAAKoa,WAAW4kB,kBAC5F,GAAIpa,EAAI,CACJ,MAAMyB,EAAO,CACTlY,KAAM/K,EAAK+gB,mBACXF,GAAIjkB,KAAK6kB,mBAAmBzhB,EAAK+gB,mBAAmBW,UAAW1hB,EAAK+gB,oBACpEC,WAAYQ,EACZN,WAAYlhB,EAAK+gB,mBACjBE,aAAcO,GAElB5kB,KAAKwb,WAAW6K,GAChB,UAAQzN,WAAWgM,EAAI,kBAAmB,CAAEhB,WAAYxgB,EAAK+gB,mBAAoB/gB,SAC5EyV,WAAW+L,EAAI,CAAE5kB,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,OACrFjH,KAAK+kB,8BAA8B3hB,EAAK+gB,mBAAoBS,EAAe,EAC/E,CACJ,CAGA,GAAIxhB,EAAK4hB,eAAgB,CACrB,MAAMC,EAAKjlB,KAAK++B,qBAAqBzf,EAAWpe,EAAMwhB,GAAI,UAAU,IAAApe,YAAWtE,KAAKoa,WAAW4kB,kBAC/F,GAAI/Z,EAAI,CACJ,MAAMoB,EAAO,CACTlY,KAAM/K,EAAK4hB,eACXf,GAAIjkB,KAAK6kB,mBAAmBzhB,EAAK4hB,eAAed,QAAS9gB,EAAK4hB,gBAC9DZ,WAAYa,EACZX,WAAYlhB,EAAK4hB,eACjBX,aAAcY,GAElBjlB,KAAKwb,WAAW6K,GAChB,UAAQzN,WAAWqM,EAAI,kBAAmB,CAAErB,WAAYxgB,EAAK4hB,eAAgB5hB,SACxEyV,WAAWoM,EAAI,CAAEjlB,KAAKoB,YAAgC0Z,YAAa,QAAQ1X,EAAK6D,OACrFjH,KAAK+kB,8BAA8B3hB,EAAK4hB,eAAgBC,EAAe,EAC3E,CACJ,CAxCwC,CAyC5C,CAUA,oBAAA8Z,CAAqBzf,EAAc0B,EAAiBC,EAAwBjc,GACxE,MAAML,EAAI3E,KAAK0E,UACf,IAAK4a,IAAc0B,EAAQ,OAE3B,MAAMtT,EAAOsT,EAAOtT,OACdyT,EAAUxc,EAAEyc,mBACZ3I,EAAS9T,EAAE+c,iBACXpb,EAAIoH,EAAK7B,MAAQ,EACvB,IAAIrF,EACA6F,EAEJ,GAAI1H,EAAEuc,mBAAoB,CACtB,IAAIG,EAAOxY,EAAKyY,WAAWH,EAASA,EAAS,GAChC,QAATF,EAAgBza,GAAK2a,GAClB3a,EAAIkH,EAAK5B,OAAQuV,EAAOxY,EAAK0Y,WAAWF,EAAM,IAAKF,EAAU,EAAGA,EAAU,IAEjF9U,EAAUiT,EAAU+B,KAAKA,GACpBre,MAAK,IAAAsB,YAAWU,IAChBwT,OAAO,CAAExT,OAAO,IAAAV,YAAW,aAAcuH,MAAO,IAChD6L,UAAU,CAAEkJ,WAAYta,EAAI6a,EAAU,EAAGN,WAAYra,GAC9D,KAAO,CACH,MAAMmb,EAAa9Y,EAAK8P,OAAOF,GAC/BjS,EAAa,QAATya,EAAiB,EAAIvT,EAAK5B,OAE9BO,EAAUiT,EAAU+B,KAAKM,GACpB3e,MAAK,IAAAsB,YAAWU,IAChBwT,OAAO,CAAExT,OAAO,IAAAV,YAAW,aAAcuH,MAAO,IAChDuD,KAAK9I,EAAImS,EAAQjS,EAAIiS,EAC9B,CAGA,OADApM,EAAQ4B,KAAK,CAAEyS,MAAQ1gB,KAAKoB,YAAgC4Z,gBACrD3O,CACX,CAQA,YAAAmT,CAAaC,EAAe9C,EAAiB+C,EAAiB,GAC1D,MAAM/a,EAAI3E,KAAK0E,UACT6Q,EAAQoH,EAAMgD,qBAAuB,IACrC,MAAE9T,EAAK,OAAEC,GAAW9L,KAAKqc,gBAAgB9G,GAGzCtP,EAAOwZ,EAAWxZ,KAAK4F,EAAOC,GAC/B9I,MAAK,IAAAsB,YAAWK,EAAEib,kBAClBpH,OAAO,CAAExT,OAAO,IAAAV,YAAWK,EAAEkb,yBAA0BhU,MAAOlH,EAAEmb,2BAChErH,OAAO,IAGN3K,EAAM2R,EAAWrS,KAAKmI,GACvBhI,KAAK,CACFE,OAAQ9I,EAAEE,YACV2I,KAAM7I,EAAEI,UACRmX,OAAQ,UAEXlZ,MAAK,IAAAsB,YAAWK,EAAEqb,uBACvBlS,EAAI1K,KAAKgB,MAAM+T,WAAa,OAE5B,MAAM8H,EAA0B,CAAEC,IAAKja,EAAM6H,OAGvCmxB,EAAWnxB,EAAIJ,OAGfyS,GAAWrU,EAASmzB,EAASnzB,QAAU,EAGvCozB,EAAcrzB,EAAQ,EAAIlH,EAAE6X,kBAC5BiF,EAAU/B,EAAS/a,EAAE6X,kBAAoB/P,KAAKK,IAAI,GAAIoyB,EAAcD,EAASpzB,OAAS,GAc5F,OAXA5F,EAAKmJ,KAAKsQ,EAAQ,GAClB5R,EAAIsB,KAAKqS,EAAStB,GAGlB,UAAQvH,WAAW3S,EAAM,aAAc,CACnC0W,QACAvP,KAAMU,EACNrJ,SAAUzE,KACV0f,WACD7G,WAAW5S,EAAM,CAAEjG,KAAKoB,YAAgC0Z,YAAa,QAAQ9a,KAAKoD,KAAM6D,OAEpF,CAAEhB,OAAM6H,MAAKmS,SACxB,CAKA,QAAAjZ,GACI,IAAKhH,KAAKoD,KAAM,OAEhB,MAAMS,EAAS7D,KAAKmiB,gBACd/e,EAAOpD,KAAKoD,KACZlC,EAAQlB,KAAKqf,UAAUrf,KAAKgiB,gBAAgB5e,GAAOA,EAAK6D,IAC9DjH,KAAKua,UAAYrZ,EAEjB,MAAMqf,EAAevgB,KAAK4d,wBACrB2C,IAELvgB,KAAKiiB,aAAa/gB,EAAOqf,GACzBvgB,KAAKkiB,eAAehhB,EAAO2C,EAAQ0c,GACnCvgB,KAAKsgB,kBACLtgB,KAAK6hB,cAAc3gB,EAAM2V,OACzB7W,KAAKoiB,kBAAkBlhB,EAAM2V,MAAQ3V,EAAMmhB,OAASjf,GAEpDpD,KAAKsiB,iBAAiBphB,GACtBlB,KAAKuiB,qBAAqBhC,GAC1BvgB,KAAKwiB,4BAA4BthB,EAAOkC,EAAMlC,EAAM2V,MAAQ0J,GAChE,EAIJ,UAAe2d,C,wKC1Uf,mBACA,aACA,aACA,aACA,aAsJA,UA/IA,MACCpmB,QACAsW,UACAE,WACG5Y,WAAsB,EACzB,WAAAtU,GACCpB,KAAK8X,QAAU,IAAIxW,IACnBtB,KAAKouB,UAAY,IAAI9sB,IACrBtB,KAAKsuB,WAAa,IAAIjtB,GACvB,CAGA,OAAA2wB,CAAQ5uB,EAAWuuB,GAClB,MAAM1qB,EAAK0qB,GAAUvuB,EAAK6D,GACtBjH,KAAK8X,QAAQtW,IAAIyF,IACpB4pB,QAAQoB,KAAK,gBAAgBhrB,kCAE1B7D,EAAKR,YAAc5C,OAAMoD,EAAKR,UAAY5C,MAC9CA,KAAK8X,QAAQ9V,IAAIiF,EAAI7D,EACtB,CAEA,OAAA8uB,CAAQ5uB,EAAmC7B,EAAe,GACzD,IAAK,UAAe6B,GAAO,OAC3B,MAAMF,GAAO,aAAgBE,GAC7B,OAAKF,GACD3B,GAAKzB,KAAKgyB,QAAQ5uB,GACfA,QAFP,CAGD,CAEA,OAAAwD,CAAQtD,EAAmCgD,EAAWE,GACrD,MAAMpD,EAAOpD,KAAKkyB,QAAQ5uB,EAAM,GAChC,GAAKF,EAGL,OAFAA,EAAKgS,eAAepT,IAAIsE,EAAGE,GAC3BxG,KAAKgyB,QAAQ5uB,GACNA,CACR,CAEA,OAAAgc,CAAQnY,GACP,OAAIA,aAAcvG,QAAUuG,EAAGA,GAAWA,EACnCjH,KAAK8X,QAAQ7V,IAAIgF,EACzB,CAEA,cAAAwrB,CAAexrB,GACd,MAAM7D,EAAOpD,KAAK8X,QAAQ7V,IAAIgF,GACzB7D,IACLpD,KAAKmyB,UAAU/uB,GACfpD,KAAK8X,QAAQlW,OAAOqF,GACrB,CAEA,UAAAyrB,CAAWtvB,GACLA,GACLpD,KAAKyyB,eAAervB,EAAK6D,GAC1B,CAEA,SAAAkrB,CAAU/uB,GACT,MAAM4oB,EAAO5oB,EAAK+gB,oBAAoBW,YAClCkH,GAAMhH,gBAAgBgH,EAAKhH,eAAeoN,iBAC9C,MAAMG,EAAOnvB,EAAK4hB,gBAAgBd,UAC9BqO,GAAMpO,oBAAoBoO,EAAKpO,mBAAmBqO,mBAEtD,IAAK,IAAI7V,KAASvZ,EAAKsb,YACjB/B,EAA2BgH,oBAC9BhH,EAA2B2V,YAG/B,CAGA,SAAAjB,CAAU/tB,GACT,MAAMwR,EAAO,UAAiBxR,GAC9B,IAAKwR,EAAM,OACX,MAAMsc,EAAOtc,EAAKjN,IAAM,IAAIiN,EAAKjN,IAAI7H,KAAM8U,GAAQ,IAAI,UAAO9U,KAAM8U,GAEpE,OADA9U,KAAKouB,UAAUpsB,IAAIovB,EAAKnqB,GAAImqB,GACrBA,CACR,CAEA,SAAAE,CAAUrqB,GACT,OAAOjH,KAAKouB,UAAUnsB,IAAIgF,EAC3B,CAGA,UAAA6rB,GACC,MAAMC,EAAQ,IAAI,UAAa/yB,MAE/B,OADAA,KAAKsuB,WAAW7sB,IAAIsxB,GACbA,CACR,CAEA,UAAA9a,CAAWhR,GACV,OAAOiH,MAAMC,KAAKnO,KAAKsuB,YAAYvU,KAAK/V,GAAKA,EAAEiD,KAAOA,EACvD,CAEA,aAAAgsB,CAAcC,GACb,IAAInjB,EAGJ,OAFqCA,EAAV,iBAAhBmjB,EAAoClzB,KAAKiY,WAAWib,GAChDA,EACVnjB,GACL/P,KAAKsuB,WAAW1sB,OAAOmO,GAChB,GAFc,CAGtB,CAEA,WAAA8H,GACC,OAAO3J,MAAMC,KAAKnO,KAAKsuB,WACxB,CAMG,cAAAjD,CAAe+F,GACXpxB,KAAKouB,UAAUpsB,IAAIovB,EAAKnqB,GAAImqB,EAChC,CAKA,gBAAA7F,CAAiB6F,GACbpxB,KAAKouB,UAAUxsB,OAAOwvB,EAAKnqB,GAC/B,CAGH,QAAAgP,CAASkd,EAA2CC,EAA0B,GAC7E,IAAK,IAAK,CAAEhwB,KAASpD,KAAK8X,QAAQub,UAAWrzB,KAAK0yB,WAAWtvB,GAE7D,GAAI+vB,EAAKG,SACR,IAAK,IAAIlwB,KAAQ+vB,EAAKlwB,MACpBG,EAAKhC,YAAoBmyB,YAAYnwB,EAAMpD,WAG7C,IAAK,IAAIoD,KAAQ+vB,EAAKlwB,MACpBG,EAAKhC,YAAoB6U,SAAS7S,EAAMpD,KAG5C,CAEA,MAAA+V,CAAOud,GACN,MAAMrwB,EAAQ,GACd,IAAK,IAAK,CAAEG,KAASpD,KAAK8X,QACrB1U,EAAKowB,UAAUvwB,EAAMf,KAAKoxB,EAAWlwB,EAAKqwB,YAAcrwB,EAAK2S,UAElE,MAAO,CAAEud,WAAUrwB,QACpB,E,4FCvJD,MAAMmG,EACG+1B,OAER,WAAA/9B,GACCpB,KAAKm/B,OAAS,IAAI79B,GACnB,CAEA,YAAA89B,CAAan4B,EAAYo4B,GACxB,GAAIr/B,KAAKm/B,OAAO39B,IAAIyF,GAAK,OAEzB,MAAMq4B,EAAU78B,SAASC,cAAc,SACvC48B,EAAQr4B,GAAKA,EACbq4B,EAAQ57B,YAAc27B,EACtB58B,SAAS00B,KAAKr0B,YAAYw8B,GAC1Bt/B,KAAKm/B,OAAOn9B,IAAIiF,EAAIq4B,EACrB,CAEA,YAAAC,CAAat4B,GACZ,MAAMq4B,EAAUt/B,KAAKm/B,OAAOl9B,IAAIgF,GAC3Bq4B,IAELA,EAAQz5B,SACR7F,KAAKm/B,OAAOv9B,OAAOqF,GACpB,CAEA,YAAAyoB,CAAazoB,EAAYo4B,GACxB,MAAMC,EAAUt/B,KAAKm/B,OAAOl9B,IAAIgF,GAC3Bq4B,IAELA,EAAQ57B,YAAc27B,EACvB,CAEA,SAAAG,CAAUv4B,GACT,OAAOjH,KAAKm/B,OAAO39B,IAAIyF,EACxB,EAGG,EAAAmC,OAAAA,EAEJ,MAAMD,EAAS,IAAIC,EACnB,UAAeD,C,2LCsIf,mBACIkD,EACAue,EAAyB,CAAC,GAE1B,IAAK,UAAInjB,UAEL,YADA,IAAI0C,EAAU,sFAAsF2e,MAIxG,UAAOsW,aAAa,cAAeK,GAEnC,MAAM//B,EACiB,iBAAZ2M,EACD5J,SAASi9B,cAAc,IAAIrzB,KAC3BA,EAEV,IAAK3M,EAED,YADA,IAAIyK,EAAU,8DAA8D2e,MAIhF,IAAKrmB,SAASk9B,SAASjgC,GAEnB,YADA,IAAIyK,EAAU,2CAA2C2e,MAK7D,MAAM8F,EAAQnsB,SAASC,cAAc,OACrCksB,EAAMjsB,UAAY,wBAClBjD,EAAKoD,YAAY8rB,GAGjB,MAAM1V,EAAK,IAAI,UAAaxZ,EAAMkvB,EAAOhE,GAKzC,OAFA,IAAAtgB,kBAAiB4O,GAEVA,CACX,EAlNA,gBACA,aAIA,aAEA,aACA,aAEMumB,EAAsB,UA6H5B,MAAat1B,EAETy1B,IAMA,WAAAx+B,CAAYw+B,GACR5/B,KAAK4/B,IAAMA,CACf,CAGA,GAAA9W,GACI+H,QAAQC,MAAM,+BAA+B9wB,KAAK4/B,MACtD,CAGA,GAAAC,GACIhP,QAAQoB,KAAK,mBAAmBjyB,KAAK4/B,MACzC,CAGA,IAAAE,GACiC9/B,KAAK4/B,GACtC,EAzBJ,a,wKCxIA,mBACA,aAwBA,UAfA,SAAyBt8B,GACrB,MAAMy8B,EAAuB,UAAez8B,GAG5C,IAAKy8B,EAAO,OAGZ,MAAM38B,EAAO,IAAI,UAAQ28B,GAKzB,OAFA38B,EAAKgY,OAEEhY,CACX,C,4ECxBA,MAIM6E,EAIF,CAAE+3B,OAR4B,oBAAZC,WAA6BA,QAAQC,UAAU98B,KAQvDqE,UAPsB,oBAAXg2B,QAA8C,oBAAbh7B,SAOjC09B,YANW,oBAATC,MAAsD,mBAAvBA,KAAKC,eAQ/D,UAAep4B,C,wKCVf,mBAGA,WACA,UACA,aACA,aACA,SACA,aAIA,aACA,UACA,aAsIA,MAAMsC,UAAgB,UAElB4Z,mBAEAa,eAEA1hB,KAEA3C,UAEAkD,OAEAF,UAEA28B,aAEAlrB,eAEAnO,GAEAf,IAAwC,KAExCtD,UAAiC,KAEjCmN,QAEA8a,gBAAoC,WAGpCA,eAAmC,UAOnC,WAAAzpB,CAAYT,EAAiCiC,EAA0BuS,GACnEyY,QACA5tB,KAAKsD,KAAO,KACZtD,KAAK+P,QAAU,KACf/P,KAAKW,UAAYA,EACjBX,KAAK6D,OAAS,CACVC,QAAS,UACT8X,UAAW,UACXC,SAAU,UACV8J,SAAU,IAEd3lB,KAAKmkB,mBAAqB,IAAI,UAAW,KAAMnkB,KAAM,GACrDA,KAAKglB,eAAiB,IAAI,UAAWhlB,KAAM,KAAM,GACjDA,KAAK2D,UAAY,GACjB3D,KAAKsgC,aAAe,IAAIj/B,IACxBrB,KAAKoV,eAAiB,IAAI,UAAY,EAAG,GACzCpV,KAAKiH,IAAK,IAAAqO,aAAY,SAAU,CAAEpB,SAAU,6EACxCtR,IACA5C,KAAK4C,UAAYA,GAEjBuS,IACAnV,KAAKkG,IAAM,IAAI,EAAAlF,gBAAgBhB,KAAM,CACjCiH,GAAIjH,KAAKiH,GACTwU,mBAAoB,GACpB5E,MAAO1B,GACRvS,EAAW6B,UAEtB,CAEA,YAAI+uB,GACA,OAASxzB,KAAKmkB,oBAAoBW,SACtC,CAEA,YAAI3P,GACA,OAAQnV,KAAKkG,KAAyBgiB,UAC1C,CAEA,cAAAqY,GACI,OAAOvgC,KAAK+P,SAASK,WACzB,CAEA,UAAA6H,GACI,OAAOjY,KAAK+P,OAChB,CAEA,UAAA+iB,GACS9yB,KAAK+P,QAIV8gB,QAAQoB,KAAK,2BAHTjyB,KAAK+P,QAAU,IAAI,UAAa/P,KAIxC,CAEA,cAAAwgC,CAAepzB,GACNpN,KAAK+P,UACN/P,KAAK+P,QAAU,IAAI,UAAa/P,OAEpCA,KAAK+P,QAAQyF,QAAQpI,EACzB,CAEA,aAAA6lB,GACIjzB,KAAK+P,QAAU,KACf/P,KAAK4C,WAAWowB,kBACpB,CAEA,SAAAtU,GACI,OAAOxQ,MAAMC,KAAKnO,KAAKsgC,aAC3B,CAEA,cAAAG,CAAehgC,GAGX,OAFyCT,KAAK0e,YAAY3E,KAAK2mB,GAAOA,EAAIjI,YAAch4B,EAG5F,CAEA,QAAAkgC,CAASlgC,GACL,OAAOT,KAAKygC,eAAehgC,EAC/B,CAEA,aAAAmgC,CAAcngC,GACV,MAAMigC,EAAmC1gC,KAAKygC,eAAehgC,GAC7D,GAAIigC,EACA,OAAOA,EAAIzjB,UAGnB,CAEA,oBAAA4jB,CAAqBpgC,GACjB,MAAMigC,EAAmC1gC,KAAKygC,eAAehgC,GAC7D,GAAIigC,EACA,OAAOA,EAAI/gB,iBAGnB,CAEA,aAAA5Y,CAActG,EAAc8U,GACxB,MAAMmrB,EAAmC1gC,KAAKygC,eAAehgC,GAI7D,OAHIigC,GACAA,EAAI9H,SAASrjB,GAEVmrB,CACX,CAKA,IAAAtlB,GACIpb,KAAK8gC,KAAKv2B,EAAQw2B,QAAS,MACvB/gC,KAAKW,WACDX,KAAKW,UAAUya,MAAMpb,KAAKW,UAAUya,KAAK7a,KAAKP,KAAMA,KAAKW,UAAWX,MACpEA,KAAK4C,WACL5C,KAAK4C,UAAUovB,QAAQhyB,MAEvBA,KAAKW,UAAUqgC,SACfhhC,KAAKgS,GAAGzH,EAAQ02B,SAAU,KACtBjhC,KAAKW,WAAWqgC,QAAQzgC,KAAKP,KAAMA,KAAKW,UAAWX,SAI3D6wB,QAAQoB,KAAK,gBAAgBjyB,KAAKiH,6BAE1C,CAEA,gBAAAi6B,GACI,QAASlhC,KAAK6D,QAAQ8hB,UAAY3lB,KAAK6D,QAAQ8hB,UAAUtV,OAAS,CACtE,CAGA,eAAA8wB,GACI,OAAOnhC,KAAK6D,QAAQ8hB,UAAY,IACpC,CAGA,QAAAyb,GACI,OAAOphC,KAAK6D,MAChB,CAGA,gBAAAw9B,CAAiB1kB,GACRA,GAAOkU,QAAQoB,KAAK,4CACzBjyB,KAAKsgC,aAAa7+B,IAAIkb,EAC1B,CAGA,QAAA2kB,CAASnO,GAML,GALIA,EAAKoO,eAAcvhC,KAAK6D,OAAOC,QAAUqvB,EAAKoO,cAC9CpO,EAAKqO,iBAAgBxhC,KAAK6D,OAAO+X,UAAYuX,EAAKqO,gBAClDrO,EAAKsO,gBAAezhC,KAAK6D,OAAOgY,SAAWsX,EAAKsO,eAGhDtO,EAAKxN,UAAY,UAAewN,EAAKxN,UAAW,CAChD,MAAMvhB,EAAoB,UAAe+uB,EAAKxN,UAC9CjlB,OAAOib,OAAO3b,KAAK6D,OAAQ,CAAE8hB,SAAUwN,EAAKxN,UAAYvhB,EAC5D,CAEApE,KAAKmkB,oBAAqB,aAAQgP,EAAM,sBAAwB,IAAI,UAAW,KAAMnzB,KAAM,GAAQ,KACnGA,KAAKglB,gBAAiB,aAAQmO,EAAM,kBAAoB,IAAI,UAAWnzB,KAAM,KAAM,GAAS,KAExFmzB,EAAKxvB,YAAW3D,KAAK2D,UAAYwvB,EAAKxvB,WACtCwvB,EAAKrsB,WAAW9G,KAAK0hC,mBAAmBvO,EAAKrsB,WAC7CqsB,EAAK7vB,OACLtD,KAAKsD,KAAO6vB,EAAK7vB,KAEzB,CAKA,kBAAAo+B,CAAmB7vB,GACf,IAAK,IAAI8K,KAAS9K,EAAM,CACpB,IAAK8K,EAAMrZ,OAASqZ,EAAMlc,KAAM,CAC5BowB,QAAQoB,KAAK,mCAAmCpgB,EAAKyW,QAAQ3L,OAC7D,QACJ,CAEA,MAAMglB,EAA4C,EAAA75B,SAAS6U,EAAMrZ,MACjE,IAAKq+B,EAAkB,CACnB9Q,QAAQoB,KAAK,iCAAiCtV,EAAMrZ,SACpD,QACJ,CAEA,MAAMo9B,EAAgB,IAAIiB,EAC1BjB,EAAIzqB,SAAS0G,GACb+jB,EAAIt9B,KAAOpD,KACXA,KAAKqhC,iBAAiBX,EAC1B,CACA,OAAO1gC,IACX,CAEA,gBAAA4hC,CAAiBnhC,GACb,MAAMigC,EAAM,IAAK,EAAA54B,SAAsB,WAIvC,OAHA9H,KAAKqhC,iBAAiBX,GACtBA,EAAInI,QAAQ93B,GACZigC,EAAIt9B,KAAOpD,KACJ0gC,CACX,CAEA,YAAAmB,CAAaphC,GACT,MAAMigC,EAAM,IAAK,EAAA54B,SAAqB,UAItC,OAHA9H,KAAKqhC,iBAAiBX,GACtBA,EAAInI,QAAQ93B,GACZigC,EAAIt9B,KAAOpD,KACJ0gC,CACX,CAEA,UAAAoB,CAAWrhC,GACP,MAAMigC,EAAM,IAAK,EAAA54B,SAAqB,UAItC,OAHA9H,KAAKqhC,iBAAiBX,GACtBA,EAAInI,QAAQ93B,GACZigC,EAAIt9B,KAAOpD,KACJ0gC,CACX,CAGA,aAAAqB,CAActhC,GACV,MAAMigC,EAAM,IAAK,EAAA54B,SAAsB,WAIvC,OAHA9H,KAAKqhC,iBAAiBX,GACtBA,EAAInI,QAAQ93B,GACZigC,EAAIt9B,KAAOpD,KACJ0gC,CACX,CAEA,eAAAsB,CAAgBvhC,GAEZ,OADAT,KAAK6D,OAAO8hB,SAAWllB,EAChBT,IACX,CAEA,QAAAiiC,CAAS79B,GAGL,OADA1D,OAAOib,OAAO3b,KAAK6D,OAAQO,GACpBpE,IACX,CAGA,QAAAkiC,CAASp+B,EAAgB8X,EAAkBC,GAEvC,OADA7b,KAAKiiC,SAAS,CAAEn+B,UAAS8X,YAAWC,aAC7B7b,IACX,CAEA,YAAAmiC,CAAa/0B,GAET,OADApN,KAAK2D,UAAYyJ,EACVpN,IACX,CAGA,aAAAoiC,CAAcC,GACV,MAAMC,EAAWrJ,OAAOoJ,GAAY1Y,cAC9B4Y,EAAmB,KAAZD,EAAkB,EAAiB,KAAZA,GAAmC,QAAZA,EAAL,EAA2C,SAAZA,EAAsB,EAAI,EAS/G,OAPa,IAATC,EACAviC,KAAKmkB,mBAAqB,IAAI,UAAW,KAAMnkB,KAAM,GACrC,IAATuiC,EACPviC,KAAKglB,eAAiB,IAAI,UAAWhlB,KAAM,KAAM,GAEjD6wB,QAAQoB,KAAK,yDAEVjyB,IACX,CAEA,QAAAmxB,CAASqR,GACL,GAAKA,EAAL,CAGAxiC,KAAKsD,KAAOk/B,EAAMl/B,KAClBtD,KAAK2D,UAAY6+B,EAAM7+B,UACvB3D,KAAKoV,eAAiB,IAAI,UAAYotB,EAAMptB,eAAe9O,EAAGk8B,EAAMptB,eAAe5O,GAGnFxG,KAAK6D,OAAS,IAAK2+B,EAAM3+B,QAGzB7D,KAAKmkB,mBAAqBqe,EAAMre,mBAC1B,IAAI,UAAW,KAAMnkB,KAAM,GAC3B,KACNA,KAAKglB,eAAiBwd,EAAMxd,eACtB,IAAI,UAAWhlB,KAAM,KAAM,GAC3B,KAGNA,KAAKsgC,aAAap9B,QAClB,IAAK,IAAIyZ,KAAS6lB,EAAMlC,aAAc,CAClC,MACMmC,EAAW,IAAKC,EADL/lB,EAAMvb,aAIvBqhC,EAASlK,QAAQ5b,EAAM8b,WACnB,aAAc9b,GAAS,aAAc8lB,GACrCA,EAAS7J,SAASjc,EAAMM,YAExB,aAAcN,GAAS,aAAc8lB,GACrCA,EAAS/J,SAAS/b,EAAME,YAE5B7c,KAAKqhC,iBAAiBoB,EAC1B,CASA,OANAziC,KAAK4C,UAAY4/B,EAAM5/B,UAGvB5C,KAAKW,UAAY6hC,EAAM7hC,UAGhBX,IA1CW,CA2CtB,CAEA,oBAAA2iC,CACIh+B,EACAm0B,GAEA,MAAM8J,EAAuD,CAAC,EAC9D,IAAIC,EAAuCl+B,EAAEyhB,WAAazhB,EAAEmgB,UAAYngB,EAAEuf,QAE1E,IAAK2e,EAAW,OAAOD,EAEvB,GAAIC,aAAqBt4B,EAAS,CAE9B,GAAIuuB,EAAiB+J,EAAU57B,IAC3B,MAAO,CAAE7D,KAAM01B,EAAiB+J,EAAU57B,KAE9C27B,EAASx/B,KAAOy/B,EAAUpP,UAAUqF,EACxC,KAAO,CAEH,MAAM4H,EAAMmC,EAEZ,IAAIC,EACApC,EAAIt9B,OAEA0/B,EADAhK,EAAiB4H,EAAIt9B,KAAK6D,IACd6xB,EAAiB4H,EAAIt9B,KAAK6D,IAE1By5B,EAAIt9B,KAAKqwB,UAAUqF,IAGvC8J,EAASjmB,MAAQ,EACbmmB,IAAWF,EAASx/B,KAAO0/B,EACnC,CAEA,OAAOF,CACX,CAOA,SAAAnP,CAAUqF,EAAsD,CAAC,GAC7D,GAAIA,EAAiB94B,KAAKiH,IACtB,OAAO6xB,EAAiB94B,KAAKiH,IAIjC,MAAM87B,EAA6B,CAC/B97B,GAAIjH,KAAKiH,GACT3D,KAAMtD,KAAKsD,MAAQ,GACnBO,OAAQ,CAAEC,QAAS9D,KAAK6D,OAAOC,QAAS8X,UAAW5b,KAAK6D,OAAO+X,UAAWC,SAAU7b,KAAK6D,OAAOgY,SAAU8J,SAAU3lB,KAAK6D,OAAO8hB,UAChI/I,MAAO5c,KAAK2D,UACZwgB,wBAAoB9jB,EACpB2kB,oBAAgB3kB,EAChB+U,eAAgB,CAAE9O,EAAGtG,KAAKoV,eAAe9O,EAAGE,EAAGxG,KAAKoV,eAAe5O,GACnEuJ,QAAS/P,KAAK+P,SAASgG,WACvBqI,OAAQ,IAuBZ,OArBA0a,EAAiB94B,KAAKiH,IAAM87B,EAG5BA,EAAW3kB,OAASpe,KAAK0e,YAAY/J,IAAI+rB,GACrCA,EAAI3qB,OACE2qB,EAAI3qB,OAAO,EAAM+iB,GACjB,CACEr4B,KAAMigC,EAAIjI,UACVn1B,KAAMo9B,EAAIt/B,YAAYX,KACtB8U,MAAOmrB,EAAIzjB,SAAWyjB,EAAIzjB,gBAAa5c,IAInD0iC,EAAW5e,mBAAqBnkB,KAAKmkB,mBAC/BnkB,KAAK2iC,qBAAqB3iC,KAAKmkB,mBAAoB2U,QACnDz4B,EAEN0iC,EAAW/d,eAAiBhlB,KAAKglB,eAC3BhlB,KAAK2iC,qBAAqB3iC,KAAKglB,eAAgB8T,QAC/Cz4B,EAEC0iC,CACX,CAMA,MAAAhtB,GAMI,MAAMgtB,EAAa/iC,KAAKyzB,YAClBuP,EAA8B,CAAC,EAE/BC,EAAe7/B,IACjB,GAAI4/B,EAAK5/B,EAAK6D,IAAK,OAEnB,MAAMi8B,EAAY,IACX9/B,EACH+gB,mBAAoB/gB,EAAK+gB,mBAAqB,IAAK/gB,EAAK+gB,yBAAuB9jB,EAC/E2kB,eAAgB5hB,EAAK4hB,eAAiB,IAAK5hB,EAAK4hB,qBAAmB3kB,GAMvE,GAHA2iC,EAAK5/B,EAAK6D,IAAMi8B,EAGZA,EAAK/e,oBAAoB/gB,KAAM,CAC/B,MAAM+/B,EAAWD,EAAK/e,mBAAmB/gB,KACzC8/B,EAAK/e,mBAAmB/gB,KAAO+/B,EAASl8B,GACxCg8B,EAAYE,EAChB,CACA,GAAID,EAAKle,gBAAgB5hB,KAAM,CAC3B,MAAMggC,EAAWF,EAAKle,eAAe5hB,KACrC8/B,EAAKle,eAAe5hB,KAAOggC,EAASn8B,GACpCg8B,EAAYG,EAChB,CAGA,GAAIl1B,MAAM4lB,QAAQoP,EAAK9kB,QACnB,IAAK,IAAIsiB,KAAOwC,EAAK9kB,OAAQ,CACrBsiB,EAAIt9B,OACJ6/B,EAAYvC,EAAIt9B,MAChBs9B,EAAIt9B,KAAOs9B,EAAIt9B,KAAK6D,IAExB,IAAK,IAAIsK,KAAOmvB,EACRA,EAAInvB,IAAMnO,OACV6/B,EAAYvC,EAAInvB,IAAMnO,MACtBs9B,EAAInvB,GAAKnO,KAAOs9B,EAAInvB,GAAKnO,KAAK6D,GAG1C,GAKR,OADAg8B,EAAYF,GACLC,CACX,CAKA,mBAAOjK,CACH7iB,EACAmtB,EAAsC,CAAC,EACvCzgC,GAGA,GAAIygC,EAASntB,EAAKjP,IAAK,OAAOo8B,EAASntB,EAAKjP,IAExCrE,GAAaA,EAAUwc,QAAQlJ,EAAKjP,KACpCrE,EAAU6vB,eAAevc,EAAKjP,IAGlC,MAAM7D,EAAO,IAAImH,EAAQ,UAAe2L,EAAK5S,MAAwBV,GAYrE,GAXAQ,EAAK6D,GAAKiP,EAAKjP,GACf7D,EAAKgY,OACLhY,EAAKE,KAAO4S,EAAK5S,KACjBF,EAAKgS,eAAepT,IAAIkU,EAAKd,eAAe9O,EAAG4P,EAAKd,eAAe5O,GACnEpD,EAAKO,UAAYuS,EAAK0G,OAAS,GAC3B1G,EAAKnG,SAAWnN,IAChBQ,EAAK2M,QAAU,UAAakG,SAASC,EAAKnG,SAC1C3M,EAAK2M,QAAQmF,QAAU9R,EACvBA,EAAK2M,QAAQkF,oBAAsB,GAGnCiB,EAAKrS,OAAQ,CAEb,GAAIqS,EAAKrS,OAAO8hB,UAAY,UAAezP,EAAKrS,OAAO8hB,UAAW,CAC9D,MAAMvhB,EAAoB,UAAe8R,EAAKrS,OAAO8hB,UACrDjlB,OAAOib,OAAOvY,EAAKS,OAAQO,EAAO,CAAEuhB,SAAUzP,EAAKrS,OAAO8hB,UAC9D,CAGA,MAAM2d,EAAgC,CAAC,EACnCptB,EAAKrS,OAAOC,UAASw/B,EAASx/B,QAAUoS,EAAKrS,OAAOC,SACpDoS,EAAKrS,OAAO+X,YAAW0nB,EAAS1nB,UAAY1F,EAAKrS,OAAO+X,WACxD1F,EAAKrS,OAAOgY,WAAUynB,EAASznB,SAAW3F,EAAKrS,OAAOgY,UACtD3F,EAAKrS,OAAO8hB,WAAU2d,EAAS3d,SAAWzP,EAAKrS,OAAO8hB,UAC1DviB,EAAK6+B,SAASqB,EAClB,CAKA,GAHAD,EAASjgC,EAAK6D,IAAM7D,EAGhB8K,MAAM4lB,QAAQ5d,EAAKkI,QAAS,CAC5Bhb,EAAKk9B,aAAe,IAAIj/B,IACxB,IAAK,IAAIkiC,KAAWrtB,EAAKkI,OAAQ,CAC7B,MAAMujB,EAAmB,EAAA75B,SAASy7B,EAAQjgC,MAC1C,IAAKq+B,EAAkB,SAEvB,MAAMjB,EAAgB,IAAIiB,EAC1BjB,EAAIzqB,SAASstB,EAAS3gC,GACtB89B,EAAIt9B,KAAOA,EACXA,EAAKi+B,iBAAiBX,EAC1B,CACJ,CAeA,OAZIxqB,EAAKiO,oBAAoB/gB,OACzBA,EAAK+gB,mBAAqB,IAAI,UAAW,KAAM/gB,EAAM,GACrDA,EAAK+gB,mBAAmBqf,QAAQj5B,EAAQwuB,aAAa7iB,EAAKiO,mBAAmB/gB,KAAMigC,EAAUzgC,KAG7FsT,EAAK8O,gBAAgB5hB,MACrBA,EAAK4hB,eAAiB,IAAI,UAAW5hB,EAAM,KAAM,GACjDA,EAAK4hB,eAAegU,MAAMzuB,EAAQwuB,aAAa7iB,EAAK8O,eAAe5hB,KAAMigC,EAAUzgC,KAEnFA,GAAW0O,SAGRlO,CACX,CAEA,kBAAOmwB,CAAYJ,EAA4BvwB,GAC3C,OAAO5C,KAAK+4B,aAAa5F,EAAwB,CAAC,EAAGvwB,EACzD,CAEA,eAAOqT,CAAS+sB,EAA2BpgC,GACvC,MAAMK,EAA6B,CAAC,EAEpC,IAAK,MAAMgE,KAAM+7B,EACb//B,EAAMgE,GAAM,IAAK+7B,EAAK/7B,IAI1B,IAAK,MAAMA,KAAMhE,EAAO,CACpB,MAAMG,EAAOH,EAAMgE,GAGnB,GAAI7D,EAAK+gB,oBAAoB/gB,KAAM,CAC/B,MAAMqgC,EAAQrgC,EAAK+gB,mBAAmB/gB,KACtCA,EAAK+gB,mBAAqB,IACnB/gB,EAAK+gB,mBACR/gB,KAAMH,EAAMwgC,GAEpB,CACA,GAAIrgC,EAAK4hB,gBAAgB5hB,KAAM,CAC3B,MAAMqgC,EAAQrgC,EAAK4hB,eAAe5hB,KAClCA,EAAK4hB,eAAiB,IACf5hB,EAAK4hB,eACR5hB,KAAMH,EAAMwgC,GAEpB,CAGA,GAAIv1B,MAAM4lB,QAAQ1wB,EAAKgb,QACnB,IAAK,MAAMsiB,KAAOt9B,EAAKgb,OAAQ,CACH,iBAAbsiB,EAAIt9B,OACXs9B,EAAIt9B,KAAOH,EAAMy9B,EAAIt9B,OAEzB,IAAK,MAAMmO,KAAOmvB,EAAK,CACnB,MAAMgD,EAAQhD,EAAInvB,GACdmyB,GAAOtgC,MAA8B,iBAAfsgC,EAAMtgC,OAC5BsgC,EAAMtgC,KAAOH,EAAMygC,EAAMtgC,MACjC,CACJ,CAER,CAGA,MAAM1D,EAAOgB,OAAOqX,OAAO9U,GAAO8W,KAAK/B,IAAMA,EAAEmM,oBAAoB/gB,OAAS,KAC5E,OAAOpD,KAAK+4B,aAAar5B,EAAM,CAAC,EAAGkD,EACvC,EAKJ,UAAe2H,C,6LCnvBf,mBAEA,aACA,aAGMo5B,EAAyC,GAKzCh7B,EAAc,CAMhB,cAAAi7B,CAAe38B,EAAY8yB,GACvB,MAAM8J,EAAM,CACR58B,KACAyyB,MAAOK,EAAOL,MACd9c,MAAOmd,EAAOnd,MACdknB,aAAc/J,EAAO+J,cAAgB,MAAU,GAC/CC,WAAYhK,EAAOgK,YAAc,MAAU,GAC3CC,QAASjK,EAAOiK,SAAW,OAE/BL,EAAoBzhC,KAAK2hC,EAC7B,EAMA,gBAAAI,CAAiBh9B,GACb,MAAM0hB,EAAQgb,EAAoB5b,UAAU8b,GAAOA,EAAI58B,KAAOA,GAC1D0hB,GAAS,GAAGgb,EAAoB1b,OAAOU,EAAO,EACtD,GAyGK,EAAAhgB,YAAAA,EApGTA,EAAYi7B,eAAe,WAAY,CACnCI,QAAS,OACTpnB,MAAO,SACP8c,MAAQjmB,IACJ,MAAM7B,EAAS6B,EACV7B,EAAOhP,WACZgP,EAAOhP,UAAU8vB,WAAW9gB,MAIpCjJ,EAAYi7B,eAAe,cAAe,CACtCI,QAAS,KACTpnB,MAAO,aACP8c,MAAQjmB,IACJ,MAAM7B,EAAS6B,EAEf,GADegqB,OAAOyG,QAAQ,mCAAmCh2B,MAAMC,KAAKyD,EAAOkG,QAAQ0iB,QAAQnqB,iBAEnG,IAAK,IAAKpJ,EAAIgT,KAAMrI,EAAOkG,QACvBlG,EAAO6gB,eAAexrB,MAKlC0B,EAAYi7B,eAAe,eAAgB,CACvCI,QAAS,CAAC,KAAM,QAChBpnB,MAAO,cACP8c,MAAQjmB,IACJ,MAAM7B,EAAS6B,EACf,GAAI7B,aAAkB,UAClBA,EAAOkhB,aACPlhB,EAAO4uB,eAAe,iBACnB,GAAI5uB,aAAkB,UAAc,CACvC,MAAMmhB,EAAQnhB,EAAOkhB,aACf8K,EAAMhsB,EAAOlL,kBAAkBkL,EAAOyc,SAAS8V,OAAOnuB,OAAO1P,EAAGsL,EAAOyc,SAAS8V,OAAOnuB,OAAOxP,GACpGusB,EAAM3d,eAAepT,IAAI47B,EAAIt3B,EAAGs3B,EAAIp3B,GACpCusB,EAAMvd,QAAQ,WAClB,KAGR7M,EAAYi7B,eAAe,SAAU,CACjCI,QAAS,CAAC,KAAM,OAAQ,WACxBpnB,MAAO,OACP8c,MAAQjmB,IACAA,aAAa,UACbA,EAAE7Q,WAAW2rB,SAAS1C,OACfpY,aAAa,UACpBA,EAAEpC,gBAAgBkd,SAAS1C,OACpBpY,aAAa,WACpBA,EAAE8a,QAAQ1C,QAGlB,MAAApH,CAAOvgB,EAAIgV,EAAI2qB,GACXhT,QAAQoN,IAAI,gBACP/kB,EAAGqV,QAAQpC,WACXjoB,EAAmBkgC,UAAU3iC,IAAI,WAE1C,IAEJkH,EAAYi7B,eAAe,SAAU,CACjCI,QAAS,CAAC,KAAM,OAAQ,WACxBpnB,MAAO,OACP8c,MAAQjmB,IACAA,aAAa,UACbA,EAAE7Q,WAAW2rB,SAAStC,OACfxY,aAAa,UACpBA,EAAEpC,gBAAgBkd,SAAStC,OACpBxY,aAAa,WACpBA,EAAE8a,QAAQtC,QAGlB,MAAAxH,CAAOvgB,EAAIgV,EAAI2qB,GACXhT,QAAQoN,IAAI,gBACP/kB,EAAGqV,QAAQnC,WACXloB,EAAmBkgC,UAAU3iC,IAAI,WAE1C,IAEJkH,EAAYi7B,eAAe,kBAAmB,CAC1CI,QAAS,UACTpnB,MAAO,iBACP8c,MAAQjmB,IACJ,MAAM7B,EAAS6B,EACX7B,EAAOiE,iBAAmBjE,EAAOsD,mBAAmB,UACpDtD,EAAOsD,QAAQ+d,gBAEfrhB,EAAOP,eAAe4hB,cAAcrhB,MAKhDjJ,EAAYi7B,eAAe,cAAe,CACtCI,QAAS,OACTpnB,MAAO,YACP8c,MAAOjmB,IACH,MAAMrQ,EAAOqQ,EACRrQ,EAAKR,WACVQ,EAAKR,UAAUquB,UAAU7tB,MAKjC,UAAeugC,C,4ECxGf,6BACCrgC,EACA+gC,GAEAj8B,EAAgB9E,GAAMpB,KAAKmiC,EAC5B,EAEA,gCACC/gC,EACA+gC,GAEA,MAAM9J,EAAOnyB,EAAgB9E,GACvBsN,EAAI2pB,EAAKjS,QAAQ+b,IACZ,IAAPzzB,GAAU2pB,EAAKtS,OAAOrX,EAAG,EAC9B,EAEA,gCAAqCtN,GAChCA,EAAM8E,EAAgB9E,GAAM+M,OAAS,EACnC3P,OAAO85B,KAAKpyB,GAAuCjF,QAASmhC,IACjEl8B,EAAgBk8B,GAAGj0B,OAAS,GAE9B,EAhDA,MAAMjI,EAAsC,CAC3C6yB,OAAQ,GACRsJ,OAAQ,GACRC,KAAM,GACNC,MAAO,GACPC,iBAAkB,GAClBC,kBAAmB,GACnBC,aAAc,IAgBdlkC,OAAO85B,KAAKpyB,GAAuCjF,QAASG,IAC5Dm6B,OAAO15B,iBAAiBT,EAAOU,GAdhC,SAAqBV,EAAuBuhC,GAC3C,MAAMtK,EAAOnyB,EAAgB9E,GAC7B,GAAKi3B,EAAKlqB,OACV,IAAK,MAAMg0B,KAAM9J,EAChB,IACC8J,EAAGQ,EACJ,CAAE,MAAO/b,GACR+H,QAAQC,MAAM,yCAAyCxtB,MAAUwlB,EAClE,CAEF,CAIsCgc,CAAYxhC,EAAMU,MA0BxD,UAAeoE,C,4EC7Bf,UA9BA,MACS28B,UAAiE,CAAC,EAE1E,EAAA/yB,CAA2B6yB,EAAUG,GAGpC,OAFKhlC,KAAK+kC,UAAUF,KAAQ7kC,KAAK+kC,UAAUF,GAAS,IACpD7kC,KAAK+kC,UAAUF,GAAQ3iC,KAAK8iC,GACrBhlC,IACR,CAEA,GAAAiS,CAA4B4yB,EAAUG,GACrC,OAAKhlC,KAAK+kC,UAAUF,IACpB7kC,KAAK+kC,UAAUF,GAAS7kC,KAAK+kC,UAAUF,GAAQ3sB,OAAOyF,GAAKA,IAAMqnB,GAC1DhlC,MAF4BA,IAGpC,CAEA,IAAA8gC,CAA6B+D,EAAUI,GACtC,OAAKjlC,KAAK+kC,UAAUF,IACpB7kC,KAAK+kC,UAAUF,GAAQ1hC,QAAQ6hC,GAAWA,EAAQC,IAC3C,GAF4B,CAGpC,CAEA,IAAAC,CAA6BL,EAAUG,GACtC,MAAMG,EAAWF,IAChBD,EAAQC,GACRjlC,KAAKiS,IAAI4yB,EAAOM,IAGjB,OADAnlC,KAAKgS,GAAG6yB,EAAOM,GACRnlC,IACR,E,wKC9BD,kBAGA,aAyHA,UAnHA,MAEIsD,KAGAV,UAGAwiC,UAGAC,QAGAC,UAGAhjC,UAGAijC,YAA0B,GAM1B,WAAAnkC,CAAYwB,GACR5C,KAAK4C,UAAYA,EACjB5C,KAAKolC,UAAYplC,KAAKwlC,aACtBxlC,KAAKsD,KAAuC,UAAhCtD,KAAKolC,UAAU5iC,SAASc,KAAmB,EAAI,EAC3DtD,KAAKslC,UAAYtlC,KAAKolC,UAAU5iC,SAASijC,UAAY,GAGrDzlC,KAAKqlC,QAAU,IAAI,UAAOrlC,MAG1BA,KAAKsC,UAAYG,SAASC,cAAc,OACxC1C,KAAKsC,UAAUK,UAAY,eAC3B3C,KAAKsC,UAAU8B,MAAM2B,SAAW,WAChC/F,KAAKsC,UAAU8B,MAAMkB,KAAO,IAC5BtF,KAAKsC,UAAU8B,MAAMoB,IAAM,IAC3BxF,KAAKsC,UAAU8B,MAAMyH,MAAQ,MAC7B7L,KAAKsC,UAAU8B,MAAM0H,OAAS,OAC9B9L,KAAKsC,UAAU8B,MAAM2H,WAAa,wBAClC/L,KAAKsC,UAAU8B,MAAM4H,UAAY,OAGjCpJ,EAAUC,OAAOC,YAAY9C,KAAKsC,WAGhB,IAAdtC,KAAKsD,MAAYtD,KAAK0lC,sBACR,IAAd1lC,KAAKsD,MAAYtD,KAAK2lC,mBAC9B,CAKA,YAAAjW,CAAa7B,GACT,IAAKA,GAAOniB,SAAU,OAEtB,MAAM,oBAAEE,EAAmB,gBAAEK,GAAoB4hB,EAAMniB,SAEjDk6B,EAAc,CAAC1hC,EAAiBi7B,KAClC,GAAKA,EAEL,IAAK,MAAM5tB,KAAO4tB,EAAQ,CACtB,MAAMmF,EAAI/yB,EACJ9F,EAAI0zB,EAAOmF,QAEPjkC,IAANoL,IAECvH,EAAGE,MAAckgC,GAAK74B,EAE/B,GAGc,IAAdzL,KAAKsD,MAAYsiC,EAAY5lC,KAAKsC,UAAWsJ,GAC7C5L,KAAKqlC,SAAS/iC,WAAWsjC,EAAY5lC,KAAKqlC,QAAQ/iC,UAAW2J,EACrE,CAOA,UAAAu5B,GACI,OAAOxlC,KAAK4C,UAAUgoB,OAC1B,CAMA,mBAAA8a,GACuB1lC,KAAKslC,UACbniC,QAAQ0iC,IACf,MAAMlgB,EAAW,IAAI,UAAS3lB,KAAM6lC,GACpC7lC,KAAKulC,YAAYrjC,KAAKyjB,KAI1B3lB,KAAK4C,UAAUsD,IAAI8L,GAAG,QAAS,IAAMhS,KAAKqlC,QAAQl+B,OACtD,CAMA,iBAAAw+B,GACI3lC,KAAKsC,UAAU8B,MAAM8C,QAAU,OAC/B,MAAMjE,EAAQjD,KAAKslC,UACnBtlC,KAAKqlC,QAAQriC,KAAKC,EACtB,E,4ECjFA,EAAAoH,iBA1BJ,WACI,OAAOy7B,CACX,EAyBI,EAAAx7B,iBAhBJ,SAA0B4O,GACtB,OAAQ4sB,EAAS5sB,CACrB,EAeI,EAAA9O,mBAPJ,WACI,OAAQ07B,EAAS,IACrB,EA9BA,IAAIA,EAA0C,I,wKCN9C,mBACA,aAGA,WAEMC,EAA2D,CAAC,EA+GlE,UAAQ7zB,cAAc,cA7GtB,SAAuB7F,EAAkBwF,GAcrC,SAASm0B,EAAYhiC,GACjB,GAAkB,IAAd6N,EAAKvO,MAAcuO,EAAKzO,KAAM,CAC9B,MAAM8V,EAAoBrH,EAAKzO,KAAKR,UACpC,IAAKsW,EAAI,OAET,MAAM1M,EAAQ0M,EAAGxS,kBAAkB1C,EAAEuB,QAASvB,EAAEyB,SAC1CuT,EAAUnH,EAAKzO,KAAKgS,eAE1BqM,EAAUjV,EAAMlG,EAAI0S,EAAQ1S,EAC5B6Z,EAAU3T,EAAMhG,EAAIwS,EAAQxS,EAC5B0S,EAAGkX,UAAUve,EAAKzO,KAAMoJ,EAAMlG,EAAGkG,EAAMhG,GACtCqL,EAAKgF,MAAYioB,OAEtB,KAAO,CACH,MAAMpxB,EAAOrB,EAAQqB,OACrB+T,EAAUzd,EAAEuB,QAAUmI,EAAKpH,EAC3B6Z,EAAUnc,EAAEyB,QAAUiI,EAAKlH,CAC/B,CAEAupB,EAAa,EAGb,UAAUxuB,SAAS,YAEnBkB,SAASsB,iBAAiB,YAAakiC,GACvCxjC,SAASsB,iBAAiB,UAAWmiC,GAEnB,IAAdr0B,EAAKvO,MAAcuO,EAAKs0B,QAAQt0B,EAAKs0B,OAAOniC,EACpD,CAGA,SAASiiC,EAAYjiC,GACjB,IAAK+rB,EAAY,CACb,MAAM6C,EAAK5uB,EAAEoiC,WAAa,EACpBvT,EAAK7uB,EAAEqiC,WAAa,GACtB55B,KAAK+gB,IAAIoF,GAAM,GAAKnmB,KAAK+gB,IAAIqF,GAAM,KAAG9C,EAAa,EAC3D,CACA,GAAKA,EAEL,GAAkB,IAAdle,EAAKvO,MAAcuO,EAAKzO,MAAQyO,EAAKzO,gBAAgB,UAAS,CAC9D,MAAM8V,EAAmBrH,EAAKzO,KAAKR,UACnC,IAAKsW,EAAI,OAGT,MAAMotB,EAAUptB,EAAGxS,kBAAkB1C,EAAEuB,QAASvB,EAAEyB,SAC5C8gC,EAAOD,EAAQhgC,EAAImb,EACnB+kB,EAAOF,EAAQ9/B,EAAI2Z,EACzBtO,EAAKzO,KAAKgS,eAAepT,IAAIukC,EAAMC,GACnCttB,EAAGmX,WAAWkW,EAAMC,GACpBttB,EAAGuY,UAEH,MAAMja,EAAY0B,EAAGD,kBAAkBstB,EAAMC,GAC7Cn6B,EAAQ4B,KAAK,CAAEyJ,UAAW,aAAaF,EAAUlR,MAAMkR,EAAUhR,YAAY0S,EAAGzI,eAEhFoB,EAAKzO,KAAK09B,KAAK,YAAa,KAChC,MAAO,GAAkB,IAAdjvB,EAAKvO,MAAcuO,EAAK40B,OAAQ,CACvC,MAAMF,EAAOviC,EAAEuB,QAAUkc,EACnB+kB,EAAOxiC,EAAEyB,QAAU0a,EACzB9T,EAAQ+C,KAAKm3B,EAAMC,GACnB30B,EAAK40B,OAAO,CAAEngC,EAAGigC,EAAM//B,EAAGggC,GAC9B,MAAO,GAAkB,IAAd30B,EAAKvO,MAAcuO,EAAK5K,GAAI,CACnC,MAAMs/B,EAAOviC,EAAEuB,QAAUkc,EACnB+kB,EAAOxiC,EAAEyB,QAAU0a,EACzB9T,EAAQ+C,KAAKm3B,EAAMC,GACnBT,EAAel0B,EAAK5K,IAAM,CAAEX,EAAGigC,EAAM//B,EAAGggC,EAC5C,CACJ,CAEA,SAASN,EAAUliC,GAQf,GAPAvB,SAASkD,oBAAoB,YAAasgC,GAC1CxjC,SAASkD,oBAAoB,UAAWugC,GAGxC,UAAUvkC,YAAY,YAEJ,IAAdkQ,EAAKvO,MAAcuO,EAAK60B,SAAS70B,EAAK60B,QAAQ1iC,GAChC,IAAd6N,EAAKvO,MAAcuO,EAAKzO,MAAQyO,EAAKzO,gBAAgB,UAAS,CAC9D,MAAM8V,EAAmBrH,EAAKzO,KAAKR,UACnC,IAAKsW,EAAI,OACTA,EAAGyS,aACHzS,EAAGoX,SACP,CACAP,EAAa,CACjB,CAhGA,IAAIA,EAAa,EACbtO,EAAU,EACVtB,EAAU,EAGd,MAAMwmB,EAAsB90B,EAAKkR,QAAU1W,EAG3C,GAAkB,IAAdwF,EAAKvO,MAAcuO,EAAK5K,IAAM8+B,EAAel0B,EAAK5K,IAAK,CACvD,MAAM22B,EAAMmI,EAAel0B,EAAK5K,IAC5B22B,GAAKvxB,EAAQ+C,KAAKwuB,EAAIt3B,EAAGs3B,EAAIp3B,EACrC,CA0FA,OAHAmgC,EAAWvjC,KAAKW,iBAAiB,YAAaiiC,GAGvC,KACHW,EAAWvjC,KAAKuC,oBAAoB,YAAaqgC,GACjDvjC,SAASkD,oBAAoB,YAAasgC,GAC1CxjC,SAASkD,oBAAoB,UAAWugC,GAEhD,E,4EC7FA,UAfA,SAAoBU,EAAgBC,GACnC,IAAIC,EAAQ,EAWZC,sBATA,SAAS9S,IACR6S,IACIA,GAASF,EACZC,IAEAE,sBAAsB9S,EAExB,EAGD,C,4ECbA,UAFyD,CAAC,C,mMCL1D,mBACA,aAuCA,MAAM+S,EACMnc,eAA2C,KAC3Coc,MAA6B,KAC7BC,OACAtc,QAAkC,KAClCuc,WACAC,OACAC,sBAA6C,KAIrD,WAAAjmC,GACIpB,KAAKknC,OAASzkC,SAASC,cAAc,OACrC1C,KAAKknC,OAAOvkC,UAAY,oBACxB3C,KAAKknC,OAAO9iC,MAAM2B,SAAW,WAC7B/F,KAAKknC,OAAO9iC,MAAM8C,QAAU,OAC5BzE,SAASM,KAAKD,YAAY9C,KAAKknC,QAE/BlnC,KAAKmnC,WAAa,CAAE7gC,EAAG,EAAGE,EAAG,EAAGqF,MAAO,EAAGC,OAAQ,GAClD9L,KAAKonC,OAAS,CAAExU,GAAI,EAAGC,GAAI,EAC/B,CAOA,IAAAzjB,CAAKwjB,EAAYC,GACb7yB,KAAKonC,OAAOxU,GAAKA,EACjB5yB,KAAKonC,OAAOvU,GAAKA,EACjB7yB,KAAKsnC,gBACT,CAKQ,cAAAA,GACJ,MAAM,EAAEhhC,EAAC,EAAEE,EAAC,OAAEsF,GAAW9L,KAAKmnC,YACxB,GAAEvU,EAAE,GAAEC,GAAO7yB,KAAKonC,OACxBpnC,KAAKknC,OAAO9iC,MAAMkB,KAAO,GAAGgB,EAAIssB,MAChC5yB,KAAKknC,OAAO9iC,MAAMoB,IAAM,GAAGgB,EAAIsF,EAAS+mB,KAC5C,CAMA,UAAA0U,CAAWtc,GACPjrB,KAAKknC,OAAO9/B,UAAY6jB,CAC5B,CAOA,WAAAnoB,CAAYuJ,GAER,OADArM,KAAKknC,OAAOpkC,YAAYuJ,GACjBA,CACX,CAOA,IAAA5I,CAAKwjC,EAAqBrc,GACtB,IAAKqc,EAAM9xB,SAAU,OACrBnV,KAAKmH,OACLnH,KAAKinC,MAAQA,EACTrc,IAAS5qB,KAAK4qB,QAAUA,GACxB5qB,KAAKqnC,uBAAuBrnC,KAAKqnC,wBACrCrnC,KAAKqnC,sBAAwB,KAC7B,MAAMG,EAAYP,EAAM9xB,SAAS/R,KAAK+C,wBA2BtC,GA1BAnG,KAAKmnC,WAAa,CACd7gC,EAAGkhC,EAAUliC,KAAOm4B,OAAOgK,QAC3BjhC,EAAGghC,EAAUhiC,IAAMi4B,OAAOiK,QAC1B77B,MAAO27B,EAAU37B,MACjBC,OAAQ07B,EAAU17B,QAGtB9L,KAAKonC,OAAS,CAAExU,GAAI,EAAGC,GAAI,GAE3B7yB,KAAKknC,OAAO9/B,UAAY,GACpBwjB,EAAQ/e,QAAO7L,KAAKknC,OAAO9iC,MAAMyH,MAAQ,GAAG+e,EAAQ/e,WACxD7L,KAAKknC,OAAO9iC,MAAM8C,QAAU,QAGxB0jB,EAAQkP,OACRlP,EAAQkP,MAAM32B,QAAS4xB,IACnB,MAAM7wB,EAAKzB,SAASC,cAAc,OAClCwB,EAAGvB,UAAY,oBACfuB,EAAGR,YAAcqxB,EAAKnY,MACtB1Y,EAAGyjC,QAAU,KACT/c,EAAQoP,WAAWjF,EAAKxf,MAAOwf,GAC/B/0B,KAAKmH,QAETnH,KAAKknC,OAAOpkC,YAAYoB,KAG5B+iC,aAAiB,UAAS,CAE1B,MAAM/tB,EAAK+tB,EAAMrkC,UACjB,IAAIiD,EAASqT,GAAIsX,gBAAgB,KACzBxwB,KAAKinC,QAAUA,EAInBjnC,KAAKk6B,YAAY+M,GAHbphC,MAKR7F,KAAKqnC,sBAAwBxhC,CACjC,CACA,GAAIohC,aAAiB,UAAO,CAExB,MAAM/tB,EAAK+tB,EAAM7jC,KAAMR,UACvB,IAAIiD,EAASqT,GAAIsX,gBAAgB,KAC7B,GAAIxwB,KAAKinC,QAAUA,EAGf,OAFApW,QAAQoN,IAAI,wBACZp4B,IAGJgrB,QAAQoN,IAAI,YACZj+B,KAAKmH,SAETnH,KAAKqnC,sBAAwBxhC,CACjC,CACA7F,KAAKsnC,iBACLN,EAAkBlb,QAAU9rB,IAChC,CAKA,IAAAmH,GACQ6/B,EAAkBlb,UAAY9rB,OAClCA,KAAKknC,OAAO9iC,MAAM8C,QAAU,OAC5BlH,KAAKknC,OAAO9/B,UAAY,GACxBpH,KAAKinC,MAAQ,KACbjnC,KAAK4qB,QAAU,KACfoc,EAAkBlb,QAAU,KACxB9rB,KAAKqnC,uBAAuBrnC,KAAKqnC,wBACrCrnC,KAAKqnC,sBAAwB,KACjC,CAMA,WAAAnN,CAAY+M,GACJjnC,KAAKinC,QAAUA,GACfjnC,KAAKmH,MAEb,CAGA,SAAAygC,GACI,OAAOZ,EAAkBlb,UAAY9rB,IACzC,CAGA,QAAA25B,GACI,OAAO35B,KAAKinC,KAChB,CAGA,iBAAOY,GACH,OAAOb,EAAkBlb,OAC7B,EAMK,EAAAkb,kBAAAA,EAFT,MAAMc,EAAoB,IAAId,EAC9B,UAAec,C,4EC3Mf,UAD8C,CAAC,C,wKCP/C,WA0DA,QAAQ51B,cAAc,eAnDtB,SAAuB7F,EAAkBwF,GASrC,SAASk2B,EAAc1iC,GACnBA,EAAGS,iBAEH,MAAMoT,EAAKnJ,EAAQsB,eACb2lB,EAAMjnB,EAAQqF,eAGd4yB,EAAY9uB,EAAGxS,kBAAkBrB,EAAGE,QAASF,EAAGI,SACtDwiC,EAAYjR,EAAI1wB,EAAI0hC,EAAU1hC,EAC9B4hC,EAAYlR,EAAIxwB,EAAIwhC,EAAUxhC,EAE9B/D,SAASsB,iBAAiB,cAAeokC,GACzC1lC,SAASsB,iBAAiB,YAAaqkC,EAC3C,CAEA,SAASD,EAAc9iC,GACnB,MAAM6T,EAAKnJ,EAAQsB,eAGb22B,EAAY9uB,EAAGxS,kBAAkBrB,EAAGE,QAASF,EAAGI,SAGtDsK,EAAQqF,eAAepT,IAAIgmC,EAAU1hC,EAAI2hC,EAAWD,EAAUxhC,EAAI0hC,GAElEhvB,EAAGgM,iBACP,CAIA,SAASkjB,IACL3lC,SAASkD,oBAAoB,cAAewiC,GAC5C1lC,SAASkD,oBAAoB,YAAayiC,EAC9C,CAxCA,MAAMr4B,EAAU8B,EAAK9B,QACrB,IAAKA,EAAS,MAAO,OAErB,IAEIk4B,EAAY,EACZC,EAAY,EAuChB,OAHA77B,EAAQjJ,KAAKW,iBAAiB,cAAegkC,GAGtC,KACH17B,EAAQjJ,KAAKuC,oBAAoB,cAAeoiC,GAExD,E,6FCzCA,MAAMM,EACMC,SAA2B,GAC3BC,cAA8C,IAAIjnC,IAG1D,aAAA4Q,CAAc5O,EAAiBklC,GAE3B,OADAxoC,KAAKuoC,cAAcvmC,IAAIsB,EAAMklC,GACtBxoC,IACX,CACA,UAAA6Y,CAAW3U,EAAaukC,GACpB,IAAKA,EAAM,OAAOzoC,KAClB,MAAM0oC,EAAUx6B,MAAM4lB,QAAQ2U,GAAQA,EAAO,CAACA,GAG9C,IAAK,MAAME,KAAO3oC,KAAKsoC,SACnB,GAAIK,EAAIzkC,KAAOA,EACX,IAAK,MAAMuP,KAAKi1B,EACPC,EAAIF,KAAK/gB,SAASjU,IAAIk1B,EAAIF,KAAKvmC,KAAKuR,GAIrD,OAAOzT,IACX,CAEA,YAAAga,CAAa4uB,GACT,IAAIC,EAAY,EAWhB,OAVA7oC,KAAKsoC,SAAWtoC,KAAKsoC,SAASpwB,OAAOywB,GAC7BA,EAAIF,KAAK/gB,SAASkhB,IACdD,EAAIG,YACJH,EAAIG,YACJD,EAAY,GAET,GAEJ,GAEJA,EAAY,EAAI,CAC3B,CAGA,UAAAjwB,CAAW1U,EAAa6kC,EAAgCl3B,GACpD,MAAMm3B,EAAW96B,MAAM4lB,QAAQiV,GAASA,EAAQ,CAACA,GACjD,IAAK,MAAMzlC,KAAQ0lC,EAAU,CACzB,MAAMF,EAAY9oC,KAAKipC,aAAa/kC,EAAIZ,EAAMuO,GAC9C7R,KAAKsoC,SAASpmC,KAAK,CACfumC,KAAM,GACNvkC,KACAZ,OACAuO,OACAi3B,aAER,CACA,OAAO9oC,IACX,CAGA,OAAAyxB,GACI,IAAK,MAAMkX,KAAO3oC,KAAKsoC,SACfK,EAAIG,WAAWH,EAAIG,YACvBH,EAAIG,UAAY9oC,KAAKipC,aAAaN,EAAIzkC,GAAIykC,EAAIrlC,KAAMqlC,EAAI92B,KAEhE,CAIA,cAAAq3B,CAAehlC,EAAaZ,GACxB,IAAIulC,EAAY,EAChB,IAAK,MAAMF,KAAO3oC,KAAKsoC,SACfK,EAAIzkC,KAAOA,GAAQZ,GAAQqlC,EAAIrlC,OAASA,IACpCqlC,EAAIG,YACJH,EAAIG,YACJD,EAAY,GAGhB7oC,KAAKsoC,SAAWtoC,KAAKsoC,SAASpwB,OAAOqS,GAAKA,IAAMoe,IAGxD,OAAOE,EAAY,EAAI,CAC3B,CAEQ,YAAAI,CAAa/kC,EAAaZ,EAAiBuO,GAC/C,MAAM22B,EAAUxoC,KAAKuoC,cAActmC,IAAIqB,GACvC,IAAKklC,EAAS,OACd,MAAMM,EAAYN,EAAQtkC,EAAI2N,GAC9B,OAAOi3B,aAAqBK,SAAWL,OAAYzoC,CACvD,EAKK,EAAAgoC,QAAAA,EAFT,MAAMe,EAAU,IAAIf,EACpB,UAAee,C,wBC3Ff,SAASC,EAAkBC,EAAIC,EAAIC,EAAIC,GACrC,IACIC,EAAOJ,EAAKE,EAAKD,EAAKE,EAS1B,OAHIC,EAAO,IAAOA,EAAO,GACrBA,GAAO,IAAOA,GAAO,IARbJ,EAAKG,EAAKF,EAAKC,EAAK,GAAM,EAAI,GAU5B/8B,KAAKk9B,KAAKD,EAC1B,CA2EA,SAASE,EAAqBC,EAAQC,GACpC,IAAIC,EAAQ,EAAE,EAAIt9B,KAAK2vB,IAAI0N,EAAY,GAEnCE,EAAKv9B,KAAKogB,IAAIgd,GACdI,EAAKx9B,KAAKqgB,IAAI+c,GACdK,EAAKz9B,KAAKogB,IAAIgd,EAASC,GACvBK,EAAK19B,KAAKqgB,IAAI+c,EAASC,GAE3B,MAAO,CAAEE,EAAIC,EAAID,EAAKC,EAAGF,EAAOE,EAAKD,EAAGD,EAAOG,EAAKC,EAAGJ,EAAOI,EAAKD,EAAGH,EAAOG,EAAIC,EACnF,CA1GA,IAAIC,EAAgB,EAAV39B,KAAKmgB,GA4Gf/sB,EAAOD,QAAU,SAAaoqC,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,EAAI/d,EAAIC,EAAI+d,GAC5D,IAAIC,EAAU/9B,KAAKqgB,IAAIyd,EAAMH,EAAM,KAC/BK,EAAUh+B,KAAKogB,IAAI0d,EAAMH,EAAM,KAI/BM,EAAOD,GAAST,EAAGE,GAAI,EAAIM,GAASP,EAAGE,GAAI,EAC3CQ,GAAOH,GAASR,EAAGE,GAAI,EAAIO,GAASR,EAAGE,GAAI,EAE/C,GAAY,IAARO,GAAqB,IAARC,EAEf,MAAO,GAGT,GAAW,IAAPpe,GAAmB,IAAPC,EAEd,MAAO,GAMTD,EAAK9f,KAAK+gB,IAAIjB,GACdC,EAAK/f,KAAK+gB,IAAIhB,GAEd,IAAIoe,EAAUF,EAAMA,GAAQne,EAAKA,GAAOoe,EAAMA,GAAQne,EAAKA,GACvDoe,EAAS,IACXre,GAAM9f,KAAK2gB,KAAKwd,GAChBpe,GAAM/f,KAAK2gB,KAAKwd,IAMlB,IAAIC,EAhHN,SAAwBb,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,EAAI/d,EAAIC,EAAIge,EAASC,GAO/D,IAAIC,EAAOD,GAAST,EAAGE,GAAI,EAAIM,GAASP,EAAGE,GAAI,EAC3CQ,GAAOH,GAASR,EAAGE,GAAI,EAAIO,GAASR,EAAGE,GAAI,EAE3CW,EAAUve,EAAKA,EACfwe,EAAUve,EAAKA,EACfwe,EAASN,EAAMA,EACfO,EAASN,EAAMA,EAOfO,EAAYJ,EAAQC,EAAUD,EAAQG,EAAWF,EAAQC,EAEzDE,EAAW,IAEbA,EAAW,GAGbA,GAAeJ,EAAQG,EAAWF,EAAQC,EAG1C,IAAIG,GAFJD,EAAWz+B,KAAK2gB,KAAK8d,IAAab,IAAOC,GAAM,EAAI,IAE7B/d,EAAGC,EAAKme,EAC1BS,EAAMF,GAAY1e,EAAGD,EAAKme,EAO1B/jB,EAAK8jB,EAAQU,EAAMX,EAAQY,GAAOpB,EAAGE,GAAI,EACzCtjB,EAAK4jB,EAAQW,EAAMV,EAAQW,GAAOnB,EAAGE,GAAI,EAMzCkB,GAAQX,EAAMS,GAAO5e,EACrB+e,GAAQX,EAAMS,GAAO5e,EACrB+e,IAAQb,EAAMS,GAAO5e,EACrBif,IAAQb,EAAMS,GAAO5e,EAErBqd,EAASR,EAAkB,EAAG,EAAGgC,EAAKC,GACtCxB,EAAcT,EAAkBgC,EAAKC,EAAKC,EAAKC,GASnD,OAPW,IAAPlB,GAAYR,EAAc,IAC5BA,GAAeM,GAEN,IAAPE,GAAYR,EAAc,IAC5BA,GAAeM,GAGV,CAAEzjB,EAAIC,EAAIijB,EAAQC,EAC3B,CAmDW2B,CAAezB,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,EAAI/d,EAAIC,EAAIge,EAASC,GAE7D7hB,EAAS,GACTihB,EAASgB,EAAG,GACZf,EAAce,EAAG,GAKjBlgB,EAAWle,KAAKK,IAAIL,KAAKkD,KAAKlD,KAAK+gB,IAAIsc,IAAgBM,EAAM,IAAK,GACtEN,GAAenf,EAEf,IAAK,IAAI/Z,EAAI,EAAGA,EAAI+Z,EAAU/Z,IAC5BgY,EAAO1mB,KAAK0nC,EAAqBC,EAAQC,IACzCD,GAAUC,EAMZ,OAAOlhB,EAAOjU,IAAI,SAAU+2B,GAC1B,IAAK,IAAI96B,EAAI,EAAGA,EAAI86B,EAAMr7B,OAAQO,GAAK,EAAG,CACxC,IAAItK,EAAIolC,EAAM96B,EAAI,GACdpK,EAAIklC,EAAM96B,EAAI,GAOd+6B,EAAKlB,GAJTnkC,GAAKimB,GAIgBie,GAHrBhkC,GAAKgmB,GAIDof,EAAKpB,EAAQlkC,EAAImkC,EAAQjkC,EAG7BklC,EAAM96B,EAAI,GAAK+6B,EAAKd,EAAG,GACvBa,EAAM96B,EAAI,GAAKg7B,EAAKf,EAAG,EACzB,CAEA,OAAOa,CACT,EACF,C,8BCzLA7rC,EAAOD,QAAU,EAAjB,K,s6CCKA,mBA6CI,EAAAuL,kBA7CG,UACP,mBA6CI,EAAArK,SA7CG,UACP,mBA6CI,EAAA0I,eA7CG,UACP,mBA6CI,EAAAC,WA7CG,UACP,mBA6CI,EAAAC,YA7CG,UACP,mBA6CI,EAAAC,MA7CG,UA8CH,yEA7CsD,EAAAC,UAAU,IA8ChE,uEA7CA,EAAA9B,QAAQ,IA8CR,0EA9CU,EAAA+B,WAAW,IA+CrB,8EA/CuB,EAAAC,eAAe,IAgDtC,wEAhDwC,EAAAC,SAAS,IAqDjD,+EArDmD,EAAAsoB,gBAAgB,IAGvE,mBAqDI,EAAAroB,OArDG,UAsDH,wEArDA,EAAAG,SAAS,IAGb,gBAoDI,iFApDK,EAAAC,kBAAkB,IAqDvB,yDAAAnI,IAAA,kBArDyB,EAAAoI,gBAAgB,IAsDzC,+EAtD2C,EAAAC,gBAAgB,IAC/D,mBAsDI,EAAAC,QAtDG,UACP,mBAsDI,EAAAshC,eAtDG,UACP,mBAsDI,EAAAnhC,aAtDG,UACP,mBAsDI,EAAAijB,gBAtDG,UAIP,gBAuDI,sEAvDc,EAAA0a,OAAO,IAOzB,MAMMrgC,EANN,UAM8B,QAC9B,UAAeA,EA2Df,cAAS,gFAAA8jC,OAAO,IAEhB,cAAS,2EAAAA,OAAO,IAChB,cAAS,mFAAAA,OAAO,IAChB,cAAS,0EAAAA,OAAO,IAChB,cAAU,kFAAA9E,iBAAiB,IAC3B,cAAS,gFAAAhmC,eAAe,IACxB,cAAS,mFAAA8qC,OAAO,IAChB,cAAS,+EAAAA,OAAO,IAGhB,cAAS,uFAAAA,OAAO,IAChB,cAAS,kFAAAA,OAAO,G,4EC/GhB,MAAMpiC,EAELpD,EAEAE,EAOA,WAAApF,CAAYkF,EAAY,EAAGE,EAAY,GACtCxG,KAAKsG,EAAIA,EACTtG,KAAKwG,EAAIA,CACV,CAOA,GAAAxE,CAAIsE,EAAWE,GACdxG,KAAKsG,EAAIA,EACTtG,KAAKwG,EAAIA,CACV,CAMA,KAAAulC,GACC,OAAO,IAAIriC,EAAY1J,KAAKsG,EAAGtG,KAAKwG,EACrC,CAOA,UAAAwlC,CAAWxJ,GACV,MAAM5P,EAAK5yB,KAAKsG,EAAIk8B,EAAMl8B,EACpBusB,EAAK7yB,KAAKwG,EAAIg8B,EAAMh8B,EAC1B,OAAOiG,KAAK2gB,KAAKwF,EAAKA,EAAKC,EAAKA,EACjC,CAMA,QAAA3f,GACC,MAAO,IAAIlT,KAAKsG,MAAMtG,KAAKwG,IAC5B,CAMA,OAAA61B,GACC,MAAO,CAACr8B,KAAKsG,EAAGtG,KAAKwG,EACtB,CAMA,QAAAylC,GACC,MAAO,CAAE3lC,EAAGtG,KAAKsG,EAAGE,EAAGxG,KAAKwG,EAC7B,EAGD,UAAekD,C,4ECaf,UApFA,MACI+Y,cACAzG,gBACAC,iBACAgC,cACAE,cACA+tB,YACAC,eACAC,cACAluB,aACAX,aACAhB,qBACAE,sBACAD,kBACAuD,sBACAM,cAEAT,gBAAyB,YACzBI,qBAA8B,YAC9BH,wBAAiC,YACjCC,yBACAkE,iBAA0B,YAC1BpB,cAAuB,YACvBC,mBAA4B,YAC5B3B,mBACAmrB,wBACAC,+BACAlrB,mBACAM,iBACA7c,YACI,sGACJE,UACAE,WAAoB,YAEpB0Z,eACAC,eACAE,sBACAiD,sBACAD,oBACAiF,qBAA+B,EAC/BwlB,sBAAiC,EACjCC,UAAoB,EAEpBnO,OAMI,CAAC,EACL,WAAAj9B,CAAY+Z,EAAwC,CAAC,GACjDnb,KAAKohB,mBAAqB,EAC1BphB,KAAK0hB,iBAAmB,GACxB1hB,KAAKyiB,cAAgB,EACrBziB,KAAKgc,gBAAkB,IACvBhc,KAAKic,iBAAmB,IAExBjc,KAAKie,cAAgB,GACrBje,KAAKme,cAAgB,GACrBne,KAAKksC,YAAc,GACnBlsC,KAAKmsC,eAAiB,EACtBnsC,KAAKosC,cAAgB,EACrBpsC,KAAKuc,qBAAuB,GAC5Bvc,KAAKyc,sBAAwB,GAC7Bzc,KAAKwc,kBAAoB,EACzBxc,KAAKqgB,cAAgB,EACrBrgB,KAAK+f,sBAAwB,SAC7B/f,KAAKkhB,mBAAqB,EAC1BlhB,KAAKqsC,wBAA0B,EAC/BrsC,KAAKssC,+BAAiC,EACtCtsC,KAAK8f,yBAA2B,EAChC9f,KAAKke,aAAe,GACpBle,KAAKud,aAAe,GACpBvd,KAAK+E,UAAY,GACjB/E,KAAK8hB,oBAAsB,EAC3B9hB,KAAK2e,eAAiB,GACtB3e,KAAK4e,eAAiB,GACtB5e,KAAK8e,sBAAwB,GAC7B9e,KAAK+hB,sBAAwB,EAE7BrhB,OAAOib,OAAO3b,KAAMmb,EACxB,E,8BC3DJ,SAASsxB,EAAQprB,GACf,KAAMrhB,gBAAgBysC,GAAY,OAAO,IAAIA,EAAQprB,GAErD,IAAIqrB,EAASC,EAAUtrB,GAIvBrhB,KAAK2qB,SAAW+hB,EAAO/hB,SAGvB3qB,KAAK8oB,IAAW4jB,EAAO5jB,IAGvB9oB,KAAK4sC,QAAa,EACpB,CAvBA,IAAID,EAAiB,EAAQ,MACzBE,EAAiB,EAAQ,MACzBtY,EAAiB,EAAQ,MACzBuY,EAAiB,EAAQ,MACzBC,EAAiB,EAAQ,MAqB7BN,EAAQt+B,KAAO,SAAU6+B,GACvB,GAAmB,iBAARA,EAAkB,OAAO,IAAIP,EAAQO,GAEhD,GAAIA,aAAeP,EAAS,CAE1B,IAAI13B,EAAI,IAAI03B,EAAQ,IASpB,OANA13B,EAAE+T,IAAMkkB,EAAIlkB,IACZ/T,EAAE4V,SAAWqiB,EAAIriB,SAAShW,IAAI,SAAUs4B,GAAO,OAAOA,EAAI//B,OAAS,GACnE6H,EAAE63B,QAAUI,EAAIJ,QAAQj4B,IAAI,SAAUyI,GACpC,OAAOmX,IAASA,OAAOnX,EAAEif,UAC3B,GAEOtnB,CACT,CAEA,MAAM,IAAIX,MAAM,oCAAsC44B,EACxD,EAGAP,EAAQ9rC,UAAUusC,SAAW,SAAU9vB,GACrC,IAAiBxM,EAAbwvB,EAAOpgC,KAGNod,EAAEye,MAAMxrB,QAEbrQ,KAAKmtC,QAAQ,SAAUp4B,EAAG4T,EAAOriB,EAAGE,GAClC,IAAIwf,EAAG4C,EAAQnoB,EAAM87B,EAErB,OAAQxnB,EAAE,IAGR,IAAK,IAEH6T,EAAmB,KADnB5C,EAAS5I,EAAEkf,KAAK,EAAGvnB,EAAE,GAAI,IACb,GAAY,CAAE,IAAKiR,EAAE,IAAO,CAAE,IAAKA,EAAE,GAAIA,EAAE,IACvD,MAEF,IAAK,IAEH4C,GADA5C,EAAS5I,EAAEkf,KAAKh2B,EAAGyO,EAAE,GAAI,IACb,KAAOqI,EAAEkf,KAAKh2B,EAAGE,EAAG,GAAO,GAAM,CAAE,IAAKwf,EAAE,IAAO,CAAE,IAAKA,EAAE,GAAIA,EAAE,IAC5E,MAEF,IAAK,IAEH4C,EAAmB,KADnB5C,EAAS5I,EAAEkf,KAAKvnB,EAAE,GAAI,EAAG,IACb,GAAY,CAAE,IAAKiR,EAAE,IAAO,CAAE,IAAKA,EAAE,GAAIA,EAAE,IACvD,MAEF,IAAK,IAEH4C,GADA5C,EAAS5I,EAAEkf,KAAKvnB,EAAE,GAAIvO,EAAG,IACb,KAAO4W,EAAEkf,KAAKh2B,EAAGE,EAAG,GAAO,GAAM,CAAE,IAAKwf,EAAE,IAAO,CAAE,IAAKA,EAAE,GAAIA,EAAE,IAC5E,MAEF,IAAK,IACL,IAAK,IAUH,IAAI+G,EAAK3P,EAAEif,UACPr4B,EAAI+oC,EAAQh4B,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAI2C,UAAUqV,GAY5C,GATIA,EAAG,GAAKA,EAAG,GAAKA,EAAG,GAAKA,EAAG,GAAK,IAClChY,EAAE,GAAKA,EAAE,GAAK,IAAM,KAItBiR,EAAI5I,EAAEkf,KAAKvnB,EAAE,GAAIA,EAAE,GAAa,MAATA,EAAE,IAIX,MAATA,EAAE,IAAcA,EAAE,KAAOzO,GAAKyO,EAAE,KAAOvO,GAC9B,MAATuO,EAAE,IAAuB,IAATA,EAAE,IAAqB,IAATA,EAAE,GAAW,CAC9C6T,EAAS,CAAW,MAAT7T,EAAE,GAAa,IAAM,IAAKiR,EAAE,GAAIA,EAAE,IAC7C,KACF,CAKE4C,EAFE5kB,EAAE0pB,eAEK,CAAW,MAAT3Y,EAAE,GAAa,IAAM,IAAKiR,EAAE,GAAIA,EAAE,IAIpC,CAAEjR,EAAE,GAAI/Q,EAAEuoB,GAAIvoB,EAAEwoB,GAAIxoB,EAAEyoB,GAAI1X,EAAE,GAAIA,EAAE,GAAIiR,EAAE,GAAIA,EAAE,IAGzD,MAEF,IAAK,IAGHuW,EAAa5T,EAAQ,EAGrBC,EAAS,CAAE,KADX5C,EAAI5I,EAAEkf,KAAKvnB,EAAE,GAAIA,EAAE,GAAIwnB,IACL,GAAIvW,EAAE,IACxB,MAEF,QAME,IAJA4C,EAAa,CADbnoB,EAAasU,EAAE,IAEfwnB,EAAc97B,EAAKkpB,gBAAkBlpB,EAGhCmQ,EAAI,EAAGA,EAAImE,EAAE1E,OAAQO,GAAK,EAC7BoV,EAAI5I,EAAEkf,KAAKvnB,EAAEnE,GAAImE,EAAEnE,EAAI,GAAI2rB,GAC3B3T,EAAO1mB,KAAK8jB,EAAE,GAAIA,EAAE,IAI1Boa,EAAKzV,SAAShC,GAASC,CACzB,EAAG,EACL,EAKA6jB,EAAQ9rC,UAAUysC,gBAAkB,WAClC,IAAIhwB,EAAGxM,EAEP,GAAK5Q,KAAK4sC,QAAQv8B,OAAlB,CAEA,GAA4B,IAAxBrQ,KAAK4sC,QAAQv8B,OAGf,OAFArQ,KAAKktC,SAASltC,KAAK4sC,QAAQ,SAC3B5sC,KAAK4sC,QAAU,IAOjB,IAHAxvB,EAAImX,IACJ3jB,EAAI5Q,KAAK4sC,QAAQv8B,SAERO,GAAK,GACZwM,EAAEmX,OAAOv0B,KAAK4sC,QAAQh8B,GAAGyrB,WAG3Br8B,KAAKktC,SAAS9vB,GACdpd,KAAK4sC,QAAU,EAhBqB,CAiBtC,EAKAH,EAAQ9rC,UAAUuS,SAAW,WAC3B,IAAI0V,EAAS,GAAIykB,EAAU,GAAIC,EAAa,EAE5CttC,KAAKotC,kBAEL,IAAK,IAAIx8B,EAAI,EAAGwB,EAAMpS,KAAK2qB,SAASta,OAAQO,EAAIwB,EAAKxB,IAAK,CACxD,IAAI28B,EAAUvtC,KAAK2qB,SAAS/Z,GACxB6Y,EAAM8jB,EAAQ,GAGd9jB,IAAQ4jB,GAAmB,MAAR5jB,GAAuB,MAARA,GAExB,MAARA,GAA2B,MAAZ4jB,IAAiBzkB,GAAU,KAC9CA,GAAUa,EAEV6jB,EAAa,GAEbA,EAAa,EAIf,IAAK,IAAI1P,EAAM,EAAGA,EAAM2P,EAAQl9B,OAAQutB,IAAO,CAC7C,IAAIvF,EAAMkV,EAAQ3P,GAIN,IAARA,EACE0P,GAAcjV,GAAO,IAAGzP,GAAU,KAC7ByP,GAAO,IAAGzP,GAAU,KAE/BA,GAAUyP,CACZ,CAEAgV,EAAU5jB,CACZ,CAEA,OAAOb,CACT,EAKA6jB,EAAQ9rC,UAAU8zB,UAAY,SAAUnuB,EAAGE,GAEzC,OADAxG,KAAK4sC,QAAQ1qC,KAAKqyB,IAASE,UAAUnuB,EAAGE,GAAK,IACtCxG,IACT,EAMAysC,EAAQ9rC,UAAU6zB,MAAQ,SAAUyH,EAAIC,GAEtC,OADAl8B,KAAK4sC,QAAQ1qC,KAAKqyB,IAASC,MAAMyH,EAAMC,GAAc,IAAPA,EAAkBA,EAALD,IACpDj8B,IACT,EAMAysC,EAAQ9rC,UAAUyzB,OAAS,SAAUD,EAAO5H,EAAIC,GAE9C,OADAxsB,KAAK4sC,QAAQ1qC,KAAKqyB,IAASH,OAAOD,EAAO5H,GAAM,EAAGC,GAAM,IACjDxsB,IACT,EAKAysC,EAAQ9rC,UAAU+zB,MAAQ,SAAU8Y,GAElC,OADAxtC,KAAK4sC,QAAQ1qC,KAAKqyB,IAASG,MAAM8Y,IAC1BxtC,IACT,EAKAysC,EAAQ9rC,UAAUg0B,MAAQ,SAAU6Y,GAElC,OADAxtC,KAAK4sC,QAAQ1qC,KAAKqyB,IAASI,MAAM6Y,IAC1BxtC,IACT,EAKAysC,EAAQ9rC,UAAU4zB,OAAS,SAAUnX,GAEnC,OADApd,KAAK4sC,QAAQ1qC,KAAKqyB,IAASA,OAAOnX,IAC3Bpd,IACT,EAKAysC,EAAQ9rC,UAAU+W,UAAY,SAAUod,GACtC,OAAKA,EAAgBjB,QAGrB7zB,KAAK4sC,QAAQ1qC,KAAK2qC,EAAe/X,IAC1B90B,MAHEA,IAIX,EAMAysC,EAAQ9rC,UAAU8sC,MAAQ,SAAUC,GAClC,IAA4EpjB,EAAxEqjB,EAAqB,EAAGC,EAAqB,EAAG1d,EAAS,EAAGC,EAAS,EAqFzE,OAnFAud,EAAIA,GAAK,EAET1tC,KAAKotC,kBAELptC,KAAK2qB,SAASxnB,QAAQ,SAAU4R,GAC9B,IAAIwnB,EAAcxnB,EAAE,GAAG4U,gBAAkB5U,EAAE,GAE3C,OAAQA,EAAE,IACR,IAAK,IACL,IAAK,IAIH,OAHIwnB,IAAcxnB,EAAE,IAAMmb,GAC1BA,EAASnb,EAAE,GAAKA,EAAE,GAAG84B,QAAQH,QAC7B34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,IAGvB,IAAK,IACL,IAAK,IAIH,OAHInR,IAAcxnB,EAAE,IAAMob,GAC1BA,EAASpb,EAAE,GAAKA,EAAE,GAAG84B,QAAQH,QAC7B34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,IAGvB,IAAK,IACL,IAAK,IAGH,OAFAxd,EAASyd,OACTxd,EAASyd,GAGX,IAAK,IACL,IAAK,IAcH,OAbIrR,IACFxnB,EAAE,IAAMmb,EACRnb,EAAE,IAAMob,GAGVD,EAASnb,EAAE,GAAKA,EAAE,GAAG84B,QAAQH,GAC7Bvd,EAASpb,EAAE,GAAKA,EAAE,GAAG84B,QAAQH,GAE7BC,EAAqBzd,EACrB0d,EAAqBzd,EAErBpb,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,QACrB34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,IAGvB,IAAK,IACL,IAAK,IAeH,OAbInR,IACFxnB,EAAE,IAAMmb,EACRnb,EAAE,IAAMob,GAGVD,EAASnb,EAAE,GAAKA,EAAE,GAAG84B,QAAQH,GAC7Bvd,EAASpb,EAAE,GAAKA,EAAE,GAAG84B,QAAQH,GAE7B34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,GACrB34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,GACrB34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,EAAI,GACzB34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,QACrB34B,EAAE,IAAMA,EAAE,GAAG84B,QAAQH,IAGvB,QAgBE,OAdApjB,EAAIvV,EAAE1E,OAEFksB,IACFxnB,EAAEuV,EAAI,IAAM4F,EACZnb,EAAEuV,EAAI,IAAM6F,GAGdD,EAASnb,EAAEuV,EAAI,GAAKvV,EAAEuV,EAAI,GAAGujB,QAAQH,GACrCvd,EAASpb,EAAEuV,EAAI,GAAKvV,EAAEuV,EAAI,GAAGujB,QAAQH,QAErC34B,EAAE5R,QAAQ,SAAUk1B,EAAKznB,GAClBA,IACLmE,EAAEnE,IAAMmE,EAAEnE,GAAGi9B,QAAQH,GACvB,GAGN,GAEO1tC,IACT,EAOAysC,EAAQ9rC,UAAUwsC,QAAU,SAAUW,EAAUC,GAC9C,IAOIn9B,EAAGo9B,EAAGC,EAPNtjB,EAAW3qB,KAAK2qB,SAChBujB,EAAe,CAAC,EAChBC,EAAc,EACdne,EAAQ,EACRC,EAAQ,EACRme,EAAiB,EACjBC,EAAiB,EAqDrB,GAlDKN,GACH/tC,KAAKotC,kBAGPziB,EAASxnB,QAAQ,SAAU4R,EAAG4T,GAE5B,IAAIlT,EAAMq4B,EAAS/4B,EAAG4T,EAAOqH,EAAOC,GAEhC/hB,MAAM4lB,QAAQre,KAChBy4B,EAAavlB,GAASlT,EACtB04B,EAAc,GAGhB,IAAI5R,EAAcxnB,EAAE,KAAOA,EAAE,GAAG4U,cAGhC,OAAQ5U,EAAE,IACR,IAAK,IACL,IAAK,IAKH,OAJAib,EAAQjb,EAAE,IAAMwnB,EAAavM,EAAQ,GACrCC,EAAQlb,EAAE,IAAMwnB,EAAatM,EAAQ,GACrCme,EAAiBpe,OACjBqe,EAAiBpe,GAGnB,IAAK,IACL,IAAK,IAEH,YADAD,EAAQjb,EAAE,IAAMwnB,EAAavM,EAAQ,IAGvC,IAAK,IACL,IAAK,IAEH,YADAC,EAAQlb,EAAE,IAAMwnB,EAAatM,EAAQ,IAGvC,IAAK,IACL,IAAK,IAIH,OAFAD,EAAQoe,OACRne,EAAQoe,GAGV,QACEre,EAAQjb,EAAEA,EAAE1E,OAAS,IAAMksB,EAAavM,EAAQ,GAChDC,EAAQlb,EAAEA,EAAE1E,OAAS,IAAMksB,EAAatM,EAAQ,GAEtD,IAIKke,EAAe,OAAOnuC,KAI3B,IAFAiuC,EAAc,GAETr9B,EAAI,EAAGA,EAAI+Z,EAASta,OAAQO,IAC/B,QAA+B,IAApBs9B,EAAat9B,GACtB,IAAKo9B,EAAI,EAAGA,EAAIE,EAAat9B,GAAGP,OAAQ29B,IACtCC,EAAY/rC,KAAKgsC,EAAat9B,GAAGo9B,SAGnCC,EAAY/rC,KAAKyoB,EAAS/Z,IAM9B,OAFA5Q,KAAK2qB,SAAWsjB,EAETjuC,IACT,EAKAysC,EAAQ9rC,UAAU6sB,IAAM,WAgCtB,OA9BAxtB,KAAKmtC,QAAQ,SAAUp4B,EAAG4T,EAAOriB,EAAGE,GAClC,IAEIoK,EAFAnQ,EAAOsU,EAAE,GACTu5B,EAAS7tC,EAAK8tC,cAIlB,GAAI9tC,IAAS6tC,EAIb,OAFAv5B,EAAE,GAAKu5B,EAEC7tC,GACN,IAAK,IAGH,YADAsU,EAAE,IAAMvO,GAGV,IAAK,IAKH,OAFAuO,EAAE,IAAMzO,OACRyO,EAAE,IAAMvO,GAGV,QACE,IAAKoK,EAAI,EAAGA,EAAImE,EAAE1E,OAAQO,IACxBmE,EAAEnE,IAAMA,EAAI,EAAItK,EAAIE,EAG5B,EAAG,GAEIxG,IACT,EAKAysC,EAAQ9rC,UAAUq2B,IAAM,WAmCtB,OAjCAh3B,KAAKmtC,QAAQ,SAAUp4B,EAAG4T,EAAOriB,EAAGE,GAClC,IAEIoK,EAFAnQ,EAAOsU,EAAE,GACTy5B,EAAS/tC,EAAKkpB,cAIlB,GAAIlpB,IAAS+tC,IAGC,IAAV7lB,GAAwB,MAATloB,GAInB,OAFAsU,EAAE,GAAKy5B,EAEC/tC,GACN,IAAK,IAGH,YADAsU,EAAE,IAAMvO,GAGV,IAAK,IAKH,OAFAuO,EAAE,IAAMzO,OACRyO,EAAE,IAAMvO,GAGV,QACE,IAAKoK,EAAI,EAAGA,EAAImE,EAAE1E,OAAQO,IACxBmE,EAAEnE,IAAMA,EAAI,EAAItK,EAAIE,EAG5B,EAAG,GAEIxG,IACT,EAKAysC,EAAQ9rC,UAAU8tC,MAAQ,WA+BxB,OA9BAzuC,KAAKmtC,QAAQ,SAAUp4B,EAAG4T,EAAOriB,EAAGE,GAClC,IAAIkoC,EAAcC,EAAOC,EAAOhmB,EAAS,GAAInoB,EAAOsU,EAAE,GAGtD,MAAa,MAATtU,GAAyB,MAATA,EAAuB,MAE9B,MAATA,GAEFkuC,EAAQroC,EAAIyO,EAAE,GACd65B,EAAQpoC,EAAIuO,EAAE,KAEd45B,EAAQ55B,EAAE,GACV65B,EAAQ75B,EAAE,IAOgB,KAJ5B25B,EAAe5B,EAAIxmC,EAAGE,EAAGmoC,EAAOC,EAAO75B,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAIhD1E,OACR,CAAE,CAAW,MAAT0E,EAAE,GAAa,IAAM,IAAKA,EAAE,GAAIA,EAAE,MAG/C25B,EAAavrC,QAAQ,SAAU4R,GAC7B6T,EAAO1mB,KAAK,CAAE,IAAK6S,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IACrD,GAEO6T,GACT,GAEO5oB,IACT,EAKAysC,EAAQ9rC,UAAUkuC,QAAU,WAC1B,IACIC,EAAcC,EAAcC,EAC5BC,EAAaC,EAFbvkB,EAAW3qB,KAAK2qB,SA2EpB,OArEA3qB,KAAKmtC,QAAQ,SAAUp4B,EAAGR,EAAKjO,EAAGE,GAChC,IAA8C+1B,EAA1C97B,EAAOsU,EAAE,GAAIu5B,EAAS7tC,EAAK8tC,cAI1Bh6B,IAEU,MAAX+5B,GACF/R,EAAuB,MAAT97B,EAIS,OAFvBuuC,EAAcrkB,EAASpW,EAAM,IAEb,IACdu6B,EAAeE,EAAY,GAAK1oC,EAChCyoC,EAAeC,EAAY,GAAKxoC,GACJ,MAAnBwoC,EAAY,IACrBF,EAAeE,EAAY,GAAKA,EAAY,GAC5CD,EAAeC,EAAY,GAAKA,EAAY,KAE5CF,EAAe,EACfC,EAAe,GAGjBE,GAAeH,EACfI,GAAeH,EAEVxS,IACH0S,GAAe3oC,EACf4oC,GAAe1oC,GAGjBmkB,EAASpW,GAAO,CACdgoB,EAAa,IAAM,IACnB0S,EAAaC,EACbn6B,EAAE,GAAIA,EAAE,KAGU,MAAXu5B,IACT/R,EAAuB,MAAT97B,EAIS,OAFvBuuC,EAAcrkB,EAASpW,EAAM,IAEb,IACdu6B,EAAeE,EAAY,GAAK1oC,EAChCyoC,EAAeC,EAAY,GAAKxoC,GACJ,MAAnBwoC,EAAY,IACrBF,EAAeE,EAAY,GAAKA,EAAY,GAC5CD,EAAeC,EAAY,GAAKA,EAAY,KAE5CF,EAAe,EACfC,EAAe,GAGjBE,GAAeH,EACfI,GAAeH,EAEVxS,IACH0S,GAAe3oC,EACf4oC,GAAe1oC,GAGjBmkB,EAASpW,GAAO,CACdgoB,EAAa,IAAM,IACnB0S,EAAaC,EACbn6B,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAG1B,GAEO/U,IACT,EAGAH,EAAOD,QAAU6sC,C,4DCxpBjB,soK,wKCEA,mBACA,WAGA,aAaM0C,EAA0B,CAC5BC,IAAK,KACLC,IAAK,MA8FT,UAAQn9B,cAAc,kBA1FtB,SAAuBhO,EAAa2N,GAMhC,IAAIA,EAAK8K,OAAU9K,EAAK8K,OAAOwb,iBA8E/B,OA3EAj0B,EAAG8N,GAAG,QAAS,KACX,MAAMs9B,EAASz9B,EAAK+R,WAAWwC,WAG/B,IAAK+oB,EAAOC,IACR,OAAIE,GACAprC,EAAG4S,SAAS,4CACZ,aAAW,GAAI,KACX5S,EAAGqrC,YAAY,2CAIvBJ,EAAOC,IAAM,CAAE/oB,KAAMxU,EAAK+R,WAAY1f,KAAI2N,QAC1C3N,EAAG4S,SAAS,uCACZ,UAAUvV,SAAS,eAKvB,IAAK4tC,EAAOE,KAAQx9B,GAAMzO,OAAS+rC,EAAOC,KAAKv9B,MAAMzO,KAAO,CACxD,IAAKksC,EAKD,OAJAprC,EAAG4S,SAAS,4CACZ,aAAW,GAAI,KACX5S,EAAGqrC,YAAY,yCAIvB,GAAIJ,EAAOC,IAAI/oB,OAASxU,EAAK+R,WAAY,OACzCurB,EAAOE,IAAM,CAAEhpB,KAAMxU,EAAK+R,WAAY1f,KAAI2N,QAC1C3N,EAAG4S,SAAS,iCAChB,CAGA,GAAIq4B,EAAOC,KAAOD,EAAOE,IAAK,CAC1B,GAAIF,EAAOE,IAAIx9B,MAAMzO,MAAQ+rC,EAAOC,IAAIv9B,MAAMzO,MAAQ+rC,EAAOE,IAAIx9B,MAAMzO,OAAS+rC,EAAOC,KAAKv9B,MAAM8K,OAAOvZ,KAYrG,OAXA+rC,EAAOC,IAAIlrC,GAAG4S,SAAS,uCACvBq4B,EAAOE,IAAInrC,GAAG4S,SAAS,wCACvB,aAAW,GAAI,KACNq4B,GACAA,EAAOC,KAAQD,EAAOE,MAC3BF,EAAOC,IAAIlrC,GAAGqrC,YAAY,uCAC1BJ,EAAOE,IAAInrC,GAAGqrC,YAAY,uCAC1BJ,EAAOC,IAAM,KACbD,EAAOE,IAAM,aAEjB,UAAU1tC,YAAY,cAG1B,MAAQ0kB,KAAMmpB,GAAUL,EAAOC,KACvB/oB,KAAMopB,GAAUN,EAAOE,IAE/BG,EAAMpd,eACNqd,EAAMjd,iBAENgd,EAAMvrB,GAAKkrB,EAAOE,IAAIx9B,MAAMzO,KAC5BqsC,EAAMthC,KAAOghC,EAAOC,IAAIv9B,MAAMzO,MAAQ+rC,EAAOC,IAAIv9B,MAAM8K,OAEvD,aAAW,EAAG,KACNwyB,EAAOC,KAAKv9B,MAAMzO,MAClB+rC,EAAOC,IAAIv9B,KAAKzO,KAAKR,WAAW0O,SAC/B69B,EAAOC,IAAIv9B,KAAKzO,KAAKR,UAA2B+oB,cAC1CwjB,EAAOE,KAAKx9B,MAAMzO,OACzB+rC,EAAOE,IAAIx9B,KAAKzO,KAAKR,WAAW0O,SAC/B69B,EAAQE,IAAKx9B,KAAKzO,KAAMR,UAA2B+oB,cAKxDwjB,EAAOC,IAAM,KACbD,EAAOE,IAAM,KACb,UAAU1tC,YAAY,eAG9B,IAEG,KACHuC,EAAG+N,IAAI,SAGf,E,8ECjHA,gBA0GA,UAlGA,MAEC2K,MAEA5X,MAEAygC,SAEAiK,QAEAC,SAMA,WAAAvuC,CAAYoB,EAAkBqjC,GAC7B7lC,KAAK4c,MAAQipB,EAAMplC,KACnBT,KAAKgF,MAAQ6gC,EAAM7gC,MACnBhF,KAAKylC,SAAWI,EAAMJ,SACtBzlC,KAAK2vC,SAAWntC,EAChBxC,KAAK4vC,UACN,CAGA,QAAAA,GACC,MAAMC,EAAMptC,SAASC,cAAc,UACnCmtC,EAAInsC,YAAc1D,KAAK4c,MACvBizB,EAAIltC,UAAY,mBAChBktC,EAAIzrC,MAAMC,iBAAkB,IAAAC,YAAWtE,KAAKgF,OAC5C6qC,EAAIzrC,MAAMY,OAAQ,IAAAV,YAAW,WAC7BtE,KAAK0vC,QAAUG,EAEfA,EAAI9rC,iBAAiB,QAASC,IAC7BA,EAAE8rC,kBACF9vC,KAAK2vC,SAAStK,QAAQniC,QACtBlD,KAAK2vC,SAAStK,QAAQriC,KAAKhD,KAAKylC,UAChCzlC,KAAK2vC,SAAStK,QAAQ5hC,SAGvBzD,KAAK2vC,SAASrtC,UAAUQ,YAAY+sC,EACrC,CAMA,OAAApe,CAAQoU,QACYxlC,IAAfwlC,EAAMplC,OACTT,KAAK4c,MAAQipB,EAAMplC,KACnBT,KAAK0vC,QAAQhsC,YAAc1D,KAAK4c,YAEbvc,IAAhBwlC,EAAM7gC,QACThF,KAAKgF,MAAQ6gC,EAAM7gC,MACnBhF,KAAK0vC,QAAQtrC,MAAMC,iBAAkB,IAAAC,YAAWtE,KAAKgF,aAE/B3E,IAAnBwlC,EAAMJ,WACTzlC,KAAKylC,SAAWI,EAAMJ,SAExB,CAGA,OAAAna,GACCtrB,KAAK0vC,QAAQ7pC,SACb7F,KAAK2vC,SAAW,IACjB,CAGA,IAAAxoC,GACCnH,KAAK0vC,QAAQtrC,MAAM8C,QAAU,MAC9B,CAGA,IAAAzD,GACCzD,KAAK0vC,QAAQtrC,MAAM8C,QAAU,EAC9B,CAMA,WAAA6oC,CAAYC,GACXhwC,KAAK0vC,QAAQM,SAAWA,CACzB,CAMA,MAAAC,GACC,MAAO,CACNxvC,KAAMT,KAAK4c,MACX5X,MAAOhF,KAAKgF,MACZygC,SAAUzlC,KAAKylC,SAEjB,E,uGClGD,gBAGA,wBACCriC,KACAlC,MACGuD,SACH,WAAArD,CAAYgC,EAAe8sC,EAAqBzrC,GACzCzE,KAAKyE,SAAWA,EACtBzE,KAAKoD,KAAOA,EACZpD,KAAKkB,MAAQgvC,EAGb9sC,EAAK8C,IAAMlG,IACZ,CACG,WAAAmwC,CAAY1vC,GACR,OAAOT,KAAKyE,SAAS2V,WAAW3Z,EACpC,CAEH,MAAA2vC,CAAO9pC,EAAWE,GACjBxG,KAAKkB,MAAM2V,MAAOzH,KAAK9I,EAAGE,EAC3B,CAGA,QAAA6pC,CAAS7b,GACRx0B,KAAKkB,MAAM2V,MAAO2d,MAAMA,EACzB,CAGA,cAAA8b,CAAe54B,GACd1X,KAAKkB,MAAM2V,MAAO5I,KAAK,CAAEyJ,aAC1B,CAGA,MAAAwQ,GACC,OAAOloB,KAAKkB,MAAM2V,KACnB,CAGA,SAAA05B,CAAUvrC,EAAQ,QACNA,GAAyB,GAAhBA,EAAMqL,QAAgC,iBAAVrL,EAIhDhF,KAAKkB,MAAMwhB,GAAIlK,OAAO,CAAExT,QAAO6G,MAAO,IAH5B7L,KAAKuwC,WAAU,IAAAjsC,YAAWtE,KAAKmwC,YAAY,uBAItD,E,wKClDD,mBACA,aAgHA,UAtGA,MAEChiC,KAEA8V,GAEAmC,WAQA,WAAAhlB,CAAY+M,EAAmB8V,EAAiBmC,EAAsB,GACrEpmB,KAAKmO,KAAOA,EACZnO,KAAKikB,GAAKA,EACVjkB,KAAKomB,WAAaA,CACnB,CAGA,KAAAlC,GACC,OAAOlkB,KAAKikB,EACb,CAGA,OAAAa,GACC,OAAO9kB,KAAKmO,IACb,CAMA,YAAAikB,GACC,GAAKpyB,KAAKikB,GAAV,CAEA,GAAIjkB,KAAKikB,cAAc,WAAWjkB,KAAKikB,GAAGE,mBAAoB,CAC7D,MACMqsB,EADWxwC,KAAKikB,GAAGE,mBACChW,KAGtBqiC,aAAoB,WAAWA,EAASxrB,gBAAgBf,KAC3DusB,EAASxrB,eAAef,GAAK,MAI1BusB,aAAoB,WAASA,EAAS7sB,oBACxC6sB,EAA8Ble,YAEjC,CAEAtyB,KAAKikB,GAAK,IAjBU,CAkBrB,CAMA,cAAAuO,GACC,GAAKxyB,KAAKmO,KAAV,CAEA,GAAInO,KAAKmO,gBAAgB,WAAWnO,KAAKmO,KAAK6W,eAAgB,CAC7D,MAAMuN,EAAOvyB,KAAKmO,KAAK6W,eAEnBuN,EAAKtO,cAAc,WAAWsO,EAAKtO,GAAGE,oBAAoBhW,KAC7DokB,EAAKtO,GAAGE,mBAAmBhW,KAAO,KACxBokB,EAAKtO,cAAc,WAASsO,EAAKtO,GAAGN,kBAC7C4O,EAAKtO,GAAwBqO,aAG/BC,EAAKtO,GAAK,IACX,MAAWjkB,KAAKmO,gBAAgB,WAASnO,KAAKmO,KAAKwV,kBACjD3jB,KAAKmO,KAA0BmkB,aAGjCtyB,KAAKmO,KAAO,IAhBU,CAiBvB,CAMA,KAAA6qB,CAAMpnB,GACL5R,KAAKikB,GAAKrS,CACX,CAMA,OAAA4xB,CAAQiN,GACPzwC,KAAKmO,KAAOsiC,CACb,CAGA,OAAAC,GACC1wC,KAAKmO,KAAO,KACZnO,KAAKikB,GAAK,IACX,E,wKC7GD,mBAcA,MAAM0sB,UAAwB,UAC1BtS,OAAuB,CAAC,EACxBW,gBAAyB,YACzBpf,gBAAyB,YACzBI,qBAA8B,YAC9BH,wBAAiC,YACjC,WAAAze,CAAY+Z,GACRyS,MAAMzS,GACNnb,KAAK+mB,qBAAuB,IAC5B/mB,KAAKyiB,cAAgB,GACrBziB,KAAKme,cAAgB,GACrBne,KAAK+mB,qBAAuB,EAC5B/mB,KAAKob,MACT,CAEA,IAAAA,GACIpb,KAAKq+B,OAAOC,OAAS,CACjBM,SAAU,0CACVJ,MAAO,GACPC,OAAQ,GAEhB,EAGJ,UAAekS,C,wKCtCf,mBACA,WAkNA,UAAQz+B,cAAc,aA/MtB,SAAsB7F,EAAkBwF,GAmBpC,SAAS1E,EAAiBC,GAEtB,OAAI3I,EAAS0I,iBAAyB1I,EAAS0I,iBAAiBC,GAC3C,EAAdA,EAAKiD,MAChB,CAEA,SAAS9D,IAGL,MAAO,CAAEC,MAFKC,KAAKC,IAAIC,EAAWC,GAElBC,IADJJ,KAAKK,IAAIH,EAAWC,GAEpC,CAEA,SAASG,IACL,OAAOJ,IAAcC,CACzB,CAEA,SAASI,IACL,IAAKD,IAAgB,OAAO,EAC5B,MAAM,MAAEP,EAAK,IAAEK,GAAQN,IAIvB,OAHAU,EAASA,EAAOC,MAAM,EAAGV,GAASS,EAAOC,MAAML,GAC/CF,EAAYH,EACZI,EAAYJ,EACL,CACX,CAEA,SAASoB,IAELE,EAAIV,KAAKH,GAET,MAAM,MAAET,EAAK,IAAEK,GAAQN,KACfV,MAAO2S,GAAe/Z,EAAS4X,gBAAgBpP,IAC/CnB,OAAQ8kC,GAAe3qC,EAAKyH,OAE9BuxB,EAAWnxB,EAAIJ,OACfyS,GAAWywB,EAAa3R,EAASnzB,QAAU,EAGjD,GAAIiB,IAAgB,CAChB,MAAM2B,EAAkBzB,EAAOC,MAAM,EAAGV,GAClCmC,EAAgB1B,EAAOC,MAAM,EAAGL,GAChC+B,EAAaiD,EAAK6N,OAlDd,EAkDmCvS,EAAiBuB,GACxDG,EAAiBpC,KAAKK,IAAIK,EAAiBwB,GAAiBxB,EAAiBuB,GAAkB,GAC/FI,EAAaqR,EAEdnR,EAODA,EAAcxB,KAAKqB,EAAgBowB,EAASnzB,SAL5CkD,EAAgB/I,EAAKgJ,SAAUhJ,KAAK4I,EAAgBowB,EAASnzB,QACxD9I,KAAK,WACLiL,KAAK,CAAE,eAAgB,MAC5Be,EAAe5L,KAAK8L,WAAYC,aAAaH,EAAe5L,KAAM0K,EAAI1K,OAK1E4L,EAAeI,KAAKR,EAAYE,EACpC,MACQE,IAAiBA,EAAcnJ,SAAUmJ,EAAgB,MAIjE,GAAIK,EAAS,CACI5K,EAAS+L,QAAQC,UAA9B,MACMogC,EAAUh/B,EAAK6N,OAxEX,EAwEgCvS,EAAiBF,EAAOC,MAAM,EAAGP,IACrE6C,EAASyvB,EAASnzB,OAEnB2D,IAAWA,EAAYxJ,EAAKgJ,SAAUhJ,KAAK,EAAGuJ,GAAQxM,KAAKyB,EAASC,UAAUsb,uBACnFvQ,EAAWjC,KAAK,EAAGgC,GAAQJ,KAAKyhC,EAAQ1wB,EAC5C,MACQ1Q,IAAaA,EAAU5J,SAAU4J,EAAY,MAIrDxJ,EAAKuH,KAAKf,KAAKK,IAAI,GAAI0R,EAAa5O,GAAgBnD,KAAKK,IAAI8jC,EAAY3R,EAASnzB,OAASgE,IAC3FhC,EAAIsB,KAAKyC,EAAK6N,OAnFA,EAmFoBS,EACtC,CAGA,SAASpP,EAAU/M,GACf,GAAK6N,EAAK8K,MAAM2b,WAIhB,GAAKjpB,EAAL,CAEA,GAAc,WAAVrL,EAAEuN,IAAuD,OAAnCvN,EAAE8B,sBAAkBmL,IAC9C,GAAc,UAAVjN,EAAEuN,IAAsD,OAAnCvN,EAAE8B,sBAAkBmL,IAE7C,GAAc,cAAVjN,EAAEuN,KACGvE,KAAqBL,EAAY,IAClCM,EAASA,EAAOC,MAAM,EAAGP,EAAY,GAAKM,EAAOC,MAAMP,GACvDA,IACAC,EAAYD,QAEb,GAAc,WAAV3I,EAAEuN,KACJvE,KAAqBL,EAAYM,EAAOoD,SACzCpD,EAASA,EAAOC,MAAM,EAAGP,GAAaM,EAAOC,MAAMP,EAAY,SAEhE,GAAc,cAAV3I,EAAEuN,IACLvN,EAAEwN,SAAU7E,EAAYF,KAAKK,IAAI,EAAGH,EAAY,IAC7CA,EAAYF,KAAKK,IAAI,EAAGH,EAAY,GAAIC,EAAYD,QACxD,GAAc,eAAV3I,EAAEuN,IACLvN,EAAEwN,SAAU7E,EAAYF,KAAKC,IAAIO,EAAOoD,OAAQ1D,EAAY,IACzDA,EAAYF,KAAKC,IAAIO,EAAOoD,OAAQ1D,EAAY,GAAIC,EAAYD,QACpE,GAAc,SAAV3I,EAAEuN,IACJvN,EAAEwN,WAAU5E,EAAY,GAC7BD,EAAY,OACT,GAAc,QAAV3I,EAAEuN,IACJvN,EAAEwN,WAAU5E,EAAYK,EAAOoD,QACpC1D,EAAYM,EAAOoD,WAChB,IAAqB,IAAjBrM,EAAEuN,IAAIlB,QAAiBrM,EAAEyN,SAAYzN,EAAE0N,QAK3C,OAJC3E,KAAgBC,IACpBC,EAASA,EAAOC,MAAM,EAAGP,GAAa3I,EAAEuN,IAAMtE,EAAOC,MAAMP,GAC3DA,IACAC,EAAYD,CACH,CAEb3I,EAAE8B,iBACF8H,IACAiE,EAAK8K,MAAMic,SAAS3rB,EApCA,OAHZoC,GAAS4B,GAwCrB,CAEA,SAASD,EAAe3L,GACpB,IAAKgK,EAAS,OACd,GAAIyB,EAAwC,YAAvBA,EAAgB,GACrC,MAAMc,EAASvM,EAAGuM,OACdA,IAAW3L,EAAK7C,MAAQwO,IAAW9D,EAAI1K,MAAM6N,GACrD,CAEA,SAASd,EAAa9K,GAClB,GAAKwM,EAAK8K,MAAM2b,WAIhB,IAAIjpB,EAAJ,CAQA,GAPAA,EAAU,EACVpC,EAAS4E,EAAK8K,MAAMM,cAAgB,GACpCtQ,EAAYM,EAAOoD,OACnBzD,EAAYK,EAAOoD,OAEnB,UAAU9O,SAAS,UAEf8D,EAAI,CACJ,MAAMiL,EAAUrK,EAAK7C,KAAK+C,wBACpBoK,EAAO9L,EAAS+L,QAAQC,UACxBC,GAAUrL,EAAGE,QAAU+K,EAAQhL,KA1J3B,GA0J+CiL,EAEzD,IAAII,EAAkB,EACtBhE,EAAY,EACZ,IAAK,IAAIiE,EAAI,EAAGA,EAAI3D,EAAOoD,OAAQO,IAAK,CACpC,MAAMC,EAAY1D,EAAiBF,EAAO2D,IAC1C,GAAID,EAAkBE,EAAY,GAAKH,EAAQ,MAC/CC,GAAmBE,EACnBlE,EAAYiE,EAAI,CACpB,CACJ,CAEAhE,EAAYD,EACZiB,IACAkD,EAAgB,EAEhBrO,SAASsB,iBAAiB,UAAWgN,GACrCtO,SAASsB,iBAAiB,YAAaiN,EA5BpB,OAHX3B,GAAS4B,GAgCrB,CAEA,SAASA,IACL5B,EAAU,EACV,UAAU1N,YAAY,UACtBc,SAASkD,oBAAoB,UAAWoL,GACxCtO,SAASkD,oBAAoB,YAAaqL,GAC1Ca,EAAK8K,MAAMic,SAAS3rB,GACpBW,IACAnJ,EAAS+L,QAAQc,SACjB7M,EAAS+L,QAAQmb,YACrB,CA/LA,IAAItc,EAAU,EACVyB,EAAgB,EAChB7D,EAAS4E,EAAK8K,MAAMgD,qBAAuB,GAC3ChT,EAAYM,EAAOoD,OACnBzD,EAAYK,EAAOoD,OACvB,MAAMvC,EAAY+D,EAAKzE,KACjBnH,EAAaoG,EACb5H,EAAWoN,EAAKpN,SAGtB,IAAIgL,EAAyB,KACzBT,EAA6B,KA2LjC,OAzLAlB,EAAK1J,MAAM,cAAe,QAE1B6B,EAAM7B,MAAM,cAAe,QAkL3B6B,EAAK+L,GAAG,YAAc3M,GAAc8K,EAAa9K,IACjDyI,EAAIkE,GAAG,YAAc3M,GAAc8K,EAAa9K,IAEhDuI,IAEO,KACH3H,EAAKgM,IAAI,YAAa9B,GACtBrC,EAAImE,IAAI,YAAa9B,GACrB1N,SAASkD,oBAAoB,UAAWoL,GACxCtO,SAASkD,oBAAoB,YAAaqL,GAElD,E,8EChNA,gBAEA,gBACC/N,MAAsC,IAAI3B,IAG1C,KAAA4d,CAAM9b,EAAeqB,EAAoBvD,GACxC,IAAKkC,EAAM,OACX,MAAM0tC,EAAU,IAAI,EAAA9vC,gBAAgBoC,EAAMlC,EAAOuD,GAEjD,OADAzE,KAAKiD,MAAMjB,IAAIoB,EAAK6D,GAAI6pC,GACjBA,CACR,CAGA,GAAA7uC,CAAI0vB,GACH,OAAO3xB,KAAKiD,MAAMhB,IAAI0vB,EACvB,CAGA,MAAA9rB,CAAO8rB,GACN3xB,KAAKiD,MAAMrB,OAAO+vB,EACnB,E,wKCtBD,mBACA,aACA,aACA,aACA,aACA,aACA,aA0LA,UA7JA,MAII/uB,UAIAurB,WAIAgW,OAIAvZ,QAMA,WAAAxpB,CAAYwB,GACR5C,KAAK4C,UAAYA,EACjB5C,KAAKmuB,WAAanuB,KAAK4C,UAAUurB,WACjCnuB,KAAKmkC,OAAS,IAAI,UAAOnkC,KAAK4C,UAAW,CACrCoT,OAAQ,IAAI,UAAY,EAAG,GAC3BvV,KAAM,gBACNkC,UAAW,qBAIf3C,KAAKmkC,OAAO1gC,KAAO,KACfzD,KAAKmkC,OAAO7hC,UAAU8hC,UAAU3iC,IAAI,QACpCzB,KAAKmkC,OAAO7hC,UAAU8B,MAAM8C,QAAU,OACtClH,KAAKmkC,OAAO5hC,QAAU,GAE1BvC,KAAKmkC,OAAOh9B,KAAO,KACfnH,KAAKmkC,OAAO7hC,UAAU8hC,UAAUv+B,OAAO,QACvC7F,KAAKmkC,OAAO7hC,UAAU8B,MAAM8C,QAAU,OACtClH,KAAKmkC,OAAO5hC,QAAU,GAE1BvC,KAAKmkC,OAAO7hC,UAAU8B,MAAM2sC,eAAe,UAC3C/wC,KAAKmkC,OAAO7hC,UAAU8B,MAAM2sC,eAAe,SAE3C/wC,KAAKmkC,OAAOh9B,OACZnH,KAAK4qB,QAAU,UACf5qB,KAAKgxC,eACT,CAMA,aAAAC,CAAcr/B,GACV5R,KAAKmkC,OAAO7hC,UAAU8E,UAAY,GAEVpH,KAAK4qB,QAAQ1S,OAAO2rB,IACxC,IAAKjyB,EAAQ,OAAO,EACpB,MAAMoyB,EAAU91B,MAAM4lB,QAAQ+P,EAAIG,SAAWH,EAAIG,QAAU,CAACH,EAAIG,SAChE,OAAIA,EAAQtc,SAAS,QACjB9V,aAAkB,WAAWoyB,EAAQtc,SAAS,SAC9C9V,aAAkB,WAAgBoyB,EAAQtc,SAAS,OACnD9V,aAAkBs/B,eAAiBt/B,aAAkBu/B,gBAAkBnN,EAAQtc,SAAS,SACxF9V,aAAkB,WAAgBoyB,EAAQtc,SAAS,WAJnB,EAK7B,IAGKvkB,QAAQ,CAAC0gC,EAAKjzB,KAC1B,MAAM1M,EAAKzB,SAASC,cAAc,OAClCwB,EAAGvB,UAAY,qBACfuB,EAAGR,YAAcmgC,EAAIjnB,OAAS,UAAYhM,EAE1C1M,EAAGH,iBAAiB,QAAS,KACrB6N,GAAQiyB,EAAInK,MAAM9nB,GACtB5R,KAAKmH,SAEL08B,EAAIpf,QAAQof,EAAIpf,OAAOvgB,EAAIlE,KAAK4C,UAAWihC,GAC3CA,EAAIC,cAAc5/B,EAAGH,iBAAiB,aAAc,IAAM8/B,EAAIC,kBAC9DD,EAAIE,YAAY7/B,EAAGH,iBAAiB,aAAc,IAAM8/B,EAAIE,gBAEhE/jC,KAAKmkC,OAAO7hC,UAAUQ,YAAYoB,IAE1C,CAKA,aAAA8sC,GACQhxC,KAAKmuB,YACLnuB,KAAKmuB,WAAWqC,gBAAgB,KACxBxwB,KAAKmkC,OAAO5hC,SAASvC,KAAKmH,SAGtCnH,KAAK4C,UAAUsD,IAAI9C,KAAKW,iBAAiB,cAAeC,IACpDA,EAAE8B,iBACF,MAAMywB,EAASvyB,EAAEuB,QACXixB,EAASxyB,EAAEyB,QAEjBzF,KAAKmkC,OAAOjZ,UAAU,IAAI,UAAYqL,EAAQC,IAC9Cx2B,KAAKixC,cAAcjxC,KAAK4R,QACxB5R,KAAKmkC,OAAO1gC,SAGhBhB,SAASsB,iBAAiB,YAAaC,IAC9BhE,KAAKmkC,OAAO7hC,UAAUq9B,SAAS37B,EAAE4N,SAClC5R,KAAKmH,QAGjB,CAGA,IAAAA,GACInH,KAAKmkC,OAAOh9B,MAChB,CAGA,YAAIs1B,GACA,OAAOz8B,KAAKmuB,WAAWsO,QAC3B,CAKA,UAAI7qB,GACA,IAAI1N,EAAKzB,SAAS2uC,iBAAiBpxC,KAAKy8B,SAASn2B,EAAGtG,KAAKy8B,SAASj2B,GAClE,IAAKtC,EAAI,OAAO,KAChB,GAAKA,IAAoClE,KAAK4C,UAAUsD,IAAI9C,KAAM,OAAOpD,KAAK4C,UAE9E,GAAIsB,GAAMA,EAAGkgC,WAAWzE,WAAW,sBAAuB,OAAO3/B,KAAK4C,UAEtE,KAAOsB,GAAMA,IAAOzB,SAASM,MAAM,CAC/B,GAAiC,MAA7BmB,EAAGqjB,QAAQoC,eAAyBzlB,EAAGmtC,aAAa,gBAAiB,CACrE,MAAM1f,GAAS,aAAaztB,EAAGotC,aAAa,iBACtCluC,EAAOpD,KAAK4C,UAAUwc,QAAQuS,GACpC,GAAIvuB,EAAM,OAAOA,CACrB,CACA,GAAiC,MAA7Bc,EAAGqjB,QAAQoC,eAAyBzlB,EAAGmtC,aAAa,gBAAiB,CACrE,MAAME,EAAMx6B,KAAKy6B,MAAMttC,EAAGotC,aAAa,iBACvC,IAAKC,EAAItqC,KAAOsqC,EAAIt6B,KAAM,SAC1B,GAAIs6B,EAAIt6B,MACJ,IAAK,IAAIlH,KAAW/P,KAAK4C,UAAU0rB,WAC/B,GAAIve,EAAQ9I,KAAOsqC,EAAItqC,GAAI,OAAO8I,OAGtC,IAAK,IAAKkK,EAAG7W,KAASpD,KAAK4C,UAAUkV,QACjC,GAAI1U,EAAK2M,SAAW3M,EAAK2M,QAAQ9I,IAAMsqC,EAAItqC,GAAI,OAAO7D,EAAK2M,OAGvE,CACA7L,EAAKA,EAAGutC,aACZ,CAEA,OAAOhvC,SAAS2uC,iBAAiBpxC,KAAKy8B,SAASn2B,EAAGtG,KAAKy8B,SAASj2B,EACpE,E,4EChKJ,UA5BgC,CAC/BkF,SAAU,CACTC,iBAAkB,YAClBC,oBAAqB,CACpB7F,SAAU,WACVT,KAAM,IACNE,IAAK,IACLqG,MAAO,MACPC,OAAQ,OACRC,WAAY,UACZ/G,MAAO,UACPgH,UAAW,OACX+e,OAAQ,OACR2mB,QAAS,QAEVzlC,gBAAiB,CAChBF,WAAY,UACZ/G,MAAO,UACPgH,UAAW,OACXzH,QAAS,MACT2H,aAAc,MACdC,UAAW,4BACX4e,OAAQ,OACR2mB,QAAS,S,eCXZ,SAASC,EAAgBlxC,EAAM2c,GAC7B,GAAIlP,MAAM4lB,QAAQrzB,GAChB,IAAK,MAAMmxC,KAASnxC,EAClBkxC,EAAgBC,EAAOx0B,QAI3B,GAAoB,iBAAT3c,EAMXoxC,EAAenxC,OAAOoxC,oBAAoB10B,IAC1C20B,GAAUtxC,GAAQC,OAAOib,OAAOo2B,GAAUtxC,IAAS,CAAC,EAAG2c,QANrD,IAAK,MAAMw0B,KAASnxC,EAClBkxC,EAAgBC,EAAOnxC,EAAKmxC,GAMlC,CACA,SAASI,EAAcvxC,GACrB,OAAOsxC,GAAUtxC,IAAS,CAAC,CAC7B,CAIA,SAASoxC,EAAeI,GACtBC,GAAMhwC,QAAQ+vC,EAChB,CAGA,SAASt9B,EAAIw9B,EAAOC,GAClB,IAAIxhC,EACJ,MAAMyhC,EAAKF,EAAM9hC,OACXuY,EAAS,GACf,IAAKhY,EAAI,EAAGA,EAAIyhC,EAAIzhC,IAClBgY,EAAO1mB,KAAKkwC,EAAMD,EAAMvhC,KAE1B,OAAOgY,CACT,CAGA,SAAS1Q,EAAOi6B,EAAOC,GACrB,IAAIxhC,EACJ,MAAMyhC,EAAKF,EAAM9hC,OACXuY,EAAS,GACf,IAAKhY,EAAI,EAAGA,EAAIyhC,EAAIzhC,IACdwhC,EAAMD,EAAMvhC,KACdgY,EAAO1mB,KAAKiwC,EAAMvhC,IAGtB,OAAOgY,CACT,CAGA,SAAS0pB,EAAQ5E,GACf,OAAOA,EAAI,IAAMjhC,KAAKmgB,GAAK,GAC7B,CAQA,SAAS2lB,EAAYx9B,GACnB,OAAOA,EAAE/G,QAAQ,WAAY,SAAUoP,EAAGxK,GACxC,MAAO,IAAMA,EAAE+W,aACjB,EACF,CAGA,SAAS6oB,EAAWz9B,GAClB,OAAOA,EAAE09B,OAAO,GAAGlE,cAAgBx5B,EAAE7H,MAAM,EAC7C,CAGA,SAASwlC,EAAiBrmC,EAASR,EAAOC,EAAQoU,GAShD,OARa,MAATrU,GAA2B,MAAVC,IACnBoU,EAAMA,GAAO7T,EAAQqB,OACR,MAAT7B,EACFA,EAAQqU,EAAIrU,MAAQqU,EAAIpU,OAASA,EACd,MAAVA,IACTA,EAASoU,EAAIpU,OAASoU,EAAIrU,MAAQA,IAG/B,CACLA,MAAOA,EACPC,OAAQA,EAEZ,CAOA,SAAS6mC,EAAUC,EAAGvmC,GACpB,MAAMwmC,EAASD,EAAEC,OAEjB,IAAIC,EAAa,MAARF,EAAEE,GAAaF,EAAEE,GAAkB,MAAbF,EAAEG,QAAkBH,EAAEG,QAAU,SAC3DC,EAAa,MAARJ,EAAEI,GAAaJ,EAAEI,GAAkB,MAAbJ,EAAEK,QAAkBL,EAAEK,QAAU,SAGjD,MAAVJ,KACDC,EAAIE,GAAM9kC,MAAM4lB,QAAQ+e,GAAUA,EAA2B,iBAAXA,EAAsB,CAACA,EAAOvsC,EAAGusC,EAAOrsC,GAAK,CAACqsC,EAAQA,IAI3G,MAAMK,EAAsB,iBAAPJ,EACfK,EAAsB,iBAAPH,EACrB,GAAIE,GAASC,EAAO,CAClB,MAAM,OACJrnC,EAAM,MACND,EAAK,EACLvF,EAAC,EACDE,GACE6F,EAAQqB,OAGRwlC,IACFJ,EAAKA,EAAGprB,SAAS,QAAUphB,EAAIwsC,EAAGprB,SAAS,SAAWphB,EAAIuF,EAAQvF,EAAIuF,EAAQ,GAE5EsnC,IACFH,EAAKA,EAAGtrB,SAAS,OAASlhB,EAAIwsC,EAAGtrB,SAAS,UAAYlhB,EAAIsF,EAAStF,EAAIsF,EAAS,EAEpF,CAGA,MAAO,CAACgnC,EAAIE,EACd,CAoDA,SAASI,EAAeC,EAAM,KAAMC,EAAM,MACxCC,GAAQ9V,OAAS4V,EACjBE,GAAQ9wC,SAAW6wC,CACrB,CAEA,SAASE,IACPC,GAAKhW,OAAS8V,GAAQ9V,OACtBgW,GAAKhxC,SAAW8wC,GAAQ9wC,QAC1B,CACA,SAASixC,IACPH,GAAQ9V,OAASgW,GAAKhW,OACtB8V,GAAQ9wC,SAAWgxC,GAAKhxC,QAC1B,CAOA,SAASkxC,IACP,OAAOJ,GAAQ9V,MACjB,CAiBA,SAASmW,EAAOnzC,EAAMozC,EAAK3tC,IAEzB,OAAOqtC,GAAQ9wC,SAASqxC,gBAAgBD,EAAIpzC,EAC9C,CACA,SAASszC,EAAa1nC,EAAS2nC,EAAS,GACtC,GAAI3nC,aAAmB4nC,GAAM,OAAO5nC,EACpC,GAAuB,iBAAZA,EACT,OAAO6nC,GAAQ7nC,GAEjB,GAAe,MAAXA,EACF,OAAO,IAAIi8B,GAAS5oC,IAEtB,GAAuB,iBAAZ2M,GAA8C,MAAtBA,EAAQomC,OAAO,GAChD,OAAOyB,GAAQX,GAAQ9wC,SAASi9B,cAAcrzB,IAIhD,MAAM84B,EAAU6O,EAAST,GAAQ9wC,SAASC,cAAc,OAASkxC,EAAO,OASxE,OARAzO,EAAQ/9B,UAAYiF,EAIpBA,EAAU6nC,GAAQ/O,EAAQgP,YAG1BhP,EAAQiP,YAAYjP,EAAQgP,YACrB9nC,CACT,CACA,SAASgoC,EAAU5zC,EAAM2C,GACvB,OAAOA,IAASA,aAAgBmwC,GAAQ9V,OAAO6W,MAAQlxC,EAAKmxC,eAAiBnxC,aAAgBA,EAAKmxC,cAAcC,YAAYF,MAAQlxC,EAAOwwC,EAAOnzC,EACpJ,CAGA,SAASg0C,EAAMrxC,GAEb,IAAKA,EAAM,OAAO,KAGlB,GAAIA,EAAKsxC,oBAAoBT,GAAM,OAAO7wC,EAAKsxC,SAC/C,GAAsB,uBAAlBtxC,EAAKuxC,SACP,OAAO,IAAIrM,GAASsM,SAASxxC,GAI/B,IAAIT,EAAY6vC,EAAWpvC,EAAKuxC,UAAY,OAU5C,MAPkB,mBAAdhyC,GAAgD,mBAAdA,EACpCA,EAAY,WAGF2lC,GAAS3lC,KACnBA,EAAY,OAEP,IAAI2lC,GAAS3lC,GAAWS,EACjC,CAKA,SAASwE,EAASyE,EAAS5L,EAAO4L,EAAQ5L,KAAMo0C,EAAS,GAIvD,OAHAvM,GAAS7nC,GAAQ4L,EACbwoC,IAAQvM,GAAS5oC,IAAQ2M,GAC7BwlC,EAAenxC,OAAOoxC,oBAAoBzlC,EAAQ1L,YAC3C0L,CACT,CACA,SAASyoC,EAASr0C,GAChB,OAAO6nC,GAAS7nC,EAClB,CAMA,SAASs0C,EAAIt0C,GACX,MAAO,QAAU+xC,EAAW/xC,GAAQu0C,IACtC,CAGA,SAASC,EAAY7xC,GAEnB,IAAK,IAAIwN,EAAIxN,EAAK+jB,SAAS9W,OAAS,EAAGO,GAAK,EAAGA,IAC7CqkC,EAAY7xC,EAAK+jB,SAASvW,IAE5B,OAAIxN,EAAK6D,IACP7D,EAAK6D,GAAK8tC,EAAI3xC,EAAKuxC,UACZvxC,GAEFA,CACT,CAGA,SAAS8xC,EAAOC,EAASC,GACvB,IAAI7jC,EAAKX,EAET,IAAKA,GADLukC,EAAUjnC,MAAM4lB,QAAQqhB,GAAWA,EAAU,CAACA,IAC7B9kC,OAAS,EAAGO,GAAK,EAAGA,IACnC,IAAKW,KAAO6jC,EACVD,EAAQvkC,GAAGjQ,UAAU4Q,GAAO6jC,EAAQ7jC,EAG1C,CACA,SAAS8jC,EAAkBhR,GACzB,OAAO,YAAaxyB,GAClB,MAAM+gC,EAAI/gC,EAAKA,EAAKxB,OAAS,GAC7B,OAAIuiC,GAAKA,EAAExxC,cAAgBV,QAAYkyC,aAAa1kC,MAG3Cm2B,EAAGiR,MAAMt1C,KAAM6R,GAFfwyB,EAAGiR,MAAMt1C,KAAM6R,EAAK3E,MAAM,GAAI,IAAIe,KAAK2kC,EAIlD,CACF,CAkVA,SAAS2C,EAAaC,GACpB,MAAMC,EAAUhpC,KAAKghC,MAAM+H,GAErBviC,EADUxG,KAAKK,IAAI,EAAGL,KAAKC,IAAI,IAAK+oC,IACtBviC,SAAS,IAC7B,OAAsB,IAAfD,EAAI5C,OAAe,IAAM4C,EAAMA,CACxC,CACA,SAASyiC,EAAGC,EAAQC,GAClB,IAAK,IAAIhlC,EAAIglC,EAAMvlC,OAAQO,KACzB,GAAwB,MAApB+kC,EAAOC,EAAMhlC,IACf,OAAO,EAGX,OAAO,CACT,CAsDA,SAASilC,EAAS7vB,EAAGwE,EAAG/W,GAGtB,OAFIA,EAAI,IAAGA,GAAK,GACZA,EAAI,IAAGA,GAAK,GACZA,EAAI,EAAI,EAAUuS,EAAc,GAATwE,EAAIxE,GAASvS,EACpCA,EAAI,GAAc+W,EAClB/W,EAAI,EAAI,EAAUuS,GAAKwE,EAAIxE,IAAM,EAAI,EAAIvS,GAAK,EAC3CuS,CACT,CA4fA,SAAS8vB,EAAYzrB,EAAGrX,GACtB,OAAOvG,KAAK+gB,IAAIxa,EAAIqX,GAAK,IAC3B,CAybA,SAAS0rB,IAEP,IAAKA,EAAO9yC,MAAO,CACjB,MAAMiD,EAAM6tC,IAAevmC,KAAK,EAAG,GACnCtH,EAAI9C,KAAKgB,MAAM4xC,QAAU,CAAC,aAAc,qBAAsB,cAAe,aAAc,oBAAoBphC,KAAK,KACpH1O,EAAI+H,KAAK,YAAa,SACtB/H,EAAI+H,KAAK,cAAe,QACxB,MAAMoT,EAAOnb,EAAImb,OAAOje,KACxB2yC,EAAO9yC,MAAQ,CACbiD,MACAmb,OAEJ,CACA,IAAK00B,EAAO9yC,MAAMiD,IAAI9C,KAAK8L,WAAY,CACrC,MAAM8D,EAAIugC,GAAQ9wC,SAASM,MAAQwwC,GAAQ9wC,SAASwzC,gBACpDF,EAAO9yC,MAAMiD,IAAI2oB,MAAM7b,EACzB,CACA,OAAO+iC,EAAO9yC,KAChB,CAEA,SAASizC,EAAYh2B,GACnB,QAAQA,EAAIrU,OAAUqU,EAAIpU,QAAWoU,EAAI5Z,GAAM4Z,EAAI1Z,EACrD,CAwEA,SAAS2vC,EAAOjyC,EAAIkyC,EAAWC,GAC7B,IAAIn2B,EACJ,IAME,GAJAA,EAAMk2B,EAAUlyC,EAAGd,MAIf8yC,EAAYh2B,KA/EC9c,EA+EoBc,EAAGd,QA9E1BmwC,GAAQ9wC,YAAa8wC,GAAQ9wC,SAASwzC,gBAAgBtW,UAAY,SAAUv8B,GAE1F,KAAOA,EAAK8L,YACV9L,EAAOA,EAAK8L,WAEd,OAAO9L,IAASmwC,GAAQ9wC,QAC1B,GAAGlC,KAAKgzC,GAAQ9wC,SAASwzC,gBAAiB7yC,GAyEtC,MAAM,IAAIgR,MAAM,yBAEpB,CAAE,MAAOpQ,GAEPkc,EAAMm2B,EAAMnyC,EACd,CArFF,IAAqBd,EAsFnB,OAAO8c,CACT,CAwJA,SAASo2B,EAASC,EAAOtnC,GACvB,OAAO,IAAIunC,GAAK7hC,GAAK1F,GAAUskC,GAAQ9wC,UAAUg0C,iBAAiBF,GAAQ,SAAUnzC,GAClF,OAAOqxC,EAAMrxC,EACf,GACF,CAYA,SAASszC,EAAUhC,GACjB,IAAI18B,EAAI08B,EAASiC,iBAKjB,OAFI3+B,IAAMu7B,GAAQ9V,SAAQzlB,EAAI4+B,IACzB5+B,EAAE7P,SAAQ6P,EAAE7P,OAAS,CAAC,GACpB6P,EAAE7P,MACX,CACA,SAAS0uC,EAAenC,GACtB,OAAOA,EAASmC,gBAClB,CACA,SAASC,EAAYpC,GACnB,IAAI18B,EAAI08B,EAASiC,iBACb3+B,IAAMu7B,GAAQ9V,SAAQzlB,EAAI4+B,IAC1B5+B,EAAE7P,SAAQ6P,EAAE7P,OAAS,CAAC,EAC5B,CAGA,SAAS6J,EAAG5O,EAAM+E,EAAQsoB,EAAUsmB,EAASnsB,GAC3C,MAAMN,EAAImG,EAASoF,KAAKkhB,GAAW3zC,GAC7BsxC,EAAWX,EAAa3wC,GACxB4zC,EAAMN,EAAUhC,GAChB18B,EAAI6+B,EAAenC,GAGzBvsC,EAAS+F,MAAM4lB,QAAQ3rB,GAAUA,EAASA,EAAOwrB,MAAMsjB,IAGlDxmB,EAASymB,mBACZzmB,EAASymB,mBAAqBC,IAEhChvC,EAAOhF,QAAQ,SAAU0hC,GACvB,MAAMx/B,EAAKw/B,EAAMlR,MAAM,KAAK,GACtBkgB,EAAKhP,EAAMlR,MAAM,KAAK,IAAM,IAGlCqjB,EAAI3xC,GAAM2xC,EAAI3xC,IAAO,CAAC,EACtB2xC,EAAI3xC,GAAIwuC,GAAMmD,EAAI3xC,GAAIwuC,IAAO,CAAC,EAG9BmD,EAAI3xC,GAAIwuC,GAAIpjB,EAASymB,kBAAoB5sB,EAGzCtS,EAAEjU,iBAAiBsB,EAAIilB,EAAGM,GAAW,EACvC,EACF,CAGA,SAAS3Y,EAAI7O,EAAM+E,EAAQsoB,EAAU7F,GACnC,MAAM8pB,EAAWX,EAAa3wC,GACxB4zC,EAAMN,EAAUhC,GAChB18B,EAAI6+B,EAAenC,IAGD,mBAAbjkB,IACTA,EAAWA,EAASymB,qBAKtB/uC,EAAS+F,MAAM4lB,QAAQ3rB,GAAUA,GAAUA,GAAU,IAAIwrB,MAAMsjB,KACxD9zC,QAAQ,SAAU0hC,GACvB,MAAMx/B,EAAKw/B,GAASA,EAAMlR,MAAM,KAAK,GAC/BkgB,EAAKhP,GAASA,EAAMlR,MAAM,KAAK,GACrC,IAAIyjB,EAAW9sB,EACf,GAAImG,EAEEumB,EAAI3xC,IAAO2xC,EAAI3xC,GAAIwuC,GAAM,OAE3B77B,EAAErS,oBAAoBN,EAAI2xC,EAAI3xC,GAAIwuC,GAAM,KAAKpjB,GAAW7F,GAAW,UAC5DosB,EAAI3xC,GAAIwuC,GAAM,KAAKpjB,SAEvB,GAAIprB,GAAMwuC,GAEf,GAAImD,EAAI3xC,IAAO2xC,EAAI3xC,GAAIwuC,GAAK,CAC1B,IAAKvpB,KAAK0sB,EAAI3xC,GAAIwuC,GAChB5hC,EAAI+F,EAAG,CAAC3S,EAAIwuC,GAAIj/B,KAAK,KAAM0V,UAEtB0sB,EAAI3xC,GAAIwuC,EACjB,OACK,GAAIA,EAET,IAAKhP,KAASmS,EACZ,IAAKI,KAAaJ,EAAInS,GAChBgP,IAAOuD,GACTnlC,EAAI+F,EAAG,CAAC6sB,EAAOgP,GAAIj/B,KAAK,WAIzB,GAAIvP,GAET,GAAI2xC,EAAI3xC,GAAK,CACX,IAAK+xC,KAAaJ,EAAI3xC,GACpB4M,EAAI+F,EAAG,CAAC3S,EAAI+xC,GAAWxiC,KAAK,aAEvBoiC,EAAI3xC,EACb,MACK,CAEL,IAAKw/B,KAASmS,EACZ/kC,EAAI+F,EAAG6sB,GAETiS,EAAYpC,EACd,CACF,EACF,CACA,SAAS2C,EAASj0C,EAAMyhC,EAAO3uB,EAAM0U,GACnC,MAAM5S,EAAI6+B,EAAezzC,GAazB,OAVIyhC,aAAiB0O,GAAQ9V,OAAO6Z,QAGlCzS,EAAQ,IAAI0O,GAAQ9V,OAAO8Z,YAAY1S,EAAO,CAC5C2S,OAAQthC,EACRuhC,WAAY,KACT7sB,KALL5S,EAAE0/B,cAAc7S,GASXA,CACT,CA8CA,SAAS8S,IAAQ,CAq7BjB,SAASprB,EAAGA,GACV,OAAOvsB,KAAKiO,KAAK,KAAMse,EACzB,CAGA,SAASC,EAAGA,GACV,OAAOxsB,KAAKiO,KAAK,KAAMue,EACzB,CAGA,SAASorB,EAAItxC,GACX,OAAY,MAALA,EAAYtG,KAAK2mB,KAAO3mB,KAAKusB,KAAOvsB,KAAK2mB,GAAGrgB,EAAItG,KAAKusB,KAC9D,CAGA,SAASsrB,EAAIrxC,GACX,OAAY,MAALA,EAAYxG,KAAK4mB,KAAO5mB,KAAKwsB,KAAOxsB,KAAK4mB,GAAGpgB,EAAIxG,KAAKwsB,KAC9D,CAGA,SAASsrB,EAAKxxC,GACZ,OAAOtG,KAAKiO,KAAK,KAAM3H,EACzB,CAGA,SAASyxC,EAAKvxC,GACZ,OAAOxG,KAAKiO,KAAK,KAAMzH,EACzB,CAGA,SAASwxC,EAAQnsC,GACf,OAAgB,MAATA,EAA4B,EAAZ7L,KAAKusB,KAAWvsB,KAAKusB,GAAG,IAAI0rB,GAAUpsC,GAAOqsC,OAAO,GAC7E,CAGA,SAASC,EAASrsC,GAChB,OAAiB,MAAVA,EAA6B,EAAZ9L,KAAKwsB,KAAWxsB,KAAKwsB,GAAG,IAAIyrB,GAAUnsC,GAAQosC,OAAO,GAC/E,CA2DA,SAAS/pC,EAAK7H,EAAGE,GACf,MAAwC,oBAAhCxG,KAAKo4C,UAAYp4C,MAAMsD,KAA4BtD,KAAKiO,KAAK,CACnEoqC,GAAI,IAAIJ,GAAU3xC,GAClBgyC,GAAI,IAAIL,GAAUzxC,KACfxG,KAAKiO,KAAK,CACb+7B,GAAI,IAAIiO,GAAU3xC,GAClB2jC,GAAI,IAAIgO,GAAUzxC,IAEtB,CACA,SAASyd,EAAG3d,EAAGE,GACb,MAAwC,oBAAhCxG,KAAKo4C,UAAYp4C,MAAMsD,KAA4BtD,KAAKiO,KAAK,CACnE0Y,GAAI,IAAIsxB,GAAU3xC,GAClBsgB,GAAI,IAAIqxB,GAAUzxC,KACfxG,KAAKiO,KAAK,CACbi8B,GAAI,IAAI+N,GAAU3xC,GAClB6jC,GAAI,IAAI8N,GAAUzxC,IAEtB,CAqcA,SAAS+xC,EAAiBjU,EAAGkU,GAC3B,OAAO,SAAU/sC,GACf,OAAS,MAALA,EAAkBzL,KAAKskC,IAC3BtkC,KAAKskC,GAAK74B,EACN+sC,GAAGA,EAAEj4C,KAAKP,MACPA,KACT,CACF,CA+GA,SAASy4C,IAEP,MAAMC,GAAY14C,KAAK24C,WAAa,KAAO,IACrCC,EAAY54C,KAAK64C,YAAc,EAI/BC,EAAKrsC,KAAKmgB,GACVmsB,EAAKtsC,KAAKwxB,IAAI2a,EAAY,IAFpB,OAGNI,GAAQD,EAAKtsC,KAAK2gB,KAAK0rB,EAAKA,EAAKC,EAAKA,GACtCE,EAAK,KAAOD,EAAON,GAGzB14C,KAAK0tC,EAAI,EAAIsL,EAAOC,EACpBj5C,KAAKskC,EAAI2U,EAAKA,CAChB,CAmJA,SAASC,EAAgBnD,GACvB,OAAOA,EAAOxI,QAAQl9B,QAAU0lC,EAAOxI,QAAQl9B,OAAS,IAAM8oC,GAAkBpD,EAAOxI,QAAQ,GAAGgB,cACpG,CACA,SAAS6K,GAAgBrD,EAAQsD,GAC/BtD,EAAOuD,UAAYC,GAAexD,EAAQ,GAC1C,MAAMyD,EAAaC,GAAaC,KAAKL,GACrC,GAAIG,EACFzD,EAAOxI,QAAU,CAAC8L,OACb,CACL,MAAMM,EAAc5D,EAAO4D,YACrBC,EAAQD,EAAYhwB,cACpBkwB,EAAUF,IAAgBC,EAChC7D,EAAOxI,QAAU,CAAW,MAAVqM,EAAgBC,EAAU,IAAM,IAAMF,EAC1D,CAGA,OAFA5D,EAAO+D,UAAY,EACnB/D,EAAO4D,YAAc5D,EAAOxI,QAAQ,GAC7BiM,CACT,CACA,SAASD,GAAexD,EAAQuD,GAC9B,IAAKvD,EAAOuD,SAAU,MAAM,IAAIllC,MAAM,gBACtC2hC,EAAOgE,QAAUhE,EAAOxI,QAAQrrC,KAAKuM,WAAWsnC,EAAOgE,SACvDhE,EAAOuD,SAAWA,EAClBvD,EAAOgE,OAAS,GAChBhE,EAAOiE,UAAY,EACnBjE,EAAOkE,YAAc,EACjBf,EAAgBnD,IAClBvsB,GAAgBusB,EAEpB,CACA,SAASvsB,GAAgBusB,GACvBA,EAAO+D,UAAY,EACf/D,EAAOmE,WACTnE,EAAOxI,QApCX,SAAqBwI,GACnB,MAAMoE,EAAUpE,EAAOxI,QAAQ,GAC/B,OAAO6M,GAAaD,GAASpE,EAAOxI,QAAQrgC,MAAM,GAAI6oC,EAAO/vB,EAAG+vB,EAAOsE,GACzE,CAiCqBC,CAAYvE,IAE/BA,EAAOprB,SAASzoB,KAAK6zC,EAAOxI,QAC9B,CACA,SAASgN,GAAUxE,GACjB,IAAKA,EAAOxI,QAAQl9B,OAAQ,OAAO,EACnC,MAAMmqC,EAA4C,MAApCzE,EAAOxI,QAAQ,GAAGgB,cAC1Bl+B,EAAS0lC,EAAOxI,QAAQl9B,OAC9B,OAAOmqC,IAAqB,IAAXnqC,GAA2B,IAAXA,EACnC,CACA,SAASoqC,GAAc1E,GACrB,MAA0C,MAAnCA,EAAO2E,UAAUnM,aAC1B,CA+aA,SAASoM,GAAsBr3C,EAAO,IACpCs3C,GAAe14C,QAAQ,GAAG2nB,OAAOvmB,GACnC,CACA,SAASu3C,KACP3F,EAAO0F,GAAgB,CACrB,EAAA32B,CAAGoU,GACD,OAAO,IAAIyiB,IAAYx3C,KAAKtD,KAAKoB,aAAa+M,KAAKnO,KAAKq8B,WACvDpY,GAAGoU,EACN,EACA,SAAA0iB,CAAUC,GAER,OADAh7C,KAAKob,KAAK4/B,GACHh7C,IACT,EACA,YAAAi7C,GACE,OAAOj7C,KAAKq8B,SACd,EACA,KAAA6e,CAAM/sC,EAAM8V,EAAI2Z,EAAKud,EAASC,GAI5B,OAAOp7C,KAAK+6C,UAAU5sC,EAAKwG,IAHZ,SAAU/D,EAAG+X,GAC1B,OAAOwyB,EAAQlnB,KAAKrjB,EAAGqT,EAAG0E,GAAQiV,EAAKwd,EAAQzyB,GAAQyyB,EACzD,GAEF,GAEJ,CAujCA,SAASC,KAEP,MACMC,EADUt7C,KAAKu7C,uBAAuBC,QACf7mC,IAAI8mC,IAAoBC,OAAOC,GAAW,IAAItnB,IAC3Er0B,KAAK0X,UAAU4jC,GACft7C,KAAKu7C,uBAAuBK,QACiB,IAAzC57C,KAAKu7C,uBAAuBlrC,WAC9BrQ,KAAK67C,SAAW,KAEpB,CA74KA,MAAM9J,GAAY,CAAC,EACbG,GAAQ,GAgIR4J,GAAsB,IAAIz6C,IAAI,CAAC,OAAQ,WAAY,UACnD06C,GAAgB1vC,GAAWyvC,GAAoBt6C,IAAI6K,EAAQsoC,UAC3DqH,GAAiB,CAAC3vC,EAAS6J,EAAM+lC,EAAW,CAAC,KACjD,MAAMC,EAAS,IACVhmC,GAEL,IAAK,MAAM3E,KAAO2qC,EACZA,EAAO3qC,GAAK4qC,YAAcF,EAAS1qC,WAC9B2qC,EAAO3qC,GAGd7Q,OAAO85B,KAAK0hB,GAAQ7rC,OACtBhE,EAAQjJ,KAAKmL,aAAa,aAAcwI,KAAKC,UAAUklC,KAEvD7vC,EAAQjJ,KAAKg5C,gBAAgB,cAC7B/vC,EAAQjJ,KAAKg5C,gBAAgB,gBAIjC,IAAIC,GAAQ,CACVC,UAAW,KACX9J,WAAYA,EACZhF,QA7FF,SAAiBjjB,GACf,OAAW,IAAJA,EAAU9d,KAAKmgB,GAAK,GAC7B,EA4FE1U,OAAQA,EACRy6B,UAAWA,EACXoJ,cAAeA,GACfpnC,IAAKA,EACL+9B,iBAAkBA,EAClBJ,QAASA,EACTC,YAAaA,EACbyJ,eAAgBA,IAIlB,MAAM91C,GAAM,6BACN+kB,GAAO,+BACPsxB,GAAQ,gCACRC,GAAQ,+BAEd,IAAIC,GAAa,CACfH,UAAW,KACXrxB,KAAMA,GACN/kB,IAAKA,GACLs2C,MAAOA,GACPD,MAAOA,IAGT,MAAMhJ,GAAU,CACd9V,OAA0B,oBAAXA,OAAyB,KAAOA,OAC/Ch7B,SAA8B,oBAAbA,SAA2B,KAAOA,UAM/CgxC,GAAO,CAAC,EAmBd,MAAMQ,IAWN,MAAM3L,GAAW,CAAC,EACZ5oC,GAAO,sBA2Db,IAAIw0C,GAAUO,EAeVO,GAAM,IA4HVrD,EAAgB,MAAO,CACrB+K,SAnFF,WACE,OAAO18C,KAAKiP,SAASkY,UACvB,EAkFEphB,SA/EF,WACE,OAAO/F,KAAKiP,SAAS0Z,MAAM3oB,KAC7B,EA8EEuyB,KA3EF,WACE,OAAOvyB,KAAK08C,WAAW18C,KAAK+F,WAAa,EAC3C,EA0EEimB,KAvEF,WACE,OAAOhsB,KAAK08C,WAAW18C,KAAK+F,WAAa,EAC3C,EAsEE42C,QAnEF,WACE,MAAM/rC,EAAI5Q,KAAK+F,WAKf,OAJU/F,KAAKiP,SAGbxN,IAAIzB,KAAK6F,SAAU+K,EAAI,GAClB5Q,IACT,EA6DE48C,SA1DF,WACE,MAAMhsC,EAAI5Q,KAAK+F,WAGf,OAFU/F,KAAKiP,SACbxN,IAAIzB,KAAK6F,SAAU+K,EAAIA,EAAI,EAAI,GAC1B5Q,IACT,EAsDE8+B,MAnDF,WAKE,OAJU9+B,KAAKiP,SAGbxN,IAAIzB,KAAK6F,UACJ7F,IACT,EA8CE0Y,KA3CF,WAKE,OAJU1Y,KAAKiP,SAGbxN,IAAIzB,KAAK6F,SAAU,GACd7F,IACT,EAsCE68C,OAnCF,SAAgBxwC,IACdA,EAAU0nC,EAAa1nC,IACfxG,SACR,MAAM+K,EAAI5Q,KAAK+F,WAEf,OADA/F,KAAKiP,SAASxN,IAAI4K,EAASuE,GACpB5Q,IACT,EA8BE88C,MA3BF,SAAezwC,IACbA,EAAU0nC,EAAa1nC,IACfxG,SACR,MAAM+K,EAAI5Q,KAAK+F,WAEf,OADA/F,KAAKiP,SAASxN,IAAI4K,EAASuE,EAAI,GACxB5Q,IACT,EAsBEmP,aArBF,SAAsB9C,GAGpB,OAFAA,EAAU0nC,EAAa1nC,IACfwwC,OAAO78C,MACRA,IACT,EAkBE+8C,YAjBF,SAAqB1wC,GAGnB,OAFAA,EAAU0nC,EAAa1nC,IACfywC,MAAM98C,MACPA,IACT,IAiBA,MAAMg9C,GAAgB,qDAGhB/pC,GAAM,4CAGNgqC,GAAM,2BAGNC,GAAY,yBAGZC,GAAa,aAGbC,GAAa,MAGbC,GAAQ,iCAGRC,GAAQ,SAGRC,GAAU,WAGVC,GAAW,0CAGXC,GAAU,wCAGVxG,GAAY,SAGZwC,GAAe,gBAErB,IAAIiE,GAAQ,CACVpB,UAAW,KACXrF,UAAWA,GACXhkC,IAAKA,GACLsqC,QAASA,GACTF,MAAOA,GACPI,QAASA,GACTD,SAAUA,GACV/D,aAAcA,GACd6D,MAAOA,GACPN,cAAeA,GACfE,UAAWA,GACXD,IAAKA,GACLE,WAAYA,GACZC,WAAYA,IAsCdzL,EAAgB,MAAO,CACrBlqB,QAnCF,WACE,MAAMxZ,EAAOjO,KAAKiO,KAAK,SACvB,OAAe,MAARA,EAAe,GAAKA,EAAK4lB,OAAOF,MAAMsjB,GAC/C,EAiCE5vB,SA9BF,SAAkB5mB,GAChB,OAAyC,IAAlCT,KAAKynB,UAAUa,QAAQ7nB,EAChC,EA6BEqW,SA1BF,SAAkBrW,GAChB,IAAKT,KAAKqnB,SAAS5mB,GAAO,CACxB,MAAM0xC,EAAQnyC,KAAKynB,UACnB0qB,EAAMjwC,KAAKzB,GACXT,KAAKiO,KAAK,QAASkkC,EAAMv9B,KAAK,KAChC,CACA,OAAO5U,IACT,EAoBEuvC,YAjBF,SAAqB9uC,GAMnB,OALIT,KAAKqnB,SAAS5mB,IAChBT,KAAKiO,KAAK,QAASjO,KAAKynB,UAAUvP,OAAO,SAAUvT,GACjD,OAAOA,IAAMlE,CACf,GAAGmU,KAAK,MAEH5U,IACT,EAWE29C,YARF,SAAqBl9C,GACnB,OAAOT,KAAKqnB,SAAS5mB,GAAQT,KAAKuvC,YAAY9uC,GAAQT,KAAK8W,SAASrW,EACtE,IAmEAkxC,EAAgB,MAAO,CACrBtS,IA1DF,SAAaj7B,EAAOi0B,GAClB,MAAMulB,EAAM,CAAC,EACb,GAAyB,IAArB92C,UAAUuJ,OAQZ,OANArQ,KAAKoD,KAAKgB,MAAM4xC,QAAQriB,MAAM,WAAWzb,OAAO,SAAUhU,GACxD,QAASA,EAAGmM,MACd,GAAGlN,QAAQ,SAAUe,GACnB,MAAMuP,EAAIvP,EAAGyvB,MAAM,WACnBiqB,EAAInqC,EAAE,IAAMA,EAAE,EAChB,GACOmqC,EAET,GAAI92C,UAAUuJ,OAAS,EAAG,CAExB,GAAInC,MAAM4lB,QAAQ1vB,GAAQ,CACxB,IAAK,MAAM3D,KAAQ2D,EAAO,CACxB,MAAMy5C,EAAQp9C,EACdm9C,EAAIn9C,GAAQT,KAAKoD,KAAKgB,MAAM05C,iBAAiBD,EAC/C,CACA,OAAOD,CACT,CAGA,GAAqB,iBAAVx5C,EACT,OAAOpE,KAAKoD,KAAKgB,MAAM05C,iBAAiB15C,GAI1C,GAAqB,iBAAVA,EACT,IAAK,MAAM3D,KAAQ2D,EAEjBpE,KAAKoD,KAAKgB,MAAM25C,YAAYt9C,EAAqB,MAAf2D,EAAM3D,IAAiB88C,GAAQ7D,KAAKt1C,EAAM3D,IAAS,GAAK2D,EAAM3D,GAGtG,CAMA,OAHyB,IAArBqG,UAAUuJ,QACZrQ,KAAKoD,KAAKgB,MAAM25C,YAAY35C,EAAc,MAAPi0B,GAAeklB,GAAQ7D,KAAKrhB,GAAO,GAAKA,GAEtEr4B,IACT,EAkBEyD,KAfF,WACE,OAAOzD,KAAKq/B,IAAI,UAAW,GAC7B,EAcEl4B,KAXF,WACE,OAAOnH,KAAKq/B,IAAI,UAAW,OAC7B,EAUE98B,QAPF,WACE,MAA+B,SAAxBvC,KAAKq/B,IAAI,UAClB,IAkCAsS,EAAgB,MAAO,CACrBz7B,KA1BF,SAAcmU,EAAG5e,EAAG8e,GAClB,GAAS,MAALF,EAEF,OAAOrqB,KAAKkW,KAAKvB,EAAIuD,EAAOlY,KAAKoD,KAAK46C,WAAY95C,GAAuC,IAAjCA,EAAGywC,SAASrsB,QAAQ,UAAiBpkB,GAAMA,EAAGywC,SAASznC,MAAM,KAChH,GAAImd,aAAanc,MAAO,CAC7B,MAAMgI,EAAO,CAAC,EACd,IAAK,MAAM3E,KAAO8Y,EAChBnU,EAAK3E,GAAOvR,KAAKkW,KAAK3E,GAExB,OAAO2E,CACT,CAAO,GAAiB,iBAANmU,EAChB,IAAK5e,KAAK4e,EACRrqB,KAAKkW,KAAKzK,EAAG4e,EAAE5e,SAEZ,GAAI3E,UAAUuJ,OAAS,EAC5B,IACE,OAAO0G,KAAKy6B,MAAMxxC,KAAKiO,KAAK,QAAUoc,GACxC,CAAE,MAAOrmB,GACP,OAAOhE,KAAKiO,KAAK,QAAUoc,EAC7B,MAEArqB,KAAKiO,KAAK,QAAUoc,EAAS,OAAN5e,EAAa,KAAa,GAAN8e,GAA2B,iBAAN9e,GAA+B,iBAANA,EAAiBA,EAAIsL,KAAKC,UAAUvL,IAE/H,OAAOzL,IACT,IAwCA2xC,EAAgB,MAAO,CACrBsM,SAnCF,SAAkB3Z,EAAG74B,GAEnB,GAA4B,iBAAjB3E,UAAU,GACnB,IAAK,MAAMyK,KAAO+yB,EAChBtkC,KAAKi+C,SAAS1sC,EAAK+yB,EAAE/yB,QAElB,IAAyB,IAArBzK,UAAUuJ,OAEnB,OAAOrQ,KAAKk+C,SAAS5Z,GAGrBtkC,KAAKk+C,SAAS5Z,GAAK74B,CACrB,CACA,OAAOzL,IACT,EAsBEm+C,OAnBF,WACE,GAAyB,IAArBr3C,UAAUuJ,OACZrQ,KAAKo+C,QAAU,CAAC,OAEhB,IAAK,IAAIxtC,EAAI9J,UAAUuJ,OAAS,EAAGO,GAAK,EAAGA,WAClC5Q,KAAKk+C,SAASp3C,UAAU8J,IAGnC,OAAO5Q,IACT,EAWEk+C,OANF,WACE,OAAOl+C,KAAKo+C,QAAUp+C,KAAKo+C,SAAW,CAAC,CACzC,IAqFA,MAAMC,GACJ,WAAAj9C,IAAek9C,GACbt+C,KAAKob,QAAQkjC,EACf,CAGA,cAAOC,CAAQv5C,GACb,OAAOA,IAAUA,aAAiBq5C,IAASr+C,KAAKs9C,MAAMt4C,IAAUhF,KAAK05C,KAAK10C,GAC5E,CAGA,YAAOs4C,CAAMt4C,GACX,OAAOA,GAA4B,iBAAZA,EAAMulB,GAAqC,iBAAZvlB,EAAM4N,GAAqC,iBAAZ5N,EAAMgO,CAC7F,CAKA,aAAON,CAAO8rC,EAAO,UAAW/qC,GAE9B,MAAM,OACJf,EAAM,MACN+6B,EAAK,IACL3gB,EACAF,GAAIksB,GACFrsC,KAGJ,GAAa,YAAT+xC,EAAoB,CACtB,MAAMl0B,EAAI,GAAY5X,IAAW,GAC3B/N,EAAI,GAAY+N,IAAW,GAC3BiL,EAAI,IAAMjL,IAEhB,OADc,IAAI2rC,GAAM/zB,EAAG3lB,EAAGgZ,EAAG,MAEnC,CAAO,GAAa,SAAT6gC,EAAiB,CAE1B,MAAMj0B,EAAIkjB,EAAM,GAAK3gB,EAAI,EAAIgsB,GAD7BrlC,EAAS,MAALA,EAAYf,IAAWe,GACW,GAAM,KAAQ,KAC9Cb,EAAI66B,EAAM,GAAK3gB,EAAI,EAAIgsB,EAAKrlC,EAAI,GAAM,KAAO,KAC7CT,EAAIy6B,EAAM,IAAM3gB,EAAI,EAAIgsB,EAAKrlC,EAAI,GAAM,KAAO,KAEpD,OADc,IAAI4qC,GAAM9zB,EAAG3X,EAAGI,EAEhC,CAAO,GAAa,WAATwrC,EAAmB,CAC5B,MAAMl0B,EAAI,EAAY5X,IAAW,GAC3B/N,EAAI,GAAW+N,IAAW,EAC1BiL,EAAI,IAAMjL,IAEhB,OADc,IAAI2rC,GAAM/zB,EAAG3lB,EAAGgZ,EAAG,MAEnC,CAAO,GAAa,SAAT6gC,EAAiB,CAC1B,MAAMl0B,EAAI,GAAK,GAAK5X,IACd/N,EAAI,GAAa+N,IAAW,GAC5BiL,EAAI,IAAMjL,IAEhB,OADc,IAAI2rC,GAAM/zB,EAAG3lB,EAAGgZ,EAAG,MAEnC,CAAO,GAAa,QAAT6gC,EAAgB,CACzB,MAAMj0B,EAAI,IAAM7X,IACVE,EAAI,IAAMF,IACVM,EAAI,IAAMN,IAEhB,OADc,IAAI2rC,GAAM9zB,EAAG3X,EAAGI,EAEhC,CAAO,GAAa,QAATwrC,EAAgB,CACzB,MAAMl0B,EAAI,IAAM5X,IACV2X,EAAI,IAAM3X,IAAW,IACrBM,EAAI,IAAMN,IAAW,IAE3B,OADc,IAAI2rC,GAAM/zB,EAAGD,EAAGrX,EAAG,MAEnC,CAAO,GAAa,SAATwrC,EAAiB,CAC1B,MAAMC,EAAO,IAAM/rC,IAEnB,OADc,IAAI2rC,GAAMI,EAAMA,EAAMA,EAEtC,CACE,MAAM,IAAIrqC,MAAM,gCAEpB,CAGA,WAAOslC,CAAK10C,GACV,MAAwB,iBAAVA,IAAuBq4C,GAAM3D,KAAK10C,IAAUs4C,GAAM5D,KAAK10C,GACvE,CACA,IAAA05C,GAEE,MAAM,GACJC,EAAE,GACFC,EAAE,GACFC,GACE7+C,KAAKi9C,OACF1yB,EAAG3X,EAAGI,GAAK,CAAC2rC,EAAIC,EAAIC,GAAIlqC,IAAIlJ,GAAKA,EAAI,KAGtC64B,EAAI73B,KAAKC,IAAI,EAAI6d,EAAG,EAAI3X,EAAG,EAAII,GACrC,OAAU,IAANsxB,EAEK,IAAI+Z,GAAM,EAAG,EAAG,EAAG,EAAG,QAOjB,IAAIA,IALP,EAAI9zB,EAAI+Z,IAAM,EAAIA,IAClB,EAAI1xB,EAAI0xB,IAAM,EAAIA,IAClB,EAAItxB,EAAIsxB,IAAM,EAAIA,GAGIA,EAAG,OAEtC,CACA,GAAAwa,GAEE,MAAM,GACJH,EAAE,GACFC,EAAE,GACFC,GACE7+C,KAAKi9C,OACF1yB,EAAG3X,EAAGI,GAAK,CAAC2rC,EAAIC,EAAIC,GAAIlqC,IAAIlJ,GAAKA,EAAI,KAGtCqB,EAAML,KAAKK,IAAIyd,EAAG3X,EAAGI,GACrBtG,EAAMD,KAAKC,IAAI6d,EAAG3X,EAAGI,GACrBsX,GAAKxd,EAAMJ,GAAO,EAGlBqyC,EAASjyC,IAAQJ,EAGjBsyC,EAAQlyC,EAAMJ,EAMpB,OADc,IAAI2xC,GAAM,KAHdU,EAAS,EAAIjyC,IAAQyd,IAAM3X,EAAII,GAAKgsC,GAASpsC,EAAII,EAAI,EAAI,IAAM,EAAIlG,IAAQ8F,IAAMI,EAAIuX,GAAKy0B,EAAQ,GAAK,EAAIlyC,IAAQkG,IAAMuX,EAAI3X,GAAKosC,EAAQ,GAAK,EAAI,GAG5H,KAJvBD,EAAS,EAAIz0B,EAAI,GAAM00B,GAAS,EAAIlyC,EAAMJ,GAAOsyC,GAASlyC,EAAMJ,IAIhC,IAAM4d,EAAG,MAErD,CACA,IAAAlP,CAAKiP,EAAI,EAAGrX,EAAI,EAAGrO,EAAI,EAAG+oC,EAAI,EAAGkI,EAAQ,OAKvC,GAHAvrB,EAAKA,GAAI,EAGLrqB,KAAK41C,MACP,IAAK,MAAMJ,KAAax1C,KAAK41C,aACpB51C,KAAKA,KAAK41C,MAAMJ,IAG3B,GAAiB,iBAANnrB,EAETurB,EAAqB,iBAANlI,EAAiBA,EAAIkI,EACpClI,EAAiB,iBAANA,EAAiB,EAAIA,EAGhChtC,OAAOib,OAAO3b,KAAM,CAClB2+C,GAAIt0B,EACJu0B,GAAI5rC,EACJ6rC,GAAIl6C,EACJs6C,GAAIvR,EACJkI,eAGG,GAAIvrB,aAAanc,MACtBlO,KAAK41C,MAAQ5iC,IAAsB,iBAATqX,EAAE,GAAkBA,EAAE,GAAKA,EAAE,KAAO,MAC9D3pB,OAAOib,OAAO3b,KAAM,CAClB2+C,GAAIt0B,EAAE,GACNu0B,GAAIv0B,EAAE,GACNw0B,GAAIx0B,EAAE,GACN40B,GAAI50B,EAAE,IAAM,SAET,GAAIA,aAAa3pB,OAAQ,CAE9B,MAAMqX,EA9NZ,SAAuBsS,EAAGrX,GACxB,MAAM4W,EAAS8rB,EAAGrrB,EAAG,OAAS,CAC5Bs0B,GAAIt0B,EAAEE,EACNq0B,GAAIv0B,EAAEzX,EACNisC,GAAIx0B,EAAErX,EACNisC,GAAI,EACJrJ,MAAO,OACLF,EAAGrrB,EAAG,OAAS,CACjBs0B,GAAIt0B,EAAE/jB,EACNs4C,GAAIv0B,EAAE7jB,EACNq4C,GAAIx0B,EAAEI,EACNw0B,GAAI,EACJrJ,MAAO,OACLF,EAAGrrB,EAAG,OAAS,CACjBs0B,GAAIt0B,EAAE1M,EACNihC,GAAIv0B,EAAEtV,EACN8pC,GAAIx0B,EAAEC,EACN20B,GAAI,EACJrJ,MAAO,OACLF,EAAGrrB,EAAG,OAAS,CACjBs0B,GAAIt0B,EAAEC,EACNs0B,GAAIv0B,EAAEA,EACNw0B,GAAIx0B,EAAErX,EACNisC,GAAI,EACJrJ,MAAO,OACLF,EAAGrrB,EAAG,OAAS,CACjBs0B,GAAIt0B,EAAEC,EACNs0B,GAAIv0B,EAAE1lB,EACNk6C,GAAIx0B,EAAE1M,EACNshC,GAAI,EACJrJ,MAAO,OACLF,EAAGrrB,EAAG,QAAU,CAClBs0B,GAAIt0B,EAAE1lB,EACNi6C,GAAIv0B,EAAEjN,EACNyhC,GAAIx0B,EAAE7jB,EACNy4C,GAAI50B,EAAEia,EACNsR,MAAO,QACL,CACF+I,GAAI,EACJC,GAAI,EACJC,GAAI,EACJjJ,MAAO,OAGT,OADAhsB,EAAOgsB,MAAQ5iC,GAAK4W,EAAOgsB,MACpBhsB,CACT,CAiLqBs1B,CAAc70B,EAAGrX,GAChCtS,OAAOib,OAAO3b,KAAM+X,EACtB,MAAO,GAAiB,iBAANsS,EAChB,GAAIizB,GAAM5D,KAAKrvB,GAAI,CACjB,MAAM80B,EAAe90B,EAAErc,QAAQovC,GAAY,KACpCuB,EAAIC,EAAIC,GAAM5B,GAAImC,KAAKD,GAAcjyC,MAAM,EAAG,GAAGyH,IAAIlJ,GAAKmoB,SAASnoB,IAC1E/K,OAAOib,OAAO3b,KAAM,CAClB2+C,KACAC,KACAC,KACAI,GAAI,EACJrJ,MAAO,OAEX,KAAO,KAAIyH,GAAM3D,KAAKrvB,GAUf,MAAMjW,MAAM,oDAVO,CACxB,MAAMirC,EAAW5zC,GAAKmoB,SAASnoB,EAAG,KAC3B,CAAEkzC,EAAIC,EAAIC,GAAM5rC,GAAImsC,KA9PnC,SAAqBnsC,GACnB,OAAsB,IAAfA,EAAI5C,OAAe,CAAC,IAAK4C,EAAIqsC,UAAU,EAAG,GAAIrsC,EAAIqsC,UAAU,EAAG,GAAIrsC,EAAIqsC,UAAU,EAAG,GAAIrsC,EAAIqsC,UAAU,EAAG,GAAIrsC,EAAIqsC,UAAU,EAAG,GAAIrsC,EAAIqsC,UAAU,EAAG,IAAI1qC,KAAK,IAAM3B,CAC3K,CA4PwCssC,CAAYl1B,IAAI1V,IAAI0qC,GACpD3+C,OAAOib,OAAO3b,KAAM,CAClB2+C,KACAC,KACAC,KACAI,GAAI,EACJrJ,MAAO,OAEX,CAAsE,CAIxE,MAAM,GACJ+I,EAAE,GACFC,EAAE,GACFC,EAAE,GACFI,GACEj/C,KACEw/C,EAA4B,QAAfx/C,KAAK41C,MAAkB,CACxCrrB,EAAGo0B,EACH/rC,EAAGgsC,EACH5rC,EAAG6rC,GACc,QAAf7+C,KAAK41C,MAAkB,CACzBtvC,EAAGq4C,EACHn4C,EAAGo4C,EACHn0B,EAAGo0B,GACc,QAAf7+C,KAAK41C,MAAkB,CACzBj4B,EAAGghC,EACH5pC,EAAG6pC,EACHt0B,EAAGu0B,GACc,QAAf7+C,KAAK41C,MAAkB,CACzBtrB,EAAGq0B,EACHt0B,EAAGu0B,EACH5rC,EAAG6rC,GACc,QAAf7+C,KAAK41C,MAAkB,CACzBtrB,EAAGq0B,EACHh6C,EAAGi6C,EACHjhC,EAAGkhC,GACc,SAAf7+C,KAAK41C,MAAmB,CAC1BjxC,EAAGg6C,EACHvhC,EAAGwhC,EACHp4C,EAAGq4C,EACHva,EAAG2a,GACD,CAAC,EACLv+C,OAAOib,OAAO3b,KAAMw/C,EACtB,CACA,GAAAC,GAEE,MAAM,EACJn5C,EAAC,EACDE,EAAC,EACDikB,GACEzqB,KAAK0/C,MAST,OADc,IAAIrB,GALR,IAAM73C,EAAI,GACV,KAAOF,EAAIE,GACX,KAAOA,EAAIikB,GAGY,MAEnC,CACA,GAAAk1B,GAEE,MAAM,EACJr1B,EAAC,EACDD,EAAC,EACDrX,GACEhT,KAAKy/C,MAGH96C,EAAI8H,KAAK2gB,KAAK/C,GAAK,EAAIrX,GAAK,GAClC,IAAI2K,EAAI,IAAMlR,KAAKmzC,MAAM5sC,EAAGqX,GAAK5d,KAAKmgB,GAQtC,OAPIjP,EAAI,IACNA,IAAM,EACNA,EAAI,IAAMA,GAIE,IAAI0gC,GAAM/zB,EAAG3lB,EAAGgZ,EAAG,MAEnC,CAKA,GAAAs/B,GACE,GAAmB,QAAfj9C,KAAK41C,MACP,OAAO51C,KACF,GAxRK,SADE41C,EAyRM51C,KAAK41C,QAxRM,QAAVA,GAA6B,QAAVA,EAwRP,CAE/B,IAAI,EACFtvC,EAAC,EACDE,EAAC,EACDikB,GACEzqB,KACJ,GAAmB,QAAfA,KAAK41C,OAAkC,QAAf51C,KAAK41C,MAAiB,CAEhD,IAAI,EACFtrB,EAAC,EACDD,EAAC,EACDrX,GACEhT,KACJ,GAAmB,QAAfA,KAAK41C,MAAiB,CACxB,MAAM,EACJjxC,EAAC,EACDgZ,GACE3d,KACE6/C,EAAOpzC,KAAKmgB,GAAK,IACvBvC,EAAI1lB,EAAI8H,KAAKogB,IAAIgzB,EAAOliC,GACxB3K,EAAIrO,EAAI8H,KAAKqgB,IAAI+yB,EAAOliC,EAC1B,CAGA,MAAMmiC,GAAMx1B,EAAI,IAAM,IAChBy1B,EAAK11B,EAAI,IAAMy1B,EACfE,EAAKF,EAAK9sC,EAAI,IAGditC,EAAK,GAAK,IACVC,EAAK,QACLC,EAAK,MACX75C,EAAI,QAAWy5C,GAAM,EAAIG,EAAKH,GAAM,GAAKA,EAAKE,GAAME,GACpD35C,EAAI,GAAOs5C,GAAM,EAAII,EAAKJ,GAAM,GAAKA,EAAKG,GAAME,GAChD11B,EAAI,SAAWu1B,GAAM,EAAIE,EAAKF,GAAM,GAAKA,EAAKC,GAAME,EACtD,CAGA,MAAMC,EAAS,OAAJ95C,GAAkB,OAALE,GAAmB,MAALikB,EAChC41B,GAAU,MAAL/5C,EAAkB,OAAJE,EAAiB,MAAJikB,EAChC61B,EAAS,MAAJh6C,GAAkB,KAALE,EAAiB,MAAJikB,EAG/B81B,EAAM9zC,KAAK8zC,IACXC,EAAK,SACLj2B,EAAI61B,EAAKI,EAAK,MAAQD,EAAIH,EAAI,EAAI,KAAO,KAAQ,MAAQA,EACzDxtC,EAAIytC,EAAKG,EAAK,MAAQD,EAAIF,EAAI,EAAI,KAAO,KAAQ,MAAQA,EACzDrtC,EAAIstC,EAAKE,EAAK,MAAQD,EAAID,EAAI,EAAI,KAAO,KAAQ,MAAQA,EAI/D,OADc,IAAIjC,GAAM,IAAM9zB,EAAG,IAAM3X,EAAG,IAAMI,EAElD,CAAO,GAAmB,QAAfhT,KAAK41C,MAAiB,CAG/B,IAAI,EACFj4B,EAAC,EACD5I,EAAC,EACDuV,GACEtqB,KAMJ,GALA2d,GAAK,IACL5I,GAAK,IACLuV,GAAK,IAGK,IAANvV,EAGF,OAFAuV,GAAK,IACS,IAAI+zB,GAAM/zB,EAAGA,EAAGA,GAKhC,MAAME,EAAIF,EAAI,GAAMA,GAAK,EAAIvV,GAAKuV,EAAIvV,EAAIuV,EAAIvV,EACxCiR,EAAI,EAAIsE,EAAIE,EAGZD,EAAI,IAAMsrB,EAAS7vB,EAAGwE,EAAG7M,EAAI,EAAI,GACjC/K,EAAI,IAAMijC,EAAS7vB,EAAGwE,EAAG7M,GACzB3K,EAAI,IAAM6iC,EAAS7vB,EAAGwE,EAAG7M,EAAI,EAAI,GAIvC,OADc,IAAI0gC,GAAM9zB,EAAG3X,EAAGI,EAEhC,CAAO,GAAmB,SAAfhT,KAAK41C,MAAkB,CAGhC,MAAM,EACJjxC,EAAC,EACDyY,EAAC,EACD5W,EAAC,EACD89B,GACEtkC,KAGEuqB,EAAI,KAAO,EAAI9d,KAAKC,IAAI,EAAG/H,GAAK,EAAI2/B,GAAKA,IACzC1xB,EAAI,KAAO,EAAInG,KAAKC,IAAI,EAAG0Q,GAAK,EAAIknB,GAAKA,IACzCtxB,EAAI,KAAO,EAAIvG,KAAKC,IAAI,EAAGlG,GAAK,EAAI89B,GAAKA,IAI/C,OADc,IAAI+Z,GAAM9zB,EAAG3X,EAAGI,EAEhC,CACE,OAAOhT,KAhYb,IAAkB41C,CAkYhB,CACA,OAAAvZ,GACE,MAAM,GACJsiB,EAAE,GACFC,EAAE,GACFC,EAAE,GACFI,EAAE,MACFrJ,GACE51C,KACJ,MAAO,CAAC2+C,EAAIC,EAAIC,EAAII,EAAIrJ,EAC1B,CACA,KAAA6K,GACE,MAAOl2B,EAAG3X,EAAGI,GAAKhT,KAAK0gD,WAAW/rC,IAAI4gC,GACtC,MAAO,IAAIhrB,IAAI3X,IAAII,GACrB,CACA,KAAA2tC,GACE,MAAOC,EAAIC,EAAIC,GAAM9gD,KAAK0gD,WAE1B,MADe,OAAOE,KAAMC,KAAMC,IAEpC,CACA,QAAA5tC,GACE,OAAOlT,KAAKygD,OACd,CACA,GAAAf,GAEE,MACEf,GAAIoC,EACJnC,GAAIoC,EACJnC,GAAIoC,GACFjhD,KAAKi9C,OACF1yB,EAAG3X,EAAGI,GAAK,CAAC+tC,EAAMC,EAAMC,GAAMtsC,IAAIlJ,GAAKA,EAAI,KAG5Cy1C,EAAK32B,EAAI,OAAU9d,KAAK8zC,KAAKh2B,EAAI,MAAS,MAAO,KAAOA,EAAI,MAC5D42B,EAAKvuC,EAAI,OAAUnG,KAAK8zC,KAAK3tC,EAAI,MAAS,MAAO,KAAOA,EAAI,MAC5DwuC,EAAKpuC,EAAI,OAAUvG,KAAK8zC,KAAKvtC,EAAI,MAAS,MAAO,KAAOA,EAAI,MAG5DquC,GAAW,MAALH,EAAmB,MAALC,EAAmB,MAALC,GAAe,OACjDE,GAAW,MAALJ,EAAmB,MAALC,EAAmB,MAALC,GAAe,EACjDG,GAAW,MAALL,EAAmB,MAALC,EAAmB,MAALC,GAAe,QAGjD96C,EAAI+6C,EAAK,QAAW50C,KAAK8zC,IAAIc,EAAI,EAAI,GAAK,MAAQA,EAAK,GAAK,IAC5D76C,EAAI86C,EAAK,QAAW70C,KAAK8zC,IAAIe,EAAI,EAAI,GAAK,MAAQA,EAAK,GAAK,IAC5D72B,EAAI82B,EAAK,QAAW90C,KAAK8zC,IAAIgB,EAAI,EAAI,GAAK,MAAQA,EAAK,GAAK,IAIlE,OADc,IAAIlD,GAAM/3C,EAAGE,EAAGikB,EAAG,MAEnC,CAMA,QAAAi2B,GACE,MAAM,GACJ/B,EAAE,GACFC,EAAE,GACFC,GACE7+C,KAAKi9C,OACH,IACJnwC,EAAG,IACHJ,EAAG,MACH+gC,GACEhhC,KAEJ,MAAO,CAACkyC,EAAIC,EAAIC,GAAIlqC,IADLlJ,GAAKqB,EAAI,EAAGJ,EAAI+gC,EAAMhiC,GAAI,MAE3C,EAOF,MAAM+1C,GAEJ,WAAApgD,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CAGA,KAAAk6B,GACE,OAAO,IAAIyV,GAAMxhD,KACnB,CACA,IAAAob,CAAK9U,EAAGE,GACN,MAMMiqC,EAASviC,MAAM4lB,QAAQxtB,GAAK,CAChCA,EAAGA,EAAE,GACLE,EAAGF,EAAE,IACU,iBAANA,EAAiB,CAC1BA,EAAGA,EAAEA,EACLE,EAAGF,EAAEE,GACH,CACFF,EAAGA,EACHE,EAAGA,GAML,OAFAxG,KAAKsG,EAAgB,MAAZmqC,EAAOnqC,EAjBX,EAiBgCmqC,EAAOnqC,EAC5CtG,KAAKwG,EAAgB,MAAZiqC,EAAOjqC,EAjBX,EAiBgCiqC,EAAOjqC,EACrCxG,IACT,CACA,OAAAq8B,GACE,MAAO,CAACr8B,KAAKsG,EAAGtG,KAAKwG,EACvB,CACA,SAAAkR,CAAU0F,GACR,OAAOpd,KAAK+rC,QAAQ0V,WAAWrkC,EACjC,CAGA,UAAAqkC,CAAWrkC,GACJiX,GAAOqtB,aAAatkC,KACvBA,EAAI,IAAIiX,GAAOjX,IAEjB,MAAM,EACJ9W,EAAC,EACDE,GACExG,KAKJ,OAFAA,KAAKsG,EAAI8W,EAAEiN,EAAI/jB,EAAI8W,EAAEzY,EAAI6B,EAAI4W,EAAEpZ,EAC/BhE,KAAKwG,EAAI4W,EAAEpK,EAAI1M,EAAI8W,EAAEswB,EAAIlnC,EAAI4W,EAAEo7B,EACxBx4C,IACT,EASF,MAAMq0B,GACJ,WAAAjzB,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CACA,uBAAO8vC,CAAiB/O,GAEtB,MAAMgP,EAAsB,SAAXhP,EAAEiP,MAA8B,GAAXjP,EAAEiP,KAClCC,EAAQlP,EAAEiP,OAASD,GAAuB,MAAXhP,EAAEiP,OAAiB,EAAI,EACtDE,EAAQnP,EAAEiP,OAASD,GAAuB,MAAXhP,EAAEiP,OAAiB,EAAI,EACtDntB,EAAQke,EAAEoP,MAAQpP,EAAEoP,KAAK3xC,OAASuiC,EAAEoP,KAAK,GAAKC,SAASrP,EAAEoP,MAAQpP,EAAEoP,KAAOC,SAASrP,EAAEle,OAASke,EAAEle,MAAQ,EACxGC,EAAQie,EAAEoP,MAAQpP,EAAEoP,KAAK3xC,OAASuiC,EAAEoP,KAAK,GAAKC,SAASrP,EAAEoP,MAAQpP,EAAEoP,KAAOC,SAASrP,EAAEje,OAASie,EAAEje,MAAQ,EACxGutB,EAAStP,EAAEpe,OAASoe,EAAEpe,MAAMnkB,OAASuiC,EAAEpe,MAAM,GAAKstB,EAAQG,SAASrP,EAAEpe,OAASoe,EAAEpe,MAAQstB,EAAQG,SAASrP,EAAEsP,QAAUtP,EAAEsP,OAASJ,EAAQA,EACxIK,EAASvP,EAAEpe,OAASoe,EAAEpe,MAAMnkB,OAASuiC,EAAEpe,MAAM,GAAKutB,EAAQE,SAASrP,EAAEpe,OAASoe,EAAEpe,MAAQutB,EAAQE,SAASrP,EAAEuP,QAAUvP,EAAEuP,OAASJ,EAAQA,EACxIK,EAAQxP,EAAEwP,OAAS,EACnBC,EAAQzP,EAAExe,QAAUwe,EAAEyP,OAAS,EAC/BxP,EAAS,IAAI2O,GAAM5O,EAAEC,QAAUD,EAAE0P,QAAU1P,EAAEE,IAAMF,EAAEG,QAASH,EAAEI,IAAMJ,EAAEK,SACxEH,EAAKD,EAAOvsC,EACZ0sC,EAAKH,EAAOrsC,EAEZT,EAAW,IAAIy7C,GAAM5O,EAAE7sC,UAAY6sC,EAAE2P,IAAM3P,EAAE4P,WAAaC,IAAK7P,EAAE8P,IAAM9P,EAAE+P,WAAaF,KACtFF,EAAKx8C,EAASO,EACdo8C,EAAK38C,EAASS,EACdiuB,EAAY,IAAI+sB,GAAM5O,EAAEne,WAAame,EAAE7W,IAAM6W,EAAEhyB,WAAYgyB,EAAE5W,IAAM4W,EAAE/xB,YACrEkb,EAAKtH,EAAUnuB,EACf01B,EAAKvH,EAAUjuB,EACfo8C,EAAW,IAAIpB,GAAM5O,EAAEgQ,UAAYhQ,EAAErmB,IAAMqmB,EAAEiQ,UAAWjQ,EAAEpmB,IAAMomB,EAAEkQ,WAKxE,MAAO,CACLZ,SACAC,SACAztB,QACAC,QACAytB,QACAC,QACA91B,GAXSq2B,EAASt8C,EAYlBkmB,GAXSo2B,EAASp8C,EAYlBu1B,KACAC,KACA8W,KACAE,KACAuP,KACAG,KAEJ,CACA,gBAAO3H,CAAU1wB,GACf,MAAO,CACLA,EAAGA,EAAE,GACLrX,EAAGqX,EAAE,GACL1lB,EAAG0lB,EAAE,GACLqjB,EAAGrjB,EAAE,GACLrmB,EAAGqmB,EAAE,GACLmuB,EAAGnuB,EAAE,GAET,CACA,mBAAOq3B,CAAa9O,GAClB,OAAc,MAAPA,EAAEvoB,GAAoB,MAAPuoB,EAAE5/B,GAAoB,MAAP4/B,EAAEjuC,GAAoB,MAAPiuC,EAAElF,GAAoB,MAAPkF,EAAE5uC,GAAoB,MAAP4uC,EAAE4F,CACtF,CAGA,qBAAOuK,CAAez4B,EAAGC,EAAGqoB,GAE1B,MAAMvoB,EAAIC,EAAED,EAAIE,EAAEF,EAAIC,EAAE3lB,EAAI4lB,EAAEvX,EACxBA,EAAIsX,EAAEtX,EAAIuX,EAAEF,EAAIC,EAAEojB,EAAInjB,EAAEvX,EACxBrO,EAAI2lB,EAAED,EAAIE,EAAE5lB,EAAI2lB,EAAE3lB,EAAI4lB,EAAEmjB,EACxBA,EAAIpjB,EAAEtX,EAAIuX,EAAE5lB,EAAI2lB,EAAEojB,EAAInjB,EAAEmjB,EACxB1pC,EAAIsmB,EAAEtmB,EAAIsmB,EAAED,EAAIE,EAAEvmB,EAAIsmB,EAAE3lB,EAAI4lB,EAAEiuB,EAC9BA,EAAIluB,EAAEkuB,EAAIluB,EAAEtX,EAAIuX,EAAEvmB,EAAIsmB,EAAEojB,EAAInjB,EAAEiuB,EASpC,OANA5F,EAAEvoB,EAAIA,EACNuoB,EAAE5/B,EAAIA,EACN4/B,EAAEjuC,EAAIA,EACNiuC,EAAElF,EAAIA,EACNkF,EAAE5uC,EAAIA,EACN4uC,EAAE4F,EAAIA,EACC5F,CACT,CACA,MAAA0P,CAAO37B,EAAIC,EAAI2N,GACb,OAAOv0B,KAAK+rC,QAAQiX,QAAQr8B,EAAIC,EAAI2N,EACtC,CAGA,OAAAyuB,CAAQr8B,EAAIC,EAAI2N,GACd,MAAM3B,EAAKjM,GAAM,EACXkM,EAAKjM,GAAM,EACjB,OAAO5mB,KAAKijD,YAAYrwB,GAAKC,GAAIqwB,WAAW3uB,GAAQ0uB,WAAWrwB,EAAIC,EACrE,CAGA,KAAAkZ,GACE,OAAO,IAAI1X,GAAOr0B,KACpB,CAGA,SAAAmjD,CAAUx8B,EAAK,EAAGC,EAAK,GAErB,MAAMyD,EAAIrqB,KAAKqqB,EACTrX,EAAIhT,KAAKgT,EACTrO,EAAI3E,KAAK2E,EACT+oC,EAAI1tC,KAAK0tC,EACT1pC,EAAIhE,KAAKgE,EACTw0C,EAAIx4C,KAAKw4C,EAGT4K,EAAc/4B,EAAIqjB,EAAI16B,EAAIrO,EAC1B0+C,EAAMD,EAAc,EAAI,GAAK,EAI7BnnB,EAAKonB,EAAM52C,KAAK2gB,KAAK/C,EAAIA,EAAIrX,EAAIA,GACjCswC,EAAW72C,KAAKmzC,MAAMyD,EAAMrwC,EAAGqwC,EAAMh5B,GACrCg4B,EAAQ,IAAM51C,KAAKmgB,GAAK02B,EACxBrD,EAAKxzC,KAAKogB,IAAIy2B,GACdC,EAAK92C,KAAKqgB,IAAIw2B,GAIdE,GAAOn5B,EAAI1lB,EAAIqO,EAAI06B,GAAK0V,EACxBlnB,EAAKv3B,EAAIs3B,GAAMunB,EAAMn5B,EAAIrX,IAAM06B,EAAIzR,GAAMunB,EAAMxwC,EAAIqX,GAOzD,MAAO,CAEL63B,OAAQjmB,EACRkmB,OAAQjmB,EACRkmB,MAAOoB,EACPpvB,OAAQiuB,EACRzhC,WAVS5c,EAAI2iB,EAAKA,EAAKs5B,EAAKhkB,EAAKrV,GAAM48B,EAAMvD,EAAKhkB,EAAKsnB,EAAKrnB,GAW5Drb,WAVS23B,EAAI5xB,EAAKD,EAAK48B,EAAKtnB,EAAKrV,GAAM48B,EAAMD,EAAKtnB,EAAKgkB,EAAK/jB,GAW5D6W,QAASpsB,EACTssB,QAASrsB,EAETyD,EAAGrqB,KAAKqqB,EACRrX,EAAGhT,KAAKgT,EACRrO,EAAG3E,KAAK2E,EACR+oC,EAAG1tC,KAAK0tC,EACR1pC,EAAGhE,KAAKgE,EACRw0C,EAAGx4C,KAAKw4C,EAEZ,CAGA,MAAAiL,CAAOjhB,GACL,GAAIA,IAAUxiC,KAAM,OAAO,EAC3B,MAAM0jD,EAAO,IAAIrvB,GAAOmO,GACxB,OAAOsT,EAAY91C,KAAKqqB,EAAGq5B,EAAKr5B,IAAMyrB,EAAY91C,KAAKgT,EAAG0wC,EAAK1wC,IAAM8iC,EAAY91C,KAAK2E,EAAG++C,EAAK/+C,IAAMmxC,EAAY91C,KAAK0tC,EAAGgW,EAAKhW,IAAMoI,EAAY91C,KAAKgE,EAAG0/C,EAAK1/C,IAAM8xC,EAAY91C,KAAKw4C,EAAGkL,EAAKlL,EAC7L,CAGA,IAAAqJ,CAAK8B,EAAMrB,GACT,OAAOtiD,KAAK+rC,QAAQ6X,MAAMD,EAAMrB,EAClC,CACA,KAAAsB,CAAMD,EAAMrB,GACV,MAAgB,MAATqB,EAAe3jD,KAAK6jD,QAAQ,EAAG,EAAGvB,EAAQ,GAAc,MAATqB,EAAe3jD,KAAK6jD,OAAO,GAAI,EAAG,EAAGvB,GAAUtiD,KAAK6jD,QAAQ,GAAI,EAAGF,EAAMrB,GAAUqB,EAC3I,CAGA,IAAAvoC,CAAKq1B,GACH,MAAM5yB,EAAOwW,GAAO0mB,UAAU,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,IAY9C,OATAtK,EAASA,aAAkBqT,GAAUrT,EAAOsT,YAAgC,iBAAXtT,EAAsBpc,GAAO0mB,UAAUtK,EAAO9c,MAAMsjB,IAAWtiC,IAAIlG,aAAeP,MAAM4lB,QAAQ2c,GAAUpc,GAAO0mB,UAAUtK,GAA4B,iBAAXA,GAAuBpc,GAAOqtB,aAAajR,GAAUA,EAA2B,iBAAXA,GAAsB,IAAIpc,IAAS3c,UAAU+4B,GAA+B,IAArB3pC,UAAUuJ,OAAegkB,GAAO0mB,UAAU,GAAG7tC,MAAM3M,KAAKuG,YAAc+W,EAG/Y7d,KAAKqqB,EAAgB,MAAZomB,EAAOpmB,EAAYomB,EAAOpmB,EAAIxM,EAAKwM,EAC5CrqB,KAAKgT,EAAgB,MAAZy9B,EAAOz9B,EAAYy9B,EAAOz9B,EAAI6K,EAAK7K,EAC5ChT,KAAK2E,EAAgB,MAAZ8rC,EAAO9rC,EAAY8rC,EAAO9rC,EAAIkZ,EAAKlZ,EAC5C3E,KAAK0tC,EAAgB,MAAZ+C,EAAO/C,EAAY+C,EAAO/C,EAAI7vB,EAAK6vB,EAC5C1tC,KAAKgE,EAAgB,MAAZysC,EAAOzsC,EAAYysC,EAAOzsC,EAAI6Z,EAAK7Z,EAC5ChE,KAAKw4C,EAAgB,MAAZ/H,EAAO+H,EAAY/H,EAAO+H,EAAI36B,EAAK26B,EACrCx4C,IACT,CACA,OAAAgkD,GACE,OAAOhkD,KAAK+rC,QAAQkY,UACtB,CAGA,QAAAA,GAEE,MAAM55B,EAAIrqB,KAAKqqB,EACTrX,EAAIhT,KAAKgT,EACTrO,EAAI3E,KAAK2E,EACT+oC,EAAI1tC,KAAK0tC,EACT1pC,EAAIhE,KAAKgE,EACTw0C,EAAIx4C,KAAKw4C,EAGT0L,EAAM75B,EAAIqjB,EAAI16B,EAAIrO,EACxB,IAAKu/C,EAAK,MAAM,IAAI9vC,MAAM,iBAAmBpU,MAG7C,MAAMmkD,EAAKzW,EAAIwW,EACTE,GAAMpxC,EAAIkxC,EACVG,GAAM1/C,EAAIu/C,EACVI,EAAKj6B,EAAI65B,EAGTK,IAAOJ,EAAKngD,EAAIqgD,EAAK7L,GACrBgM,IAAOJ,EAAKpgD,EAAIsgD,EAAK9L,GAS3B,OANAx4C,KAAKqqB,EAAI85B,EACTnkD,KAAKgT,EAAIoxC,EACTpkD,KAAK2E,EAAI0/C,EACTrkD,KAAK0tC,EAAI4W,EACTtkD,KAAKgE,EAAIugD,EACTvkD,KAAKw4C,EAAIgM,EACFxkD,IACT,CACA,SAAA27C,CAAUpnB,GACR,OAAOv0B,KAAK+rC,QAAQmX,WAAW3uB,EACjC,CACA,UAAA2uB,CAAW3uB,GACT,MACMjK,EAAIiK,aAAkBF,GAASE,EAAS,IAAIF,GAAOE,GACzD,OAAOF,GAAO0uB,eAAez4B,EAFnBtqB,KAEyBA,KACrC,CAGA,QAAAykD,CAASlwB,GACP,OAAOv0B,KAAK+rC,QAAQ2Y,UAAUnwB,EAChC,CACA,SAAAmwB,CAAUnwB,GAER,MACMhK,EAAIgK,aAAkBF,GAASE,EAAS,IAAIF,GAAOE,GACzD,OAAOF,GAAO0uB,eAFJ/iD,KAEsBuqB,EAAGvqB,KACrC,CAGA,MAAAo0B,CAAO7J,EAAG5D,EAAIC,GACZ,OAAO5mB,KAAK+rC,QAAQ4Y,QAAQp6B,EAAG5D,EAAIC,EACrC,CACA,OAAA+9B,CAAQp6B,EAAG5D,EAAK,EAAGC,EAAK,GAEtB2D,EAAI+nB,EAAQ/nB,GACZ,MAAMsC,EAAMpgB,KAAKogB,IAAItC,GACfuC,EAAMrgB,KAAKqgB,IAAIvC,IACf,EACJF,EAAC,EACDrX,EAAC,EACDrO,EAAC,EACD+oC,EAAC,EACD1pC,EAAC,EACDw0C,GACEx4C,KAOJ,OANAA,KAAKqqB,EAAIA,EAAIwC,EAAM7Z,EAAI8Z,EACvB9sB,KAAKgT,EAAIA,EAAI6Z,EAAMxC,EAAIyC,EACvB9sB,KAAK2E,EAAIA,EAAIkoB,EAAM6gB,EAAI5gB,EACvB9sB,KAAK0tC,EAAIA,EAAI7gB,EAAMloB,EAAImoB,EACvB9sB,KAAKgE,EAAIA,EAAI6oB,EAAM2rB,EAAI1rB,EAAMlG,EAAKkG,EAAMnG,EAAKkG,EAAMlG,EACnD3mB,KAAKw4C,EAAIA,EAAI3rB,EAAM7oB,EAAI8oB,EAAMnG,EAAKmG,EAAMlG,EAAKiG,EAAMjG,EAC5C5mB,IACT,CAGA,KAAAw0B,GACE,OAAOx0B,KAAK+rC,QAAQ8X,UAAU/8C,UAChC,CACA,MAAA+8C,CAAOv9C,EAAGE,EAAIF,EAAGqgB,EAAK,EAAGC,EAAK,GAEH,IAArB9f,UAAUuJ,SACZuW,EAAKD,EACLA,EAAKngB,EACLA,EAAIF,GAEN,MAAM,EACJ+jB,EAAC,EACDrX,EAAC,EACDrO,EAAC,EACD+oC,EAAC,EACD1pC,EAAC,EACDw0C,GACEx4C,KAOJ,OANAA,KAAKqqB,EAAIA,EAAI/jB,EACbtG,KAAKgT,EAAIA,EAAIxM,EACbxG,KAAK2E,EAAIA,EAAI2B,EACbtG,KAAK0tC,EAAIA,EAAIlnC,EACbxG,KAAKgE,EAAIA,EAAIsC,EAAIqgB,EAAKrgB,EAAIqgB,EAC1B3mB,KAAKw4C,EAAIA,EAAIhyC,EAAIogB,EAAKpgB,EAAIogB,EACnB5mB,IACT,CAGA,KAAAoiD,CAAM/3B,EAAG1D,EAAIC,GACX,OAAO5mB,KAAK+rC,QAAQ6Y,OAAOv6B,EAAG1D,EAAIC,EACpC,CAGA,MAAAg+B,CAAOC,EAAIl+B,EAAK,EAAGC,EAAK,GACtB,MAAM,EACJyD,EAAC,EACDrX,EAAC,EACDrO,EAAC,EACD+oC,EAAC,EACD1pC,EAAC,EACDw0C,GACEx4C,KAIJ,OAHAA,KAAKqqB,EAAIA,EAAIrX,EAAI6xC,EACjB7kD,KAAK2E,EAAIA,EAAI+oC,EAAImX,EACjB7kD,KAAKgE,EAAIA,EAAIw0C,EAAIqM,EAAKj+B,EAAKi+B,EACpB7kD,IACT,CAGA,IAAAgiD,GACE,OAAOhiD,KAAK+rC,QAAQ+Y,SAASh+C,UAC/B,CACA,KAAAg+C,CAAMx+C,EAAGE,EAAIF,EAAGqgB,EAAK,EAAGC,EAAK,GAEF,IAArB9f,UAAUuJ,SACZuW,EAAKD,EACLA,EAAKngB,EACLA,EAAIF,GAINA,EAAIgsC,EAAQhsC,GACZE,EAAI8rC,EAAQ9rC,GACZ,MAAMq+C,EAAKp4C,KAAK2vB,IAAI91B,GACdy+C,EAAKt4C,KAAK2vB,IAAI51B,IACd,EACJ6jB,EAAC,EACDrX,EAAC,EACDrO,EAAC,EACD+oC,EAAC,EACD1pC,EAAC,EACDw0C,GACEx4C,KAOJ,OANAA,KAAKqqB,EAAIA,EAAIrX,EAAI6xC,EACjB7kD,KAAKgT,EAAIA,EAAIqX,EAAI06B,EACjB/kD,KAAK2E,EAAIA,EAAI+oC,EAAImX,EACjB7kD,KAAK0tC,EAAIA,EAAI/oC,EAAIogD,EACjB/kD,KAAKgE,EAAIA,EAAIw0C,EAAIqM,EAAKj+B,EAAKi+B,EAC3B7kD,KAAKw4C,EAAIA,EAAIx0C,EAAI+gD,EAAKp+B,EAAKo+B,EACpB/kD,IACT,CAGA,KAAA00B,CAAMpuB,EAAGqgB,EAAIC,GACX,OAAO5mB,KAAKgiD,KAAK17C,EAAG,EAAGqgB,EAAIC,EAC7B,CAGA,KAAA+N,CAAMnuB,EAAGmgB,EAAIC,GACX,OAAO5mB,KAAKgiD,KAAK,EAAGx7C,EAAGmgB,EAAIC,EAC7B,CACA,OAAAyV,GACE,MAAO,CAACr8B,KAAKqqB,EAAGrqB,KAAKgT,EAAGhT,KAAK2E,EAAG3E,KAAK0tC,EAAG1tC,KAAKgE,EAAGhE,KAAKw4C,EACvD,CAGA,QAAAtlC,GACE,MAAO,UAAYlT,KAAKqqB,EAAI,IAAMrqB,KAAKgT,EAAI,IAAMhT,KAAK2E,EAAI,IAAM3E,KAAK0tC,EAAI,IAAM1tC,KAAKgE,EAAI,IAAMhE,KAAKw4C,EAAI,GACzG,CAGA,SAAA9gC,CAAUk7B,GAER,GAAIve,GAAOqtB,aAAa9O,GAEtB,OADe,IAAIve,GAAOue,GACZ8R,UAAU1kD,MAI1B,MAAMyT,EAAI4gB,GAAOstB,iBAAiB/O,IAGhCtsC,EAAGwsC,EACHtsC,EAAGwsC,GACD,IAAIwO,GAAM/tC,EAAEq/B,GAAIr/B,EAAEu/B,IAAIt7B,UAJV1X,MAOVglD,GAAc,IAAI3wB,IAAS4uB,WAAWxvC,EAAE8Y,GAAI9Y,EAAE+Y,IAAI02B,WAPxCljD,MAO4DijD,YAAYnQ,GAAKE,GAAI6Q,OAAOpwC,EAAEyuC,OAAQzuC,EAAE0uC,QAAQ2C,MAAMrxC,EAAEihB,MAAOjhB,EAAEkhB,OAAOiwB,OAAOnxC,EAAE2uC,OAAOuC,QAAQlxC,EAAE4uC,OAAOY,WAAWnQ,EAAIE,GAGpM,GAAIiP,SAASxuC,EAAE8uC,KAAON,SAASxuC,EAAEivC,IAAK,CACpC,MAAM7P,EAAS,IAAI2O,GAAM1O,EAAIE,GAAIt7B,UAAUstC,GAGrCpyB,EAAKqvB,SAASxuC,EAAE8uC,IAAM9uC,EAAE8uC,GAAK1P,EAAOvsC,EAAI,EACxCusB,EAAKovB,SAASxuC,EAAEivC,IAAMjvC,EAAEivC,GAAK7P,EAAOrsC,EAAI,EAC9Cw+C,EAAY/B,WAAWrwB,EAAIC,EAC7B,CAIA,OADAmyB,EAAY/B,WAAWxvC,EAAEsoB,GAAItoB,EAAEuoB,IACxBgpB,CACT,CAGA,SAAAvwB,CAAUnuB,EAAGE,GACX,OAAOxG,KAAK+rC,QAAQkX,WAAW38C,EAAGE,EACpC,CACA,UAAAy8C,CAAW38C,EAAGE,GAGZ,OAFAxG,KAAKgE,GAAKsC,GAAK,EACftG,KAAKw4C,GAAKhyC,GAAK,EACRxG,IACT,CACA,OAAAm8C,GACE,MAAO,CACL9xB,EAAGrqB,KAAKqqB,EACRrX,EAAGhT,KAAKgT,EACRrO,EAAG3E,KAAK2E,EACR+oC,EAAG1tC,KAAK0tC,EACR1pC,EAAGhE,KAAKgE,EACRw0C,EAAGx4C,KAAKw4C,EAEZ,EAuBF5wC,EAASysB,GAAQ,UAkCjB,MAAM4wB,GACJ,WAAA7jD,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CACA,SAAAqzC,GAIE,OAFAllD,KAAKsG,GAAKitC,GAAQ9V,OAAO0nB,YACzBnlD,KAAKwG,GAAK+sC,GAAQ9V,OAAO2nB,YAClB,IAAIH,GAAIjlD,KACjB,CACA,IAAAob,CAAKq1B,GAaH,OAXAA,EAA2B,iBAAXA,EAAsBA,EAAO9c,MAAMsjB,IAAWtiC,IAAIlG,YAAcP,MAAM4lB,QAAQ2c,GAAUA,EAA2B,iBAAXA,EAAsB,CAAgB,MAAfA,EAAOnrC,KAAemrC,EAAOnrC,KAAOmrC,EAAOnqC,EAAiB,MAAdmqC,EAAOjrC,IAAcirC,EAAOjrC,IAAMirC,EAAOjqC,EAAGiqC,EAAO5kC,MAAO4kC,EAAO3kC,QAA+B,IAArBhF,UAAUuJ,OAAe,GAAGnD,MAAM3M,KAAKuG,WADlS,CAAC,EAAG,EAAG,EAAG,GAEvB9G,KAAKsG,EAAImqC,EAAO,IAAM,EACtBzwC,KAAKwG,EAAIiqC,EAAO,IAAM,EACtBzwC,KAAK6L,MAAQ7L,KAAK0d,EAAI+yB,EAAO,IAAM,EACnCzwC,KAAK8L,OAAS9L,KAAK2d,EAAI8yB,EAAO,IAAM,EAGpCzwC,KAAKkqC,GAAKlqC,KAAKsG,EAAItG,KAAK0d,EACxB1d,KAAKmqC,GAAKnqC,KAAKwG,EAAIxG,KAAK2d,EACxB3d,KAAK2mB,GAAK3mB,KAAKsG,EAAItG,KAAK0d,EAAI,EAC5B1d,KAAK4mB,GAAK5mB,KAAKwG,EAAIxG,KAAK2d,EAAI,EACrB3d,IACT,CACA,QAAAqlD,GACE,OAAOnP,EAAYl2C,KACrB,CAGA,KAAA47C,CAAM17B,GACJ,MAAM5Z,EAAImG,KAAKC,IAAI1M,KAAKsG,EAAG4Z,EAAI5Z,GACzBE,EAAIiG,KAAKC,IAAI1M,KAAKwG,EAAG0Z,EAAI1Z,GACzBqF,EAAQY,KAAKK,IAAI9M,KAAKsG,EAAItG,KAAK6L,MAAOqU,EAAI5Z,EAAI4Z,EAAIrU,OAASvF,EAC3DwF,EAASW,KAAKK,IAAI9M,KAAKwG,EAAIxG,KAAK8L,OAAQoU,EAAI1Z,EAAI0Z,EAAIpU,QAAUtF,EACpE,OAAO,IAAIy+C,GAAI3+C,EAAGE,EAAGqF,EAAOC,EAC9B,CACA,OAAAuwB,GACE,MAAO,CAACr8B,KAAKsG,EAAGtG,KAAKwG,EAAGxG,KAAK6L,MAAO7L,KAAK8L,OAC3C,CACA,QAAAoH,GACE,OAAOlT,KAAKsG,EAAI,IAAMtG,KAAKwG,EAAI,IAAMxG,KAAK6L,MAAQ,IAAM7L,KAAK8L,MAC/D,CACA,SAAA4L,CAAU0F,GACFA,aAAaiX,KACjBjX,EAAI,IAAIiX,GAAOjX,IAEjB,IAAIkoC,EAAOC,IACPC,GAAO,IACPC,EAAOF,IACPG,GAAO,IASX,MARY,CAAC,IAAIlE,GAAMxhD,KAAKsG,EAAGtG,KAAKwG,GAAI,IAAIg7C,GAAMxhD,KAAKkqC,GAAIlqC,KAAKwG,GAAI,IAAIg7C,GAAMxhD,KAAKsG,EAAGtG,KAAKmqC,IAAK,IAAIqX,GAAMxhD,KAAKkqC,GAAIlqC,KAAKmqC,KACpHhnC,QAAQ,SAAU6iB,GACpBA,EAAIA,EAAEtO,UAAU0F,GAChBkoC,EAAO74C,KAAKC,IAAI44C,EAAMt/B,EAAE1f,GACxBk/C,EAAO/4C,KAAKK,IAAI04C,EAAMx/B,EAAE1f,GACxBm/C,EAAOh5C,KAAKC,IAAI+4C,EAAMz/B,EAAExf,GACxBk/C,EAAOj5C,KAAKK,IAAI44C,EAAM1/B,EAAExf,EAC1B,GACO,IAAIy+C,GAAIK,EAAMG,EAAMD,EAAOF,EAAMI,EAAOD,EACjD,EAiEF9T,EAAgB,CACdgU,QAAS,CACP,OAAAA,CAAQr/C,EAAGE,EAAGqF,EAAOC,GAEnB,OAAS,MAALxF,EAAkB,IAAI2+C,GAAIjlD,KAAKiO,KAAK,YAGjCjO,KAAKiO,KAAK,UAAW,IAAIg3C,GAAI3+C,EAAGE,EAAGqF,EAAOC,GACnD,EACA,IAAAyE,CAAKq1C,EAAOC,GAQV,IAAI,MACFh6C,EAAK,OACLC,GACE9L,KAAKiO,KAAK,CAAC,QAAS,WAUxB,IANKpC,GAAUC,IAA2B,iBAAVD,GAAwC,iBAAXC,IAC3DD,EAAQ7L,KAAKoD,KAAK0iD,YAClBh6C,EAAS9L,KAAKoD,KAAK2iD,eAIhBl6C,IAAUC,EACb,MAAM,IAAIsI,MAAM,6HAElB,MAAM3I,EAAIzL,KAAK2lD,UACTK,EAAQn6C,EAAQJ,EAAEI,MAClBo6C,EAAQn6C,EAASL,EAAEK,OACnByE,EAAO9D,KAAKC,IAAIs5C,EAAOC,GAC7B,GAAa,MAATL,EACF,OAAOr1C,EAET,IAAI21C,EAAa31C,EAAOq1C,EAIpBM,IAAeX,MAAUW,EAAavyC,OAAOwyC,iBAAmB,KACpEN,EAAQA,GAAS,IAAIrE,GAAM31C,EAAQ,EAAIm6C,EAAQv6C,EAAEnF,EAAGwF,EAAS,EAAIm6C,EAAQx6C,EAAEjF,GAC3E,MAAM0Z,EAAM,IAAI+kC,GAAIx5C,GAAGiM,UAAU,IAAI2c,GAAO,CAC1CG,MAAO0xB,EACPrT,OAAQgT,KAEV,OAAO7lD,KAAK2lD,QAAQzlC,EACtB,KAGJtY,EAASq9C,GAAK,OAId,MAAMzO,WAAatoC,MACjB,WAAA9M,CAAY45C,EAAM,MAAOnpC,GAEvB,GADA+b,MAAMotB,KAAQnpC,GACK,iBAARmpC,EAAkB,OAAOh7C,KACpCA,KAAKqQ,OAAS,EACdrQ,KAAKkC,QAAQ84C,EACf,EAEF9F,EAAO,CAACsB,IAAO,CACb,IAAA4P,CAAKC,KAAmBx0C,GACtB,MAA8B,mBAAnBw0C,EACFrmD,KAAK2U,IAAI,CAACzQ,EAAI0M,EAAGoqC,IACfqL,EAAe9lD,KAAK2D,EAAIA,EAAI0M,EAAGoqC,IAGjCh7C,KAAK2U,IAAIzQ,GACPA,EAAGmiD,MAAmBx0C,GAGnC,EACA,OAAAwqB,GACE,OAAOnuB,MAAMvN,UAAUkpB,OAAOyrB,MAAM,GAAIt1C,KAC1C,IAEF,MAAMsmD,GAAW,CAAC,UAAW,cAAe,QAC5C9P,GAAKtB,OAAS,SAAUE,GACtBA,EAAUA,EAAQsG,OAAO,CAACl7C,EAAKC,KAEzB6lD,GAAS5+B,SAASjnB,IAGN,MAAZA,EAAK,KAGLA,KAAQyN,MAAMvN,YAChBH,EAAI,IAAMC,GAAQyN,MAAMvN,UAAUF,IAIpCD,EAAIC,GAAQ,YAAa8lD,GACvB,OAAOvmD,KAAKomD,KAAK3lD,KAAS8lD,EAC5B,GAboC/lD,GAenC,CAAC,GACJ00C,EAAO,CAACsB,IAAOpB,EACjB,EAgBA,IAAI+B,GAAa,EACjB,MAAMP,GAAe,CAAC,EA4HtB,MAAM4P,WAAoBvS,GACxB,gBAAAlwC,GAAoB,CACpB,QAAAszC,CAASxS,EAAO3uB,EAAM0U,GACpB,OAAOysB,EAASr3C,KAAM6kC,EAAO3uB,EAAM0U,EACrC,CACA,aAAA8sB,CAAc7S,GACZ,MAAMmS,EAAMh3C,KAAK22C,iBAAiBxuC,OAClC,IAAK6uC,EAAK,OAAO,EACjB,MAAM7uC,EAAS6uC,EAAInS,EAAMvhC,MACzB,IAAK,MAAMsN,KAAKzI,EACd,IAAK,MAAM6lC,KAAK7lC,EAAOyI,GACrBzI,EAAOyI,GAAGo9B,GAAGnJ,GAGjB,OAAQA,EAAM4hB,gBAChB,CAGA,IAAAC,CAAK7hB,EAAO3uB,EAAM0U,GAEhB,OADA5qB,KAAKq3C,SAASxS,EAAO3uB,EAAM0U,GACpB5qB,IACT,CACA,cAAA22C,GACE,OAAO32C,IACT,CACA,cAAA62C,GACE,OAAO72C,IACT,CAGA,GAAAiS,CAAI4yB,EAAOpU,EAAU7F,GAEnB,OADA3Y,EAAIjS,KAAM6kC,EAAOpU,EAAU7F,GACpB5qB,IACT,CAGA,EAAAgS,CAAG6yB,EAAOpU,EAAUsmB,EAASnsB,GAE3B,OADA5Y,EAAGhS,KAAM6kC,EAAOpU,EAAUsmB,EAASnsB,GAC5B5qB,IACT,CACA,mBAAA2F,GAAuB,EAEzBiC,EAAS4+C,GAAa,eAKtB,MAAMG,GAAW,CACfjO,SAAU,IACVkO,KAAM,IACNC,MAAO,GAIHN,GAAQ,CAEZ,eAAgB,EAChB,iBAAkB,EAClB,eAAgB,EAChB,kBAAmB,QACnB,iBAAkB,OAClBvjD,KAAM,UACNwV,OAAQ,UACR2D,QAAS,EAET7V,EAAG,EACHE,EAAG,EACHmgB,GAAI,EACJC,GAAI,EAEJ/a,MAAO,EACPC,OAAQ,EAERye,EAAG,EACHgC,GAAI,EACJC,GAAI,EAEJ4a,OAAQ,EACR,eAAgB,EAChB,aAAc,UAEd,cAAe,SAGjB,IAAI6U,GAAW,CACbK,UAAW,KACXiK,MAAOA,GACP5O,KAAMA,EACNgP,SAAUA,IAGZ,MAAMG,WAAiB54C,MACrB,WAAA9M,IAAeyQ,GACb+b,SAAS/b,GACT7R,KAAKob,QAAQvJ,EACf,CACA,KAAAk6B,GACE,OAAO,IAAI/rC,KAAKoB,YAAYpB,KAC9B,CACA,IAAAob,CAAK4/B,GAEH,MAAmB,iBAARA,IACXh7C,KAAKqQ,OAAS,EACdrQ,KAAKkC,QAAQlC,KAAKwxC,MAAMwJ,KAFYh7C,IAItC,CAGA,KAAAwxC,CAAMW,EAAQ,IAEZ,OAAIA,aAAiBjkC,MAAcikC,EAC5BA,EAAMte,OAAOF,MAAMsjB,IAAWtiC,IAAIlG,WAC3C,CACA,OAAA4tB,GACE,OAAOnuB,MAAMvN,UAAUkpB,OAAOyrB,MAAM,GAAIt1C,KAC1C,CACA,KAAA+mD,GACE,OAAO,IAAI1lD,IAAIrB,KACjB,CACA,QAAAkT,GACE,OAAOlT,KAAK4U,KAAK,IACnB,CAGA,OAAAunC,GACE,MAAMyB,EAAM,GAEZ,OADAA,EAAI17C,QAAQlC,MACL49C,CACT,EAIF,MAAM3F,GAEJ,WAAA72C,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CACA,OAAAm1C,CAAQC,GACN,OAAO,IAAIhP,GAAUj4C,KAAKuV,MAAO0xC,EACnC,CAGA,MAAA/O,CAAO6B,GAEL,OADAA,EAAS,IAAI9B,GAAU8B,GAChB,IAAI9B,GAAUj4C,KAAO+5C,EAAQ/5C,KAAKinD,MAAQlN,EAAOkN,KAC1D,CACA,IAAA7rC,CAAK7F,EAAO0xC,GAkCV,OAjCAA,EAAO/4C,MAAM4lB,QAAQve,GAASA,EAAM,GAAK0xC,EACzC1xC,EAAQrH,MAAM4lB,QAAQve,GAASA,EAAM,GAAKA,EAG1CvV,KAAKuV,MAAQ,EACbvV,KAAKinD,KAAOA,GAAQ,GAGC,iBAAV1xC,EAETvV,KAAKuV,MAAQ2xC,MAAM3xC,GAAS,EAAK0sC,SAAS1sC,GAAyCA,EAAhCA,EAAQ,GAAK,MAAS,MAC/C,iBAAVA,GAChB0xC,EAAO1xC,EAAMuQ,MAAMk3B,OAGjBh9C,KAAKuV,MAAQ9G,WAAWw4C,EAAK,IAGb,MAAZA,EAAK,GACPjnD,KAAKuV,OAAS,IACO,MAAZ0xC,EAAK,KACdjnD,KAAKuV,OAAS,KAIhBvV,KAAKinD,KAAOA,EAAK,IAGf1xC,aAAiB0iC,KACnBj4C,KAAKuV,MAAQA,EAAM4mC,UACnBn8C,KAAKinD,KAAO1xC,EAAM0xC,MAGfjnD,IACT,CAGA,KAAAmnD,CAAMpN,GAEJ,OADAA,EAAS,IAAI9B,GAAU8B,GAChB,IAAI9B,GAAUj4C,KAAO+5C,EAAQ/5C,KAAKinD,MAAQlN,EAAOkN,KAC1D,CAGA,IAAAG,CAAKrN,GAEH,OADAA,EAAS,IAAI9B,GAAU8B,GAChB,IAAI9B,GAAUj4C,KAAO+5C,EAAQ/5C,KAAKinD,MAAQlN,EAAOkN,KAC1D,CAGA,KAAAI,CAAMtN,GAEJ,OADAA,EAAS,IAAI9B,GAAU8B,GAChB,IAAI9B,GAAUj4C,KAAO+5C,EAAQ/5C,KAAKinD,MAAQlN,EAAOkN,KAC1D,CACA,OAAA5qB,GACE,MAAO,CAACr8B,KAAKuV,MAAOvV,KAAKinD,KAC3B,CACA,MAAAhX,GACE,OAAOjwC,KAAKkT,UACd,CACA,QAAAA,GACE,OAAsB,MAAdlT,KAAKinD,QAA+B,IAAbjnD,KAAKuV,OAAe,IAAoB,MAAdvV,KAAKinD,KAAejnD,KAAKuV,MAAQ,IAAMvV,KAAKuV,OAASvV,KAAKinD,IACrH,CACA,OAAA9K,GACE,OAAOn8C,KAAKuV,KACd,EAGF,MAAM+xC,GAAkB,IAAIjmD,IAAI,CAAC,OAAQ,SAAU,QAAS,UAAW,aAAc,cAAe,mBAC9FkmD,GAAQ,GAoEd,MAAMC,WAAYhB,GAChB,WAAAplD,CAAYgC,EAAMmjD,GAChB34B,QACA5tB,KAAKoD,KAAOA,EACZpD,KAAKsD,KAAOF,EAAKuxC,SACb4R,GAASnjD,IAASmjD,GACpBvmD,KAAKiO,KAAKs4C,EAEd,CAGA,GAAA9kD,CAAI4K,EAASuE,GAYX,OAXAvE,EAAU0nC,EAAa1nC,IAGXo7C,iBAAmBznD,KAAKoD,gBAAgBmwC,GAAQ9V,OAAOiqB,YACjEr7C,EAAQo7C,kBAED,MAAL72C,EACF5Q,KAAKoD,KAAKN,YAAYuJ,EAAQjJ,MACrBiJ,EAAQjJ,OAASpD,KAAKoD,KAAKgL,WAAWwC,IAC/C5Q,KAAKoD,KAAK+L,aAAa9C,EAAQjJ,KAAMpD,KAAKoD,KAAKgL,WAAWwC,IAErD5Q,IACT,CAGA,KAAA6uB,CAAM5f,EAAQ2B,GACZ,OAAOmjC,EAAa9kC,GAAQ04C,IAAI3nD,KAAM4Q,EACxC,CAGA,QAAAuW,GACE,OAAO,IAAIqvB,GAAK7hC,EAAI3U,KAAKoD,KAAK+jB,SAAU,SAAU/jB,GAChD,OAAOqxC,EAAMrxC,EACf,GACF,CAGA,KAAAF,GAEE,KAAOlD,KAAKoD,KAAKwkD,iBACf5nD,KAAKoD,KAAKgxC,YAAYp0C,KAAKoD,KAAKykD,WAElC,OAAO7nD,IACT,CAGA,KAAA+rC,CAAMlT,EAAO,EAAMivB,EAAe,GAEhC9nD,KAAKg8C,iBAGL,IAAI+L,EAAY/nD,KAAKoD,KAAK6tB,UAAU4H,GAKpC,OAJIivB,IAEFC,EAAY9S,EAAY8S,IAEnB,IAAI/nD,KAAKoB,YAAY2mD,EAC9B,CAGA,IAAA3B,CAAKhU,EAAOvZ,GACV,MAAM1R,EAAWnnB,KAAKmnB,WACtB,IAAIvW,EAAGyhC,EACP,IAAKzhC,EAAI,EAAGyhC,EAAKlrB,EAAS9W,OAAQO,EAAIyhC,EAAIzhC,IACxCwhC,EAAMkD,MAAMnuB,EAASvW,GAAI,CAACA,EAAGuW,IACzB0R,GACF1R,EAASvW,GAAGw1C,KAAKhU,EAAOvZ,GAG5B,OAAO74B,IACT,CACA,OAAAqM,CAAQsoC,EAAU4R,GAChB,OAAOvmD,KAAK2nD,IAAI,IAAIH,GAAI5T,EAAOe,GAAW4R,GAC5C,CAGA,KAAAyB,GACE,OAAOvT,EAAMz0C,KAAKoD,KAAK+wC,WACzB,CAGA,GAAAlyC,CAAI2O,GACF,OAAO6jC,EAAMz0C,KAAKoD,KAAKgL,WAAWwC,GACpC,CACA,cAAA+lC,GACE,OAAO32C,KAAKoD,IACd,CACA,cAAAyzC,GACE,OAAO72C,KAAKoD,IACd,CAGA,GAAA5B,CAAI6K,GACF,OAAOrM,KAAK2oB,MAAMtc,IAAY,CAChC,CACA,IAAA4e,CAAKg9B,EAAUC,GACb,OAAOloD,KAAKmoD,IAAIF,EAAUC,EAAWj9B,GACvC,CAGA,EAAAhkB,CAAGA,GAOD,YALkB,IAAPA,GAAuBjH,KAAKoD,KAAK6D,KAC1CjH,KAAKoD,KAAK6D,GAAK8tC,EAAI/0C,KAAKsD,OAInBtD,KAAKiO,KAAK,KAAMhH,EACzB,CAGA,KAAA0hB,CAAMtc,GACJ,MAAO,GAAGa,MAAM3M,KAAKP,KAAKoD,KAAKgL,YAAYka,QAAQjc,EAAQjJ,KAC7D,CAGA,IAAAglD,GACE,OAAO3T,EAAMz0C,KAAKoD,KAAKykD,UACzB,CAGA,OAAAQ,CAAQC,GACN,MAAMpkD,EAAKlE,KAAKoD,KACVmlD,EAAUrkD,EAAGmkD,SAAWnkD,EAAGskD,iBAAmBtkD,EAAGukD,mBAAqBvkD,EAAGwkD,oBAAsBxkD,EAAGykD,uBAAyBzkD,EAAG0kD,kBAAoB,KACxJ,OAAOL,GAAWA,EAAQhoD,KAAK2D,EAAIokD,EACrC,CAGA,MAAAr5C,CAAO3L,GACL,IAAI2L,EAASjP,KAGb,IAAKiP,EAAO7L,KAAK8L,WAAY,OAAO,KAIpC,GADAD,EAASwlC,EAAMxlC,EAAO7L,KAAK8L,aACtB5L,EAAM,OAAO2L,EAGlB,GACE,GAAoB,iBAAT3L,EAAoB2L,EAAOo5C,QAAQ/kD,GAAQ2L,aAAkB3L,EAAM,OAAO2L,QAC9EA,EAASwlC,EAAMxlC,EAAO7L,KAAK8L,aACpC,OAAOD,CACT,CAGA,GAAA04C,CAAIt7C,EAASuE,GAGX,OAFAvE,EAAU0nC,EAAa1nC,GACvBrM,KAAKyB,IAAI4K,EAASuE,GACXvE,CACT,CAGA,KAAAw8C,CAAM55C,EAAQ2B,GACZ,OAAOmjC,EAAa9kC,GAAQxN,IAAIzB,KAAM4Q,EACxC,CAGA,MAAA/K,GAIE,OAHI7F,KAAKiP,UACPjP,KAAKiP,SAAS65C,cAAc9oD,MAEvBA,IACT,CAGA,aAAA8oD,CAAcz8C,GAEZ,OADArM,KAAKoD,KAAKgxC,YAAY/nC,EAAQjJ,MACvBpD,IACT,CAGA,OAAAgO,CAAQ3B,GAKN,OAJAA,EAAU0nC,EAAa1nC,GACnBrM,KAAKoD,KAAK8L,YACZlP,KAAKoD,KAAK8L,WAAW65C,aAAa18C,EAAQjJ,KAAMpD,KAAKoD,MAEhDiJ,CACT,CACA,KAAAohC,CAAMub,EAAY,EAAGr0C,EAAM,MACzB,MAAMs0C,EAAS,IAAMD,EACfzC,EAAQvmD,KAAKiO,KAAK0G,GACxB,IAAK,MAAM/D,KAAK21C,EACU,iBAAbA,EAAM31C,KACf21C,EAAM31C,GAAKnE,KAAKghC,MAAM8Y,EAAM31C,GAAKq4C,GAAUA,GAI/C,OADAjpD,KAAKiO,KAAKs4C,GACHvmD,IACT,CAGA,GAAAkG,CAAIgjD,EAASC,GACX,OAAOnpD,KAAKmoD,IAAIe,EAASC,EAAUjjD,GACrC,CAGA,QAAAgN,GACE,OAAOlT,KAAKiH,IACd,CACA,KAAAmiD,CAAMh8C,GAGJ,OADApN,KAAKoD,KAAKM,YAAc0J,EACjBpN,IACT,CACA,IAAAqpD,CAAKjmD,GACH,MAAM6L,EAASjP,KAAKiP,SACpB,IAAKA,EACH,OAAOjP,KAAK6uB,MAAMzrB,GAEpB,MAAM2C,EAAWkJ,EAAO0Z,MAAM3oB,MAC9B,OAAOiP,EAAO04C,IAAIvkD,EAAM2C,GAAU4hD,IAAI3nD,KACxC,CAGA,cAAAg8C,GAKE,OAHAh8C,KAAKomD,KAAK,WACRpmD,KAAKg8C,gBACP,GACOh8C,IACT,CAGA,GAAAmoD,CAAImB,EAASC,EAAU1V,GAQrB,GAPuB,kBAAZyV,IACTzV,EAAK0V,EACLA,EAAWD,EACXA,EAAU,MAIG,MAAXA,GAAsC,mBAAZA,EAAwB,CAEpDC,EAAuB,MAAZA,EAAmB,EAAOA,EAGrCvpD,KAAKg8C,iBACL,IAAIlwB,EAAU9rB,KAGd,GAAe,MAAXspD,EAAiB,CAInB,GAHAx9B,EAAU2oB,EAAM3oB,EAAQ1oB,KAAK6tB,UAAU,IAGnCs4B,EAAU,CACZ,MAAM3gC,EAAS0gC,EAAQx9B,GAIvB,GAHAA,EAAUlD,GAAUkD,EAGL,GAAXlD,EAAkB,MAAO,EAC/B,CAGAkD,EAAQs6B,KAAK,WACX,MAAMx9B,EAAS0gC,EAAQtpD,MACjBwpD,EAAQ5gC,GAAU5oB,KAGT,GAAX4oB,EACF5oB,KAAK6F,SAGI+iB,GAAU5oB,OAASwpD,GAC5BxpD,KAAKgO,QAAQw7C,EAEjB,EAAG,EACL,CAGA,OAAOD,EAAWz9B,EAAQ1oB,KAAK8kD,UAAYp8B,EAAQ1oB,KAAKgE,SAC1D,CAKAmiD,EAAuB,MAAZA,EAAmB,EAAQA,EAGtC,MAAME,EAAO7V,EAAO,UAAWC,GACzB6V,EAAWnW,GAAQ9wC,SAASknD,yBAGlCF,EAAKriD,UAAYkiD,EAGjB,IAAK,IAAIl3C,EAAMq3C,EAAKtiC,SAAS9W,OAAQ+B,KACnCs3C,EAAS5mD,YAAY2mD,EAAKG,mBAE5B,MAAM36C,EAASjP,KAAKiP,SAGpB,OAAOs6C,EAAWvpD,KAAKgO,QAAQ07C,IAAaz6C,EAASjP,KAAKyB,IAAIioD,EAChE,EAEFxU,EAAOsS,GAAK,CACVv5C,KAxWF,SAAcA,EAAMoqB,EAAKwb,GAEvB,GAAY,MAAR5lC,EAAc,CAEhBA,EAAO,CAAC,EACRoqB,EAAMr4B,KAAKoD,KAAK46C,WAChB,IAAK,MAAM56C,KAAQi1B,EACjBpqB,EAAK7K,EAAKuxC,UAAY6I,GAAS9D,KAAKt2C,EAAKymD,WAAap7C,WAAWrL,EAAKymD,WAAazmD,EAAKymD,UAE1F,OAAO57C,CACT,CAAO,GAAIA,aAAgBC,MAEzB,OAAOD,EAAKytC,OAAO,CAAC0M,EAAM0B,KACxB1B,EAAK0B,GAAQ9pD,KAAKiO,KAAK67C,GAChB1B,GACN,CAAC,GACC,GAAoB,iBAATn6C,GAAqBA,EAAK7M,cAAgBV,OAE1D,IAAK23B,KAAOpqB,EAAMjO,KAAKiO,KAAKoqB,EAAKpqB,EAAKoqB,SACjC,GAAY,OAARA,EAETr4B,KAAKoD,KAAKg5C,gBAAgBnuC,OACrB,IAAW,MAAPoqB,EAGT,OAAc,OADdA,EAAMr4B,KAAKoD,KAAKkuC,aAAarjC,IACRs4C,GAAMt4C,GAAQuvC,GAAS9D,KAAKrhB,GAAO5pB,WAAW4pB,GAAOA,EAQvD,iBALnBA,EAAMkvB,GAAM7L,OAAO,CAACqO,EAAMC,IACjBA,EAAK/7C,EAAM87C,EAAM/pD,MACvBq4B,IAIDA,EAAM,IAAI4f,GAAU5f,GACXivB,GAAgB9lD,IAAIyM,IAASowC,GAAME,QAAQlmB,GAEpDA,EAAM,IAAIgmB,GAAMhmB,GACPA,EAAIj3B,cAAgB8M,QAE7BmqB,EAAM,IAAIyuB,GAASzuB,IAIR,YAATpqB,EAEEjO,KAAKwO,SACPxO,KAAKwO,QAAQ6pB,GAID,iBAAPwb,EAAkB7zC,KAAKoD,KAAK6mD,eAAepW,EAAI5lC,EAAMoqB,EAAInlB,YAAclT,KAAKoD,KAAKmL,aAAaN,EAAMoqB,EAAInlB,aAI7GlT,KAAKkqD,SAAqB,cAATj8C,GAAiC,MAATA,GAC3CjO,KAAKkqD,SAET,CACA,OAAOlqD,IACT,EA6SE+Z,KA1sBF,SAAcw8B,GACZ,OAAOD,EAASC,EAAOv2C,KAAKoD,KAC9B,EAysBE23B,QAxsBF,SAAiBwb,GACf,OAAO9B,EAAMz0C,KAAKoD,KAAKs8B,cAAc6W,GACvC,IAwsBA3uC,EAAS4/C,GAAK,OAEd,MAAM1D,WAAgB0D,GACpB,WAAApmD,CAAYgC,EAAMmjD,GAChB34B,MAAMxqB,EAAMmjD,GAGZvmD,KAAKmqD,IAAM,CAAC,EAGZnqD,KAAKoD,KAAKsxC,SAAW10C,MACjBoD,EAAKiuC,aAAa,eAAiBjuC,EAAKiuC,aAAa,gBAEvDrxC,KAAKoqD,QAAQrzC,KAAKy6B,MAAMpuC,EAAKkuC,aAAa,gBAAkBv6B,KAAKy6B,MAAMpuC,EAAKkuC,aAAa,gBAAkB,CAAC,EAEhH,CAGA,MAAAtZ,CAAO1xB,EAAGE,GACR,OAAOxG,KAAK2mB,GAAGrgB,GAAGsgB,GAAGpgB,EACvB,CAGA,EAAAmgB,CAAGrgB,GACD,OAAY,MAALA,EAAYtG,KAAKsG,IAAMtG,KAAK6L,QAAU,EAAI7L,KAAKsG,EAAEA,EAAItG,KAAK6L,QAAU,EAC7E,CAGA,EAAA+a,CAAGpgB,GACD,OAAY,MAALA,EAAYxG,KAAKwG,IAAMxG,KAAK8L,SAAW,EAAI9L,KAAKwG,EAAEA,EAAIxG,KAAK8L,SAAW,EAC/E,CAGA,IAAAgvB,GACE,MAAMp7B,EAAOM,KAAKN,OAClB,OAAOA,GAAQA,EAAKo7B,MACtB,CAGA,KAAAuvB,CAAM/jD,EAAGE,GACP,OAAOxG,KAAK4yB,GAAGtsB,GAAGusB,GAAGrsB,EACvB,CAGA,EAAAosB,CAAGtsB,EAAI,GACL,OAAOtG,KAAKsG,EAAE,IAAI2xC,GAAU3xC,GAAG8gD,KAAKpnD,KAAKsG,KAC3C,CAGA,EAAAusB,CAAGrsB,EAAI,GACL,OAAOxG,KAAKwG,EAAE,IAAIyxC,GAAUzxC,GAAG4gD,KAAKpnD,KAAKwG,KAC3C,CACA,cAAAmwC,GACE,OAAO32C,IACT,CAGA,MAAA8L,CAAOA,GACL,OAAO9L,KAAKiO,KAAK,SAAUnC,EAC7B,CAGA,IAAAsD,CAAK9I,EAAGE,GACN,OAAOxG,KAAKsG,EAAEA,GAAGE,EAAEA,EACrB,CAGA,OAAA8jD,CAAQC,EAAQvqD,KAAKN,QACnB,MAAM8qD,EAA8B,iBAAVD,EACrBC,IACHD,EAAQxW,EAAawW,IAEvB,MAAMD,EAAU,IAAI9T,GACpB,IAAIvnC,EAASjP,KACb,MAAQiP,EAASA,EAAOA,WAAaA,EAAO7L,OAASmwC,GAAQ9wC,UAAgC,uBAApBwM,EAAO0lC,WAC9E2V,EAAQpoD,KAAK+M,GACRu7C,GAAcv7C,EAAO7L,OAASmnD,EAAMnnD,SAGrConD,IAAcv7C,EAAOo5C,QAAQkC,KAGjC,GAAIt7C,EAAO7L,OAASpD,KAAKN,OAAO0D,KAE9B,OAAO,KAGX,OAAOknD,CACT,CAGA,SAAApN,CAAUjvC,GAER,KADAA,EAAOjO,KAAKiO,KAAKA,IACN,OAAO,KAClB,MAAMmP,GAAKnP,EAAO,IAAI6X,MAAMo3B,IAC5B,OAAO9/B,EAAI22B,EAAa32B,EAAE,IAAM,IAClC,CAGA,IAAA1d,GACE,MAAMsmB,EAAIhmB,KAAKiP,OAAO6lC,EAASp1C,KAC/B,OAAOsmB,GAAKA,EAAEtmB,MAChB,CAGA,OAAA0qD,CAAQxX,GAEN,OADA5yC,KAAKmqD,IAAMvX,EACJ5yC,IACT,CAGA,IAAAwN,CAAK3B,EAAOC,GACV,MAAMka,EAAI0sB,EAAiB1yC,KAAM6L,EAAOC,GACxC,OAAO9L,KAAK6L,MAAM,IAAIosC,GAAUjyB,EAAEna,QAAQC,OAAO,IAAImsC,GAAUjyB,EAAEla,QACnE,CAGA,KAAAD,CAAMA,GACJ,OAAO7L,KAAKiO,KAAK,QAASpC,EAC5B,CAGA,cAAAmwC,GAEE,OADAA,GAAeh8C,KAAMA,KAAKmqD,KACnBv8B,MAAMouB,gBACf,CAGA,CAAA11C,CAAEA,GACA,OAAOtG,KAAKiO,KAAK,IAAK3H,EACxB,CAGA,CAAAE,CAAEA,GACA,OAAOxG,KAAKiO,KAAK,IAAKzH,EACxB,EAEF0uC,EAAO4O,GAAS,CACdp2C,KAr/BF,WAEE,MAeMwS,EAAMi2B,EAAOn2C,KAfHoD,GAAQA,EAAKqnD,UAIfvmD,IACZ,IACE,MAAM6nC,EAAQ7nC,EAAG6nC,QAAQld,MAAMknB,IAAS7vC,KAAKzC,OACvCyc,EAAM6rB,EAAM3oC,KAAKqnD,UAEvB,OADA1e,EAAMlmC,SACCqa,CACT,CAAE,MAAOlc,GAEP,MAAM,IAAIoQ,MAAM,4BAA4BlQ,EAAGd,KAAKuxC,8BAA8B3wC,EAAEkP,aACtF,IAIF,OADa,IAAI+xC,GAAI/kC,EAEvB,EAk+BEuG,KAj+BF,SAAcviB,GACZ,MAMMgc,EAAMi2B,EAAOn2C,KANHoD,GAAQA,EAAK+C,wBACfjC,IAGZ,MAAM,IAAIkQ,MAAM,4BAA4BlQ,EAAGd,KAAKuxC,+BAGhDluB,EAAO,IAAIw+B,GAAI/kC,GAGrB,OAAIhc,EACKuiB,EAAK/O,UAAUxT,EAAGwmD,YAAYzG,YAKhCx9B,EAAKy+B,WACd,EAg9BEyF,OA78BF,SAAgBrkD,EAAGE,GACjB,MAAM0Z,EAAMlgB,KAAK0N,OACjB,OAAOpH,EAAI4Z,EAAI5Z,GAAKE,EAAI0Z,EAAI1Z,GAAKF,EAAI4Z,EAAI5Z,EAAI4Z,EAAIrU,OAASrF,EAAI0Z,EAAI1Z,EAAI0Z,EAAIpU,MAC5E,EA28BE+5C,MAtiDF,SAAev/C,EAAGE,GAChB,OAAO,IAAIg7C,GAAMl7C,EAAGE,GAAGi7C,WAAWzhD,KAAK0qD,YAAYzG,WACrD,EAqiDE2G,IA/nCF,WACE,OAAO,IAAIv2B,GAAOr0B,KAAKoD,KAAKynD,SAC9B,EA8nCEH,UA7nCF,WACE,IAKE,GAA2B,mBAAhB1qD,KAAK8qD,SAA0B9qD,KAAK8qD,SAAU,CACvD,MAAM7kD,EAAOjG,KAAKiG,KAAK,EAAG,GACpBmX,EAAInX,EAAK7C,KAAK2nD,eAEpB,OADA9kD,EAAKJ,SACE,IAAIwuB,GAAOjX,EACpB,CACA,OAAO,IAAIiX,GAAOr0B,KAAKoD,KAAK2nD,eAC9B,CAAE,MAAO/mD,GAEP,OADA6sB,QAAQoB,KAAK,gCAAgCjyB,KAAKoD,KAAKuxC,sCAChD,IAAItgB,EACb,CACF,IA8mCAzsB,EAASk8C,GAAS,WAGlB,MAAMkH,GAAQ,CACZxyC,OAAQ,CAAC,QAAS,QAAS,UAAW,UAAW,WAAY,aAAc,YAAa,cACxFxV,KAAM,CAAC,QAAS,UAAW,QAC3BioD,OAAQ,SAAUx3C,EAAG4W,GACnB,MAAa,UAANA,EAAgB5W,EAAIA,EAAI,IAAM4W,CACvC,GAKF,CAAC,OAAQ,UAAUlnB,QAAQ,SAAUia,GACnC,MAAM8tC,EAAY,CAAC,EACnB,IAAIt6C,EACJs6C,EAAU9tC,GAAK,SAAUw1B,GACvB,QAAiB,IAANA,EACT,OAAO5yC,KAAKiO,KAAKmP,GAEnB,GAAiB,iBAANw1B,GAAkBA,aAAayL,IAASA,GAAMf,MAAM1K,IAAMA,aAAakR,GAChF9jD,KAAKiO,KAAKmP,EAAGw1B,QAGb,IAAKhiC,EAAIo6C,GAAM5tC,GAAG/M,OAAS,EAAGO,GAAK,EAAGA,IACd,MAAlBgiC,EAAEoY,GAAM5tC,GAAGxM,KACb5Q,KAAKiO,KAAK+8C,GAAMC,OAAO7tC,EAAG4tC,GAAM5tC,GAAGxM,IAAKgiC,EAAEoY,GAAM5tC,GAAGxM,KAIzD,OAAO5Q,IACT,EACA2xC,EAAgB,CAAC,UAAW,UAAWuZ,EACzC,GACAvZ,EAAgB,CAAC,UAAW,UAAW,CAErCpd,OAAQ,SAAU42B,EAAKn4C,EAAGrO,EAAG+oC,EAAG1pC,EAAGw0C,GAEjC,OAAW,MAAP2S,EACK,IAAI92B,GAAOr0B,MAIbA,KAAKiO,KAAK,YAAa,IAAIomB,GAAO82B,EAAKn4C,EAAGrO,EAAG+oC,EAAG1pC,EAAGw0C,GAC5D,EAEApkB,OAAQ,SAAUD,EAAOxN,EAAIC,GAC3B,OAAO5mB,KAAK0X,UAAU,CACpB0c,OAAQD,EACR2e,GAAInsB,EACJqsB,GAAIpsB,GACH,EACL,EAEAo7B,KAAM,SAAU17C,EAAGE,EAAGmgB,EAAIC,GACxB,OAA4B,IAArB9f,UAAUuJ,QAAqC,IAArBvJ,UAAUuJ,OAAerQ,KAAK0X,UAAU,CACvEsqC,KAAM17C,EACNwsC,GAAItsC,EACJwsC,GAAIrsB,GACH,GAAQ3mB,KAAK0X,UAAU,CACxBsqC,KAAM,CAAC17C,EAAGE,GACVssC,GAAInsB,EACJqsB,GAAIpsB,GACH,EACL,EACAw7B,MAAO,SAAUoB,EAAK78B,EAAIC,GACxB,OAAO5mB,KAAK0X,UAAU,CACpB0qC,MAAOoB,EACP1Q,GAAInsB,EACJqsB,GAAIpsB,GACH,EACL,EAEA4N,MAAO,SAAUluB,EAAGE,EAAGmgB,EAAIC,GACzB,OAA4B,IAArB9f,UAAUuJ,QAAqC,IAArBvJ,UAAUuJ,OAAerQ,KAAK0X,UAAU,CACvE8c,MAAOluB,EACPwsC,GAAItsC,EACJwsC,GAAIrsB,GACH,GAAQ3mB,KAAK0X,UAAU,CACxB8c,MAAO,CAACluB,EAAGE,GACXssC,GAAInsB,EACJqsB,GAAIpsB,GACH,EACL,EAEA6N,UAAW,SAAUnuB,EAAGE,GACtB,OAAOxG,KAAK0X,UAAU,CACpB+c,UAAW,CAACnuB,EAAGE,IACd,EACL,EAEAo8C,SAAU,SAAUt8C,EAAGE,GACrB,OAAOxG,KAAK0X,UAAU,CACpBkrC,SAAU,CAACt8C,EAAGE,IACb,EACL,EAEAq7C,KAAM,SAAUuJ,EAAY,OAAQvY,EAAS,UAK3C,OAJyC,IAArC,aAAavqB,QAAQ8iC,KACvBvY,EAASuY,EACTA,EAAY,QAEPprD,KAAK0X,UAAU,CACpBmqC,KAAMuJ,EACNvY,OAAQA,GACP,EACL,EAEA12B,QAAS,SAAU5G,GACjB,OAAOvV,KAAKiO,KAAK,UAAWsH,EAC9B,IAEFo8B,EAAgB,SAAU,CAExBl5B,OAAQ,SAAUnS,EAAGE,EAAIF,GAEvB,MAAgB,oBADFtG,KAAKo4C,UAAYp4C,MAAMsD,KACFtD,KAAKiO,KAAK,IAAK,IAAIgqC,GAAU3xC,IAAMtG,KAAKusB,GAAGjmB,GAAGkmB,GAAGhmB,EACtF,IAEFmrC,EAAgB,OAAQ,CAEtBthC,OAAQ,WACN,OAAOrQ,KAAKoD,KAAKioD,gBACnB,EAEAC,QAAS,SAAUj7C,GACjB,OAAO,IAAImxC,GAAMxhD,KAAKoD,KAAKmoD,iBAAiBl7C,GAC9C,IAEFshC,EAAgB,CAAC,UAAW,UAAW,CAErCpkC,KAAM,SAAU8c,EAAG5e,GACjB,GAAiB,iBAAN4e,EAAgB,CACzB,IAAK5e,KAAK4e,EAAGrqB,KAAKuN,KAAK9B,EAAG4e,EAAE5e,IAC5B,OAAOzL,IACT,CACA,MAAa,YAANqqB,EAAkBrqB,KAAKwO,QAAQ/C,GAAW,WAAN4e,EAAiBrqB,KAAKiO,KAAK,cAAexC,GAAW,SAAN4e,GAAsB,WAANA,GAAwB,WAANA,GAAwB,YAANA,GAAyB,YAANA,GAAyB,UAANA,EAAgBrqB,KAAKiO,KAAK,QAAUoc,EAAG5e,GAAKzL,KAAKiO,KAAKoc,EAAG5e,EAC/O,IAiBFkmC,EAAgB,UAbA,CAAC,QAAS,WAAY,YAAa,UAAW,YAAa,WAAY,YAAa,aAAc,aAAc,aAAc,YAAa,aAAc,WAAY,cAAe,cAAe,QAAS,cAAe,cAAe,YAAa,eAAgB,iBAAiB+J,OAAO,SAAU0M,EAAMvjB,GAW7T,OADAujB,EAAKvjB,GARM,SAAU2T,GAMnB,OALU,OAANA,EACFx4C,KAAKiS,IAAI4yB,GAET7kC,KAAKgS,GAAG6yB,EAAO2T,GAEVx4C,IACT,EAEOooD,CACT,EAAG,CAAC,IAgEJzW,EAAgB,UAAW,CACzB6Z,YA7DF,WACE,OAAOxrD,KAAKiO,KAAK,YAAa,KAChC,EA4DE81C,UAzDF,WAiBE,OAhBgB/jD,KAAKiO,KAAK,cAAgB,IAExC0lB,MAAMwpB,IAAYjwC,MAAM,GAAI,GAAGyH,IAAI,SAAU82C,GAE7C,MAAMC,EAAKD,EAAI53B,OAAOF,MAAM,KAC5B,MAAO,CAAC+3B,EAAG,GAAIA,EAAG,GAAG/3B,MAAMsjB,IAAWtiC,IAAI,SAAU82C,GAClD,OAAOh9C,WAAWg9C,EACpB,GACF,GAAGE,UAEFjQ,OAAO,SAAUnnB,EAAQ7c,GACxB,MAAqB,WAAjBA,EAAU,GACL6c,EAAOonB,UAAUtnB,GAAO0mB,UAAUrjC,EAAU,KAE9C6c,EAAO7c,EAAU,IAAI49B,MAAM/gB,EAAQ7c,EAAU,GACtD,EAAG,IAAI2c,GAET,EAwCEu3B,SArCF,SAAkB38C,EAAQ2B,GACxB,GAAI5Q,OAASiP,EAAQ,OAAOjP,KAC5B,GAAI+7C,GAAc/7C,KAAKoD,MAAO,OAAOpD,KAAK6uB,MAAM5f,EAAQ2B,GACxD,MAAMg6C,EAAM5qD,KAAK0qD,YACXmB,EAAO58C,EAAOy7C,YAAY1G,UAEhC,OADAhkD,KAAK6uB,MAAM5f,EAAQ2B,GAAG46C,cAAc9zC,UAAUm0C,EAAKpH,SAASmG,IACrD5qD,IACT,EA+BE8rD,OA5BF,SAAgBl7C,GACd,OAAO5Q,KAAK4rD,SAAS5rD,KAAKN,OAAQkR,EACpC,EA2BE8G,UAxBF,SAAmBk7B,EAAGgQ,GAEpB,GAAS,MAALhQ,GAA0B,iBAANA,EAAgB,CACtC,MAAMmZ,EAAa,IAAI13B,GAAOr0B,MAAMmjD,YACpC,OAAY,MAALvQ,EAAYmZ,EAAaA,EAAWnZ,EAC7C,CACKve,GAAOqtB,aAAa9O,KAEvBA,EAAI,IACCA,EACHC,OAAQF,EAAUC,EAAG5yC,QAKzB,MACM4oB,EAAS,IAAIyL,GADgB,GAAbuuB,EAAoB5iD,KAAO4iD,GAAY,GACpBlrC,UAAUk7B,GACnD,OAAO5yC,KAAKiO,KAAK,YAAa2a,EAChC,IASA,MAAMojC,WAAkBlI,GACtB,OAAAmI,GAME,OALAjsD,KAAKomD,KAAK,WACR,GAAIpmD,gBAAgBgsD,GAClB,OAAOhsD,KAAKisD,UAAUC,SAE1B,GACOlsD,IACT,CACA,OAAAksD,CAAQj9C,EAASjP,KAAKiP,SAAU0Z,EAAQ1Z,EAAO0Z,MAAM3oB,OAOnD,OALA2oB,GAAmB,IAAXA,EAAe1Z,EAAOkY,WAAW9W,OAASsY,EAClD3oB,KAAKomD,KAAK,SAAUx1C,EAAGuW,GAErB,OAAOA,EAASA,EAAS9W,OAASO,EAAI,GAAGg7C,SAAS38C,EAAQ0Z,EAC5D,GACO3oB,KAAK6F,QACd,EAEF+B,EAASokD,GAAW,aAEpB,MAAMG,WAAaH,GACjB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,EACjC,CACA,OAAA0F,GACE,OAAOjsD,IACT,CACA,OAAAksD,GACE,OAAOlsD,IACT,EAEF4H,EAASukD,GAAM,QAEf,MAAMC,WAActI,IACpBl8C,EAASwkD,GAAO,SA0ChB,IAAIC,GAAU,CACZ/P,UAAW,KACX31B,GAAImxB,EACJlxB,GAAImxB,EACJjsC,OAAQqsC,EACR5rB,GAAIA,EACJC,GAAIA,EACJ3gB,MAAOmsC,EACP1xC,EAAGsxC,EACHpxC,EAAGqxC,GAGL,MAAMvrB,WAAgB8/B,GACpB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,UAAWjxC,GAAOmjD,EACpC,CACA,IAAA/4C,CAAK3B,EAAOC,GACV,MAAMka,EAAI0sB,EAAiB1yC,KAAM6L,EAAOC,GACxC,OAAO9L,KAAKusB,GAAG,IAAI0rB,GAAUjyB,EAAEna,OAAOqsC,OAAO,IAAI1rB,GAAG,IAAIyrB,GAAUjyB,EAAEla,QAAQosC,OAAO,GACrF,EAEFhD,EAAO5oB,GAAS+/B,IAChB1a,EAAgB,YAAa,CAE3B5E,QAASsI,EAAkB,SAAUxpC,EAAQ,EAAGC,EAASD,GACvD,OAAO7L,KAAK2nD,IAAI,IAAIr7B,IAAW9e,KAAK3B,EAAOC,GAAQsD,KAAK,EAAG,EAC7D,KAEFxH,EAAS0kB,GAAS,WAElB,MAAMsoB,WAAiB4S,GACrB,WAAApmD,CAAYgC,EAAOmwC,GAAQ9wC,SAASknD,0BAClC/7B,MAAMxqB,EACR,CAGA,GAAA+kD,CAAImB,EAASC,EAAU1V,GASrB,GARuB,kBAAZyV,IACTzV,EAAK0V,EACLA,EAAWD,EACXA,EAAU,MAKG,MAAXA,GAAsC,mBAAZA,EAAwB,CACpD,MAAMnkB,EAAU,IAAIqiB,GAAI5T,EAAO,UAAWC,IAE1C,OADA1O,EAAQ1jC,IAAIzB,KAAKoD,KAAK6tB,UAAU,IACzBkU,EAAQgjB,IAAI,EAAOtU,EAC5B,CAGA,OAAOjmB,MAAMu6B,IAAImB,EAAS,EAAOzV,EACnC,EAEFjsC,EAASgtC,GAAU,YAqBnB,IA53B0BvQ,GA43BtBioB,GAAa,CACfhQ,UAAW,KACXnuC,KAAMA,EACN8V,GAAIA,GAGN,MAAMsoC,WAAiBP,GACrB,WAAA5qD,CAAYkC,EAAMijD,GAChB34B,MAAMymB,EAAU/wC,EAAO,WAA4B,iBAATA,EAAoB,KAAOA,GAAOijD,EAC9E,CAGA,IAAAt4C,CAAKoc,EAAGrX,EAAGrO,GAET,MADU,cAAN0lB,IAAmBA,EAAI,qBACpBuD,MAAM3f,KAAKoc,EAAGrX,EAAGrO,EAC1B,CACA,IAAA+I,GACE,OAAO,IAAIu3C,EACb,CACA,OAAAuH,GACE,OAAOlW,EAAS,cAAgBt2C,KAAKiH,KAAO,IAC9C,CAGA,QAAAiM,GACE,OAAOlT,KAAKysD,KACd,CAGA,MAAAz2B,CAAOoc,GAQL,OANApyC,KAAKkD,QAGgB,mBAAVkvC,GACTA,EAAM7xC,KAAKP,KAAMA,MAEZA,IACT,CAGA,GAAAysD,GACE,MAAO,QAAUzsD,KAAKiH,KAAO,GAC/B,EAEFiuC,EAAOqX,GAAUD,IACjB3a,EAAgB,CACdqa,UAAW,CAET,QAAAU,IAAY76C,GACV,OAAO7R,KAAK86B,OAAO4xB,YAAY76C,EACjC,GAGFs6C,KAAM,CACJO,SAAUrX,EAAkB,SAAU/xC,EAAM8uC,GAC1C,OAAOpyC,KAAK2nD,IAAI,IAAI4E,GAASjpD,IAAO0yB,OAAOoc,EAC7C,MAGJxqC,EAAS2kD,GAAU,YAEnB,MAAMI,WAAgBX,GAEpB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,UAAWjxC,GAAOmjD,EACpC,CAGA,IAAAt4C,CAAKoc,EAAGrX,EAAGrO,GAET,MADU,cAAN0lB,IAAmBA,EAAI,oBACpBuD,MAAM3f,KAAKoc,EAAGrX,EAAGrO,EAC1B,CACA,IAAA+I,GACE,OAAO,IAAIu3C,EACb,CACA,OAAAuH,GACE,OAAOlW,EAAS,cAAgBt2C,KAAKiH,KAAO,IAC9C,CAGA,QAAAiM,GACE,OAAOlT,KAAKysD,KACd,CAGA,MAAAz2B,CAAOoc,GAQL,OANApyC,KAAKkD,QAGgB,mBAAVkvC,GACTA,EAAM7xC,KAAKP,KAAMA,MAEZA,IACT,CAGA,GAAAysD,GACE,MAAO,QAAUzsD,KAAKiH,KAAO,GAC/B,EAEF0qC,EAAgB,CACdqa,UAAW,CAET,OAAAtxB,IAAW7oB,GACT,OAAO7R,KAAK86B,OAAOJ,WAAW7oB,EAChC,GAEFs6C,KAAM,CACJzxB,QAAS2a,EAAkB,SAAUxpC,EAAOC,EAAQsmC,GAClD,OAAOpyC,KAAK2nD,IAAI,IAAIgF,IAAW32B,OAAOoc,GAAOnkC,KAAK,CAChD3H,EAAG,EACHE,EAAG,EACHqF,MAAOA,EACPC,OAAQA,EACRkvB,aAAc,kBAElB,MAGJpzB,EAAS+kD,GAAS,WAElB,MAAMC,WAAcR,GAClB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,QAASjxC,GAAOmjD,EAClC,CAGA,IAAAjvB,CAAKm1B,EAAK5lB,GACR,IAAK4lB,EAAK,OAAOzsD,KACjB,MAAM6sD,EAAM,IAAItZ,GAAQ9V,OAAOmvB,MAsB/B,OArBA56C,EAAG66C,EAAK,OAAQ,SAAU7oD,GACxB,MAAMgiB,EAAIhmB,KAAKiP,OAAO09C,IAGD,IAAjB3sD,KAAK6L,SAAmC,IAAlB7L,KAAK8L,UAC7B9L,KAAKwN,KAAKq/C,EAAIhhD,MAAOghD,EAAI/gD,QAEvBka,aAAa2mC,IAEG,IAAd3mC,EAAEna,SAAgC,IAAfma,EAAEla,UACvBka,EAAExY,KAAKxN,KAAK6L,QAAS7L,KAAK8L,UAGN,mBAAb+6B,GACTA,EAAStmC,KAAKP,KAAMgE,EAExB,EAAGhE,MACHgS,EAAG66C,EAAK,aAAc,WAEpB56C,EAAI46C,EACN,GACO7sD,KAAKiO,KAAK,OAAQ4+C,EAAI7f,IAAMyf,EAAKjQ,GAC1C,EAthCwBnY,GAwhCT,SAAUp2B,EAAMoqB,EAAKmxB,GAYpC,MAVa,SAATv7C,GAA4B,WAATA,GACjBwvC,GAAQ/D,KAAKrhB,KACfA,EAAMmxB,EAAM9pD,OAAOo7B,OAAOgyB,MAAMz0B,IAGhCA,aAAeu0B,KACjBv0B,EAAMmxB,EAAM9pD,OAAOo7B,OAAOJ,QAAQ,EAAG,EAAGA,IACtCA,EAAQj5B,IAAI42B,MAGTA,CACT,EApiCEkvB,GAAMrlD,KAAKmiC,IAqiCbsN,EAAgB,CACdqa,UAAW,CAETc,MAAOzX,EAAkB,SAAU5E,EAAQ5J,GACzC,OAAO7mC,KAAK2nD,IAAI,IAAIiF,IAASp/C,KAAK,EAAG,GAAG8pB,KAAKmZ,EAAQ5J,EACvD,MAGJj/B,EAASglD,GAAO,SAEhB,MAAMG,WAAmBjG,GAEvB,IAAAp5C,GACE,IAAIs/C,GAAO,IACPC,GAAO,IACPC,EAAO3H,IACP4H,EAAO5H,IAOX,OANAvlD,KAAKmD,QAAQ,SAAUe,GACrB8oD,EAAOvgD,KAAKK,IAAI5I,EAAG,GAAI8oD,GACvBC,EAAOxgD,KAAKK,IAAI5I,EAAG,GAAI+oD,GACvBC,EAAOzgD,KAAKC,IAAIxI,EAAG,GAAIgpD,GACvBC,EAAO1gD,KAAKC,IAAIxI,EAAG,GAAIipD,EACzB,GACO,IAAIlI,GAAIiI,EAAMC,EAAMH,EAAOE,EAAMD,EAAOE,EACjD,CAGA,IAAA/9C,CAAK9I,EAAGE,GACN,MAAM0Z,EAAMlgB,KAAK0N,OAOjB,GAJApH,GAAK4Z,EAAI5Z,EACTE,GAAK0Z,EAAI1Z,GAGJ0gD,MAAM5gD,KAAO4gD,MAAM1gD,GACtB,IAAK,IAAIoK,EAAI5Q,KAAKqQ,OAAS,EAAGO,GAAK,EAAGA,IACpC5Q,KAAK4Q,GAAK,CAAC5Q,KAAK4Q,GAAG,GAAKtK,EAAGtG,KAAK4Q,GAAG,GAAKpK,GAG5C,OAAOxG,IACT,CAGA,KAAAwxC,CAAMW,EAAQ,CAAC,EAAG,IAChB,MAAMne,EAAS,IAIbme,EADEA,aAAiBjkC,MACXA,MAAMvN,UAAUkpB,OAAOyrB,MAAM,GAAInD,GAIjCA,EAAMte,OAAOF,MAAMsjB,IAAWtiC,IAAIlG,aAKlC4B,OAAS,GAAM,GAAG8hC,EAAMpmB,MAGlC,IAAK,IAAInb,EAAI,EAAGwB,EAAM+/B,EAAM9hC,OAAQO,EAAIwB,EAAKxB,GAAQ,EACnDojB,EAAO9xB,KAAK,CAACiwC,EAAMvhC,GAAIuhC,EAAMvhC,EAAI,KAEnC,OAAOojB,CACT,CAGA,IAAAxmB,CAAK3B,EAAOC,GACV,IAAI8E,EACJ,MAAMsP,EAAMlgB,KAAK0N,OAGjB,IAAKkD,EAAI5Q,KAAKqQ,OAAS,EAAGO,GAAK,EAAGA,IAC5BsP,EAAIrU,QAAO7L,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,GACvE4Z,EAAIpU,SAAQ9L,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,GAEhF,OAAOxG,IACT,CAGA,MAAAotD,GACE,MAAO,CACLpjB,GAAIhqC,KAAK,GAAG,GACZiqC,GAAIjqC,KAAK,GAAG,GACZkqC,GAAIlqC,KAAK,GAAG,GACZmqC,GAAInqC,KAAK,GAAG,GAEhB,CAGA,QAAAkT,GACE,MAAMi/B,EAAQ,GAEd,IAAK,IAAIvhC,EAAI,EAAGyhC,EAAKryC,KAAKqQ,OAAQO,EAAIyhC,EAAIzhC,IACxCuhC,EAAMjwC,KAAKlC,KAAK4Q,GAAGgE,KAAK,MAE1B,OAAOu9B,EAAMv9B,KAAK,IACpB,CACA,SAAA8C,CAAU0F,GACR,OAAOpd,KAAK+rC,QAAQ0V,WAAWrkC,EACjC,CAGA,UAAAqkC,CAAWrkC,GACJiX,GAAOqtB,aAAatkC,KACvBA,EAAI,IAAIiX,GAAOjX,IAEjB,IAAK,IAAIxM,EAAI5Q,KAAKqQ,OAAQO,KAAM,CAE9B,MAAOtK,EAAGE,GAAKxG,KAAK4Q,GACpB5Q,KAAK4Q,GAAG,GAAKwM,EAAEiN,EAAI/jB,EAAI8W,EAAEzY,EAAI6B,EAAI4W,EAAEpZ,EACnChE,KAAK4Q,GAAG,GAAKwM,EAAEpK,EAAI1M,EAAI8W,EAAEswB,EAAIlnC,EAAI4W,EAAEo7B,CACrC,CACA,OAAOx4C,IACT,EA2BF,IAAIqtD,GAAU,CACZ/Q,UAAW,KACXgR,WA1BiBP,GA2BjBjhD,OARF,SAAkBA,GAChB,MAAMkH,EAAIhT,KAAK0N,OACf,OAAiB,MAAV5B,EAAiBkH,EAAElH,OAAS9L,KAAKwN,KAAKwF,EAAEnH,MAAOC,EACxD,EAMED,MAfF,SAAiBA,GACf,MAAMmH,EAAIhT,KAAK0N,OACf,OAAgB,MAAT7B,EAAgBmH,EAAEnH,MAAQ7L,KAAKwN,KAAK3B,EAAOmH,EAAElH,OACtD,EAaExF,EA1BF,SAAaA,GACX,OAAY,MAALA,EAAYtG,KAAK0N,OAAOpH,EAAItG,KAAKoP,KAAK9I,EAAGtG,KAAK0N,OAAOlH,EAC9D,EAyBEA,EAtBF,SAAaA,GACX,OAAY,MAALA,EAAYxG,KAAK0N,OAAOlH,EAAIxG,KAAKoP,KAAKpP,KAAK0N,OAAOpH,EAAGE,EAC9D,GAuBA,MAAM+mD,WAAanB,GAEjB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,EACjC,CAGA,KAAApU,GACE,OAAO,IAAI4a,GAAW,CAAC,CAAC/sD,KAAKiO,KAAK,MAAOjO,KAAKiO,KAAK,OAAQ,CAACjO,KAAKiO,KAAK,MAAOjO,KAAKiO,KAAK,QACzF,CAGA,IAAAmB,CAAK9I,EAAGE,GACN,OAAOxG,KAAKiO,KAAKjO,KAAKmyC,QAAQ/iC,KAAK9I,EAAGE,GAAG4mD,SAC3C,CAGA,IAAAI,CAAKxjB,EAAIC,EAAIC,EAAIC,GACf,OAAU,MAANH,EACKhqC,KAAKmyC,SAEZnI,OADuB,IAAPC,EACX,CACHD,KACAC,KACAC,KACAC,MAGG,IAAI4iB,GAAW/iB,GAAIojB,SAEnBptD,KAAKiO,KAAK+7B,GACnB,CAGA,IAAAx8B,CAAK3B,EAAOC,GACV,MAAMka,EAAI0sB,EAAiB1yC,KAAM6L,EAAOC,GACxC,OAAO9L,KAAKiO,KAAKjO,KAAKmyC,QAAQ3kC,KAAKwY,EAAEna,MAAOma,EAAEla,QAAQshD,SACxD,EAEFlY,EAAOqY,GAAMF,IACb1b,EAAgB,CACdqa,UAAW,CAETpyC,KAAMy7B,EAAkB,YAAaxjC,GAGnC,OAAO07C,GAAK5sD,UAAU6sD,KAAKlY,MAAMt1C,KAAK2nD,IAAI,IAAI4F,IAAoB,MAAX17C,EAAK,GAAaA,EAAO,CAAC,EAAG,EAAG,EAAG,GAC5F,MAGJjK,EAAS2lD,GAAM,QAEf,MAAME,WAAezB,GAEnB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,SAAUjxC,GAAOmjD,EACnC,CAGA,MAAAz6C,CAAOA,GACL,OAAO9L,KAAKiO,KAAK,eAAgBnC,EACnC,CACA,MAAA4hD,CAAOA,GACL,OAAO1tD,KAAKiO,KAAK,SAAUy/C,EAC7B,CAGA,GAAAC,CAAIrnD,EAAGE,GACL,OAAOxG,KAAKiO,KAAK,OAAQ3H,GAAG2H,KAAK,OAAQzH,EAC3C,CAGA,QAAA0M,GACE,MAAO,QAAUlT,KAAKiH,KAAO,GAC/B,CAGA,MAAA+uB,CAAOoc,GAQL,OANApyC,KAAKkD,QAGgB,mBAAVkvC,GACTA,EAAM7xC,KAAKP,KAAMA,MAEZA,IACT,CAGA,KAAA6L,CAAMA,GACJ,OAAO7L,KAAKiO,KAAK,cAAepC,EAClC,EAEF8lC,EAAgB,CACdqa,UAAW,CACT,MAAA4B,IAAU/7C,GAER,OAAO7R,KAAK86B,OAAO8yB,UAAU/7C,EAC/B,GAEFs6C,KAAM,CAEJyB,OAAQvY,EAAkB,SAAUxpC,EAAOC,EAAQsmC,GAEjD,OAAOpyC,KAAK2nD,IAAI,IAAI8F,IAAUjgD,KAAK3B,EAAOC,GAAQ6hD,IAAI9hD,EAAQ,EAAGC,EAAS,GAAG65C,QAAQ,EAAG,EAAG95C,EAAOC,GAAQmC,KAAK,SAAU,QAAQ+nB,OAAOoc,EAC1I,IAEFwb,OAAQ,CAEN,MAAAA,CAAOA,EAAQ/hD,EAAOC,EAAQsmC,GAC5B,IAAInkC,EAAO,CAAC,UAQZ,MALe,QAAX2/C,GAAkB3/C,EAAK/L,KAAK0rD,GAChC3/C,EAAOA,EAAK2G,KAAK,KAGjBg5C,EAAS9mD,UAAU,aAAc2mD,GAAS3mD,UAAU,GAAK9G,KAAK86B,OAAO8yB,OAAO/hD,EAAOC,EAAQsmC,GACpFpyC,KAAKiO,KAAKA,EAAM2/C,EACzB,KAGJhmD,EAAS6lD,GAAQ,UAgBjB,MAAMI,GAAS,CACb,IAAK,SAAUjwB,GACb,OAAOA,CACT,EACA,KAAM,SAAUA,GACd,OAAQnxB,KAAKogB,IAAI+Q,EAAMnxB,KAAKmgB,IAAM,EAAI,EACxC,EACA,IAAK,SAAUgR,GACb,OAAOnxB,KAAKqgB,IAAI8Q,EAAMnxB,KAAKmgB,GAAK,EAClC,EACA,IAAK,SAAUgR,GACb,OAAsC,EAA9BnxB,KAAKogB,IAAI+Q,EAAMnxB,KAAKmgB,GAAK,EACnC,EACAkhC,OAAQ,SAAU9jB,EAAIC,EAAIC,EAAIC,GAE5B,OAAO,SAAU12B,GACf,OAAIA,EAAI,EACFu2B,EAAK,EACAC,EAAKD,EAAKv2B,EACRy2B,EAAK,EACPC,EAAKD,EAAKz2B,EAEV,EAEAA,EAAI,EACTy2B,EAAK,GACC,EAAIC,IAAO,EAAID,GAAMz2B,GAAK02B,EAAKD,IAAO,EAAIA,GACzCF,EAAK,GACN,EAAIC,IAAO,EAAID,GAAMv2B,GAAKw2B,EAAKD,IAAO,EAAIA,GAE3C,EAGF,EAAIv2B,GAAK,EAAIA,IAAM,EAAIw2B,EAAK,EAAIx2B,GAAK,GAAK,EAAIA,GAAK02B,EAAK12B,GAAK,CAExE,CACF,EAEAs6C,MAAO,SAAUA,EAAOC,EAAe,OAErCA,EAAeA,EAAar6B,MAAM,KAAKg4B,UAAU,GACjD,IAAIsC,EAAQF,EAQZ,MAPqB,SAAjBC,IACAC,EACwB,SAAjBD,KACPC,EAIG,CAACx6C,EAAGy6C,EAAa,KAEtB,IAAIj6B,EAAOxnB,KAAKgG,MAAMgB,EAAIs6C,GAC1B,MAAMI,EAAU16C,EAAIwgB,EAAO,GAAM,EAajC,MAZqB,UAAjB+5B,GAA6C,SAAjBA,KAC5B/5B,EAEAi6B,GAAcC,KACdl6B,EAEAxgB,GAAK,GAAKwgB,EAAO,IACnBA,EAAO,GAELxgB,GAAK,GAAKwgB,EAAOg6B,IACnBh6B,EAAOg6B,GAEFh6B,EAAOg6B,EAElB,GAEF,MAAMG,GACJ,IAAAC,GACE,OAAO,CACT,EAQF,MAAMC,WAAaF,GACjB,WAAAhtD,CAAYijC,EAAKsiB,GAASC,MACxBh5B,QACA5tB,KAAK4mD,KAAOiH,GAAOxpB,IAAOA,CAC5B,CACA,IAAApQ,CAAK9lB,EAAM8V,EAAI2Z,GACb,MAAoB,iBAATzvB,EACFyvB,EAAM,EAAIzvB,EAAO8V,EAEnB9V,GAAQ8V,EAAK9V,GAAQnO,KAAK4mD,KAAKhpB,EACxC,EAQF,MAAM1O,WAAmBk/B,GACvB,WAAAhtD,CAAYijC,GACVzW,QACA5tB,KAAKm7C,QAAU9W,CACjB,CACA,IAAAgqB,CAAK1pD,GACH,OAAOA,EAAE0pD,IACX,CACA,IAAAp6B,CAAKnI,EAASla,EAAQ28C,EAAI5pD,GACxB,OAAO3E,KAAKm7C,QAAQrvB,EAASla,EAAQ28C,EAAI5pD,EAC3C,EAkBF,MAAM6pD,WAAet/B,GACnB,WAAA9tB,CAAYs3C,EAAW,IAAKE,EAAY,GACtChrB,QACA5tB,KAAK04C,SAASA,GAAUE,UAAUA,EACpC,CACA,IAAA3kB,CAAKnI,EAASla,EAAQ28C,EAAI5pD,GACxB,GAAuB,iBAAZmnB,EAAsB,OAAOA,EAExC,GADAnnB,EAAE0pD,KAAOE,IAAOhJ,IACZgJ,IAAOhJ,IAAU,OAAO3zC,EAC5B,GAAW,IAAP28C,EAAU,OAAOziC,EACjByiC,EAAK,MAAKA,EAAK,IACnBA,GAAM,IAGN,MAAMn5B,EAAWzwB,EAAEywB,UAAY,EAGzBq5B,GAAgBzuD,KAAK0tC,EAAItY,EAAWp1B,KAAKskC,GAAKxY,EAAUla,GACxD88C,EAAc5iC,EAAUsJ,EAAWm5B,EAAKE,EAAeF,EAAKA,EAAK,EAOvE,OAJA5pD,EAAEywB,SAAWA,EAAWq5B,EAAeF,EAGvC5pD,EAAE0pD,KAAO5hD,KAAK+gB,IAAI5b,EAAS88C,GAAejiD,KAAK+gB,IAAI4H,GAAY,KACxDzwB,EAAE0pD,KAAOz8C,EAAS88C,CAC3B,EAEFxZ,EAAOsZ,GAAQ,CACb9V,SAAUH,EAAiB,YAAaE,GACxCG,UAAWL,EAAiB,aAAcE,KAE5C,MAAMkW,WAAYz/B,GAChB,WAAA9tB,CAAY4kB,EAAI,GAAKpV,EAAI,IAAM88B,EAAI,EAAGkhB,EAAS,KAC7ChhC,QACA5tB,KAAKgmB,EAAEA,GAAGpV,EAAEA,GAAG88B,EAAEA,GAAGkhB,OAAOA,EAC7B,CACA,IAAA36B,CAAKnI,EAASla,EAAQ28C,EAAI5pD,GACxB,GAAuB,iBAAZmnB,EAAsB,OAAOA,EAExC,GADAnnB,EAAE0pD,KAAOE,IAAOhJ,IACZgJ,IAAOhJ,IAAU,OAAO3zC,EAC5B,GAAW,IAAP28C,EAAU,OAAOziC,EACrB,MAAM9F,EAAIpU,EAASka,EACnB,IAAIlb,GAAKjM,EAAEkqD,UAAY,GAAK7oC,EAAIuoC,EAChC,MAAM7gB,GAAK1nB,GAAKrhB,EAAEmsB,OAAS,IAAMy9B,EAC3BK,EAAS5uD,KAAK8uD,QASpB,OANe,GAAXF,IACFh+C,EAAInE,KAAKK,KAAK8hD,EAAQniD,KAAKC,IAAIkE,EAAGg+C,KAEpCjqD,EAAEmsB,MAAQ9K,EACVrhB,EAAEkqD,SAAWj+C,EACbjM,EAAE0pD,KAAO5hD,KAAK+gB,IAAIxH,GAAK,KAChBrhB,EAAE0pD,KAAOz8C,EAASka,GAAW9rB,KAAK+uD,EAAI/oC,EAAIhmB,KAAKgvD,EAAIp+C,EAAI5Q,KAAKktB,EAAIwgB,EACzE,EAEFwH,EAAOyZ,GAAK,CACVC,OAAQrW,EAAiB,WACzBvyB,EAAGuyB,EAAiB,KACpB3nC,EAAG2nC,EAAiB,KACpB7K,EAAG6K,EAAiB,OAGtB,MAAMY,GAAoB,CACxB8V,EAAG,EACH5hC,EAAG,EACH6hC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,EACHC,EAAG,GAECrV,GAAe,CACnB6U,EAAG,SAAUtqD,EAAGqhB,EAAGq0B,GAGjB,OAFAr0B,EAAE1f,EAAI+zC,EAAG/zC,EAAI3B,EAAE,GACfqhB,EAAExf,EAAI6zC,EAAG7zC,EAAI7B,EAAE,GACR,CAAC,IAAKqhB,EAAE1f,EAAG0f,EAAExf,EACtB,EACA6mB,EAAG,SAAU1oB,EAAGqhB,GAGd,OAFAA,EAAE1f,EAAI3B,EAAE,GACRqhB,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GACvB,EACAuqD,EAAG,SAAUvqD,EAAGqhB,GAEd,OADAA,EAAE1f,EAAI3B,EAAE,GACD,CAAC,IAAKA,EAAE,GACjB,EACAwqD,EAAG,SAAUxqD,EAAGqhB,GAEd,OADAA,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GACjB,EACAyqD,EAAG,SAAUzqD,EAAGqhB,GAGd,OAFAA,EAAE1f,EAAI3B,EAAE,GACRqhB,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAC/C,EACA0qD,EAAG,SAAU1qD,EAAGqhB,GAGd,OAFAA,EAAE1f,EAAI3B,EAAE,GACRqhB,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GACnC,EACA2qD,EAAG,SAAU3qD,EAAGqhB,GAGd,OAFAA,EAAE1f,EAAI3B,EAAE,GACRqhB,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GACnC,EACA4qD,EAAG,SAAU5qD,EAAGqhB,GAGd,OAFAA,EAAE1f,EAAI3B,EAAE,GACRqhB,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GACvB,EACA8qD,EAAG,SAAU9qD,EAAGqhB,EAAGq0B,GAGjB,OAFAr0B,EAAE1f,EAAI+zC,EAAG/zC,EACT0f,EAAExf,EAAI6zC,EAAG7zC,EACF,CAAC,IACV,EACAgpD,EAAG,SAAU7qD,EAAGqhB,GAGd,OAFAA,EAAE1f,EAAI3B,EAAE,GACRqhB,EAAExf,EAAI7B,EAAE,GACD,CAAC,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GACrD,GAEI+qD,GAAa,aAAa/7B,MAAM,IACtC,IAAK,IAAI/iB,EAAI,EAAGyhC,EAAKqd,GAAWr/C,OAAQO,EAAIyhC,IAAMzhC,EAChDwpC,GAAasV,GAAW9+C,IAAM,SAAUA,GACtC,OAAO,SAAUjM,EAAGqhB,EAAGq0B,GACrB,GAAU,MAANzpC,EAAWjM,EAAE,GAAKA,EAAE,GAAKqhB,EAAE1f,OAAO,GAAU,MAANsK,EAAWjM,EAAE,GAAKA,EAAE,GAAKqhB,EAAExf,OAAO,GAAU,MAANoK,EAC9EjM,EAAE,GAAKA,EAAE,GAAKqhB,EAAE1f,EAChB3B,EAAE,GAAKA,EAAE,GAAKqhB,EAAExf,OAEhB,IAAK,IAAIwnC,EAAI,EAAG2hB,EAAKhrD,EAAE0L,OAAQ29B,EAAI2hB,IAAM3hB,EACvCrpC,EAAEqpC,GAAKrpC,EAAEqpC,IAAMA,EAAI,EAAIhoB,EAAExf,EAAIwf,EAAE1f,GAGnC,OAAO8zC,GAAaxpC,GAAGjM,EAAGqhB,EAAGq0B,EAC/B,CACF,CAZ8B,CAY5BqV,GAAW9+C,GAAG29B,eAmDlB,MAAMqhB,GAAiB,IAAIvuD,IAAI,CAAC,IAAK,IAAK,KAAM,KAAM,KAAM,OAoH5D,MAAMwuD,WAAkB/I,GAEtB,IAAAp5C,GAEE,OADAqoC,IAAS10B,KAAK9S,aAAa,IAAKvO,KAAKkT,YAC9B,IAAI+xC,GAAIlP,EAAO9yC,MAAMoe,KAAKopC,UACnC,CAGA,IAAAr7C,CAAK9I,EAAGE,GAEN,MAAM0Z,EAAMlgB,KAAK0N,OAKjB,GAFApH,GAAK4Z,EAAI5Z,EACTE,GAAK0Z,EAAI1Z,GACJ0gD,MAAM5gD,KAAO4gD,MAAM1gD,GAEtB,IAAK,IAAI8jB,EAAG1Z,EAAI5Q,KAAKqQ,OAAS,EAAGO,GAAK,EAAGA,IACvC0Z,EAAItqB,KAAK4Q,GAAG,GACF,MAAN0Z,GAAmB,MAANA,GAAmB,MAANA,GAC5BtqB,KAAK4Q,GAAG,IAAMtK,EACdtG,KAAK4Q,GAAG,IAAMpK,GACC,MAAN8jB,EACTtqB,KAAK4Q,GAAG,IAAMtK,EACC,MAANgkB,EACTtqB,KAAK4Q,GAAG,IAAMpK,EACC,MAAN8jB,GAAmB,MAANA,GAAmB,MAANA,GACnCtqB,KAAK4Q,GAAG,IAAMtK,EACdtG,KAAK4Q,GAAG,IAAMpK,EACdxG,KAAK4Q,GAAG,IAAMtK,EACdtG,KAAK4Q,GAAG,IAAMpK,EACJ,MAAN8jB,IACFtqB,KAAK4Q,GAAG,IAAMtK,EACdtG,KAAK4Q,GAAG,IAAMpK,IAED,MAAN8jB,IACTtqB,KAAK4Q,GAAG,IAAMtK,EACdtG,KAAK4Q,GAAG,IAAMpK,GAIpB,OAAOxG,IACT,CAGA,KAAAwxC,CAAM9D,EAAI,QAIR,OAHIx/B,MAAM4lB,QAAQ4Z,KAChBA,EAAIx/B,MAAMvN,UAAUkpB,OAAOyrB,MAAM,GAAI5H,GAAGx6B,YAlK9C,SAAoBw6B,EAAGoiB,EAAa,GAClC,IAAInnC,EAAQ,EACR0wB,EAAQ,GACZ,MAAMtD,EAAS,CACbxI,QAAS,GACT+L,SAAU,EACVS,OAAQ,GACRW,UAAW,GACXZ,UAAW,EACXnvB,SAAU,GACVqvB,UAAW,EACXC,YAAa,EACbC,SAAU4V,EACVzV,GAAI,IAAImH,GACRx7B,EAAG,IAAIw7B,IAET,KAAOzL,EAAO2E,UAAYrB,EAAOA,EAAQ3L,EAAE+E,OAAO9pB,MAChD,GAAKotB,EAAO+D,YACNV,GAAgBrD,EAAQsD,GAI9B,GAAc,MAAVA,EAWJ,GAAK6N,MAAMtzB,SAASylB,IAWpB,GAAIuW,GAAepuD,IAAI63C,GACjBtD,EAAOuD,UACTC,GAAexD,EAAQ,QAI3B,GAAc,MAAVsD,GAA2B,MAAVA,EAUrB,GAA4B,MAAxBA,EAAM9K,eAKV,GAAIkL,GAAaC,KAAKL,GAAQ,CAC5B,GAAItD,EAAOuD,SACTC,GAAexD,EAAQ,OAClB,KAAKmD,EAAgBnD,GAC1B,MAAM,IAAI3hC,MAAM,gBAEhBoV,GAAgBusB,EAClB,GACEptB,CACJ,OAbEotB,EAAOgE,QAAUV,EACjBtD,EAAOkE,YAAc,MAZvB,CACE,GAAIlE,EAAOuD,WAAamB,GAAc1E,GAAS,CAC7CwD,GAAexD,EAAQ,KACrBptB,EACF,QACF,CACAotB,EAAOgE,QAAUV,EACjBtD,EAAOuD,SAAW,CAEpB,KA1BA,CACE,GAAsB,MAAlBvD,EAAOgE,QAAkBQ,GAAUxE,GAAS,CAC9CA,EAAOuD,SAAW,EAClBvD,EAAOgE,OAASV,EAChBE,GAAexD,EAAQ,GACvB,QACF,CACAA,EAAOuD,SAAW,EAClBvD,EAAOgE,QAAUV,CAEnB,KArBA,CACE,GAAItD,EAAOiE,WAAajE,EAAOkE,YAAa,CAC1CV,GAAexD,EAAQ,KACrBptB,EACF,QACF,CACAotB,EAAOuD,SAAW,EAClBvD,EAAOiE,UAAY,EACnBjE,EAAOgE,QAAUV,CAEnB,CAkDF,OANItD,EAAOuD,UACTC,GAAexD,EAAQ,GAErBA,EAAO+D,WAAaZ,EAAgBnD,IACtCvsB,GAAgBusB,GAEXA,EAAOprB,QAChB,CAiFWolC,CAAWriB,EACpB,CAGA,IAAAlgC,CAAK3B,EAAOC,GAEV,MAAMoU,EAAMlgB,KAAK0N,OACjB,IAAIkD,EAAG0Z,EAQP,IAJApK,EAAIrU,MAAsB,IAAdqU,EAAIrU,MAAc,EAAIqU,EAAIrU,MACtCqU,EAAIpU,OAAwB,IAAfoU,EAAIpU,OAAe,EAAIoU,EAAIpU,OAGnC8E,EAAI5Q,KAAKqQ,OAAS,EAAGO,GAAK,EAAGA,IAChC0Z,EAAItqB,KAAK4Q,GAAG,GACF,MAAN0Z,GAAmB,MAANA,GAAmB,MAANA,GAC5BtqB,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,EAC5DtG,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,GAC/C,MAAN8jB,EACTtqB,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,EAC7C,MAANgkB,EACTtqB,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,EAC/C,MAAN8jB,GAAmB,MAANA,GAAmB,MAANA,GACnCtqB,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,EAC5DtG,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,EAC9DxG,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,EAC5DtG,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,EACpD,MAAN8jB,IACFtqB,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,EAC5DtG,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,IAEjD,MAAN8jB,IAETtqB,KAAK4Q,GAAG,GAAK5Q,KAAK4Q,GAAG,GAAK/E,EAAQqU,EAAIrU,MACtC7L,KAAK4Q,GAAG,GAAK5Q,KAAK4Q,GAAG,GAAK9E,EAASoU,EAAIpU,OAGvC9L,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI5Z,GAAKuF,EAAQqU,EAAIrU,MAAQqU,EAAI5Z,EAC5DtG,KAAK4Q,GAAG,IAAM5Q,KAAK4Q,GAAG,GAAKsP,EAAI1Z,GAAKsF,EAASoU,EAAIpU,OAASoU,EAAI1Z,GAGlE,OAAOxG,IACT,CAGA,QAAAkT,GACE,OA/HJ,SAAuBmX,GACrB,IAAItV,EAAI,GACR,IAAK,IAAInE,EAAI,EAAGyhC,EAAKhoB,EAAEha,OAAQO,EAAIyhC,EAAIzhC,IACrCmE,GAAKsV,EAAEzZ,GAAG,GACK,MAAXyZ,EAAEzZ,GAAG,KACPmE,GAAKsV,EAAEzZ,GAAG,GACK,MAAXyZ,EAAEzZ,GAAG,KACPmE,GAAK,IACLA,GAAKsV,EAAEzZ,GAAG,GACK,MAAXyZ,EAAEzZ,GAAG,KACPmE,GAAK,IACLA,GAAKsV,EAAEzZ,GAAG,GACVmE,GAAK,IACLA,GAAKsV,EAAEzZ,GAAG,GACK,MAAXyZ,EAAEzZ,GAAG,KACPmE,GAAK,IACLA,GAAKsV,EAAEzZ,GAAG,GACVmE,GAAK,IACLA,GAAKsV,EAAEzZ,GAAG,GACK,MAAXyZ,EAAEzZ,GAAG,KACPmE,GAAK,IACLA,GAAKsV,EAAEzZ,GAAG,QAOtB,OAAOmE,EAAI,GACb,CAkGWi7C,CAAchwD,KACvB,EAGF,MAAMiwD,GAAkB16C,IACtB,MAAMjS,SAAciS,EACpB,MAAa,WAATjS,EACK20C,GACW,WAAT30C,EACL+6C,GAAME,QAAQhpC,GACT8oC,GACEpH,GAAUyC,KAAKnkC,GACjBkkC,GAAaC,KAAKnkC,GAASs6C,GAAY/I,GACrC9J,GAActD,KAAKnkC,GACrB0iC,GAEAiY,GAEAtV,GAAetyB,QAAQ/S,EAAMnU,cAAgB,EAC/CmU,EAAMnU,YACJ8M,MAAM4lB,QAAQve,GAChBuxC,GACW,WAATxjD,EACF6sD,GAEAD,IAGX,MAAMpV,GACJ,WAAA15C,CAAY+5C,GACVn7C,KAAKowD,SAAWjV,GAAW,IAAImT,GAAK,KACpCtuD,KAAKqwD,MAAQ,KACbrwD,KAAKswD,IAAM,KACXtwD,KAAKuwD,MAAQ,KACbvwD,KAAKwwD,SAAW,KAChBxwD,KAAKywD,UAAY,IACnB,CACA,EAAAC,CAAG9yB,GACD,OAAO59B,KAAKywD,UAAUvV,MAAMl7C,KAAKqwD,MAAOrwD,KAAKswD,IAAK1yB,EAAK59B,KAAKowD,SAAUpwD,KAAKwwD,SAC7E,CACA,IAAAnC,GAIE,OAHiBruD,KAAKwwD,SAAS77C,IAAI3U,KAAKowD,SAAS/B,MAAM3S,OAAO,SAAU0M,EAAM0B,GAC5E,OAAO1B,GAAQ0B,CACjB,EAAG,EAEL,CACA,IAAA37C,CAAKkqB,GACH,OAAW,MAAPA,EACKr4B,KAAKqwD,OAEdrwD,KAAKqwD,MAAQrwD,KAAK2wD,KAAKt4B,GAChBr4B,KACT,CACA,OAAAm7C,CAAQA,GACN,OAAe,MAAXA,EAAwBn7C,KAAKowD,UACjCpwD,KAAKowD,SAAWjV,EACTn7C,KACT,CACA,EAAAikB,CAAGoU,GACD,OAAW,MAAPA,EACKr4B,KAAKswD,KAEdtwD,KAAKswD,IAAMtwD,KAAK2wD,KAAKt4B,GACdr4B,KACT,CACA,IAAAsD,CAAKA,GAEH,OAAY,MAARA,EACKtD,KAAKuwD,OAIdvwD,KAAKuwD,MAAQjtD,EACNtD,KACT,CACA,IAAA2wD,CAAKp7C,GACEvV,KAAKuwD,OACRvwD,KAAKsD,KAAK2sD,GAAgB16C,IAE5B,IAAIqT,EAAS,IAAI5oB,KAAKuwD,MAAMh7C,GAa5B,OAZIvV,KAAKuwD,QAAUlS,KACjBz1B,EAAS5oB,KAAKswD,IAAM1nC,EAAO5oB,KAAKswD,IAAI,MAAQtwD,KAAKqwD,MAAQznC,EAAO5oB,KAAKqwD,MAAM,MAAQznC,GAEjF5oB,KAAKuwD,QAAUJ,KACjBvnC,EAAS5oB,KAAKswD,IAAM1nC,EAAOgoC,MAAM5wD,KAAKswD,KAAOtwD,KAAKqwD,MAAQznC,EAAOgoC,MAAM5wD,KAAKqwD,OAASznC,GAEvFA,EAASA,EAAOqyB,eAChBj7C,KAAKywD,UAAYzwD,KAAKywD,WAAa,IAAIzwD,KAAKuwD,MAC5CvwD,KAAKwwD,SAAWxwD,KAAKwwD,UAAYtiD,MAAMonC,MAAM,KAAMpnC,MAAM0a,EAAOvY,SAASsE,IAAIjU,QAAQiU,IAAI,SAAUi+B,GAEjG,OADAA,EAAEyb,KAAO,EACFzb,CACT,GACOhqB,CACT,EAEF,MAAMsnC,GACJ,WAAA9uD,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CACA,IAAAuJ,CAAKid,GAGH,OAFAA,EAAMnqB,MAAM4lB,QAAQuE,GAAOA,EAAI,GAAKA,EACpCr4B,KAAKuV,MAAQ8iB,EACNr4B,IACT,CACA,OAAAq8B,GACE,MAAO,CAACr8B,KAAKuV,MACf,CACA,OAAA4mC,GACE,OAAOn8C,KAAKuV,KACd,EAEF,MAAMs7C,GACJ,WAAAzvD,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CACA,IAAAuJ,CAAK5a,GAcH,OAbI0N,MAAM4lB,QAAQtzB,KAChBA,EAAM,CACJ0hD,OAAQ1hD,EAAI,GACZ2hD,OAAQ3hD,EAAI,GACZ4hD,MAAO5hD,EAAI,GACX4zB,OAAQ5zB,EAAI,GACZogB,WAAYpgB,EAAI,GAChBqgB,WAAYrgB,EAAI,GAChBuyC,QAASvyC,EAAI,GACbyyC,QAASzyC,EAAI,KAGjBE,OAAOib,OAAO3b,KAAM6wD,GAAa5U,SAAUz7C,GACpCR,IACT,CACA,OAAAq8B,GACE,MAAM5wB,EAAIzL,KACV,MAAO,CAACyL,EAAEy2C,OAAQz2C,EAAE02C,OAAQ12C,EAAE22C,MAAO32C,EAAE2oB,OAAQ3oB,EAAEmV,WAAYnV,EAAEoV,WAAYpV,EAAEsnC,QAAStnC,EAAEwnC,QAC1F,EAEF4d,GAAa5U,SAAW,CACtBiG,OAAQ,EACRC,OAAQ,EACRC,MAAO,EACPhuB,OAAQ,EACRxT,WAAY,EACZC,WAAY,EACZkyB,QAAS,EACTE,QAAS,GAEX,MAAM6d,GAAY,CAACzmC,EAAGrX,IACbqX,EAAE,GAAKrX,EAAE,IAAM,EAAIqX,EAAE,GAAKrX,EAAE,GAAK,EAAI,EAE9C,MAAMm9C,GACJ,WAAA/uD,IAAeyQ,GACb7R,KAAKob,QAAQvJ,EACf,CACA,KAAA++C,CAAMpuB,GACJ,MAAMzqB,EAAS/X,KAAK+X,OACpB,IAAK,IAAInH,EAAI,EAAGyhC,EAAKt6B,EAAO1H,OAAQO,EAAIyhC,IAAMzhC,EAAG,CAE/C,GAAImH,EAAOnH,EAAI,KAAO4xB,EAAM5xB,EAAI,GAAI,CAClC,GAAImH,EAAOnH,EAAI,KAAOytC,IAAS7b,EAAM5xB,EAAI,KAAOmH,EAAOnH,EAAI,GAAI,CAC7D,MAAMglC,EAAQpT,EAAM5xB,EAAI,GAClB5L,EAAQ,IAAIq5C,GAAMr+C,KAAK+X,OAAOkQ,OAAOrX,EAAI,EAAG,IAAIglC,KAASvZ,UAC/Dr8B,KAAK+X,OAAOkQ,OAAOrX,EAAI,EAAG,KAAM5L,EAClC,CACA4L,GAAKmH,EAAOnH,EAAI,GAAK,EACrB,QACF,CACA,IAAK4xB,EAAM5xB,EAAI,GACb,OAAO5Q,KAKT,MAAM+wD,GAAgB,IAAIvuB,EAAM5xB,EAAI,IAAKyrB,UAGnC20B,EAAWj5C,EAAOnH,EAAI,GAAK,EACjCmH,EAAOkQ,OAAOrX,EAAGogD,EAAUxuB,EAAM5xB,GAAI4xB,EAAM5xB,EAAI,GAAI4xB,EAAM5xB,EAAI,MAAOmgD,GACpEngD,GAAKmH,EAAOnH,EAAI,GAAK,CACvB,CACA,OAAO5Q,IACT,CACA,IAAAob,CAAK61C,GAEH,GADAjxD,KAAK+X,OAAS,GACV7J,MAAM4lB,QAAQm9B,GAEhB,YADAjxD,KAAK+X,OAASk5C,EAAS/jD,SAGzB+jD,EAAWA,GAAY,CAAC,EACxB,MAAM59B,EAAU,GAChB,IAAK,MAAMziB,KAAKqgD,EAAU,CACxB,MAAMC,EAAOjB,GAAgBgB,EAASrgD,IAChCynB,EAAM,IAAI64B,EAAKD,EAASrgD,IAAIyrB,UAClChJ,EAAQnxB,KAAK,CAAC0O,EAAGsgD,EAAM74B,EAAIhoB,UAAWgoB,GACxC,CAGA,OAFAhF,EAAQ89B,KAAKL,IACb9wD,KAAK+X,OAASsb,EAAQqoB,OAAO,CAAC0M,EAAM0B,IAAS1B,EAAKv+B,OAAOigC,GAAO,IACzD9pD,IACT,CACA,OAAAq8B,GACE,OAAOr8B,KAAK+X,MACd,CACA,OAAAokC,GACE,MAAM37C,EAAM,CAAC,EACPw6C,EAAMh7C,KAAK+X,OAGjB,KAAOijC,EAAI3qC,QAAQ,CACjB,MAAMkB,EAAMypC,EAAIoW,QACVF,EAAOlW,EAAIoW,QACXC,EAAMrW,EAAIoW,QACVr5C,EAASijC,EAAI/yB,OAAO,EAAGopC,GAC7B7wD,EAAI+Q,GAAO,IAAI2/C,EAAKn5C,EACtB,CACA,OAAOvX,CACT,EAEF,MAAMo6C,GAAiB,CAACsV,GAAcW,GAAcV,IA0BpD,MAAMtnD,WAAaujD,GAEjB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,EACjC,CAGA,KAAApU,GACE,OAAOnyC,KAAKsxD,SAAWtxD,KAAKsxD,OAAS,IAAIzB,GAAU7vD,KAAKiO,KAAK,MAC/D,CAGA,KAAA/K,GAEE,cADOlD,KAAKsxD,OACLtxD,IACT,CAGA,MAAA8L,CAAOA,GACL,OAAiB,MAAVA,EAAiB9L,KAAK0N,OAAO5B,OAAS9L,KAAKwN,KAAKxN,KAAK0N,OAAO7B,MAAOC,EAC5E,CAGA,IAAAsD,CAAK9I,EAAGE,GACN,OAAOxG,KAAKiO,KAAK,IAAKjO,KAAKmyC,QAAQ/iC,KAAK9I,EAAGE,GAC7C,CAGA,IAAAgnD,CAAK9f,GACH,OAAY,MAALA,EAAY1tC,KAAKmyC,QAAUnyC,KAAKkD,QAAQ+K,KAAK,IAAkB,iBAANy/B,EAAiBA,EAAI1tC,KAAKsxD,OAAS,IAAIzB,GAAUniB,GACnH,CAGA,IAAAlgC,CAAK3B,EAAOC,GACV,MAAMka,EAAI0sB,EAAiB1yC,KAAM6L,EAAOC,GACxC,OAAO9L,KAAKiO,KAAK,IAAKjO,KAAKmyC,QAAQ3kC,KAAKwY,EAAEna,MAAOma,EAAEla,QACrD,CAGA,KAAAD,CAAMA,GACJ,OAAgB,MAATA,EAAgB7L,KAAK0N,OAAO7B,MAAQ7L,KAAKwN,KAAK3B,EAAO7L,KAAK0N,OAAO5B,OAC1E,CAGA,CAAAxF,CAAEA,GACA,OAAY,MAALA,EAAYtG,KAAK0N,OAAOpH,EAAItG,KAAKoP,KAAK9I,EAAGtG,KAAK0N,OAAOlH,EAC9D,CAGA,CAAAA,CAAEA,GACA,OAAY,MAALA,EAAYxG,KAAK0N,OAAOlH,EAAIxG,KAAKoP,KAAKpP,KAAK0N,OAAOpH,EAAGE,EAC9D,EAIFqC,GAAKlI,UAAU2sD,WAAauC,GAG5Ble,EAAgB,CACdqa,UAAW,CAET3qC,KAAMg0B,EAAkB,SAAU3H,GAEhC,OAAO1tC,KAAK2nD,IAAI,IAAI9+C,IAAQ2kD,KAAK9f,GAAK,IAAImiB,GAC5C,MAGJjoD,EAASiB,GAAM,QA6Bf,IAAI0oD,GAAO,CACTjV,UAAW,KACXnK,MA5BF,WACE,OAAOnyC,KAAKsxD,SAAWtxD,KAAKsxD,OAAS,IAAIvE,GAAW/sD,KAAKiO,KAAK,WAChE,EA2BE/K,MAxBF,WAEE,cADOlD,KAAKsxD,OACLtxD,IACT,EAsBEoP,KAnBF,SAAgB9I,EAAGE,GACjB,OAAOxG,KAAKiO,KAAK,SAAUjO,KAAKmyC,QAAQ/iC,KAAK9I,EAAGE,GAClD,EAkBEgnD,KAfF,SAAcxnC,GACZ,OAAY,MAALA,EAAYhmB,KAAKmyC,QAAUnyC,KAAKkD,QAAQ+K,KAAK,SAAuB,iBAAN+X,EAAiBA,EAAIhmB,KAAKsxD,OAAS,IAAIvE,GAAW/mC,GACzH,EAcExY,KAXF,SAAgB3B,EAAOC,GACrB,MAAMka,EAAI0sB,EAAiB1yC,KAAM6L,EAAOC,GACxC,OAAO9L,KAAKiO,KAAK,SAAUjO,KAAKmyC,QAAQ3kC,KAAKwY,EAAEna,MAAOma,EAAEla,QAC1D,GAWA,MAAM0lD,WAAgBpF,GAEpB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,UAAWjxC,GAAOmjD,EACpC,EAEF5U,EAAgB,CACdqa,UAAW,CAETyF,QAASpc,EAAkB,SAAUrvB,GAEnC,OAAOhmB,KAAK2nD,IAAI,IAAI6J,IAAWhE,KAAKxnC,GAAK,IAAI+mC,GAC/C,MAGJ7X,EAAOsc,GAASnE,IAChBnY,EAAOsc,GAASD,IAChB3pD,EAAS4pD,GAAS,WAElB,MAAME,WAAiBtF,GAErB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,WAAYjxC,GAAOmjD,EACrC,EAEF5U,EAAgB,CACdqa,UAAW,CAET2F,SAAUtc,EAAkB,SAAUrvB,GAEpC,OAAOhmB,KAAK2nD,IAAI,IAAI+J,IAAYlE,KAAKxnC,GAAK,IAAI+mC,GAChD,MAGJ7X,EAAOwc,GAAUrE,IACjBnY,EAAOwc,GAAUH,IACjB3pD,EAAS8pD,GAAU,YAEnB,MAAME,WAAaxF,GAEjB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,EACjC,EAEFrR,EAAO0c,GAAM,CACXrlC,KACAC,OAEFmlB,EAAgB,CACdqa,UAAW,CAET/lD,KAAMovC,EAAkB,SAAUxpC,EAAOC,GACvC,OAAO9L,KAAK2nD,IAAI,IAAIiK,IAAQpkD,KAAK3B,EAAOC,EAC1C,MAGJlE,EAASgqD,GAAM,QAEf,MAAMC,GACJ,WAAAzwD,GACEpB,KAAK8xD,OAAS,KACd9xD,KAAK+xD,MAAQ,IACf,CAGA,KAAA/J,GACE,OAAOhoD,KAAK8xD,QAAU9xD,KAAK8xD,OAAOv8C,KACpC,CAGA,IAAA6yC,GACE,OAAOpoD,KAAK+xD,OAAS/xD,KAAK+xD,MAAMx8C,KAClC,CACA,IAAArT,CAAKqT,GAEH,MAAMwf,OAA6B,IAAfxf,EAAMgd,KAAuBhd,EAAQ,CACvDA,MAAOA,EACPgd,KAAM,KACNvG,KAAM,MAcR,OAVIhsB,KAAK+xD,OACPh9B,EAAK/I,KAAOhsB,KAAK+xD,MACjB/xD,KAAK+xD,MAAMx/B,KAAOwC,EAClB/0B,KAAK+xD,MAAQh9B,IAEb/0B,KAAK+xD,MAAQh9B,EACb/0B,KAAK8xD,OAAS/8B,GAITA,CACT,CAGA,MAAAlvB,CAAOkvB,GAEDA,EAAK/I,OAAM+I,EAAK/I,KAAKuG,KAAOwC,EAAKxC,MACjCwC,EAAKxC,OAAMwC,EAAKxC,KAAKvG,KAAO+I,EAAK/I,MACjC+I,IAAS/0B,KAAK+xD,QAAO/xD,KAAK+xD,MAAQh9B,EAAK/I,MACvC+I,IAAS/0B,KAAK8xD,SAAQ9xD,KAAK8xD,OAAS/8B,EAAKxC,MAG7CwC,EAAK/I,KAAO,KACZ+I,EAAKxC,KAAO,IACd,CACA,KAAA6+B,GAEE,MAAMvrD,EAAS7F,KAAK8xD,OACpB,OAAKjsD,GAGL7F,KAAK8xD,OAASjsD,EAAO0sB,KACjBvyB,KAAK8xD,SAAQ9xD,KAAK8xD,OAAO9lC,KAAO,MACpChsB,KAAK+xD,MAAQ/xD,KAAK8xD,OAAS9xD,KAAK+xD,MAAQ,KACjClsD,EAAO0P,OANM,IAOtB,EAGF,MAAMy8C,GAAW,CACfC,SAAU,KACVrrB,OAAQ,IAAIirB,GACZK,SAAU,IAAIL,GACdM,WAAY,IAAIN,GAChBO,MAAO,IAAM7e,GAAQ9V,OAAOH,aAAeiW,GAAQ9V,OAAOnqB,KAC1D6pC,WAAY,GACZ,KAAAkV,CAAMhuB,GAEJ,MAAMjhC,EAAO4uD,GAASprB,OAAO1kC,KAAK,CAChCowD,IAAKjuB,IASP,OAL0B,OAAtB2tB,GAASC,WACXD,GAASC,SAAW1e,GAAQ9V,OAAOsJ,sBAAsBirB,GAASO,QAI7DnvD,CACT,EACA,OAAAovD,CAAQnuB,EAAIwiB,GACVA,EAAQA,GAAS,EAGjB,MAAM4L,EAAOT,GAASI,QAAQ7+C,MAAQszC,EAGhCzjD,EAAO4uD,GAASE,SAAShwD,KAAK,CAClCowD,IAAKjuB,EACLouB,KAAMA,IAOR,OAH0B,OAAtBT,GAASC,WACXD,GAASC,SAAW1e,GAAQ9V,OAAOsJ,sBAAsBirB,GAASO,QAE7DnvD,CACT,EACA,SAAAsvD,CAAUruB,GAER,MAAMjhC,EAAO4uD,GAASG,WAAWjwD,KAAKmiC,GAKtC,OAH0B,OAAtB2tB,GAASC,WACXD,GAASC,SAAW1e,GAAQ9V,OAAOsJ,sBAAsBirB,GAASO,QAE7DnvD,CACT,EACA,WAAAuvD,CAAYvvD,GACF,MAARA,GAAgB4uD,GAASprB,OAAO/gC,OAAOzC,EACzC,EACA,YAAAwvD,CAAaxvD,GACH,MAARA,GAAgB4uD,GAASE,SAASrsD,OAAOzC,EAC3C,EACA,eAAAyvD,CAAgBzvD,GACN,MAARA,GAAgB4uD,GAASG,WAAWtsD,OAAOzC,EAC7C,EACA,KAAAmvD,CAAMh/C,GAGJ,IAAIu/C,EAAc,KAClB,MAAMC,EAAcf,GAASE,SAAS9J,OACtC,MAAO0K,EAAcd,GAASE,SAASd,WAEjC79C,GAAOu/C,EAAYL,KACrBK,EAAYR,MAEZN,GAASE,SAAShwD,KAAK4wD,GAIrBA,IAAgBC,KAItB,IAAIC,EAAY,KAChB,MAAMC,EAAYjB,GAASprB,OAAOwhB,OAClC,KAAO4K,IAAcC,IAAcD,EAAYhB,GAASprB,OAAOwqB,UAC7D4B,EAAUV,IAAI/+C,GAEhB,IAAI2/C,EAAgB,KACpB,KAAOA,EAAgBlB,GAASG,WAAWf,SACzC8B,IAIFlB,GAASC,SAAWD,GAASE,SAASlK,SAAWgK,GAASprB,OAAOohB,QAAUzU,GAAQ9V,OAAOsJ,sBAAsBirB,GAASO,OAAS,IACpI,GAGIY,GAAe,SAAUC,GAC7B,MAAM5mD,EAAQ4mD,EAAW5mD,MACnBksC,EAAW0a,EAAWC,OAAO3a,WAEnC,MAAO,CACLlsC,MAAOA,EACPksC,SAAUA,EACV7rC,IAJUL,EAAQksC,EAKlB2a,OAAQD,EAAWC,OAEvB,EACMC,GAAgB,WACpB,MAAM51C,EAAI61B,GAAQ9V,OAClB,OAAQ/f,EAAE4f,aAAe5f,EAAEpK,MAAMC,KACnC,EACA,MAAMggD,WAAiB/M,GAErB,WAAAplD,CAAYoyD,EAAaF,IACvB1lC,QACA5tB,KAAKyzD,YAAcD,EAGnBxzD,KAAK0zD,WACP,CACA,MAAAC,GACE,QAAS3zD,KAAK4zD,UAChB,CACA,MAAAC,GAGE,OADA7zD,KAAKyyD,KAAKzyD,KAAK8zD,uBAAyB,GACjC9zD,KAAK+zD,OACd,CAGA,UAAAC,GACE,MAAMC,EAAiBj0D,KAAKk0D,oBACtBC,EAAeF,EAAiBA,EAAeZ,OAAO3a,WAAa,EAEzE,OADsBub,EAAiBA,EAAeznD,MAAQxM,KAAKo0D,OAC5CD,CACzB,CACA,oBAAAL,GACE,MAAMO,EAAWr0D,KAAKs0D,SAAS3/C,IAAI/D,GAAKA,EAAEpE,MAAQoE,EAAEyiD,OAAO3a,YAC3D,OAAOjsC,KAAKK,IAAI,KAAMunD,EACxB,CACA,iBAAAH,GACE,OAAOl0D,KAAKu0D,kBAAkBv0D,KAAKw0D,cACrC,CACA,iBAAAD,CAAkBttD,GAChB,OAAOjH,KAAKs0D,SAASt0D,KAAKy0D,WAAWnsC,QAAQrhB,KAAQ,IACvD,CACA,KAAA8sD,GAEE,OADA/zD,KAAK00D,QAAU,EACR10D,KAAK20D,WACd,CACA,OAAAC,CAAQC,GACN,OAAmB,MAAfA,EAA4B70D,KAAK80D,UACrC90D,KAAK80D,SAAWD,EACT70D,KACT,CACA,IAAA+0D,GAGE,OADA/0D,KAAK00D,QAAU,EACR10D,KAAKg1D,aAAaL,WAC3B,CACA,OAAAhJ,CAAQsJ,GACN,MAAMC,EAAel1D,KAAKm1D,QAC1B,GAAW,MAAPF,EAAa,OAAOj1D,KAAKm1D,OAAOD,GACpC,MAAME,EAAW3oD,KAAK+gB,IAAI0nC,GAC1B,OAAOl1D,KAAKm1D,MAAMF,GAAOG,EAAWA,EACtC,CAGA,QAAAC,CAAShC,EAAQxM,EAAOyO,GACtB,GAAc,MAAVjC,EACF,OAAOrzD,KAAKs0D,SAAS3/C,IAAIw+C,IAO3B,IAAIoC,EAAoB,EACxB,MAAMC,EAAUx1D,KAAKg0D,aAIrB,GAHAnN,EAAQA,GAAS,EAGL,MAARyO,GAAyB,SAATA,GAA4B,UAATA,EAErCC,EAAoBC,OACf,GAAa,aAATF,GAAgC,UAATA,EAChCC,EAAoB1O,EACpBA,EAAQ,OACH,GAAa,QAATyO,EACTC,EAAoBv1D,KAAKo0D,WACpB,GAAa,aAATkB,EAAqB,CAC9B,MAAMlC,EAAapzD,KAAKu0D,kBAAkBlB,EAAOpsD,IAC7CmsD,IACFmC,EAAoBnC,EAAW5mD,MAAQq6C,EACvCA,EAAQ,EAEZ,KAAO,IAAa,cAATyO,EAKT,MAAM,IAAIlhD,MAAM,0CALe,CAC/B,MAAM6/C,EAAiBj0D,KAAKk0D,oBAE5BqB,EADsBtB,EAAiBA,EAAeznD,MAAQxM,KAAKo0D,KAErE,CAEA,CAGAf,EAAOoC,aACPpC,EAAO1M,SAAS3mD,MAChB,MAAM40D,EAAUvB,EAAOuB,UACjBxB,EAAa,CACjBwB,QAAqB,OAAZA,EAAmB50D,KAAK80D,SAAWF,EAC5CpoD,MAAO+oD,EAAoB1O,EAC3BwM,UAOF,OALArzD,KAAKw0D,cAAgBnB,EAAOpsD,GAC5BjH,KAAKs0D,SAASpyD,KAAKkxD,GACnBpzD,KAAKs0D,SAASnD,KAAK,CAAC9mC,EAAGrX,IAAMqX,EAAE7d,MAAQwG,EAAExG,OACzCxM,KAAKy0D,WAAaz0D,KAAKs0D,SAAS3/C,IAAImrB,GAAQA,EAAKuzB,OAAOpsD,IACxDjH,KAAKg1D,aAAaL,YACX30D,IACT,CACA,IAAA01D,CAAKnH,GACH,OAAOvuD,KAAKyyD,KAAKzyD,KAAKo0D,MAAQ7F,EAChC,CACA,MAAA9d,CAAOpM,GACL,OAAU,MAANA,EAAmBrkC,KAAKyzD,aAC5BzzD,KAAKyzD,YAAcpvB,EACZrkC,KACT,CACA,KAAAm1D,CAAMA,GACJ,OAAa,MAATA,EAAsBn1D,KAAK21D,QAC/B31D,KAAK21D,OAASR,EACPn1D,KACT,CACA,IAAA+9B,GAGE,OADA/9B,KAAKyyD,KAAK,GACHzyD,KAAK+zD,OACd,CACA,IAAAtB,CAAKA,GACH,OAAY,MAARA,EAAqBzyD,KAAKo0D,OAC9Bp0D,KAAKo0D,MAAQ3B,EACNzyD,KAAK20D,UAAU,GACxB,CAGA,UAAAc,CAAWpC,GACT,MAAM1qC,EAAQ3oB,KAAKy0D,WAAWnsC,QAAQ+qC,EAAOpsD,IAC7C,OAAI0hB,EAAQ,IACZ3oB,KAAKs0D,SAASrsC,OAAOU,EAAO,GAC5B3oB,KAAKy0D,WAAWxsC,OAAOU,EAAO,GAC9B0qC,EAAO1M,SAAS,OAHM3mD,IAKxB,CAGA,UAAAg1D,GAIE,OAHKh1D,KAAK2zD,WACR3zD,KAAK41D,gBAAkB51D,KAAKyzD,eAEvBzzD,IACT,CAGA,SAAA20D,CAAUkB,EAAgB,GAGxB,OAFA7D,GAASW,YAAY3yD,KAAK4zD,YAC1B5zD,KAAK4zD,WAAa,KACdiC,EAAsB71D,KAAK81D,kBAC3B91D,KAAK00D,UACT10D,KAAK4zD,WAAa5B,GAASK,MAAMryD,KAAK+1D,QADb/1D,KAG3B,CACA,OAAAg2D,CAAQH,EAAgB,GAEtB,MAAMpD,EAAOzyD,KAAKyzD,cAClB,IAAIwC,EAAWxD,EAAOzyD,KAAK41D,gBACvBC,IAAeI,EAAW,GAC9B,MAAMC,EAASl2D,KAAK21D,OAASM,GAAYj2D,KAAKo0D,MAAQp0D,KAAKm2D,eAC3Dn2D,KAAK41D,gBAAkBnD,EAIlBoD,IAEH71D,KAAKo0D,OAAS8B,EACdl2D,KAAKo0D,MAAQp0D,KAAKo0D,MAAQ,EAAI,EAAIp0D,KAAKo0D,OAEzCp0D,KAAKm2D,cAAgBn2D,KAAKo0D,MAC1Bp0D,KAAK0mD,KAAK,OAAQ1mD,KAAKo0D,OAavB,IAAK,IAAI9vB,EAAItkC,KAAKs0D,SAASjkD,OAAQi0B,KAAM,CAEvC,MAAM8uB,EAAapzD,KAAKs0D,SAAShwB,GAC3B+uB,EAASD,EAAWC,OAIRrzD,KAAKo0D,MAAQhB,EAAW5mD,OAIzB,GACf6mD,EAAO+C,OAEX,CAGA,IAAIC,EAAc,EAClB,IAAK,IAAIzlD,EAAI,EAAGwB,EAAMpS,KAAKs0D,SAASjkD,OAAQO,EAAIwB,EAAKxB,IAAK,CAExD,MAAMwiD,EAAapzD,KAAKs0D,SAAS1jD,GAC3ByiD,EAASD,EAAWC,OAC1B,IAAI9E,EAAK2H,EAIT,MAAMI,EAAYt2D,KAAKo0D,MAAQhB,EAAW5mD,MAGtC8pD,GAAa,EACfD,EAAc,GAELC,EAAY/H,IAErBA,EAAK+H,GAEFjD,EAAOM,WAIKN,EAAOp/B,KAAKs6B,GAAIF,KAIC,GAAvB+E,EAAWwB,SAEJvB,EAAO3a,WAAa2a,EAAOZ,OAASzyD,KAAKo0D,MAC3ChB,EAAWwB,QAAU50D,KAAKo0D,QAEtCf,EAAOoC,eACL7kD,IACAwB,GATJikD,EAAc,GAYlB,CAUA,OANIA,KAAiBr2D,KAAK21D,OAAS,GAAoB,IAAf31D,KAAKo0D,QAAgBp0D,KAAKy0D,WAAWpkD,QAAUrQ,KAAK21D,OAAS,GAAK31D,KAAKo0D,MAAQ,EACrHp0D,KAAK20D,aAEL30D,KAAK+zD,QACL/zD,KAAK0mD,KAAK,aAEL1mD,IACT,CACA,SAAA0zD,GAIE1zD,KAAKu2D,WAAa,EAClBv2D,KAAK21D,OAAS,EAGd31D,KAAK80D,SAAW,EAGhB90D,KAAK4zD,WAAa,KAClB5zD,KAAK00D,QAAU,EACf10D,KAAKs0D,SAAW,GAChBt0D,KAAKy0D,WAAa,GAClBz0D,KAAKw0D,eAAiB,EACtBx0D,KAAKo0D,MAAQ,EACbp0D,KAAK41D,gBAAkB,EACvB51D,KAAKm2D,cAAgB,EAGrBn2D,KAAK+1D,MAAQ/1D,KAAKg2D,QAAQngC,KAAK71B,KAAM,GACrCA,KAAK81D,eAAiB91D,KAAKg2D,QAAQngC,KAAK71B,KAAM,EAChD,EAEF2xC,EAAgB,CACdmS,QAAS,CACP6C,SAAU,SAAUA,GAClB,OAAgB,MAAZA,GACF3mD,KAAKw2D,UAAYx2D,KAAKw2D,WAAa,IAAIjD,GAChCvzD,KAAKw2D,YAEZx2D,KAAKw2D,UAAY7P,EACV3mD,KAEX,KAIJ,MAAMy2D,WAAejQ,GACnB,WAAAplD,CAAYwpB,GACVgD,QAGA5tB,KAAKiH,GAAKwvD,GAAOxvD,KAMjB2jB,EAA6B,mBAH7BA,EAAqB,MAAXA,EAAkB+7B,GAASjO,SAAW9tB,GAGN,IAAIsE,GAAWtE,GAAWA,EAGpE5qB,KAAKo4C,SAAW,KAChBp4C,KAAKw2D,UAAY,KACjBx2D,KAAKquD,KAAO,EACZruD,KAAK02D,OAAS,GAGd12D,KAAK24C,UAA+B,iBAAZ/tB,GAAwBA,EAChD5qB,KAAK22D,eAAiB/rC,aAAmBsE,GACzClvB,KAAKowD,SAAWpwD,KAAK22D,eAAiB/rC,EAAU,IAAI0jC,GAGpDtuD,KAAK42D,SAAW,CAAC,EAGjB52D,KAAK62D,QAAU,EACf72D,KAAKo0D,MAAQ,EACbp0D,KAAK82D,UAAY,EAGjB92D,KAAK+2D,SAAW,EAGhB/2D,KAAKm9C,WAAa,IAAI9oB,GACtBr0B,KAAKg3D,YAAc,EAGnBh3D,KAAKi3D,cAAgB,EACrBj3D,KAAKk3D,SAAW,EAChBl3D,KAAKm3D,WAAa,EAClBn3D,KAAKo3D,OAAS,EACdp3D,KAAKq3D,MAAQ,EACbr3D,KAAKs3D,OAAS,EACdt3D,KAAK67C,SAAW,KAGhB77C,KAAK80D,SAAW90D,KAAK22D,eAAiB,EAAO,IAC/C,CACA,eAAOY,CAAS7e,EAAUmO,EAAOyO,GAE/B,IAAIjO,EAAQ,EACRmQ,EAAQ,EACRj6B,EAAO,EAcX,OAZAspB,EAAQA,GAASF,GAASE,MAC1ByO,EAAOA,GAAQ,OAGS,iBALxB5c,EAAWA,GAAYiO,GAASjO,WAKMA,aAAoB0V,KACxDvH,EAAQnO,EAASmO,OAASA,EAC1ByO,EAAO5c,EAAS4c,MAAQA,EACxBkC,EAAQ9e,EAAS8e,OAASA,EAC1BnQ,EAAQ3O,EAAS2O,OAASA,EAC1B9pB,EAAOmb,EAASnb,MAAQA,EACxBmb,EAAWA,EAASA,UAAYiO,GAASjO,UAEpC,CACLA,SAAUA,EACVmO,MAAOA,EACP2Q,MAAOA,EACPnQ,MAAOA,EACP9pB,KAAMA,EACN+3B,KAAMA,EAEV,CACA,MAAA3B,CAAOkD,GACL,OAAe,MAAXA,EAAwB72D,KAAK62D,SACjC72D,KAAK62D,QAAUA,EACR72D,KACT,CAOA,YAAAy3D,CAAa//C,GAEX,OADA1X,KAAKm9C,WAAW+F,WAAWxrC,GACpB1X,IACT,CACA,KAAA88C,CAAMzY,GACJ,OAAOrkC,KAAKgS,GAAG,WAAYqyB,EAC7B,CACA,OAAAqzB,CAAQhf,EAAUmO,EAAOyO,GACvB,MAAM1iB,EAAI6jB,GAAOc,SAAS7e,EAAUmO,EAAOyO,GACrCjC,EAAS,IAAIoD,GAAO7jB,EAAE8F,UAG5B,OAFI14C,KAAKw2D,WAAWnD,EAAO1M,SAAS3mD,KAAKw2D,WACrCx2D,KAAKo4C,UAAUib,EAAOhnD,QAAQrM,KAAKo4C,UAChCib,EAAOsE,KAAK/kB,GAAGyiB,SAASziB,EAAEiU,MAAOjU,EAAE0iB,KAC5C,CACA,cAAAsC,GAEE,OADA53D,KAAKm9C,WAAa,IAAI9oB,GACfr0B,IACT,CAGA,wBAAA63D,GACO73D,KAAKquD,MAASruD,KAAKw2D,WAAcx2D,KAAKw2D,UAAU/B,WAAW/sC,SAAS1nB,KAAKiH,MAC5EjH,KAAK02D,OAAS12D,KAAK02D,OAAOx+C,OAAO6c,IACvBA,EAAK+iC,aAGnB,CACA,KAAAjR,CAAMA,GACJ,OAAO7mD,KAAK03D,QAAQ,EAAG7Q,EACzB,CACA,QAAAnO,GACE,OAAO14C,KAAKs3D,QAAUt3D,KAAKq3D,MAAQr3D,KAAK24C,WAAa34C,KAAKq3D,KAC5D,CACA,MAAAU,CAAO1zB,GACL,OAAOrkC,KAAK67B,MAAM,KAAMwI,EAC1B,CACA,IAAAuiB,CAAKviB,GAEH,OADArkC,KAAKowD,SAAW,IAAI9B,GAAKjqB,GAClBrkC,IACT,CAQA,OAAAqM,CAAQA,GACN,OAAe,MAAXA,EAAwBrM,KAAKo4C,UACjCp4C,KAAKo4C,SAAW/rC,EAChBA,EAAQ2rD,iBACDh4D,KACT,CACA,MAAA6zD,GACE,OAAO7zD,KAAKi0B,KAAKsxB,IACnB,CACA,IAAAoS,CAAKtQ,EAAOmQ,EAAOj6B,GAiBjB,MAfqB,iBAAV8pB,IACTmQ,EAAQnQ,EAAMmQ,MACdj6B,EAAO8pB,EAAM9pB,KACb8pB,EAAQA,EAAMA,OAIhBrnD,KAAKs3D,OAASjQ,GAAS9B,IACvBvlD,KAAKo3D,OAASI,GAAS,EACvBx3D,KAAKq3D,MAAQ95B,GAAQ,EAGD,GAAhBv9B,KAAKs3D,SACPt3D,KAAKs3D,OAAS/R,KAETvlD,IACT,CACA,KAAAi4D,CAAMjyC,GACJ,MAAMkyC,EAAel4D,KAAK24C,UAAY34C,KAAKq3D,MAC3C,GAAS,MAALrxC,EAAW,CACb,MAAMmyC,EAAY1rD,KAAKgG,MAAMzS,KAAKo0D,MAAQ8D,GAEpCnyD,GADe/F,KAAKo0D,MAAQ+D,EAAYD,GACdl4D,KAAK24C,UACrC,OAAOlsC,KAAKC,IAAIyrD,EAAYpyD,EAAU/F,KAAKs3D,OAC7C,CACA,MACMc,EAAUpyC,EAAI,EACdysC,EAAOyF,EAFCzrD,KAAKgG,MAAMuT,GAEWhmB,KAAK24C,UAAYyf,EACrD,OAAOp4D,KAAKyyD,KAAKA,EACnB,CACA,OAAAmC,CAAQC,GACN,OAAmB,MAAfA,EAA4B70D,KAAK80D,UACrC90D,KAAK80D,SAAWD,EACT70D,KACT,CACA,QAAA+F,CAASigB,GAEP,MAAM1f,EAAItG,KAAKo0D,MACT1mB,EAAI1tC,KAAK24C,UACTj7B,EAAI1d,KAAKq3D,MACT5jD,EAAIzT,KAAKs3D,OACTviD,EAAI/U,KAAKo3D,OACT7sC,EAAIvqB,KAAKk3D,SACf,IAAInxD,EACJ,GAAS,MAALigB,EAAW,CASb,MAAMwyB,EAAI,SAAUlyC,GAClB,MAAM+xD,EAAWtjD,EAAItI,KAAKgG,MAAMnM,GAAK,GAAKoX,EAAIgwB,KAAOhwB,EAAIgwB,IACnD4qB,EAAYD,IAAa9tC,IAAM8tC,GAAY9tC,EAC3CguC,EAAW9rD,KAAK8zC,KAAK,EAAG+X,IAAchyD,GAAKoX,EAAIgwB,IAAMA,EAAI4qB,EAE/D,OADgB7rD,KAAKK,IAAIL,KAAKC,IAAI6rD,EAAU,GAAI,EAElD,EAGM/C,EAAU/hD,GAAKiK,EAAIgwB,GAAKhwB,EAE9B,OADA3X,EAAWO,GAAK,EAAImG,KAAKghC,MAAM+K,EAAE,OAASlyC,EAAIkvD,EAAUhd,EAAElyC,GAAKmG,KAAKghC,MAAM+K,EAAEgd,EAAU,OAC/EzvD,CACT,CAGA,MAAMoyD,EAAY1rD,KAAKgG,MAAMzS,KAAKi4D,SAC5BO,EAAezjD,GAAKojD,EAAY,GAAM,EAG5C,OADApyD,EAAWoyD,GADMK,IAAiBjuC,GAAKA,GAAKiuC,EACTxyC,EAAI,EAAIA,GACpChmB,KAAKi4D,MAAMlyD,EACpB,CACA,QAAA0yD,CAASzyC,GACP,OAAS,MAALA,EACKvZ,KAAKC,IAAI,EAAG1M,KAAKo0D,MAAQp0D,KAAK04C,YAEhC14C,KAAKyyD,KAAKzsC,EAAIhmB,KAAK04C,WAC5B,CAOA,KAAA7c,CAAM68B,EAAQC,EAAOC,EAAYd,GAW/B,OAVA93D,KAAK02D,OAAOx0D,KAAK,CACf22D,YAAaH,GAAU/gB,EACvB0b,OAAQsF,GAAShhB,EACjBmhB,SAAUF,EACVd,YAAaA,EACbiB,YAAa,EACbC,SAAU,IAEKh5D,KAAK2mD,YACV3mD,KAAK2mD,WAAWgO,YACrB30D,IACT,CACA,KAAAo2D,GACE,OAAIp2D,KAAK+2D,WACT/2D,KAAKyyD,KAAK,GACVzyD,KAAK+2D,SAAW,GAFU/2D,IAI5B,CACA,OAAA2rD,CAAQA,GAEN,OADA3rD,KAAKk3D,SAAsB,MAAXvL,GAAmB3rD,KAAKk3D,SAAWvL,EAC5C3rD,IACT,CACA,QAAAq1D,CAAS1O,EAAUE,EAAOyO,GASxB,GAPM3O,aAAoB4M,KACxB+B,EAAOzO,EACPA,EAAQF,EACRA,EAAW3mD,KAAK2mD,aAIbA,EACH,MAAMvyC,MAAM,+CAKd,OADAuyC,EAAS0O,SAASr1D,KAAM6mD,EAAOyO,GACxBt1D,IACT,CACA,IAAAi0B,CAAKs6B,GAEH,IAAKvuD,KAAK62D,QAAS,OAAO72D,KAG1BuuD,EAAW,MAANA,EAAa,GAAKA,EACvBvuD,KAAKo0D,OAAS7F,EACd,MAAMxoD,EAAW/F,KAAK+F,WAGhBkzD,EAAUj5D,KAAKk5D,gBAAkBnzD,GAAY/F,KAAKo0D,OAAS,EACjEp0D,KAAKk5D,cAAgBnzD,EAGrB,MAAM2yC,EAAW14C,KAAK04C,WAChBygB,EAAcn5D,KAAK82D,WAAa,GAAK92D,KAAKo0D,MAAQ,EAClDgF,EAAep5D,KAAK82D,UAAYpe,GAAY14C,KAAKo0D,OAAS1b,EAChE14C,KAAK82D,UAAY92D,KAAKo0D,MAClB+E,GACFn5D,KAAK0mD,KAAK,QAAS1mD,MAMrB,MAAMq5D,EAAcr5D,KAAK22D,eACzB32D,KAAKquD,MAAQgL,IAAgBD,GAAgBp5D,KAAKo0D,OAAS1b,EAG3D14C,KAAK+2D,SAAW,EAChB,IAAIuC,EAAY,EAgBhB,OAdIL,GAAWI,KACbr5D,KAAKu5D,YAAYN,GAGjBj5D,KAAKm9C,WAAa,IAAI9oB,GACtBilC,EAAYt5D,KAAKw5D,KAAKH,EAAc9K,EAAKxoD,GACzC/F,KAAK0mD,KAAK,OAAQ1mD,OAIpBA,KAAKquD,KAAOruD,KAAKquD,MAAQiL,GAAaD,EAClCD,GACFp5D,KAAK0mD,KAAK,WAAY1mD,MAEjBA,IACT,CAOA,IAAAyyD,CAAKA,GACH,GAAY,MAARA,EACF,OAAOzyD,KAAKo0D,MAEd,MAAM7F,EAAKkE,EAAOzyD,KAAKo0D,MAEvB,OADAp0D,KAAKi0B,KAAKs6B,GACHvuD,IACT,CACA,QAAA2mD,CAASA,GAEP,YAAwB,IAAbA,EAAiC3mD,KAAKw2D,WACjDx2D,KAAKw2D,UAAY7P,EACV3mD,KACT,CACA,UAAAy1D,GACE,MAAM9O,EAAW3mD,KAAK2mD,WAEtB,OADAA,GAAYA,EAAS8O,WAAWz1D,MACzBA,IACT,CAGA,WAAAu5D,CAAYN,GAEV,GAAKA,GAAYj5D,KAAK22D,eAGtB,IAAK,IAAI/lD,EAAI,EAAGwB,EAAMpS,KAAK02D,OAAOrmD,OAAQO,EAAIwB,IAAOxB,EAAG,CAEtD,MAAMkb,EAAU9rB,KAAK02D,OAAO9lD,GAGtB6oD,EAAUz5D,KAAK22D,iBAAmB7qC,EAAQitC,aAAeE,EAC/DA,GAAWntC,EAAQktC,SAGfS,GAAWR,IACbntC,EAAQ+sC,YAAYt4D,KAAKP,MACzB8rB,EAAQitC,YAAc,EAE1B,CACF,CAGA,gBAAAW,CAAiBC,EAAQC,GAYvB,GAXA55D,KAAK42D,SAAS+C,GAAU,CACtBC,QAASA,EACTC,OAAQ75D,KAAK02D,OAAO12D,KAAK02D,OAAOrmD,OAAS,IASvCrQ,KAAK22D,eAAgB,CACvB,MAAMhQ,EAAW3mD,KAAK2mD,WACtBA,GAAYA,EAASoO,MACvB,CACF,CAIA,IAAAyE,CAAKM,GAEH,IAAIC,EAAc,EAClB,IAAK,IAAInpD,EAAI,EAAGwB,EAAMpS,KAAK02D,OAAOrmD,OAAQO,EAAIwB,IAAOxB,EAAG,CAEtD,MAAMkb,EAAU9rB,KAAK02D,OAAO9lD,GAItB0oD,EAAYxtC,EAAQunC,OAAO9yD,KAAKP,KAAM85D,GAC5ChuC,EAAQktC,SAAWltC,EAAQktC,UAA0B,GAAdM,EACvCS,EAAcA,GAAejuC,EAAQktC,QACvC,CAGA,OAAOe,CACT,CAGA,YAAAC,CAAaL,EAAQ/nD,EAAQqoD,GAC3B,GAAIj6D,KAAK42D,SAAS+C,GAAS,CAEzB,IAAK35D,KAAK42D,SAAS+C,GAAQE,OAAOd,YAAa,CAC7C,MAAMpwC,EAAQ3oB,KAAK02D,OAAOpuC,QAAQtoB,KAAK42D,SAAS+C,GAAQE,QAExD,OADA75D,KAAK02D,OAAOzuC,OAAOU,EAAO,GACnB,CACT,CAII3oB,KAAK42D,SAAS+C,GAAQE,OAAOf,SAC/B94D,KAAK42D,SAAS+C,GAAQE,OAAOf,SAASv4D,KAAKP,KAAM4R,EAAQqoD,GAGzDj6D,KAAK42D,SAAS+C,GAAQC,QAAQ31C,GAAGrS,GAEnC5R,KAAK42D,SAAS+C,GAAQE,OAAOb,SAAW,EACxC,MAAMrS,EAAW3mD,KAAK2mD,WAEtB,OADAA,GAAYA,EAASoO,OACd,CACT,CACA,OAAO,CACT,EAEF0B,GAAOxvD,GAAK,EACZ,MAAMizD,GACJ,WAAA94D,CAAY+7C,EAAa,IAAI9oB,GAAUptB,GAAK,EAAIonD,EAAO,GACrDruD,KAAKm9C,WAAaA,EAClBn9C,KAAKiH,GAAKA,EACVjH,KAAKquD,KAAOA,CACd,CACA,wBAAAwJ,GAA4B,EAE9B3iB,EAAO,CAACuhB,GAAQyD,IAAa,CAC3B,SAAAC,CAAU9G,GACR,OAAO,IAAI6G,GAAW7G,EAAOlW,WAAWxB,UAAU37C,KAAKm9C,YAAakW,EAAOpsD,GAC7E,IAKF,MAAM00C,GAAY,CAACyM,EAAM0B,IAAS1B,EAAKlF,WAAW4G,GAC5CrO,GAAqB4X,GAAUA,EAAOlW,WAW5C,MAAMid,GACJ,WAAAh5D,GACEpB,KAAKw7C,QAAU,GACfx7C,KAAKq6D,IAAM,EACb,CACA,GAAA54D,CAAI4xD,GACF,GAAIrzD,KAAKw7C,QAAQ9zB,SAAS2rC,GAAS,OACnC,MAAMpsD,EAAKosD,EAAOpsD,GAAK,EAGvB,OAFAjH,KAAKw7C,QAAQt5C,KAAKmxD,GAClBrzD,KAAKq6D,IAAIn4D,KAAK+E,GACPjH,IACT,CACA,WAAAs6D,CAAYrzD,GACV,MAAMszD,EAAYv6D,KAAKq6D,IAAI/xC,QAAQrhB,EAAK,IAAM,EAG9C,OAFAjH,KAAKq6D,IAAIpyC,OAAO,EAAGsyC,EAAW,GAC9Bv6D,KAAKw7C,QAAQvzB,OAAO,EAAGsyC,EAAW,IAAIL,IAAc/2D,QAAQonB,GAAKA,EAAEstC,4BAC5D73D,IACT,CACA,IAAAw6D,CAAKvzD,EAAIwzD,GACP,MAAM9xC,EAAQ3oB,KAAKq6D,IAAI/xC,QAAQrhB,EAAK,GAGpC,OAFAjH,KAAKq6D,IAAIpyC,OAAOU,EAAO,EAAG1hB,EAAK,GAC/BjH,KAAKw7C,QAAQvzB,OAAOU,EAAO,EAAG8xC,GACvBz6D,IACT,CACA,OAAA06D,CAAQzzD,GACN,OAAOjH,KAAKw7C,QAAQx7C,KAAKq6D,IAAI/xC,QAAQrhB,EAAK,GAC5C,CACA,MAAAoJ,GACE,OAAOrQ,KAAKq6D,IAAIhqD,MAClB,CACA,KAAAurC,GACE,IAAI+e,EAAa,KACjB,IAAK,IAAI/pD,EAAI,EAAGA,EAAI5Q,KAAKw7C,QAAQnrC,SAAUO,EAAG,CAC5C,MAAMyiD,EAASrzD,KAAKw7C,QAAQ5qC,GAI5B,KAHkB+pD,GAActH,EAAOhF,MAAQsM,EAAWtM,OAEzDgF,EAAOmD,WAAcnD,EAAOmD,UAAU/B,WAAW/sC,SAAS2rC,EAAOpsD,KAAU0zD,EAAWnE,WAAcmE,EAAWnE,UAAU/B,WAAW/sC,SAASizC,EAAW1zD,IASvJ0zD,EAAatH,MARA,CAEbrzD,KAAK6F,OAAOwtD,EAAOpsD,IACnB,MAAMwzD,EAAYpH,EAAO8G,UAAUQ,GACnC36D,KAAKw6D,KAAKG,EAAW1zD,GAAIwzD,GACzBE,EAAaF,IACX7pD,CACJ,CAGF,CACA,OAAO5Q,IACT,CACA,MAAA6F,CAAOoB,GACL,MAAM0hB,EAAQ3oB,KAAKq6D,IAAI/xC,QAAQrhB,EAAK,GAGpC,OAFAjH,KAAKq6D,IAAIpyC,OAAOU,EAAO,GACvB3oB,KAAKw7C,QAAQvzB,OAAOU,EAAO,GACpB3oB,IACT,EAEF2xC,EAAgB,CACdmS,QAAS,CACP,OAAA4T,CAAQhf,EAAUmO,EAAOyO,GACvB,MAAM1iB,EAAI6jB,GAAOc,SAAS7e,EAAUmO,EAAOyO,GACrC3O,EAAW3mD,KAAK2mD,WACtB,OAAO,IAAI8P,GAAO7jB,EAAE8F,UAAUif,KAAK/kB,GAAGvmC,QAAQrM,MAAM2mD,SAASA,EAASoO,QAAQM,SAASziB,EAAEiU,MAAOjU,EAAE0iB,KACpG,EACA,KAAAzO,CAAM+T,EAAItF,GACR,OAAOt1D,KAAK03D,QAAQ,EAAGkD,EAAItF,EAC7B,EAKA,4BAAAuF,CAA6BC,GAC3B96D,KAAKu7C,uBAAuB+e,YAAYQ,EAAc7zD,GACxD,EACA,iBAAA8zD,CAAkBjvC,GAChB,OAAO9rB,KAAKu7C,uBAAuBC,QAIlCtjC,OAAOm7C,GAAUA,EAAOpsD,IAAM6kB,EAAQ7kB,IAAI0N,IAAI8mC,IAAoBC,OAAOC,GAAW,IAAItnB,GAC3F,EACA,UAAA2mC,CAAW3H,GACTrzD,KAAKu7C,uBAAuB95C,IAAI4xD,GAKhCrB,GAASa,gBAAgB7yD,KAAK67C,UAC9B77C,KAAK67C,SAAWmW,GAASU,UAAUrX,GAAgBxlB,KAAK71B,MAC1D,EACA,cAAAg4D,GACuB,MAAjBh4D,KAAK67C,WACP77C,KAAKu7C,wBAAyB,IAAI6e,IAAc34D,IAAI,IAAIy4D,GAAW,IAAI7lC,GAAOr0B,QAElF,KAMJk1C,EAAOuhB,GAAQ,CACb,IAAAxoD,CAAKoc,EAAG5e,GACN,OAAOzL,KAAKi7D,UAAU,OAAQ5wC,EAAG5e,EACnC,EAEA,GAAA4zB,CAAItqB,EAAGtJ,GACL,OAAOzL,KAAKi7D,UAAU,MAAOlmD,EAAGtJ,EAClC,EACA,SAAAwvD,CAAU33D,EAAM43D,EAAa7iC,GAC3B,GAA2B,iBAAhB6iC,EACT,OAAOl7D,KAAKi7D,UAAU33D,EAAM,CAC1B,CAAC43D,GAAc7iC,IAGnB,IAAIkuB,EAAQ2U,EACZ,GAAIl7D,KAAKg6D,aAAa12D,EAAMijD,GAAQ,OAAOvmD,KAC3C,IAAI45D,EAAU,IAAI9e,GAAU96C,KAAKowD,UAAUnsC,GAAGsiC,GAC1C/rB,EAAO95B,OAAO85B,KAAK+rB,GAsCvB,OArCAvmD,KAAK67B,MAAM,WACT+9B,EAAUA,EAAQzrD,KAAKnO,KAAKqM,UAAU/I,GAAMk3B,GAC9C,EAAG,SAAUoD,GAEX,OADA59B,KAAKqM,UAAU/I,GAAMs2D,EAAQlJ,GAAG9yB,GAAKue,WAC9Byd,EAAQvL,MACjB,EAAG,SAAU8M,GAEX,MAAMC,EAAU16D,OAAO85B,KAAK2gC,GACtBE,GA3BWroD,EA2BuBwnB,EAAT4gC,EA3BNljD,OAAO5R,IAAM0M,EAAE0U,SAASphB,KAApC,IAAI0M,EA8BjB,GAAIqoD,EAAYhrD,OAAQ,CAEtB,MAAMirD,EAAiBt7D,KAAKqM,UAAU/I,GAAM+3D,GAGtCE,EAAe,IAAIpL,GAAUyJ,EAAQzrD,QAAQguC,UAGnDz7C,OAAOib,OAAO4/C,EAAcD,GAC5B1B,EAAQzrD,KAAKotD,EACf,CAGA,MAAMC,EAAa,IAAIrL,GAAUyJ,EAAQ31C,MAAMk4B,UAG/Cz7C,OAAOib,OAAO6/C,EAAYL,GAG1BvB,EAAQ31C,GAAGu3C,GAGXhhC,EAAO4gC,EACP7U,EAAQ4U,CACV,GACAn7D,KAAK05D,iBAAiBp2D,EAAMs2D,GACrB55D,IACT,EACA,IAAAuQ,CAAKq1C,EAAOC,GACV,GAAI7lD,KAAKg6D,aAAa,OAAQpU,EAAOC,GAAQ,OAAO7lD,KACpD,IAAI45D,EAAU,IAAI9e,GAAU96C,KAAKowD,UAAUnsC,GAAG,IAAIg0B,GAAU2N,IAW5D,OAVA5lD,KAAK67B,MAAM,WACT+9B,EAAUA,EAAQzrD,KAAKnO,KAAKqM,UAAUkE,OACxC,EAAG,SAAUqtB,GAEX,OADA59B,KAAKqM,UAAUkE,KAAKqpD,EAAQlJ,GAAG9yB,GAAMioB,GAC9B+T,EAAQvL,MACjB,EAAG,SAAUoN,EAAUC,GACrB7V,EAAQ6V,EACR9B,EAAQ31C,GAAGw3C,EACb,GACAz7D,KAAK05D,iBAAiB,OAAQE,GACvB55D,IACT,EAkBA,SAAA0X,CAAUylC,EAAYyF,EAAU+Y,GAG9B,GADA/Y,EAAWzF,EAAWyF,UAAYA,EAC9B5iD,KAAK22D,iBAAmB/T,GAAY5iD,KAAKg6D,aAAa,YAAa7c,GACrE,OAAOn9C,KAIT,MAAM47D,EAAWvnC,GAAOqtB,aAAavE,GACrCwe,EAA8B,MAArBxe,EAAWwe,OAAiBxe,EAAWwe,OAAmB,MAAVA,EAAiBA,GAAUC,EAGpF,MAAMhC,EAAU,IAAI9e,GAAU96C,KAAKowD,UAAU9sD,KAAKq4D,EAAS9K,GAAex8B,IAC1E,IAAIwe,EACAxmC,EACAyf,EACA+vC,EACAC,EA4EJ,OAFA97D,KAAK67B,MAzEL,WAEExvB,EAAUA,GAAWrM,KAAKqM,UAC1BwmC,EAASA,GAAUF,EAAUwK,EAAY9wC,GACzCyvD,EAAiB,IAAIznC,GAAOuuB,OAAWviD,EAAYgM,GAGnDA,EAAQ2uD,WAAWh7D,MAGd4iD,GACHv2C,EAAQwuD,6BAA6B76D,KAEzC,EACA,SAAa49B,GAGNglB,GAAU5iD,KAAK43D,iBACpB,MAAM,EACJtxD,EAAC,EACDE,GACE,IAAIg7C,GAAM3O,GAAQn7B,UAAUrL,EAAQ0uD,kBAAkB/6D,OAC1D,IAAI4R,EAAS,IAAIyiB,GAAO,IACnB8oB,EACHtK,OAAQ,CAACvsC,EAAGE,KAEVgG,EAAQxM,KAAK22D,gBAAkB7qC,EAAUA,EAAUgwC,EACvD,GAAIH,EAAQ,CACV/pD,EAASA,EAAOuxC,UAAU78C,EAAGE,GAC7BgG,EAAQA,EAAM22C,UAAU78C,EAAGE,GAG3B,MAAMu1D,EAAUnqD,EAAOwiB,OACjB4nC,EAAWxvD,EAAM4nB,OAGjB6nC,EAAgB,CAACF,EAAU,IAAKA,EAASA,EAAU,KACnDG,EAAYD,EAActnD,IAAI0V,GAAK5d,KAAK+gB,IAAInD,EAAI2xC,IAChDG,EAAW1vD,KAAKC,OAAOwvD,GACvBvzC,EAAQuzC,EAAU5zC,QAAQ6zC,GAChCvqD,EAAOwiB,OAAS6nC,EAActzC,EAChC,CACIi6B,IAGGgZ,IACHhqD,EAAOwiB,OAAS+oB,EAAW/oB,QAAU,GAEnCp0B,KAAK22D,gBAAkBkF,IACzBrvD,EAAM4nB,OAASynC,IAGnBjC,EAAQzrD,KAAK3B,GACbotD,EAAQ31C,GAAGrS,GACX,MAAMwqD,EAAmBxC,EAAQlJ,GAAG9yB,GAKpC,OAJAi+B,EAAeO,EAAiBhoC,OAChCtI,EAAU,IAAIuI,GAAO+nC,GACrBp8D,KAAKy3D,aAAa3rC,GAClBzf,EAAQ2uD,WAAWh7D,MACZ45D,EAAQvL,MACjB,EACA,SAAkBgO,IAEXA,EAAcxpB,QAAU,UAAU3/B,cAAgBiqC,EAAWtK,QAAU,UAAU3/B,aACpF2/B,EAASF,EAAU0pB,EAAehwD,IAIpC8wC,EAAa,IACRkf,EACHxpB,SAEJ,EACiC,GACjC7yC,KAAK22D,gBAAkB32D,KAAK05D,iBAAiB,YAAaE,GACnD55D,IACT,EAEA,CAAAsG,CAAEA,GACA,OAAOtG,KAAKs8D,aAAa,IAAKh2D,EAChC,EAEA,CAAAE,CAAEA,GACA,OAAOxG,KAAKs8D,aAAa,IAAK91D,EAChC,EACA,EAAAimB,CAAGnmB,GACD,OAAOtG,KAAKs8D,aAAa,KAAMh2D,EACjC,EACA,EAAAi2D,CAAG/1D,GACD,OAAOxG,KAAKs8D,aAAa,KAAM91D,EACjC,EACA,EAAAosB,CAAGtsB,EAAI,GACL,OAAOtG,KAAKw8D,kBAAkB,IAAKl2D,EACrC,EACA,EAAAusB,CAAGrsB,EAAI,GACL,OAAOxG,KAAKw8D,kBAAkB,IAAKh2D,EACrC,EACA,KAAA6jD,CAAM/jD,EAAGE,GACP,OAAOxG,KAAK4yB,GAAGtsB,GAAGusB,GAAGrsB,EACvB,EACA,iBAAAg2D,CAAkB7C,EAAQ11C,GAIxB,GAHAA,EAAK,IAAIg0B,GAAUh0B,GAGfjkB,KAAKg6D,aAAaL,EAAQ11C,GAAK,OAAOjkB,KAG1C,MAAM45D,EAAU,IAAI9e,GAAU96C,KAAKowD,UAAUnsC,GAAGA,GAChD,IAAI9V,EAAO,KAcX,OAbAnO,KAAK67B,MAAM,WACT1tB,EAAOnO,KAAKqM,UAAUstD,KACtBC,EAAQzrD,KAAKA,GACbyrD,EAAQ31C,GAAG9V,EAAO8V,EACpB,EAAG,SAAU2Z,GAEX,OADA59B,KAAKqM,UAAUstD,GAAQC,EAAQlJ,GAAG9yB,IAC3Bg8B,EAAQvL,MACjB,EAAG,SAAUoO,GACX7C,EAAQ31C,GAAG9V,EAAO,IAAI8pC,GAAUwkB,GAClC,GAGAz8D,KAAK05D,iBAAiBC,EAAQC,GACvB55D,IACT,EACA,YAAA08D,CAAa/C,EAAQ11C,GAEnB,GAAIjkB,KAAKg6D,aAAaL,EAAQ11C,GAAK,OAAOjkB,KAG1C,MAAM45D,EAAU,IAAI9e,GAAU96C,KAAKowD,UAAUnsC,GAAGA,GAUhD,OATAjkB,KAAK67B,MAAM,WACT+9B,EAAQzrD,KAAKnO,KAAKqM,UAAUstD,KAC9B,EAAG,SAAU/7B,GAEX,OADA59B,KAAKqM,UAAUstD,GAAQC,EAAQlJ,GAAG9yB,IAC3Bg8B,EAAQvL,MACjB,GAGAruD,KAAK05D,iBAAiBC,EAAQC,GACvB55D,IACT,EACA,YAAAs8D,CAAa3C,EAAQpkD,GACnB,OAAOvV,KAAK08D,aAAa/C,EAAQ,IAAI1hB,GAAU1iC,GACjD,EAEA,EAAAoR,CAAGrgB,GACD,OAAOtG,KAAKs8D,aAAa,KAAMh2D,EACjC,EAEA,EAAAsgB,CAAGpgB,GACD,OAAOxG,KAAKs8D,aAAa,KAAM91D,EACjC,EAEA,IAAA4I,CAAK9I,EAAGE,GACN,OAAOxG,KAAKsG,EAAEA,GAAGE,EAAEA,EACrB,EACA,KAAAm2D,CAAMr2D,EAAGE,GACP,OAAOxG,KAAKysB,GAAGnmB,GAAGi2D,GAAG/1D,EACvB,EAEA,MAAAwxB,CAAO1xB,EAAGE,GACR,OAAOxG,KAAK2mB,GAAGrgB,GAAGsgB,GAAGpgB,EACvB,EAEA,IAAAgH,CAAK3B,EAAOC,GAEV,IAAIoU,EAUJ,OATKrU,GAAUC,IACboU,EAAMlgB,KAAKo4C,SAAS1qC,QAEjB7B,IACHA,EAAQqU,EAAIrU,MAAQqU,EAAIpU,OAASA,GAE9BA,IACHA,EAASoU,EAAIpU,OAASoU,EAAIrU,MAAQA,GAE7B7L,KAAK6L,MAAMA,GAAOC,OAAOA,EAClC,EAEA,KAAAD,CAAMA,GACJ,OAAO7L,KAAKs8D,aAAa,QAASzwD,EACpC,EAEA,MAAAC,CAAOA,GACL,OAAO9L,KAAKs8D,aAAa,SAAUxwD,EACrC,EAEA,IAAA0hD,CAAKnjC,EAAGrX,EAAGrO,EAAG+oC,GAEZ,GAAyB,IAArB5mC,UAAUuJ,OACZ,OAAOrQ,KAAKwtD,KAAK,CAACnjC,EAAGrX,EAAGrO,EAAG+oC,IAE7B,GAAI1tC,KAAKg6D,aAAa,OAAQ3vC,GAAI,OAAOrqB,KACzC,MAAM45D,EAAU,IAAI9e,GAAU96C,KAAKowD,UAAU9sD,KAAKtD,KAAKo4C,SAASkV,YAAYrpC,GAAGoG,GAQ/E,OAPArqB,KAAK67B,MAAM,WACT+9B,EAAQzrD,KAAKnO,KAAKo4C,SAASjG,QAC7B,EAAG,SAAUvU,GAEX,OADA59B,KAAKo4C,SAASoV,KAAKoM,EAAQlJ,GAAG9yB,IACvBg8B,EAAQvL,MACjB,GACAruD,KAAK05D,iBAAiB,OAAQE,GACvB55D,IACT,EAEA,OAAAwO,CAAQ+G,GACN,OAAOvV,KAAKs8D,aAAa,UAAW/mD,EACtC,EAEA,OAAAowC,CAAQr/C,EAAGE,EAAGqF,EAAOC,GACnB,OAAO9L,KAAK08D,aAAa,UAAW,IAAIzX,GAAI3+C,EAAGE,EAAGqF,EAAOC,GAC3D,EACA,MAAAkqB,CAAO4c,GACL,MAAiB,iBAANA,EACF5yC,KAAKg2B,OAAO,CACjBoR,OAAQtgC,UAAU,GAClB9B,MAAO8B,UAAU,GACjBqV,QAASrV,UAAU,MAGN,MAAb8rC,EAAEz2B,SAAiBnc,KAAKiO,KAAK,eAAgB2kC,EAAEz2B,SACpC,MAAXy2B,EAAE5tC,OAAehF,KAAKiO,KAAK,aAAc2kC,EAAE5tC,OAC/B,MAAZ4tC,EAAExL,QAAgBpnC,KAAKiO,KAAK,SAAU2kC,EAAExL,QACrCpnC,KACT,IAEFk1C,EAAOuhB,GAAQ,CACblqC,KACAC,KACAre,OACA8V,OAEFrc,EAAS6uD,GAAQ,UAEjB,MAAMmG,WAAY5Q,GAChB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,MAAOjxC,GAAOmjD,GAC9BvmD,KAAKo3C,WACP,CAGA,IAAAtc,GACE,OAAK96B,KAAK8qD,SACHrW,EAAMz0C,KAAKoD,KAAKs8B,cAAc,UAAY1/B,KAAK2nD,IAAI,IAAIwE,IADnCnsD,KAAKN,OAAOo7B,MAEzC,CACA,MAAAgwB,GACE,OAAQ9qD,KAAKoD,KAAK8L,cAAgBlP,KAAKoD,KAAK8L,sBAAsBqkC,GAAQ9V,OAAOiqB,aAAiD,uBAAlC1nD,KAAKoD,KAAK8L,WAAWylC,QACvH,CAGA,SAAAyC,GACE,OAAKp3C,KAAK8qD,SACH9qD,KAAKiO,KAAK,CACfsuC,MAAOr2C,GACP22D,QAAS,QACR5uD,KAAK,cAAeuuC,GAAOD,IAJHv8C,KAAKN,OAAO03C,WAKzC,CACA,eAAAqQ,GACE,OAAOznD,KAAKiO,KAAK,CACfsuC,MAAO,KACPsgB,QAAS,OACR5uD,KAAK,cAAe,KAAMsuC,IAAOtuC,KAAK,cAAe,KAAMsuC,GAChE,CAIA,IAAA78C,GACE,OAAIM,KAAK8qD,SAAiB9qD,KACnB4tB,MAAMluB,MACf,EAEFiyC,EAAgB,CACdqa,UAAW,CAET8Q,OAAQznB,EAAkB,WACxB,OAAOr1C,KAAK2nD,IAAI,IAAIiV,GACtB,MAGJh1D,EAASg1D,GAAK,MAAO,GAErB,MAAMG,WAAe/Q,GAEnB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,SAAUjxC,GAAOmjD,EACnC,EAEF5U,EAAgB,CACdqa,UAAW,CACTgR,OAAQ3nB,EAAkB,WACxB,OAAOr1C,KAAK2nD,IAAI,IAAIoV,GACtB,MAGJn1D,EAASm1D,GAAQ,UA0EjB,IAAIE,GAAW,CACb3gB,UAAW,KACXqgB,MAZF,SAAer2D,EAAGE,GAChB,OAAOxG,KAAKysB,GAAGnmB,GAAGi2D,GAAG/1D,EACvB,EAWEimB,GAnBF,SAAYnmB,GACV,OAAOtG,KAAKiO,KAAK,IAAK3H,EACxB,EAkBEi2D,GAjBF,SAAY/1D,GACV,OAAOxG,KAAKiO,KAAK,IAAKzH,EACxB,EAgBE0Y,MAVF,SAAeA,GAEb,OADAlf,KAAKk9D,SAAWh+C,EACTlf,IACT,EAQEg4B,OAzBF,SAAgB1xB,EAAGE,EAAG0Z,EAAMlgB,KAAK0N,QAC/B,OAAO1N,KAAK2mB,GAAGrgB,EAAG4Z,GAAK0G,GAAGpgB,EAAG0Z,EAC/B,EAwBEyG,GAxCF,SAAYrgB,EAAG4Z,EAAMlgB,KAAK0N,QACxB,OAAS,MAALpH,EACK4Z,EAAIyG,GAEN3mB,KAAKiO,KAAK,IAAKjO,KAAKiO,KAAK,KAAO3H,EAAI4Z,EAAIyG,GACjD,EAoCEC,GAjCF,SAAYpgB,EAAG0Z,EAAMlgB,KAAK0N,QACxB,OAAS,MAALlH,EACK0Z,EAAI0G,GAEN5mB,KAAKiO,KAAK,IAAKjO,KAAKiO,KAAK,KAAOzH,EAAI0Z,EAAI0G,GACjD,EA6BEvW,OApEF,WACE,OAAOrQ,KAAKoD,KAAK+5D,uBACnB,EAmEE/tD,KAhDF,SAAgB9I,EAAGE,EAAG0Z,EAAMlgB,KAAK0N,QAC/B,OAAO1N,KAAKsG,EAAEA,EAAG4Z,GAAK1Z,EAAEA,EAAG0Z,EAC7B,EA+CEk9C,MAlFF,SAAehwD,GAQb,OANoB,GAAhBpN,KAAKk9D,QACPl9D,KAAKkD,QAIPlD,KAAKoD,KAAKN,YAAYywC,GAAQ9wC,SAAS46D,eAAejwD,IAC/CpN,IACT,EA0EEsG,EAhEF,SAAaA,EAAG4Z,EAAMlgB,KAAK0N,QACzB,OAAS,MAALpH,EACK4Z,EAAI5Z,EAENtG,KAAKiO,KAAK,IAAKjO,KAAKiO,KAAK,KAAO3H,EAAI4Z,EAAI5Z,EACjD,EA4DEE,EAzDF,SAAaA,EAAG0Z,EAAMlgB,KAAK0N,QACzB,OAAS,MAALlH,EACK0Z,EAAI1Z,EAENxG,KAAKiO,KAAK,IAAKjO,KAAKiO,KAAK,KAAOzH,EAAI0Z,EAAI1Z,EACjD,GAuDA,MAAM82D,WAAalR,GAEjB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,GAC/BvmD,KAAKmqD,IAAI37C,QAAUxO,KAAKmqD,IAAI37C,SAAW,IAAIypC,GAAU,KACrDj4C,KAAKu9D,SAAW,EAChBv9D,KAAKk9D,OAAS,CAChB,CAGA,OAAA1uD,CAAQ+G,GAEN,OAAa,MAATA,EACKvV,KAAKmqD,IAAI37C,SAIlBxO,KAAKmqD,IAAI37C,QAAU,IAAIypC,GAAU1iC,GAC1BvV,KAAKkqD,UACd,CAGA,OAAAA,CAAQA,GAON,GALuB,kBAAZA,IACTlqD,KAAKu9D,SAAWrT,GAIdlqD,KAAKu9D,SAAU,CACjB,MAAMn9B,EAAOpgC,KACb,IAAIw9D,EAAkB,EACtB,MAAMhvD,EAAUxO,KAAKmqD,IAAI37C,QACzBxO,KAAKomD,KAAK,SAAUx1C,GAClB,GAAImrC,GAAc/7C,KAAKoD,MAAO,OAC9B,MAAM0B,EAAWyuC,GAAQ9V,OAAOggC,iBAAiBz9D,KAAKoD,MAAM06C,iBAAiB,aACvEjrB,EAAKrkB,EAAU,IAAIypC,GAAUnzC,GAC/B9E,KAAKmqD,IAAIuT,WACX19D,KAAKiO,KAAK,IAAKmyB,EAAKnyB,KAAK,MACL,OAAhBjO,KAAKoN,OACPowD,GAAmB3qC,GAEnB7yB,KAAKiO,KAAK,KAAM2C,EAAIiiB,EAAK2qC,EAAkB,GAC3CA,EAAkB,GAGxB,GACAx9D,KAAK0mD,KAAK,UACZ,CACA,OAAO1mD,IACT,CAGA,OAAAoqD,CAAQxX,GAGN,OAFA5yC,KAAKmqD,IAAMvX,EACX5yC,KAAKmqD,IAAI37C,QAAU,IAAIypC,GAAUrF,EAAEpkC,SAAW,KACvCxO,IACT,CACA,cAAAg8C,GAIE,OAHAA,GAAeh8C,KAAMA,KAAKmqD,IAAK,CAC7B37C,QAAS,MAEJxO,IACT,CAGA,IAAAoN,CAAKA,GAEH,QAAa/M,IAAT+M,EAAoB,CACtB,MAAM+Z,EAAWnnB,KAAKoD,KAAKgL,WAC3B,IAAIuvD,EAAY,EAChBvwD,EAAO,GACP,IAAK,IAAIwD,EAAI,EAAGwB,EAAM+U,EAAS9W,OAAQO,EAAIwB,IAAOxB,EAEnB,aAAzBuW,EAASvW,GAAG+jC,UAA2BoH,GAAc50B,EAASvW,IACtD,IAANA,IAAS+sD,EAAY/sD,EAAI,IAK3BA,IAAM+sD,GAAsC,IAAzBx2C,EAASvW,GAAGtC,UAAsD,GAApCmmC,EAAMttB,EAASvW,IAAIu5C,IAAIuT,WAC1EtwD,GAAQ,MAIVA,GAAQ+Z,EAASvW,GAAGlN,aAEtB,OAAO0J,CACT,CAIA,GADApN,KAAKkD,QAAQgc,MAAM,GACC,mBAAT9R,EAETA,EAAK7M,KAAKP,KAAMA,WAMhB,IAAK,IAAIguC,EAAI,EAAG2hB,GAHhBviD,GAAQA,EAAO,IAAIumB,MAAM,OAGCtjB,OAAQ29B,EAAI2hB,EAAI3hB,IACxChuC,KAAK49D,QAAQxwD,EAAK4gC,IAKtB,OAAOhuC,KAAKkf,MAAM,GAAOgrC,SAC3B,EAEFhV,EAAOooB,GAAML,IACbtrB,EAAgB,CACdqa,UAAW,CAET5+C,KAAMioC,EAAkB,SAAUjoC,EAAO,IACvC,OAAOpN,KAAK2nD,IAAI,IAAI2V,IAAQlwD,KAAKA,EACnC,GAEAgwD,MAAO/nB,EAAkB,SAAUjoC,EAAO,IACxC,OAAOpN,KAAK2nD,IAAI,IAAI2V,IAAQF,MAAMhwD,EACpC,MAGJxF,EAAS01D,GAAM,QAEf,MAAMO,WAAczR,GAElB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,QAASjxC,GAAOmjD,GAChCvmD,KAAKk9D,OAAS,CAChB,CAGA,EAAAtqC,CAAGA,GACD,OAAO5yB,KAAKiO,KAAK,KAAM2kB,EACzB,CAGA,EAAAC,CAAGA,GACD,OAAO7yB,KAAKiO,KAAK,KAAM4kB,EACzB,CAGA,OAAA+qC,GAEE59D,KAAKmqD,IAAIuT,SAAW,EAGpB,MAAMtwD,EAAOpN,KAAKiP,SAGlB,KAAM7B,aAAgBkwD,IACpB,OAAOt9D,KAET,MAAM4Q,EAAIxD,EAAKub,MAAM3oB,MACf8E,EAAWyuC,GAAQ9V,OAAOggC,iBAAiBz9D,KAAKoD,MAAM06C,iBAAiB,aACvEjrB,EAAKzlB,EAAK+8C,IAAI37C,QAAU,IAAIypC,GAAUnzC,GAG5C,OAAO9E,KAAK6yB,GAAGjiB,EAAIiiB,EAAK,GAAG5kB,KAAK,IAAKb,EAAK9G,IAC5C,CAGA,IAAA8G,CAAKA,GACH,OAAY,MAARA,EAAqBpN,KAAKoD,KAAKM,aAAe1D,KAAKmqD,IAAIuT,SAAW,KAAO,KACzD,mBAATtwD,GACTpN,KAAKkD,QAAQgc,MAAM,GACnB9R,EAAK7M,KAAKP,KAAMA,MAChBA,KAAKkf,MAAM,IAEXlf,KAAKo9D,MAAMhwD,GAENpN,KACT,EAEFk1C,EAAO2oB,GAAOZ,IACdtrB,EAAgB,CACdksB,MAAO,CACL9vD,MAAOsnC,EAAkB,SAAUjoC,EAAO,IACxC,MAAMW,EAAQ,IAAI8vD,GAQlB,OALK79D,KAAKk9D,QACRl9D,KAAKkD,QAIAlD,KAAK2nD,IAAI55C,GAAOX,KAAKA,EAC9B,IAEFkwD,KAAM,CACJM,QAAS,SAAUxwD,EAAO,IACxB,OAAOpN,KAAK+N,MAAMX,GAAMwwD,SAC1B,KAGJh2D,EAASi2D,GAAO,SAEhB,MAAMC,WAAe1R,GACnB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,SAAUjxC,GAAOmjD,EACnC,CACA,MAAA9tC,CAAO8R,GACL,OAAOvqB,KAAKiO,KAAK,IAAKsc,EACxB,CAGA,EAAAgC,CAAGA,GACD,OAAOvsB,KAAKiO,KAAK,IAAKse,EACxB,CAGA,EAAAC,CAAGA,GACD,OAAOxsB,KAAKusB,GAAGC,EACjB,CACA,IAAAhf,CAAKA,GACH,OAAOxN,KAAKyY,OAAO,IAAIw/B,GAAUzqC,GAAM0qC,OAAO,GAChD,EAEFhD,EAAO4oB,GAAQ,CACbx3D,EAAGsxC,EACHpxC,EAAGqxC,EACHlxB,GAAImxB,EACJlxB,GAAImxB,EACJlsC,MAAOmsC,EACPlsC,OAAQqsC,IAEVxG,EAAgB,CACdqa,UAAW,CAETrzC,OAAQ08B,EAAkB,SAAU7nC,EAAO,GACzC,OAAOxN,KAAK2nD,IAAI,IAAImW,IAAUtwD,KAAKA,GAAM4B,KAAK,EAAG,EACnD,MAGJxH,EAASk2D,GAAQ,UAEjB,MAAMC,WAAiB/R,GACrB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,WAAYjxC,GAAOmjD,EACrC,CAGA,MAAA1gD,GAOE,OALA7F,KAAKwsD,UAAUrpD,QAAQ,SAAUe,GAC/BA,EAAG85D,QACL,GAGOpwC,MAAM/nB,QACf,CACA,OAAA2mD,GACE,OAAOlW,EAAS,mBAAqBt2C,KAAKiH,KAAO,IACnD,EAEF0qC,EAAgB,CACdqa,UAAW,CAETiS,KAAM5oB,EAAkB,WACtB,OAAOr1C,KAAK86B,OAAO6sB,IAAI,IAAIoW,GAC7B,IAEFja,QAAS,CAEP,OAAAoa,GACE,OAAOl+D,KAAKk9C,UAAU,YACxB,EACA,QAAAihB,CAAS9xD,GAEP,MAAM6xD,EAAU7xD,aAAmB0xD,GAAW1xD,EAAUrM,KAAKiP,SAASgvD,OAAOx8D,IAAI4K,GAGjF,OAAOrM,KAAKiO,KAAK,YAAa,QAAUiwD,EAAQj3D,KAAO,IACzD,EAEA,MAAA+2D,GACE,OAAOh+D,KAAKiO,KAAK,YAAa,KAChC,KAGJrG,EAASm2D,GAAU,YAEnB,MAAMK,WAAsBta,GAC1B,WAAA1iD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,gBAAiBjxC,GAAOmjD,EAC1C,EAEF5U,EAAgB,CACdqa,UAAW,CACTqS,cAAehpB,EAAkB,SAAUxpC,EAAOC,GAChD,OAAO9L,KAAK2nD,IAAI,IAAIyW,IAAiB5wD,KAAK3B,EAAOC,EACnD,MAGJlE,EAASw2D,GAAe,iBAsExB,IAAIE,GAAoB,CACtBhiB,UAAW,KACX+N,MAtEF,SAAez3B,EAAIC,GA4BjB,OA3BA7yB,KAAKmnB,WAAWhkB,QAAQkL,IACtB,IAAIX,EAIJ,IAOEA,EAAOW,EAAMjL,gBAAgBuwC,IAAYxC,cAAgB,IAAI8T,GAAI52C,EAAMJ,KAAK,CAAC,IAAK,IAAK,QAAS,YAAcI,EAAMX,MACtH,CAAE,MAAO1J,GACP,MACF,CAGA,MAAMoZ,EAAI,IAAIiX,GAAOhmB,GAGfkmB,EAASnX,EAAEqX,UAAU7B,EAAIC,GAAInb,UAAU0F,EAAE4mC,WAEzCh+B,EAAI,IAAIw7B,GAAM9zC,EAAKpH,EAAGoH,EAAKlH,GAAGkR,UAAU6c,GAE9ClmB,EAAMe,KAAK4W,EAAE1f,EAAG0f,EAAExf,KAEbxG,IACT,EA0CE4yB,GAzCF,SAAYA,GACV,OAAO5yB,KAAKqqD,MAAMz3B,EAAI,EACxB,EAwCEC,GAvCF,SAAYA,GACV,OAAO7yB,KAAKqqD,MAAM,EAAGx3B,EACvB,EAsCE/mB,OArCF,SAAgBA,EAAQoU,EAAMlgB,KAAK0N,QACjC,OAAc,MAAV5B,EAAuBoU,EAAIpU,OACxB9L,KAAKwN,KAAK0S,EAAIrU,MAAOC,EAAQoU,EACtC,EAmCE9Q,KAlCF,SAAc9I,EAAI,EAAGE,EAAI,EAAG0Z,EAAMlgB,KAAK0N,QACrC,MAAMklB,EAAKtsB,EAAI4Z,EAAI5Z,EACbusB,EAAKrsB,EAAI0Z,EAAI1Z,EACnB,OAAOxG,KAAKqqD,MAAMz3B,EAAIC,EACxB,EA+BErlB,KA9BF,SAAc3B,EAAOC,EAAQoU,EAAMlgB,KAAK0N,QACtC,MAAMsY,EAAI0sB,EAAiB1yC,KAAM6L,EAAOC,EAAQoU,GAC1CgiC,EAASl8B,EAAEna,MAAQqU,EAAIrU,MACvBs2C,EAASn8B,EAAEla,OAASoU,EAAIpU,OAK9B,OAJA9L,KAAKmnB,WAAWhkB,QAAQkL,IACtB,MAAMukC,EAAI,IAAI4O,GAAMthC,GAAKxI,UAAU,IAAI2c,GAAOhmB,GAAO21C,WACrD31C,EAAMmmB,MAAM0tB,EAAQC,EAAQvP,EAAEtsC,EAAGssC,EAAEpsC,KAE9BxG,IACT,EAsBE6L,MArBF,SAAeA,EAAOqU,EAAMlgB,KAAK0N,QAC/B,OAAa,MAAT7B,EAAsBqU,EAAIrU,MACvB7L,KAAKwN,KAAK3B,EAAOqU,EAAIpU,OAAQoU,EACtC,EAmBE5Z,EAlBF,SAAWA,EAAG4Z,EAAMlgB,KAAK0N,QACvB,OAAS,MAALpH,EAAkB4Z,EAAI5Z,EACnBtG,KAAKoP,KAAK9I,EAAG4Z,EAAI1Z,EAAG0Z,EAC7B,EAgBE1Z,EAfF,SAAWA,EAAG0Z,EAAMlgB,KAAK0N,QACvB,OAAS,MAALlH,EAAkB0Z,EAAI1Z,EACnBxG,KAAKoP,KAAK8Q,EAAI5Z,EAAGE,EAAG0Z,EAC7B,GAeA,MAAMq+C,WAAUvS,GACd,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,IAAKjxC,GAAOmjD,EAC9B,EAEFrR,EAAOqpB,GAAGD,IACV3sB,EAAgB,CACdqa,UAAW,CAETn1C,MAAOw+B,EAAkB,WACvB,OAAOr1C,KAAK2nD,IAAI,IAAI4W,GACtB,MAGJ32D,EAAS22D,GAAG,KAEZ,MAAM/O,WAAUxD,GACd,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,IAAKjxC,GAAOmjD,EAC9B,CAGA,MAAA30C,CAAOA,GACL,OAAO5R,KAAKiO,KAAK,SAAU2D,EAC7B,CAGA,EAAAqS,CAAGwoC,GACD,OAAOzsD,KAAKiO,KAAK,OAAQw+C,EAAKjQ,GAChC,EAEFtH,EAAOsa,GAAG8O,IACV3sB,EAAgB,CACdqa,UAAW,CAETj1B,KAAMse,EAAkB,SAAUoX,GAChC,OAAOzsD,KAAK2nD,IAAI,IAAI6H,IAAKvrC,GAAGwoC,EAC9B,IAEF3I,QAAS,CACP,MAAA0a,GACE,MAAMznC,EAAO/2B,KAAKy+D,SAClB,IAAK1nC,EAAM,OAAO/2B,KAClB,MAAMiP,EAAS8nB,EAAK9nB,SACpB,IAAKA,EACH,OAAOjP,KAAK6F,SAEd,MAAM8iB,EAAQ1Z,EAAO0Z,MAAMoO,GAG3B,OAFA9nB,EAAOxN,IAAIzB,KAAM2oB,GACjBoO,EAAKlxB,SACE7F,IACT,EACA,MAAA0+D,CAAOjS,GAEL,IAAI11B,EAAO/2B,KAAKy+D,SAUhB,OATK1nC,IACHA,EAAO,IAAIy4B,GACXxvD,KAAKqpD,KAAKtyB,IAEO,mBAAR01B,EACTA,EAAIlsD,KAAKw2B,EAAMA,GAEfA,EAAK9S,GAAGwoC,GAEHzsD,IACT,EACA,MAAAy+D,GACE,MAAM1nC,EAAO/2B,KAAKiP,SAClB,OAAI8nB,GAA6C,MAArCA,EAAK3zB,KAAKuxC,SAAShrB,cACtBoN,EAEF,IACT,KAGJnvB,EAAS4nD,GAAG,KAEZ,MAAMmP,WAAa3S,GAEjB,WAAA5qD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,EACjC,CAGA,MAAA1gD,GAOE,OALA7F,KAAKwsD,UAAUrpD,QAAQ,SAAUe,GAC/BA,EAAG06D,QACL,GAGOhxC,MAAM/nB,QACf,CACA,OAAA2mD,GACE,OAAOlW,EAAS,cAAgBt2C,KAAKiH,KAAO,IAC9C,EAEF0qC,EAAgB,CACdqa,UAAW,CACT33C,KAAMghC,EAAkB,WACtB,OAAOr1C,KAAK86B,OAAO6sB,IAAI,IAAIgX,GAC7B,IAEF7a,QAAS,CAEP,MAAA+a,GACE,OAAO7+D,KAAKk9C,UAAU,OACxB,EACA,QAAA4hB,CAASzyD,GAEP,MAAMwyD,EAASxyD,aAAmBsyD,GAAOtyD,EAAUrM,KAAKiP,SAASoF,OAAO5S,IAAI4K,GAG5E,OAAOrM,KAAKiO,KAAK,OAAQ,QAAU4wD,EAAO53D,KAAO,IACnD,EAEA,MAAA23D,GACE,OAAO5+D,KAAKiO,KAAK,OAAQ,KAC3B,KAGJrG,EAAS+2D,GAAM,QAEf,MAAMI,WAAajb,GACjB,WAAA1iD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,OAAQjxC,GAAOmjD,EACjC,CAGA,MAAAvwB,CAAO4c,GAaL,OAZiB,iBAANA,GAAkBA,aAAaqF,MACxCrF,EAAI,CACFxL,OAAQtgC,UAAU,GAClB9B,MAAO8B,UAAU,GACjBqV,QAASrV,UAAU,KAKN,MAAb8rC,EAAEz2B,SAAiBnc,KAAKiO,KAAK,eAAgB2kC,EAAEz2B,SACpC,MAAXy2B,EAAE5tC,OAAehF,KAAKiO,KAAK,aAAc2kC,EAAE5tC,OAC/B,MAAZ4tC,EAAExL,QAAgBpnC,KAAKiO,KAAK,SAAU,IAAIgqC,GAAUrF,EAAExL,SACnDpnC,IACT,EAEF2xC,EAAgB,CACd4a,SAAU,CAERxuB,KAAM,SAAUqJ,EAAQpiC,EAAOmX,GAC7B,OAAOnc,KAAK2nD,IAAI,IAAIoX,IAAQ/oC,OAAOoR,EAAQpiC,EAAOmX,EACpD,KAGJvU,EAASm3D,GAAM,QAYf,MAAMC,WAAclb,GAClB,WAAA1iD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,QAASjxC,GAAOmjD,EAClC,CACA,OAAA0Y,CAAQvhD,EAAI,IAEV,OADA1d,KAAKoD,KAAKM,aAAega,EAClB1d,IACT,CACA,IAAAuN,CAAK9M,EAAMusC,EAAKpjB,EAAS,CAAC,GACxB,OAAO5pB,KAAKk/D,KAAK,aAAc,CAC7Bt6D,WAAYnE,EACZusC,IAAKA,KACFpjB,GAEP,CACA,IAAAs1C,CAAK5W,EAAU9nD,GACb,OAAOR,KAAKi/D,QA1BhB,SAAiB3W,EAAU4W,GACzB,IAAK5W,EAAU,MAAO,GACtB,IAAK4W,EAAM,OAAO5W,EAClB,IAAI1K,EAAM0K,EAAW,IACrB,IAAK,MAAM13C,KAAKsuD,EACdthB,GAAOrL,EAAY3hC,GAAK,IAAMsuD,EAAKtuD,GAAK,IAG1C,OADAgtC,GAAO,IACAA,CACT,CAiBwBuhB,CAAQ7W,EAAU9nD,GACxC,EAEFmxC,EAAgB,MAAO,CACrB,KAAAvtC,CAAMkkD,EAAU9nD,GACd,OAAOR,KAAK2nD,IAAI,IAAIqX,IAASE,KAAK5W,EAAU9nD,EAC9C,EACA,QAAA4+D,CAAS3+D,EAAMusC,EAAKpjB,GAClB,OAAO5pB,KAAK2nD,IAAI,IAAIqX,IAASzxD,KAAK9M,EAAMusC,EAAKpjB,EAC/C,IAEFhiB,EAASo3D,GAAO,SAEhB,MAAMK,WAAiB/B,GAErB,WAAAl8D,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,WAAYjxC,GAAOmjD,EACrC,CAGA,KAAApU,GACE,MAAMmtB,EAAQt/D,KAAKs/D,QACnB,OAAOA,EAAQA,EAAMntB,QAAU,IACjC,CAGA,IAAAqb,CAAK9f,GACH,MAAM4xB,EAAQt/D,KAAKs/D,QACnB,IAAIC,EAAY,KAIhB,OAHID,IACFC,EAAYD,EAAM9R,KAAK9f,IAEb,MAALA,EAAY6xB,EAAYv/D,IACjC,CAGA,KAAAs/D,GACE,OAAOt/D,KAAKk9C,UAAU,OACxB,EAEFvL,EAAgB,CACdqa,UAAW,CACTwT,SAAUnqB,EAAkB,SAAUjoC,EAAMiU,GAK1C,OAHMjU,aAAgBkwD,KACpBlwD,EAAOpN,KAAKoN,KAAKA,IAEZA,EAAKiU,KAAKA,EACnB,IAEFi8C,KAAM,CAEJj8C,KAAMg0B,EAAkB,SAAUiqB,EAAOG,EAAc,GACrD,MAAMD,EAAW,IAAIH,GAYrB,IAAIj8D,EACJ,GAVMk8D,aAAiBz2D,KAErBy2D,EAAQt/D,KAAK86B,OAAOzZ,KAAKi+C,IAI3BE,EAASvxD,KAAK,OAAQ,IAAMqxD,EAAO9iB,IAI/BijB,EACF,KAAOr8D,EAAOpD,KAAKoD,KAAK+wC,YACtBqrB,EAASp8D,KAAKN,YAAYM,GAK9B,OAAOpD,KAAK2nD,IAAI6X,EAClB,GAEA,QAAAA,GACE,OAAOx/D,KAAK+6B,QAAQ,WACtB,GAEFlyB,KAAM,CAEJuE,KAAMioC,EAAkB,SAAUjoC,GAOhC,OALMA,aAAgBkwD,KACpBlwD,GAAO,IAAIkwD,IAAOzuC,MAAM7uB,KAAKiP,UAAU7B,KAAKA,IAIvCA,EAAKiU,KAAKrhB,KACnB,GACA,OAAAwsD,GACE,OAAOlW,EAAS,gBAAgBp+B,OAAO9U,IAC7BA,EAAK6K,KAAK,SAAW,IAAIyZ,SAAS1nB,KAAKiH,MAKnD,KAGJo4D,GAAS1+D,UAAU2sD,WAAauC,GAChCjoD,EAASy3D,GAAU,YAEnB,MAAMK,WAAYtT,GAChB,WAAAhrD,CAAYgC,EAAMmjD,EAAQnjD,GACxBwqB,MAAMymB,EAAU,MAAOjxC,GAAOmjD,EAChC,CAGA,GAAAoZ,CAAItzD,EAASuzD,GAEX,OAAO5/D,KAAKiO,KAAK,QAAS2xD,GAAQ,IAAM,IAAMvzD,EAASmwC,GACzD,EAEF7K,EAAgB,CACdqa,UAAW,CAET2T,IAAKtqB,EAAkB,SAAUhpC,EAASuzD,GACxC,OAAO5/D,KAAK2nD,IAAI,IAAI+X,IAAOC,IAAItzD,EAASuzD,EAC1C,MAGJh4D,EAAS83D,GAAK,OAGd,MAAM32D,GAAMgrC,EACZmB,EAAO,CAAC0nB,GAAKG,GAAQnQ,GAAOD,GAASc,IAASzb,EAAc,YAC5DkD,EAAO,CAACqY,GAAMmE,GAAUF,GAAS3oD,IAAOmpC,EAAc,WACtDkD,EAAOooB,GAAMtrB,EAAc,SAC3BkD,EAAOrsC,GAAMmpC,EAAc,SAC3BkD,EAAOiX,GAAMna,EAAc,SAC3BkD,EAAO,CAACooB,GAAMO,IAAQ7rB,EAAc,UACpCkD,EAAO,CAAC0c,GAAMtlC,GAASigC,GAAUkK,IAASzkB,EAAc,WACxDkD,EAAOsR,GAAaxU,EAAc,gBAClCkD,EAAOsS,GAAKxV,EAAc,QAC1BkD,EAAO4O,GAAS9R,EAAc,YAC9BkD,EAAOkX,GAAOpa,EAAc,UAC5BkD,EAAO,CAAC8W,GAAWpX,IAAW5C,EAAc,cAC5CkD,EAAOqX,GAAUva,EAAc,aAC/BkD,EAAOuhB,GAAQzkB,EAAc,WAC7BwE,GAAKtB,OAjoNI,IAAI,IAAI7zC,IAAI6wC,MAkoNrByI,GAAsB,CAAC1C,GAAWoG,GAAO4G,GAAK5wB,GAAQyyB,GAAUiG,GAAY8C,GAAWrO,KACvF3G,KAEAj7C,EAAQ4vD,EAAIA,GACZ5vD,EAAQoyD,SAAWA,GACnBpyD,EAAQsO,MAAQ44C,GAChBlnD,EAAQqlD,IAAMA,GACdrlD,EAAQk+D,OAASA,GACjBl+D,EAAQm+D,SAAWA,GACnBn+D,EAAQy+C,MAAQA,GAChBz+C,EAAQosD,UAAYA,GACpBpsD,EAAQsvB,WAAaA,GACrBtvB,EAAQusD,KAAOA,GACfvsD,EAAQ4nD,IAAMA,GACd5nD,EAAQ0uD,KAAOA,GACf1uD,EAAQkkD,QAAUA,GAClBlkD,EAAQ0sB,QAAUA,GAClB1sB,EAAQ4mD,YAAcA,GACtB5mD,EAAQw+D,cAAgBA,GACxBx+D,EAAQg1C,SAAWA,GACnBh1C,EAAQ2+D,EAAIA,GACZ3+D,EAAQ2sD,SAAWA,GACnB3sD,EAAQgtD,MAAQA,GAChBhtD,EAAQ2tD,KAAOA,GACf3tD,EAAQ42C,KAAOA,GACf52C,EAAQ6tD,OAASA,GACjB7tD,EAAQ++D,KAAOA,GACf/+D,EAAQy0B,OAASA,GACjBz0B,EAAQk7C,UAAYA,GACpBl7C,EAAQswD,aAAeA,GACvBtwD,EAAQ+T,OAASskC,GACjBr4C,EAAQuwD,UAAYA,GACpBvwD,EAAQ+uD,IAAMA,GACd/uD,EAAQiJ,KAAOA,GACfjJ,EAAQiwD,UAAYA,GACpBjwD,EAAQ+sD,QAAUA,GAClB/sD,EAAQ4hD,MAAQA,GAChB5hD,EAAQmtD,WAAaA,GACrBntD,EAAQ4xD,QAAUA,GAClB5xD,EAAQ8xD,SAAWA,GACnB9xD,EAAQiyD,MAAQA,GAChBjyD,EAAQgyD,KAAOA,GACfhyD,EAAQ62D,OAASA,GACjB72D,EAAQmJ,IAAMA,GACdnJ,EAAQwsD,MAAQA,GAChBxsD,EAAQ4uD,OAASA,GACjB5uD,EAAQm/D,KAAOA,GACfn/D,EAAQo/D,MAAQA,GAChBp/D,EAAQg9D,IAAMA,GACdh9D,EAAQm9D,OAASA,GACjBn9D,EAAQ09D,KAAOA,GACf19D,EAAQy/D,SAAWA,GACnBz/D,EAAQ2zD,SAAWA,GACnB3zD,EAAQixD,aAAeA,GACvBjxD,EAAQi+D,MAAQA,GAChBj+D,EAAQ8/D,IAAMA,GACd9/D,EAAQ60C,MAAQA,EAChB70C,EAAQq1C,YAAcA,EACtBr1C,EAAQk3C,YAAcA,EACtBl3C,EAAQg0C,OAASA,EACjBh0C,EAAQq8C,SAAWA,GACnBr8C,EAAQy3C,SAAWA,EACnBz3C,EAAQiuD,OAASA,GACjBjuD,EAAQm1C,IAAMA,EACdn1C,EAAQs1C,OAASA,EACjBt1C,EAAQma,KAAOu8B,EACf12C,EAAQk1C,SAAWA,EACnBl1C,EAAQi3C,eAAiBA,EACzBj3C,EAAQ82C,UAAYA,EACpB92C,EAAQ+zC,UAAYA,EACpB/zC,EAAQm0C,aAAeA,EACvBn0C,EAAQi7C,cAAgBA,GACxBj7C,EAAQigE,UA78MR,SAAmBC,EAAOrrB,GACxBP,GAAU4rB,CACZ,EA48MAlgE,EAAQ68C,WAAaA,GACrB78C,EAAQy0C,UAAYA,EACpBz0C,EAAQqS,IAAMA,EACdrS,EAAQoS,GAAKA,EACbpS,EAAQm2C,OAASA,EACjBn2C,EAAQ89C,MAAQA,GAChB99C,EAAQgI,SAAWA,EACnBhI,EAAQ+6C,sBAAwBA,GAChC/6C,EAAQwzC,eAAiBA,EACzBxzC,EAAQ8zC,cAAgBA,EACxB9zC,EAAQF,KAAOA,GACfE,EAAQ4zC,WAAaA,EACrB5zC,EAAQy8C,MAAQA,GAChBz8C,EAAQg3C,aAAeA,GACvBh3C,EAAQmgE,WA9iNR,SAAoB1sB,EAAKhP,GACvBmP,IACAJ,EAAeC,EAAKA,EAAI5wC,UACxB4hC,EAAGgP,EAAKA,EAAI5wC,UACZixC,GACF,EA0iNA9zC,EAAQy1C,kBAAoBA,C,8EC5vN5B,QACA,QACA,QACA,QACA,QACA,OACA,O,GxELIj1C,EAA2B,CAAC,E,OyEAhCH,EAAoBytC,EAAI,CAAC9tC,EAASogE,KACjC,IAAI,IAAIzuD,KAAOyuD,EACX//D,EAAoB2yC,EAAEotB,EAAYzuD,KAAStR,EAAoB2yC,EAAEhzC,EAAS2R,IAC5E7Q,OAAO8K,eAAe5L,EAAS2R,EAAK,CAAE0uD,WAAY,EAAMh+D,IAAK+9D,EAAWzuD,MCJ3EtR,EAAoB2yC,EAAI,CAACpyC,EAAK0/D,IAAUx/D,OAAOC,UAAUC,eAAeL,KAAKC,EAAK0/D,GCClFjgE,EAAoBsqB,EAAK3qB,IACH,oBAAXm9D,QAA0BA,OAAOoD,aAC1Cz/D,OAAO8K,eAAe5L,EAASm9D,OAAOoD,YAAa,CAAE5qD,MAAO,WAE7D7U,OAAO8K,eAAe5L,EAAS,aAAc,CAAE2V,MAAO,KCF7BtV,EAAoB,M","sources":["webpack://Kabel/webpack/universalModuleDefinition","webpack://Kabel/webpack/bootstrap","webpack://Kabel/./util/has-prop.ts","webpack://Kabel/./renderers/atlas/atlas.ts","webpack://Kabel/./util/user-state.ts","webpack://Kabel/./src/flyout.ts","webpack://Kabel/./src/core.ts","webpack://Kabel/./themes/default.ts","webpack://Kabel/./events/comment-input.ts","webpack://Kabel/./util/uid.ts","webpack://Kabel/./util/escape-html.ts","webpack://Kabel/./src/comment.ts","webpack://Kabel/./comment-renderer/renderer.ts","webpack://Kabel/./renderers/apollo/apollo.ts","webpack://Kabel/./renderers/renderer.ts","webpack://Kabel/./node_modules/svgpath/lib/path_parse.js","webpack://Kabel/./themes/themes.ts","webpack://Kabel/./util/unescape-html.ts","webpack://Kabel/./src/widget.ts","webpack://Kabel/./src/undo-redo.ts","webpack://Kabel/./src/inject-headless.ts","webpack://Kabel/./node_modules/svgpath/lib/ellipse.js","webpack://Kabel/./src/workspace-coords.ts","webpack://Kabel/./src/workspace-svg.ts","webpack://Kabel/./util/parse-color.ts","webpack://Kabel/./util/path.ts","webpack://Kabel/./node_modules/svgpath/lib/transform_parse.js","webpack://Kabel/./controllers/wasd.ts","webpack://Kabel/./src/fonts-manager.ts","webpack://Kabel/./events/connection-line.ts","webpack://Kabel/./src/field.ts","webpack://Kabel/./src/renderer-map.ts","webpack://Kabel/./src/grid.ts","webpack://Kabel/./events/node-x-btn.ts","webpack://Kabel/./src/colors.ts","webpack://Kabel/./node_modules/svgpath/lib/matrix.js","webpack://Kabel/./controllers/base.ts","webpack://Kabel/./renderers/apollo/renderer.ts","webpack://Kabel/./src/workspace.ts","webpack://Kabel/./util/styler.ts","webpack://Kabel/./src/inject.ts","webpack://Kabel/./src/headless-node.ts","webpack://Kabel/./util/env.ts","webpack://Kabel/./src/nodesvg.ts","webpack://Kabel/./src/ctx-menu-registry.ts","webpack://Kabel/./util/window-listeners.ts","webpack://Kabel/./util/emitter.ts","webpack://Kabel/./src/toolbox.ts","webpack://Kabel/./src/main-workspace.ts","webpack://Kabel/./events/draggable.ts","webpack://Kabel/./util/wait-anim-frames.ts","webpack://Kabel/./src/prototypes.ts","webpack://Kabel/./src/dropdown-menu.ts","webpack://Kabel/./src/widget-prototypes.ts","webpack://Kabel/./events/comment-drag-handle.ts","webpack://Kabel/./util/eventer.ts","webpack://Kabel/./node_modules/svgpath/lib/a2c.js","webpack://Kabel/./node_modules/svgpath/index.js","webpack://Kabel/./src/index.ts","webpack://Kabel/./src/coordinates.ts","webpack://Kabel/./renderers/constants.ts","webpack://Kabel/./node_modules/svgpath/lib/svgpath.js","webpack://Kabel/./src/styles.css","webpack://Kabel/./events/connector.ts","webpack://Kabel/./src/category.ts","webpack://Kabel/./renderers/representer-node.ts","webpack://Kabel/./src/connection.ts","webpack://Kabel/./renderers/apollo/constants.ts","webpack://Kabel/./events/input-box.ts","webpack://Kabel/./renderers/representer.ts","webpack://Kabel/./src/context-menu.ts","webpack://Kabel/./themes/dark.ts","webpack://Kabel/./node_modules/@svgdotjs/svg.js/dist/svg.node.cjs","webpack://Kabel/./events/events.ts","webpack://Kabel/webpack/runtime/define property getters","webpack://Kabel/webpack/runtime/hasOwnProperty shorthand","webpack://Kabel/webpack/runtime/make namespace object","webpack://Kabel/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Kabel\"] = factory();\n\telse\n\t\troot[\"Kabel\"] = factory();\n})(this, () => {\nreturn ","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\r\nexport default function hasProp(obj: object, name: string) {\r\n    return Object.prototype.hasOwnProperty.call(obj, name)\r\n}","import RendererConstants from \"../constants\";\r\nimport Renderer from \"../renderer\";\r\nimport Representer from \"../representer\";\r\nimport { RepresenterNode } from \"../representer-node\";\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n    Renderer,\r\n    RendererConstants as Constants,\r\n    Representer,\r\n    RepresenterNode\r\n}","type StateChangeCallback = (addedOrRemoved: 0 | 1) => void;\r\n\r\nclass UserState {\r\n    private state: Set<string>;\r\n    private callbacks: Map<string, StateChangeCallback[]>;\r\n    /**\r\n     * Stores the user's current UIX state\r\n     * Ex: 'typing'\r\n     */\r\n    constructor() {\r\n        this.state = new Set();\r\n        this.callbacks = new Map();\r\n    }\r\n\r\n    /** \r\n     * Adds a state\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    setState(name: string) {\r\n        const wasPresent = this.state.has(name);\r\n        if (!wasPresent) {\r\n            this.state.add(name);\r\n            this.triggerCallbacks(name, 1);\r\n        }\r\n    }\r\n\r\n    /** \r\n     * Removes a state\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    removeState(name: string) {\r\n        const wasPresent = this.state.has(name);\r\n        if (wasPresent) {\r\n            this.state.delete(name);\r\n            this.triggerCallbacks(name, 0);\r\n        }\r\n    }\r\n\r\n    /** \r\n     * Checks if a state is active\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    hasState(name: string) {\r\n        return this.state.has(name);\r\n    }\r\n\r\n    /** \r\n     * Registers a callback for state changes \r\n     * @param name - Name of the state to check changes for.\r\n     * @param cb - Callback to call on state change.\r\n     */\r\n    onStateChange(name: string, cb: StateChangeCallback) {\r\n        if (!this.callbacks.has(name)) this.callbacks.set(name, []);\r\n        this.callbacks.get(name)!.push(cb);\r\n    }\r\n\r\n    /** Internal: triggers callbacks for a state */\r\n    private triggerCallbacks(name: string, addedOrRemoved: 0 | 1) {\r\n        const cbs = this.callbacks.get(name);\r\n        if (!cbs) return;\r\n        for (const cb of cbs) cb(addedOrRemoved);\r\n    }\r\n}\r\nconst userState = new UserState();\r\nexport default userState;\r\nexport {\r\n    UserState\r\n};","import newHeadlessNode from \"./headless-node\";\r\nimport { TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport { Color } from \"./visual-types\";\r\n\r\n/**\r\n * Represents a flyout menu for a toolbox in Kabel.\r\n * Displays a list of nodes that can be dragged into a workspace.\r\n */\r\nclass Flyout {\r\n\tcontainer: HTMLDivElement;\r\n\tvisible: boolean;\r\n\ttoolbox?: Toolbox|undefined;\r\n\r\n\tconstructor(toolbox?: Toolbox) {\r\n\t\tthis.toolbox = toolbox;\r\n\r\n\t\tthis.container = document.createElement(\"div\");\r\n\t\tthis.container.className = \"KabelFlyout\";\r\n\r\n\t\tthis.visible = false;\r\n\r\n\t\tif (toolbox) {\r\n\t\t\ttoolbox.workspace._wsTop.appendChild(this.container);\r\n\t\t} else {\r\n\t\t\tdocument.body.appendChild(this.container);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Populates the flyout with a list of nodes.\r\n\t */\r\n\tfill(nodes: TblxNodeStruct[]) {\r\n\t\tthis.clear();\r\n\t\tnodes.forEach(node => {\r\n\t\t\tconst headlessNode = newHeadlessNode(node.type as string);\r\n\t\t\tif (!headlessNode) return;\r\n\r\n\t\t\tconst nodeEl = this.createNodeElement(headlessNode);\r\n\t\t\tthis.container.appendChild(nodeEl);\r\n\t\t});\r\n\r\n\t\tthis.show();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a DOM element for a node with event listeners attached.\r\n\t */\r\n\tprivate createNodeElement(headlessNode: any): HTMLDivElement {\r\n\t\tconst nodeEl = document.createElement(\"div\");\r\n\t\tnodeEl.className = \"KabelFlyoutNode\";\r\n\t\tnodeEl.textContent = headlessNode.labelText;\r\n\r\n\t\tthis.applyNodeStyles(nodeEl, headlessNode.colors.primary);\r\n\r\n\t\tnodeEl.addEventListener(\"mousedown\", e => this.onNodeMouseDown(e, headlessNode));\r\n\t\treturn nodeEl;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies consistent styling to a node element.\r\n\t */\r\n\tprivate applyNodeStyles(el: HTMLElement, bgColor: Color) {\r\n\t\tel.style.backgroundColor = parseColor(bgColor);\r\n\t\tel.style.padding = \"4px 8px\";\r\n\t\tel.style.cursor = \"pointer\";\r\n\r\n\t\tif (this.toolbox?.workspace?.renderer?.constants) {\r\n\t\t\tconst c = this.toolbox.workspace.renderer.constants;\r\n\t\t\tel.style.fontFamily = c.FONT_FAMILY;\r\n\t\t\tel.style.fontSize = `${c.FONT_SIZE}px`;\r\n\t\t\tel.style.color = parseColor(c.FONT_COLOR);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles starting a drag operation for a node.\r\n\t */\r\n\tprivate onNodeMouseDown(e: MouseEvent, headlessNode: any) {\r\n\t\tif (!this.toolbox) return;\r\n\r\n\t\tconst ghostEl = this.createGhostNode(headlessNode);\r\n\t\tdocument.body.appendChild(ghostEl);\r\n\r\n\t\tconst moveGhost = (ev: MouseEvent) => {\r\n\t\t\tghostEl.style.left = ev.clientX + 4 + \"px\";\r\n\t\t\tghostEl.style.top = ev.clientY + 4 + \"px\";\r\n\t\t};\r\n\r\n\t\tconst releaseGhost = (ev: MouseEvent) => {\r\n\t\t\tdocument.removeEventListener(\"mousemove\", moveGhost);\r\n\t\t\tdocument.removeEventListener(\"mouseup\", releaseGhost);\r\n\r\n\t\t\tthis.dropNode(ev, headlessNode);\r\n\r\n\t\t\tghostEl.remove();\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener(\"mousemove\", moveGhost);\r\n\t\tdocument.addEventListener(\"mouseup\", releaseGhost);\r\n\r\n\t\te.preventDefault();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a ghost element that follows the mouse during drag.\r\n\t */\r\n\tprivate createGhostNode(headlessNode: any): HTMLDivElement {\r\n\t\tconst ghostEl = document.createElement(\"div\");\r\n\t\tghostEl.className = \"KabelGhostNode\";\r\n\t\tghostEl.textContent = headlessNode.labelText;\r\n\t\tghostEl.style.position = \"absolute\";\r\n\t\tghostEl.style.pointerEvents = \"none\";\r\n\r\n\t\tthis.applyNodeStyles(ghostEl, headlessNode.colors.primary);\r\n\t\treturn ghostEl;\r\n\t}\r\n\r\n\t/**\r\n\t * Handles dropping a node into the workspace if the mouse is over it.\r\n\t */\r\n\tprivate dropNode(ev: MouseEvent, node: TblxNodeStruct) {\r\n\t\tif (!this.toolbox) return;\r\n\r\n\t\tconst svg = this.toolbox.workspace.svg.node as SVGSVGElement;\r\n\t\tconst rect = svg.getBoundingClientRect();\r\n\r\n\t\tif (\r\n\t\t\tev.clientX >= rect.left &&\r\n\t\t\tev.clientX <= rect.right &&\r\n\t\t\tev.clientY >= rect.top &&\r\n\t\t\tev.clientY <= rect.bottom\r\n\t\t) {\r\n\t\t\tconst { x: wsX, y: wsY } = this.toolbox.workspace.screenToWorkspace(\r\n\t\t\t\tev.clientX - rect.left,\r\n\t\t\t\tev.clientY - rect.top\r\n\t\t\t);\r\n\r\n\t\t\tconst nodews = this.toolbox.workspace.spawnAt(node.type as string, wsX, wsY);\r\n\t\t\tif (nodews) {\r\n\t\t\t\tfor (let argName in node.arguments) {\r\n\t\t\t\t\tnodews.setFieldValue(argName, node.arguments[argName]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.toolbox.workspace.drawNode(nodews.id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.container.style.display = \"block\";\r\n\t\tthis.visible = true;\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.container.style.display = \"none\";\r\n\t\tthis.visible = false;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.container.innerHTML = \"\";\r\n\t}\r\n}\r\n\r\nexport default Flyout;\r\n","import RendererConstants from '../renderers/constants'\r\nimport Renderer from '../renderers/renderer'\r\nimport CategoryColors from './colors'\r\nimport Connection, { Connectable } from './connection'\r\nimport Coordinates from './coordinates'\r\nimport Field, {\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField\r\n} from './field'\r\nimport inject, { InjectMsg, InjectOptions } from './inject'\r\nimport {\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace\r\n} from './main-workspace'\r\nimport NodeSvg, { NodeJson, NodeEvents, InputFieldJson } from './nodesvg'\r\nimport NodePrototypes from './prototypes'\r\nimport WorkspaceSvg from './workspace-svg'\r\nimport { NodePrototype } from './node-types'\r\nimport {\r\n    Color,\r\n    ColorStyle,\r\n    Hex,\r\n    RGBObject,\r\n    RGBString,\r\n    RGBTuple\r\n} from './visual-types'\r\nimport { parseColor } from '../util/parse-color'\r\nimport eventer, { Eventer } from '../util/eventer'\r\nimport * as Path from '../util/path'\r\nimport * as SVG from '@svgdotjs/svg.js'\r\nimport * as UID from '../util/uid'\r\nimport hasProp from '../util/has-prop'\r\nimport EventEmitter from '../util/emitter'\r\nimport userState from '../util/user-state'\r\nimport '../events/events'\r\nimport WorkspaceController from '../controllers/base'\r\nimport WASDController from '../controllers/wasd'\r\nimport { RMap, RendererMap } from './renderer-map'\r\nimport styler, { Styler } from '../util/styler'\r\nimport WidgetPrototypes from './widget-prototypes'\r\nimport Widget from './widget'\r\nimport ContextOptsRegistry, { ContextMenu } from './ctx-menu-registry'\r\nimport { Showable } from './context-menu'\r\nimport escapeAttr from '../util/escape-html'\r\nimport unescapeAttr from '../util/unescape-html'\r\nimport waitFrames from '../util/wait-anim-frames'\r\nimport CommentModel from './comment'\r\nimport CommentRenderer from '../comment-renderer/renderer'\r\nimport dropdownContainer from './dropdown-menu'\r\nimport Representer from '../renderers/representer'\r\nimport { RepresenterNode } from '../renderers/representer-node'\r\nimport windowListeners, { addWindowListener, clearWindowListeners, removeWindowListener } from '../util/window-listeners'\r\nimport * as FontManager from './fonts-manager';\r\nimport env from \"../util/env\";\r\nimport Workspace from './workspace'\r\nimport injectHeadless from './inject-headless'\r\nimport createHeadlessNode from './headless-node';\r\nimport * as apollo from '../renderers/apollo/apollo';\r\nimport * as atlas from '../renderers/atlas/atlas';\r\nimport KabelWSTheme from '../themes/default'\r\nimport KabelDarkTheme from '../themes/dark'\r\n/** Register default renderers. */\r\nRendererMap['default'] = atlas.Renderer;\r\nRendererMap[atlas.Renderer.NAME] = atlas.Renderer;\r\nRendererMap[apollo.Renderer.NAME] = apollo.Renderer;\r\n\r\nif (env.isBrowser) {\r\n    // Use FontsManager to load default Kabel fonts.\r\n    FontManager.loadGoogleFont('Fredoka');\r\n}\r\n/**\r\n * Utility method to register a field globally by name\r\n * @param name - Field identifier\r\n * @param cls - Class constructor for the field\r\n */\r\nField.register = function (name: string, cls: Function) {\r\n    FieldMap[name] = cls as AnyFieldCls\r\n}\r\n\r\n/**\r\n * Utility method to unregister a field globally by name\r\n * @param name - Field identifier\r\n */\r\nField.unregister = function (name: string) {\r\n    delete FieldMap[name]\r\n}\r\n\r\n/**\r\n * Central Kabel object exposing all main modules, utilities, and defaults\r\n */\r\nconst Kabel = {\r\n    env, // Environment information\r\n    UIX: { // User experience enhancing utilities.\r\n        /** Event manager, loads events from '../events' and lets us attach them to svg.js elements to give them behavior that's seperated from the renderer. */\r\n        events: eventer as Eventer,\r\n        /** Font manager, used to load fonts. */\r\n        FontManager,\r\n        /** * State Manager, Makes things possible: E.G (the 'typing' state when you type in a input box..) * Used in controllers so you dont move when typing characters like a w s or d etc. */\r\n        userState,\r\n        /** Window listeners manager */\r\n        windowListeners: {\r\n            addWindowListener,\r\n            removeWindowListener,\r\n            clearWindowListeners,\r\n            windowListeners\r\n        }\r\n    },\r\n    Themes: {\r\n        Classic: KabelWSTheme,\r\n        Dark: KabelDarkTheme\r\n    },\r\n    /** Context menu manager */\r\n    ContextMenu,\r\n    /**\r\n     * Utility methods and constants for various purposes.\r\n     * @property Path - Utility methods for handling SVG paths.\r\n     * @property waitFrames - Utility method to wait for a certain number of animation frames.\r\n     */\r\n    Utils: {\r\n        Path,\r\n        waitFrames,\r\n        SVG, // Re-exporting svg.js for convenience\r\n        parseColor,\r\n        UID,\r\n        EventEmitter,\r\n        hasProp,\r\n        styler,\r\n        Styler,\r\n        escapeHTML: escapeAttr,\r\n        unescapeHTML: unescapeAttr\r\n    },\r\n    Widget,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    inject,\r\n    injectHeadless,\r\n    createHeadlessNode,\r\n    InjectMsg,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    Nodes: NodePrototypes,\r\n    Widgets: WidgetPrototypes,\r\n    WorkspaceSvg,\r\n    Workspace,\r\n    WorkspaceController,\r\n    WASDController,\r\n    nodeRendering: {\r\n        SVG: SVG, // also re-export svg.js here for easier access in renderers\r\n        rendererMap: RMap,\r\n        Apollo: apollo,\r\n        Atlas: atlas,\r\n        Renderer: Renderer,\r\n        RendererConstants: RendererConstants,\r\n        Representer: Representer,\r\n        RepresenterNode: RepresenterNode\r\n    },\r\n    atlas,\r\n    apollo,\r\n    commentRendering: { CommentModel, CommentRenderer },\r\n    Dropdown: dropdownContainer\r\n}\r\n\r\n/**\r\n * Provides a getter/setter for the main workspace\r\n * @property _mainWorkspace - Get or set the currently active workspace\r\n */\r\nObject.defineProperty(Kabel, '_mainWorkspace', {\r\n    get(): WorkspaceSvg | Workspace | null {\r\n        return getMainWorkspace()\r\n    },\r\n    set(v: WorkspaceSvg | Workspace | undefined | null | false | 0 | string) {\r\n        if (\r\n            v === undefined ||\r\n            v === null ||\r\n            v === false ||\r\n            v === 0 ||\r\n            typeof v === 'string'\r\n        ) {\r\n            return clearMainWorkspace()\r\n        }\r\n        return setMainWorkspace(v)\r\n    }\r\n})\r\n\r\nexport default Kabel\r\n","import type {WSTheme} from '../src/workspace-svg'\r\n\r\n\r\n\r\nconst KabelWSTheme: WSTheme = {\r\n\tUIStyles: {\r\n        workspaceBGColor: '#ffffff',\r\n\t\ttoolboxCategoriesBG: {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tleft: '0',\r\n\t\t\ttop: '0',\r\n\t\t\twidth: '20%',\r\n\t\t\theight: '100%',\r\n\t\t\tbackground: 'rgba(240,240,240,0.9)',\r\n\t\t\toverflowY: 'auto',\r\n\t\t},\r\n\t\ttoolboxFlyoutBG: {\r\n\t\t\tbackground: 'rgba(240,240,240,0.9)', // reuse same neutral bg\r\n\t\t\toverflowY: 'auto',\r\n\t\t\tpadding: '4px', // like nodes padding\r\n\t\t\tborderRadius: '4px',\r\n\t\t\tboxShadow: '0 2px 6px rgba(0,0,0,0.15)',\r\n\t\t},\r\n\t},\r\n};\r\n\r\nexport default KabelWSTheme;","import { Element as SvgElement, Rect as SvgRect, Text as SvgText } from \"@svgdotjs/svg.js\";\r\nimport CommentModel from \"../src/comment\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\nimport Renderer from \"../comment-renderer/renderer\"\r\n\r\ntype InitArgs = {\r\n    comment: CommentModel;\r\n    text: SvgText;\r\n    renderer: Renderer;\r\n};\r\n\r\nfunction initCommentInput(element: SvgElement, rawArgs: any) {\r\n    const args = rawArgs as InitArgs;\r\n    const comment = args.comment;\r\n    const txt = args.text as SvgText;\r\n    const rect = element as unknown as SvgRect;\r\n    const renderer = args.renderer;\r\n\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = comment.getText() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length;\r\n\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    function encodeForSvg(s: string) {\r\n        return s.replace(/ /g, \"\\u00A0\").replace(/\\n/g, \"&#10;\");\r\n    }\r\n\r\n    function ensureTspansPreserve(node: Element) {\r\n        Array.from(node.childNodes).forEach((child) => {\r\n            if (child.nodeType === 1) (child as Element).setAttribute(\"xml:space\", \"preserve\");\r\n        });\r\n    }\r\n\r\n    let caretLine: SvgRect | null = null;\r\n    let selectionRect: SvgRect | null = null;\r\n\r\n    // --- MEASURE TEXT WIDTH USING COMMENT RENDERER ---\r\n    function measureTextWidth(text: string, fontSize?: number, fontFamily?: string) {\r\n        // Delegate to renderers measureTextBbox logic\r\n        const tempText = renderer.getSvg().text(text).font({ size: fontSize || 12, family: fontFamily || \"Arial\" });\r\n        const bbox = renderer.measureTextBbox(tempText);\r\n        tempText.remove();\r\n        return bbox.width;\r\n    }\r\n\r\n    function updateText() {\r\n        const { start, end } = getSelectionRange();\r\n        const hasSel = hasSelection();\r\n\r\n        // redraw main text\r\n        txt.clear().tspan(encodeForSvg(buffer));\r\n        txt.attr({ \"xml:space\": \"preserve\" });\r\n        try { ensureTspansPreserve(txt.node as Element); } catch { }\r\n        txt.leading(1.2);\r\n\r\n        // --- selection highlight ---\r\n        if (hasSel) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14;\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n\r\n            const bbox = txt.bbox();\r\n            const highlightX = bbox.x + measureTextWidth(textBeforeStart, fontSize, fontFamily);\r\n            const highlightWidth = Math.max(\r\n                measureTextWidth(textBeforeEnd, fontSize, fontFamily) - measureTextWidth(textBeforeStart, fontSize, fontFamily),\r\n                1\r\n            );\r\n            const highlightY = bbox.y;\r\n            const highlightH = bbox.height;\r\n\r\n            if (!selectionRect) {\r\n                //@ts-ignore\r\n                selectionRect = rect!.parent()!.rect?.(highlightWidth, highlightH)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                selectionRect.size(highlightWidth, highlightH);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n        // --- caret ---\r\n        if (editing) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14;\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n            const textBeforeCaret = buffer.slice(0, cursorPos);\r\n            const caretXOffset = measureTextWidth(textBeforeCaret, fontSize, fontFamily);\r\n\r\n            const bbox = txt.bbox();\r\n            const caretY = bbox.y;\r\n            const caretH = bbox.height;\r\n\r\n            //@ts-ignore\r\n            if (!caretLine) caretLine = rect.parent().rect(1, caretH).fill('#000');\r\n\r\n            caretLine!.size(1, caretH).move(bbox.x + caretXOffset, caretY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n        // --- resize background rect ---\r\n        const bbox = txt.bbox();\r\n        const handleRadius = 6;\r\n        const textOffsetX = PADDING_X + handleRadius * 2 + 4;\r\n        const rectW = Math.max(16, Math.ceil(bbox.width) + textOffsetX + PADDING_X);\r\n        const rectH = Math.max(16, Math.ceil(bbox.height) + PADDING_Y * 2);\r\n        rect.size(rectW, rectH);\r\n\r\n        comment._tempInputBBox = {\r\n            width: rectW,\r\n            height: rectH,\r\n            textX: textOffsetX,\r\n            textY: PADDING_Y\r\n        };\r\n    }\r\n\r\n    // --- editing lifecycle ---\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = comment.getText() ?? \"\";\r\n        cursorPos = buffer.length;\r\n        anchorPos = buffer.length;\r\n\r\n        userState.setState('typing');\r\n\r\n        if (ev) {\r\n            const rectBox = txt.node.getBoundingClientRect();\r\n            //@ts-ignore\r\n            const zoom = renderer.getWs().getZoom();\r\n            const clickX = (ev.clientX - rectBox.left - PADDING_X) / zoom;\r\n\r\n            let cumulativeWidth = 0;\r\n            cursorPos = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                const charWidth = measureTextWidth(buffer[i] as string);\r\n                if (cumulativeWidth + charWidth / 2 >= clickX) break;\r\n                cumulativeWidth += charWidth;\r\n                cursorPos = i + 1;\r\n            }\r\n        }\r\n\r\n        anchorPos = cursorPos;\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown);\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing(commit = true) {\r\n        if (!editing) return;\r\n        editing = false;\r\n        userState.removeState(\"typing\");\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n\r\n        if (commit) comment.setTextNoRedraw(buffer);\r\n        updateText();\r\n        comment.getWorkspace()?.redraw?.();\r\n    }\r\n\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(false); return; }\r\n\r\n        if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            stopEditing(true);\r\n        } else if (e.key === \"Backspace\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        }\r\n        else if (e.key === \"ArrowLeft\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection left\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection right\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Home\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = 0; // anchor unchanged\r\n            } else {\r\n                cursorPos = 0;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"End\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = buffer.length;\r\n            } else {\r\n                cursorPos = buffer.length;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            e.preventDefault();\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        }\r\n\r\n        updateText();\r\n        comment.setTextNoRedraw(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const targ = ev.target as Node;\r\n        if (targ !== rect.node && targ !== txt.node) stopEditing(true);\r\n    }\r\n\r\n    const onRectDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n    const onTextDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n\r\n    rect.on(\"mousedown\", onRectDown as any);\r\n    txt.on(\"mousedown\", onTextDown as any);\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", onRectDown as any);\r\n        txt.off(\"mousedown\", onTextDown as any);\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_commentinp\", initCommentInput as EventSetupFn);\r\nexport default initCommentInput;\r\n","// uid.ts\r\n\r\n/**\r\n * Strategy used to generate UIDs.\r\n */\r\nexport type UIDStrategy = \"uuidv4\" | \"ulid\" | \"nanoid\" | \"short\";\r\n\r\nexport interface UIDOptions {\r\n    /** For \"nanoid\": length of the id (default 21) */\r\n    size?: number;\r\n    /** For \"nanoid\": custom alphabet (default URL-safe) */\r\n    alphabet?: string;\r\n}\r\n\r\n/** Web Crypto shim (browser + Node 16+) */\r\nconst cryptoAPI: Crypto | null =\r\n    (typeof globalThis !== \"undefined\" && (globalThis as any).crypto) || null;\r\n\r\n/**\r\n * Returns a Uint8Array of random bytes.\r\n * Uses Web Crypto if available; falls back to Math.random otherwise (not cryptographically secure).\r\n *\r\n * @param {number} len - Number of random bytes to generate.\r\n * @returns {Uint8Array} Random bytes array.\r\n */\r\nfunction randBytes(len: number): Uint8Array {\r\n    if (cryptoAPI?.getRandomValues) {\r\n        const buf = new Uint8Array(len);\r\n        cryptoAPI.getRandomValues(buf);\r\n        return buf;\r\n    }\r\n    // Last resort (very old envs). Not cryptographically strong.\r\n    const buf = new Uint8Array(len);\r\n    for (let i = 0; i < len; i++) buf[i] = Math.floor(Math.random() * 256);\r\n    return buf;\r\n}\r\n\r\n/**\r\n * Generates an RFC4122-compliant UUID v4.\r\n * Uses `crypto.randomUUID` if available.\r\n *\r\n * @returns {string} UUID v4 string.\r\n */\r\nexport function uuidv4(): string {\r\n    const g: any = globalThis as any;\r\n    if (g?.crypto?.randomUUID) return g.crypto.randomUUID();\r\n\r\n    const b = randBytes(16);\r\n    // Per RFC: set version + variant bits\r\n    // @ts-ignore\r\n    b[6] = (b[6] & 0x0f) | 0x40;\r\n    // @ts-ignore\r\n    b[8] = (b[8] & 0x3f) | 0x80;\r\n\r\n    const hex: string[] = [];\r\n    for (let i = 0; i < 256; i++) hex.push(i.toString(16).padStart(2, \"0\"));\r\n\r\n    return (\r\n        // @ts-ignore\r\n        hex[b[0]] + hex[b[1]] + hex[b[2]] + hex[b[3]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[4]] + hex[b[5]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[6]] + hex[b[7]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[8]] + hex[b[9]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[10]] + hex[b[11]] + hex[b[12]] + hex[b[13]] + hex[b[14]] + hex[b[15]]\r\n    );\r\n}\r\n\r\n/** Crockford Base32 alphabet for ULID */\r\nconst CROCK32 = \"0123456789ABCDEFGHJKMNPQRSTVWXYZ\"; // no I L O U\r\n\r\n/**\r\n * Generates a 26-character ULID (time-sortable unique ID).\r\n *\r\n * @param {number} [date] - Optional timestamp in milliseconds. Defaults to `Date.now()`.\r\n * @returns {string} ULID string.\r\n */\r\nexport function ulid(date?: number): string {\r\n    const time = (typeof date === \"number\" ? date : Date.now()) >>> 0; // low 32 bits\r\n    const timeHi = Math.floor((typeof date === \"number\" ? date : Date.now()) / 0x100000000) >>> 0; // high 32\r\n    // ULID uses 48-bit time; do base32 encode 48 bits\r\n    const time48 = new Uint8Array(6);\r\n    // write 48-bit big-endian\r\n    let t = BigInt(typeof date === \"number\" ? date : Date.now());\r\n    for (let i = 5; i >= 0; i--) {\r\n        time48[i] = Number(t & 0xffn);\r\n        t >>= 8n;\r\n    }\r\n    // first 10 chars = time\r\n    let out = \"\";\r\n    let acc = 0;\r\n    let bits = 0;\r\n    for (let i = 0; i < 6; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | time48[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n    out = out.slice(0, 10);\r\n\r\n    // last 16 chars = randomness (80 bits)\r\n    const rnd = randBytes(10);\r\n    acc = 0; bits = 0;\r\n    for (let i = 0; i < rnd.length; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | rnd[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n\r\n    return out.slice(0, 26);\r\n}\r\n\r\n/** NanoID-style: URL-safe alphabet by default, configurable length/alphabet */\r\nconst DEFAULT_ALPHABET =\r\n    \"_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n/**\r\n * Generates a NanoID-style string.\r\n *\r\n * @param {number} [size=21] - Length of the generated ID.\r\n * @param {string} [alphabet=DEFAULT_ALPHABET] - Alphabet to use.\r\n * @returns {string} Generated NanoID string.\r\n */\r\nexport function nanoid(size: number = 21, alphabet: string = DEFAULT_ALPHABET): string {\r\n    if (size <= 0) throw new Error(\"size must be > 0\");\r\n    const mask = (1 << Math.ceil(Math.log2(alphabet.length))) - 1;\r\n    let id = \"\";\r\n    while (id.length < size) {\r\n        const bytes = randBytes(1);\r\n        // @ts-ignore\r\n        const idx = bytes[0] & mask;\r\n        if (idx < alphabet.length) id += alphabet[idx];\r\n    }\r\n    return id;\r\n}\r\n\r\n/**\r\n * Generates a short, mostly-unique ID (timestamp + counter + random).\r\n * Not cryptographically strong.\r\n *\r\n * @returns {string} Short UID string.\r\n */\r\nlet _ctr = 0;\r\nexport function shortId(): string {\r\n    const ts = Date.now().toString(36);\r\n    _ctr = (_ctr + 1) & 0xfff; // 0..4095\r\n    const c = _ctr.toString(36).padStart(3, \"0\");\r\n    const r = Array.from(randBytes(3))\r\n        .map(b => (b & 0x3f).toString(36).padStart(2, \"0\"))\r\n        .join(\"\")\r\n        .slice(0, 4);\r\n    return `${ts}${c}${r}`;\r\n}\r\n\r\n/**\r\n * Generates a UID using the specified strategy.\r\n *\r\n * @param {UIDStrategy} [strategy=\"uuidv4\"] - The UID strategy to use.\r\n * @param {UIDOptions} [opts={}] - Options for the selected strategy.\r\n * @returns {string} Generated UID.\r\n */\r\nexport function generateUID(strategy: UIDStrategy = \"uuidv4\", opts: UIDOptions = {}): string {\r\n    switch (strategy) {\r\n        case \"uuidv4\": return uuidv4();\r\n        case \"ulid\": return ulid();\r\n        case \"nanoid\": return nanoid(opts.size ?? 21, opts.alphabet ?? DEFAULT_ALPHABET);\r\n        case \"short\": return shortId();\r\n        default: {\r\n            const _exhaustive: never = strategy;\r\n            return uuidv4();\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Escapes special characters in a string to their corresponding HTML entities.\r\n *\r\n * Specifically, it replaces:\r\n * - `&` with `&amp;`\r\n * - `'` with `&apos;`\r\n * - `\"` with `&quot;`\r\n * - `<` with `&lt;`\r\n * - `>` with `&gt;`\r\n *\r\n * @param {string} s - The string to escape.\r\n * @returns {string} The escaped string with special characters replaced by HTML entities.\r\n */\r\nfunction escapeAttr(s: string): string {\r\n    return s.replace(/&/g, \"&amp;\")\r\n            .replace(/'/g, \"&apos;\")\r\n            .replace(/\"/g, \"&quot;\")\r\n            .replace(/</g, \"&lt;\")\r\n            .replace(/>/g, \"&gt;\");\r\n}\r\n\r\nexport default escapeAttr;\r\n","import { G, Line } from \"@svgdotjs/svg.js\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport Workspace from \"./workspace\";\r\n\r\n\r\nexport interface CommentSerialized {\r\n    id: string;\r\n    text: string;\r\n    coords: { x: number; y: number };\r\n    parent: string | null; // node ID if node comment, null if workspace comment\r\n}\r\n/**\r\n * Represents a comment attached to either a NodeSvg or a WorkspaceSvg.\r\n */\r\nclass CommentModel {\r\n    /** The comment text */\r\n    _text: string;\r\n\r\n    /** True if this comment belongs to the workspace instead of a node */\r\n    _isWorkspaceComment: boolean;\r\n\r\n    /** Parent NodeSvg or WorkspaceSvg to which this comment belongs */\r\n    _parent: NodeSvg | WorkspaceSvg | Workspace;\r\n\r\n    /** SVG group representing this comment in the DOM */\r\n    svgGroup?: G | undefined;\r\n\r\n    /** Coordinates relative to parent */\r\n    relativeCoords: Coordinates;\r\n\r\n    /** Optional SVG line connecting the comment to its node */\r\n    svgLine?: Line | undefined;\r\n\r\n    /** Temporary bounding box info for input handling */\r\n    _tempInputBBox?: { width: number; height: number; textX: number; textY: number };\r\n\r\n    /** Unique identifier for this comment */\r\n    id: string;\r\n\r\n    /**\r\n     * Creates a new comment attached to a node or workspace.\r\n     * @param parent - NodeSvg or WorkspaceSvg this comment belongs to\r\n     */\r\n    constructor(parent: NodeSvg | WorkspaceSvg | Workspace) {\r\n        this._parent = parent;\r\n        this._isWorkspaceComment = parent instanceof WorkspaceSvg;\r\n        this._text = \"\";\r\n        this.relativeCoords = new Coordinates(0, 0); // Coordinates relative to this._parent\r\n        this.id = generateUID(\"nanoid\", {\r\n            alphabet: \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^\",\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sets the text of the comment without triggering a comment redraw.\r\n     * @param value - New text content\r\n     * @returns The updated text\r\n     */\r\n    setTextNoRedraw(value: string): string {\r\n        return (this._text = value);\r\n    }\r\n\r\n    /**\r\n     * Retrieves the current text of the comment.\r\n     * @returns The comment text\r\n     */\r\n    getText(): string {\r\n        return this._text;\r\n    }\r\n\r\n    /**\r\n     * Sets the text of the comment and triggers a redraw of all comments in the workspace.\r\n     * @param value - New text content\r\n     * @returns The updated text\r\n     */\r\n    setText(value: string): string {\r\n        const res = (this._text = value);\r\n        if (this.getWorkspace().isHeadless) return res;\r\n        this.getWorkspace().renderer.clearComments();\r\n        this.getWorkspace().renderer.drawComments();\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns true if this comment is attached to a node.\r\n     */\r\n    isNodeComment(): boolean {\r\n        return !this._isWorkspaceComment;\r\n    }\r\n\r\n    /**\r\n     * Returns true if this comment is attached to the workspace.\r\n     */\r\n    isWorkspaceComment(): boolean {\r\n        return this._isWorkspaceComment;\r\n    }\r\n\r\n    /**\r\n     * Gets the workspace that owns this comment.\r\n     */\r\n    getWorkspace(): WorkspaceSvg {\r\n        if (this.isWorkspaceComment()) {\r\n            return this._parent as WorkspaceSvg;\r\n        } else {\r\n            return (this._parent as NodeSvg)?.workspace as WorkspaceSvg;\r\n        }\r\n    }\r\n    /**\r\n     * Convert to JSON structure holding all important data.\r\n     */\r\n    toJson(): CommentSerialized {\r\n        return {\r\n            text: this.getText(),\r\n            coords: { x: this.relativeCoords.x, y: this.relativeCoords.y },\r\n            parent: this.isWorkspaceComment() ? null : (this._parent as NodeSvg).id,\r\n            id: this.id\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a CommentModel from serialized data.\r\n     * @param data - The serialized comment\r\n     * @param workspace - The workspace to attach the comment to\r\n     * @param nodeMap - Optional map of node IDs to NodeSvg instances\r\n     */\r\n    static fromJson(\r\n        data: CommentSerialized,\r\n    ): CommentModel {\r\n        const comment = new CommentModel(null as any as WorkspaceSvg | NodeSvg);\r\n        comment.id = data.id;\r\n        comment.relativeCoords = new Coordinates(data.coords.x, data.coords.y);\r\n        comment.setTextNoRedraw(data.text);\r\n\r\n        return comment;\r\n    }\r\n}\r\n\r\nexport default CommentModel;\r\nexport { CommentModel };\r\n","import Renderer from '../renderers/renderer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport CommentModel from '../src/comment';\r\nimport { Element, SVG, Svg } from '@svgdotjs/svg.js';\r\nimport eventer from '../util/eventer';\r\n\r\nclass CommentRenderer {\r\n\tstatic get NAME() { return 'cr_atlas'; }\r\n\tstatic get COMMENT_G_TAG() { return 'KabelCommentGroup'; }\r\n\tstatic get COMMENT_LINE_TAG() { return 'KabelCommentLine'; }\r\n\tstatic get COMMENT_TEXT_EL() { return 'KabelCommentText'; }\r\n\tstatic get COMMENT_DRAG_EL() { return 'KabelCommentDragHandle'; }\r\n\tstatic get RENDERER_TAG_EL() { return 'KabelCommentElTag'; }\r\n\r\n\tworkspace: WorkspaceSvg;\r\n\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\t}\r\n\r\n\tencodeForSvg(s: string) {\r\n\t\treturn s.replace(/ /g, \"\\u00A0\");\r\n\t}\r\n\r\n\tensureTspansPreserve(node: HTMLElement) {\r\n\t\tArray.from(node.childNodes).forEach((child) => {\r\n\t\t\tif (child.nodeType === 1) {\r\n\t\t\t\t(child as HTMLElement).setAttribute(\"xml:space\", \"preserve\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tmeasureTextBbox(textEl: Element) {\r\n\t\treturn textEl.bbox();\r\n\t}\r\n\r\n\tdrawComment(comment: CommentModel) {\r\n\t\tconst svg = this.getSvg();\r\n\t\tthis._removeExistingElements(comment);\r\n\r\n\t\tconst g = svg.group().addClass(CommentRenderer.COMMENT_G_TAG);\r\n\t\tg.attr({\r\n\t\t\t'comment-data': JSON.stringify({\r\n\t\t\t\tid: comment.id,\r\n\t\t\t\tisws: comment.isWorkspaceComment()\r\n\t\t\t})\r\n\t\t});\r\n\t\tcomment.svgGroup = g;\r\n\r\n\t\tconst padding = 4;\r\n\t\tconst handleRadius = 6;\r\n\t\tconst textOffsetX = padding + handleRadius * 2 + 4;\r\n\r\n\t\tconst displayEncoded = this.encodeForSvg(comment.getText());\r\n\t\tconst textEl = this._createTextElement(g, displayEncoded, textOffsetX, padding);\r\n\r\n\t\tconst bbox = this.measureTextBbox(textEl);\r\n\r\n\t\tconst rect = this._createBackgroundRect(g, bbox, padding, handleRadius);\r\n\t\tconst dragHandle = this._createDragHandle(g, bbox, padding, handleRadius);\r\n\r\n\t\tthis._addEventer(rect, dragHandle, comment, textEl);\r\n\r\n\t\tconst { screenPos, zoom } = this._computeScreenPosition(comment);\r\n\t\tg.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${zoom})` });\r\n\r\n\t\tif (comment._parent instanceof NodeSvg && comment._parent.svgGroup) {\r\n\t\t\tthis._drawLineToNode(comment, padding);\r\n\t\t}\r\n\t}\r\n\r\n\trefreshCommentTransforms() {\r\n\t\tfor (const comment of [\r\n\t\t\t...this.workspace.getComments(),\r\n\t\t\t...Array.from(this.workspace._nodeDB.values())\r\n\t\t\t\t.map(n => n.getComment())\r\n\t\t\t\t.filter(c => !!c) as CommentModel[]\r\n\t\t]) {\r\n\t\t\tif (!comment.svgGroup) continue;\r\n\r\n\t\t\tconst { screenPos, zoom } = this._computeScreenPosition(comment);\r\n\t\t\tcomment.svgGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${zoom})` });\r\n\r\n\t\t\tif (comment.svgLine) {\r\n\t\t\t\tcomment.svgLine.remove();\r\n\t\t\t\tcomment.svgLine = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tif (comment._parent instanceof NodeSvg) {\r\n\t\t\t\tthis._drawLineToNode(comment, 4);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _removeExistingElements(comment: CommentModel) {\r\n\t\tif (comment.svgGroup) comment.svgGroup.remove();\r\n\t\tif (comment.svgLine) comment.svgLine.remove();\r\n\t}\r\n\r\n\tprivate _createTextElement(parent: Element, text: string, x: number, y: number) {\r\n        //@ts-ignore\r\n\t\tconst textEl = parent.text(text)\r\n\t\t\t.font({ family: 'Arial', size: 12 })\r\n\t\t\t.fill('#000')\r\n\t\t\t.move(x, y)\r\n\t\t\t.addClass(CommentRenderer.COMMENT_TEXT_EL);\r\n\r\n\t\ttextEl.node.style.userSelect = 'none';\r\n\t\t// @ts-ignore\r\n\t\ttextEl.node.style!.webkitUserSelect = 'none';\r\n\t\t// @ts-ignore\r\n\t\ttextEl.node.style!.msUserSelect = 'none';\r\n\t\t// @ts-ignore\r\n\t\ttextEl.node.style!.MozUserSelect = 'none';\r\n\t\treturn textEl;\r\n\t}\r\n\r\n\tprivate _createBackgroundRect(parent: Element, bbox: any, padding: number, handleRadius: number) {\r\n        //@ts-ignore\r\n\t\treturn parent.rect(bbox.width + padding * 2 + handleRadius * 2 + 4, bbox.height + padding * 2)\r\n\t\t\t.fill('#ffffcc')\r\n\t\t\t.stroke({ color: '#cccc99', width: 1 })\r\n\t\t\t.radius(4)\r\n\t\t\t.back();\r\n\t}\r\n\r\n\tprivate _createDragHandle(parent: Element, bbox: any, padding: number, handleRadius: number) {\r\n        //@ts-ignore\r\n\t\treturn parent.circle(handleRadius * 2)\r\n\t\t\t.fill('#adad7d')\r\n\t\t\t.move(padding, padding + (bbox.height / 2) - handleRadius)\r\n\t\t\t.addClass(CommentRenderer.COMMENT_DRAG_EL);\r\n\t}\r\n\r\n\tprivate _addEventer(rect: Element, dragHandle: Element, comment: CommentModel, textEl: Element) {\r\n\t\teventer.addElement(dragHandle, 'k_draghandle', { comment })\r\n\t\t\t.tagElement(dragHandle, CommentRenderer.RENDERER_TAG_EL);\r\n\t\teventer.addElement(rect, \"k_commentinp\", { comment, text: textEl, renderer: this })\r\n\t\t\t.tagElement(rect, CommentRenderer.RENDERER_TAG_EL);\r\n\t}\r\n\r\n\tprivate _computeScreenPosition(comment: CommentModel) {\r\n\t\tlet workspaceX = comment.relativeCoords.x;\r\n\t\tlet workspaceY = comment.relativeCoords.y;\r\n\r\n\t\tif (comment._parent instanceof NodeSvg) {\r\n\t\t\tconst nodePos = comment._parent.relativeCoords;\r\n\t\t\tworkspaceX += nodePos.x;\r\n\t\t\tworkspaceY += nodePos.y;\r\n\t\t}\r\n\r\n\t\tconst screenPos = this.workspace.workspaceToScreen(workspaceX, workspaceY);\r\n\t\tconst zoom = this.workspace.getZoom();\r\n\t\treturn { screenPos, zoom };\r\n\t}\r\n\r\n\tprivate _drawLineToNode(comment: CommentModel, padding: number) {\r\n\t\tif (!comment || !(comment._parent instanceof NodeSvg) || !comment.svgGroup) return;\r\n\t\tconst svg = this.getSvg();\r\n\t\tconst ws = this.workspace;\r\n\r\n\t\tif (comment.svgLine) comment.svgLine.remove();\r\n\r\n\t\tconst nodeWSPos = comment._parent.relativeCoords;\r\n\t\tconst nodeBBox = comment._parent.svgGroup!.bbox();\r\n\t\tconst nodeTopCenter = ws.workspaceToScreen(\r\n\t\t\tnodeWSPos.x + nodeBBox.width / 2,\r\n\t\t\tnodeWSPos.y\r\n\t\t);\r\n\r\n\t\tconst parentWSPos = comment._parent.relativeCoords;\r\n\t\tconst commentRelPos = comment.relativeCoords;\r\n\t\tconst commentAbsX = parentWSPos.x + commentRelPos.x;\r\n\t\tconst commentAbsY = parentWSPos.y + commentRelPos.y;\r\n\t\tconst commentBBox = comment.svgGroup!.bbox();\r\n\t\tconst commentTopCenter = ws.workspaceToScreen(\r\n\t\t\tcommentAbsX + (commentBBox.width + padding * 2) / 2,\r\n\t\t\tcommentAbsY\r\n\t\t);\r\n\r\n\t\tcomment.svgLine = svg.line(\r\n\t\t\tnodeTopCenter.x, nodeTopCenter.y,\r\n\t\t\tcommentTopCenter.x, commentTopCenter.y\r\n\t\t)\r\n\t\t\t.stroke({ color: '#888', width: 1, dasharray: '3,2' })\r\n\t\t\t.addClass(CommentRenderer.COMMENT_LINE_TAG)\r\n\t\t\t.back();\r\n\t}\r\n\r\n\tclearAllComments() {\r\n\t\tconst svg = this.getSvg();\r\n\t\tsvg.find(`.${CommentRenderer.COMMENT_G_TAG}`).forEach(el => el.remove());\r\n\t\tsvg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n\t\teventer.destroyByTag(CommentRenderer.RENDERER_TAG_EL);\r\n\r\n\t\tfor (let [_, node] of this.workspace._nodeDB) {\r\n\t\t\tconst comment = node.getComment();\r\n\t\t\tif (comment) comment.svgGroup = undefined;\r\n\t\t}\r\n\r\n\t\tfor (const comment of this.workspace.getComments()) {\r\n\t\t\tcomment.svgGroup = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tclearCommentLines() {\r\n\t\tconst svg = this.getSvg();\r\n\t\tsvg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n\t}\r\n\r\n\tdrawAllComments() {\r\n\t\tfor (const comment of this.workspace.getComments()) this.drawComment(comment);\r\n\t\tfor (let [_, node] of this.workspace._nodeDB) {\r\n\t\t\tconst comment = node.getComment();\r\n\t\t\tif (comment) this.drawComment(comment);\r\n\t\t}\r\n\t}\r\n\r\n\tgetSvg(): Svg {\r\n\t\treturn this.workspace.svg;\r\n\t}\r\n    getWs(): WorkspaceSvg {\r\n        return this.workspace;\r\n    }\r\n}\r\n\r\nexport default CommentRenderer;\r\n","\r\nimport ApolloRenderer from \"./renderer\"\r\nimport ApolloConstants from \"./constants\"\r\nimport Representer from \"../representer\"\r\nimport { RepresenterNode } from \"../representer-node\"\r\n\r\nexport interface apolloType {\r\n    Renderer: typeof ApolloRenderer;\r\n    Constants: typeof ApolloConstants;\r\n    Representer: typeof Representer;\r\n    RepresenterNode: typeof RepresenterNode;\r\n}\r\n\r\n\r\nexport {\r\n    ApolloRenderer as Renderer,\r\n    ApolloConstants as Constants,\r\n    // Despite apollo not extending these, we still need to re-export them for the API.\r\n    Representer,\r\n    RepresenterNode\r\n}","import RendererConstants from \"./constants\";\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport * as Path from '../util/path';\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport { G, Path as SvgPath, Svg, StrokeData, Element, List, Rect } from \"@svgdotjs/svg.js\";\r\nimport { Color, ColorStyle, Hex } from \"../src/visual-types\";\r\nimport Field, { AnyField, ConnectableField, DummyField, FieldRawBoxData, OptConnectField } from \"../src/field\";\r\nimport eventer from '../util/eventer';\r\nimport Connection, { Connectable } from \"../src/connection\";\r\nimport escapeAttr from '../util/escape-html';\r\nimport unescapeAttr from '../util/unescape-html';\r\nimport CommentRenderer from \"../comment-renderer/renderer\";\r\nimport { FieldVisualInfo } from \"../src/field\";\r\nimport { RepresenterNode } from \"./representer-node\";\r\nimport type Representer from \"./representer\";\r\n\r\nexport interface ConnectorToFrom {\r\n    to: Connection,\r\n    from: Connection,\r\n    fromCircle?: SvgPath,\r\n    toCircle?: SvgPath,\r\n    originConn: Connection,\r\n    originCircle: SvgPath\r\n}\r\nexport interface DrawState {\r\n    id: string;\r\n    shadow?: SvgPath;\r\n    topbar?: SvgPath | null;\r\n    bg?: SvgPath | null;\r\n    group?: G | null;\r\n    fieldCol?: G | null;\r\n    fieldPosY?: number | null; // starts under topbar, goes down by field height each time one is drawn. This determines position\r\n    xButton?: G;\r\n    pendingConnections: ConnectorToFrom[]\r\n}\r\nexport interface NodeMeasurements {\r\n    width: number;\r\n    height: number;\r\n    fields: { width: number; height: number }[];\r\n}\r\n\r\nclass Renderer {\r\n    /**\r\n     * Set of constants the renderer uses for drawing nodes.\r\n     */\r\n    _constants!: RendererConstants;\r\n    /**\r\n     * The current node being rendered.\r\n     */\r\n    _currentNode: NodeSvg | null;\r\n    /**\r\n     * The SVG group element for the current node.\r\n     */\r\n    _nodeGroup: G | null;\r\n    /**\r\n     * The current drawing state for the node.\r\n     */\r\n    _nodeDraw: DrawState | null;\r\n    /**\r\n     * The workspace this renderer is associated with.\r\n     */\r\n    _ws: WorkspaceSvg;\r\n    /**\r\n     * Array of stored draw states for rendered nodes.\r\n     */\r\n    _drawStates: DrawState[];\r\n    /**\r\n     * Comment renderer instance used for rendering comments.\r\n     */\r\n    _commentDrawer!: CommentRenderer;\r\n    /**\r\n     * Representer instance used for building node representations.\r\n     */\r\n    representer!: Representer;\r\n    /**\r\n     * Constant overrides provided during renderer instantiation.\r\n     */\r\n    constantOverrides: Partial<RendererConstants>;\r\n    /**\r\n     * Tag used for node group elements in the SVG.\r\n     */\r\n    static get NODE_G_TAG() {\r\n        return 'AtlasNodeSVG';\r\n    }\r\n    /**\r\n     * Tag used for renderer elements in the SVG.\r\n     */\r\n    static get ELEMENT_TAG() {\r\n        return 'AtlasElement'\r\n    }\r\n    /**\r\n     * Tag used for connection line elements in the SVG.\r\n     */\r\n    static get CONN_LINE_TAG() {\r\n        return 'AtlasConnectionLine';\r\n    }\r\n    /**\r\n     * Tag used for connector elements in the SVG.\r\n     */\r\n    static get CONNECTOR_TAG() {\r\n        return 'AtlasConnectionBubble';\r\n    }\r\n    /**\r\n     * Tag used for line X mark elements in the SVG.\r\n     */\r\n    static get LINE_X_MARK_TAG() {\r\n        return 'AtlasLineXMark';\r\n    }\r\n    /**\r\n     * Tag used for background pattern elements in the SVG. This is constant, do not modify it in subclasses.\r\n     */\r\n    static get BACKGROUND_PATTERN() {\r\n        /** ! CONSTANT ! DO NOT CHANGE ! CONSTANT ! */\r\n        return 'WorkspaceBgPattern'\r\n    }\r\n    /**\r\n     * Name of the renderer.\r\n     */\r\n    static get NAME() {\r\n        return 'atlas'; // default is called atlas.\r\n    }\r\n    /**\r\n     * Constructor for the Renderer class.\r\n     * @param workspace - The workspace associated with the renderer.\r\n     * @param overrides - Optional constant overrides for the renderer.\r\n     */\r\n    constructor(workspace: WorkspaceSvg, overrides: Partial<RendererConstants> = {}) {\r\n        this._ws = workspace;\r\n        this._currentNode = null;\r\n        this._nodeGroup = null;\r\n        this._nodeDraw = null;\r\n        this._drawStates = [];\r\n        this.constantOverrides = overrides;\r\n        this.init();\r\n    }\r\n    /**\r\n     * Initializes the renderer by setting up the comment renderer, representer, and constants.\r\n     */\r\n    init() {\r\n        this.initCommentRenderer();\r\n        this.initRepresenter();\r\n        this.initConstants();\r\n    }\r\n    /**\r\n     * Initializes the renderer constants with any provided overrides.\r\n     */\r\n    initConstants() {\r\n        this._constants = new RendererConstants(this.constantOverrides);\r\n    }\r\n    /**\r\n     * Initializes the representer for the renderer.\r\n     */\r\n    initRepresenter() {\r\n        const Representer = (require('./representer').default);\r\n        this.representer = new Representer();\r\n    }\r\n    /**\r\n     * Initializes the comment renderer for the workspace.\r\n     */\r\n    initCommentRenderer() {\r\n        this._commentDrawer = new CommentRenderer(this.getWs());\r\n    }\r\n    /**\r\n     * Sets the connection to be processed.\r\n     * @param c - The connection to set.\r\n     */\r\n    setConnect(c: ConnectorToFrom) {\r\n        this.state?.pendingConnections?.push?.(c);\r\n    }\r\n    /**\r\n     * Sets the renderer constants.\r\n     * @param c - Partial constants to override.\r\n     * @returns The updated constants.\r\n     */\r\n    setConstants(c: Partial<RendererConstants> = {}) {\r\n        return Object.assign(this._constants, c);\r\n    }\r\n    /**\r\n     * Gets the renderer constants, merging with node style if applicable.\r\n     */\r\n    get constants(): RendererConstants {\r\n        if (!this.node) return this._constants;\r\n\r\n        const { primary, secondary, tertiary, ...restColors } = this.node.colors;\r\n\r\n        return {\r\n            ...this._constants,\r\n            ...restColors\r\n        };\r\n    }\r\n    /**\r\n     * Sets the renderer constants.\r\n     */\r\n    set constants(c: Partial<RendererConstants>) {\r\n        this.setConstants(c);\r\n    }\r\n    /**\r\n     * Gets the current node being rendered.\r\n     */\r\n    get node() {\r\n        return this._currentNode;\r\n    }\r\n    /**\r\n     * Gets the SVG.js instance from the workspace.\r\n     */\r\n    get svg(): Svg {\r\n        return this.getWs().svg; // Svg.js instance\r\n    }\r\n    /**\r\n     * Gets the current drawing state.\r\n     */\r\n    get state(): null | undefined | DrawState {\r\n        return this._nodeDraw;\r\n    }\r\n    /**\r\n     * Gets the workspace associated with the renderer.\r\n     * @returns The workspace instance.\r\n     */\r\n    getWs() {\r\n        return this._ws;\r\n    }\r\n    // MEASURING -\r\n\r\n    /**\r\n     * Gets the base measurements for a node.\r\n     * @returns The base width and height of the node.\r\n     */\r\n    getNodeBaseMeasurements() {\r\n        const c = this.constants;\r\n        return {\r\n            width: c.NODE_BASE_WIDTH,\r\n            height: c.NODE_BASE_HEIGHT\r\n        }\r\n    }\r\n    /**\r\n     * Measures the width of the given text.\r\n     * @param text - The text to measure.\r\n     * @param fontSize - The font size to use.\r\n     * @param fontFamily - The font family to use.\r\n     * @returns The width of the text.\r\n     */\r\n    measureTextWidth(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return text.length * (fontSize ?? c.FONT_SIZE) * 0.6;\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const width = txt.bbox().width;\r\n        txt.remove(); // clean up\r\n        return width;\r\n    }\r\n    /**\r\n     * Measures the height of the given text.\r\n     * @param text - The text to measure.\r\n     * @param fontSize - The font size to use.\r\n     * @param fontFamily - The font family to use.\r\n     * @returns The height of the text.\r\n     */\r\n    measureTextHeight(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return (fontSize ?? c.FONT_SIZE);\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const height = txt.bbox().height;\r\n        txt.remove(); // clean up\r\n        return height;\r\n    }\r\n    /**\r\n     * Measures the dimensions of a raw input field.\r\n     * @param text - The text content of the raw field.\r\n     * @returns The width and height of the raw field.\r\n     */\r\n    measureRawField(text: string = \"\") {\r\n        const c = this.constants;\r\n        const textW = this.measureTextWidth(text);\r\n        const width = Math.max(c.FIELD_RAW_BASE_WIDTH, textW + c.INPUT_BOX_PADDING * 2);\r\n        const height = c.FIELD_RAW_BASE_HEIGHT;\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Measures the label of a field.\r\n     * @param field - The field to measure the label for.\r\n     * @returns The width and height of the label.\r\n     */\r\n    measureLabel(field: AnyField): { width: number, height: number } {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return { width: 0, height: 0 };\r\n\r\n        const width = this.measureTextWidth(label);\r\n        const height = this.measureTextHeight(label);\r\n\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Measures the raw input of a field.\r\n     * @param field - The field to measure the raw input for.\r\n     * @returns The width and height of the raw input.\r\n     */\r\n    measureRaw(field: AnyField): { width: number, height: number } {\r\n        if (!field.hasRaw()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const raw = this.measureRawField(field.getValue?.() ?? \"\");\r\n        return {\r\n            width: raw.width,\r\n            height: raw.height\r\n        };\r\n    }\r\n    /**\r\n     * Measures the custom editor of a field.\r\n     * @param field - The field to measure the custom editor for.\r\n     * @returns The width and height of the custom editor.\r\n     */\r\n    measureCustom(field: AnyField): { width: number, height: number } {\r\n        if (!field.isCustomEditor()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const m = field.measureMyself();\r\n        if (!m) return { width: 0, height: 0 };\r\n\r\n        let width = m.width as number;\r\n        let height = m.height as number;\r\n\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Gets the padding to apply when measuring a field.\r\n     * @returns The width and height padding for the field.\r\n     */\r\n    getFieldMeasurementPadding() {\r\n        return { width: this.constants.FIELD_SPACEX, height: 0 }\r\n    }\r\n    /**\r\n     * Measures the overall dimensions of a field.\r\n     * @param field - The field to measure.\r\n     * @returns The width and height of the field.\r\n     */\r\n    measureField(field: AnyField) {\r\n        // parts of the measurement, correct order matters.\r\n        const parts = [\r\n            this.getFieldMeasurementPadding(),\r\n            this.measureLabel(field),\r\n            this.measureRaw(field),\r\n            this.measureCustom(field),\r\n            this.getFieldMeasurementPadding()\r\n        ];\r\n\r\n        let width = 0, height = 0;\r\n        for (const { width: w, height: h } of parts) {\r\n            width += w;\r\n            height = Math.max(height, h);\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Measures the overall dimensions of the current node.\r\n     * @returns The measurements of the node including width, height, and field dimensions.\r\n     */\r\n    measureNodeDimensions(): NodeMeasurements | void | null {\r\n        if (!this.node) return;\r\n\r\n        const c = this.constants;\r\n\r\n        const base = this.measureBaseAndLabel();\r\n\r\n        const fieldResult = this.measureFields(\r\n            c.TOPBAR_HEIGHT + c.FIELD_SPACEY,\r\n            base.width,\r\n            base.height\r\n        );\r\n\r\n        return {\r\n            width: fieldResult.width,\r\n            height: fieldResult.height + c.FOOTER_HEIGHT,\r\n            fields: fieldResult.fields\r\n        };\r\n    }\r\n    /**\r\n     * Measures all fields of the current node.\r\n     * @param startY The starting Y position for the fields.\r\n     * @param startWidth The starting width of the node.\r\n     * @param startHeight The starting height of the node.\r\n     * @returns The width, height, and field dimensions.\r\n     */\r\n    measureFields(\r\n        startY: number,\r\n        startWidth: number,\r\n        startHeight: number\r\n    ): {\r\n        width: number;\r\n        height: number;\r\n        fields: { width: number; height: number }[];\r\n    } {\r\n        const c = this.constants;\r\n        const node = this.node!;\r\n\r\n        let y = startY;\r\n        let totalWidth = startWidth;\r\n        let totalHeight = startHeight;\r\n        const fields: { width: number; height: number }[] = [];\r\n\r\n        for (const field of node.allFields()) {\r\n            const m = this.measureField(field);\r\n            fields.push(m);\r\n\r\n            totalWidth = Math.max(\r\n                totalWidth,\r\n                m.width + c.FIELD_MARGIN_X * 2\r\n            );\r\n\r\n            const bottom = y + m.height;\r\n            if (bottom + c.FIELD_MARGIN_Y > totalHeight) {\r\n                totalHeight = bottom + c.FIELD_MARGIN_Y;\r\n            }\r\n\r\n            y += m.height + c.FIELD_MARGIN_Y;\r\n        }\r\n\r\n        return { width: totalWidth, height: totalHeight, fields };\r\n    }\r\n    /**\r\n     * Measures the base dimensions of the current node including label.\r\n     * @returns The width and height of the node base and label.\r\n     */\r\n    private measureBaseAndLabel(): { width: number; height: number } {\r\n        const c = this.constants;\r\n        const node = this.node!;\r\n\r\n        const base = this.getNodeBaseMeasurements();\r\n        let width = base.width;\r\n        let height = base.height;\r\n\r\n        if (node.labelText) {\r\n            const labelW = this.measureTextWidth(\r\n                node.labelText,\r\n                c.FONT_SIZE,\r\n                c.FONT_FAMILY\r\n            );\r\n\r\n            width = Math.max(\r\n                width,\r\n                labelW + c.TOPBAR_LABEL_MARGIN_X * 2\r\n            );\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n    // renderNode METHOD + NODE DRAW INITING.\r\n    /**\r\n     * Renders the specified node by drawing it and building its representation.\r\n     * @param nodeIdOrNode The node or node ID to render.\r\n     * @returns Void.\r\n     */\r\n    renderNode(nodeIdOrNode: NodeSvg | string) {\r\n        this.startNode(nodeIdOrNode);\r\n        if (!this.node) return;\r\n        this.drawNode();\r\n        this.representer.build(this.node as NodeSvg, this, this.state as DrawState);\r\n        this.storeState();\r\n    }\r\n    /**\r\n     * Starts rendering the specified node.\r\n     * @param nodeIdOrNode The node or node ID to start rendering.\r\n     */\r\n    startNode(nodeIdOrNode: NodeSvg | string) {\r\n        const ws = this.getWs();\r\n        if (nodeIdOrNode instanceof NodeSvg) {\r\n            this._currentNode = nodeIdOrNode;\r\n        } else {\r\n            const node = ws.getNode(nodeIdOrNode);\r\n            if (node instanceof NodeSvg) {\r\n                this._currentNode = node;\r\n            } else {\r\n                this._currentNode = null;\r\n            }\r\n        }\r\n    }\r\n    // DRAW-STATE MANAGEMENT -\r\n    /**\r\n     * Build a draw state for the given node group and ID.\r\n     * @param nodeGroup - The SVG group element for the node.\r\n     * @param id  - The ID of the node.\r\n     * @returns - The constructed DrawState object.\r\n     */\r\n    drawState(nodeGroup: G, id: string): DrawState {\r\n        return {\r\n            id,\r\n            group: nodeGroup,\r\n            fieldPosY: 0,\r\n            pendingConnections: []\r\n        }\r\n    }\r\n    /**\r\n     * Stores the current draw state.\r\n     */\r\n    storeState() {\r\n        this._drawStates.push(this.state as DrawState);\r\n    }\r\n    // DRAWING + EVENT INITIALIZING VIA EVENTER\r\n    /**\r\n     * Draws a raw input field.\r\n     * @param fieldGroup - The SVG group element for the field.\r\n     * @param field - The field to draw.\r\n     * @param startX - The starting X position for the field.\r\n     * @returns The rectangle and text elements of the raw field.\r\n     */\r\n    drawFieldRaw(fieldGroup: G, field: AnyField, startX: number = 0) {\r\n        const c = this.constants;\r\n        const value = field.getDisplayValue?.() ?? \"\";\r\n        const { width, height } = this.measureRawField(value);\r\n\r\n        const rect = fieldGroup.rect(width, height)\r\n            .fill(parseColor(c.FIELD_RAW_COLOR))\r\n            .stroke({ color: parseColor(c.FIELD_RAW_OUTLINE_COLOR), width: c.FIELD_RAW_OUTLINE_STROKE })\r\n            .radius(3);\r\n\r\n        const txt = fieldGroup.text(value)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: c.INPUT_BOX_TEXT_ANCHOR\r\n            })\r\n            .fill(parseColor(c.FIELD_RAW_TEXT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n\r\n        const rawBox: FieldRawBoxData = {\r\n            box: rect,\r\n            txt\r\n        }\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (height - textBBox.height) / 2;\r\n\r\n        // move relative to startX (after label)\r\n        rect.move(startX, 0);\r\n        txt.move(startX + c.INPUT_BOX_PADDING, offsetY);\r\n        eventer.addElement(rect, \"k_inputbox\", {\r\n            field,      // the field object that has .getValue() and .setValue(v)\r\n            text: txt,       // the svg.js Text element you drew\r\n            renderer: this,   // the renderer instance, must have .measureRawField and .constants\r\n            startX   // x-offset where the box should start (after label)\r\n        }).tagElement(rect, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${this.node!.id}`])\r\n\r\n        return { rect, txt, rawBox };\r\n    }\r\n\r\n    /**\r\n     * Draws the label of a field.\r\n     * @param fieldGroup - The SVG group element for the field.\r\n     * @param field - The field to draw the label for.\r\n     * @param startX - The starting X position for the label.\r\n     * @returns The width used by the label including spacing.\r\n     */\r\n    drawFieldLabel(fieldGroup: G, field: AnyField, startX: number = 0): number {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return 0;\r\n\r\n        const txt = fieldGroup.text(label)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .fill(parseColor(c.FONT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n        const bbox = txt.bbox();\r\n        const offsetY = (Math.max(c.FIELD_RAW_BASE_HEIGHT, bbox.height) - bbox.height) / 2;\r\n\r\n        // move label relative to startX\r\n        txt.move(startX, offsetY);\r\n\r\n        // return width used for next element\r\n        return bbox.width + c.LABEL_SPACING;\r\n    }\r\n    /**\r\n     * Draws the X button on the node's top bar.\r\n     * @returns Void.\r\n     */\r\n    drawNodeXButton() {\r\n        const node = this.node;\r\n        const state = this._nodeDraw;\r\n        if (!node || !state || !state.group) return;\r\n\r\n        const c = this.constants;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n\r\n        const btnSize = c.TOPBAR_HEIGHT * 0.6;\r\n        const padding = (c.TOPBAR_HEIGHT - btnSize) / 2;\r\n\r\n        // Button group\r\n        const xGroup = state.group.group().attr({ class: 'node-x-clse' });\r\n        eventer.addElement(xGroup, 'k_closenode', {\r\n            workspace: this.getWs(),\r\n            node\r\n        }).tagElement(xGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n        // Background\r\n        xGroup.rect(btnSize, btnSize)\r\n            .fill('#ffffff00')\r\n            .radius(2)\r\n            .move(width - btnSize - padding, padding);\r\n\r\n        // X mark\r\n        const txt = xGroup.text('')\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: btnSize * 0.8,\r\n                weight: 'bold',\r\n                anchor: 'middle'\r\n            })\r\n            .fill('#fff')\r\n            .attr({\r\n                'text-anchor': 'middle',        // horizontal centering\r\n                'dominant-baseline': 'middle'   // vertical centering\r\n            });\r\n        txt.node.style.userSelect = 'none';\r\n        // Apply transform to center it inside the button\r\n        txt.transform({\r\n            translateX: width - btnSize / 2 - padding,\r\n            translateY: padding + btnSize / 2\r\n        });\r\n\r\n        state.xButton = xGroup;\r\n    }\r\n    /**\r\n     * Draws a connector on the specified side of the node.\r\n     * @param nodeGroup - The SVG group element for the node.\r\n     * @param nodeBg - The background SVG path of the node.\r\n     * @param y - The Y position for the connector.\r\n     * @param side - The side to draw the connector on ('left' or 'right').\r\n     * @param color - The color of the connector.\r\n     * @returns The SVG path of the connector or null if not drawn.\r\n     */\r\n    drawConnector(nodeGroup: G, nodeBg: SvgPath, y: number, side: 'left' | 'right', color: string): SvgPath | void | undefined | null {\r\n        const c = this.constants;\r\n        if (!nodeGroup || !nodeBg) return null;\r\n\r\n        const bbox = nodeBg.bbox(); // get dimensions of the background\r\n        const group = nodeGroup;     // attach connector to top-level node group\r\n        const x = side === 'left' ? 0 : bbox.width;\r\n\r\n        if (c.CONNECTOR_TRIANGLE) {\r\n            // small triangle connector\r\n            const triSize = c.CONNECTOR_TRI_SIZE;\r\n            let path = Path.roundedTri(triSize, triSize, 1);\r\n\r\n            // flip triangle horizontally for left side\r\n            if (side === 'left') path = Path.rotatePath(path, 180, triSize / 2, triSize / 2);\r\n\r\n            const tri = group.path(path)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 });\r\n            tri.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            const offsetX = side === 'left' ? -triSize : 0;\r\n            tri.transform({ translateX: x + offsetX, translateY: y - triSize / 2 });\r\n\r\n            return tri;\r\n        } else {\r\n            // circle connector\r\n            const radius = c.CONNECTOR_RADIUS;\r\n            const circlePath = Path.circle(radius);\r\n\r\n            const circ = group.path(circlePath)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .move(x - radius, y - radius); // center circle at (x, y)\r\n            circ.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            return circ;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws the label on the node's top bar.\r\n     * @param nodeGroup - The SVG group element for the node.\r\n     * @returns Void.\r\n     */\r\n    drawNodeLabel(nodeGroup: G) {\r\n        const node = this.node;\r\n        const c = this.constants;\r\n        if (!node) return;\r\n\r\n        if (node.labelText) {\r\n            const txt = nodeGroup.text(node.labelText)\r\n                .font({\r\n                    family: c.FONT_FAMILY,\r\n                    size: c.FONT_SIZE,\r\n                    anchor: 'start',\r\n                    weight: c.TOPBAR_LABEL_BOLDED ? '600' : 'normal'\r\n                })\r\n                .fill(parseColor(c.FONT_COLOR));\r\n\r\n            txt.node.style.userSelect = 'none';\r\n\r\n            const bbox = txt.bbox();\r\n            const offsetY = (c.TOPBAR_HEIGHT - bbox.height) / 2;\r\n\r\n            txt.move(c.TOPBAR_LABEL_MARGIN_X, offsetY + c.TOPBAR_LABEL_MARGIN_Y);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws the current node.\r\n     * @returns Void.\r\n     */\r\n    drawNode() {\r\n        if (!this.node) return;\r\n\r\n        const node = this.node;\r\n        const state = this.drawState(this.createNodeGroup(node), node.id);\r\n        this._nodeDraw = state;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n\r\n        this.drawNodeBase(state, measurements as NodeMeasurements);\r\n        this.drawNodeTopbar(state, this.getNodeColors(), measurements as NodeMeasurements);\r\n        this.drawNodeXButton();\r\n        this.drawNodeLabel(state.group!);\r\n        this.makeNodeDraggable(state.group!, state.topbar!, node);\r\n\r\n        this.createFieldGroup(state);\r\n        this.drawAllFieldsForNode(measurements as NodeMeasurements);\r\n\r\n        this.drawPreviousNextConnections(state, node, state.group!, measurements as NodeMeasurements);\r\n    }\r\n    /**\r\n     * Creates the SVG group for the given node.\r\n     * @param node - The node to create the group for.\r\n     * @returns The created SVG group element.\r\n     */\r\n    createNodeGroup(node: NodeSvg): G {\r\n        const nodeGroup = this.svg.group().attr({\r\n            'data-node-id': escapeAttr(node.id),\r\n            'class': (this.constructor as typeof Renderer).NODE_G_TAG\r\n        });\r\n        const screenPos = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n        nodeGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y})` });\r\n        return nodeGroup;\r\n    }\r\n    /**\r\n     * Draws the base and shadow of the node.\r\n     * @param state - The current drawing state.\r\n     * @param measurements - The measurements of the node.\r\n     */\r\n    drawNodeBase(state: DrawState, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const height = measurements?.height ?? c.NODE_BASE_HEIGHT;\r\n        const radius = c.CORNER_RADIUS;\r\n        state.bg = state.group!.path(Path.roundedRect(width, height, radius))\r\n            .fill(parseColor(c.NODE_BG_COLOR))\r\n            .stroke({ color: parseColor(c.NODE_OUTLINE_COLOR), width: 2 } as StrokeData);\r\n        state.shadow = state.group!.path(Path.roundedRect(width, height, radius))\r\n            .fill('rgba(0,0,0,0.2)')\r\n            .move(Number(state.bg.x()) + 5, Number(state.bg.y()) + 5)\r\n            .back(); // make sure it's behind the node\r\n    }\r\n    /**\r\n     * Draw the node's topbar\r\n     * @param state - The draw state\r\n     * @param colors - The colors of the node.\r\n     * @param measurements - The measurement data of the node.\r\n     */\r\n    drawNodeTopbar(state: DrawState, colors: ColorStyle, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const radius = c.CORNER_RADIUS;\r\n        state.topbar = state.group!.path(Path.roundedRect(width, c.TOPBAR_HEIGHT, radius))\r\n            .fill(parseColor(colors.primary))\r\n            .stroke({ color: parseColor(colors.tertiary), width: 2 } as StrokeData);\r\n    }\r\n    /**\r\n     * Make a node draggable.\r\n     * @param nodeGroup - The node group to make draggable\r\n     * @param dragHandle - The drag handle\r\n     * @param node - The nodesvg\r\n     */\r\n    makeNodeDraggable(nodeGroup: G, dragHandle: SvgPath, node: NodeSvg) {\r\n        eventer.addElement(nodeGroup, 'k_draggable', {\r\n            dragel: dragHandle,\r\n            group: nodeGroup,\r\n            node,\r\n            type: 2\r\n        }).tagElement(nodeGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n    }\r\n    /** Create the field group for the node */\r\n    createFieldGroup(state: DrawState) {\r\n        const c = this.constants;\r\n        const fieldsGroup = state.group!.group();\r\n        fieldsGroup.attr({ transform: `translate(0, ${c.TOPBAR_HEIGHT + c.FIELD_SPACEY})` });\r\n        state.fieldCol = fieldsGroup;\r\n    }\r\n    /**\r\n     * Draw a field on a node.\r\n     * @param field - The field to draw\r\n     * @param measurements - The node's measurements\r\n     * @param idx - Index of the field in the fieldColumn list\r\n     * @param y - the y position of the field\r\n     * @returns \r\n     */\r\n    drawFieldForNode(field: AnyField, measurements: NodeMeasurements, idx: number, y: number) {\r\n        const node = this.node;\r\n        const state = this.state;\r\n        const c = this.constants;\r\n        if (!node || !state || !state.fieldCol) return;\r\n        const fieldsGroup = state.fieldCol;\r\n        const nodeGroup = state.group as G;\r\n        const fm = measurements?.fields[idx];\r\n        if (!fm) return;\r\n\r\n        // default left alignment\r\n        let alignX = c.FIELD_MARGIN_X;\r\n\r\n        const fieldGroup = fieldsGroup.group();\r\n        fieldGroup.attr({ transform: `translate(${alignX}, ${y})` });\r\n        field.svgGroup = fieldGroup;\r\n        state.fieldPosY = y;\r\n\r\n        // draw label first, get its used width\r\n        const xUsed = this.drawFieldLabel(fieldGroup, field);\r\n        if (field.isCustomEditor()) {\r\n            // field fully owns drawing\r\n            field.drawMyself({\r\n                measuredWidth: fm.width,\r\n                measuredHeight: fm.height,\r\n                xUsed,\r\n                fieldGroup,\r\n                nodeGroup,\r\n                svg: this.svg,\r\n                background: state!.bg as unknown as Rect\r\n            });\r\n        } else {\r\n            let rawData, cBubbleData = undefined;\r\n            // if raw, draw right after label\r\n            if (field.hasRaw()) {\r\n                const { rawBox } = this.drawFieldRaw(fieldGroup, field, xUsed);\r\n                rawData = rawBox;\r\n            }\r\n            if (field.hasConnectable() && (field as ConnectableField)!.connection) {\r\n                const halfHeight = (fm.height + (field.hasRaw() ? 0 : c.FIELD_MARGIN_Y)) / 2;\r\n                const absY = c.TOPBAR_HEIGHT + c.FIELD_SPACEY + y + halfHeight;\r\n\r\n\r\n                const c3 = this.drawConnector(\r\n                    nodeGroup,\r\n                    state.bg as SvgPath,\r\n                    absY,\r\n                    'right',\r\n                    parseColor(c.FIELD_CONN_COLOR)\r\n                );\r\n                if (c3) {\r\n                    const c = {\r\n                        from: (field as ConnectableField)!.connection as Connection,\r\n                        to: ((field as ConnectableField)!.connection.getTo() as NodeSvg)?.previousConnection as Connection,\r\n                        fromCircle: c3 as SvgPath,\r\n                        originCircle: c3 as SvgPath,\r\n                        originConn: (field as ConnectableField)!.connection as Connection\r\n                    };\r\n                    cBubbleData = {\r\n                        connector: c3,\r\n                        connState: c\r\n                    }\r\n                    this.setConnect(c);\r\n                    eventer.addElement(c3, 'k_connectbubble', {\r\n                        connection: (field as ConnectableField)!.connection as Connection,\r\n                        field\r\n                    }).tagElement(c3, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                }\r\n            }\r\n            field.onDraw(rawData, cBubbleData);\r\n        }\r\n    }\r\n    /**\r\n     * Draw all fields on a node\r\n     * @param nodeMeasurements - The node's measurements\r\n     * @returns The final Y position.\r\n     */\r\n    drawAllFieldsForNode(nodeMeasurements: NodeMeasurements | null = null) {\r\n        const node = this.node;\r\n        let y = 0;\r\n        const state = this.state;\r\n        const c = this.constants;\r\n        if (!node || !state || !state.fieldCol) return;\r\n        const fieldsGroup = state.fieldCol;\r\n        const nodeGroup = state.group as G;\r\n\r\n        const measurements = nodeMeasurements ?? this.measureNodeDimensions();\r\n\r\n        node.allFields().forEach((field, idx) => {\r\n            this.drawFieldForNode(field, measurements as NodeMeasurements, idx, y);\r\n            const fm = measurements?.fields[idx];\r\n            if (!fm) return;\r\n            y += fm.height + c.FIELD_MARGIN_Y;\r\n        });\r\n\r\n        state.fieldPosY = y;\r\n        return y;\r\n    }\r\n    /**\r\n     * Draw the previous and next connections of a node.\r\n     * @param state - The draw-state\r\n     * @param node - The node-svg\r\n     * @param nodeGroup - the node's group\r\n     * @param measurements - the node's measurements\r\n     * @returns Void\r\n     */\r\n    drawPreviousNextConnections(state: DrawState, node: NodeSvg, nodeGroup: G, measurements: { width: number, height: number } | null = null) {\r\n        if (!state || !node) return;\r\n        if (!state.bg) return;\r\n        const c = this.constants;\r\n        const colors: ColorStyle = this.getNodeColors();\r\n        /**\r\n         * Draw connectors.\r\n         */\r\n        const bbox = state.bg?.bbox();\r\n        const cY = (bbox?.height ?? measurements?.height) - c.FOOTER_HEIGHT;\r\n\r\n        // Previous connection (left)\r\n        if (node.previousConnection) {\r\n            const c1 = this.drawConnector(nodeGroup, state.bg, cY, 'left', parseColor(colors.primary) as string);\r\n            if (c1) {\r\n                const c = ({\r\n                    from: node.previousConnection,\r\n                    to: this.resolveConnectable(node.previousConnection.getFrom(), node.previousConnection) as Connection,\r\n                    fromCircle: c1 as SvgPath,\r\n                    originConn: node.previousConnection,\r\n                    originCircle: c1\r\n                });\r\n                this.setConnect(c);\r\n                eventer.addElement(c1, 'k_connectbubble', {\r\n                    connection: node.previousConnection,\r\n                    node\r\n                }).tagElement(c1, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.previousConnection, c1 as SvgPath, true);\r\n            }\r\n        }\r\n\r\n        // Next connection (right)\r\n        if (node.nextConnection) {\r\n            const c2 = this.drawConnector(nodeGroup, state.bg, cY, 'right', parseColor(colors.primary) as string);\r\n            if (c2) {\r\n                const c = ({\r\n                    from: node.nextConnection,\r\n                    to: this.resolveConnectable(node.nextConnection.getTo(), node.nextConnection) as Connection,\r\n                    fromCircle: c2 as SvgPath,\r\n                    originConn: node.nextConnection,\r\n                    originCircle: c2\r\n                });\r\n                this.setConnect(c);\r\n                eventer.addElement(c2, 'k_connectbubble', {\r\n                    connection: node.nextConnection,\r\n                    node\r\n                }).tagElement(c2, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.nextConnection, c2 as SvgPath, false);\r\n            }\r\n        }\r\n    }\r\n    // REFRESHING TRANSFORMS AND COMMENTS -\r\n    /**\r\n     * Refreshes the comment transforms.\r\n     * @returns Void.\r\n     */\r\n    refreshComments() {\r\n        return this._commentDrawer?.refreshCommentTransforms?.();\r\n    }\r\n    /**\r\n     * Clears all comments from the workspace.\r\n     * @returns Void.\r\n     */\r\n    clearComments() {\r\n        return this._commentDrawer?.clearAllComments?.();\r\n    }\r\n    /**\r\n     * Draws all comments in the workspace.\r\n     * @returns Void.\r\n     */\r\n    drawComments() {\r\n        return this._commentDrawer?.drawAllComments?.();\r\n    }\r\n    /**\r\n     * Gets the current zoom level of the workspace.\r\n     * @returns The zoom level.\r\n     */\r\n    getZoom() {\r\n        return this._ws.getZoom() ?? 1;\r\n    }\r\n    /**\r\n     * Applies the current zoom level to the specified node group.\r\n     * @param nodeG - The SVG group element of the node.\r\n     * @param node - The node to apply zoom to.\r\n     */\r\n    applyZoomToNode(nodeG: G, node: NodeSvg) {\r\n        const zoom = this.getZoom();\r\n        const { x, y } = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n        nodeG.attr({ transform: `translate(${x}, ${y}) scale(${zoom})` });\r\n    }\r\n    /**\r\n     * Refreshes the transforms of all nodes in the workspace.\r\n     * @returns Void.\r\n     */\r\n    refreshNodeTransforms() {\r\n        const nodeGroups = this.svg.find(`.${(this.constructor as typeof Renderer).NODE_G_TAG}`);\r\n        const zoom = this.getZoom();\r\n\r\n        for (let nodeG of nodeGroups) {\r\n            const node = this._ws.getNode(unescapeAttr(nodeG.attr('data-node-id')));\r\n            if (!node) continue;\r\n            const { x, y } = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n            nodeG.attr({ transform: `translate(${x}, ${y}) scale(${zoom})` });\r\n        }\r\n\r\n        this.refreshConnectionLines();\r\n        this.refreshComments();\r\n    }\r\n\r\n    /**\r\n     * Refreshes all connection lines in the workspace.\r\n     * @returns Void.\r\n     */\r\n    refreshConnectionLines() {\r\n        this.clearLines();\r\n        this.drawLinesForAllNodes();\r\n    }\r\n    /**\r\n     * Gets the colors for the current node.\r\n     * @returns The color style of the node.\r\n     */\r\n    getNodeColors(): ColorStyle {\r\n        const node: NodeSvg = this.node as NodeSvg;\r\n        const colors: ColorStyle = node.colors ?? {\r\n            primary: '#000',\r\n            secondary: '#000',\r\n            tertirary: '#000',\r\n            category: ''\r\n        };\r\n        return colors;\r\n    }\r\n    // CONNECTOR BUBBLE HANDLING + CONNECTION RESOLVING -\r\n    /**\r\n     * Fill every node's connector bubble data with the corresponding bubble its connected to on a sibling node.\r\n     */\r\n    fillAllNodeConnectorBubbles() {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { originConn } = connPair;\r\n                if (!originConn) continue;\r\n\r\n                // Only try to fill missing sides with real circles from other pending connections\r\n                if (!connPair.fromCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.from && p.originCircle);\r\n                    if (match) connPair.fromCircle = match.originCircle;\r\n                }\r\n\r\n                if (!connPair.toCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.to && p.originCircle);\r\n                    if (match) connPair.toCircle = match.originCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Resolves the connectable to the appropriate connection based on the originating connection.\r\n     * @param connectable - The connectable entity (NodeSvg or Field).\r\n     * @param fromConn - The originating connection.\r\n     * @returns \r\n     */\r\n    resolveConnectable(connectable: Connectable, fromConn: Connection): Connection | null | undefined {\r\n        if (!connectable || !fromConn) return undefined;\r\n\r\n        // If the connection is an input (previous), return the connectable's output (next) connection\r\n        if (fromConn.isPrevious) {\r\n\r\n            if (connectable instanceof NodeSvg) return connectable.nextConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n\r\n        // If the connection is an output (next), return the connectable's input (previous) connection\r\n        if (!fromConn.isPrevious) {\r\n            if (connectable instanceof NodeSvg) return connectable.previousConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n    }\r\n    /**\r\n     * Fills in the connector circle for other nodes based on the given connection.\r\n     * @param conn - The connection to match.\r\n     * @param circle - The SVG path of the connector circle.\r\n     * @param isPrevious - Whether the connection is a previous connection.\r\n     */\r\n    _fillOtherNodeConnectorCircle(conn: Connection, circle: SvgPath, isPrevious: boolean) {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                // Only fill if the connection actually matches\r\n                if (isPrevious) {\r\n                    // fill toCircle if this connPair expects 'conn' as its 'to'\r\n                    if (connPair.to === conn && !connPair.toCircle) {\r\n                        connPair.toCircle = circle;\r\n                    }\r\n                } else {\r\n                    // fill fromCircle if this connPair expects 'conn' as its 'from'\r\n                    if (connPair.from === conn && !connPair.fromCircle) {\r\n                        connPair.fromCircle = circle;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // LINE DRAWING -\r\n    /**\r\n     * Draw the connection lines between node's connector bubbles.\r\n     */\r\n    drawLinesForAllNodes() {\r\n        const c = this.constants;\r\n        const wsSvg = this._ws.svg;\r\n\r\n        this.fillAllNodeConnectorBubbles();\r\n        const drawnCircles = new Set();\r\n\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { fromCircle, toCircle } = connPair;\r\n                if (connPair.from !== connPair.originConn) continue;\r\n                if (!fromCircle || !toCircle) continue;\r\n\r\n                if (drawnCircles.has(fromCircle) || drawnCircles.has(toCircle)) continue;\r\n                drawnCircles.add(fromCircle);\r\n                drawnCircles.add(toCircle);\r\n\r\n                // rbox = bbox relative to workspace SVG (handles zoom/pan correctly)\r\n                const fromBox = fromCircle.rbox(wsSvg);\r\n                const toBox = toCircle.rbox(wsSvg);\r\n\r\n                const startX = fromBox.cx;\r\n                const startY = fromBox.cy;\r\n                const endX = toBox.cx;\r\n                const endY = toBox.cy;\r\n\r\n                const line = wsSvg\r\n                    .path(`M ${startX} ${startY} L ${endX} ${endY}`)\r\n                    .stroke({\r\n                        color: parseColor(fromCircle.fill() as Color),\r\n                        width: c.CONNECTOR_LINE_WIDTH //  no zoom scaling\r\n                    })\r\n                    .fill('none')\r\n                    .stroke({\r\n                        width: c.CONNECTOR_LINE_WIDTH * this._ws.getZoom()\r\n                    })\r\n                    .attr({\r\n                        class: (this.constructor as typeof Renderer).CONN_LINE_TAG\r\n                    });\r\n\r\n                eventer\r\n                    .addElement(line, 'k_connline', {\r\n                        fromConn: connPair.from,\r\n                        toConn: connPair.to,\r\n                        renderer: this\r\n                    })\r\n                    .tagElement(line, [\r\n                        (this.constructor as typeof Renderer).ELEMENT_TAG,\r\n                        (this.constructor as typeof Renderer).LINE_X_MARK_TAG\r\n                    ]);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Clear connection lines and their X marks.\r\n     */\r\n    clearLines() {\r\n        for (let line of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).CONN_LINE_TAG}`)) {\r\n            line.remove();\r\n        }\r\n        for (let mark of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).LINE_X_MARK_TAG}`)) {\r\n            mark.remove();\r\n        }\r\n    }\r\n    /**\r\n     * Clear the entire screen.\r\n     */\r\n    clearScreen() {\r\n        // Destroy elements that were tagged (eventer system)\r\n        eventer.destroyByTag((this.constructor as typeof Renderer).ELEMENT_TAG);\r\n\r\n        // Remove all SVG children **except the background pattern rect**\r\n        this._ws.svg.children().forEach((el) => {\r\n            const isBackground = el.hasClass((this.constructor as typeof Renderer).BACKGROUND_PATTERN);\r\n            const isDefs = el.node.tagName == 'defs';\r\n            const isBgRect = el.classes().includes(WorkspaceSvg.BACKGROUND_CLASS);\r\n            if (!isBackground && !isDefs && !isBgRect) el.remove();\r\n        });\r\n\r\n        // Reset internal draw state\r\n        this._drawStates = [];\r\n    }\r\n    /**\r\n     * Remove pending connections for a specific connection\r\n     * @param conn - The connection\r\n     */\r\n    undoPendingConnsFor(conn: ConnectorToFrom) {\r\n        for (let state of this._drawStates) {\r\n            for (let conn0 of state.pendingConnections) {\r\n                if (conn0.toCircle == conn.originCircle) {\r\n                    delete conn0.toCircle;\r\n                }\r\n                if (conn0.fromCircle == conn.originCircle) {\r\n                    delete conn0.fromCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Called whenever a node must be visually rendered or rerendered.\r\n     * Implementations must be idempotent.\r\n     * @param node - The node to render/rerender\r\n     * @returns SVG group of the node.\r\n     */\r\n    rerenderNode(node: NodeSvg) {\r\n        // wipe old drawstate + events for this node\r\n        const idx = this._drawStates.findIndex(s => s.id === node.id);\r\n        if (idx !== -1) {\r\n            const state = this._drawStates[idx];\r\n            for (let pendingConn of state!.pendingConnections) {\r\n                this.undoPendingConnsFor(pendingConn);\r\n            }\r\n            state!.group?.remove();\r\n            eventer.destroyByTag(`node_${node.id}`);\r\n            this._drawStates.splice(idx, 1);\r\n        }\r\n\r\n        // rebuild node\r\n        this.startNode(node);\r\n        this.drawNode();\r\n        this.representer.build(this.node as NodeSvg, this, this.state as DrawState);\r\n        this.storeState();\r\n\r\n        // refresh *all* lines once the node is back in place\r\n        this.refreshNodeTransforms();\r\n        return (node.svg as RepresenterNode).getRaw();\r\n    }\r\n\r\n}\r\n\r\nexport default Renderer;\r\n","'use strict';\n\n\nvar paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0 };\n\nvar SPECIAL_SPACES = [\n  0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006,\n  0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF\n];\n\nfunction isSpace(ch) {\n  return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029) || // Line terminators\n    // White spaces\n    (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n    (ch >= 0x1680 && SPECIAL_SPACES.indexOf(ch) >= 0);\n}\n\nfunction isCommand(code) {\n  /*eslint-disable no-bitwise*/\n  switch (code | 0x20) {\n    case 0x6D/* m */:\n    case 0x7A/* z */:\n    case 0x6C/* l */:\n    case 0x68/* h */:\n    case 0x76/* v */:\n    case 0x63/* c */:\n    case 0x73/* s */:\n    case 0x71/* q */:\n    case 0x74/* t */:\n    case 0x61/* a */:\n    case 0x72/* r */:\n      return true;\n  }\n  return false;\n}\n\nfunction isArc(code) {\n  return (code | 0x20) === 0x61;\n}\n\nfunction isDigit(code) {\n  return (code >= 48 && code <= 57);   // 0..9\n}\n\nfunction isDigitStart(code) {\n  return (code >= 48 && code <= 57) || /* 0..9 */\n          code === 0x2B || /* + */\n          code === 0x2D || /* - */\n          code === 0x2E;   /* . */\n}\n\n\nfunction State(path) {\n  this.index  = 0;\n  this.path   = path;\n  this.max    = path.length;\n  this.result = [];\n  this.param  = 0.0;\n  this.err    = '';\n  this.segmentStart = 0;\n  this.data   = [];\n}\n\nfunction skipSpaces(state) {\n  while (state.index < state.max && isSpace(state.path.charCodeAt(state.index))) {\n    state.index++;\n  }\n}\n\n\nfunction scanFlag(state) {\n  var ch = state.path.charCodeAt(state.index);\n\n  if (ch === 0x30/* 0 */) {\n    state.param = 0;\n    state.index++;\n    return;\n  }\n\n  if (ch === 0x31/* 1 */) {\n    state.param = 1;\n    state.index++;\n    return;\n  }\n\n  state.err = 'SvgPath: arc flag can be 0 or 1 only (at pos ' + state.index + ')';\n}\n\n\nfunction scanParam(state) {\n  var start = state.index,\n      index = start,\n      max = state.max,\n      zeroFirst = false,\n      hasCeiling = false,\n      hasDecimal = false,\n      hasDot = false,\n      ch;\n\n  if (index >= max) {\n    state.err = 'SvgPath: missed param (at pos ' + index + ')';\n    return;\n  }\n  ch = state.path.charCodeAt(index);\n\n  if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n    index++;\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  // This logic is shamelessly borrowed from Esprima\n  // https://github.com/ariya/esprimas\n  //\n  if (!isDigit(ch) && ch !== 0x2E/* . */) {\n    state.err = 'SvgPath: param should start with 0..9 or `.` (at pos ' + index + ')';\n    return;\n  }\n\n  if (ch !== 0x2E/* . */) {\n    zeroFirst = (ch === 0x30/* 0 */);\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n\n    if (zeroFirst && index < max) {\n      // decimal number starts with '0' such as '09' is illegal.\n      if (ch && isDigit(ch)) {\n        state.err = 'SvgPath: numbers started with `0` such as `09` are illegal (at pos ' + start + ')';\n        return;\n      }\n    }\n\n    while (index < max && isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasCeiling = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x2E/* . */) {\n    hasDot = true;\n    index++;\n    while (isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasDecimal = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x65/* e */ || ch === 0x45/* E */) {\n    if (hasDot && !hasCeiling && !hasDecimal) {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n    if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n      index++;\n    }\n    if (index < max && isDigit(state.path.charCodeAt(index))) {\n      while (index < max && isDigit(state.path.charCodeAt(index))) {\n        index++;\n      }\n    } else {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n  }\n\n  state.index = index;\n  state.param = parseFloat(state.path.slice(start, index)) + 0.0;\n}\n\n\nfunction finalizeSegment(state) {\n  var cmd, cmdLC;\n\n  // Process duplicated commands (without comand name)\n\n  // This logic is shamelessly borrowed from Raphael\n  // https://github.com/DmitryBaranovskiy/raphael/\n  //\n  cmd   = state.path[state.segmentStart];\n  cmdLC = cmd.toLowerCase();\n\n  var params = state.data;\n\n  if (cmdLC === 'm' && params.length > 2) {\n    state.result.push([ cmd, params[0], params[1] ]);\n    params = params.slice(2);\n    cmdLC = 'l';\n    cmd = (cmd === 'm') ? 'l' : 'L';\n  }\n\n  if (cmdLC === 'r') {\n    state.result.push([ cmd ].concat(params));\n  } else {\n\n    while (params.length >= paramCounts[cmdLC]) {\n      state.result.push([ cmd ].concat(params.splice(0, paramCounts[cmdLC])));\n      if (!paramCounts[cmdLC]) {\n        break;\n      }\n    }\n  }\n}\n\n\nfunction scanSegment(state) {\n  var max = state.max,\n      cmdCode, is_arc, comma_found, need_params, i;\n\n  state.segmentStart = state.index;\n  cmdCode = state.path.charCodeAt(state.index);\n  is_arc = isArc(cmdCode);\n\n  if (!isCommand(cmdCode)) {\n    state.err = 'SvgPath: bad command ' + state.path[state.index] + ' (at pos ' + state.index + ')';\n    return;\n  }\n\n  need_params = paramCounts[state.path[state.index].toLowerCase()];\n\n  state.index++;\n  skipSpaces(state);\n\n  state.data = [];\n\n  if (!need_params) {\n    // Z\n    finalizeSegment(state);\n    return;\n  }\n\n  comma_found = false;\n\n  for (;;) {\n    for (i = need_params; i > 0; i--) {\n      if (is_arc && (i === 3 || i === 4)) scanFlag(state);\n      else scanParam(state);\n\n      if (state.err.length) {\n        finalizeSegment(state);\n        return;\n      }\n      state.data.push(state.param);\n\n      skipSpaces(state);\n      comma_found = false;\n\n      if (state.index < max && state.path.charCodeAt(state.index) === 0x2C/* , */) {\n        state.index++;\n        skipSpaces(state);\n        comma_found = true;\n      }\n    }\n\n    // after ',' param is mandatory\n    if (comma_found) {\n      continue;\n    }\n\n    if (state.index >= state.max) {\n      break;\n    }\n\n    // Stop on next segment\n    if (!isDigitStart(state.path.charCodeAt(state.index))) {\n      break;\n    }\n  }\n\n  finalizeSegment(state);\n}\n\n\n/* Returns array of segments:\n *\n * [\n *   [ command, coord1, coord2, ... ]\n * ]\n */\nmodule.exports = function pathParse(svgPath) {\n  var state = new State(svgPath);\n  var max = state.max;\n\n  skipSpaces(state);\n\n  while (state.index < max && !state.err.length) {\n    scanSegment(state);\n  }\n\n  if (state.result.length) {\n    if ('mM'.indexOf(state.result[0][0]) < 0) {\n      state.err = 'SvgPath: string should start with `M` or `m`';\n      state.result = [];\n    } else {\n      state.result[0][0] = 'M';\n    }\n  }\n\n  return {\n    err: state.err,\n    segments: state.result\n  };\n};\n","import KabelWSTheme from './default';\r\nimport KabelDarkTheme from './dark';\r\n\r\nconst Themes = {\r\n    Classic: KabelWSTheme,\r\n    Dark: KabelDarkTheme\r\n}\r\n\r\nexport default Themes;","/**\r\n * Converts HTML-escaped characters in a string back to their literal form.\r\n *\r\n * Specifically, it replaces:\r\n * - `&lt;` with `<`\r\n * - `&gt;` with `>`\r\n * - `&quot;` with `\"`\r\n * - `&apos;` with `'`\r\n * - `&amp;` with `&`\r\n *\r\n * @param {string} s - The string containing HTML-escaped characters.\r\n * @returns {string} The unescaped string with HTML entities replaced by their literal characters.\r\n */\r\nfunction unescapeAttr(s: string): string {\r\n\treturn s.replace(/&lt;/g, \"<\")\r\n\t\t\t.replace(/&gt;/g, \">\")\r\n\t\t\t.replace(/&quot;/g, '\"')\r\n\t\t\t.replace(/&apos;/g, \"'\")\r\n\t\t\t.replace(/&amp;/g, \"&\");\r\n}\r\n\r\nexport default unescapeAttr;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport Workspace from \"./workspace\";\r\n\r\nexport interface WidgetOptions {\r\n    /**\r\n     * Widget class to instantiate for the widget, by default it uses Kabel's\r\n     */\r\n    cls?: typeof Widget;\r\n    /**\r\n     * Coordinates to spawn the widget at.\r\n     */\r\n    coords?: Coordinates;      // where to position the widget\r\n    /**\r\n     * Width of the widget\r\n     */\r\n    width?: number;            // optional width\r\n    /**\r\n     * Height of the widget.\r\n     */\r\n    height?: number;           // optional height\r\n    /**\r\n     * Class to give the widget's html container.\r\n     */\r\n    className?: string;        // optional CSS class\r\n    /**\r\n     * Widget inner HTML default content.\r\n     */\r\n    html?: string;             // inner HTML\r\n    /**\r\n     * Widget name\r\n     */\r\n    name: string;\r\n    /**\r\n     * Sets up a new widget of this type\r\n     * @param this - This context of the function points to widget.\r\n     * @param widget - The widget this function is called on.\r\n     * @param html - The html container of the widget.\r\n     * @returns - Void.\r\n     */\r\n    init?: (this: WidgetOptions, widget: Widget, html: HTMLElement) => void;\r\n}\r\nclass Widget {\r\n    workspace: WorkspaceSvg|Workspace;\r\n    container: HTMLDivElement;\r\n    coords: Coordinates;\r\n    width: number;\r\n    height: number;\r\n    visible: boolean;\r\n    name: string;\r\n    id: string;\r\n    options: WidgetOptions;\r\n    static WIDGET_GLOBAL_ID = 0;\r\n    constructor(workspace: WorkspaceSvg|Workspace, options: WidgetOptions = { name: `Untitled(${Widget.WIDGET_GLOBAL_ID++})` }) {\r\n        this.workspace = workspace;\r\n        this.coords = options.coords ?? new Coordinates(0, 0);\r\n        this.width = options.width ?? 200;\r\n        this.height = options.height ?? 100;\r\n        this.visible = false;\r\n        this.name = options.name;\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        this.options = options;\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n\r\n        if (options.html) this.container.innerHTML = options.html;\r\n\r\n        if (!this.workspace.isHeadless) (this.workspace as WorkspaceSvg)._wsTop.appendChild(this.container);\r\n        this.hide();\r\n        if (typeof options.init !== 'undefined' && options.init) {\r\n            options.init(this, this.container);\r\n        }\r\n    }\r\n\r\n    // Show the widget\r\n    show() {\r\n        this.container.style.display = \"block\";\r\n        this.visible = true;\r\n    }\r\n\r\n    // Hide the widget\r\n    hide() {\r\n        this.container.style.display = \"none\";\r\n        this.visible = false;\r\n    }\r\n\r\n    // Move the widget to new coords\r\n    setCoords(coords: Coordinates) {\r\n        this.coords = coords;\r\n        this.container.style.left = `${coords.x}px`;\r\n        this.container.style.top = `${coords.y}px`;\r\n    }\r\n\r\n    // Update the HTML content\r\n    setHTML(html: string) {\r\n        this.container.innerHTML = html;\r\n    }\r\n    // Bring widget back from the dead after a .destroy call\r\n    reanimate() {\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = this.options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n        \r\n        if (this.options.html) this.container.innerHTML = this.options.html;\r\n        if (this.workspace.isHeadless) return;\r\n\r\n        (this.workspace as WorkspaceSvg)._wsTop.appendChild(this.container);\r\n        this.workspace._addWidgetToDB(this);\r\n    }\r\n    // Destroy widget & cleanup.\r\n    destroy() {\r\n        this.container.remove();\r\n        this.workspace._delWidgetFromDB(this);\r\n    }\r\n}\r\n\r\nexport default Widget;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\n\r\ninterface HistoryEntry {\r\n\tstate: any; // serialized workspace or diff\r\n}\r\n\r\nexport default class UndoRedoHistory {\r\n\tprivate ws: WorkspaceSvg;\r\n\tprivate undoStack: HistoryEntry[] = [];\r\n\tprivate redoStack: HistoryEntry[] = [];\r\n\tprivate isRecording: boolean = true;\r\n\r\n\tconstructor(ws: WorkspaceSvg) {\r\n\t\tthis.ws = ws;\r\n\t}\r\n\r\n\temitChange() {\r\n\t\tif (!this.isRecording) return;\r\n\t\tif (!this.ws.recordHistory) return;\r\n\r\n\t\tconst state = this.ws.toJson ? this.ws.toJson(true) : {};\r\n\t\tthis.undoStack.push({ state });\r\n\t\tthis.redoStack.length = 0;\r\n\r\n\t\t//console.log(\"[emitChange] pushed state. undoStack size:\", this.undoStack.length, \"redoStack cleared\");\r\n\t}\r\n\r\n\tundo() {\r\n\t\t//console.log(\"[undo] called. undoStack size:\", this.undoStack.length, \"redoStack size:\", this.redoStack.length);\r\n\r\n\t\tif (this.undoStack.length <= 1) {\r\n\t\t\t//console.log(\"[undo] nothing to undo.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst current = this.undoStack.pop();\r\n\t\t//console.log(\"[undo] popped current state:\", current);\r\n\r\n\t\tconst prev = this.undoStack[this.undoStack.length - 1];\r\n\t\t//console.log(\"[undo] previous state to restore:\", prev);\r\n\r\n\t\tif (!prev) {\r\n\t\t\t//console.log(\"[undo] no previous state found.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isRecording = false;\r\n\t\tthis.ws.fromJson?.(prev.state);\r\n\t\tthis.isRecording = true;\r\n\r\n\t\tthis.redoStack.push(current as HistoryEntry);\r\n\t\t//console.log(\"[undo] state restored. undoStack size now:\", this.undoStack.length, \"redoStack size now:\", this.redoStack.length);\r\n\t}\r\n\r\n\tredo() {\r\n\t\t//console.log(\"[redo] called. undoStack size:\", this.undoStack.length, \"redoStack size:\", this.redoStack.length);\r\n\r\n\t\tconst entry = this.redoStack.pop();\r\n\t\tif (!entry) {\r\n\t\t\t//console.log(\"[redo] nothing to redo.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//console.log(\"[redo] popping state from redoStack:\", entry);\r\n\r\n\t\tthis.isRecording = false;\r\n\t\tthis.ws.fromJson?.(entry.state);\r\n\t\tthis.isRecording = true;\r\n\r\n\t\tthis.undoStack.push(entry);\r\n\t\t//console.log(\"[redo] state restored. undoStack size now:\", this.undoStack.length, \"redoStack size now:\", this.redoStack.length);\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.undoStack = [];\r\n\t\tthis.redoStack = [];\r\n\t\t//console.log(\"[clear] undo and redo stacks cleared\");\r\n\t}\r\n\r\n\tcanUndo() {\r\n\t\treturn this.undoStack.length > 1;\r\n\t}\r\n\r\n\tcanRedo() {\r\n\t\treturn this.redoStack.length > 0;\r\n\t}\r\n}\r\n","import { InjectMsg } from \"./inject\";\r\nimport { setMainWorkspace } from \"./main-workspace\";\r\nimport Workspace from \"./workspace\";\r\n\r\n\r\n\r\n\r\nfunction injectHeadless() : Workspace | undefined {\r\n    try {\r\n        const ws = new Workspace();\r\n        setMainWorkspace(ws);\r\n        return ws;\r\n    } catch (e) {\r\n        new InjectMsg(`Failed to initialize workspace: ${(e as Error).message}`).err();\r\n    }\r\n}\r\n\r\nexport default injectHeadless;","'use strict';\n\n/* eslint-disable space-infix-ops */\n\n// The precision used to consider an ellipse as a circle\n//\nvar epsilon = 0.0000000001;\n\n// To convert degree in radians\n//\nvar torad = Math.PI / 180;\n\n// Class constructor :\n//  an ellipse centred at 0 with radii rx,ry and x - axis - angle ax.\n//\nfunction Ellipse(rx, ry, ax) {\n  if (!(this instanceof Ellipse)) { return new Ellipse(rx, ry, ax); }\n  this.rx = rx;\n  this.ry = ry;\n  this.ax = ax;\n}\n\n// Apply a linear transform m to the ellipse\n// m is an array representing a matrix :\n//    -         -\n//   | m[0] m[2] |\n//   | m[1] m[3] |\n//    -         -\n//\nEllipse.prototype.transform = function (m) {\n  // We consider the current ellipse as image of the unit circle\n  // by first scale(rx,ry) and then rotate(ax) ...\n  // So we apply ma =  m x rotate(ax) x scale(rx,ry) to the unit circle.\n  var c = Math.cos(this.ax * torad), s = Math.sin(this.ax * torad);\n  var ma = [\n    this.rx * (m[0]*c + m[2]*s),\n    this.rx * (m[1]*c + m[3]*s),\n    this.ry * (-m[0]*s + m[2]*c),\n    this.ry * (-m[1]*s + m[3]*c)\n  ];\n\n  // ma * transpose(ma) = [ J L ]\n  //                      [ L K ]\n  // L is calculated later (if the image is not a circle)\n  var J = ma[0]*ma[0] + ma[2]*ma[2],\n      K = ma[1]*ma[1] + ma[3]*ma[3];\n\n  // the discriminant of the characteristic polynomial of ma * transpose(ma)\n  var D = ((ma[0]-ma[3])*(ma[0]-ma[3]) + (ma[2]+ma[1])*(ma[2]+ma[1])) *\n          ((ma[0]+ma[3])*(ma[0]+ma[3]) + (ma[2]-ma[1])*(ma[2]-ma[1]));\n\n  // the \"mean eigenvalue\"\n  var JK = (J + K) / 2;\n\n  // check if the image is (almost) a circle\n  if (D < epsilon * JK) {\n    // if it is\n    this.rx = this.ry = Math.sqrt(JK);\n    this.ax = 0;\n    return this;\n  }\n\n  // if it is not a circle\n  var L = ma[0]*ma[1] + ma[2]*ma[3];\n\n  D = Math.sqrt(D);\n\n  // {l1,l2} = the two eigen values of ma * transpose(ma)\n  var l1 = JK + D/2,\n      l2 = JK - D/2;\n  // the x - axis - rotation angle is the argument of the l1 - eigenvector\n  /*eslint-disable indent*/\n  this.ax = (Math.abs(L) < epsilon && Math.abs(l1 - K) < epsilon) ?\n    90\n  :\n    Math.atan(Math.abs(L) > Math.abs(l1 - K) ?\n      (l1 - J) / L\n    :\n      L / (l1 - K)\n    ) * 180 / Math.PI;\n  /*eslint-enable indent*/\n\n  // if ax > 0 => rx = sqrt(l1), ry = sqrt(l2), else exchange axes and ax += 90\n  if (this.ax >= 0) {\n    // if ax in [0,90]\n    this.rx = Math.sqrt(l1);\n    this.ry = Math.sqrt(l2);\n  } else {\n    // if ax in ]-90,0[ => exchange axes\n    this.ax += 90;\n    this.rx = Math.sqrt(l2);\n    this.ry = Math.sqrt(l1);\n  }\n\n  return this;\n};\n\n// Check if the ellipse is (almost) degenerate, i.e. rx = 0 or ry = 0\n//\nEllipse.prototype.isDegenerate = function () {\n  return (this.rx < epsilon * this.ry || this.ry < epsilon * this.rx);\n};\n\nmodule.exports = Ellipse;\n","import Coordinates from \"./coordinates\";\r\n\r\n\r\n\r\n/**\r\n * A class that represents Workspace Camera Coords.\r\n * May be used in the future, right now its a no-op Coords wrapper.\r\n */\r\nclass WorkspaceCoords extends Coordinates {\r\n    constructor(x = 0, y = 0) {\r\n        super(x, y);\r\n    }\r\n}\r\nexport default WorkspaceCoords;","import Coordinates from \"./coordinates\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { Svg, SVG, Pattern, Rect } from '@svgdotjs/svg.js';\r\nimport Renderer from '../renderers/renderer';\r\nimport { InjectOptions } from \"./inject\";\r\nimport WorkspaceCoords from \"./workspace-coords\";\r\nimport WorkspaceController from '../controllers/base';\r\nimport WASDController from '../controllers/wasd';\r\nimport { RMap } from \"./renderer-map\";\r\nimport Toolbox from \"./toolbox\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport newHeadlessNode from \"./headless-node\";\r\nimport Widget from \"./widget\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport ContextMenuHTML from \"./context-menu\";\r\nimport CommentModel from \"./comment\";\r\nimport Field, { ConnectableField } from \"./field\";\r\nimport waitFrames from \"../util/wait-anim-frames\";\r\nimport { addWindowListener } from \"../util/window-listeners\";\r\nimport Grid from \"./grid\";\r\nimport UndoRedoHistory from \"./undo-redo\";\r\nimport hasProp from \"../util/has-prop\";\r\nimport Workspace from \"./workspace\";\r\nimport Themes from '../themes/themes';\r\nimport { Color } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\n\r\nexport interface IDragState {\r\n    isDragging: boolean;\r\n    startX: number;\r\n    startY: number;\r\n    lastX: number;\r\n    lastY: number;\r\n    deltaX: number;\r\n    deltaY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    node: NodeSvg | null;\r\n}\r\n\r\nfunction resolveController(options: InjectOptions): typeof WorkspaceController {\r\n    if (options?.controls) {\r\n        if (options?.controls.wasd) {\r\n            return WASDController;\r\n        }\r\n    }\r\n    return WorkspaceController;\r\n}\r\n\r\nexport interface WSTheme {\r\n    UIStyles?: {\r\n        workspaceBGColor?: Color;\r\n        toolboxCategoriesBG?: Partial<CSSStyleDeclaration>;\r\n        toolboxFlyoutBG?: Partial<CSSStyleDeclaration>;\r\n    }\r\n}\r\ntype ThemeKeys = keyof typeof Themes; // \"Classic\" | \"Dark\"\r\n/** \r\n * Represents the visual workspace containing nodes and connections.\r\n * Handles rendering, panning, and coordinate transformations.\r\n */\r\nclass WorkspaceSvg extends Workspace {\r\n    static get BACKGROUND_CLASS() {\r\n        return 'WorkspaceBackgroundRect';\r\n    }\r\n    /**\r\n     * Theme of the workspace\r\n     */\r\n    theme!: WSTheme;\r\n    /**\r\n     * Workspace background pattern items.\r\n     */\r\n    grid?: Grid;\r\n    /** Top-left offset of the workspace viewport */\r\n    _camera: WorkspaceCoords;\r\n\r\n    /** Node storage by unique ID */\r\n    _nodeDB: Map<string, NodeSvg>;\r\n\r\n    /** Root HTML container for the workspace */\r\n    _root: HTMLElement;\r\n\r\n    /** Top-level wrapper for the SVG */\r\n    _wsTop: HTMLElement;\r\n\r\n    /** SVG.js instance for rendering */\r\n    svg: Svg;\r\n    /** The background element */\r\n    _backgroundRect!: Rect;\r\n    /** Renderer instance for drawing nodes and connections */\r\n    renderer: Renderer;\r\n\r\n    /** Options for workspace behavior and rendering overrides */\r\n    options: InjectOptions;\r\n\r\n    /** Flag to temporarily prevent redraws */\r\n    noRedraw: boolean;\r\n    /**\r\n     * A class instance that moves the camera based on user interactions.\r\n     */\r\n    controller: WorkspaceController;\r\n    /**\r\n     * Toolbox for the workspace.\r\n     */\r\n    toolbox?: Toolbox;\r\n    /**\r\n     * A list of widgets active in this workspace\r\n     */\r\n    _widgetDB: Map<string, Widget>\r\n\r\n    /**\r\n     * A manager for the context menu widget\r\n     */\r\n    _ctxMenu: ContextMenuHTML\r\n    /**\r\n     * A list of comments for this workspace.\r\n     */\r\n    _commentDB: Set<CommentModel>;\r\n    /**\r\n     * Undo/redo history\r\n     */\r\n    history: UndoRedoHistory;\r\n    /**\r\n     * Whether to record undo/redo history or not\r\n     */\r\n    recordHistory: boolean = true;\r\n    /**\r\n     * Stack of old recordHistory values for toggleHistory\r\n     */\r\n    recordHistoryRecord: boolean[];\r\n    /**\r\n     * Internal flag to indicate if the camera has moved this frame.\r\n     */\r\n    _didMove: boolean = false;\r\n    /**\r\n     * Listeners to call when the workspace moves.\r\n     */\r\n    moveListeners: (() => void)[];\r\n    /** Current drag state for node dragging */\r\n    dragState: IDragState | null = null;\r\n    /**\r\n     * Creates a new WorkspaceSvg instance.\r\n     * @param root - The root HTML element containing the workspace.\r\n     * @param wsTop - The top-level wrapper element for the SVG.\r\n     * @param options - Configuration and renderer override options.\r\n     */\r\n    constructor(root: HTMLElement, wsTop: HTMLElement, options: InjectOptions) {\r\n        super();\r\n        this.isHeadless = false;\r\n        wsTop.style.width = '100%';\r\n        wsTop.style.height = '100%';\r\n\r\n        this._root = root;\r\n        this._wsTop = wsTop;\r\n        this.svg = SVG().addTo(this._wsTop).size('100%', '100%');\r\n        this.options = options;\r\n        let RClass: typeof Renderer = RMap.resolve(options.renderer);\r\n        this.renderer = new RClass(this, this.options.rendererOverrides || {});\r\n\r\n        const themeKey = (typeof options.theme === 'string' && options.theme in Themes)\r\n            ? options.theme as ThemeKeys\r\n            : 'Classic';\r\n\r\n        const theme = (typeof options.theme === 'object' && options.theme)\r\n            ? options.theme\r\n            : Themes[themeKey];\r\n\r\n        if (this.options.toolbox) {\r\n            this.toolbox = new Toolbox(this);\r\n        }\r\n\r\n        this._camera = new WorkspaceCoords(0, 0);\r\n        this._nodeDB = new Map();\r\n        this.noRedraw = false;\r\n        this.controller = new (options.Controller ?? resolveController(options))(this);\r\n        this._widgetDB = new Map();\r\n        this._ctxMenu = new ContextMenuHTML(this);\r\n        this._commentDB = new Set();\r\n        this.history = new UndoRedoHistory(this);\r\n        this.recordHistoryRecord = [];\r\n        this.moveListeners = [];\r\n        if (options.initUndoRedo !== false) {\r\n            this.history.emitChange();\r\n        }\r\n        this.theme = {}; //placeholder\r\n        this._initBackground();\r\n\r\n        this.setTheme(theme); // set theme to user-defined theme.\r\n    }\r\n    setTheme(theme: WSTheme) {\r\n        try {\r\n            this.theme = structuredClone(theme);\r\n        } catch {\r\n            this.theme = Object.assign({}, theme);\r\n        }\r\n        // Clone theme so you can mutate ws.theme seperate from Kabels.Themes[ThemeName]\r\n        if (this.toolbox) this.toolbox.updateStyles(this.theme);\r\n        if (this.theme.UIStyles) {\r\n            this._backgroundRect.fill(parseColor(this.theme.UIStyles.workspaceBGColor || '#fffffff'))\r\n        }\r\n    }\r\n    /**\r\n     * Getter and setter for whether we moved or not this frame.\r\n     */\r\n    get didMove() { return this._didMove; }\r\n    set didMove(value: boolean) {\r\n        this._didMove = value;\r\n        if (value) {\r\n            waitFrames(1, () => { this._didMove = false; });\r\n        }\r\n    }\r\n    /**\r\n     * Sets the drag state of the workspace.\r\n     * @param params - Drag state parameters.\r\n     * @returns Void.\r\n     */\r\n    setDragState(params: {\r\n        node: NodeSvg | null;\r\n        startX: number;\r\n        startY: number;\r\n        currentX: number;\r\n        currentY: number;\r\n        offsetX?: number;\r\n        offsetY?: number;\r\n    }) {\r\n        if (!params.node) {\r\n            this.dragState = null;\r\n            return;\r\n        }\r\n\r\n        const {\r\n            node,\r\n            startX,\r\n            startY,\r\n            currentX,\r\n            currentY,\r\n            offsetX = 0,\r\n            offsetY = 0\r\n        } = params;\r\n\r\n        this.dragState = {\r\n            isDragging: true,\r\n            node,\r\n            startX,\r\n            startY,\r\n            offsetX,\r\n            offsetY,\r\n            lastX: currentX,\r\n            lastY: currentY,\r\n            deltaX: currentX - startX,\r\n            deltaY: currentY - startY\r\n        };\r\n    }\r\n    beginDrag(node: NodeSvg, startX: number, startY: number, offsetX: number = 0, offsetY: number = 0) {\r\n        this.dragState = {\r\n            isDragging: true,\r\n            node,\r\n            startX,\r\n            startY,\r\n            offsetX,\r\n            offsetY,\r\n            lastX: startX,\r\n            lastY: startY,\r\n            deltaX: 0,\r\n            deltaY: 0\r\n        };\r\n    }\r\n    /**\r\n     * Updates the current drag position.\r\n     * @param currentX - Current X position.\r\n     * @param currentY - Current Y position.\r\n     * @returns Void.\r\n     */\r\n    updateDrag(currentX: number, currentY: number) {\r\n        if (!this.dragState || !this.dragState.node) return;\r\n\r\n        this.dragState.lastX = currentX;\r\n        this.dragState.lastY = currentY;\r\n        this.dragState.deltaX = currentX - this.dragState.startX;\r\n        this.dragState.deltaY = currentY - this.dragState.startY;\r\n    }\r\n    endDrag() {\r\n        // Set drag state.isDragging to false instead of clearing.\r\n        if (this.dragState) this.dragState.isDragging = false;\r\n    }\r\n\r\n\r\n    /**\r\n     * Fires all move listeners registered to this workspace.\r\n     */\r\n    fireMoveListeners() {\r\n        this.moveListeners.forEach(e => e());\r\n    }\r\n    /**\r\n     * Adds a move listener to the workspace.\r\n     * @param listener - The listener function to add.\r\n     * @returns A function to remove the added listener.\r\n     */\r\n    addMoveListener(listener: () => void): () => void {\r\n        this.moveListeners.push(listener);\r\n        return () => {\r\n            this.removeMoveListener(listener);\r\n        }\r\n    }\r\n    /**\r\n     * Removes a move listener from the workspace.\r\n     * @param listener - The listener function to remove.\r\n     */\r\n    removeMoveListener(listener: () => void) {\r\n        this.moveListeners = this.moveListeners.filter(e => e != listener);\r\n    }\r\n    /**\r\n     * Emits a change event for the workspace, triggering\r\n     * undo/redo history tracking.\r\n     */\r\n    emitChange() {\r\n        this.history.emitChange();\r\n    }\r\n\r\n    /**\r\n     * Temporarily sets the workspace's history recording state.\r\n     * Pushes the previous state onto a stack for later restoration.\r\n     * \r\n     * @param {boolean} value - Whether history recording should be enabled.\r\n     */\r\n    toggleHistory(value: boolean) {\r\n        this.recordHistoryRecord.push(this.recordHistory);\r\n        this.recordHistory = value;\r\n    }\r\n\r\n    /**\r\n     * Restores the previous history recording state from the stack.\r\n     * Use after a temporary toggle to revert to the previous state.\r\n     */\r\n    untoggleHistory() {\r\n        if (this.recordHistoryRecord.length == 0 || this.recordHistoryRecord.length < 0) return;\r\n        this.recordHistory = this.recordHistoryRecord.pop() as boolean;\r\n    }\r\n\r\n    /**\r\n     * Sets the background grid up based on user selected options.\r\n     */\r\n    _initBackground() {\r\n        try {\r\n            this._backgroundRect = this.svg.rect(this.svg.width(), this.svg.height())\r\n                .fill(parseColor(this.theme.UIStyles?.workspaceBGColor || '#ffffff'))\r\n                .addClass(WorkspaceSvg.BACKGROUND_CLASS)\r\n                .addTo(this.svg);\r\n\r\n            // ensure it has a parent\r\n            this.svg.add(this._backgroundRect);\r\n\r\n            // now you can safely move it to the back\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n        if (this.options.grid) {\r\n            this.grid = new Grid(this, this.svg, this.options.grid);\r\n        }\r\n        this._backgroundRect?.back();\r\n    }\r\n    /**\r\n     * Updates the transform of the background grid\r\n     */\r\n    _updateBackgroundTransform() {\r\n        this.grid?.updateTransform?.();\r\n        try {\r\n            this._backgroundRect.back();\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current zoom factor of the workspace.\r\n     * @returns - The zoom factor\r\n     */\r\n    getZoom() {\r\n        return this.controller.getZoom();\r\n    }\r\n    /**\r\n     * Refresh comments.\r\n     */\r\n    refreshComments() {\r\n        this.renderer.refreshComments();\r\n    }\r\n    /**\r\n     * Get all comments\r\n     * @returns {CommentModel[]}\r\n     */\r\n    getComments() {\r\n        return Array.from(this._commentDB);\r\n    }\r\n    /**\r\n     * Duplicate node data from one to another\r\n     * @param nodeSvg - The node\r\n     */\r\n    cloneNode(nodeSvg: NodeSvg) {\r\n        const n = new NodeSvg(nodeSvg.prototype, this);\r\n        n.init();\r\n        n.fromNode(nodeSvg);\r\n        this.redraw();\r\n    }\r\n    /**\r\n     * Internal: Add widget to DB\r\n     * @param wdgt - The widget\r\n     */\r\n    _addWidgetToDB(wdgt: Widget) {\r\n        this._widgetDB.set(wdgt.id, wdgt);\r\n    }\r\n    /**\r\n     * Internal: Delete a widget from DB.\r\n     * @param wdgt - Widget to delete\r\n     */\r\n    _delWidgetFromDB(wdgt: Widget) {\r\n        this._widgetDB.delete(wdgt.id);\r\n    }\r\n    /**\r\n     * Create a new widget of type.\r\n     * @param type - The prototype\r\n     * @returns {Widget|void}\r\n     */\r\n    newWidget(type: string): void | Widget {\r\n        const opts = WidgetPrototypes[type];\r\n        if (!opts) return;\r\n        if (opts.cls) {\r\n            const wdgt = new (opts.cls)(this, opts);\r\n            this._addWidgetToDB(wdgt);\r\n            return wdgt;\r\n        }\r\n        const wdgt = new Widget(this, opts);\r\n        this._addWidgetToDB(wdgt);\r\n        return wdgt;\r\n    }\r\n    /**\r\n     * Get a widget\r\n     * @param id - Identifier\r\n     * @returns {Widget|undefined} - A widget\r\n     */\r\n    getWidget(id: string): Widget | undefined {\r\n        if (this._widgetDB.has(id)) return this._widgetDB.get(id);\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace's svg content size in pixels.\r\n     * Useful for camera positioning.\r\n     */\r\n    getContentSize(): { width: number; height: number } {\r\n        const bbox = this.svg.bbox();\r\n        return { width: bbox.width, height: bbox.height };\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace in pixels.\r\n     * Useful for camera centering, zoom calculations, and viewport sizing.\r\n     */\r\n    getSize(): { width: number; height: number } {\r\n        const rect = this._wsTop.getBoundingClientRect();\r\n        return { width: rect.width, height: rect.height };\r\n    }\r\n\r\n    /**\r\n     * Updates all connection lines & node screen positions without a full redraw.\r\n     * Used when nodes are dragged or the camera moves.\r\n     */\r\n    refresh() {\r\n        this.renderer.refreshNodeTransforms();\r\n        this._updateBackgroundTransform();\r\n    }\r\n\r\n    /** Draws all nodes in the workspace. Very heavy. */\r\n    drawAllNodes() {\r\n        for (let [nodeId, _] of this._nodeDB) {\r\n            this.drawNode(nodeId);\r\n        }\r\n    }\r\n\r\n    /** Redraws the entire workspace unless noRedraw is set. */\r\n    redraw() {\r\n        if (this.noRedraw) return;\r\n        this.renderer.clearScreen();\r\n        this.drawAllNodes();\r\n        this.refresh();\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n\r\n    /**\r\n     * Converts workspace coordinates to screen (SVG) coordinates.\r\n     * @param x - X position in workspace coordinates.\r\n     * @param y - Y position in workspace coordinates.\r\n     * @returns Screen coordinates as a Coordinates instance.\r\n     */\r\n    workspaceToScreen(workX: number, workY: number) {\r\n        const zoom = this.getZoom();\r\n        // _camera represents the top-left of the visible viewport in workspace coords\r\n        const x = (workX - this._camera.x) * zoom;\r\n        const y = (workY - this._camera.y) * zoom;\r\n        return { x, y };\r\n    }\r\n\r\n    /**\r\n     * Converts screen (SVG) coordinates to workspace coordinates.\r\n     * @param x - X position in screen coordinates.\r\n     * @param y - Y position in screen coordinates.\r\n     * @returns Workspace coordinates as a Coordinates instance.\r\n     */\r\n    screenToWorkspace(screenX: number, screenY: number) {\r\n        const zoom = this.getZoom();\r\n        const workX = screenX / zoom + this._camera.x;\r\n        const workY = screenY / zoom + this._camera.y;\r\n        return { x: workX, y: workY };\r\n    }\r\n\r\n    /**\r\n     * Draws a node by its ID.\r\n     * @param id - The ID of the node to render.\r\n     * @returns The rendered node.\r\n     */\r\n    drawNode(id: string) {\r\n        return this.renderer.rerenderNode(this._nodeDB.get(id) as NodeSvg);\r\n    }\r\n\r\n    /**\r\n     * Adds a node to the workspace.\r\n     * @param node - The node instance to add.\r\n     * @param nodeId - Optional custom ID to use instead of node.id.\r\n     */\r\n    addNode(node: NodeSvg, nodeId?: string) {\r\n        let id = nodeId || node.id;\r\n        if (this._nodeDB.has(id)) {\r\n            console.warn(`Node with id ${id} already exists, overwriting.`);\r\n        }\r\n        if (node.workspace !== this) {\r\n            node.workspace = this;\r\n        }\r\n        this._nodeDB.set(id, node);\r\n        this.drawNode(id);\r\n        this.history.emitChange();\r\n\r\n    }\r\n\r\n    /**\r\n     * Create a new node of *type*.\r\n     * @param type - The node's prototype name.\r\n     */\r\n    newNode(type: keyof typeof NodePrototypes, add: boolean = true): NodeSvg | undefined {\r\n        if (!NodePrototypes[type]) return;\r\n        const node = newHeadlessNode(type as string);\r\n        if (!node) return;\r\n        if (add) this.addNode(node);\r\n        return node;\r\n    }\r\n    /**\r\n     * Spawns a node at x, y of prototype type\r\n     * @param type - The node prototype name\r\n     * @param x - X position\r\n     * @param y - Y position\r\n     * @returns {Node} - The new node\r\n     */\r\n    spawnAt(type: keyof typeof NodePrototypes, x: number, y: number): NodeSvg | undefined {\r\n        const node = this.newNode(type, false);\r\n        if (!node) return;\r\n        node.relativeCoords.set(x, y);\r\n        this.addNode(node);\r\n        this.drawNode(node.id);\r\n        return node;\r\n    }\r\n    /**\r\n     * Dereference a node from all of its connected neighbors\r\n     */\r\n    derefNode(node: NodeSvg) {\r\n        // Disconnect from previous node or field\r\n        const prev = node.previousConnection?.getFrom?.();\r\n        if (prev instanceof NodeSvg) {\r\n            prev.nextConnection?.disconnectTo();\r\n        } else if (prev instanceof ConnectableField && prev.hasConnectable()) {\r\n            prev.disconnect();\r\n        }\r\n\r\n        // Disconnect from next node\r\n        const next = node.nextConnection?.getTo?.();\r\n        if (next instanceof NodeSvg) {\r\n            next.previousConnection?.disconnectFrom();\r\n        }\r\n\r\n        // Disconnect all fields\r\n        for (let field of node.allFields()) {\r\n            if ((field as ConnectableField).hasConnectable?.()) {\r\n                (field as ConnectableField).disconnect();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Removes a node by its ID.\r\n     * @param id - The ID of the node to remove.\r\n     */\r\n    removeNodeById(id: string) {\r\n        const node = this._nodeDB.get(id);\r\n        if (!node) return;\r\n\r\n        this.derefNode(node);\r\n        this._nodeDB.delete(id);\r\n        this.redraw();\r\n        this.history.emitChange();\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * Removes a node by its instance.\r\n     * @param node - The node instance to remove.\r\n     */\r\n    removeNode(node: NodeSvg) {\r\n        if (!node) return;\r\n        this.removeNodeById(node.id);\r\n    }\r\n\r\n    /**\r\n     * Retrieves a node by its ID.\r\n     * @param id - The ID of the node.\r\n     * @returns The NodeSvg instance or undefined if not found.\r\n     */\r\n    getNode(id: string | NodeSvg): NodeSvg | undefined {\r\n        if (id instanceof NodeSvg) return id;\r\n        return this._nodeDB.get(id);\r\n    }\r\n\r\n    /**\r\n     * Pans the camera by the given delta values.\r\n     * @param dx - Change in X direction.\r\n     * @param dy - Change in Y direction.\r\n     */\r\n    pan(dx: number, dy: number) {\r\n        this.controller.pan(dx, dy);\r\n    }\r\n    /**\r\n     * Comment methods\r\n     */\r\n\r\n    /**\r\n     * Adds a comment, returns the model.\r\n     */\r\n    addComment() {\r\n        const model = new CommentModel(this);\r\n        this._commentDB.add(model);\r\n        this.redrawComments();\r\n        return model;\r\n    }\r\n    /**\r\n     * Gets a comment by id\r\n     * @param id - The comment id.\r\n     */\r\n    getComment(id: string) {\r\n        return Array.from(this._commentDB).find(e => e.id === id);\r\n    }\r\n    /**\r\n     * Remove a comment by its instance or id.\r\n     * @param commentOrId - The comment instance or its id.\r\n     */\r\n    removeComment(commentOrId: CommentModel | string) {\r\n        let comment: CommentModel | undefined;\r\n\r\n        if (typeof commentOrId === \"string\") {\r\n            comment = this.getComment(commentOrId);\r\n        } else {\r\n            comment = commentOrId;\r\n        }\r\n\r\n        if (!comment) return false;\r\n\r\n        this._commentDB.delete(comment);\r\n        this.redrawComments();\r\n        return true;\r\n    }\r\n    /**\r\n     * Redraw all comments in this workspace.\r\n     */\r\n    redrawComments() {\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n    /**\r\n     * Deserialize this workspace from json data.\r\n     * @param json - Serialized workspace\r\n     */\r\n    fromJson(json: { nodes: any[]; circular: boolean }, recordBigEvent: boolean = false) {\r\n        this.toggleHistory(false); // disable recording\r\n\r\n        for (let [_, node] of this._nodeDB.entries()) {\r\n            this.removeNode(node);\r\n        }\r\n        if (json.circular) {\r\n            for (let node of json.nodes) {\r\n                NodeSvg.deserialize(node, this);\r\n            }\r\n        } else {\r\n            for (let node of json.nodes) {\r\n                NodeSvg.fromJson(node, this);\r\n            }\r\n        }\r\n\r\n        this.untoggleHistory(); // restore previous history state\r\n\r\n        // only emit a single snapshot if we were told to treat it as a user-level event\r\n        if (recordBigEvent && this.recordHistory) {\r\n            this.history.emitChange();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Serialize this workspace, optionally using circular references.\r\n     */\r\n    toJson(circular: boolean) {\r\n        const nodes = [];\r\n        if (circular) {\r\n            for (let [id, node] of this._nodeDB) {\r\n                if (node.topLevel) {\r\n                    nodes.push(node.serialize());\r\n                }\r\n            }\r\n        } else {\r\n            for (let [id, node] of this._nodeDB) {\r\n                if (node.topLevel) {\r\n                    nodes.push(node.toJson());\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            circular,\r\n            nodes\r\n        }\r\n    }\r\n}\r\n\r\nexport default WorkspaceSvg;\r\n","// color-utils.ts\r\nimport type { Color, Hex } from '../src/visual-types';\r\n\r\n/**\r\n * Parse any Color type into a hex string \"#RRGGBB\"\r\n */\r\nexport function parseColor(color: Color): Hex {\r\n\tif (typeof color === 'string') {\r\n\t\tif (color.startsWith('#')) {\r\n\t\t\t// Already a hex string, normalize to full #RRGGBB\r\n\t\t\tlet hex = color.slice(1);\r\n\t\t\tif (hex.length === 3) hex = hex.split('').map(c => c + c).join('');\r\n\t\t\treturn `#${hex}`;\r\n\t\t} else {\r\n\t\t\t// RGB string \"r, g, b\"\r\n\t\t\tconst parts = color.split(',').map(s => parseInt(s.trim(), 10));\r\n\t\t\tif (parts.length !== 3) throw new Error(`Invalid RGB string: ${color}`);\r\n\t\t\tconst [r, g, b] = parts;\r\n            if ((!r && r!== 0) || (!g && g!== 0) || (!b && b !== 0)) {\r\n                console.warn(\r\n                    \"Invalid RGB tuple\"\r\n                );\r\n                return \"#000\";\r\n            }\r\n\t\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t\t.toString(16)\r\n\t\t\t\t.padStart(2, '0')}`;\r\n\t\t}\r\n\t} else if (Array.isArray(color)) {\r\n\t\t// RGBTuple [r,g,b]\r\n\t\tconst [r, g, b] = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t} else {\r\n\t\t// RGBObject {r,g,b}\r\n\t\tconst { r, g, b } = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t}\r\n}\r\n","// path.ts\r\n/**\r\n * Utility functions to generate SVG path strings or translate them.\r\n */\r\n\r\n/** Rounded rectangle */\r\nexport function roundedRect(width: number, height: number, radius: number): string {\r\n\tradius = Math.min(radius, width / 2, height / 2);\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tH${width - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width},${radius}\r\n\t\tV${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius},${height}\r\n\t\tH${radius}\r\n\t\tA${radius},${radius} 0 0 1 0,${height - radius}\r\n\t\tV${radius}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Rounded triangle pointing up */\r\nexport function roundedTri(width: number, height: number, radius: number): string {\r\n\tconst halfW = width / 2;\r\n\tradius = Math.min(radius, halfW, height / 2);\r\n\treturn `\r\n\t\tM${halfW},0\r\n\t\tL${width - radius},${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius*2},${height}\r\n\t\tL${radius*2},${height}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},${height - radius}\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Circle */\r\nexport function circle(radius: number): string {\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${-radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Ellipse */\r\nexport function ellipse(rx: number, ry: number): string {\r\n\treturn `\r\n\t\tM${rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${-rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${rx},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Star with n points */\r\nexport function star(radius: number, points: number = 5): string {\r\n\tif (points < 2) throw new Error('Star must have at least 2 points');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / (points * 2);\r\n\tfor (let i = 0; i < points * 2; i++) {\r\n\t\tconst r = i % 2 === 0 ? radius : radius / 2;\r\n\t\tconst x = r * Math.sin(i * step);\r\n\t\tconst y = -r * Math.cos(i * step);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\n\r\n/** Regular polygon (triangle, pentagon, hexagon, etc) */\r\nexport function polygon(radius: number, sides: number = 3): string {\r\n\tif (sides < 3) throw new Error('Polygon must have at least 3 sides');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / sides;\r\n\tfor (let i = 0; i < sides; i++) {\r\n\t\tconst x = radius * Math.cos(i * step - Math.PI / 2);\r\n\t\tconst y = radius * Math.sin(i * step - Math.PI / 2);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\nimport SvgPath from 'svgpath';\r\n\r\n/**\r\n * Rotate an SVG path string around a given point\r\n * @param path - SVG path string\r\n * @param angle - rotation angle in degrees\r\n * @param cx - x-coordinate of rotation center (default 0)\r\n * @param cy - y-coordinate of rotation center (default 0)\r\n * @returns new rotated SVG path string\r\n */\r\nexport function rotatePath(path: string, angle: number, cx = 0, cy = 0): string {\r\n\treturn new SvgPath(path)\r\n\t\t.rotate(angle, cx, cy)\r\n\t\t.toString();\r\n}\r\n","'use strict';\n\n\nvar Matrix = require('./matrix');\n\nvar operations = {\n  matrix: true,\n  scale: true,\n  rotate: true,\n  translate: true,\n  skewX: true,\n  skewY: true\n};\n\nvar CMD_SPLIT_RE    = /\\s*(matrix|translate|scale|rotate|skewX|skewY)\\s*\\(\\s*(.+?)\\s*\\)[\\s,]*/;\nvar PARAMS_SPLIT_RE = /[\\s,]+/;\n\n\nmodule.exports = function transformParse(transformString) {\n  var matrix = new Matrix();\n  var cmd, params;\n\n  // Split value into ['', 'translate', '10 50', '', 'scale', '2', '', 'rotate',  '-45', '']\n  transformString.split(CMD_SPLIT_RE).forEach(function (item) {\n\n    // Skip empty elements\n    if (!item.length) { return; }\n\n    // remember operation\n    if (typeof operations[item] !== 'undefined') {\n      cmd = item;\n      return;\n    }\n\n    // extract params & att operation to matrix\n    params = item.split(PARAMS_SPLIT_RE).map(function (i) {\n      return +i || 0;\n    });\n\n    // If params count is not correct - ignore command\n    switch (cmd) {\n      case 'matrix':\n        if (params.length === 6) {\n          matrix.matrix(params);\n        }\n        return;\n\n      case 'scale':\n        if (params.length === 1) {\n          matrix.scale(params[0], params[0]);\n        } else if (params.length === 2) {\n          matrix.scale(params[0], params[1]);\n        }\n        return;\n\n      case 'rotate':\n        if (params.length === 1) {\n          matrix.rotate(params[0], 0, 0);\n        } else if (params.length === 3) {\n          matrix.rotate(params[0], params[1], params[2]);\n        }\n        return;\n\n      case 'translate':\n        if (params.length === 1) {\n          matrix.translate(params[0], 0);\n        } else if (params.length === 2) {\n          matrix.translate(params[0], params[1]);\n        }\n        return;\n\n      case 'skewX':\n        if (params.length === 1) {\n          matrix.skewX(params[0]);\n        }\n        return;\n\n      case 'skewY':\n        if (params.length === 1) {\n          matrix.skewY(params[0]);\n        }\n        return;\n    }\n  });\n\n  return matrix;\n};\n","import WorkspaceController from './base';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WASDController extends WorkspaceController {\r\n    moveSpeed: number;\r\n    doAccelerate?: boolean;\r\n    accelSpeed: number;\r\n    friction: number;\r\n    velocity: Vec2;\r\n    zoom: number = 1;\r\n    zoomSpeed: number;\r\n    minZoom: number;\r\n    maxZoom: number;\r\n    isFalloff: boolean;\r\n    constructor(workspace: WorkspaceSvg, moveSpeed?: number) {\r\n        super(workspace);\r\n        this.moveSpeed = workspace.options.moveSpeed || moveSpeed || 5;\r\n\r\n        this.doAccelerate = workspace.options?.controls?.wasdSmooth ?? false;\r\n        this.accelSpeed = workspace.options?.controls?.wasdAccelerate ?? 0.2;\r\n        this.friction = workspace.options?.controls?.wasdFriction ?? 0.85;\r\n\r\n        this.velocity = { x: 0, y: 0 };\r\n        this.isFalloff = false;\r\n\r\n        // Zoom settings\r\n        this.zoomSpeed = workspace.options?.controls?.zoomSpeed ?? 0.1;\r\n        this.minZoom = workspace.options?.controls?.minZoom ?? 0.1;\r\n        this.maxZoom = workspace.options?.controls?.maxZoom ?? 4;\r\n        this.zoom = 1;\r\n        // Bind wheel for zoom\r\n        workspace._wsTop.addEventListener('wheel', this.onWheel.bind(this), { passive: false });\r\n    }\r\n\r\n    canMove() {\r\n        return !userState.hasState('typing');\r\n    }\r\n\r\n    update() {\r\n        super.update();\r\n        if (!this.canMove()) return;\r\n\r\n        let inputX = 0;\r\n        let inputY = 0;\r\n\r\n        if (this.keysDown.has('w') || this.keysDown.has('ArrowUp')) inputY -= 1;\r\n        if (this.keysDown.has('s') || this.keysDown.has('ArrowDown')) inputY += 1;\r\n        if (this.keysDown.has('a') || this.keysDown.has('ArrowLeft')) inputX -= 1;\r\n        if (this.keysDown.has('d') || this.keysDown.has('ArrowRight')) inputX += 1;\r\n\r\n        if (this.doAccelerate) {\r\n            // Accelerate velocity towards input direction\r\n            this.velocity.x += inputX * this.accelSpeed;\r\n            this.velocity.y += inputY * this.accelSpeed;\r\n\r\n            // Apply friction\r\n            this.velocity.x *= this.friction;\r\n            this.velocity.y *= this.friction;\r\n            if (inputX == 0 && inputY == 0) {\r\n                this.isFalloff = true;\r\n            } else {\r\n                this.isFalloff = false;\r\n            }\r\n            // Only pan if velocity is noticeable\r\n            if (Math.abs(this.velocity.x) > 0.01 || Math.abs(this.velocity.y) > 0.01) {\r\n                this.pan(this.velocity.x, this.velocity.y);\r\n            }\r\n        } else {\r\n            // Instant movement\r\n            const dx = inputX * this.moveSpeed;\r\n            const dy = inputY * this.moveSpeed;\r\n            if (dx !== 0 || dy !== 0) this.pan(dx, dy);\r\n        }\r\n    }\r\n    pan(dx: number, dy: number) {\r\n        const x = this.workspace._camera.x, y = this.workspace._camera.y;\r\n        this.workspace._camera.x += dx;\r\n        this.workspace._camera.y += dy;\r\n        if (x == this.workspace._camera.x && y == this.workspace._camera.y) {\r\n            return;\r\n        }\r\n        if (!this.isFalloff) {\r\n            this._throttledFireDidMove();\r\n            this.workspace.didMove = true;\r\n            this.workspace.fireMoveListeners();\r\n            this.refreshPos();\r\n        }\r\n        this.refreshPos();\r\n    }\r\n    /**\r\n     * Handles wheel events for zooming.\r\n     * Zooms around the mouse position for intuitive zooming.\r\n     */\r\n    onWheel(e: WheelEvent) {\r\n        e.preventDefault();\r\n\r\n        const oldZoom = this.getZoom();\r\n        let delta = -e.deltaY * this.zoomSpeed * 0.01; // normalize wheel\r\n        let newZoom = oldZoom * (1 + delta);\r\n\r\n        // Clamp zoom\r\n        newZoom = Math.max(this.minZoom, Math.min(this.maxZoom, newZoom));\r\n\r\n        // Zoom around cursor\r\n        const mouseX = e.clientX;\r\n        const mouseY = e.clientY;\r\n\r\n        const wsMouse = this.workspace.screenToWorkspace(mouseX, mouseY);\r\n\r\n        // Apply new zoom\r\n        this.setZoom(newZoom);\r\n\r\n        // Adjust camera so the point under cursor stays stable\r\n        this.workspace._camera.x = wsMouse.x - mouseX / newZoom;\r\n        this.workspace._camera.y = wsMouse.y - mouseY / newZoom;\r\n\r\n        this.workspace.refresh();\r\n    }\r\n\r\n    /** Returns current zoom level */\r\n    getZoom() {\r\n        return this.zoom;\r\n    }\r\n\r\n    /** Sets zoom directly */\r\n    setZoom(zoom: number) {\r\n        this.zoom = zoom;\r\n    }\r\n}\r\n","\r\n\r\n// fonts-manager.ts\r\n\r\nconst loadedFonts: Record<string, Promise<void>> = {};\r\n\r\n/**\r\n * Load a Google Font by name and optional weights.\r\n * Returns a promise that resolves when the font is available.\r\n */\r\nexport function loadGoogleFont(\r\n\tname: string,\r\n\tweights: number[] = [400, 700]\r\n): Promise<void> {\r\n\tif (loadedFonts[name]) return loadedFonts[name]; // already loading/loaded\r\n\r\n\tconst linkId = `gf-${name.replace(/\\s+/g, '-')}`;\r\n\tif (!document.getElementById(linkId)) {\r\n\t\tconst link = document.createElement('link');\r\n\t\tlink.id = linkId;\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tconst weightsParam = weights.join(';');\r\n\t\tlink.href = `https://fonts.googleapis.com/css2?family=${name.replace(\r\n\t\t\t/\\s+/g,\r\n\t\t\t'+'\r\n\t\t)}:wght@${weightsParam}&display=swap`;\r\n\t\tdocument.head.appendChild(link);\r\n\t}\r\n\r\n\t// wait for all requested weights to be loaded\r\n\tconst fontPromises = weights.map((w) =>\r\n\t\tdocument.fonts.load(`${w} 1em ${name}`)\r\n\t);\r\n\r\n\tconst promise = Promise.all(fontPromises).then(() => undefined);\r\n\tloadedFonts[name] = promise;\r\n\treturn promise;\r\n}\r\n","import { Element, Svg } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport Renderer, { ConnectorToFrom, DrawState } from '../renderers/renderer';\r\n\r\n\r\n\r\nfunction initConnectionLine(element: Element, args: Record<string, any>): () => void {\r\n    // click destroys the line\r\n    const handleClick = () => {\r\n        args.fromConn.disconnectTo();\r\n        args.toConn.disconnectFrom();\r\n        element.remove();\r\n        xMark.remove();\r\n        const remove: ConnectorToFrom[] = [];\r\n        for (let state of args.renderer._drawStates as DrawState[]) {\r\n            for (let pair of state.pendingConnections) {\r\n                if (pair.from == args.fromConn && pair.to == args.toConn) {\r\n                    remove.push(pair);\r\n                }\r\n                if (pair.from = args.toConn && pair.to == args.fromConn) {\r\n                    remove.push(pair);\r\n                }\r\n            }\r\n            state.pendingConnections = state.pendingConnections.filter(e => !remove.includes(e));\r\n        }\r\n    };\r\n\r\n    // create X element\r\n    const bbox = element.bbox();\r\n    const midX = bbox.x + bbox.width / 2;\r\n    const midY = bbox.y + bbox.height / 2;\r\n    const xMark = (element.parent()! as Svg).text('X').font({\r\n        family: 'Fredoka, sans-serif',\r\n        size: 46,\r\n        weight: '700',\r\n        anchor: 'middle',\r\n        leading: '1em'\r\n    })\r\n        .addClass((args.renderer.constructor as typeof Renderer).LINE_X_MARK_TAG)\r\n        .center(midX, midY)\r\n        .fill('#fff')           // white fill\r\n        .stroke({ color: '#000', width: 2 })  // black outline\r\n        .hide();\r\n\r\n    xMark.on('click', handleClick)\r\n    xMark.node.style.userSelect = 'none';\r\n    // show X on hover\r\n    element.on('mouseover', () => xMark.show());\r\n    element.on('mouseout', () => xMark.hide());\r\n\r\n    // attach click event\r\n    element.on('click', handleClick);\r\n\r\n    // cleanup function\r\n    return () => {\r\n        element.off('click', handleClick);\r\n        element.off('mouseover');\r\n        element.off('mouseout');\r\n        xMark.off('click', handleClick);\r\n        xMark.remove();\r\n    };\r\n}\r\n// ok\r\neventer.registerEvent('k_connline', initConnectionLine as EventSetupFn);\r\n","import Connection, { Connectable } from \"./connection\";\r\nimport { G, Path, Rect, Svg, SVG, Text } from '@svgdotjs/svg.js';\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { ConnectorToFrom } from \"../renderers/renderer\";\r\nimport dropdownContainer, { DropdownOptions } from \"./dropdown-menu\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n/**\r\n * Options used to initialize a Field.\r\n */\r\nexport interface FieldOptions {    /** Name of the field */\r\n    name: string;\r\n    /** Human-readable label for the field */\r\n    label: string;\r\n    /** Key used to identify the field type in FieldTypesMap */\r\n    type: string;\r\n    /** Field value (optional) */\r\n    value?: any;\r\n    /** Only used by OptConnectField to determine internal value type */\r\n    fld_type?: \"number\" | \"string\";\r\n    [key: string]: any;\r\n};\r\n\r\nexport interface FieldVisualInfo {\r\n    measuredWidth: number; // The width approximated by the field itself.\r\n    measuredHeight: number; // The height approximated by the field itself.\r\n    background: Rect; // The node's background element.\r\n    svg: Svg; // The workspace's SVG.js svg\r\n    nodeGroup: G; // Group for the node\r\n    fieldGroup: G; // A group containing the label & input.\r\n    xUsed: number; // The amount of x space used up by the label.\r\n}\r\nexport interface FieldRawBoxData {\r\n    box: Rect;\r\n    txt: Text;\r\n}\r\nexport interface FieldConnectionData {\r\n    connector: Path;\r\n    connState: ConnectorToFrom\r\n}\r\n/**\r\n * Base class for all fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nclass Field<T = any> {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n    protected value: T | null;\r\n    static register(name: string, cls: Function) { };\r\n    static unregister(name: string) { };\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.value = null;\r\n        this.editable = true;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n        if (json.value !== undefined) this.value = json.value;\r\n        if (json.editable) this.setEditable(Boolean(json.editable));\r\n    }\r\n\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: null, height: null }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /** @returns The stored value */\r\n    getValue(): T | null {\r\n        return this.value;\r\n    }\r\n\r\n    /**\r\n     * Set the stored value\r\n     * @param val New value\r\n     */\r\n    setValue(val: T) {\r\n        this.value = val;\r\n    }\r\n\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue(): T | null {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Used when you want just a label with no actual value. Any value related methods are no-op.\r\n */\r\nexport class DummyField {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.editable = false;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n    }\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: 0, height: 0 }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /**\r\n     * Dummy fields have no value.\r\n     * @returns {null}\r\n     */\r\n    getValue() {\r\n        return null;\r\n    }\r\n    /**\r\n     * No-op for dummy fields\r\n     */\r\n    setValue(_: any) { }\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue() {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Base class for fields that can be connected to other fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nexport class ConnectableField<T = any> extends Field<T> {\r\n    connection: Connection;\r\n\r\n    constructor() {\r\n        super();\r\n        this.connection = new Connection(this, null);\r\n        this.value = null as T;\r\n    }\r\n    hasConnectable(): boolean {\r\n        return true;\r\n    }\r\n\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** Disconnect this field from any connected Connectable */\r\n    disconnect() {\r\n        const to = this.connection.to;\r\n        if (to instanceof NodeSvg && to?.previousConnection?.from) {\r\n            to.previousConnection.from = null;\r\n            this.connection.to = null;\r\n        }\r\n    }\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        super.fromJson(json);\r\n\r\n        // If the value is a serialized node, rebuild it\r\n        if (json.value && typeof json.value === \"object\" && json.value.id) {\r\n            this.value = NodeSvg._deserialize(json.value, {}, workspace) as any;\r\n            this.connection.setTo(this.value as Connectable);\r\n        } else if (json.value instanceof NodeSvg) {\r\n            this.value = json.value as any;\r\n            this.connection.setTo(this.value as Connectable);\r\n        } else {\r\n            this.value = json.value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: alreadyProcessed[val.id] ? (deep ? alreadyProcessed[val.id] : val.id) : val.serialize(alreadyProcessed) };\r\n\r\n        return {\r\n            ...super.toJson(true, alreadyProcessed),\r\n            value: val\r\n        };\r\n    }\r\n}\r\n\r\n/** Field storing a numeric value */\r\nexport class NumberField extends Field<number> {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        if (json.value !== undefined) this.setValue(Number(json.value));\r\n    }\r\n    setValue(val: number) {\r\n        this.value = Number(val);\r\n    }\r\n}\r\n\r\n/** Field storing a string value */\r\nexport class TextField extends Field<string> {\r\n    constructor() {\r\n        super();\r\n    }\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        if (json.value !== undefined) this.setValue(String(json.value));\r\n    }\r\n    setValue(val: string) {\r\n        this.value = String(val);\r\n    }\r\n}\r\n\r\n/**\r\n * Optional connectable field.\r\n * Can store either a number or string depending on fld_type.\r\n */\r\nexport class OptConnectField extends ConnectableField<number | string | NodeSvg> {\r\n    fldType: \"number\" | \"string\";\r\n\r\n    constructor() {\r\n        super();\r\n        this.fldType = \"string\";\r\n    }\r\n    canEditConnector(): boolean {\r\n        return true;\r\n    }\r\n    canEdit() {\r\n        if (this.getValue() instanceof NodeSvg) {\r\n            return false;\r\n        }\r\n        return this.editable;\r\n    }\r\n    getValue(): string | number | NodeSvg | null {\r\n        if (this.connection && this.connection.getTo()) {\r\n            return this.connection.getTo() as NodeSvg;\r\n        } else {\r\n            return this.value;\r\n        }\r\n    }\r\n    hasRaw() {\r\n        return true;\r\n    }\r\n    hasConnectable() {\r\n        return true;\r\n    }\r\n    /**\r\n     * Set field type.\r\n     * @param type \"number\"|\"string\"\r\n     */\r\n    setFieldType(type: \"number\" | \"string\") {\r\n        this.fldType = type;\r\n    }\r\n    /**\r\n     * Initialize from JSON, respecting fld_type\r\n     * @param json FieldOptions\r\n     */\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        super.fromJson(json, workspace);\r\n        this.fldType = json.fld_type || \"string\";\r\n        if (this.value != null && typeof this.value === this.fldType) {\r\n            this.setValue(this.value as number | string);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set the value, converting to number or string depending on fld_type\r\n     * @param val The new value\r\n     */\r\n    setValue(val: number | string) {\r\n        if (this.fldType === \"number\") this.value = Number(val);\r\n        else this.value = String(val);\r\n    }\r\n\r\n    /**\r\n     * @returns Display value for UI purposes (never null)\r\n     */\r\n    getDisplayValue(): string {\r\n        if (this.value == null) return this.fldType === \"number\" ? \"0\" : \"\";\r\n        if (this.getValue() instanceof NodeSvg) return '[NODE]'; // If theres a connection\r\n        return String(this.value);\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: deep ? val.serialize(alreadyProcessed) : val.id };\r\n\r\n        return {\r\n            ...super.toJson(true, alreadyProcessed),\r\n            fld_type: this.fldType,\r\n            value: val\r\n        };\r\n    }\r\n}\r\nexport type DropdownItem = { text: string, value: string } | string\r\nexport class DropdownField extends Field<string> {\r\n    options: DropdownItem[] | null;\r\n    _selected: DropdownItem | null;\r\n    _isOpen: boolean;\r\n\r\n    constructor() {\r\n        super();\r\n        this.options = null;\r\n        this._selected = null;\r\n        this._isOpen = false;\r\n    }\r\n\r\n    onDraw(rawBox?: FieldRawBoxData) {\r\n        if (!rawBox || !this.options) return;\r\n\r\n        const { box, txt } = rawBox;\r\n        const toggle = () => this.toggleDropdown(rawBox);\r\n        box.click(toggle);\r\n        txt.click(toggle);\r\n    }\r\n\r\n    private toggleDropdown(rawBox: FieldRawBoxData) {\r\n        if (dropdownContainer.getOwner() === this) {\r\n            this.closeDropdown();\r\n        } else {\r\n            this.openDropdown(rawBox);\r\n        }\r\n        rawBox.txt.text(this.getDisplayValue());\r\n    }\r\n\r\n    private openDropdown(rawBox: FieldRawBoxData) {\r\n        if (!this.options) return;\r\n\r\n        const items = this.options.map(option => ({\r\n            label: typeof option === 'string' ? option : option.text,\r\n            value: typeof option === 'string' ? option : option.value\r\n        }));\r\n\r\n        dropdownContainer.show(this, {\r\n            items,\r\n            width: rawBox.box.bbox().width * 2,\r\n            onSelect: (value: string) => {\r\n                if (!this.options) return;\r\n                const original = this.options.find(\r\n                    e => e === value || (typeof e !== 'string' && e.value === value)\r\n                );\r\n                if (original) {\r\n                    this._selected = original;\r\n                    this.setValue(value);\r\n                    this.closeDropdown();\r\n                    this?.node?.workspace?.emitChange?.();\r\n                    this?.node?.workspace?.renderer?.rerenderNode?.(this.node);\r\n                }\r\n            }\r\n        } as DropdownOptions);\r\n    }\r\n\r\n    private closeDropdown() {\r\n        dropdownContainer.hideIfOwner(this);\r\n    }\r\n\r\n    canEdit() {\r\n        return false;\r\n    }\r\n\r\n    getSelected() {\r\n        return this._selected;\r\n    }\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        this.options = json.options as DropdownItem[] || null;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(typeof this._selected === 'string' ? this._selected : this._selected.value);\r\n    }\r\n\r\n    /**\r\n     * Display value of dropdowns.\r\n     * @returns - Display value\r\n     */\r\n    getDisplayValue(): string {\r\n        const text = typeof this._selected === 'string' ? this._selected : this._selected?.text || '';\r\n        const arrow = dropdownContainer.getOwner() == this ? '' : ''; // toggles open/closed\r\n        return text + '  ' + arrow;\r\n    }\r\n\r\n    /**\r\n     * Set options on this dropdown\r\n     * @param options - List of options\r\n     */\r\n    setOptions(options: DropdownItem[]) {\r\n        this.options = options;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(\r\n            typeof this._selected === 'string' ? this._selected : this._selected.value\r\n        );\r\n    }\r\n    /**\r\n     * \r\n     * @param deep - Whether to recursive it.\r\n     * @param alreadyProcessed - Map of already serialized nodes.\r\n     * @returns - Json of this field.\r\n     */\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return { ...super.toJson(deep, alreadyProcessed), options: this.options };\r\n    }\r\n}\r\n\r\n/**\r\n * Any field instance type\r\n */\r\nexport type AnyField = Field | OptConnectField | NumberField | TextField | DummyField | ConnectableField;\r\n/**\r\n * Any field class type\r\n */\r\nexport type AnyFieldCls = typeof Field | typeof OptConnectField | typeof ConnectableField | typeof NumberField | typeof TextField | typeof DummyField;\r\nexport const FieldMap: {\r\n    field_both: typeof OptConnectField;\r\n    field_string: typeof TextField;\r\n    field_num: typeof NumberField;\r\n    field_dummy: typeof DummyField;\r\n    field_str: typeof TextField;\r\n    connection: typeof ConnectableField;\r\n    [key: string]: AnyFieldCls;\r\n} = {\r\n    'field_both': OptConnectField,\r\n    'field_string': TextField,\r\n    'field_num': NumberField,\r\n    'field_dummy': DummyField,\r\n    'field_str': TextField,\r\n    'connection': ConnectableField,\r\n    'dropdown': DropdownField\r\n}\r\n\r\n\r\nexport default Field;\r\n","import type RendererType from \"../renderers/renderer\";\r\nimport Renderer from \"../renderers/renderer\";\r\n/**\r\n * Interface for the renderer map.\r\n * Maps a string key (renderer name) to a renderer class.\r\n */\r\ninterface RendererMapInterface {\r\n    [key: string]: typeof RendererType;\r\n}\r\n\r\n// Top-level renderer map storage\r\nconst RendererMap: RendererMapInterface = {};\r\n\r\n/**\r\n * Class for managing registered renderer classes.\r\n * Provides methods to register, delete, get, list, and resolve renderers.\r\n */\r\nclass RMap {\r\n    /**\r\n     * Registers a renderer class under a given name.\r\n     * @param RendererCls The renderer class to register\r\n     * @param optName Optional name to register under. Defaults to `RendererCls.NAME`\r\n     */\r\n    static register(RendererCls: typeof RendererType, optName?: string) {\r\n        const name = optName ?? RendererCls.NAME;\r\n        RendererMap[name] = RendererCls;\r\n    }\r\n\r\n    /**\r\n     * Deletes a renderer from the map by name.\r\n     * Cannot delete the \"default\" renderer.\r\n     * @param name The name of the renderer to delete\r\n     * @returns `true` if deleted, `false` otherwise\r\n     */\r\n    static delete(name: string) {\r\n        if (name === 'default') return false;\r\n        if (RendererMap[name]) {\r\n            delete RendererMap[name];\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Retrieves a renderer class by name.\r\n     * Returns the default renderer if the name is not found.\r\n     * @param name The name of the renderer to get\r\n     * @returns The renderer class\r\n     */\r\n    static get(name: string): typeof RendererType {\r\n        const Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n        return RendererMap[name] ?? RendererMap['default'] ?? Renderer;\r\n    }\r\n\r\n    /**\r\n     * Lists all registered renderer names.\r\n     * @returns Array of registered renderer names\r\n     */\r\n    static list() {\r\n        return Object.keys(RendererMap);\r\n    }\r\n\r\n    /**\r\n     * Resolves input into a renderer class.\r\n     * - If `input` is undefined, returns the default renderer\r\n     * - If `input` is a string, returns the renderer with that name\r\n     * - If `input` is a class, returns the class itself\r\n     * @param input Optional renderer name or class\r\n     * @returns Renderer class\r\n     */\r\n    static resolve(input?: string | typeof RendererType): typeof RendererType {\r\n        const Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n\r\n        if (!input) return RendererMap['default'] ?? Renderer;\r\n\r\n        if (typeof input === 'string') return RMap.get(input);\r\n\r\n        if (typeof input === 'function') return input as typeof RendererType;\r\n\r\n        return RendererMap['default'] ?? Renderer;\r\n    }\r\n}\r\n\r\n// Default renderers registered in core.ts\r\n\r\nexport { RMap, RendererMap };\r\n","import { Svg, Pattern, Rect } from \"@svgdotjs/svg.js\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport { addWindowListener } from \"../util/window-listeners\";\r\n\r\n/**\r\n * Options for configuring the workspace grid.\r\n * @typedef {Object} GridOptions\r\n * @property {\"dotted\"|\"celled\"} [type=\"dotted\"] - The type of grid to render.\r\n * @property {number} [spacing=40] - The spacing between grid dots or cells.\r\n * @property {number} [dotSize=2] - The radius of the dots (only for dotted type).\r\n * @property {number} [strokeWidth=2] - Stroke width of the cells (only for celled type).\r\n * @property {string} [color=\"#bebebeff\"] - Color of the grid.\r\n */\r\nexport interface GridOptions {\r\n    type?: \"dotted\" | \"celled\";\r\n    spacing?: number;\r\n    dotSize?: number;\r\n    strokeWidth?: number;\r\n    color?: string;\r\n}\r\n\r\n/**\r\n * Handles drawing and managing a workspace background grid.\r\n */\r\nexport default class Grid {\r\n    private ws: WorkspaceSvg;\r\n    private svg: Svg;\r\n    private pattern?: Pattern;\r\n    private rect?: Rect;\r\n\r\n    /** Cached + normalized grid values */\r\n    private grid: Required<GridOptions>;\r\n\r\n    /**\r\n     * Creates a new Grid instance and attaches it to the given workspace SVG.\r\n     * @param {WorkspaceSvg} ws - The workspace this grid belongs to.\r\n     * @param {Svg} svg - The SVG element to draw the grid into.\r\n     * @param {GridOptions} opts - Initial options for the grid.\r\n     */\r\n    constructor(ws: WorkspaceSvg, svg: Svg, opts: GridOptions) {\r\n        this.ws = ws;\r\n        this.svg = svg;\r\n\r\n        this.grid = {\r\n            type: opts.type ?? \"dotted\",\r\n            spacing: opts.spacing ?? 40,\r\n            dotSize: opts.dotSize ?? 2,\r\n            strokeWidth: opts.strokeWidth ?? 2,\r\n            color: opts.color ?? \"#bebebeff\",\r\n        };\r\n\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Initializes the grid pattern, background rect, and attaches resize listener.\r\n     * @private\r\n     */\r\n    private init() {\r\n        if (this.rect) {\r\n            this.rect.remove();\r\n        }\r\n        const { type, spacing, dotSize, strokeWidth, color } = this.grid;\r\n\r\n        let defs = this.svg.findOne(\"defs\");\r\n        if (!defs) defs = this.svg.defs();\r\n\r\n        this.pattern = this.svg.pattern(spacing, spacing, (add) => {\r\n            if (type === \"dotted\") {\r\n                add\r\n                    .circle(dotSize * 2)\r\n                    .fill(color)\r\n                    .move(spacing / 2 - dotSize, spacing / 2 - dotSize);\r\n            } else {\r\n                add.rect(spacing, spacing).stroke({ color, width: strokeWidth }).fill(\"none\");\r\n            }\r\n        });\r\n        this.pattern.attr({ patternUnits: \"userSpaceOnUse\" });\r\n        defs.add(this.pattern);\r\n\r\n        const { width, height } = this.ws.getSize();\r\n        this.rect = this.svg\r\n            .rect(width, height)\r\n            .fill(this.pattern)\r\n            .back()\r\n            .addClass(\"WorkspaceBgPattern\");\r\n\r\n        addWindowListener(\"resize\", () => this.resize());\r\n    }\r\n\r\n    /**\r\n     * Resizes the grid background rect to fit the workspace size.\r\n     */\r\n    resize() {\r\n        if (!this.rect) return;\r\n        const { width, height } = this.ws.getSize();\r\n        this.rect.size(width, height).back();\r\n        this.ws._backgroundRect.back();\r\n    }\r\n\r\n    /**\r\n     * Updates the grid pattern transform according to zoom and camera position.\r\n     * Scales the dots/cells to match zoom and repositions them based on camera.\r\n     */\r\n    updateTransform() {\r\n        if (!this.pattern || !this.rect) return;\r\n        const { type, spacing, dotSize, strokeWidth, color } = this.grid;\r\n\r\n        const zoom = this.ws.getZoom();\r\n        const scaledSpacing = spacing * zoom;\r\n\r\n        this.pattern.attr({ width: scaledSpacing, height: scaledSpacing });\r\n        this.pattern.clear();\r\n\r\n        if (type === \"dotted\") {\r\n            const scaledDot = Math.max(dotSize * zoom, 0.5);\r\n            this.pattern\r\n                .circle(scaledDot * 2)\r\n                .fill(color)\r\n                .move(scaledSpacing / 2 - scaledDot, scaledSpacing / 2 - scaledDot);\r\n        } else {\r\n            this.pattern\r\n                .rect(scaledSpacing, scaledSpacing)\r\n                .stroke({ color, width: strokeWidth * zoom })\r\n                .fill(\"none\");\r\n        }\r\n\r\n        const cam = this.ws._camera;\r\n        this.pattern.attr({\r\n            patternTransform: `translate(${-cam.x * zoom % scaledSpacing}, ${-cam.y * zoom % scaledSpacing})`,\r\n        });\r\n\r\n        this.resize();\r\n        this.ws._backgroundRect.back();\r\n    }\r\n\r\n    /**\r\n     * Updates internal grid options from the workspace configuration.\r\n     */\r\n    updateOptions() {\r\n        const opts = this.ws.options!.grid;\r\n        this.grid = {\r\n            type: opts!.type ?? \"dotted\",\r\n            spacing: opts!.spacing ?? 40,\r\n            dotSize: opts!.dotSize ?? 2,\r\n            strokeWidth: opts!.strokeWidth ?? 2,\r\n            color: opts!.color ?? \"#bebebeff\",\r\n        };\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Dynamically sets new grid options and rebuilds the grid pattern.\r\n     * @param {Partial<GridOptions>} newOpts - New options to apply.\r\n     */\r\n    setOptions(newOpts: Partial<GridOptions>) {\r\n        Object.assign(this.grid, newOpts);\r\n        this.rect?.remove?.();\r\n        this.pattern?.remove?.();\r\n        this.init(); // rebuild\r\n    }\r\n}\r\n","import { Element, G } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer, { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\n\r\nfunction initXButton(element: Element, args: Record<string, any>): () => void {\r\n\tconst xBtnGroup = element as G;\r\n\tconst ws: WorkspaceSvg = args.workspace;\r\n\r\n\t// click handler\r\n\tconst onClick = () => {\r\n\t\tws.removeNode(args.node);\r\n\t};\r\n\r\n\t// attach\r\n\txBtnGroup.on('click', onClick);\r\n\r\n\t// return cleanup function\r\n\treturn () => {\r\n\t\txBtnGroup.off('click', onClick);\r\n\t};\r\n}\r\n\r\n// register as Kabel event\r\neventer.registerEvent('k_closenode', initXButton as EventSetupFn);\r\n","import { Color, ColorStyle } from \"./visual-types\";\r\n\r\n/**\r\n * Stores color styles for node categories.\r\n * \r\n * Each key is a category name, and the value is a ColorStyle object\r\n * containing colors like primary, secondary, and tertiary.\r\n * \r\n * Example:\r\n * ```ts\r\n * CategoryColors[\"logic\"] = {\r\n *   primary: \"#FF0000\",\r\n *   secondary: \"#00FF00\",\r\n *   tertiary: \"#0000FF\"\r\n * };\r\n * ```\r\n */\r\nconst CategoryColors: { [key: string]: ColorStyle } = {};\r\n\r\nexport default CategoryColors;\r\n","'use strict';\n\n// combine 2 matrixes\n// m1, m2 - [a, b, c, d, e, g]\n//\nfunction combine(m1, m2) {\n  return [\n    m1[0] * m2[0] + m1[2] * m2[1],\n    m1[1] * m2[0] + m1[3] * m2[1],\n    m1[0] * m2[2] + m1[2] * m2[3],\n    m1[1] * m2[2] + m1[3] * m2[3],\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\n  ];\n}\n\n\nfunction Matrix() {\n  if (!(this instanceof Matrix)) { return new Matrix(); }\n  this.queue = [];   // list of matrixes to apply\n  this.cache = null; // combined matrix cache\n}\n\n\nMatrix.prototype.matrix = function (m) {\n  if (m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0) {\n    return this;\n  }\n  this.cache = null;\n  this.queue.push(m);\n  return this;\n};\n\n\nMatrix.prototype.translate = function (tx, ty) {\n  if (tx !== 0 || ty !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, 0, 1, tx, ty ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.scale = function (sx, sy) {\n  if (sx !== 1 || sy !== 1) {\n    this.cache = null;\n    this.queue.push([ sx, 0, 0, sy, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.rotate = function (angle, rx, ry) {\n  var rad, cos, sin;\n\n  if (angle !== 0) {\n    this.translate(rx, ry);\n\n    rad = angle * Math.PI / 180;\n    cos = Math.cos(rad);\n    sin = Math.sin(rad);\n\n    this.queue.push([ cos, sin, -sin, cos, 0, 0 ]);\n    this.cache = null;\n\n    this.translate(-rx, -ry);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewX = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, Math.tan(angle * Math.PI / 180), 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewY = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, Math.tan(angle * Math.PI / 180), 0, 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\n// Flatten queue\n//\nMatrix.prototype.toArray = function () {\n  if (this.cache) {\n    return this.cache;\n  }\n\n  if (!this.queue.length) {\n    this.cache = [ 1, 0, 0, 1, 0, 0 ];\n    return this.cache;\n  }\n\n  this.cache = this.queue[0];\n\n  if (this.queue.length === 1) {\n    return this.cache;\n  }\n\n  for (var i = 1; i < this.queue.length; i++) {\n    this.cache = combine(this.cache, this.queue[i]);\n  }\n\n  return this.cache;\n};\n\n\n// Apply list of matrixes to (x,y) point.\n// If `isRelative` set, `translate` component of matrix will be skipped\n//\nMatrix.prototype.calc = function (x, y, isRelative) {\n  var m;\n\n  // Don't change point on empty transforms queue\n  if (!this.queue.length) { return [ x, y ]; }\n\n  // Calculate final matrix, if not exists\n  //\n  // NB. if you deside to apply transforms to point one-by-one,\n  // they should be taken in reverse order\n\n  if (!this.cache) {\n    this.cache = this.toArray();\n  }\n\n  m = this.cache;\n\n  // Apply matrix to point\n  return [\n    x * m[0] + y * m[2] + (isRelative ? 0 : m[4]),\n    x * m[1] + y * m[3] + (isRelative ? 0 : m[5])\n  ];\n};\n\n\nmodule.exports = Matrix;\n","import WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WorkspaceController {\r\n    workspace: WorkspaceSvg;\r\n\r\n    keysDown: Set<string>;\r\n    mouseBtns: Set<number>;\r\n    mousePos: Vec2;\r\n    lastMousePos: Vec2;\r\n    isDragging: boolean;\r\n\r\n    wheelDelta: number;\r\n    movedListeners: (() => void)[];\r\n    _lastMoveFire = 0;\r\n    _moveThrottleMs = 100; // bump this to whatever doesn't lag you\r\n    _queuedMove = false;\r\n    _moveTimeout: any = null;\r\n    _updateInt: any;\r\n\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n\r\n        this.keysDown = new Set();\r\n        this.mouseBtns = new Set();\r\n        this.mousePos = { x: 0, y: 0 };\r\n        this.lastMousePos = { x: 0, y: 0 };\r\n        this.isDragging = false;\r\n        this.wheelDelta = 0;\r\n        this.movedListeners = [];\r\n\r\n        this._setupListeners();\r\n\r\n        this._updateInt = setInterval(() => this.update(), 16);\r\n    }\r\n    addMoveListener(cb: () => void) {\r\n        this.movedListeners.push(cb);\r\n    }\r\n\r\n    removeMoveListener(cb: () => void) {\r\n        const i = this.movedListeners.indexOf(cb);\r\n        if (i !== -1) this.movedListeners.splice(i, 1);\r\n    }\r\n\r\n    fireDidMove() {\r\n        if (typeof queueMicrotask !== 'undefined') {\r\n            queueMicrotask(() => {\r\n                for (let cb of this.movedListeners) {\r\n                    try { cb(); } catch (e) { console.error(e); }\r\n                }\r\n            });\r\n        } else {\r\n            Promise.resolve().then(() => {\r\n                for (let cb of this.movedListeners) {\r\n                    try { cb(); } catch (e) { console.error(e); }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    _throttledFireDidMove() {\r\n        const now = performance.now();\r\n\r\n        // enough time passed  fire instantly\r\n        if (now - this._lastMoveFire >= this._moveThrottleMs) {\r\n            this._lastMoveFire = now;\r\n            this.fireDidMove();\r\n            return;\r\n        }\r\n\r\n        // otherwise queue ONE fire\r\n        if (!this._queuedMove) {\r\n            this._queuedMove = true;\r\n            const wait = this._moveThrottleMs - (now - this._lastMoveFire);\r\n\r\n            this._moveTimeout = setTimeout(() => {\r\n                this._queuedMove = false;\r\n                this._lastMoveFire = performance.now();\r\n                this.fireDidMove();\r\n            }, wait);\r\n        }\r\n    }\r\n    getZoom() {\r\n        return 1;\r\n    }\r\n    canMove() {\r\n        return true;\r\n    }\r\n    private _setupListeners() {\r\n        window.addEventListener('keydown', e => this.keysDown.add(e.key));\r\n        window.addEventListener('keyup', e => this.keysDown.delete(e.key));\r\n\r\n        window.addEventListener('mousedown', e => this.mouseBtns.add(e.button));\r\n        window.addEventListener('mouseup', e => this.mouseBtns.delete(e.button));\r\n\r\n        window.addEventListener('mousemove', e => {\r\n            this.lastMousePos = { ...this.mousePos };\r\n            this.mousePos = { x: e.clientX, y: e.clientY };\r\n        });\r\n\r\n        window.addEventListener('wheel', e => {\r\n            this.wheelDelta = e.deltaY;\r\n        });\r\n\r\n        window.addEventListener('mousedown', e => {\r\n            if (e.button === 0) this.isDragging = true;\r\n        });\r\n        window.addEventListener('mouseup', e => {\r\n            if (e.button === 0) this.isDragging = false;\r\n        });\r\n    }\r\n\r\n    update() {\r\n        // Can handle keyboard shortcuts or auto-pan here\r\n    }\r\n\r\n    // --- Camera methods ---\r\n    pan(dx: number, dy: number) {\r\n        const x = this.workspace._camera.x, y = this.workspace._camera.y;\r\n        this.workspace._camera.x += dx;\r\n        this.workspace._camera.y += dy;\r\n        if (x == this.workspace._camera.x && y == this.workspace._camera.y) {\r\n            return;\r\n        }\r\n        this._throttledFireDidMove();\r\n        this.workspace.didMove = true;\r\n        this.workspace.fireMoveListeners();\r\n        this.refreshPos();\r\n    }\r\n\r\n    setCamera(pos: Vec2) {\r\n        const x = this.workspace._camera.x, y = this.workspace._camera.y;\r\n        this.workspace._camera.x = pos.x;\r\n        this.workspace._camera.y = pos.y;\r\n        if (x == this.workspace._camera.x && y == this.workspace._camera.y) {\r\n            return;\r\n        }\r\n        this._throttledFireDidMove();\r\n        this.workspace.didMove = true;\r\n        this.workspace.fireMoveListeners();\r\n        this.refreshPos();\r\n    }\r\n\r\n    centerOn(pos: Vec2) {\r\n        const wsSize = this.workspace.getSize?.() ?? { width: 0, height: 0 };\r\n        this.setCamera({\r\n            x: pos.x - wsSize.width / 2,\r\n            y: pos.y - wsSize.height / 2\r\n        });\r\n    }\r\n\r\n\r\n\r\n    // --- Coordinate conversion ---\r\n    screenToWorkspace(x: number, y: number): Vec2 {\r\n        const cam = this.workspace._camera;\r\n        return {\r\n            x: x + cam.x,\r\n            y: y + cam.y\r\n        };\r\n    }\r\n\r\n    workspaceToScreen(x: number, y: number): Vec2 {\r\n        const cam = this.workspace._camera;\r\n        return {\r\n            x: (x - cam.x),\r\n            y: (y - cam.y)\r\n        };\r\n    }\r\n\r\n    // --- Refresh ---\r\n    refreshPos() {\r\n        this.workspace.refresh?.();\r\n    }\r\n\r\n    redraw() {\r\n        this.workspace.redraw?.();\r\n    }\r\n\r\n    // --- Cleanup ---\r\n    stop() {\r\n        clearInterval(this._updateInt);\r\n    }\r\n}\r\n","\r\nimport { Path as SvgPath, StrokeData, G } from \"@svgdotjs/svg.js\";\r\nimport * as Path from '../../util/path'\r\nimport { ColorStyle, Hex } from \"../../src/visual-types\";\r\nimport WorkspaceSvg from \"../../src/workspace-svg\";\r\nimport Renderer, { DrawState, NodeMeasurements } from \"../renderer\"; // Saying the value of \"Renderer\" is undefined when it's clearly defined and theres no circular refs.\r\nimport ApolloConstants from \"./constants\";\r\nimport { parseColor } from \"../../util/parse-color\";\r\nimport eventer from \"../../util/eventer\";\r\nimport NodeSvg from \"../../src/nodesvg\";\r\nimport Connection from \"../../src/connection\";\r\nimport { AnyField, FieldRawBoxData } from \"../../src/field\";\r\nconsole.log(Renderer);\r\n\r\nfunction darkenColor(hex: string, amount: number = 0.2): string {\r\n    // Remove # if present\r\n    hex = hex.replace(/^#/, \"\");\r\n\r\n    // Parse r, g, b\r\n    const r = parseInt(hex.substring(0, 2), 16);\r\n    const g = parseInt(hex.substring(2, 4), 16);\r\n    const b = parseInt(hex.substring(4, 6), 16);\r\n\r\n    // Darken each channel\r\n    const newR = Math.max(0, Math.floor(r * (1 - amount)));\r\n    const newG = Math.max(0, Math.floor(g * (1 - amount)));\r\n    const newB = Math.max(0, Math.floor(b * (1 - amount)));\r\n\r\n    // Convert back to hex and pad with 0s\r\n    const toHex = (c: number) => c.toString(16).padStart(2, \"0\");\r\n\r\n    return `#${toHex(newR)}${toHex(newG)}${toHex(newB)}`;\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * ApolloRenderer\r\n * \r\n * Custom renderer extending the base `Renderer` for a visual programming workspace.\r\n * This renderer provides a distinct node style:\r\n * - Node background uses the primary color entirely\r\n * - Topbar is hidden (but still present for dragging)\r\n * - Bottom-right dog-ear decoration\r\n * - Previous connection at the top, next connection at the bottom\r\n */\r\nclass ApolloRenderer extends Renderer {\r\n    declare _constants: ApolloConstants;\r\n\r\n    static get NAME() {\r\n        return 'apollo';\r\n    }\r\n    static get ElEMENT_TAG() {\r\n        return 'ApolloElement';\r\n    }\r\n    /**\r\n     * Constructor\r\n     * @param workspace - The WorkspaceSvg instance\r\n     * @param overrides - Partial constant overrides for ApolloConstants\r\n     */\r\n    constructor(workspace: WorkspaceSvg, overrides: Partial<ApolloConstants>) {\r\n        super(workspace, overrides);\r\n    }\r\n\r\n    /** \r\n     * Typed getter for renderer constants\r\n     */\r\n    get constants(): ApolloConstants {\r\n        return super.constants as ApolloConstants;\r\n    }\r\n\r\n    /** Initialize constants using Apollo-specific overrides */\r\n    initConstants() {\r\n        this._constants = new ApolloConstants(this.constantOverrides);\r\n    }\r\n\r\n    /**\r\n     * Draws the node's topbar.\r\n     * Overridden to hide the topbar visually while retaining its group for dragging.\r\n     * @param state - Current draw state\r\n     * @param colors - Node colors\r\n     * @param measurements - Node dimensions\r\n     */\r\n    drawNodeTopbar(state: DrawState, colors: ColorStyle, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const radius = c.CORNER_RADIUS;\r\n\r\n        state.topbar = state.group!.path(Path.roundedRect(width, c.TOPBAR_HEIGHT, radius))\r\n            .fill('transparent');\r\n    }\r\n\r\n    /**\r\n     * Draws the node background with rounded corners and bottom-right dog-ear cut.\r\n     * Also creates a shadow.\r\n     * @param state - Current draw state\r\n     * @param measurements - Node dimensions\r\n     */\r\n    drawNodeBase(state: DrawState, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const height = measurements?.height ?? c.NODE_BASE_HEIGHT;\r\n        const r = c.CORNER_RADIUS;\r\n\r\n        const dogear = this.constants.SHAPES.Dogear;\r\n        const cutW = dogear?.Width ?? 0;\r\n        const cutH = dogear?.Height ?? 0;\r\n\r\n        // Rounded rect with bottom-right cut\r\n        const roundedRect = `M${r},0 H${width - r} Q${width},0 ${width},${r} V${height - cutH} L${width - cutW},${height} H${r} Q0,${height} 0,${height - r} V${r} Q0,0 ${r},0 Z`;\r\n\r\n        const colors = this.getNodeColors();\r\n        const primary = parseColor(colors.primary) as string;\r\n        const stroke = parseColor(colors.secondary) as string;\r\n\r\n        // Node background\r\n        state.bg = state.group!.path(roundedRect)\r\n            .fill(primary)\r\n            .stroke({ color: stroke, width: 2 });\r\n\r\n        // Dog-ear decoration\r\n        this.drawDogEar(state, state.group as G, width, height, colors);\r\n\r\n        // Node shadow\r\n        state.shadow = state.group!.path(roundedRect)\r\n            .fill('rgba(0,0,0,0.2)')\r\n            .stroke('none')\r\n            .attr({ 'pointer-events': 'none' })\r\n            .move(Number(state.bg.x()) + 5, Number(state.bg.y()) + 5)\r\n            .back();\r\n    }\r\n\r\n    /**\r\n     * Draws a dog-ear decoration at the node's bottom-right corner\r\n     * @param state - Current draw state\r\n     * @param nodeG - Node's SVG group\r\n     * @param w - Node width\r\n     * @param h - Node height\r\n     * @param colors - Node colors\r\n     */\r\n    drawDogEar(state: DrawState, nodeG: G, w: number, h: number, colors: ColorStyle) {\r\n        const pathDef = this.constants.SHAPES.Dogear?.PathMain;\r\n        if (!pathDef) return;\r\n\r\n        const dogEar = nodeG.path(pathDef)\r\n            .fill(parseColor(colors.secondary) as string)\r\n            .stroke({ color: parseColor(colors.tertiary) as string, width: 1 } as StrokeData);\r\n\r\n        const offsetX = w - this.constants.SHAPES.Dogear!.Width;\r\n        const offsetY = h - this.constants.SHAPES.Dogear!.Height;\r\n        dogEar.move(offsetX, offsetY);\r\n        dogEar.front();\r\n    }\r\n\r\n    /**\r\n     * Draws previous and next connections for the node.\r\n     * Previous connection is on top, next is on bottom.\r\n     * @param state - Draw state\r\n     * @param node - NodeSvg instance\r\n     * @param nodeGroup - Node's SVG group\r\n     * @param measurements - Node dimensions\r\n     */\r\n    drawPreviousNextConnections(state: DrawState, node: NodeSvg, nodeGroup: G, measurements: { width: number, height: number } | null = null) {\r\n        if (!state || !node || !state.bg) return;\r\n\r\n        const c = this.constants;\r\n        const colors: ColorStyle = this.getNodeColors();\r\n        const bbox = state.bg.bbox();\r\n\r\n        // Top connector (previous)\r\n        if (node.previousConnection) {\r\n            const c1 = this.drawPrimaryConnector(nodeGroup, state.bg, 'top', parseColor(this._constants.CONNECTOR_COLOR) as string);\r\n            if (c1) {\r\n                const conn = {\r\n                    from: node.previousConnection,\r\n                    to: this.resolveConnectable(node.previousConnection.getFrom(), node.previousConnection) as Connection,\r\n                    fromCircle: c1 as SvgPath,\r\n                    originConn: node.previousConnection,\r\n                    originCircle: c1\r\n                };\r\n                this.setConnect(conn);\r\n                eventer.addElement(c1, 'k_connectbubble', { connection: node.previousConnection, node })\r\n                    .tagElement(c1, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                this._fillOtherNodeConnectorCircle(node.previousConnection, c1 as SvgPath, true);\r\n            }\r\n        }\r\n\r\n        // Bottom connector (next)\r\n        if (node.nextConnection) {\r\n            const c2 = this.drawPrimaryConnector(nodeGroup, state.bg, 'bottom', parseColor(this._constants.CONNECTOR_COLOR) as string);\r\n            if (c2) {\r\n                const conn = {\r\n                    from: node.nextConnection,\r\n                    to: this.resolveConnectable(node.nextConnection.getTo(), node.nextConnection) as Connection,\r\n                    fromCircle: c2 as SvgPath,\r\n                    originConn: node.nextConnection,\r\n                    originCircle: c2\r\n                };\r\n                this.setConnect(conn);\r\n                eventer.addElement(c2, 'k_connectbubble', { connection: node.nextConnection, node })\r\n                    .tagElement(c2, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                this._fillOtherNodeConnectorCircle(node.nextConnection, c2 as SvgPath, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws a primary connector (triangle or circle) on either the top or bottom edge.\r\n     * @param nodeGroup - Node's SVG group\r\n     * @param nodeBg - Node background path\r\n     * @param side - 'top' or 'bottom'\r\n     * @param color - Connector color\r\n     * @returns SvgPath of the connector\r\n     */\r\n    drawPrimaryConnector(nodeGroup: G, nodeBg: SvgPath, side: 'top' | 'bottom', color: string): SvgPath | void {\r\n        const c = this.constants;\r\n        if (!nodeGroup || !nodeBg) return;\r\n\r\n        const bbox = nodeBg.bbox();\r\n        const triSize = c.CONNECTOR_TRI_SIZE;\r\n        const radius = c.CONNECTOR_RADIUS;\r\n        const x = bbox.width / 2;\r\n        let y: number;\r\n        let element: SvgPath;\r\n\r\n        if (c.CONNECTOR_TRIANGLE) {\r\n            let path = Path.roundedTri(triSize, triSize, 1);\r\n            if (side === 'top') y = -triSize;\r\n            else { y = bbox.height; path = Path.rotatePath(path, 180, triSize / 2, triSize / 2); }\r\n\r\n            element = nodeGroup.path(path)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .transform({ translateX: x - triSize / 2, translateY: y });\r\n        } else {\r\n            const circlePath = Path.circle(radius);\r\n            y = side === 'top' ? 0 : bbox.height;\r\n\r\n            element = nodeGroup.path(circlePath)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .move(x - radius, y - radius);\r\n        }\r\n\r\n        element.attr({ class: (this.constructor as typeof Renderer).CONNECTOR_TAG });\r\n        return element;\r\n    }\r\n    /**\r\n     * Draws a raw input field.\r\n     * @param fieldGroup - The SVG group element for the field.\r\n     * @param field - The field to draw.\r\n     * @param startX - The starting X position for the field.\r\n     * @returns The rectangle and text elements of the raw field.\r\n     */\r\n    drawFieldRaw(fieldGroup: G, field: AnyField, startX: number = 0) {\r\n        const c = this.constants;\r\n        const value = field.getDisplayValue?.() ?? \"\";\r\n        const { width, height } = this.measureRawField(value);\r\n\r\n        // Draw the rectangle\r\n        const rect = fieldGroup.rect(width, height)\r\n            .fill(parseColor(c.FIELD_RAW_COLOR))\r\n            .stroke({ color: parseColor(c.FIELD_RAW_OUTLINE_COLOR), width: c.FIELD_RAW_OUTLINE_STROKE })\r\n            .radius(20);\r\n\r\n        // Draw the text\r\n        const txt = fieldGroup.text(value)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .fill(parseColor(c.FIELD_RAW_TEXT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n\r\n        const rawBox: FieldRawBoxData = { box: rect, txt };\r\n\r\n        // Measure text dimensions\r\n        const textBBox = txt.bbox();\r\n\r\n        // Vertical centering\r\n        const offsetY = (height - textBBox.height) / 2;\r\n\r\n        // Horizontal centering with padding\r\n        const paddedWidth = width - 2 * c.INPUT_BOX_PADDING;\r\n        const offsetX = startX + c.INPUT_BOX_PADDING + Math.max(0, (paddedWidth - textBBox.width) / 2);\r\n\r\n        // Move elements\r\n        rect.move(startX, 0);\r\n        txt.move(offsetX, offsetY);\r\n\r\n        // Add event listener\r\n        eventer.addElement(rect, \"k_inputbox\", {\r\n            field,\r\n            text: txt,\r\n            renderer: this,\r\n            startX\r\n        }).tagElement(rect, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${this.node!.id}`]);\r\n\r\n        return { rect, txt, rawBox };\r\n    }\r\n\r\n    /**\r\n     * Draws the full node (base, topbar, fields, connectors, label, etc.)\r\n     */\r\n    drawNode() {\r\n        if (!this.node) return;\r\n\r\n        const colors = this.getNodeColors();\r\n        const node = this.node;\r\n        const state = this.drawState(this.createNodeGroup(node), node.id);\r\n        this._nodeDraw = state;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n        if (!measurements) return;\r\n\r\n        this.drawNodeBase(state, measurements as NodeMeasurements);\r\n        this.drawNodeTopbar(state, colors, measurements as NodeMeasurements);\r\n        this.drawNodeXButton();\r\n        this.drawNodeLabel(state.group!);\r\n        this.makeNodeDraggable(state.group!, state.topbar!, node);\r\n\r\n        this.createFieldGroup(state);\r\n        this.drawAllFieldsForNode(measurements as NodeMeasurements);\r\n        this.drawPreviousNextConnections(state, node, state.group!, measurements as NodeMeasurements);\r\n    }\r\n}\r\n\r\n\r\nexport default ApolloRenderer;","import NodePrototypes from \"./prototypes\";\r\nimport newHeadlessNode from \"./headless-node\";\r\nimport Widget from \"./widget\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport CommentModel from \"./comment\";\r\nimport UndoRedoHistory from \"./undo-redo\";\r\nimport { ConnectableField } from \"./field\";\r\n\r\n/**\r\n * Headless workspace that holds nodes, widgets, and comments without any rendering or camera.\r\n */\r\nclass Workspace {\r\n\t_nodeDB: Map<string, any>; // Node storage\r\n\t_widgetDB: Map<string, Widget>;\r\n\t_commentDB: Set<CommentModel>;\r\n    isHeadless: boolean = true;\r\n\tconstructor() {\r\n\t\tthis._nodeDB = new Map();\r\n\t\tthis._widgetDB = new Map();\r\n\t\tthis._commentDB = new Set();\r\n\t}\r\n\r\n\t/** Node management */\r\n\taddNode(node: any, nodeId?: string) {\r\n\t\tconst id = nodeId || node.id;\r\n\t\tif (this._nodeDB.has(id)) {\r\n\t\t\tconsole.warn(`Node with id ${id} already exists, overwriting.`);\r\n\t\t}\r\n\t\tif (node.workspace !== this) node.workspace = this;\r\n\t\tthis._nodeDB.set(id, node);\r\n\t}\r\n\r\n\tnewNode(type: keyof typeof NodePrototypes, add: boolean = true) {\r\n\t\tif (!NodePrototypes[type]) return;\r\n\t\tconst node = newHeadlessNode(type as string);\r\n\t\tif (!node) return;\r\n\t\tif (add) this.addNode(node);\r\n\t\treturn node;\r\n\t}\r\n\r\n\tspawnAt(type: keyof typeof NodePrototypes, x: number, y: number) {\r\n\t\tconst node = this.newNode(type, false);\r\n\t\tif (!node) return;\r\n\t\tnode.relativeCoords.set(x, y);\r\n\t\tthis.addNode(node);\r\n\t\treturn node;\r\n\t}\r\n\r\n\tgetNode(id: string | any) {\r\n\t\tif (id instanceof Object && id.id) return id;\r\n\t\treturn this._nodeDB.get(id);\r\n\t}\r\n\r\n\tremoveNodeById(id: string) {\r\n\t\tconst node = this._nodeDB.get(id);\r\n\t\tif (!node) return;\r\n\t\tthis.derefNode(node);\r\n\t\tthis._nodeDB.delete(id);\r\n\t}\r\n\r\n\tremoveNode(node: any) {\r\n\t\tif (!node) return;\r\n\t\tthis.removeNodeById(node.id);\r\n\t}\r\n\r\n\tderefNode(node: any) {\r\n\t\tconst prev = node.previousConnection?.getFrom?.();\r\n\t\tif (prev?.nextConnection) prev.nextConnection.disconnectTo?.();\r\n\t\tconst next = node.nextConnection?.getTo?.();\r\n\t\tif (next?.previousConnection) next.previousConnection.disconnectFrom?.();\r\n\r\n\t\tfor (let field of node.allFields()) {\r\n\t\t\tif ((field as ConnectableField).hasConnectable?.()) {\r\n\t\t\t\t(field as ConnectableField).disconnect();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Widget management */\r\n\tnewWidget(type: string): Widget | void {\r\n\t\tconst opts = WidgetPrototypes[type];\r\n\t\tif (!opts) return;\r\n\t\tconst wdgt = opts.cls ? new opts.cls(this, opts) : new Widget(this, opts);\r\n\t\tthis._widgetDB.set(wdgt.id, wdgt);\r\n\t\treturn wdgt;\r\n\t}\r\n\r\n\tgetWidget(id: string): Widget | undefined {\r\n\t\treturn this._widgetDB.get(id);\r\n\t}\r\n\r\n\t/** Comment management */\r\n\taddComment() {\r\n\t\tconst model = new CommentModel(this);\r\n\t\tthis._commentDB.add(model);\r\n\t\treturn model;\r\n\t}\r\n\r\n\tgetComment(id: string) {\r\n\t\treturn Array.from(this._commentDB).find(e => e.id === id);\r\n\t}\r\n\r\n\tremoveComment(commentOrId: CommentModel | string) {\r\n\t\tlet comment: CommentModel | undefined;\r\n\t\tif (typeof commentOrId === \"string\") comment = this.getComment(commentOrId);\r\n\t\telse comment = commentOrId;\r\n\t\tif (!comment) return false;\r\n\t\tthis._commentDB.delete(comment);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgetComments() {\r\n\t\treturn Array.from(this._commentDB);\r\n\t}\r\n\r\n    /**\r\n     * Internal: Add widget to DB\r\n     * @param wdgt - The widget\r\n     */\r\n    _addWidgetToDB(wdgt: Widget) {\r\n        this._widgetDB.set(wdgt.id, wdgt);\r\n    }\r\n    /**\r\n     * Internal: Delete a widget from DB.\r\n     * @param wdgt - Widget to delete\r\n     */\r\n    _delWidgetFromDB(wdgt: Widget) {\r\n        this._widgetDB.delete(wdgt.id);\r\n    }\r\n    \r\n\t/** Serialization */\r\n\tfromJson(json: { nodes: any[]; circular: boolean }, recordBigEvent: boolean = false) {\r\n\t\tfor (let [, node] of this._nodeDB.entries()) this.removeNode(node);\r\n\r\n\t\tif (json.circular) {\r\n\t\t\tfor (let node of json.nodes) {\r\n\t\t\t\t(node.constructor as any).deserialize(node, this);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (let node of json.nodes) {\r\n\t\t\t\t(node.constructor as any).fromJson(node, this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoJson(circular: boolean) {\r\n\t\tconst nodes = [];\r\n\t\tfor (let [, node] of this._nodeDB) {\r\n\t\t\tif (node.topLevel) nodes.push(circular ? node.serialize() : node.toJson());\r\n\t\t}\r\n\t\treturn { circular, nodes };\r\n\t}\r\n}\r\n\r\nexport default Workspace;\r\n","class Styler {\r\n\tprivate styles: Map<string, HTMLStyleElement>;\r\n\r\n\tconstructor() {\r\n\t\tthis.styles = new Map();\r\n\t}\r\n\r\n\tappendStyles(id: string, css: string): void {\r\n\t\tif (this.styles.has(id)) return; // Do not append if id exists\r\n\r\n\t\tconst styleEl = document.createElement('style');\r\n\t\tstyleEl.id = id;\r\n\t\tstyleEl.textContent = css;\r\n\t\tdocument.head.appendChild(styleEl);\r\n\t\tthis.styles.set(id, styleEl);\r\n\t}\r\n\r\n\tremoveStyles(id: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.remove();\r\n\t\tthis.styles.delete(id);\r\n\t}\r\n\r\n\tupdateStyles(id: string, css: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.textContent = css;\r\n\t}\r\n\r\n\thasStyles(id: string): boolean {\r\n\t\treturn this.styles.has(id);\r\n\t}\r\n}\r\nexport {\r\n    Styler\r\n}\r\nconst styler = new Styler();\r\nexport default styler;","import WorkspaceController from \"../controllers/base\";\r\nimport Renderer from \"../renderers/renderer\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport WorkspaceSvg, { WSTheme } from \"./workspace-svg\";\r\nimport NodePrototypes from \"./prototypes\"; // Object\r\nimport { FieldOptions } from \"./field\";\r\nimport { Color, Hex } from \"./visual-types\";\r\nimport styler from '../util/styler';\r\n// @ts-ignore\r\nimport _kabelStyles from './styles.css';\r\nimport env from \"../util/env\";\r\n\r\nconst kabelStyles: string = _kabelStyles;\r\n\r\n/**\r\n * Represents a field in a toolbox node.\r\n * Can contain any extra properties as needed by the field type.\r\n */\r\nexport interface TblxFieldStruct {\r\n    /** Field value */\r\n    value: any;\r\n\r\n    /** Additional field-specific properties */\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents a node in a toolbox.\r\n */\r\nexport interface TblxNodeStruct {\r\n    /** Node type (matches NodePrototypes key or arbitrary string) */\r\n    type: keyof typeof NodePrototypes | string;\r\n\r\n    /** Map of field names to field data */\r\n    arguments: {\r\n        [key: string]: TblxFieldStruct;\r\n    };\r\n}\r\n\r\n/**\r\n * Represents a category in the toolbox, which contains multiple nodes.\r\n */\r\nexport interface TblxCategoryStruct {\r\n    /** Category name */\r\n    name: string;\r\n\r\n    /** Category color */\r\n    color: Color;\r\n\r\n    /** Nodes contained in this category */\r\n    contents: TblxNodeStruct[];\r\n}\r\n\r\n/**\r\n * Discriminated union type representing possible toolbox structures.\r\n * Can be a flyout (list of nodes) or a categorized toolbox.\r\n */\r\nexport type TblxObjStruct =\r\n    | {\r\n        /** Flyout toolbox type */\r\n        type: 'flyout';\r\n        contents: TblxNodeStruct[];\r\n    }\r\n    | {\r\n        /** Categorized toolbox type */\r\n        type?: 'category';\r\n        contents: TblxCategoryStruct[];\r\n    }\r\n    | {\r\n        /** When type is omitted, defaults to categories */\r\n        type?: undefined;\r\n        contents: TblxCategoryStruct[];\r\n    };\r\nexport interface GridOptions {\r\n    /**\r\n     * The grid's type.\r\n     * 'celled' - The grid is celled.\r\n     * 'dotted' - The grid is dotted.\r\n     */\r\n\ttype: 'celled' | 'dotted';\r\n    /**\r\n     * Spacing, optional. Default is 40.\r\n     */\r\n\tspacing?: number;\r\n    /**\r\n     * Dot size for 'dotted' grid type.\r\n     */\r\n\tdotSize?: number;\r\n    /**\r\n     * stroke width for 'celled' grid type.\r\n     */\r\n\tstrokeWidth?: number;\r\n    /**\r\n     * Option color for any grid type. Color is #bebebeff by default.\r\n     */\r\n    color?: Hex\r\n}\r\n/**\r\n * Options used when injecting a new workspace.\r\n */\r\nexport interface InjectOptions {\r\n    /** Optional renderer overrides */\r\n    rendererOverrides?: { [key: string]: any };\r\n    /** Theme for the workspace */\r\n    theme?: string|WSTheme;\r\n    /** Optional custom controller class */\r\n    Controller?: typeof WorkspaceController;\r\n    /** Init the workspace's undo state for you, or not. */\r\n    initUndoRedo?: boolean;\r\n    /** Optional controls configuration */\r\n    controls?: {\r\n        zoomSpeed?: number;\r\n        minZoom?: number;\r\n        maxZoom?: number;\r\n        wasd?: boolean;\r\n        wasdSmooth?: boolean;\r\n        wasdAccelerate?: number;\r\n        wasdFriction?: number;\r\n    };\r\n\r\n    /** Optional toolbox structure */\r\n    toolbox?: TblxObjStruct;\r\n\r\n    /** Optional movement speed of the workspace */\r\n    moveSpeed?: number;\r\n\r\n    /** Optional renderer: name string or class */\r\n    renderer?: string | typeof Renderer;\r\n    /**\r\n     * Optional grid settings.\r\n     */\r\n    grid?: GridOptions;\r\n}\r\n\r\n/**\r\n * Utility class for logging injection messages in a structured way.\r\n */\r\nexport class InjectMsg {\r\n    /** Message content */\r\n    msg: string;\r\n\r\n    /**\r\n     * Creates a new InjectMsg instance.\r\n     * @param msg - Message text\r\n     */\r\n    constructor(msg: string) {\r\n        this.msg = msg;\r\n    }\r\n\r\n    /** Log as error */\r\n    err() {\r\n        console.error(`Failed to inject workspace: ${this.msg}`);\r\n    }\r\n\r\n    /** Log as warning */\r\n    wrn() {\r\n        console.warn(`Inject warning: ${this.msg}`);\r\n    }\r\n\r\n    /** Log as info */\r\n    info() {\r\n        console.info(`Inject info: ${this.msg}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Injects a new Kabel workspace into the document.\r\n * Appends the workspace container to the given element (or element ID) and\r\n * sets it as the main workspace.\r\n *\r\n * @param element - HTMLElement or string ID to attach the workspace to\r\n * @param options - Optional InjectOptions to configure the workspace\r\n * @returns The newly created WorkspaceSvg instance, or undefined if injection failed\r\n */\r\nexport default function inject(\r\n    element: HTMLElement | string,\r\n    options: InjectOptions = {}\r\n): WorkspaceSvg | undefined {\r\n    if (!env.isBrowser) {\r\n        new InjectMsg(`Cannot inject workspace-svg in non-browser environment (use Kabel.injectHeadless).`).err();\r\n        return;\r\n    }\r\n    // Apply global Kabel styles\r\n    styler.appendStyles('KabelStyles', kabelStyles);\r\n\r\n    const root =\r\n        typeof element === 'string'\r\n            ? document.querySelector(`#${element}`) as HTMLElement\r\n            : element as HTMLElement;\r\n\r\n    if (!root) {\r\n        new InjectMsg(`Document does not contain root element (Check element ID).`).err();\r\n        return;\r\n    }\r\n\r\n    if (!document.contains(root)) {\r\n        new InjectMsg(`Document does not contain root element.`).err();\r\n        return;\r\n    }\r\n\r\n    // Create workspace wrapper element\r\n    const wsTop = document.createElement('div');\r\n    wsTop.className = `KabelWorkspaceWrapper`;\r\n    root.appendChild(wsTop);\r\n\r\n    // Initialize workspace\r\n    const ws = new WorkspaceSvg(root, wsTop, options);\r\n\r\n    // Set as the main workspace globally\r\n    setMainWorkspace(ws);\r\n\r\n    return ws;\r\n}\r\n","import { NodePrototype } from \"./node-types\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\n\r\n/**\r\n * Creates a new headless NodeSvg instance without attaching it to a workspace.\r\n * This is useful for programmatic node generation, testing, or serialization.\r\n *\r\n * @param type - The type of node to create. Must exist in NodePrototypes.\r\n * @returns The initialized NodeSvg instance, or `undefined` if the prototype does not exist.\r\n */\r\nfunction newHeadlessNode(type: string): NodeSvg | undefined {\r\n    const proto: NodePrototype = NodePrototypes[type as string] as NodePrototype;\r\n\r\n    // Return undefined if prototype not found\r\n    if (!proto) return;\r\n\r\n    // Create a new node instance\r\n    const node = new NodeSvg(proto);\r\n\r\n    // Initialize the node (calls prototype init, sets defaults)\r\n    node.init();\r\n\r\n    return node;\r\n}\r\n\r\nexport default newHeadlessNode;\r\n","const isNode = typeof process !== 'undefined' && !!process.versions?.node;\r\nconst isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\r\nconst isWebWorker = typeof self !== 'undefined' && typeof self.importScripts === 'function';\r\n\r\nconst env: {\r\n    isBrowser: boolean;\r\n    isNode: boolean;\r\n    isWebWorker: boolean;\r\n} = { isNode, isBrowser, isWebWorker };\r\n\r\nexport default env;","import Connection, { Connectable } from \"./connection\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { ColorStyle, Color } from './visual-types';\r\nimport hasProp from '../util/has-prop';\r\nimport Field, { AnyField, AnyFieldCls, DummyField, FieldMap, FieldOptions } from \"./field\";\r\nimport CategoryColors from \"./colors\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport EventEmitter from '../util/emitter';\r\nimport { G } from \"@svgdotjs/svg.js\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport CommentModel, { CommentSerialized } from \"./comment\";\r\nimport { RepresenterNode } from '../renderers/representer-node';\r\nimport NodePrototypes from \"./prototypes\";\r\n/**\r\n * Represents the JSON structure used to initialize a field on a node.\r\n * Each field has a type, label, and name. Additional properties can be included for field-specific configuration.\r\n */\r\nexport interface InputFieldJson {\r\n    /** Human-readable label for the field, shown on the node UI */\r\n    label: string;\r\n\r\n    /** Field type identifier, corresponding to a field constructor in FieldMap */\r\n    type: string;\r\n\r\n    /** Unique field name within the node */\r\n    name: string;\r\n\r\n    /**\r\n     * Optional additional properties for field initialization.\r\n     * Can include type-specific options like min/max for number fields,\r\n     * default values, dropdown options, etc.\r\n     */\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents a JSON structure for initializing a NodeSvg instance.\r\n * Includes colors, connections, label, fields, category, and type information.\r\n */\r\nexport interface NodeJson {\r\n    /** Primary color of the node (e.g., top bar, main connections) */\r\n    primaryColor?: Color | undefined;\r\n\r\n    /** Secondary color of the node (e.g., field backgrounds) */\r\n    secondaryColor?: Color | undefined;\r\n\r\n    /** Tertiary color of the node (e.g., outlines) */\r\n    tertiaryColor?: Color | undefined;\r\n\r\n    /**\r\n     * Optional previous connection data.\r\n     * Presence triggers creation of a previous connection when initializing NodeSvg.\r\n     */\r\n    previousConnection?: any | undefined;\r\n\r\n    /**\r\n     * Optional next connection data.\r\n     * Presence triggers creation of a next connection when initializing NodeSvg.\r\n     */\r\n    nextConnection?: any | undefined;\r\n\r\n    /** Optional node label text to display */\r\n    labelText?: string | undefined;\r\n\r\n    /** Array of field definitions (InputFieldJson) to attach to this node */\r\n    arguments?: InputFieldJson[] | undefined;\r\n\r\n    /** Optional category name for color theming */\r\n    category?: string | undefined;\r\n\r\n    /** Node type identifier, used to look up the NodePrototype */\r\n    type: string;\r\n}\r\n\r\n/**\r\n * Represents a fully serialized node including its fields, colors, coordinates, connections, and optional comment.\r\n * Used for saving or transferring node data.\r\n */\r\nexport interface SerializedNode {\r\n    /** Node type string */\r\n    type: string;\r\n\r\n    /** Unique node ID */\r\n    id: string;\r\n\r\n    /** Display label of the node */\r\n    label: string;\r\n\r\n    /** Node colors including primary, secondary, tertiary, and category */\r\n    colors: ColorStyle;\r\n\r\n    /** Coordinates of the node relative to its workspace */\r\n    relativeCoords: { x: number; y: number };\r\n\r\n    /** Optional comment text attached to the node */\r\n    comment?: CommentSerialized | undefined;\r\n\r\n    /** Array of serialized fields, may contain any field-specific structure */\r\n    fields?: any[] | undefined;\r\n\r\n    /**\r\n     * Serialized representation of the previous connection.\r\n     * If `field` is true, the connection originates from a field rather than a node.\r\n     */\r\n    previousConnection?: { field?: boolean | undefined; node?: SerializedNode | undefined } | undefined;\r\n\r\n    /**\r\n     * Serialized representation of the next connection.\r\n     * If `field` is true, the connection originates from a field rather than a node.\r\n     */\r\n    nextConnection?: { field?: boolean | undefined; node?: SerializedNode | undefined } | undefined;\r\n}\r\n\r\n/**\r\n * NodeStyle represents the styling configuration of a node.\r\n * Includes ColorStyle properties plus optional renderer-specific constants and arbitrary additional fields.\r\n */\r\nexport type NodeStyle = ColorStyle &\r\n{\r\n    /** Optional renderer-specific constants from RendererConstants */\r\n    [key in keyof RendererConstants]?: RendererConstants[key];\r\n} &\r\n{\r\n    /** Any additional style properties supported by extensions or custom renderers */\r\n    [key: string]: any;\r\n};\r\n\r\n/**\r\n * Events emitted by NodeSvg instances.\r\n * Consumers can listen to these events to react to node lifecycle changes.\r\n */\r\nexport interface NodeEvents {\r\n    /** Triggered before the node is removed from the workspace */\r\n    \"REMOVING\": null;\r\n\r\n    /** Triggered immediately after node initialization */\r\n    \"INITING\": null;\r\n\r\n    /** Triggered while the node is being dragged */\r\n    \"NODE_DRAG\": null;\r\n}\r\n\r\n/**\r\n * Represents a node in the workspace.\r\n * Handles connections, fields, colors, serialization, and events.\r\n */\r\nclass NodeSvg extends EventEmitter<NodeEvents> {\r\n    /** The previous connection for this node (null if none) */\r\n    previousConnection: Connection | null;\r\n    /** The next connection for this node (null if none) */\r\n    nextConnection: Connection | null;\r\n    /** Node type string, usually derived from prototype */\r\n    type: string | null;\r\n    /** Prototype object providing behavior for this node */\r\n    prototype: NodePrototype | null;\r\n    /** Node color style object */\r\n    colors: NodeStyle;      // Node's color scheme\r\n    /** Displayed label text for this node */\r\n    labelText: string;       // Displayed node label\r\n    /** Set of fields attached to this node */\r\n    _fieldColumn: Set<AnyField>; // Stores attached fields\r\n    /** Node coordinates relative to workspace */\r\n    relativeCoords: Coordinates;\r\n    /** Unique node ID */\r\n    id: string;\r\n    /** SVG representation of this node */\r\n    svg?: RepresenterNode | object | null = null;\r\n    /** Workspace this node belongs to */\r\n    workspace: WorkspaceSvg | null = null;\r\n    /** Optional comment attached to this node */\r\n    comment: CommentModel | null\r\n    /** Event key: \"REMOVING\" */\r\n    static REMOVING: keyof NodeEvents = \"REMOVING\";\r\n\r\n    /** Event key: \"INITING\" */\r\n    static INITING: keyof NodeEvents = \"INITING\";\r\n    /**\r\n     * Creates a NodeSvg instance.\r\n     * @param prototype Optional NodePrototype to associate with this node.\r\n     * @param workspace Optional WorkspaceSvg this node belongs to.\r\n     * @param svgGroup Optional SVG group to attach node visuals.\r\n     */\r\n    constructor(prototype: NodePrototype | null, workspace?: WorkspaceSvg, svgGroup?: G) {\r\n        super();\r\n        this.type = null;\r\n        this.comment = null;\r\n        this.prototype = prototype;\r\n        this.colors = {\r\n            primary: '#000000',   // Topbar & connection color\r\n            secondary: '#000000', // Field & dropdown backgrounds\r\n            tertiary: '#000000', // Outline color\r\n            category: ''          // Node category name (optional)\r\n        };\r\n        this.previousConnection = new Connection(null, this, true); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.nextConnection = new Connection(this, null, false); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.labelText = '';\r\n        this._fieldColumn = new Set();\r\n        this.relativeCoords = new Coordinates(0, 0);\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        if (workspace) {\r\n            this.workspace = workspace;\r\n        }\r\n        if (svgGroup) {\r\n            this.svg = new RepresenterNode(this, {\r\n                id: this.id,\r\n                pendingConnections: [],\r\n                group: svgGroup\r\n            }, workspace!.renderer)\r\n        }\r\n    }\r\n    /** Returns true if this node has no previous connection (i.e., top-level node) */\r\n    get topLevel() {\r\n        return !(this.previousConnection?.getFrom());\r\n    }\r\n    /** Returns the raw SVG group element if present */\r\n    get svgGroup() {\r\n        return (this.svg as RepresenterNode)?.getRaw?.();\r\n    }\r\n    /** Returns the text of the node's comment, if any */\r\n    getCommentText() {\r\n        return this.comment?.getText?.();\r\n    }\r\n    /** Returns the CommentModel instance for this node, if any */\r\n    getComment() {\r\n        return this.comment;\r\n    }\r\n    /** Adds a new comment to this node if none exists */\r\n    addComment() {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n            return;\r\n        }\r\n        console.warn('Comment already exists.')\r\n    }\r\n    /** Sets the text for the node's comment, creating one if needed */\r\n    setCommentText(text: string) {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n        }\r\n        this.comment.setText(text);\r\n    }\r\n    /** Removes the comment from the node and triggers workspace redraw */\r\n    removeComment() {\r\n        this.comment = null;\r\n        this.workspace?.redrawComments?.();\r\n    }\r\n    /** Returns an array of all fields attached to this node */\r\n    allFields() {\r\n        return Array.from(this._fieldColumn);\r\n    }\r\n    /** Retrieves a field by name from this node */\r\n    getFieldByName(name: string): AnyField | null | undefined {\r\n        let field: AnyField | null | undefined = this.allFields().find(fld => fld.getName() === name);\r\n\r\n        return field;\r\n    }\r\n    /** Alias for getFieldByName */\r\n    getField(name: string): AnyField | null | undefined {\r\n        return this.getFieldByName(name);\r\n    }\r\n    /** Retrieves the current value of a field by name */\r\n    getFieldValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /** Retrieves the display value of a field by name */\r\n    getFieldDisplayValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getDisplayValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /** Sets the value of a field by name */\r\n    setFieldValue(name: string, value: any) {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            fld.setValue(value as never); // I don't like using the \"as\" statement here, but it's necessary to satisfy TypeScript.\r\n        }\r\n        return fld;\r\n    }\r\n\r\n    /**\r\n     * Initiates the node, calling prototype methods.\r\n     */\r\n    init() {\r\n        this.emit(NodeSvg.INITING, null);\r\n        if (this.prototype) {\r\n            if (this.prototype.init) this.prototype.init.call(this, this.prototype, this);\r\n            if (this.workspace) {\r\n                this.workspace.addNode(this)\r\n            }\r\n            if (this.prototype.removed) {\r\n                this.on(NodeSvg.REMOVING, () => {\r\n                    this.prototype?.removed.call(this, this.prototype, this);\r\n                })\r\n            }\r\n        } else {\r\n            console.warn(`Node with id ${this.id} is missing a prototype.`)\r\n        }\r\n    }\r\n    /** Returns whether this node has a category style applied */\r\n    hasCategoryStyle() {\r\n        return !!this.colors?.category && this.colors?.category?.length > 0;\r\n    }\r\n\r\n    /** Returns the category name or null if none */\r\n    getCategoryName() {\r\n        return this.colors?.category || null;\r\n    }\r\n\r\n    /** Returns the node's current ColorStyle */\r\n    getStyle() {\r\n        return this.colors;\r\n    }\r\n\r\n    /** Internal helper: attach a field to this node */\r\n    _appendFieldItem(field: AnyField) {\r\n        if (!field) console.warn(\"Falsey field passed to _appendFieldItem.\");\r\n        this._fieldColumn.add(field);\r\n    }\r\n\r\n    /** Initialize node from a NodeJson object */\r\n    jsonInit(json: NodeJson) {\r\n        if (json.primaryColor) this.colors.primary = json.primaryColor;\r\n        if (json.secondaryColor) this.colors.secondary = json.secondaryColor;\r\n        if (json.tertiaryColor) this.colors.tertiary = json.tertiaryColor;\r\n\r\n        // Apply category colors if defined\r\n        if (json.category && CategoryColors[json.category]) {\r\n            const style: ColorStyle = CategoryColors[json.category] as ColorStyle;\r\n            Object.assign(this.colors, { category: json.category }, style);\r\n        }\r\n\r\n        this.previousConnection = hasProp(json, 'previousConnection') ? new Connection(null, this, true) : null;\r\n        this.nextConnection = hasProp(json, 'nextConnection') ? new Connection(this, null, false) : null;\r\n\r\n        if (json.labelText) this.labelText = json.labelText;\r\n        if (json.arguments) this.applyJsonArguments(json.arguments);\r\n        if (json.type) {\r\n            this.type = json.type;\r\n        }\r\n    }\r\n\r\n    /* JAVASCRIPT API */\r\n\r\n    /** Apply field definitions from a JSON-like array without full NodeJson */\r\n    applyJsonArguments(args: InputFieldJson[]) {\r\n        for (let field of args) {\r\n            if (!field.type || !field.name) {\r\n                console.warn(`Invalid argument definition at: ${args.indexOf(field)}.`);\r\n                continue;\r\n            }\r\n\r\n            const FieldConstructor: AnyFieldCls | undefined = FieldMap[field.type] as AnyFieldCls | undefined;\r\n            if (!FieldConstructor) {\r\n                console.warn(`Missing field constructor for ${field.type}!`);\r\n                continue;\r\n            }\r\n\r\n            const fld: AnyField = new FieldConstructor();\r\n            fld.fromJson(field); // initialize field\r\n            fld.node = this;\r\n            this._appendFieldItem(fld);\r\n        }\r\n        return this;\r\n    }\r\n    /** Appends a connection field to this node */\r\n    appendConnection(name: string): Field {\r\n        const fld = new (FieldMap['connection'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Appends a numeric input field to this node */\r\n    appendNumber(name: string): Field {\r\n        const fld = new (FieldMap['field_num'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Appends a text input field to this node */\r\n    appendText(name: string): Field {\r\n        const fld = new (FieldMap['field_str'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    /** Appends a field that can hold a connection or raw value */\r\n    appendOptLink(name: string): Field {\r\n        const fld = new (FieldMap['field_both'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Sets the category name for the node */\r\n    setCategoryName(name: string) {\r\n        this.colors.category = name;\r\n        return this;\r\n    }\r\n    /** Applies a ColorStyle to the node */\r\n    setStyle(style: ColorStyle) {\r\n        // apply properties from style into this.colors\r\n        Object.assign(this.colors, style);\r\n        return this;\r\n    }\r\n\r\n    /** Sets primary, secondary, and tertiary colors for the node */\r\n    setColor(primary: Color, secondary: Color, tertiary: Color) {\r\n        this.setStyle({ primary, secondary, tertiary });\r\n        return this;\r\n    }\r\n    /** Sets the label text for the node */\r\n    setLabelText(text: string) {\r\n        this.labelText = text;\r\n        return this;\r\n    }\r\n\r\n    /** Add or replace a previous/next connection based on argument */\r\n    setConnection(prevOrNext: string | number | boolean) {\r\n        const stringed = String(prevOrNext).toLowerCase();\r\n        const cast = stringed == '0' ? 0 : (stringed == '1' ? 1 : (stringed == 'true' ? 1 : (stringed == 'false' ? 0 : 3)));\r\n\r\n        if (cast === 0) {\r\n            this.previousConnection = new Connection(null, this, true);\r\n        } else if (cast === 1) {\r\n            this.nextConnection = new Connection(this, null, false);\r\n        } else {\r\n            console.warn('Invalid prevOrNext argument for NodeSvg.setConnection');\r\n        }\r\n        return this;\r\n    }\r\n    /** Copies another NodeSvg into this node */\r\n    fromNode(other: NodeSvg) {\r\n        if (!other) return;\r\n\r\n        // Copy primitive props\r\n        this.type = other.type;\r\n        this.labelText = other.labelText;\r\n        this.relativeCoords = new Coordinates(other.relativeCoords.x, other.relativeCoords.y);\r\n\r\n        // Copy colors\r\n        this.colors = { ...other.colors };\r\n\r\n        // Copy connections\r\n        this.previousConnection = other.previousConnection\r\n            ? new Connection(null, this, true)\r\n            : null;\r\n        this.nextConnection = other.nextConnection\r\n            ? new Connection(this, null, false)\r\n            : null;\r\n\r\n        // Copy fields\r\n        this._fieldColumn.clear();\r\n        for (let field of other._fieldColumn) {\r\n            const FieldCls = field.constructor as AnyFieldCls;\r\n            const newField = (new FieldCls()) as any;\r\n\r\n            // Copy basic properties\r\n            newField.setName(field.getName());\r\n            if ('getValue' in field && 'setValue' in newField) {\r\n                newField.setValue(field.getValue());\r\n            }\r\n            if ('getLabel' in field && 'setLabel' in newField) {\r\n                newField.setLabel(field.getLabel())\r\n            }\r\n            this._appendFieldItem(newField);\r\n        }\r\n\r\n        // Copy workspace reference\r\n        this.workspace = other.workspace;\r\n\r\n        // Copy prototype reference\r\n        this.prototype = other.prototype;\r\n\r\n\r\n        return this;\r\n    }\r\n    /** Serializes a Connection object, handling fields and nested nodes */\r\n    _serializeConnection(\r\n        c: Connection,\r\n        alreadyProcessed: { [key: string]: SerializedNode }\r\n    ): { field?: boolean | undefined; node?: SerializedNode | undefined } {\r\n        const returned: { field?: boolean; node?: SerializedNode } = {};\r\n        let connected: NodeSvg | AnyField | null = c.isPrevious ? c.getFrom() : c.getTo();\r\n\r\n        if (!connected) return returned;\r\n\r\n        if (connected instanceof NodeSvg) {\r\n            // Avoid serializing the same node twice\r\n            if (alreadyProcessed[connected.id]) {\r\n                return { node: alreadyProcessed[connected.id] };\r\n            }\r\n            returned.node = connected.serialize(alreadyProcessed);\r\n        } else {\r\n            // Field serialization\r\n            const fld = connected as AnyField;\r\n            // If the field has a node, we serialize the node first\r\n            let fieldNode: SerializedNode | undefined;\r\n            if (fld.node) {\r\n                if (alreadyProcessed[fld.node.id]) {\r\n                    fieldNode = alreadyProcessed[fld.node.id];\r\n                } else {\r\n                    fieldNode = fld.node.serialize(alreadyProcessed);\r\n                }\r\n            }\r\n            returned.field = true;\r\n            if (fieldNode) returned.node = fieldNode;\r\n        }\r\n\r\n        return returned;\r\n    }\r\n\r\n    /**\r\n     * Serialize a node, this includes circular references. use toJson to avoid those.\r\n     * @param alreadyProcessed - Internal.\r\n     * @returns \r\n     */\r\n    serialize(alreadyProcessed: { [key: string]: SerializedNode } = {}): SerializedNode {\r\n        if (alreadyProcessed[this.id]) {\r\n            return alreadyProcessed[this.id] as SerializedNode;\r\n        }\r\n\r\n        // Put a placeholder in map *before* serializing connections\r\n        const serialized: SerializedNode = {\r\n            id: this.id,\r\n            type: this.type || '',\r\n            colors: { primary: this.colors.primary, secondary: this.colors.secondary, tertiary: this.colors.tertiary, category: this.colors.category } as ColorStyle,\r\n            label: this.labelText,\r\n            previousConnection: undefined,\r\n            nextConnection: undefined,\r\n            relativeCoords: { x: this.relativeCoords.x, y: this.relativeCoords.y },\r\n            comment: this.comment?.toJson?.(),\r\n            fields: [], // fill after placeholder\r\n        };\r\n        alreadyProcessed[this.id] = serialized;\r\n\r\n        // Now safely fill in the heavy parts\r\n        serialized.fields = this.allFields().map(fld =>\r\n            fld.toJson\r\n                ? fld.toJson(true, alreadyProcessed)\r\n                : {\r\n                    name: fld.getName(),\r\n                    type: fld.constructor.name,\r\n                    value: fld.getValue ? fld.getValue() : undefined,\r\n                }\r\n        );\r\n\r\n        serialized.previousConnection = this.previousConnection\r\n            ? this._serializeConnection(this.previousConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        serialized.nextConnection = this.nextConnection\r\n            ? this._serializeConnection(this.nextConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        return serialized;\r\n    }\r\n\r\n    /**\r\n     * Return a flattened version of the serialized node structure, which is non-circular.\r\n     * Any node reference inside connections or fields is replaced by its ID.\r\n     */\r\n    toJson(): {\r\n        [id: string]: Omit<SerializedNode, 'previousConnection' | 'nextConnection'> & {\r\n            previousConnection?: { field?: FieldOptions; node?: string };\r\n            nextConnection?: { field?: FieldOptions; node?: string };\r\n        }\r\n    } {\r\n        const serialized = this.serialize();\r\n        const flat: { [id: string]: any } = {};\r\n\r\n        const processNode = (node: SerializedNode) => {\r\n            if (flat[node.id]) return;\r\n\r\n            const copy: any = {\r\n                ...node,\r\n                previousConnection: node.previousConnection ? { ...node.previousConnection } : undefined,\r\n                nextConnection: node.nextConnection ? { ...node.nextConnection } : undefined,\r\n            };\r\n\r\n            flat[node.id] = copy;\r\n\r\n            // Handle connections\r\n            if (copy.previousConnection?.node) {\r\n                const prevNode = copy.previousConnection.node;\r\n                copy.previousConnection.node = prevNode.id;\r\n                processNode(prevNode);\r\n            }\r\n            if (copy.nextConnection?.node) {\r\n                const nextNode = copy.nextConnection.node;\r\n                copy.nextConnection.node = nextNode.id;\r\n                processNode(nextNode);\r\n            }\r\n\r\n            // Handle fields recursively\r\n            if (Array.isArray(copy.fields)) {\r\n                for (let fld of copy.fields) {\r\n                    if (fld.node) {\r\n                        processNode(fld.node);\r\n                        fld.node = fld.node.id;\r\n                    }\r\n                    for (let key in fld) {\r\n                        if (fld[key]?.node) {\r\n                            processNode(fld[key]?.node);\r\n                            fld[key].node = fld[key].node.id;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        processNode(serialized);\r\n        return flat;\r\n    }\r\n\r\n    /**\r\n      * Reconstruct a NodeSvg from a SerializedNode structure (handles circular references)\r\n      */\r\n    static _deserialize(\r\n        data: SerializedNode,\r\n        allNodes: { [id: string]: NodeSvg } = {},\r\n        workspace?: WorkspaceSvg\r\n    ): NodeSvg {\r\n        // If already created, return the existing instance\r\n        if (allNodes[data.id]) return allNodes[data.id] as NodeSvg;\r\n\r\n        if (workspace && workspace.getNode(data.id)) {\r\n            workspace.removeNodeById(data.id); // remove old node which had the same id.\r\n        }\r\n        // Create a new node with minimal prototype info (can be patched later)\r\n        const node = new NodeSvg(NodePrototypes[data.type] as NodePrototype, workspace);\r\n        node.id = data.id;\r\n        node.init();\r\n        node.type = data.type;\r\n        node.relativeCoords.set(data.relativeCoords.x, data.relativeCoords.y);\r\n        node.labelText = data.label || '';\r\n        if (data.comment && workspace) {\r\n            node.comment = CommentModel.fromJson(data.comment as CommentSerialized);\r\n            node.comment._parent = node;\r\n            node.comment._isWorkspaceComment = false;\r\n        }\r\n        // IMPORTANT: restore colors from serialized data (if present)\r\n        if (data.colors) {\r\n            // Start with category colors if a category is present and known\r\n            if (data.colors.category && CategoryColors[data.colors.category]) {\r\n                const style: ColorStyle = CategoryColors[data.colors.category] as ColorStyle;\r\n                Object.assign(node.colors, style, { category: data.colors.category });\r\n            }\r\n            // Then override with explicit serialized colors (primary/secondary/tertiary)\r\n            // This preserves explicit color values even when a category was saved\r\n            const explicit: Partial<ColorStyle> = {};\r\n            if (data.colors.primary) explicit.primary = data.colors.primary;\r\n            if (data.colors.secondary) explicit.secondary = data.colors.secondary;\r\n            if (data.colors.tertiary) explicit.tertiary = data.colors.tertiary;\r\n            if (data.colors.category) explicit.category = data.colors.category;\r\n            node.setStyle(explicit as ColorStyle);\r\n        }\r\n        // Register placeholder before deserializing connections to handle circular refs\r\n        allNodes[node.id] = node;\r\n\r\n        // Deserialize fields\r\n        if (Array.isArray(data.fields)) {\r\n            node._fieldColumn = new Set();\r\n            for (let fldData of data.fields) {\r\n                const FieldConstructor = FieldMap[fldData.type];\r\n                if (!FieldConstructor) continue;\r\n\r\n                const fld: AnyField = new FieldConstructor();\r\n                fld.fromJson(fldData, workspace); // ONLY fldData and workspace\r\n                fld.node = node;\r\n                node._appendFieldItem(fld);\r\n            }\r\n        }\r\n\r\n        // Deserialize previous/next connections\r\n        if (data.previousConnection?.node) {\r\n            node.previousConnection = new Connection(null, node, true);\r\n            node.previousConnection.setFrom(NodeSvg._deserialize(data.previousConnection.node, allNodes, workspace));\r\n        }\r\n\r\n        if (data.nextConnection?.node) {\r\n            node.nextConnection = new Connection(node, null, false);\r\n            node.nextConnection.setTo(NodeSvg._deserialize(data.nextConnection.node, allNodes, workspace));\r\n        } else {\r\n            workspace?.redraw(); // redraw if we reached the end.\r\n        }\r\n\r\n        return node;\r\n    }\r\n    /** Public: Deserialize a SerializedNode or plain object into a NodeSvg attached to a workspace */\r\n    static deserialize(json: SerializedNode | any, workspace: WorkspaceSvg) {\r\n        return this._deserialize(json as SerializedNode, {}, workspace);\r\n    }\r\n    /** Reconstructs nodes from a flattened JSON structure into a NodeSvg tree */\r\n    static fromJson(flat: Record<string, any>, workspace: WorkspaceSvg): any {\r\n        const nodes: Record<string, any> = {};\r\n        // shallow clone so we can safely mutate\r\n        for (const id in flat) {\r\n            nodes[id] = { ...flat[id] };\r\n        }\r\n\r\n        // rebuild references\r\n        for (const id in nodes) {\r\n            const node = nodes[id];\r\n\r\n            // fix connection refs\r\n            if (node.previousConnection?.node) {\r\n                const refId = node.previousConnection.node as string;\r\n                node.previousConnection = {\r\n                    ...node.previousConnection,\r\n                    node: nodes[refId],\r\n                };\r\n            }\r\n            if (node.nextConnection?.node) {\r\n                const refId = node.nextConnection.node as string;\r\n                node.nextConnection = {\r\n                    ...node.nextConnection,\r\n                    node: nodes[refId],\r\n                };\r\n            }\r\n\r\n            // fix fields\r\n            if (Array.isArray(node.fields)) {\r\n                for (const fld of node.fields) {\r\n                    if (typeof fld.node === 'string')\r\n                        fld.node = nodes[fld.node];\r\n\r\n                    for (const key in fld) {\r\n                        const maybe = fld[key];\r\n                        if (maybe?.node && typeof maybe.node === 'string')\r\n                            maybe.node = nodes[maybe.node];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // the root is just the one w/ no previousConnection\r\n        const root = Object.values(nodes).find(n => !n.previousConnection?.node) ?? null;\r\n        return this._deserialize(root, {}, workspace);\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default NodeSvg;\r\n","import CommentModel from \"./comment\";\r\nimport { ContextMenuOpts, Showable } from \"./context-menu\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\n/** Registry for all context menu options */\r\nconst ContextOptsRegistry: ContextMenuOpts[] = [];\r\n\r\n/**\r\n * Global context menu manager\r\n */\r\nconst ContextMenu = {\r\n    /**\r\n     * Register a new context menu option\r\n     * @param id - Unique identifier for the option\r\n     * @param option - Configuration for the context menu item\r\n     */\r\n    registerOption(id: string, option: Omit<ContextMenuOpts, 'id'>) {\r\n        const opt = {\r\n            id,\r\n            click: option.click,\r\n            label: option.label,\r\n            onHoverStart: option.onHoverStart || (() => { }),\r\n            onHoverEnd: option.onHoverEnd || (() => { }),\r\n            showFor: option.showFor || 'any'\r\n        };\r\n        ContextOptsRegistry.push(opt);\r\n    },\r\n\r\n    /**\r\n     * Unregister an existing context menu option by ID\r\n     * @param id - ID of the option to remove\r\n     */\r\n    unregisterOption(id: string) {\r\n        const index = ContextOptsRegistry.findIndex(opt => opt.id === id);\r\n        if (index >= 0) ContextOptsRegistry.splice(index, 1);\r\n    }\r\n};\r\n\r\n// ----- Default options -----\r\n\r\nContextMenu.registerOption('k_delete', {\r\n    showFor: 'node',\r\n    label: 'Delete',\r\n    click: (t) => {\r\n        const target = t as NodeSvg;\r\n        if (!target.workspace) return;\r\n        target.workspace.removeNode(target);\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_deleteall', {\r\n    showFor: 'ws',\r\n    label: 'Delete all',\r\n    click: (t) => {\r\n        const target = t as WorkspaceSvg;\r\n        const isSure = window.confirm(`Are you sure you want to delete ${Array.from(target._nodeDB.keys()).length} nodes?`);\r\n        if (!isSure) return;\r\n        for (let [id, _] of target._nodeDB) {\r\n            target.removeNodeById(id);\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_addcomment', {\r\n    showFor: ['ws', 'node'],\r\n    label: 'Add Comment',\r\n    click: (t) => {\r\n        const target = t;\r\n        if (target instanceof NodeSvg) {\r\n            target.addComment();\r\n            target.setCommentText('Comment!');\r\n        } else if (target instanceof WorkspaceSvg) {\r\n            const model = target.addComment();\r\n            const pos = target.screenToWorkspace(target._ctxMenu.widget.coords.x, target._ctxMenu.widget.coords.y);\r\n            model.relativeCoords.set(pos.x, pos.y);\r\n            model.setText('Comment!');\r\n        }\r\n    }\r\n});\r\nContextMenu.registerOption('k_undo', {\r\n    showFor: ['ws', 'node', 'comment'],\r\n    label: 'Undo',\r\n    click: (t) => {\r\n        if (t instanceof NodeSvg) {\r\n            t.workspace?.history?.undo();\r\n        } else if (t instanceof CommentModel) {\r\n            t.getWorkspace()?.history?.undo();\r\n        } else if (t instanceof WorkspaceSvg) {\r\n            t.history.undo();\r\n        }\r\n    },\r\n    onDraw(el, ws, opt) {\r\n        console.log('onDrawCalled');\r\n        if (!ws.history.canUndo()) {\r\n            (el as HTMLElement).classList.add('disabled')\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_redo', {\r\n    showFor: ['ws', 'node', 'comment'],\r\n    label: 'Redo',\r\n    click: (t) => {\r\n        if (t instanceof NodeSvg) {\r\n            t.workspace?.history?.redo();\r\n        } else if (t instanceof CommentModel) {\r\n            t.getWorkspace()?.history?.redo();\r\n        } else if (t instanceof WorkspaceSvg) {\r\n            t.history.redo();\r\n        }\r\n    },\r\n    onDraw(el, ws, opt) {\r\n        console.log('onDrawCalled');\r\n        if (!ws.history.canRedo()) {\r\n            (el as HTMLElement).classList.add('disabled')\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_deletecomment', {\r\n    showFor: 'comment',\r\n    label: 'Delete Comment',\r\n    click: (t) => {\r\n        const target = t as CommentModel;\r\n        if (target.isNodeComment() && target._parent instanceof NodeSvg) {\r\n            target._parent.removeComment();\r\n        } else {\r\n            target.getWorkspace().removeComment(target);\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_duplicate', {\r\n    showFor: 'node',\r\n    label: 'Duplicate',\r\n    click: t => {\r\n        const node = t as NodeSvg;\r\n        if (!node.workspace) return;\r\n        node.workspace.cloneNode(node);\r\n    }\r\n});\r\n\r\nexport { ContextMenu };\r\nexport default ContextOptsRegistry;\r\n","type WindowEventKeys =\r\n\t| 'resize'\r\n\t| 'scroll'\r\n\t| 'blur'\r\n\t| 'focus'\r\n\t| 'visibilitychange'\r\n\t| 'pointerlockchange'\r\n\t| 'beforeunload';\r\n\r\ntype WindowListenersMap = Record<WindowEventKeys, Array<(event: Event) => void>>;\r\n\r\nconst windowListeners: WindowListenersMap = {\r\n\tresize: [],\r\n\tscroll: [],\r\n\tblur: [],\r\n\tfocus: [],\r\n\tvisibilitychange: [],\r\n\tpointerlockchange: [],\r\n\tbeforeunload: [],\r\n};\r\n\r\nfunction handleEvent(type: WindowEventKeys, event: Event) {\r\n\tconst list = windowListeners[type];\r\n\tif (!list.length) return;\r\n\tfor (const fn of list) {\r\n\t\ttry {\r\n\t\t\tfn(event);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(`[Kabel] Error in window listener for '${type}':`, err);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// auto attach\r\n(Object.keys(windowListeners) as WindowEventKeys[]).forEach((type) => {\r\n\twindow.addEventListener(type, (e) => handleEvent(type, e));\r\n});\r\n\r\nexport function addWindowListener(\r\n\ttype: WindowEventKeys,\r\n\tfn: (event: Event) => void\r\n) {\r\n\twindowListeners[type].push(fn);\r\n}\r\n\r\nexport function removeWindowListener(\r\n\ttype: WindowEventKeys,\r\n\tfn: (event: Event) => void\r\n) {\r\n\tconst list = windowListeners[type];\r\n\tconst i = list.indexOf(fn);\r\n\tif (i !== -1) list.splice(i, 1);\r\n}\r\n\r\nexport function clearWindowListeners(type?: WindowEventKeys) {\r\n\tif (type) windowListeners[type].length = 0;\r\n\telse (Object.keys(windowListeners) as WindowEventKeys[]).forEach((k) => {\r\n\t\twindowListeners[k].length = 0;\r\n\t});\r\n}\r\n\r\nexport default windowListeners;\r\n","type EventHandler<T = any> = (payload: T) => void;\r\n\r\nclass EventEmitter<Events extends Record<string, any>> {\r\n\tprivate listeners: { [K in keyof Events]?: EventHandler<Events[K]>[] } = {};\r\n\r\n\ton<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) this.listeners[event] = [];\r\n\t\tthis.listeners[event]!.push(handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) return this;\r\n\t\tthis.listeners[event] = this.listeners[event]!.filter(h => h !== handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\temit<K extends keyof Events>(event: K, payload: Events[K]) {\r\n\t\tif (!this.listeners[event]) return false;\r\n\t\tthis.listeners[event]!.forEach(handler => handler(payload));\r\n\t\treturn true;\r\n\t}\r\n\r\n\tonce<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tconst wrapper = (payload: Events[K]) => {\r\n\t\t\thandler(payload);\r\n\t\t\tthis.off(event, wrapper);\r\n\t\t};\r\n\t\tthis.on(event, wrapper);\r\n\t\treturn this;\r\n\t}\r\n}\r\nexport default EventEmitter;","import Flyout from \"./flyout\";\r\nimport { InjectOptions, TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport WorkspaceSvg, { WSTheme } from \"./workspace-svg\";\r\nimport Category from \"./category\";\r\n\r\n/**\r\n * Represents the toolbox in a Kabel workspace.\r\n * The toolbox can be either a flyout or a category-based toolbox.\r\n */\r\nclass Toolbox {\r\n    /** Toolbox type: 1 = category toolbox, 2 = flyout toolbox */\r\n    type: 1 | 2;\r\n\r\n    /** Reference to the workspace this toolbox belongs to */\r\n    workspace: WorkspaceSvg;\r\n\r\n    /** Workspace options for initialization */\r\n    wsOptions: InjectOptions;\r\n\r\n    /** Flyout instance for node display */\r\n    _flyout: Flyout;\r\n\r\n    /** Contents of the toolbox (nodes or categories) */\r\n    _contents: TblxNodeStruct[] | TblxCategoryStruct[];\r\n\r\n    /** DOM container element for the toolbox */\r\n    container: HTMLDivElement;\r\n\r\n    /** List of categories (if using a category toolbox) */\r\n    _categories: Category[] = [];\r\n\r\n    /**\r\n     * Creates a new Toolbox instance attached to a workspace.\r\n     * @param workspace The workspace instance to attach this toolbox to\r\n     */\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n        this.wsOptions = this.getOptions();\r\n        this.type = this.wsOptions.toolbox?.type == \"flyout\" ? 2 : 1;\r\n        this._contents = this.wsOptions.toolbox?.contents ?? [];\r\n\r\n        // Pass toolbox reference to flyout\r\n        this._flyout = new Flyout(this);\r\n\r\n        // Create container element\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = \"KabelToolbox\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = \"0\";\r\n        this.container.style.top = \"0\";\r\n        this.container.style.width = \"20%\";\r\n        this.container.style.height = \"100%\";\r\n        this.container.style.background = \"rgba(240,240,240,0.9)\";\r\n        this.container.style.overflowY = \"auto\";\r\n\r\n        // Append to workspace top layer\r\n        workspace._wsTop.appendChild(this.container);\r\n\r\n        // Initialize toolbox depending on type\r\n        if (this.type === 1) this.initCategoryToolbox();\r\n        if (this.type === 2) this.initFlyoutToolbox();\r\n    }\r\n    /**\r\n     * Applies a WSTheme to the toolbox and flyout elements.\r\n     * @param theme The workspace theme to apply\r\n     */\r\n    updateStyles(theme: WSTheme) {\r\n        if (!theme?.UIStyles) return;\r\n\r\n        const { toolboxCategoriesBG, toolboxFlyoutBG } = theme.UIStyles;\r\n\r\n        const applyStyles = (el: HTMLElement, styles?: Partial<CSSStyleDeclaration>) => {\r\n            if (!styles) return;\r\n\r\n            for (const key in styles) {\r\n                const k = key as keyof CSSStyleDeclaration;\r\n                const v = styles[k];\r\n                // Only assign if value exists\r\n                if (v !== undefined) {\r\n                    // cast to any to avoid TS errors\r\n                    (el.style as any)[k] = v;\r\n                }\r\n            }\r\n        };\r\n\r\n        if (this.type === 1) applyStyles(this.container, toolboxCategoriesBG);\r\n        if (this._flyout?.container) applyStyles(this._flyout.container, toolboxFlyoutBG);\r\n    }\r\n\r\n\r\n    /**\r\n     * Retrieves the workspace options.\r\n     * @returns The workspace's InjectOptions\r\n     */\r\n    getOptions() {\r\n        return this.workspace.options;\r\n    }\r\n\r\n    /**\r\n     * Initializes a category-based toolbox.\r\n     * Converts the toolbox contents into Category instances and attaches them.\r\n     */\r\n    initCategoryToolbox() {\r\n        const categories = this._contents as TblxCategoryStruct[];\r\n        categories.forEach(cData => {\r\n            const category = new Category(this, cData);\r\n            this._categories.push(category);\r\n        });\r\n\r\n        // Hide flyout when workspace is clicked\r\n        this.workspace.svg.on(\"click\", () => this._flyout.hide());\r\n    }\r\n\r\n    /**\r\n     * Initializes a flyout toolbox.\r\n     * Fills the flyout with the node definitions from the toolbox contents.\r\n     */\r\n    initFlyoutToolbox() {\r\n        this.container.style.display = \"none\";\r\n        const nodes = this._contents as TblxNodeStruct[];\r\n        this._flyout.fill(nodes);\r\n    }\r\n}\r\n\r\nexport default Toolbox;\r\n","import Workspace from \"./workspace\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\n/**\r\n * Holds a reference to the main WorkspaceSvg instance.\r\n * Mimics Blockly's getMainWorkspace API for Kabel.\r\n */\r\nlet mainws: WorkspaceSvg | Workspace | null = null;\r\n\r\n/**\r\n * Returns the current main workspace instance.\r\n * \r\n * @returns The main WorkspaceSvg or null if none is set.\r\n */\r\nfunction getMainWorkspace(): WorkspaceSvg | Workspace | null {\r\n    return mainws;\r\n}\r\n\r\n/**\r\n * Sets the main workspace reference.\r\n * Calling this updates the global \"main workspace\" for Kabel.\r\n * \r\n * @param ws - The WorkspaceSvg instance to set as main, or null to clear.\r\n * @returns The workspace that was set.\r\n */\r\nfunction setMainWorkspace(ws: WorkspaceSvg | Workspace | null) {\r\n    return (mainws = ws);\r\n}\r\n\r\n/**\r\n * Clears the main workspace reference.\r\n * After calling, getMainWorkspace() will return null.\r\n * \r\n * @returns Always returns null.\r\n */\r\nfunction clearMainWorkspace() {\r\n    return (mainws = null);\r\n}\r\n\r\nexport {\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    clearMainWorkspace\r\n};\r\n\r\n/**\r\n * Note:\r\n * This mimics the Blockly.getMainWorkspace API.\r\n * When you inject a new workspace in Kabel, calling setMainWorkspace\r\n * sets the global main workspace reference, so you can easily retrieve it later.\r\n */\r\n","import { Element, G } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\nconst draggableStore: Record<string, { x: number, y: number }> = {};\r\n\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    let isDragging = false;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    // fallback to element itself if no drag handle is given\r\n    const dragTarget: Element = args.dragel ?? element;\r\n\r\n    // Restore position if previously stored (type 3)\r\n    if (args.type === 3 && args.id && draggableStore[args.id]) {\r\n        const pos = draggableStore[args.id];\r\n        if (pos) element.move(pos.x, pos.y);\r\n    }\r\n\r\n    function onMouseDown(e: MouseEvent) {\r\n        if (args.type === 2 && args.node) {\r\n            const ws : WorkspaceSvg = args.node.workspace;\r\n            if (!ws) return;\r\n\r\n            const start = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const nodePos = args.node.relativeCoords;\r\n\r\n            offsetX = start.x - nodePos.x;\r\n            offsetY = start.y - nodePos.y;\r\n            ws.beginDrag(args.node, start.x, start.y);\r\n            (args.group as G).front();\r\n            \r\n        } else {\r\n            const bbox = element.bbox();\r\n            offsetX = e.clientX - bbox.x;\r\n            offsetY = e.clientY - bbox.y;\r\n        }\r\n\r\n        isDragging = false;\r\n\r\n        // Mark user as dragging\r\n        userState.setState('dragging');\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        if (args.type === 1 && args.ondrag) args.ondrag(e);\r\n    }\r\n\r\n\r\n    function onMouseMove(e: MouseEvent) {\r\n        if (!isDragging) {\r\n            const dx = e.movementX || 0;\r\n            const dy = e.movementY || 0;\r\n            if (Math.abs(dx) > 2 || Math.abs(dy) > 2) isDragging = true;\r\n        }\r\n        if (!isDragging) return;\r\n\r\n        if (args.type === 2 && args.node && args.node instanceof NodeSvg) {\r\n            const ws: WorkspaceSvg = args.node.workspace as WorkspaceSvg;\r\n            if (!ws) return;\r\n\r\n            // Compute new workspace coordinates\r\n            const mouseWS = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const newX = mouseWS.x - offsetX;\r\n            const newY = mouseWS.y - offsetY;\r\n            args.node.relativeCoords.set(newX, newY);\r\n            ws.updateDrag(newX, newY);\r\n            ws.refresh();\r\n            // Move node visually\r\n            const screenPos = ws.workspaceToScreen(newX, newY);\r\n            element.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${ws.getZoom()})` });\r\n            \r\n            args.node.emit('NODE_DRAG', null);\r\n        } else if (args.type === 1 && args.onmove) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            args.onmove({ x: newX, y: newY });\r\n        } else if (args.type === 3 && args.id) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            draggableStore[args.id] = { x: newX, y: newY };\r\n        }\r\n    }\r\n\r\n    function onMouseUp(e: MouseEvent) {\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n\r\n        // Remove dragging state\r\n        userState.removeState('dragging');\r\n\r\n        if (args.type === 1 && args.enddrag) args.enddrag(e);\r\n        if (args.type === 2 && args.node && args.node instanceof NodeSvg) {\r\n            const ws: WorkspaceSvg = args.node.workspace as WorkspaceSvg;\r\n            if (!ws) return;\r\n            ws.emitChange();\r\n            ws.endDrag();\r\n        }\r\n        isDragging = false;\r\n    }\r\n\r\n    dragTarget.node.addEventListener('mousedown', onMouseDown);\r\n\r\n    // cleanup\r\n    return () => {\r\n        dragTarget.node.removeEventListener('mousedown', onMouseDown);\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draggable', initDraggable as EventSetupFn);\r\n","/**\r\n * Delays execution of a callback by a specified number of animation frames.\r\n *\r\n * Uses `requestAnimationFrame` to count frames, then calls the provided callback.\r\n *\r\n * @param {number} frames - The number of animation frames to wait before executing the callback.\r\n * @param {() => void} callback - The function to execute after the specified frames have passed.\r\n */\r\nfunction waitFrames(frames: number, callback: () => void): void {\r\n\tlet count = 0;\r\n\r\n\tfunction step() {\r\n\t\tcount++;\r\n\t\tif (count >= frames) {\r\n\t\t\tcallback();\r\n\t\t} else {\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t}\r\n\t}\r\n\r\n\trequestAnimationFrame(step);\r\n}\r\n\r\nexport default waitFrames;\r\n","import { NodePrototype } from \"./node-types\";\r\n\r\n/**\r\n * A registry of all node prototypes by name.\r\n * Maps a string key (node type name) to a NodePrototype object\r\n */\r\nconst NodePrototypes: { [key: string]: NodePrototype } = {};\r\n\r\nexport default NodePrototypes;\r\n","import { G } from \"@svgdotjs/svg.js\";\r\nimport Field, { AnyField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\n/**\r\n * Allowed owner types for the dropdown container.\r\n * Can be either a NodeSvg or a Field.\r\n */\r\nexport type AllowedOwner = NodeSvg | AnyField;\r\n\r\n/**\r\n * Get absolute position of an HTMLElement relative to the document.\r\n * @param el - The HTML element to measure.\r\n * @returns The bounding box with scroll offset.\r\n */\r\nfunction getAbsolutePosition(el: HTMLElement) {\r\n    const rect = el.getBoundingClientRect();\r\n    return {\r\n        x: rect.left + window.scrollX,\r\n        y: rect.top + window.scrollY,\r\n        width: rect.width,\r\n        height: rect.height,\r\n    };\r\n}\r\n\r\n/**\r\n * Options for creating a dropdown menu.\r\n */\r\nexport interface DropdownOptions {\r\n    /** List of items to display in the dropdown */\r\n    items: { label: string; value: string }[];\r\n    /** Callback when an item is selected */\r\n    onSelect?: (value: string, item: { label: string; value: string }) => void;\r\n    /** Optional fixed width of the dropdown */\r\n    width?: number;\r\n}\r\n\r\n/**\r\n * Dropdown container for NodeSvg or Field elements.\r\n * Supports singleton behavior (only one dropdown visible at a time).\r\n */\r\nclass DropdownContainer {\r\n    private static current: DropdownContainer | null = null;\r\n    private owner: AllowedOwner | null = null;\r\n    private rootEl: HTMLDivElement;\r\n    private options: DropdownOptions | null = null;\r\n    private constraint: { x: number; y: number; width: number; height: number };\r\n    private offset: { dx: number; dy: number };\r\n    private currentRemoveListener: (() => void) | null = null;\r\n    /**\r\n     * Creates the dropdown container and attaches it to the DOM.\r\n     */\r\n    constructor() {\r\n        this.rootEl = document.createElement(\"div\");\r\n        this.rootEl.className = \"KabelDropdownMenu\";\r\n        this.rootEl.style.position = \"absolute\";\r\n        this.rootEl.style.display = \"none\";\r\n        document.body.appendChild(this.rootEl);\r\n\r\n        this.constraint = { x: 0, y: 0, width: 0, height: 0 };\r\n        this.offset = { dx: 0, dy: 0 };\r\n    }\r\n\r\n    /**\r\n     * Move the dropdown by an offset.\r\n     * @param dx - horizontal offset\r\n     * @param dy - vertical offset\r\n     */\r\n    move(dx: number, dy: number) {\r\n        this.offset.dx = dx;\r\n        this.offset.dy = dy;\r\n        this.updatePosition();\r\n    }\r\n\r\n    /**\r\n     * Update the dropdown position based on constraint and offset.\r\n     */\r\n    private updatePosition() {\r\n        const { x, y, height } = this.constraint;\r\n        const { dx, dy } = this.offset;\r\n        this.rootEl.style.left = `${x + dx}px`;\r\n        this.rootEl.style.top = `${y + height + dy}px`; // anchored below\r\n    }\r\n\r\n    /**\r\n     * Set inner HTML content of the dropdown.\r\n     * @param html - HTML string\r\n     */\r\n    setContent(html: string) {\r\n        this.rootEl.innerHTML = html;\r\n    }\r\n\r\n    /**\r\n     * Append an element as a child to the dropdown.\r\n     * @param element - Element to append\r\n     * @returns The appended element\r\n     */\r\n    appendChild(element: Element) {\r\n        this.rootEl.appendChild(element);\r\n        return element;\r\n    }\r\n\r\n    /**\r\n     * Show the dropdown for a given owner.\r\n     * @param owner - NodeSvg or Field that owns this dropdown\r\n     * @param options - Dropdown configuration options\r\n     */\r\n    show(owner: AllowedOwner, options: DropdownOptions) {\r\n        if (!owner.svgGroup) return;\r\n        this.hide(); // close existing dropdown first\r\n        this.owner = owner;\r\n        if (options) this.options = options;\r\n        if (this.currentRemoveListener) this.currentRemoveListener();\r\n        this.currentRemoveListener = null;\r\n        const groupRect = owner.svgGroup.node.getBoundingClientRect();\r\n        this.constraint = {\r\n            x: groupRect.left + window.scrollX,\r\n            y: groupRect.top + window.scrollY,\r\n            width: groupRect.width,\r\n            height: groupRect.height,\r\n        };\r\n\r\n        this.offset = { dx: 0, dy: 0 };\r\n\r\n        this.rootEl.innerHTML = \"\";\r\n        if (options.width) this.rootEl.style.width = `${options.width}px`;\r\n        this.rootEl.style.display = \"block\";\r\n\r\n        // Render items\r\n        if (options.items) {\r\n            options.items.forEach((item) => {\r\n                const el = document.createElement(\"div\");\r\n                el.className = \"KabelDropdownItem\";\r\n                el.textContent = item.label;\r\n                el.onclick = () => {\r\n                    options.onSelect?.(item.value, item);\r\n                    this.hide();\r\n                };\r\n                this.rootEl.appendChild(el);\r\n            });\r\n        }\r\n        if (owner instanceof NodeSvg) {\r\n            // Add a move listener to the node's workspace.\r\n            const ws = owner.workspace;\r\n            let remove = ws?.addMoveListener(() => {\r\n                if (this.owner !== owner) {\r\n                    remove!(); // disconnect when owner changes.\r\n                    return;\r\n                }\r\n                this.hideIfOwner(owner)\r\n            });\r\n            this.currentRemoveListener = remove as () => void;\r\n        }\r\n        if (owner instanceof Field) {\r\n            // Add a move listener to the field's workspace.\r\n            const ws = owner.node!.workspace;\r\n            let remove = ws?.addMoveListener(() => {\r\n                if (this.owner !== owner) {\r\n                    console.log(\"Disconnecting..\");\r\n                    remove!(); // disconnect when owner changes.\r\n                    return;\r\n                }\r\n                console.log(\"Hiding..\");\r\n                this.hide();\r\n            });\r\n            this.currentRemoveListener = remove as () => void;\r\n        }\r\n        this.updatePosition();\r\n        DropdownContainer.current = this;\r\n    }\r\n\r\n    /**\r\n     * Hide this dropdown.\r\n     */\r\n    hide() {\r\n        if (DropdownContainer.current !== this) return;\r\n        this.rootEl.style.display = \"none\";\r\n        this.rootEl.innerHTML = \"\";\r\n        this.owner = null;\r\n        this.options = null;\r\n        DropdownContainer.current = null;\r\n        if (this.currentRemoveListener) this.currentRemoveListener();\r\n        this.currentRemoveListener = null;\r\n    }\r\n\r\n    /**\r\n     * Hide this dropdown if the given owner currently owns it.\r\n     * @param owner - The owner to check\r\n     */\r\n    hideIfOwner(owner: AllowedOwner) {\r\n        if (this.owner === owner) {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    /** @returns True if the dropdown is currently visible */\r\n    isVisible(): boolean {\r\n        return DropdownContainer.current === this;\r\n    }\r\n\r\n    /** @returns The current owner of the dropdown, or null if none */\r\n    getOwner(): AllowedOwner | null {\r\n        return this.owner;\r\n    }\r\n\r\n    /** @returns The currently visible dropdown container singleton */\r\n    static getCurrent(): DropdownContainer | null {\r\n        return DropdownContainer.current;\r\n    }\r\n}\r\n\r\n// Singleton export\r\nconst dropdownContainer = new DropdownContainer();\r\nexport default dropdownContainer;\r\nexport { DropdownContainer };\r\n","import { WidgetOptions } from \"./widget\";\r\n\r\n/**\r\n * A list of prototypes for widgets.\r\n */\r\nexport interface WidgetPrototypeList {\r\n    [key: string]: WidgetOptions\r\n}\r\n\r\nconst WidgetPrototypes: WidgetPrototypeList = {};\r\nexport default WidgetPrototypes;","import { Element } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport CommentModel from '../src/comment';\r\n\r\n/** The drag handle for comments */\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    const comment = args.comment as CommentModel;\r\n    if (!comment) return () => { };\r\n\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let startRelX = 0;\r\n    let startRelY = 0;\r\n\r\n    function onPointerDown(ev: PointerEvent) {\r\n        ev.preventDefault();\r\n\r\n        const ws = comment.getWorkspace();\r\n        const rel = comment.relativeCoords;\r\n\r\n        // Capture offset from pointer to comment in workspace coords\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n        startRelX = rel.x - pointerWS.x;\r\n        startRelY = rel.y - pointerWS.y;\r\n\r\n        document.addEventListener('pointermove', onPointerMove);\r\n        document.addEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    function onPointerMove(ev: PointerEvent) {\r\n        const ws = comment.getWorkspace();\r\n\r\n        // Map pointer to workspace\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n\r\n        // Add initial offset\r\n        comment.relativeCoords.set(pointerWS.x + startRelX, pointerWS.y + startRelY);\r\n\r\n        ws.refreshComments();\r\n    }\r\n\r\n\r\n\r\n    function onPointerUp() {\r\n        document.removeEventListener('pointermove', onPointerMove);\r\n        document.removeEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    element.node.addEventListener('pointerdown', onPointerDown);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n        element.node.removeEventListener('pointerdown', onPointerDown);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draghandle', initDraggable as EventSetupFn);\r\n","import { Svg, Rect, Circle, G, Path, Element } from '@svgdotjs/svg.js';\r\n\r\nexport type EventType = string;\r\nexport type EventArgs = Record<string, any>;\r\nexport type EventSetupFn = (el: Element, args?: EventArgs) => (() => void) | void;\r\n\r\nexport interface RegisteredEl {\r\n    tags: string[],\r\n    el: Element;\r\n    type: EventType;\r\n    args?: EventArgs | undefined;      // allow undefined explicitly\r\n    destroyFn?: (() => void) | undefined; // allow undefined explicitly\r\n}\r\n\r\n/**\r\n * Used by the Kabel renderer to tag svg.js elements as interactable with the kabel system.\r\n */\r\nclass Eventer {\r\n    private elements: RegisteredEl[] = [];\r\n    private eventRegistry: Map<EventType, EventSetupFn> = new Map();\r\n\r\n    // Register an event type with a setup function\r\n    registerEvent(type: EventType, setupFn: EventSetupFn) {\r\n        this.eventRegistry.set(type, setupFn);\r\n        return this; // allow chaining\r\n    }\r\n    tagElement(el: Element, tags?: string[] | string) {\r\n        if (!tags) return this;\r\n        const tagList = Array.isArray(tags) ? tags : [tags];\r\n\r\n        // Find the registered elements for this el\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el) {\r\n                for (const t of tagList) {\r\n                    if (!reg.tags.includes(t)) reg.tags.push(t);\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    destroyByTag(tag: string) {\r\n        let destroyed = false;\r\n        this.elements = this.elements.filter(reg => {\r\n            if (reg.tags.includes(tag)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                return false; // remove this element\r\n            }\r\n            return true; // keep element\r\n        });\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    // addElement\r\n    addElement(el: Element, types: EventType | EventType[], args?: EventArgs) {\r\n        const typeList = Array.isArray(types) ? types : [types];\r\n        for (const type of typeList) {\r\n            const destroyFn = this.setupElement(el, type, args) as (() => void) | undefined;\r\n            this.elements.push({\r\n                tags: [],\r\n                el,\r\n                type,\r\n                args,\r\n                destroyFn\r\n            });\r\n        }\r\n        return this;\r\n    }\r\n\r\n    // refresh\r\n    refresh() {\r\n        for (const reg of this.elements) {\r\n            if (reg.destroyFn) reg.destroyFn();\r\n            reg.destroyFn = this.setupElement(reg.el, reg.type, reg.args) as (() => void) | undefined;\r\n        }\r\n    }\r\n\r\n\r\n    // Destroy event(s) for an element\r\n    destroyElement(el: Element, type?: EventType) {\r\n        let destroyed = false;\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el && (!type || reg.type === type)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                // Remove from elements array\r\n                this.elements = this.elements.filter(r => r !== reg);\r\n            }\r\n        }\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    private setupElement(el: Element, type: EventType, args?: EventArgs): (() => void) | undefined {\r\n        const setupFn = this.eventRegistry.get(type);\r\n        if (!setupFn) return;\r\n        const destroyFn = setupFn(el, args);\r\n        return destroyFn instanceof Function ? destroyFn : undefined;\r\n    }\r\n}\r\n\r\nconst eventer = new Eventer();\r\nexport default eventer;\r\nexport { Eventer };\r\n","// Convert an arc to a sequence of cubic bzier curves\n//\n'use strict';\n\n\nvar TAU = Math.PI * 2;\n\n\n/* eslint-disable space-infix-ops */\n\n// Calculate an angle between two unit vectors\n//\n// Since we measure angle between radii of circular arcs,\n// we can use simplified math (without length normalization)\n//\nfunction unit_vector_angle(ux, uy, vx, vy) {\n  var sign = (ux * vy - uy * vx < 0) ? -1 : 1;\n  var dot  = ux * vx + uy * vy;\n\n  // Add this to work with arbitrary vectors:\n  // dot /= Math.sqrt(ux * ux + uy * uy) * Math.sqrt(vx * vx + vy * vy);\n\n  // rounding errors, e.g. -1.0000000000000002 can screw up this\n  if (dot >  1.0) { dot =  1.0; }\n  if (dot < -1.0) { dot = -1.0; }\n\n  return sign * Math.acos(dot);\n}\n\n\n// Convert from endpoint to center parameterization,\n// see http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n//\n// Return [cx, cy, theta1, delta_theta]\n//\nfunction get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi) {\n  // Step 1.\n  //\n  // Moving an ellipse so origin will be the middlepoint between our two\n  // points. After that, rotate it to line up ellipse axes with coordinate\n  // axes.\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  var rx_sq  =  rx * rx;\n  var ry_sq  =  ry * ry;\n  var x1p_sq = x1p * x1p;\n  var y1p_sq = y1p * y1p;\n\n  // Step 2.\n  //\n  // Compute coordinates of the centre of this ellipse (cx', cy')\n  // in the new coordinate system.\n  //\n  var radicant = (rx_sq * ry_sq) - (rx_sq * y1p_sq) - (ry_sq * x1p_sq);\n\n  if (radicant < 0) {\n    // due to rounding errors it might be e.g. -1.3877787807814457e-17\n    radicant = 0;\n  }\n\n  radicant /=   (rx_sq * y1p_sq) + (ry_sq * x1p_sq);\n  radicant = Math.sqrt(radicant) * (fa === fs ? -1 : 1);\n\n  var cxp = radicant *  rx/ry * y1p;\n  var cyp = radicant * -ry/rx * x1p;\n\n  // Step 3.\n  //\n  // Transform back to get centre coordinates (cx, cy) in the original\n  // coordinate system.\n  //\n  var cx = cos_phi*cxp - sin_phi*cyp + (x1+x2)/2;\n  var cy = sin_phi*cxp + cos_phi*cyp + (y1+y2)/2;\n\n  // Step 4.\n  //\n  // Compute angles (theta1, delta_theta).\n  //\n  var v1x =  (x1p - cxp) / rx;\n  var v1y =  (y1p - cyp) / ry;\n  var v2x = (-x1p - cxp) / rx;\n  var v2y = (-y1p - cyp) / ry;\n\n  var theta1 = unit_vector_angle(1, 0, v1x, v1y);\n  var delta_theta = unit_vector_angle(v1x, v1y, v2x, v2y);\n\n  if (fs === 0 && delta_theta > 0) {\n    delta_theta -= TAU;\n  }\n  if (fs === 1 && delta_theta < 0) {\n    delta_theta += TAU;\n  }\n\n  return [ cx, cy, theta1, delta_theta ];\n}\n\n//\n// Approximate one unit arc segment with bzier curves,\n// see http://math.stackexchange.com/questions/873224\n//\nfunction approximate_unit_arc(theta1, delta_theta) {\n  var alpha = 4/3 * Math.tan(delta_theta/4);\n\n  var x1 = Math.cos(theta1);\n  var y1 = Math.sin(theta1);\n  var x2 = Math.cos(theta1 + delta_theta);\n  var y2 = Math.sin(theta1 + delta_theta);\n\n  return [ x1, y1, x1 - y1*alpha, y1 + x1*alpha, x2 + y2*alpha, y2 - x2*alpha, x2, y2 ];\n}\n\nmodule.exports = function a2c(x1, y1, x2, y2, fa, fs, rx, ry, phi) {\n  var sin_phi = Math.sin(phi * TAU / 360);\n  var cos_phi = Math.cos(phi * TAU / 360);\n\n  // Make sure radii are valid\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  if (x1p === 0 && y1p === 0) {\n    // we're asked to draw line to itself\n    return [];\n  }\n\n  if (rx === 0 || ry === 0) {\n    // one of the radii is zero\n    return [];\n  }\n\n\n  // Compensate out-of-range radii\n  //\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n\n  var lambda = (x1p * x1p) / (rx * rx) + (y1p * y1p) / (ry * ry);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n\n  // Get center parameters (cx, cy, theta1, delta_theta)\n  //\n  var cc = get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi);\n\n  var result = [];\n  var theta1 = cc[2];\n  var delta_theta = cc[3];\n\n  // Split an arc to multiple segments, so each segment\n  // will be less than /4 (= 90)\n  //\n  var segments = Math.max(Math.ceil(Math.abs(delta_theta) / (TAU / 4)), 1);\n  delta_theta /= segments;\n\n  for (var i = 0; i < segments; i++) {\n    result.push(approximate_unit_arc(theta1, delta_theta));\n    theta1 += delta_theta;\n  }\n\n  // We have a bezier approximation of a unit circle,\n  // now need to transform back to the original ellipse\n  //\n  return result.map(function (curve) {\n    for (var i = 0; i < curve.length; i += 2) {\n      var x = curve[i + 0];\n      var y = curve[i + 1];\n\n      // scale\n      x *= rx;\n      y *= ry;\n\n      // rotate\n      var xp = cos_phi*x - sin_phi*y;\n      var yp = sin_phi*x + cos_phi*y;\n\n      // translate\n      curve[i + 0] = xp + cc[0];\n      curve[i + 1] = yp + cc[1];\n    }\n\n    return curve;\n  });\n};\n","'use strict';\n\nmodule.exports = require('./lib/svgpath');\n","/**\r\n * Kabel Core Export Module\r\n * ------------------------\r\n * Aggregates all core Kabel modules, types, utilities, and components,\r\n * and exports them under a single namespace.\r\n */\r\n\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport Renderer, { DrawState, ConnectorToFrom } from \"../renderers/renderer\";\r\nimport CategoryColors from \"./colors\";\r\nimport Connection, { Connectable } from \"./connection\";\r\nimport Coordinates from \"./coordinates\";\r\nimport Field, { \r\n    FieldOptions, FieldVisualInfo, AnyFieldCls, AnyField, DummyField, \r\n    FieldMap, NumberField, OptConnectField, TextField, ConnectableField, \r\n    FieldRawBoxData, FieldConnectionData \r\n} from \"./field\";\r\nimport inject, { \r\n    InjectMsg, InjectOptions, TblxCategoryStruct, TblxObjStruct, \r\n    TblxFieldStruct, TblxNodeStruct, GridOptions\r\n} from \"./inject\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport NodeSvg, { NodeJson, NodeEvents, InputFieldJson, SerializedNode } from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport WorkspaceCoords from \"./workspace-coords\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport eventer, { Eventer,  EventSetupFn, EventArgs, RegisteredEl } from \"../util/eventer\";\r\nimport hasProp from \"../util/has-prop\";\r\nimport EventEmitter from \"../util/emitter\";\r\nimport * as Path from \"../util/path\";\r\nimport * as SVG from \"@svgdotjs/svg.js\";\r\nimport * as UID from \"../util/uid\";\r\n\r\nimport K from \"./core\";\r\nimport Widget, { WidgetOptions } from \"./widget\";\r\nimport { WidgetPrototypeList } from \"./widget-prototypes\";\r\nimport Showable, { KabelInterface, KabelCommentRendering, KabelNodeRendering, KabelUIX, KabelUtils } from \"./types\";\r\n\r\n//@ts-ignore\r\nconst Kabel: KabelInterface = K;\r\nexport default Kabel;\r\n\r\n// Core types and utilities\r\nexport {\r\n    KabelInterface,\r\n    TblxCategoryStruct,\r\n    TblxNodeStruct,\r\n    TblxFieldStruct,\r\n    TblxObjStruct,\r\n    RendererConstants,\r\n    Renderer,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    ConnectableField,\r\n    FieldRawBoxData,\r\n    FieldConnectionData,\r\n    inject,\r\n    InjectMsg,\r\n    InjectOptions,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    NodePrototypes,\r\n    WorkspaceSvg,\r\n    WorkspaceCoords,\r\n    NodePrototype,\r\n    Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple,\r\n    NodeJson, NodeEvents, InputFieldJson,\r\n    SerializedNode,\r\n    Eventer,\r\n    EventSetupFn,\r\n    EventArgs,\r\n    Connectable,\r\n    DrawState,\r\n    ConnectorToFrom,\r\n    WidgetOptions,\r\n    WidgetPrototypeList,\r\n    KabelCommentRendering,\r\n    KabelNodeRendering,\r\n    KabelUIX,\r\n    KabelUtils,\r\n    Showable,\r\n    RegisteredEl,\r\n    GridOptions\r\n};\r\n\r\n// Core classes used by public API\r\nexport { default as CommentModel } from './comment';\r\n\r\nexport { default as Toolbox } from './toolbox';\r\nexport { default as ContextMenuHTML } from './context-menu';\r\nexport { default as Widget } from './widget';\r\nexport {  DropdownContainer } from './dropdown-menu';\r\nexport { RepresenterNode } from '../renderers/representer-node';\r\nexport { default as CommentRenderer } from '../comment-renderer/renderer';\r\nexport { default as Representer } from '../renderers/representer';\r\n\r\n// Controllers\r\nexport { default as WorkspaceController } from '../controllers/base';\r\nexport { default as WASDController } from '../controllers/wasd';\r\n","/**\r\n * Represents a 2D coordinate in space.\r\n */\r\nclass Coordinates {\r\n\t/** X position */\r\n\tx: number;\r\n\t/** Y position */\r\n\ty: number;\r\n\r\n\t/**\r\n\t * Creates a new Coordinates instance\r\n\t * @param x - The x value (default 0)\r\n\t * @param y - The y value (default 0)\r\n\t */\r\n\tconstructor(x: number = 0, y: number = 0) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the coordinates to new values\r\n\t * @param x - The new x value\r\n\t * @param y - The new y value\r\n\t */\r\n\tset(x: number, y: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this coordinate\r\n\t * @returns A new Coordinates instance with the same x and y\r\n\t */\r\n\tclone(): Coordinates {\r\n\t\treturn new Coordinates(this.x, this.y);\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the Euclidean distance to another coordinate\r\n\t * @param other - The target coordinate\r\n\t * @returns The distance as a number\r\n\t */\r\n\tdistanceTo(other: Coordinates): number {\r\n\t\tconst dx = this.x - other.x;\r\n\t\tconst dy = this.y - other.y;\r\n\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to a string representation\r\n\t * @returns A string like \"(x, y)\"\r\n\t */\r\n\ttoString(): string {\r\n\t\treturn `(${this.x}, ${this.y})`;\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to an array [x, y]\r\n\t * @returns Tuple of numbers [x, y]\r\n\t */\r\n\ttoArray(): [number, number] {\r\n\t\treturn [this.x, this.y];\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to an object { x, y }\r\n\t * @returns Object with x and y properties\r\n\t */\r\n\ttoObject(): { x: number; y: number } {\r\n\t\treturn { x: this.x, y: this.y };\r\n\t}\r\n}\r\n\r\nexport default Coordinates;\r\n","import { Color, Hex } from \"../src/visual-types\";\r\n\r\nclass RendererConstants {\r\n    CORNER_RADIUS!: number;\r\n    NODE_BASE_WIDTH!: number;\r\n    NODE_BASE_HEIGHT!: number;\r\n    TOPBAR_HEIGHT!: number;\r\n    FOOTER_HEIGHT!: number;\r\n    PADDING_BIG!: number;\r\n    PADDING_MEDIUM!: number;\r\n    PADDING_SMALL!: number;\r\n    FIELD_SPACEY!: number;\r\n    FIELD_SPACEX!: number;\r\n    FIELD_RAW_BASE_WIDTH!: number;\r\n    FIELD_RAW_BASE_HEIGHT!: number;\r\n    INPUT_BOX_PADDING!: number;\r\n    INPUT_BOX_TEXT_ANCHOR!: 'start' | 'middle';\r\n    LABEL_SPACING!: number;\r\n\r\n    FIELD_RAW_COLOR: Color = '#2b2d36ff';\r\n    FIELD_RAW_TEXT_COLOR: Color = '#e0e2e8ff';\r\n    FIELD_RAW_OUTLINE_COLOR: Color = '#1f2027ff';\r\n    FIELD_RAW_OUTLINE_STROKE!: number;\r\n    FIELD_CONN_COLOR: Color = '#0c7cccff'\r\n    NODE_BG_COLOR: Color = '#2c2d3aff';\r\n    NODE_OUTLINE_COLOR: Color = '#1d1e25ff';\r\n    CONNECTOR_TRIANGLE!: boolean;\r\n    CONNECTION_STROKE_WIDTH!: number;\r\n    CONNECTION_STROKE_COLOR_CHOICE!: number;\r\n    CONNECTOR_TRI_SIZE!: number;\r\n    CONNECTOR_RADIUS!: number;\r\n    FONT_FAMILY: string =\r\n        '\"Inter\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif';\r\n    FONT_SIZE!: number;\r\n    FONT_COLOR: Color = '#e0e2e8ff';\r\n\r\n    FIELD_MARGIN_X!: number;\r\n    FIELD_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_MARGIN_X!: number;\r\n    TOPBAR_LABEL_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_BOLDED!: boolean;\r\n    CONNECTOR_LINE_WIDTH: number = 6;\r\n    CONNECTOR_LINE_CURVED: boolean = true;\r\n    ZOOM_BASE: number = 1; // default scale factor for workspace\r\n\r\n    SHAPES: {\r\n        [key: string]: {\r\n            PathMain: string;\r\n            Width: number;\r\n            Height: number;\r\n        }\r\n    } = {}\r\n    constructor(overrides: Partial<RendererConstants> = {}) {\r\n        this.CONNECTOR_TRI_SIZE = 8;\r\n        this.CONNECTOR_RADIUS = 10;\r\n        this.CORNER_RADIUS = 6;\r\n        this.NODE_BASE_WIDTH = 200;\r\n        this.NODE_BASE_HEIGHT = 240;\r\n\r\n        this.TOPBAR_HEIGHT = 50;\r\n        this.FOOTER_HEIGHT = 25;\r\n        this.PADDING_BIG = 16;\r\n        this.PADDING_MEDIUM = 8;\r\n        this.PADDING_SMALL = 4;\r\n        this.FIELD_RAW_BASE_WIDTH = 80;\r\n        this.FIELD_RAW_BASE_HEIGHT = 42;\r\n        this.INPUT_BOX_PADDING = 6;\r\n        this.LABEL_SPACING = 5;\r\n        this.INPUT_BOX_TEXT_ANCHOR = 'middle';\r\n        this.CONNECTOR_TRIANGLE = false;\r\n        this.CONNECTION_STROKE_WIDTH = 2;\r\n        this.CONNECTION_STROKE_COLOR_CHOICE = 1;\r\n        this.FIELD_RAW_OUTLINE_STROKE = 2;\r\n        this.FIELD_SPACEY = 20;\r\n        this.FIELD_SPACEX = 20;\r\n        this.FONT_SIZE = 20;\r\n        this.TOPBAR_LABEL_BOLDED = true;\r\n        this.FIELD_MARGIN_X = 16;\r\n        this.FIELD_MARGIN_Y = 16;\r\n        this.TOPBAR_LABEL_MARGIN_X = 12;\r\n        this.TOPBAR_LABEL_MARGIN_Y = 0;\r\n\r\n        Object.assign(this, overrides);\r\n    }\r\n}\r\n\r\nexport default RendererConstants;\r\n","// SVG Path transformations library\n//\n// Usage:\n//\n//    SvgPath('...')\n//      .translate(-150, -100)\n//      .scale(0.5)\n//      .translate(-150, -100)\n//      .toFixed(1)\n//      .toString()\n//\n\n'use strict';\n\n\nvar pathParse      = require('./path_parse');\nvar transformParse = require('./transform_parse');\nvar matrix         = require('./matrix');\nvar a2c            = require('./a2c');\nvar ellipse        = require('./ellipse');\n\n\n// Class constructor\n//\nfunction SvgPath(path) {\n  if (!(this instanceof SvgPath)) { return new SvgPath(path); }\n\n  var pstate = pathParse(path);\n\n  // Array of path segments.\n  // Each segment is array [command, param1, param2, ...]\n  this.segments = pstate.segments;\n\n  // Error message on parse error.\n  this.err      = pstate.err;\n\n  // Transforms stack for lazy evaluation\n  this.__stack    = [];\n}\n\nSvgPath.from = function (src) {\n  if (typeof src === 'string') return new SvgPath(src);\n\n  if (src instanceof SvgPath) {\n    // Create empty object\n    var s = new SvgPath('');\n\n    // Clone properies\n    s.err = src.err;\n    s.segments = src.segments.map(function (sgm) { return sgm.slice(); });\n    s.__stack = src.__stack.map(function (m) {\n      return matrix().matrix(m.toArray());\n    });\n\n    return s;\n  }\n\n  throw new Error('SvgPath.from: invalid param type ' + src);\n};\n\n\nSvgPath.prototype.__matrix = function (m) {\n  var self = this, i;\n\n  // Quick leave for empty matrix\n  if (!m.queue.length) { return; }\n\n  this.iterate(function (s, index, x, y) {\n    var p, result, name, isRelative;\n\n    switch (s[0]) {\n\n      // Process 'assymetric' commands separately\n      case 'v':\n        p      = m.calc(0, s[1], true);\n        result = (p[0] === 0) ? [ 'v', p[1] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'V':\n        p      = m.calc(x, s[1], false);\n        result = (p[0] === m.calc(x, y, false)[0]) ? [ 'V', p[1] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'h':\n        p      = m.calc(s[1], 0, true);\n        result = (p[1] === 0) ? [ 'h', p[0] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'H':\n        p      = m.calc(s[1], y, false);\n        result = (p[1] === m.calc(x, y, false)[1]) ? [ 'H', p[0] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'a':\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n\n        // Drop segment if arc is empty (end point === start point)\n        /*if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          return [];\n        }*/\n\n        // Transform rx, ry and the x-axis-rotation\n        var ma = m.toArray();\n        var e = ellipse(s[1], s[2], s[3]).transform(ma);\n\n        // flip sweep-flag if matrix is not orientation-preserving\n        if (ma[0] * ma[3] - ma[1] * ma[2] < 0) {\n          s[5] = s[5] ? '0' : '1';\n        }\n\n        // Transform end point as usual (without translation for relative notation)\n        p = m.calc(s[6], s[7], s[0] === 'a');\n\n        // Empty arcs can be ignored by renderer, but should not be dropped\n        // to avoid collisions with `S A S` and so on. Replace with empty line.\n        if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n          break;\n        }\n\n        // if the resulting ellipse is (almost) a segment ...\n        if (e.isDegenerate()) {\n          // replace the arc by a line\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n        } else {\n          // if it is a real ellipse\n          // s[0], s[4] and s[5] are not modified\n          result = [ s[0], e.rx, e.ry, e.ax, s[4], s[5], p[0], p[1] ];\n        }\n\n        break;\n\n      case 'm':\n        // Edge case. The very first `m` should be processed as absolute, if happens.\n        // Make sense for coord shift transforms.\n        isRelative = index > 0;\n\n        p = m.calc(s[1], s[2], isRelative);\n        result = [ 'm', p[0], p[1] ];\n        break;\n\n      default:\n        name       = s[0];\n        result     = [ name ];\n        isRelative = (name.toLowerCase() === name);\n\n        // Apply transformations to the segment\n        for (i = 1; i < s.length; i += 2) {\n          p = m.calc(s[i], s[i + 1], isRelative);\n          result.push(p[0], p[1]);\n        }\n    }\n\n    self.segments[index] = result;\n  }, true);\n};\n\n\n// Apply stacked commands\n//\nSvgPath.prototype.__evaluateStack = function () {\n  var m, i;\n\n  if (!this.__stack.length) { return; }\n\n  if (this.__stack.length === 1) {\n    this.__matrix(this.__stack[0]);\n    this.__stack = [];\n    return;\n  }\n\n  m = matrix();\n  i = this.__stack.length;\n\n  while (--i >= 0) {\n    m.matrix(this.__stack[i].toArray());\n  }\n\n  this.__matrix(m);\n  this.__stack = [];\n};\n\n\n// Convert processed SVG Path back to string\n//\nSvgPath.prototype.toString = function () {\n  var result = '', prevCmd = '', cmdSkipped = false;\n\n  this.__evaluateStack();\n\n  for (var i = 0, len = this.segments.length; i < len; i++) {\n    var segment = this.segments[i];\n    var cmd = segment[0];\n\n    // Command not repeating => store\n    if (cmd !== prevCmd || cmd === 'm' || cmd === 'M') {\n      // workaround for FontForge SVG importing bug, keep space between \"z m\".\n      if (cmd === 'm' && prevCmd === 'z') result += ' ';\n      result += cmd;\n\n      cmdSkipped = false;\n    } else {\n      cmdSkipped = true;\n    }\n\n    // Store segment params\n    for (var pos = 1; pos < segment.length; pos++) {\n      var val = segment[pos];\n      // Space can be skipped\n      // 1. After command (always)\n      // 2. For negative value (with '-' at start)\n      if (pos === 1) {\n        if (cmdSkipped && val >= 0) result += ' ';\n      } else if (val >= 0) result += ' ';\n\n      result += val;\n    }\n\n    prevCmd = cmd;\n  }\n\n  return result;\n};\n\n\n// Translate path to (x [, y])\n//\nSvgPath.prototype.translate = function (x, y) {\n  this.__stack.push(matrix().translate(x, y || 0));\n  return this;\n};\n\n\n// Scale path to (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.scale = function (sx, sy) {\n  this.__stack.push(matrix().scale(sx, (!sy && (sy !== 0)) ? sx : sy));\n  return this;\n};\n\n\n// Rotate path around point (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.rotate = function (angle, rx, ry) {\n  this.__stack.push(matrix().rotate(angle, rx || 0, ry || 0));\n  return this;\n};\n\n\n// Skew path along the X axis by `degrees` angle\n//\nSvgPath.prototype.skewX = function (degrees) {\n  this.__stack.push(matrix().skewX(degrees));\n  return this;\n};\n\n\n// Skew path along the Y axis by `degrees` angle\n//\nSvgPath.prototype.skewY = function (degrees) {\n  this.__stack.push(matrix().skewY(degrees));\n  return this;\n};\n\n\n// Apply matrix transform (array of 6 elements)\n//\nSvgPath.prototype.matrix = function (m) {\n  this.__stack.push(matrix().matrix(m));\n  return this;\n};\n\n\n// Transform path according to \"transform\" attr of SVG spec\n//\nSvgPath.prototype.transform = function (transformString) {\n  if (!transformString.trim()) {\n    return this;\n  }\n  this.__stack.push(transformParse(transformString));\n  return this;\n};\n\n\n// Round coords with given decimal precition.\n// 0 by default (to integers)\n//\nSvgPath.prototype.round = function (d) {\n  var contourStartDeltaX = 0, contourStartDeltaY = 0, deltaX = 0, deltaY = 0, l;\n\n  d = d || 0;\n\n  this.__evaluateStack();\n\n  this.segments.forEach(function (s) {\n    var isRelative = (s[0].toLowerCase() === s[0]);\n\n    switch (s[0]) {\n      case 'H':\n      case 'h':\n        if (isRelative) { s[1] += deltaX; }\n        deltaX = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'V':\n      case 'v':\n        if (isRelative) { s[1] += deltaY; }\n        deltaY = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'Z':\n      case 'z':\n        deltaX = contourStartDeltaX;\n        deltaY = contourStartDeltaY;\n        return;\n\n      case 'M':\n      case 'm':\n        if (isRelative) {\n          s[1] += deltaX;\n          s[2] += deltaY;\n        }\n\n        deltaX = s[1] - s[1].toFixed(d);\n        deltaY = s[2] - s[2].toFixed(d);\n\n        contourStartDeltaX = deltaX;\n        contourStartDeltaY = deltaY;\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        return;\n\n      case 'A':\n      case 'a':\n        // [cmd, rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        if (isRelative) {\n          s[6] += deltaX;\n          s[7] += deltaY;\n        }\n\n        deltaX = s[6] - s[6].toFixed(d);\n        deltaY = s[7] - s[7].toFixed(d);\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        s[3] = +s[3].toFixed(d + 2); // better precision for rotation\n        s[6] = +s[6].toFixed(d);\n        s[7] = +s[7].toFixed(d);\n        return;\n\n      default:\n        // a c l q s t\n        l = s.length;\n\n        if (isRelative) {\n          s[l - 2] += deltaX;\n          s[l - 1] += deltaY;\n        }\n\n        deltaX = s[l - 2] - s[l - 2].toFixed(d);\n        deltaY = s[l - 1] - s[l - 1].toFixed(d);\n\n        s.forEach(function (val, i) {\n          if (!i) { return; }\n          s[i] = +s[i].toFixed(d);\n        });\n        return;\n    }\n  });\n\n  return this;\n};\n\n\n// Apply iterator function to all segments. If function returns result,\n// current segment will be replaced to array of returned segments.\n// If empty array is returned, current regment will be deleted.\n//\nSvgPath.prototype.iterate = function (iterator, keepLazyStack) {\n  var segments = this.segments,\n      replacements = {},\n      needReplace = false,\n      lastX = 0,\n      lastY = 0,\n      countourStartX = 0,\n      countourStartY = 0;\n  var i, j, newSegments;\n\n  if (!keepLazyStack) {\n    this.__evaluateStack();\n  }\n\n  segments.forEach(function (s, index) {\n\n    var res = iterator(s, index, lastX, lastY);\n\n    if (Array.isArray(res)) {\n      replacements[index] = res;\n      needReplace = true;\n    }\n\n    var isRelative = (s[0] === s[0].toLowerCase());\n\n    // calculate absolute X and Y\n    switch (s[0]) {\n      case 'm':\n      case 'M':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        lastY = s[2] + (isRelative ? lastY : 0);\n        countourStartX = lastX;\n        countourStartY = lastY;\n        return;\n\n      case 'h':\n      case 'H':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        return;\n\n      case 'v':\n      case 'V':\n        lastY = s[1] + (isRelative ? lastY : 0);\n        return;\n\n      case 'z':\n      case 'Z':\n        // That make sence for multiple contours\n        lastX = countourStartX;\n        lastY = countourStartY;\n        return;\n\n      default:\n        lastX = s[s.length - 2] + (isRelative ? lastX : 0);\n        lastY = s[s.length - 1] + (isRelative ? lastY : 0);\n    }\n  });\n\n  // Replace segments if iterator return results\n\n  if (!needReplace) { return this; }\n\n  newSegments = [];\n\n  for (i = 0; i < segments.length; i++) {\n    if (typeof replacements[i] !== 'undefined') {\n      for (j = 0; j < replacements[i].length; j++) {\n        newSegments.push(replacements[i][j]);\n      }\n    } else {\n      newSegments.push(segments[i]);\n    }\n  }\n\n  this.segments = newSegments;\n\n  return this;\n};\n\n\n// Converts segments from relative to absolute\n//\nSvgPath.prototype.abs = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameUC = name.toUpperCase(),\n        i;\n\n    // Skip absolute commands\n    if (name === nameUC) { return; }\n\n    s[0] = nameUC;\n\n    switch (name) {\n      case 'v':\n        // v has shifted coords parity\n        s[1] += y;\n        return;\n\n      case 'a':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] += x;\n        s[7] += y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] += i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts segments from absolute to relative\n//\nSvgPath.prototype.rel = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameLC = name.toLowerCase(),\n        i;\n\n    // Skip relative commands\n    if (name === nameLC) { return; }\n\n    // Don't touch the first M to avoid potential confusions.\n    if (index === 0 && name === 'M') { return; }\n\n    s[0] = nameLC;\n\n    switch (name) {\n      case 'V':\n        // V has shifted coords parity\n        s[1] -= y;\n        return;\n\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] -= x;\n        s[7] -= y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] -= i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts arcs to cubic bzier curves\n//\nSvgPath.prototype.unarc = function () {\n  this.iterate(function (s, index, x, y) {\n    var new_segments, nextX, nextY, result = [], name = s[0];\n\n    // Skip anything except arcs\n    if (name !== 'A' && name !== 'a') { return null; }\n\n    if (name === 'a') {\n      // convert relative arc coordinates to absolute\n      nextX = x + s[6];\n      nextY = y + s[7];\n    } else {\n      nextX = s[6];\n      nextY = s[7];\n    }\n\n    new_segments = a2c(x, y, nextX, nextY, s[4], s[5], s[1], s[2], s[3]);\n\n    // Degenerated arcs can be ignored by renderer, but should not be dropped\n    // to avoid collisions with `S A S` and so on. Replace with empty line.\n    if (new_segments.length === 0) {\n      return [ [ s[0] === 'a' ? 'l' : 'L', s[6], s[7] ] ];\n    }\n\n    new_segments.forEach(function (s) {\n      result.push([ 'C', s[2], s[3], s[4], s[5], s[6], s[7] ]);\n    });\n\n    return result;\n  });\n\n  return this;\n};\n\n\n// Converts smooth curves (with missed control point) to generic curves\n//\nSvgPath.prototype.unshort = function () {\n  var segments = this.segments;\n  var prevControlX, prevControlY, prevSegment;\n  var curControlX, curControlY;\n\n  // TODO: add lazy evaluation flag when relative commands supported\n\n  this.iterate(function (s, idx, x, y) {\n    var name = s[0], nameUC = name.toUpperCase(), isRelative;\n\n    // First command MUST be M|m, it's safe to skip.\n    // Protect from access to [-1] for sure.\n    if (!idx) { return; }\n\n    if (nameUC === 'T') { // quadratic curve\n      isRelative = (name === 't');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'Q') {\n        prevControlX = prevSegment[1] - x;\n        prevControlY = prevSegment[2] - y;\n      } else if (prevSegment[0] === 'q') {\n        prevControlX = prevSegment[1] - prevSegment[3];\n        prevControlY = prevSegment[2] - prevSegment[4];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'q' : 'Q',\n        curControlX, curControlY,\n        s[1], s[2]\n      ];\n\n    } else if (nameUC === 'S') { // cubic curve\n      isRelative = (name === 's');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'C') {\n        prevControlX = prevSegment[3] - x;\n        prevControlY = prevSegment[4] - y;\n      } else if (prevSegment[0] === 'c') {\n        prevControlX = prevSegment[3] - prevSegment[5];\n        prevControlY = prevSegment[4] - prevSegment[6];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'c' : 'C',\n        curControlX, curControlY,\n        s[1], s[2], s[3], s[4]\n      ];\n    }\n  });\n\n  return this;\n};\n\n\nmodule.exports = SvgPath;\n","export default \"/* Workspace wrapper: horizontal layout */\\r\\n.KabelWorkspaceWrapper {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #f0f0f0;\\r\\n    /* light gray background */\\r\\n    overflow: hidden;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n/* Toolbox panel (left) */\\r\\n.KabelToolbox {\\r\\n    width: 12%;\\r\\n    min-width: 150px;\\r\\n    height: 100%;\\r\\n    background: rgba(240, 240, 240, 0.95);\\r\\n    border-right: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    padding: 8px;\\r\\n    overflow-y: auto;\\r\\n}\\r\\n\\r\\n/* Context menu container */\\r\\n.KabelContextMenu {\\r\\n    position: absolute;\\r\\n    background: #1e1e2f;\\r\\n    color: #000000;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);\\r\\n    padding: 4px 0;\\r\\n    font-family: 'Segoe UI', sans-serif;\\r\\n    font-size: 14px;\\r\\n    min-width: 160px;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    overflow: visible;\\r\\n    height: auto;\\r\\n    transition: opacity 0.15s ease, transform 0.15s ease;\\r\\n    opacity: 0;\\r\\n    transform: scale(0.95);\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n}\\r\\n\\r\\n/* Show state */\\r\\n.KabelContextMenu.show {\\r\\n    opacity: 1;\\r\\n    transform: scale(1);\\r\\n}\\r\\n\\r\\n/* Individual option */\\r\\n.KabelContextOption {\\r\\n    padding: 8px 16px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s ease, color 0.15s ease;\\r\\n}\\r\\n.KabelContextOption:hover {\\r\\n    background: #b0adb0;\\r\\n    color: #fff;\\r\\n}\\r\\n.KabelContextOption.disabled {\\r\\n\\topacity: 0.35;\\r\\n\\tcursor: not-allowed;\\r\\n\\tcolor: #777; /* dim it so it's obviously off */\\r\\n\\tbackground: transparent;\\r\\n\\tpointer-events: none;\\r\\n}\\r\\n\\r\\n/* make sure hover never triggers visually */\\r\\n.KabelContextOption.disabled:hover {\\r\\n\\tbackground: transparent;\\r\\n\\tcolor: #777;\\r\\n}\\r\\n\\r\\n/* Optional: active click effect */\\r\\n.KabelContextOption:active {\\r\\n    background: #fff;\\r\\n    color: #000;\\r\\n}\\r\\n\\r\\n/* Scrollbar if too many options */\\r\\n.KabelContextMenu::-webkit-scrollbar {\\r\\n    width: 6px;\\r\\n}\\r\\n\\r\\n.KabelContextMenu::-webkit-scrollbar-thumb {\\r\\n    background: rgba(255, 255, 255, 0.2);\\r\\n    border-radius: 3px;\\r\\n}\\r\\n\\r\\n/* Category buttons */\\r\\n\\r\\n.KabelCategoryRow {\\r\\n    background: #fff;\\r\\n    border: 1px solid #ccc;\\r\\n    padding: 4px 8px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    height: 5%;\\r\\n    padding: 6px;\\r\\n    cursor: pointer;\\r\\n    text-align: left;\\r\\n    transition: background 0.2s, color 0.2s;\\r\\n}\\r\\n\\r\\n.KabelToolbox button:hover {\\r\\n    background: #e6e6e6;\\r\\n    color: #333;\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlight {\\r\\n    stroke: yellow !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 255, 0, 0.9));\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlightWrong {\\r\\n    stroke: rgb(255, 0, 0) !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 0, 0, 0.9));\\r\\n}\\r\\n\\r\\n/* Container */\\r\\n.KabelDropdownMenu {\\r\\n    position: absolute;\\r\\n    display: none;\\r\\n    background: #1e1e1e;\\r\\n    color: #f0f0f0;\\r\\n    font-family: sans-serif;\\r\\n    font-size: 14px;\\r\\n    border: 1px solid #333;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);\\r\\n    padding: 4px 0;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    animation: fadeIn 0.15s ease-out;\\r\\n}\\r\\n\\r\\n/* Dropdown items */\\r\\n.KabelDropdownItem {\\r\\n    padding: 6px 12px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s;\\r\\n}\\r\\n\\r\\n/* Hover + focus states */\\r\\n.KabelDropdownItem:hover,\\r\\n.KabelDropdownItem:focus {\\r\\n    background: #2d2d2d;\\r\\n}\\r\\n\\r\\n/* Active (clicked) state */\\r\\n.KabelDropdownItem:active {\\r\\n    background: #3a3a3a;\\r\\n}\\r\\n\\r\\n/* Optional: highlight selected value */\\r\\n.KabelDropdownItem.selected {\\r\\n    background: #444;\\r\\n    font-weight: 600;\\r\\n}\\r\\n\\r\\n/* Smooth open effect */\\r\\n@keyframes fadeIn {\\r\\n    from {\\r\\n        opacity: 0;\\r\\n        transform: translateY(-3px);\\r\\n    }\\r\\n\\r\\n    to {\\r\\n        opacity: 1;\\r\\n        transform: translateY(0);\\r\\n    }\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\n/* Flyout panel (right) */\\r\\n.KabelFlyout {\\r\\n    width: 20%;\\r\\n    height: 100%;\\r\\n    background: rgba(255, 255, 255, 0.95);\\r\\n    border-left: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    overflow-y: auto;\\r\\n    position: relative;\\r\\n    /* for absolute positioning of nodes inside */\\r\\n    display: none;\\r\\n    /* hidden by default */\\r\\n    padding: 8px;\\r\\n}\\r\\n\\r\\n/* Flyout nodes */\\r\\n.KabelFlyoutNode {\\r\\n    padding: 6px 10px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    cursor: pointer;\\r\\n    user-select: none;\\r\\n    transition: background 0.2s;\\r\\n}\\r\\n\\r\\n.KabelFlyoutNode:hover {\\r\\n    background: #e0e0e0;\\r\\n}\\r\\n\\r\\n/* SVG workspace area */\\r\\n.KabelWorkspaceWrapper svg {\\r\\n    flex: 1;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #fff;\\r\\n    /* white canvas background */\\r\\n    display: block;\\r\\n}\";","import { Element } from '@svgdotjs/svg.js';\r\nimport Connection, { Connectable } from '../src/connection';\r\nimport eventer, { EventArgs } from '../util/eventer';\r\nimport userState from '../util/user-state';\r\nimport Field, { AnyField } from '../src/field';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport waitFrames from '../util/wait-anim-frames';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\ninterface ConnectionV {\r\n    conn: Connection,\r\n    el: Element,\r\n    args?: EventArgs\r\n}\r\ninterface ConnectionState {\r\n    one: null | ConnectionV,\r\n    two: null | ConnectionV\r\n}\r\n\r\n\r\nconst cState: ConnectionState = {\r\n    one: null,\r\n    two: null\r\n}\r\n\r\n\r\nfunction initConnector(el: Element, args?: EventArgs) {\r\n    args = args as {\r\n        connection: Connection,\r\n        node?: NodeSvg,\r\n        field?: AnyField\r\n    };\r\n    if (args.field && !args.field?.canEditConnector) { // If editing isnt allowed, close the event early.\r\n        return; \r\n    }\r\n    el.on('click', () => {\r\n        const isPrev = args.connection.isPrevious;\r\n\r\n        // First click  must NOT be previous\r\n        if (!cState.one) {\r\n            if (isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            cState.one = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n            userState.setState('connecting')\r\n            return;\r\n        }\r\n\r\n        // Second click  must be previous\r\n        if (!cState.two && (args?.node !== cState.one?.args?.node)) {\r\n            if (!isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            if (cState.one.conn === args.connection) return; // ignore clicking the same again\r\n            cState.two = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n        }\r\n\r\n        // Both are filled  attempt to connect\r\n        if (cState.one && cState.two) {\r\n            if (cState.two.args?.node == cState.one.args?.node || cState.two.args?.node === cState.one?.args?.field?.node) {\r\n                cState.one.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                cState.two.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    if (!cState) return;\r\n                    if (!cState.one || !cState.two) return;\r\n                    cState.one.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.two.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.one = null;\r\n                    cState.two = null;\r\n                })\r\n                userState.removeState('connecting');\r\n                return;\r\n            }\r\n            const { conn: connA } = cState.one;\r\n            const { conn: connB } = cState.two;\r\n\r\n            connA.disconnectTo();\r\n            connB.disconnectFrom();\r\n\r\n            connA.to = cState.two.args?.node;\r\n            connB.from = cState.one.args?.node || cState.one.args?.field;\r\n\r\n            waitFrames(2, () => {\r\n                if (cState.one?.args?.node) {\r\n                    cState.one.args.node.workspace?.redraw();\r\n                    (cState.one.args.node.workspace as WorkspaceSvg).emitChange();\r\n                } else if (cState.two?.args?.node) {\r\n                    cState.two.args.node.workspace?.redraw();\r\n                    (cState!.two!.args.node!.workspace as WorkspaceSvg).emitChange();\r\n\r\n                }\r\n                \r\n                \r\n                cState.one = null;\r\n                cState.two = null;\r\n                userState.removeState('connecting');\r\n\r\n            });\r\n        }\r\n    });\r\n    return () => {\r\n        el.off('click'); // removes the click listener\r\n    };\r\n\r\n}\r\n\r\neventer.registerEvent('k_connectbubble', initConnector);\r\n","import { parseColor } from \"../util/parse-color\";\r\nimport { TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { Color } from \"./visual-types\";\r\n\r\n/**\r\n * Represents a category in the toolbox, containing nodes and a label.\r\n */\r\nclass Category {\r\n\t/** Display label for the category */\r\n\tlabel: string;\r\n\t/** Category color */\r\n\tcolor: Color;\r\n\t/** Nodes contained in this category */\r\n\tcontents: TblxNodeStruct[];\r\n\t/** HTML button element representing this category row */\r\n\t_rowDiv!: HTMLButtonElement;\r\n\t/** Reference to parent toolbox */\r\n\t_toolbox: Toolbox;\r\n\r\n\t/**\r\n\t * @param toolbox The parent Toolbox instance\r\n\t * @param cData Category data (label, color, nodes)\r\n\t */\r\n\tconstructor(toolbox: Toolbox, cData: TblxCategoryStruct) {\r\n\t\tthis.label = cData.name;\r\n\t\tthis.color = cData.color;\r\n\t\tthis.contents = cData.contents;\r\n\t\tthis._toolbox = toolbox;\r\n\t\tthis._makeDiv();\r\n\t}\r\n\r\n\t/** Creates the category button in the UI and attaches click events */\r\n\t_makeDiv() {\r\n\t\tconst btn = document.createElement(\"button\");\r\n\t\tbtn.textContent = this.label;\r\n\t\tbtn.className = \"KabelCategoryRow\";\r\n\t\tbtn.style.backgroundColor = parseColor(this.color);\r\n\t\tbtn.style.color = parseColor('#ffffff');\r\n\t\tthis._rowDiv = btn;\r\n\r\n\t\tbtn.addEventListener(\"click\", e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis._toolbox._flyout.clear();\r\n\t\t\tthis._toolbox._flyout.fill(this.contents);\r\n\t\t\tthis._toolbox._flyout.show();\r\n\t\t});\r\n\r\n\t\tthis._toolbox.container.appendChild(btn);\r\n\t}\r\n\r\n\t/**\r\n\t * Refreshes the category UI with new data\r\n\t * @param cData Partial data to update (name, color, contents)\r\n\t */\r\n\trefresh(cData: Partial<TblxCategoryStruct>) {\r\n\t\tif (cData.name !== undefined) {\r\n\t\t\tthis.label = cData.name;\r\n\t\t\tthis._rowDiv.textContent = this.label;\r\n\t\t}\r\n\t\tif (cData.color !== undefined) {\r\n\t\t\tthis.color = cData.color;\r\n\t\t\tthis._rowDiv.style.backgroundColor = parseColor(this.color);\r\n\t\t}\r\n\t\tif (cData.contents !== undefined) {\r\n\t\t\tthis.contents = cData.contents;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Remove category row from the toolbox */\r\n\tdestroy() {\r\n\t\tthis._rowDiv.remove();\r\n\t\tthis._toolbox = null as unknown as Toolbox;\r\n\t}\r\n\r\n\t/** Hide this category from the UI */\r\n\thide() {\r\n\t\tthis._rowDiv.style.display = \"none\";\r\n\t}\r\n\r\n\t/** Show this category in the UI */\r\n\tshow() {\r\n\t\tthis._rowDiv.style.display = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Enable or disable interaction with this category\r\n\t * @param disabled True to disable, false to enable\r\n\t */\r\n\tsetDisabled(disabled: boolean) {\r\n\t\tthis._rowDiv.disabled = disabled;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a plain object representation of this category\r\n\t * @returns JSON-compatible category object\r\n\t */\r\n\ttoJSON(): TblxCategoryStruct {\r\n\t\treturn {\r\n\t\t\tname: this.label,\r\n\t\t\tcolor: this.color,\r\n\t\t\tcontents: this.contents,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default Category;\r\n","import NodeSvg from '../src/nodesvg';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport { Element } from '@svgdotjs/svg.js';\r\nimport Renderer, { DrawState } from './renderer';\r\nimport RendererConstants from './constants';\r\nimport { parseColor } from '../util/parse-color';\r\nimport {Color} from '../src/visual-types';\r\n\r\nexport class RepresenterNode {\r\n\tnode: NodeSvg;\r\n\tstate: DrawState;\r\n    renderer: Renderer;\r\n\tconstructor(node: NodeSvg, svgState: DrawState, renderer: Renderer) {\r\n        this.renderer = renderer;\r\n\t\tthis.node = node;\r\n\t\tthis.state = svgState;\r\n\r\n\t\t// Attach this wrapper to the node for external access\r\n\t\tnode.svg = this;\r\n\t}\r\n    getConstant(name: keyof RendererConstants) {\r\n        return this.renderer._constants[name];\r\n    }\r\n\t/** Move node visually without changing its relativeCoords */\r\n\tmoveTo(x: number, y: number) {\r\n\t\tthis.state.group!.move(x, y);\r\n\t}\r\n\r\n\t/** Scale node visually */\r\n\tsetScale(scale: number) {\r\n\t\tthis.state.group!.scale(scale);\r\n\t}\r\n\r\n\t/** Apply raw transform string */\r\n\tapplyTransform(transform: string) {\r\n\t\tthis.state.group!.attr({ transform });\r\n\t}\r\n\r\n\t/** Access the raw SVG group */\r\n\tgetRaw() {\r\n\t\treturn this.state.group;\r\n\t}\r\n\r\n\t/** Optional: highlight node */\r\n\thighlight(color = '#ff0') {\r\n        if (!color || color.length == 0 || typeof color !== 'string') {\r\n            this.highlight(parseColor(this.getConstant('NODE_OUTLINE_COLOR') as Color) as string);\r\n            return;\r\n        }\r\n\t\tthis.state.bg!.stroke({ color, width: 2 });\r\n\t}\r\n}\r\n","import Field, { ConnectableField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\n/**\r\n * A node or field that can participate in a connection.\r\n */\r\nexport type Connectable = NodeSvg | null | Field;\r\n\r\n/**\r\n * Represents a connection between two connectable objects.\r\n */\r\nclass Connection {\r\n\t/** The source of the connection */\r\n\tfrom: Connectable;\r\n\t/** The target of the connection */\r\n\tto: Connectable;\r\n\t/** Whether this connection represents a previous connection (affects rendering/logic) */\r\n\tisPrevious: boolean;\r\n\r\n\t/**\r\n\t * Creates a new Connection.\r\n\t * @param from - The source NodeSvg or Field\r\n\t * @param to - The target NodeSvg or Field\r\n\t * @param isPrevious - True if this connection is a previous connection\r\n\t */\r\n\tconstructor(from: Connectable, to: Connectable, isPrevious: boolean = false) {\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\t\tthis.isPrevious = isPrevious;\r\n\t}\r\n\r\n\t/** Returns the target of the connection */\r\n\tgetTo(): Connectable {\r\n\t\treturn this.to;\r\n\t}\r\n\r\n\t/** Returns the source of the connection */\r\n\tgetFrom(): Connectable {\r\n\t\treturn this.from;\r\n\t}\r\n\r\n\t/**\r\n\t * Disconnects this connection from its target.\r\n\t * Safely handles NodeSvg chains and ConnectableFields.\r\n\t */\r\n\tdisconnectTo() {\r\n\t\tif (!this.to) return;\r\n\r\n\t\tif (this.to instanceof NodeSvg && this.to.previousConnection) {\r\n\t\t\tconst prevConn = this.to.previousConnection;\r\n\t\t\tconst prevFrom = prevConn.from;\r\n\r\n\t\t\t// Disconnect NodeSvg chain\r\n\t\t\tif (prevFrom instanceof NodeSvg && prevFrom.nextConnection?.to) {\r\n\t\t\t\tprevFrom.nextConnection.to = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Disconnect Field chain\r\n\t\t\tif (prevFrom instanceof Field && prevFrom.hasConnectable?.()) {\r\n\t\t\t\t(prevFrom as ConnectableField).disconnect();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.to = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Disconnects this connection from its source.\r\n\t * Safely handles NodeSvg chains and ConnectableFields.\r\n\t */\r\n\tdisconnectFrom() {\r\n\t\tif (!this.from) return;\r\n\r\n\t\tif (this.from instanceof NodeSvg && this.from.nextConnection) {\r\n\t\t\tconst next = this.from.nextConnection;\r\n\r\n\t\t\tif (next.to instanceof NodeSvg && next.to.previousConnection?.from) {\r\n\t\t\t\tnext.to.previousConnection.from = null;\r\n\t\t\t} else if (next.to instanceof Field && next.to.hasConnectable()) {\r\n\t\t\t\t(next.to as ConnectableField).disconnect();\r\n\t\t\t}\r\n\r\n\t\t\tnext.to = null;\r\n\t\t} else if (this.from instanceof Field && this.from.hasConnectable()) {\r\n\t\t\t(this.from as ConnectableField).disconnect();\r\n\t\t}\r\n\r\n\t\tthis.from = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the target of this connection (used during deserialization)\r\n\t * @param target - New connection target\r\n\t */\r\n\tsetTo(target: Connectable) {\r\n\t\tthis.to = target;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the source of this connection (used during deserialization)\r\n\t * @param source - New connection source\r\n\t */\r\n\tsetFrom(source: Connectable) {\r\n\t\tthis.from = source;\r\n\t}\r\n\r\n\t/** Completely isolates this connection, clearing both ends */\r\n\tisolate() {\r\n\t\tthis.from = null as any;\r\n\t\tthis.to = null as any;\r\n\t}\r\n}\r\n\r\nexport default Connection;\r\n","import { Color } from \"../../src/visual-types\";\r\nimport RendererConstants from \"../constants\";\r\n\r\n// Define the new Dogear shape\r\ntype DogearShape = {\r\n    PathMain: string;\r\n    Width: number;\r\n    Height: number;\r\n};\r\n\r\n// Extend the original SHAPES type\r\ntype ApolloShapes = RendererConstants['SHAPES'] & {\r\n    Dogear?: DogearShape;\r\n};\r\n\r\nclass ApolloConstants extends RendererConstants {\r\n    SHAPES: ApolloShapes = {};\r\n    CONNECTOR_COLOR: Color = '#9912e8ff'\r\n    FIELD_RAW_COLOR: Color = '#343745ff';\r\n    FIELD_RAW_TEXT_COLOR: Color = '#cfd4e4ff';\r\n    FIELD_RAW_OUTLINE_COLOR: Color = '#202128ff';\r\n    constructor(overrides: Partial<ApolloConstants>) {\r\n        super(overrides);\r\n        this.CONNECTOR_LINE_WIDTH = 2.5;\r\n        this.CORNER_RADIUS = 10;\r\n        this.FOOTER_HEIGHT = 25;\r\n        this.CONNECTOR_LINE_WIDTH = 7;\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.SHAPES.Dogear = {\r\n            PathMain: `M -1 1 Q -1 21 0 30 L 26 0 Q 2 -1 0 0 Z`,\r\n            Width: 26,\r\n            Height: 30\r\n        };\r\n    }\r\n}\r\n\r\nexport default ApolloConstants;\r\n","import { Element, Rect, Text } from \"@svgdotjs/svg.js\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\nimport { Renderer } from \"../src\";\r\n\r\nfunction initInputBox(element: Element, args: Record<string, any>) {\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = args.field.getDisplayValue?.() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length;\r\n    const txt: Text = args.text;\r\n    const rect: Rect = element as Rect;\r\n    const renderer = args.renderer as Renderer;\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n    let caretLine: Rect | null = null;\r\n    let selectionRect: Rect | null = null;\r\n    // @ts-ignore\r\n    txt!.style('user-select', 'none');\r\n    // @ts-ignore\r\n    rect!.style('user-select', 'none');\r\n\r\n    // Helper: measure width of text using renderer or fallback\r\n    function measureTextWidth(text: string) {\r\n\r\n        if (renderer.measureTextWidth) return renderer.measureTextWidth(text);\r\n        return text.length * 8; // rough fallback\r\n    }\r\n\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    function updateText() {\r\n        // redraw main text\r\n        txt.text(buffer);\r\n\r\n        const { start, end } = getSelectionRange();\r\n        const { width: totalWidth } = renderer.measureRawField(buffer);\r\n        const { height: rectHeight } = rect.bbox(); // actual rect height\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (rectHeight - textBBox.height) / 2; // center vertically\r\n\r\n        // --- selection highlight ---\r\n        if (hasSelection()) {\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n            const highlightX = args.startX + PADDING_X + measureTextWidth(textBeforeStart);\r\n            const highlightWidth = Math.max(measureTextWidth(textBeforeEnd) - measureTextWidth(textBeforeStart), 1);\r\n            const highlightY = offsetY; // use offsetY for vertical alignment\r\n\r\n            if (!selectionRect) {\r\n                // @ts-ignore\r\n                selectionRect = rect.parent()!.rect(highlightWidth, textBBox.height)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                selectionRect.size(highlightWidth, textBBox.height);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n        // --- caret ---\r\n        if (editing) {\r\n            const zoom = renderer.getWs().getZoom(); // workspace zoom\r\n            const caretX = (args.startX + PADDING_X + measureTextWidth(buffer.slice(0, cursorPos))); // scale pos\r\n            const caretH = textBBox.height;\r\n            // @ts-ignore\r\n            if (!caretLine) caretLine = rect.parent()!.rect(1, caretH).fill(renderer.constants.FIELD_RAW_TEXT_COLOR);\r\n            caretLine!.size(1, caretH).move(caretX, offsetY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n        // --- background rect ---\r\n        rect.size(Math.max(16, totalWidth + PADDING_X * 2), Math.max(rectHeight, textBBox.height + PADDING_Y * 2));\r\n        txt.move(args.startX + PADDING_X, offsetY);\r\n    }\r\n\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(); return; }\r\n        if (e.key === \"Enter\") { e.preventDefault(); stopEditing(); return; }\r\n\r\n        if (e.key === \"Backspace\") {\r\n            if (!deleteSelection() && cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            if (!deleteSelection() && cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        } else if (e.key === \"ArrowLeft\") {\r\n            if (e.shiftKey) cursorPos = Math.max(0, cursorPos - 1);\r\n            else { cursorPos = Math.max(0, cursorPos - 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            if (e.shiftKey) cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            else { cursorPos = Math.min(buffer.length, cursorPos + 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"Home\") {\r\n            if (!e.shiftKey) anchorPos = 0;\r\n            cursorPos = 0;\r\n        } else if (e.key === \"End\") {\r\n            if (!e.shiftKey) anchorPos = buffer.length;\r\n            cursorPos = buffer.length;\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        } else return;\r\n\r\n        e.preventDefault();\r\n        updateText();\r\n        args.field.setValue(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const target = ev.target as Node;\r\n        if (target !== rect.node && target !== txt.node) stopEditing();\r\n    }\r\n\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = args.field.getValue?.() ?? \"\";\r\n        cursorPos = buffer.length;\r\n        anchorPos = buffer.length;\r\n\r\n        userState.setState('typing');\r\n\r\n        if (ev) {\r\n            const rectBox = rect.node.getBoundingClientRect();\r\n            const zoom = renderer.getWs().getZoom(); // workspace zoom\r\n            const clickX = (ev.clientX - rectBox.left - PADDING_X) / zoom;\r\n\r\n            let cumulativeWidth = 0;\r\n            cursorPos = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                const charWidth = measureTextWidth(buffer[i]); // scale widths\r\n                if (cumulativeWidth + charWidth / 2 >= clickX) break;\r\n                cumulativeWidth += charWidth;\r\n                cursorPos = i + 1;\r\n            }\r\n        }\r\n\r\n        anchorPos = cursorPos;\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown);\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing() {\r\n        editing = false;\r\n        userState.removeState('typing');\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n        args.field.setValue(buffer);\r\n        updateText();\r\n        renderer.getWs().redraw();\r\n        renderer.getWs().emitChange();\r\n    }\r\n\r\n    rect.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n    txt.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", startEditing as EventListener);\r\n        txt.off(\"mousedown\", startEditing as EventListener);\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_inputbox\", initInputBox as EventSetupFn);\r\n","import NodeSvg from '../src/nodesvg';\r\nimport Renderer, { DrawState } from './renderer';\r\nimport { RepresenterNode } from './representer-node';\r\n\r\nexport default class Representer {\r\n\tnodes: Map<string, RepresenterNode> = new Map();\r\n\r\n\t/** Build a representer node for a drawn node */\r\n\tbuild(node: NodeSvg, renderer: Renderer, state: DrawState) {\r\n\t\tif (!node) return;\r\n\t\tconst repNode = new RepresenterNode(node, state, renderer);\r\n\t\tthis.nodes.set(node.id, repNode);\r\n\t\treturn repNode;\r\n\t}\r\n\r\n\t/** Get a representer node by node id */\r\n\tget(nodeId: string): RepresenterNode | undefined {\r\n\t\treturn this.nodes.get(nodeId);\r\n\t}\r\n\r\n\t/** Remove a node from the representer */\r\n\tremove(nodeId: string) {\r\n\t\tthis.nodes.delete(nodeId);\r\n\t}\r\n}\r\n","import WorkspaceController from \"../controllers/base\";\r\nimport unescapeAttr from \"../util/unescape-html\";\r\nimport CommentModel from \"./comment\";\r\nimport Coordinates from \"./coordinates\";\r\nimport ContextOptsRegistry from \"./ctx-menu-registry\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport Widget from \"./widget\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n/**\r\n * A list of types that a context menu item can show for.\r\n */\r\nexport type Showable = 'node' | 'ws' | 'html' | 'comment' | 'any';\r\n\r\n/**\r\n * Describes a context menu option.\r\n */\r\nexport interface ContextMenuOpts {\r\n    /** Function executed when the option is clicked */\r\n    click: (target: NodeSvg | WorkspaceSvg | CommentModel | HTMLElement) => void;\r\n    /** Optional hover start callback */\r\n    onHoverStart?: () => void;\r\n    /** Optional hover end callback */\r\n    onHoverEnd?: () => void;\r\n    /** Specifies which target types this option should appear for */\r\n    showFor?: Showable | Showable[];\r\n    /** Specifies extra logic for drawing */\r\n    onDraw?: (optEl: Node, ws: WorkspaceSvg, opt: ContextMenuOpts) => void;\r\n    /** Text label for the menu option */\r\n    label: string;\r\n    /** Unique ID for the option */\r\n    id: string;\r\n}\r\n\r\n/**\r\n * HTML context menu rendered on workspace right-click.\r\n */\r\nclass ContextMenuHTML {\r\n    /**\r\n     * The workspace.\r\n     */\r\n    workspace: WorkspaceSvg;\r\n    /**\r\n     * The workspace's controller\r\n     */\r\n    controller: WorkspaceController;\r\n    /**\r\n     * The widget in the workspace to display the menu on.\r\n     */\r\n    widget: Widget;\r\n    /**\r\n     * Options for the context menu.\r\n     */\r\n    options: ContextMenuOpts[];\r\n\r\n    /**\r\n     * Create a new context menu for a workspace.\r\n     * @param workspace - Workspace to attach the context menu to\r\n     */\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n        this.controller = this.workspace.controller;\r\n        this.widget = new Widget(this.workspace, {\r\n            coords: new Coordinates(0, 0),\r\n            name: 'k_contextmenu',\r\n            className: 'KabelContextMenu'\r\n        });\r\n\r\n        // Override show/hide methods to manipulate CSS\r\n        this.widget.show = () => {\r\n            this.widget.container.classList.add('show');\r\n            this.widget.container.style.display = 'flex';\r\n            this.widget.visible = true;\r\n        };\r\n        this.widget.hide = () => {\r\n            this.widget.container.classList.remove('show');\r\n            this.widget.container.style.display = 'none';\r\n            this.widget.visible = false;\r\n        };\r\n        this.widget.container.style.removeProperty('height');\r\n        this.widget.container.style.removeProperty('width');\r\n\r\n        this.widget.hide();\r\n        this.options = ContextOptsRegistry;\r\n        this.initListeners();\r\n    }\r\n\r\n    /**\r\n     * Renders context menu options for a given target.\r\n     * @param target - The object the context menu is for\r\n     */\r\n    renderOptions(target: NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null) {\r\n        this.widget.container.innerHTML = '';\r\n\r\n        const filteredOptions = this.options.filter(opt => {\r\n            if (!target) return false;\r\n            const showFor = Array.isArray(opt.showFor) ? opt.showFor : [opt.showFor];\r\n            if (showFor.includes('any')) return true;\r\n            if (target instanceof NodeSvg && showFor.includes('node')) return true;\r\n            if (target instanceof WorkspaceSvg && showFor.includes('ws')) return true;\r\n            if (target instanceof HTMLElement && !(target instanceof SVGSVGElement) && showFor.includes('html')) return true;\r\n            if (target instanceof CommentModel && showFor.includes('comment')) return true;\r\n            return false;\r\n        });\r\n\r\n        filteredOptions.forEach((opt, i) => {\r\n            const el = document.createElement('div');\r\n            el.className = 'KabelContextOption';\r\n            el.textContent = opt.label || 'Option ' + i;\r\n\r\n            el.addEventListener('click', () => {\r\n                if (target) opt.click(target);\r\n                this.hide();\r\n            });\r\n            if (opt.onDraw) opt.onDraw(el, this.workspace, opt);\r\n            if (opt.onHoverStart) el.addEventListener('mouseenter', () => opt.onHoverStart?.());\r\n            if (opt.onHoverEnd) el.addEventListener('mouseleave', () => opt.onHoverEnd?.());\r\n\r\n            this.widget.container.appendChild(el);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initializes event listeners for showing/hiding the menu.\r\n     */\r\n    initListeners() {\r\n        if (this.controller) {\r\n            this.controller.addMoveListener(() => {\r\n                if (this.widget.visible) this.hide();\r\n            })\r\n        }\r\n        this.workspace.svg.node.addEventListener('contextmenu', e => {\r\n            e.preventDefault();\r\n            const mouseX = e.clientX;\r\n            const mouseY = e.clientY;\r\n\r\n            this.widget.setCoords(new Coordinates(mouseX, mouseY));\r\n            this.renderOptions(this.target);\r\n            this.widget.show();\r\n        });\r\n\r\n        document.addEventListener('mousedown', e => {\r\n            if (!this.widget.container.contains(e.target as Node)) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    /** Hides the context menu */\r\n    hide() {\r\n        this.widget.hide();\r\n    }\r\n\r\n    /** Returns the current mouse position in workspace coordinates */\r\n    get mousePos(): { x: number, y: number } {\r\n        return this.controller.mousePos;\r\n    }\r\n\r\n    /**\r\n     * Returns the target element under the mouse for context menu.\r\n     */\r\n    get target(): NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null {\r\n        let el = document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n        if (!el) return null;\r\n        if ((el as unknown as SVGSVGElement) === this.workspace.svg.node) return this.workspace;\r\n\r\n        if (el && el.classList?.contains?.('WorkspaceBgPattern')) return this.workspace;\r\n\r\n        while (el && el !== document.body) {\r\n            if (el.tagName.toLowerCase() === 'g' && el.hasAttribute('data-node-id')) {\r\n                const nodeId = unescapeAttr(el.getAttribute('data-node-id') as string);\r\n                const node = this.workspace.getNode(nodeId);\r\n                if (node) return node;\r\n            }\r\n            if (el.tagName.toLowerCase() === 'g' && el.hasAttribute('comment-data')) {\r\n                const dta = JSON.parse(el.getAttribute('comment-data') as string);\r\n                if (!dta.id && !dta.isws) continue;\r\n                if (dta.isws) {\r\n                    for (let comment of this.workspace._commentDB) {\r\n                        if (comment.id === dta.id) return comment;\r\n                    }\r\n                } else {\r\n                    for (let [_, node] of this.workspace._nodeDB) {\r\n                        if (node.comment && node.comment.id == dta.id) return node.comment;\r\n                    }\r\n                }\r\n            }\r\n            el = el.parentElement;\r\n        }\r\n\r\n        return document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n    }\r\n}\r\n\r\nexport default ContextMenuHTML;\r\n","import type { WSTheme } from '../src/workspace-svg';\r\n\r\nconst KabelDarkTheme: WSTheme = {\r\n\tUIStyles: {\r\n\t\tworkspaceBGColor: '#121412ff',\r\n\t\ttoolboxCategoriesBG: {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tleft: '0',\r\n\t\t\ttop: '0',\r\n\t\t\twidth: '20%',\r\n\t\t\theight: '100%',\r\n\t\t\tbackground: '#1b1b1b',\r\n\t\t\tcolor: '#e0e0e0',\r\n\t\t\toverflowY: 'auto',\r\n\t\t\tborder: 'none',\r\n\t\t\toutline: 'none',\r\n\t\t},\r\n\t\ttoolboxFlyoutBG: {\r\n\t\t\tbackground: '#1e1e1e',\r\n\t\t\tcolor: '#e0e0e0',\r\n\t\t\toverflowY: 'auto',\r\n\t\t\tpadding: '4px', \r\n\t\t\tborderRadius: '4px',\r\n\t\t\tboxShadow: '0 2px 6px rgba(0,0,0,0.5)',\r\n\t\t\tborder: 'none',\r\n\t\t\toutline: 'none',\r\n\t\t},\r\n\t},\r\n};\r\n\r\nexport default KabelDarkTheme;\r\n","/*!\n* @svgdotjs/svg.js - A lightweight library for manipulating and animating SVG.\n* @version 3.2.4\n* https://svgjs.dev/\n*\n* @copyright Wout Fierens <wout@mick-wout.com>\n* @license MIT\n*\n* BUILT: Thu Jun 27 2024 12:00:16 GMT+0200 (Central European Summer Time)\n*/;\n'use strict';\n\nconst methods$1 = {};\nconst names = [];\nfunction registerMethods(name, m) {\n  if (Array.isArray(name)) {\n    for (const _name of name) {\n      registerMethods(_name, m);\n    }\n    return;\n  }\n  if (typeof name === 'object') {\n    for (const _name in name) {\n      registerMethods(_name, name[_name]);\n    }\n    return;\n  }\n  addMethodNames(Object.getOwnPropertyNames(m));\n  methods$1[name] = Object.assign(methods$1[name] || {}, m);\n}\nfunction getMethodsFor(name) {\n  return methods$1[name] || {};\n}\nfunction getMethodNames() {\n  return [...new Set(names)];\n}\nfunction addMethodNames(_names) {\n  names.push(..._names);\n}\n\n// Map function\nfunction map(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    result.push(block(array[i]));\n  }\n  return result;\n}\n\n// Filter function\nfunction filter(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    if (block(array[i])) {\n      result.push(array[i]);\n    }\n  }\n  return result;\n}\n\n// Degrees to radians\nfunction radians(d) {\n  return d % 360 * Math.PI / 180;\n}\n\n// Radians to degrees\nfunction degrees(r) {\n  return r * 180 / Math.PI % 360;\n}\n\n// Convert camel cased string to dash separated\nfunction unCamelCase(s) {\n  return s.replace(/([A-Z])/g, function (m, g) {\n    return '-' + g.toLowerCase();\n  });\n}\n\n// Capitalize first letter of a string\nfunction capitalize(s) {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\n// Calculate proportional width and height values when necessary\nfunction proportionalSize(element, width, height, box) {\n  if (width == null || height == null) {\n    box = box || element.bbox();\n    if (width == null) {\n      width = box.width / box.height * height;\n    } else if (height == null) {\n      height = box.height / box.width * width;\n    }\n  }\n  return {\n    width: width,\n    height: height\n  };\n}\n\n/**\n * This function adds support for string origins.\n * It searches for an origin in o.origin o.ox and o.originX.\n * This way, origin: {x: 'center', y: 50} can be passed as well as ox: 'center', oy: 50\n **/\nfunction getOrigin(o, element) {\n  const origin = o.origin;\n  // First check if origin is in ox or originX\n  let ox = o.ox != null ? o.ox : o.originX != null ? o.originX : 'center';\n  let oy = o.oy != null ? o.oy : o.originY != null ? o.originY : 'center';\n\n  // Then check if origin was used and overwrite in that case\n  if (origin != null) {\n    [ox, oy] = Array.isArray(origin) ? origin : typeof origin === 'object' ? [origin.x, origin.y] : [origin, origin];\n  }\n\n  // Make sure to only call bbox when actually needed\n  const condX = typeof ox === 'string';\n  const condY = typeof oy === 'string';\n  if (condX || condY) {\n    const {\n      height,\n      width,\n      x,\n      y\n    } = element.bbox();\n\n    // And only overwrite if string was passed for this specific axis\n    if (condX) {\n      ox = ox.includes('left') ? x : ox.includes('right') ? x + width : x + width / 2;\n    }\n    if (condY) {\n      oy = oy.includes('top') ? y : oy.includes('bottom') ? y + height : y + height / 2;\n    }\n  }\n\n  // Return the origin as it is if it wasn't a string\n  return [ox, oy];\n}\nconst descriptiveElements = new Set(['desc', 'metadata', 'title']);\nconst isDescriptive = element => descriptiveElements.has(element.nodeName);\nconst writeDataToDom = (element, data, defaults = {}) => {\n  const cloned = {\n    ...data\n  };\n  for (const key in cloned) {\n    if (cloned[key].valueOf() === defaults[key]) {\n      delete cloned[key];\n    }\n  }\n  if (Object.keys(cloned).length) {\n    element.node.setAttribute('data-svgjs', JSON.stringify(cloned)); // see #428\n  } else {\n    element.node.removeAttribute('data-svgjs');\n    element.node.removeAttribute('svgjs:data');\n  }\n};\n\nvar utils = {\n  __proto__: null,\n  capitalize: capitalize,\n  degrees: degrees,\n  filter: filter,\n  getOrigin: getOrigin,\n  isDescriptive: isDescriptive,\n  map: map,\n  proportionalSize: proportionalSize,\n  radians: radians,\n  unCamelCase: unCamelCase,\n  writeDataToDom: writeDataToDom\n};\n\n// Default namespaces\nconst svg = 'http://www.w3.org/2000/svg';\nconst html = 'http://www.w3.org/1999/xhtml';\nconst xmlns = 'http://www.w3.org/2000/xmlns/';\nconst xlink = 'http://www.w3.org/1999/xlink';\n\nvar namespaces = {\n  __proto__: null,\n  html: html,\n  svg: svg,\n  xlink: xlink,\n  xmlns: xmlns\n};\n\nconst globals = {\n  window: typeof window === 'undefined' ? null : window,\n  document: typeof document === 'undefined' ? null : document\n};\nfunction registerWindow(win = null, doc = null) {\n  globals.window = win;\n  globals.document = doc;\n}\nconst save = {};\nfunction saveWindow() {\n  save.window = globals.window;\n  save.document = globals.document;\n}\nfunction restoreWindow() {\n  globals.window = save.window;\n  globals.document = save.document;\n}\nfunction withWindow(win, fn) {\n  saveWindow();\n  registerWindow(win, win.document);\n  fn(win, win.document);\n  restoreWindow();\n}\nfunction getWindow() {\n  return globals.window;\n}\n\nclass Base {\n  // constructor (node/*, {extensions = []} */) {\n  //   // this.tags = []\n  //   //\n  //   // for (let extension of extensions) {\n  //   //   extension.setup.call(this, node)\n  //   //   this.tags.push(extension.name)\n  //   // }\n  // }\n}\n\nconst elements = {};\nconst root = '___SYMBOL___ROOT___';\n\n// Method for element creation\nfunction create(name, ns = svg) {\n  // create element\n  return globals.document.createElementNS(ns, name);\n}\nfunction makeInstance(element, isHTML = false) {\n  if (element instanceof Base) return element;\n  if (typeof element === 'object') {\n    return adopter(element);\n  }\n  if (element == null) {\n    return new elements[root]();\n  }\n  if (typeof element === 'string' && element.charAt(0) !== '<') {\n    return adopter(globals.document.querySelector(element));\n  }\n\n  // Make sure, that HTML elements are created with the correct namespace\n  const wrapper = isHTML ? globals.document.createElement('div') : create('svg');\n  wrapper.innerHTML = element;\n\n  // We can use firstChild here because we know,\n  // that the first char is < and thus an element\n  element = adopter(wrapper.firstChild);\n\n  // make sure, that element doesn't have its wrapper attached\n  wrapper.removeChild(wrapper.firstChild);\n  return element;\n}\nfunction nodeOrNew(name, node) {\n  return node && (node instanceof globals.window.Node || node.ownerDocument && node instanceof node.ownerDocument.defaultView.Node) ? node : create(name);\n}\n\n// Adopt existing svg elements\nfunction adopt(node) {\n  // check for presence of node\n  if (!node) return null;\n\n  // make sure a node isn't already adopted\n  if (node.instance instanceof Base) return node.instance;\n  if (node.nodeName === '#document-fragment') {\n    return new elements.Fragment(node);\n  }\n\n  // initialize variables\n  let className = capitalize(node.nodeName || 'Dom');\n\n  // Make sure that gradients are adopted correctly\n  if (className === 'LinearGradient' || className === 'RadialGradient') {\n    className = 'Gradient';\n\n    // Fallback to Dom if element is not known\n  } else if (!elements[className]) {\n    className = 'Dom';\n  }\n  return new elements[className](node);\n}\nlet adopter = adopt;\nfunction mockAdopt(mock = adopt) {\n  adopter = mock;\n}\nfunction register(element, name = element.name, asRoot = false) {\n  elements[name] = element;\n  if (asRoot) elements[root] = element;\n  addMethodNames(Object.getOwnPropertyNames(element.prototype));\n  return element;\n}\nfunction getClass(name) {\n  return elements[name];\n}\n\n// Element id sequence\nlet did = 1000;\n\n// Get next named element id\nfunction eid(name) {\n  return 'Svgjs' + capitalize(name) + did++;\n}\n\n// Deep new id assignment\nfunction assignNewId(node) {\n  // do the same for SVG child nodes as well\n  for (let i = node.children.length - 1; i >= 0; i--) {\n    assignNewId(node.children[i]);\n  }\n  if (node.id) {\n    node.id = eid(node.nodeName);\n    return node;\n  }\n  return node;\n}\n\n// Method for extending objects\nfunction extend(modules, methods) {\n  let key, i;\n  modules = Array.isArray(modules) ? modules : [modules];\n  for (i = modules.length - 1; i >= 0; i--) {\n    for (key in methods) {\n      modules[i].prototype[key] = methods[key];\n    }\n  }\n}\nfunction wrapWithAttrCheck(fn) {\n  return function (...args) {\n    const o = args[args.length - 1];\n    if (o && o.constructor === Object && !(o instanceof Array)) {\n      return fn.apply(this, args.slice(0, -1)).attr(o);\n    } else {\n      return fn.apply(this, args);\n    }\n  };\n}\n\n// Get all siblings, including myself\nfunction siblings() {\n  return this.parent().children();\n}\n\n// Get the current position siblings\nfunction position() {\n  return this.parent().index(this);\n}\n\n// Get the next element (will return null if there is none)\nfunction next() {\n  return this.siblings()[this.position() + 1];\n}\n\n// Get the next element (will return null if there is none)\nfunction prev() {\n  return this.siblings()[this.position() - 1];\n}\n\n// Send given element one step forward\nfunction forward() {\n  const i = this.position();\n  const p = this.parent();\n\n  // move node one step forward\n  p.add(this.remove(), i + 1);\n  return this;\n}\n\n// Send given element one step backward\nfunction backward() {\n  const i = this.position();\n  const p = this.parent();\n  p.add(this.remove(), i ? i - 1 : 0);\n  return this;\n}\n\n// Send given element all the way to the front\nfunction front() {\n  const p = this.parent();\n\n  // Move node forward\n  p.add(this.remove());\n  return this;\n}\n\n// Send given element all the way to the back\nfunction back() {\n  const p = this.parent();\n\n  // Move node back\n  p.add(this.remove(), 0);\n  return this;\n}\n\n// Inserts a given element before the targeted element\nfunction before(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i);\n  return this;\n}\n\n// Inserts a given element after the targeted element\nfunction after(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i + 1);\n  return this;\n}\nfunction insertBefore(element) {\n  element = makeInstance(element);\n  element.before(this);\n  return this;\n}\nfunction insertAfter(element) {\n  element = makeInstance(element);\n  element.after(this);\n  return this;\n}\nregisterMethods('Dom', {\n  siblings,\n  position,\n  next,\n  prev,\n  forward,\n  backward,\n  front,\n  back,\n  before,\n  after,\n  insertBefore,\n  insertAfter\n});\n\n// Parse unit value\nconst numberAndUnit = /^([+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?)([a-z%]*)$/i;\n\n// Parse hex value\nconst hex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\n\n// Parse rgb value\nconst rgb = /rgb\\((\\d+),(\\d+),(\\d+)\\)/;\n\n// Parse reference id\nconst reference = /(#[a-z_][a-z0-9\\-_]*)/i;\n\n// splits a transformation chain\nconst transforms = /\\)\\s*,?\\s*/;\n\n// Whitespace\nconst whitespace = /\\s/g;\n\n// Test hex value\nconst isHex = /^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i;\n\n// Test rgb value\nconst isRgb = /^rgb\\(/;\n\n// Test for blank string\nconst isBlank = /^(\\s+)?$/;\n\n// Test for numeric string\nconst isNumber = /^[+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n// Test for image url\nconst isImage = /\\.(jpg|jpeg|png|gif|svg)(\\?[^=]+.*)?/i;\n\n// split at whitespace and comma\nconst delimiter = /[\\s,]+/;\n\n// Test for path letter\nconst isPathLetter = /[MLHVCSQTAZ]/i;\n\nvar regex = {\n  __proto__: null,\n  delimiter: delimiter,\n  hex: hex,\n  isBlank: isBlank,\n  isHex: isHex,\n  isImage: isImage,\n  isNumber: isNumber,\n  isPathLetter: isPathLetter,\n  isRgb: isRgb,\n  numberAndUnit: numberAndUnit,\n  reference: reference,\n  rgb: rgb,\n  transforms: transforms,\n  whitespace: whitespace\n};\n\n// Return array of classes on the node\nfunction classes() {\n  const attr = this.attr('class');\n  return attr == null ? [] : attr.trim().split(delimiter);\n}\n\n// Return true if class exists on the node, false otherwise\nfunction hasClass(name) {\n  return this.classes().indexOf(name) !== -1;\n}\n\n// Add class to the node\nfunction addClass(name) {\n  if (!this.hasClass(name)) {\n    const array = this.classes();\n    array.push(name);\n    this.attr('class', array.join(' '));\n  }\n  return this;\n}\n\n// Remove class from the node\nfunction removeClass(name) {\n  if (this.hasClass(name)) {\n    this.attr('class', this.classes().filter(function (c) {\n      return c !== name;\n    }).join(' '));\n  }\n  return this;\n}\n\n// Toggle the presence of a class on the node\nfunction toggleClass(name) {\n  return this.hasClass(name) ? this.removeClass(name) : this.addClass(name);\n}\nregisterMethods('Dom', {\n  classes,\n  hasClass,\n  addClass,\n  removeClass,\n  toggleClass\n});\n\n// Dynamic style generator\nfunction css(style, val) {\n  const ret = {};\n  if (arguments.length === 0) {\n    // get full style as object\n    this.node.style.cssText.split(/\\s*;\\s*/).filter(function (el) {\n      return !!el.length;\n    }).forEach(function (el) {\n      const t = el.split(/\\s*:\\s*/);\n      ret[t[0]] = t[1];\n    });\n    return ret;\n  }\n  if (arguments.length < 2) {\n    // get style properties as array\n    if (Array.isArray(style)) {\n      for (const name of style) {\n        const cased = name;\n        ret[name] = this.node.style.getPropertyValue(cased);\n      }\n      return ret;\n    }\n\n    // get style for property\n    if (typeof style === 'string') {\n      return this.node.style.getPropertyValue(style);\n    }\n\n    // set styles in object\n    if (typeof style === 'object') {\n      for (const name in style) {\n        // set empty string if null/undefined/'' was given\n        this.node.style.setProperty(name, style[name] == null || isBlank.test(style[name]) ? '' : style[name]);\n      }\n    }\n  }\n\n  // set style for property\n  if (arguments.length === 2) {\n    this.node.style.setProperty(style, val == null || isBlank.test(val) ? '' : val);\n  }\n  return this;\n}\n\n// Show element\nfunction show() {\n  return this.css('display', '');\n}\n\n// Hide element\nfunction hide() {\n  return this.css('display', 'none');\n}\n\n// Is element visible?\nfunction visible() {\n  return this.css('display') !== 'none';\n}\nregisterMethods('Dom', {\n  css,\n  show,\n  hide,\n  visible\n});\n\n// Store data values on svg nodes\nfunction data(a, v, r) {\n  if (a == null) {\n    // get an object of attributes\n    return this.data(map(filter(this.node.attributes, el => el.nodeName.indexOf('data-') === 0), el => el.nodeName.slice(5)));\n  } else if (a instanceof Array) {\n    const data = {};\n    for (const key of a) {\n      data[key] = this.data(key);\n    }\n    return data;\n  } else if (typeof a === 'object') {\n    for (v in a) {\n      this.data(v, a[v]);\n    }\n  } else if (arguments.length < 2) {\n    try {\n      return JSON.parse(this.attr('data-' + a));\n    } catch (e) {\n      return this.attr('data-' + a);\n    }\n  } else {\n    this.attr('data-' + a, v === null ? null : r === true || typeof v === 'string' || typeof v === 'number' ? v : JSON.stringify(v));\n  }\n  return this;\n}\nregisterMethods('Dom', {\n  data\n});\n\n// Remember arbitrary data\nfunction remember(k, v) {\n  // remember every item in an object individually\n  if (typeof arguments[0] === 'object') {\n    for (const key in k) {\n      this.remember(key, k[key]);\n    }\n  } else if (arguments.length === 1) {\n    // retrieve memory\n    return this.memory()[k];\n  } else {\n    // store memory\n    this.memory()[k] = v;\n  }\n  return this;\n}\n\n// Erase a given memory\nfunction forget() {\n  if (arguments.length === 0) {\n    this._memory = {};\n  } else {\n    for (let i = arguments.length - 1; i >= 0; i--) {\n      delete this.memory()[arguments[i]];\n    }\n  }\n  return this;\n}\n\n// This triggers creation of a new hidden class which is not performant\n// However, this function is not rarely used so it will not happen frequently\n// Return local memory object\nfunction memory() {\n  return this._memory = this._memory || {};\n}\nregisterMethods('Dom', {\n  remember,\n  forget,\n  memory\n});\n\nfunction sixDigitHex(hex) {\n  return hex.length === 4 ? ['#', hex.substring(1, 2), hex.substring(1, 2), hex.substring(2, 3), hex.substring(2, 3), hex.substring(3, 4), hex.substring(3, 4)].join('') : hex;\n}\nfunction componentHex(component) {\n  const integer = Math.round(component);\n  const bounded = Math.max(0, Math.min(255, integer));\n  const hex = bounded.toString(16);\n  return hex.length === 1 ? '0' + hex : hex;\n}\nfunction is(object, space) {\n  for (let i = space.length; i--;) {\n    if (object[space[i]] == null) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction getParameters(a, b) {\n  const params = is(a, 'rgb') ? {\n    _a: a.r,\n    _b: a.g,\n    _c: a.b,\n    _d: 0,\n    space: 'rgb'\n  } : is(a, 'xyz') ? {\n    _a: a.x,\n    _b: a.y,\n    _c: a.z,\n    _d: 0,\n    space: 'xyz'\n  } : is(a, 'hsl') ? {\n    _a: a.h,\n    _b: a.s,\n    _c: a.l,\n    _d: 0,\n    space: 'hsl'\n  } : is(a, 'lab') ? {\n    _a: a.l,\n    _b: a.a,\n    _c: a.b,\n    _d: 0,\n    space: 'lab'\n  } : is(a, 'lch') ? {\n    _a: a.l,\n    _b: a.c,\n    _c: a.h,\n    _d: 0,\n    space: 'lch'\n  } : is(a, 'cmyk') ? {\n    _a: a.c,\n    _b: a.m,\n    _c: a.y,\n    _d: a.k,\n    space: 'cmyk'\n  } : {\n    _a: 0,\n    _b: 0,\n    _c: 0,\n    space: 'rgb'\n  };\n  params.space = b || params.space;\n  return params;\n}\nfunction cieSpace(space) {\n  if (space === 'lab' || space === 'xyz' || space === 'lch') {\n    return true;\n  } else {\n    return false;\n  }\n}\nfunction hueToRgb(p, q, t) {\n  if (t < 0) t += 1;\n  if (t > 1) t -= 1;\n  if (t < 1 / 6) return p + (q - p) * 6 * t;\n  if (t < 1 / 2) return q;\n  if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n  return p;\n}\nclass Color {\n  constructor(...inputs) {\n    this.init(...inputs);\n  }\n\n  // Test if given value is a color\n  static isColor(color) {\n    return color && (color instanceof Color || this.isRgb(color) || this.test(color));\n  }\n\n  // Test if given value is an rgb object\n  static isRgb(color) {\n    return color && typeof color.r === 'number' && typeof color.g === 'number' && typeof color.b === 'number';\n  }\n\n  /*\n  Generating random colors\n  */\n  static random(mode = 'vibrant', t) {\n    // Get the math modules\n    const {\n      random,\n      round,\n      sin,\n      PI: pi\n    } = Math;\n\n    // Run the correct generator\n    if (mode === 'vibrant') {\n      const l = (81 - 57) * random() + 57;\n      const c = (83 - 45) * random() + 45;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'sine') {\n      t = t == null ? random() : t;\n      const r = round(80 * sin(2 * pi * t / 0.5 + 0.01) + 150);\n      const g = round(50 * sin(2 * pi * t / 0.5 + 4.6) + 200);\n      const b = round(100 * sin(2 * pi * t / 0.5 + 2.3) + 150);\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'pastel') {\n      const l = (94 - 86) * random() + 86;\n      const c = (26 - 9) * random() + 9;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'dark') {\n      const l = 10 + 10 * random();\n      const c = (125 - 75) * random() + 86;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'rgb') {\n      const r = 255 * random();\n      const g = 255 * random();\n      const b = 255 * random();\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'lab') {\n      const l = 100 * random();\n      const a = 256 * random() - 128;\n      const b = 256 * random() - 128;\n      const color = new Color(l, a, b, 'lab');\n      return color;\n    } else if (mode === 'grey') {\n      const grey = 255 * random();\n      const color = new Color(grey, grey, grey);\n      return color;\n    } else {\n      throw new Error('Unsupported random color mode');\n    }\n  }\n\n  // Test if given value is a color string\n  static test(color) {\n    return typeof color === 'string' && (isHex.test(color) || isRgb.test(color));\n  }\n  cmyk() {\n    // Get the rgb values for the current color\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Get the cmyk values in an unbounded format\n    const k = Math.min(1 - r, 1 - g, 1 - b);\n    if (k === 1) {\n      // Catch the black case\n      return new Color(0, 0, 0, 1, 'cmyk');\n    }\n    const c = (1 - r - k) / (1 - k);\n    const m = (1 - g - k) / (1 - k);\n    const y = (1 - b - k) / (1 - k);\n\n    // Construct the new color\n    const color = new Color(c, m, y, k, 'cmyk');\n    return color;\n  }\n  hsl() {\n    // Get the rgb values\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Find the maximum and minimum values to get the lightness\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    const l = (max + min) / 2;\n\n    // If the r, g, v values are identical then we are grey\n    const isGrey = max === min;\n\n    // Calculate the hue and saturation\n    const delta = max - min;\n    const s = isGrey ? 0 : l > 0.5 ? delta / (2 - max - min) : delta / (max + min);\n    const h = isGrey ? 0 : max === r ? ((g - b) / delta + (g < b ? 6 : 0)) / 6 : max === g ? ((b - r) / delta + 2) / 6 : max === b ? ((r - g) / delta + 4) / 6 : 0;\n\n    // Construct and return the new color\n    const color = new Color(360 * h, 100 * s, 100 * l, 'hsl');\n    return color;\n  }\n  init(a = 0, b = 0, c = 0, d = 0, space = 'rgb') {\n    // This catches the case when a falsy value is passed like ''\n    a = !a ? 0 : a;\n\n    // Reset all values in case the init function is rerun with new color space\n    if (this.space) {\n      for (const component in this.space) {\n        delete this[this.space[component]];\n      }\n    }\n    if (typeof a === 'number') {\n      // Allow for the case that we don't need d...\n      space = typeof d === 'string' ? d : space;\n      d = typeof d === 'string' ? 0 : d;\n\n      // Assign the values straight to the color\n      Object.assign(this, {\n        _a: a,\n        _b: b,\n        _c: c,\n        _d: d,\n        space\n      });\n      // If the user gave us an array, make the color from it\n    } else if (a instanceof Array) {\n      this.space = b || (typeof a[3] === 'string' ? a[3] : a[4]) || 'rgb';\n      Object.assign(this, {\n        _a: a[0],\n        _b: a[1],\n        _c: a[2],\n        _d: a[3] || 0\n      });\n    } else if (a instanceof Object) {\n      // Set the object up and assign its values directly\n      const values = getParameters(a, b);\n      Object.assign(this, values);\n    } else if (typeof a === 'string') {\n      if (isRgb.test(a)) {\n        const noWhitespace = a.replace(whitespace, '');\n        const [_a, _b, _c] = rgb.exec(noWhitespace).slice(1, 4).map(v => parseInt(v));\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else if (isHex.test(a)) {\n        const hexParse = v => parseInt(v, 16);\n        const [, _a, _b, _c] = hex.exec(sixDigitHex(a)).map(hexParse);\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else throw Error(\"Unsupported string format, can't construct Color\");\n    }\n\n    // Now add the components as a convenience\n    const {\n      _a,\n      _b,\n      _c,\n      _d\n    } = this;\n    const components = this.space === 'rgb' ? {\n      r: _a,\n      g: _b,\n      b: _c\n    } : this.space === 'xyz' ? {\n      x: _a,\n      y: _b,\n      z: _c\n    } : this.space === 'hsl' ? {\n      h: _a,\n      s: _b,\n      l: _c\n    } : this.space === 'lab' ? {\n      l: _a,\n      a: _b,\n      b: _c\n    } : this.space === 'lch' ? {\n      l: _a,\n      c: _b,\n      h: _c\n    } : this.space === 'cmyk' ? {\n      c: _a,\n      m: _b,\n      y: _c,\n      k: _d\n    } : {};\n    Object.assign(this, components);\n  }\n  lab() {\n    // Get the xyz color\n    const {\n      x,\n      y,\n      z\n    } = this.xyz();\n\n    // Get the lab components\n    const l = 116 * y - 16;\n    const a = 500 * (x - y);\n    const b = 200 * (y - z);\n\n    // Construct and return a new color\n    const color = new Color(l, a, b, 'lab');\n    return color;\n  }\n  lch() {\n    // Get the lab color directly\n    const {\n      l,\n      a,\n      b\n    } = this.lab();\n\n    // Get the chromaticity and the hue using polar coordinates\n    const c = Math.sqrt(a ** 2 + b ** 2);\n    let h = 180 * Math.atan2(b, a) / Math.PI;\n    if (h < 0) {\n      h *= -1;\n      h = 360 - h;\n    }\n\n    // Make a new color and return it\n    const color = new Color(l, c, h, 'lch');\n    return color;\n  }\n  /*\n  Conversion Methods\n  */\n\n  rgb() {\n    if (this.space === 'rgb') {\n      return this;\n    } else if (cieSpace(this.space)) {\n      // Convert to the xyz color space\n      let {\n        x,\n        y,\n        z\n      } = this;\n      if (this.space === 'lab' || this.space === 'lch') {\n        // Get the values in the lab space\n        let {\n          l,\n          a,\n          b\n        } = this;\n        if (this.space === 'lch') {\n          const {\n            c,\n            h\n          } = this;\n          const dToR = Math.PI / 180;\n          a = c * Math.cos(dToR * h);\n          b = c * Math.sin(dToR * h);\n        }\n\n        // Undo the nonlinear function\n        const yL = (l + 16) / 116;\n        const xL = a / 500 + yL;\n        const zL = yL - b / 200;\n\n        // Get the xyz values\n        const ct = 16 / 116;\n        const mx = 0.008856;\n        const nm = 7.787;\n        x = 0.95047 * (xL ** 3 > mx ? xL ** 3 : (xL - ct) / nm);\n        y = 1.0 * (yL ** 3 > mx ? yL ** 3 : (yL - ct) / nm);\n        z = 1.08883 * (zL ** 3 > mx ? zL ** 3 : (zL - ct) / nm);\n      }\n\n      // Convert xyz to unbounded rgb values\n      const rU = x * 3.2406 + y * -1.5372 + z * -0.4986;\n      const gU = x * -0.9689 + y * 1.8758 + z * 0.0415;\n      const bU = x * 0.0557 + y * -0.204 + z * 1.057;\n\n      // Convert the values to true rgb values\n      const pow = Math.pow;\n      const bd = 0.0031308;\n      const r = rU > bd ? 1.055 * pow(rU, 1 / 2.4) - 0.055 : 12.92 * rU;\n      const g = gU > bd ? 1.055 * pow(gU, 1 / 2.4) - 0.055 : 12.92 * gU;\n      const b = bU > bd ? 1.055 * pow(bU, 1 / 2.4) - 0.055 : 12.92 * bU;\n\n      // Make and return the color\n      const color = new Color(255 * r, 255 * g, 255 * b);\n      return color;\n    } else if (this.space === 'hsl') {\n      // https://bgrins.github.io/TinyColor/docs/tinycolor.html\n      // Get the current hsl values\n      let {\n        h,\n        s,\n        l\n      } = this;\n      h /= 360;\n      s /= 100;\n      l /= 100;\n\n      // If we are grey, then just make the color directly\n      if (s === 0) {\n        l *= 255;\n        const color = new Color(l, l, l);\n        return color;\n      }\n\n      // TODO I have no idea what this does :D If you figure it out, tell me!\n      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      const p = 2 * l - q;\n\n      // Get the rgb values\n      const r = 255 * hueToRgb(p, q, h + 1 / 3);\n      const g = 255 * hueToRgb(p, q, h);\n      const b = 255 * hueToRgb(p, q, h - 1 / 3);\n\n      // Make a new color\n      const color = new Color(r, g, b);\n      return color;\n    } else if (this.space === 'cmyk') {\n      // https://gist.github.com/felipesabino/5066336\n      // Get the normalised cmyk values\n      const {\n        c,\n        m,\n        y,\n        k\n      } = this;\n\n      // Get the rgb values\n      const r = 255 * (1 - Math.min(1, c * (1 - k) + k));\n      const g = 255 * (1 - Math.min(1, m * (1 - k) + k));\n      const b = 255 * (1 - Math.min(1, y * (1 - k) + k));\n\n      // Form the color and return it\n      const color = new Color(r, g, b);\n      return color;\n    } else {\n      return this;\n    }\n  }\n  toArray() {\n    const {\n      _a,\n      _b,\n      _c,\n      _d,\n      space\n    } = this;\n    return [_a, _b, _c, _d, space];\n  }\n  toHex() {\n    const [r, g, b] = this._clamped().map(componentHex);\n    return `#${r}${g}${b}`;\n  }\n  toRgb() {\n    const [rV, gV, bV] = this._clamped();\n    const string = `rgb(${rV},${gV},${bV})`;\n    return string;\n  }\n  toString() {\n    return this.toHex();\n  }\n  xyz() {\n    // Normalise the red, green and blue values\n    const {\n      _a: r255,\n      _b: g255,\n      _c: b255\n    } = this.rgb();\n    const [r, g, b] = [r255, g255, b255].map(v => v / 255);\n\n    // Convert to the lab rgb space\n    const rL = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\n    const gL = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\n    const bL = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\n\n    // Convert to the xyz color space without bounding the values\n    const xU = (rL * 0.4124 + gL * 0.3576 + bL * 0.1805) / 0.95047;\n    const yU = (rL * 0.2126 + gL * 0.7152 + bL * 0.0722) / 1.0;\n    const zU = (rL * 0.0193 + gL * 0.1192 + bL * 0.9505) / 1.08883;\n\n    // Get the proper xyz values by applying the bounding\n    const x = xU > 0.008856 ? Math.pow(xU, 1 / 3) : 7.787 * xU + 16 / 116;\n    const y = yU > 0.008856 ? Math.pow(yU, 1 / 3) : 7.787 * yU + 16 / 116;\n    const z = zU > 0.008856 ? Math.pow(zU, 1 / 3) : 7.787 * zU + 16 / 116;\n\n    // Make and return the color\n    const color = new Color(x, y, z, 'xyz');\n    return color;\n  }\n\n  /*\n  Input and Output methods\n  */\n\n  _clamped() {\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const {\n      max,\n      min,\n      round\n    } = Math;\n    const format = v => max(0, min(round(v), 255));\n    return [_a, _b, _c].map(format);\n  }\n\n  /*\n  Constructing colors\n  */\n}\n\nclass Point {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n\n  // Clone point\n  clone() {\n    return new Point(this);\n  }\n  init(x, y) {\n    const base = {\n      x: 0,\n      y: 0\n    };\n\n    // ensure source as object\n    const source = Array.isArray(x) ? {\n      x: x[0],\n      y: x[1]\n    } : typeof x === 'object' ? {\n      x: x.x,\n      y: x.y\n    } : {\n      x: x,\n      y: y\n    };\n\n    // merge source\n    this.x = source.x == null ? base.x : source.x;\n    this.y = source.y == null ? base.y : source.y;\n    return this;\n  }\n  toArray() {\n    return [this.x, this.y];\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // Transform point with matrix\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    const {\n      x,\n      y\n    } = this;\n\n    // Perform the matrix multiplication\n    this.x = m.a * x + m.c * y + m.e;\n    this.y = m.b * x + m.d * y + m.f;\n    return this;\n  }\n}\nfunction point(x, y) {\n  return new Point(x, y).transformO(this.screenCTM().inverseO());\n}\n\nfunction closeEnough(a, b, threshold) {\n  return Math.abs(b - a) < (1e-6);\n}\nclass Matrix {\n  constructor(...args) {\n    this.init(...args);\n  }\n  static formatTransforms(o) {\n    // Get all of the parameters required to form the matrix\n    const flipBoth = o.flip === 'both' || o.flip === true;\n    const flipX = o.flip && (flipBoth || o.flip === 'x') ? -1 : 1;\n    const flipY = o.flip && (flipBoth || o.flip === 'y') ? -1 : 1;\n    const skewX = o.skew && o.skew.length ? o.skew[0] : isFinite(o.skew) ? o.skew : isFinite(o.skewX) ? o.skewX : 0;\n    const skewY = o.skew && o.skew.length ? o.skew[1] : isFinite(o.skew) ? o.skew : isFinite(o.skewY) ? o.skewY : 0;\n    const scaleX = o.scale && o.scale.length ? o.scale[0] * flipX : isFinite(o.scale) ? o.scale * flipX : isFinite(o.scaleX) ? o.scaleX * flipX : flipX;\n    const scaleY = o.scale && o.scale.length ? o.scale[1] * flipY : isFinite(o.scale) ? o.scale * flipY : isFinite(o.scaleY) ? o.scaleY * flipY : flipY;\n    const shear = o.shear || 0;\n    const theta = o.rotate || o.theta || 0;\n    const origin = new Point(o.origin || o.around || o.ox || o.originX, o.oy || o.originY);\n    const ox = origin.x;\n    const oy = origin.y;\n    // We need Point to be invalid if nothing was passed because we cannot default to 0 here. That is why NaN\n    const position = new Point(o.position || o.px || o.positionX || NaN, o.py || o.positionY || NaN);\n    const px = position.x;\n    const py = position.y;\n    const translate = new Point(o.translate || o.tx || o.translateX, o.ty || o.translateY);\n    const tx = translate.x;\n    const ty = translate.y;\n    const relative = new Point(o.relative || o.rx || o.relativeX, o.ry || o.relativeY);\n    const rx = relative.x;\n    const ry = relative.y;\n\n    // Populate all of the values\n    return {\n      scaleX,\n      scaleY,\n      skewX,\n      skewY,\n      shear,\n      theta,\n      rx,\n      ry,\n      tx,\n      ty,\n      ox,\n      oy,\n      px,\n      py\n    };\n  }\n  static fromArray(a) {\n    return {\n      a: a[0],\n      b: a[1],\n      c: a[2],\n      d: a[3],\n      e: a[4],\n      f: a[5]\n    };\n  }\n  static isMatrixLike(o) {\n    return o.a != null || o.b != null || o.c != null || o.d != null || o.e != null || o.f != null;\n  }\n\n  // left matrix, right matrix, target matrix which is overwritten\n  static matrixMultiply(l, r, o) {\n    // Work out the product directly\n    const a = l.a * r.a + l.c * r.b;\n    const b = l.b * r.a + l.d * r.b;\n    const c = l.a * r.c + l.c * r.d;\n    const d = l.b * r.c + l.d * r.d;\n    const e = l.e + l.a * r.e + l.c * r.f;\n    const f = l.f + l.b * r.e + l.d * r.f;\n\n    // make sure to use local variables because l/r and o could be the same\n    o.a = a;\n    o.b = b;\n    o.c = c;\n    o.d = d;\n    o.e = e;\n    o.f = f;\n    return o;\n  }\n  around(cx, cy, matrix) {\n    return this.clone().aroundO(cx, cy, matrix);\n  }\n\n  // Transform around a center point\n  aroundO(cx, cy, matrix) {\n    const dx = cx || 0;\n    const dy = cy || 0;\n    return this.translateO(-dx, -dy).lmultiplyO(matrix).translateO(dx, dy);\n  }\n\n  // Clones this matrix\n  clone() {\n    return new Matrix(this);\n  }\n\n  // Decomposes this matrix into its affine parameters\n  decompose(cx = 0, cy = 0) {\n    // Get the parameters from the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Figure out if the winding direction is clockwise or counterclockwise\n    const determinant = a * d - b * c;\n    const ccw = determinant > 0 ? 1 : -1;\n\n    // Since we only shear in x, we can use the x basis to get the x scale\n    // and the rotation of the resulting matrix\n    const sx = ccw * Math.sqrt(a * a + b * b);\n    const thetaRad = Math.atan2(ccw * b, ccw * a);\n    const theta = 180 / Math.PI * thetaRad;\n    const ct = Math.cos(thetaRad);\n    const st = Math.sin(thetaRad);\n\n    // We can then solve the y basis vector simultaneously to get the other\n    // two affine parameters directly from these parameters\n    const lam = (a * c + b * d) / determinant;\n    const sy = c * sx / (lam * a - b) || d * sx / (lam * b + a);\n\n    // Use the translations\n    const tx = e - cx + cx * ct * sx + cy * (lam * ct * sx - st * sy);\n    const ty = f - cy + cx * st * sx + cy * (lam * st * sx + ct * sy);\n\n    // Construct the decomposition and return it\n    return {\n      // Return the affine parameters\n      scaleX: sx,\n      scaleY: sy,\n      shear: lam,\n      rotate: theta,\n      translateX: tx,\n      translateY: ty,\n      originX: cx,\n      originY: cy,\n      // Return the matrix parameters\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n\n  // Check if two matrices are equal\n  equals(other) {\n    if (other === this) return true;\n    const comp = new Matrix(other);\n    return closeEnough(this.a, comp.a) && closeEnough(this.b, comp.b) && closeEnough(this.c, comp.c) && closeEnough(this.d, comp.d) && closeEnough(this.e, comp.e) && closeEnough(this.f, comp.f);\n  }\n\n  // Flip matrix on x or y, at a given offset\n  flip(axis, around) {\n    return this.clone().flipO(axis, around);\n  }\n  flipO(axis, around) {\n    return axis === 'x' ? this.scaleO(-1, 1, around, 0) : axis === 'y' ? this.scaleO(1, -1, 0, around) : this.scaleO(-1, -1, axis, around || axis); // Define an x, y flip point\n  }\n\n  // Initialize\n  init(source) {\n    const base = Matrix.fromArray([1, 0, 0, 1, 0, 0]);\n\n    // ensure source as object\n    source = source instanceof Element ? source.matrixify() : typeof source === 'string' ? Matrix.fromArray(source.split(delimiter).map(parseFloat)) : Array.isArray(source) ? Matrix.fromArray(source) : typeof source === 'object' && Matrix.isMatrixLike(source) ? source : typeof source === 'object' ? new Matrix().transform(source) : arguments.length === 6 ? Matrix.fromArray([].slice.call(arguments)) : base;\n\n    // Merge the source matrix with the base matrix\n    this.a = source.a != null ? source.a : base.a;\n    this.b = source.b != null ? source.b : base.b;\n    this.c = source.c != null ? source.c : base.c;\n    this.d = source.d != null ? source.d : base.d;\n    this.e = source.e != null ? source.e : base.e;\n    this.f = source.f != null ? source.f : base.f;\n    return this;\n  }\n  inverse() {\n    return this.clone().inverseO();\n  }\n\n  // Inverses matrix\n  inverseO() {\n    // Get the current parameters out of the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Invert the 2x2 matrix in the top left\n    const det = a * d - b * c;\n    if (!det) throw new Error('Cannot invert ' + this);\n\n    // Calculate the top 2x2 matrix\n    const na = d / det;\n    const nb = -b / det;\n    const nc = -c / det;\n    const nd = a / det;\n\n    // Apply the inverted matrix to the top right\n    const ne = -(na * e + nc * f);\n    const nf = -(nb * e + nd * f);\n\n    // Construct the inverted matrix\n    this.a = na;\n    this.b = nb;\n    this.c = nc;\n    this.d = nd;\n    this.e = ne;\n    this.f = nf;\n    return this;\n  }\n  lmultiply(matrix) {\n    return this.clone().lmultiplyO(matrix);\n  }\n  lmultiplyO(matrix) {\n    const r = this;\n    const l = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Left multiplies by the given matrix\n  multiply(matrix) {\n    return this.clone().multiplyO(matrix);\n  }\n  multiplyO(matrix) {\n    // Get the matrices\n    const l = this;\n    const r = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Rotate matrix\n  rotate(r, cx, cy) {\n    return this.clone().rotateO(r, cx, cy);\n  }\n  rotateO(r, cx = 0, cy = 0) {\n    // Convert degrees to radians\n    r = radians(r);\n    const cos = Math.cos(r);\n    const sin = Math.sin(r);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * cos - b * sin;\n    this.b = b * cos + a * sin;\n    this.c = c * cos - d * sin;\n    this.d = d * cos + c * sin;\n    this.e = e * cos - f * sin + cy * sin - cx * cos + cx;\n    this.f = f * cos + e * sin - cx * sin - cy * cos + cy;\n    return this;\n  }\n\n  // Scale matrix\n  scale() {\n    return this.clone().scaleO(...arguments);\n  }\n  scaleO(x, y = x, cx = 0, cy = 0) {\n    // Support uniform scaling\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * x;\n    this.b = b * y;\n    this.c = c * x;\n    this.d = d * y;\n    this.e = e * x - cx * x + cx;\n    this.f = f * y - cy * y + cy;\n    return this;\n  }\n\n  // Shear matrix\n  shear(a, cx, cy) {\n    return this.clone().shearO(a, cx, cy);\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  shearO(lx, cx = 0, cy = 0) {\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.c = c + d * lx;\n    this.e = e + f * lx - cy * lx;\n    return this;\n  }\n\n  // Skew Matrix\n  skew() {\n    return this.clone().skewO(...arguments);\n  }\n  skewO(x, y = x, cx = 0, cy = 0) {\n    // support uniformal skew\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n\n    // Convert degrees to radians\n    x = radians(x);\n    y = radians(y);\n    const lx = Math.tan(x);\n    const ly = Math.tan(y);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.b = b + a * ly;\n    this.c = c + d * lx;\n    this.d = d + c * ly;\n    this.e = e + f * lx - cy * lx;\n    this.f = f + e * ly - cx * ly;\n    return this;\n  }\n\n  // SkewX\n  skewX(x, cx, cy) {\n    return this.skew(x, 0, cx, cy);\n  }\n\n  // SkewY\n  skewY(y, cx, cy) {\n    return this.skew(0, y, cx, cy);\n  }\n  toArray() {\n    return [this.a, this.b, this.c, this.d, this.e, this.f];\n  }\n\n  // Convert matrix to string\n  toString() {\n    return 'matrix(' + this.a + ',' + this.b + ',' + this.c + ',' + this.d + ',' + this.e + ',' + this.f + ')';\n  }\n\n  // Transform a matrix into another matrix by manipulating the space\n  transform(o) {\n    // Check if o is a matrix and then left multiply it directly\n    if (Matrix.isMatrixLike(o)) {\n      const matrix = new Matrix(o);\n      return matrix.multiplyO(this);\n    }\n\n    // Get the proposed transformations and the current transformations\n    const t = Matrix.formatTransforms(o);\n    const current = this;\n    const {\n      x: ox,\n      y: oy\n    } = new Point(t.ox, t.oy).transform(current);\n\n    // Construct the resulting matrix\n    const transformer = new Matrix().translateO(t.rx, t.ry).lmultiplyO(current).translateO(-ox, -oy).scaleO(t.scaleX, t.scaleY).skewO(t.skewX, t.skewY).shearO(t.shear).rotateO(t.theta).translateO(ox, oy);\n\n    // If we want the origin at a particular place, we force it there\n    if (isFinite(t.px) || isFinite(t.py)) {\n      const origin = new Point(ox, oy).transform(transformer);\n      // TODO: Replace t.px with isFinite(t.px)\n      // Doesn't work because t.px is also 0 if it wasn't passed\n      const dx = isFinite(t.px) ? t.px - origin.x : 0;\n      const dy = isFinite(t.py) ? t.py - origin.y : 0;\n      transformer.translateO(dx, dy);\n    }\n\n    // Translate now after positioning\n    transformer.translateO(t.tx, t.ty);\n    return transformer;\n  }\n\n  // Translate matrix\n  translate(x, y) {\n    return this.clone().translateO(x, y);\n  }\n  translateO(x, y) {\n    this.e += x || 0;\n    this.f += y || 0;\n    return this;\n  }\n  valueOf() {\n    return {\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n}\nfunction ctm() {\n  return new Matrix(this.node.getCTM());\n}\nfunction screenCTM() {\n  try {\n    /* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537\n       This is needed because FF does not return the transformation matrix\n       for the inner coordinate system when getScreenCTM() is called on nested svgs.\n       However all other Browsers do that */\n    if (typeof this.isRoot === 'function' && !this.isRoot()) {\n      const rect = this.rect(1, 1);\n      const m = rect.node.getScreenCTM();\n      rect.remove();\n      return new Matrix(m);\n    }\n    return new Matrix(this.node.getScreenCTM());\n  } catch (e) {\n    console.warn(`Cannot get CTM from SVG node ${this.node.nodeName}. Is the element rendered?`);\n    return new Matrix();\n  }\n}\nregister(Matrix, 'Matrix');\n\nfunction parser() {\n  // Reuse cached element if possible\n  if (!parser.nodes) {\n    const svg = makeInstance().size(2, 0);\n    svg.node.style.cssText = ['opacity: 0', 'position: absolute', 'left: -100%', 'top: -100%', 'overflow: hidden'].join(';');\n    svg.attr('focusable', 'false');\n    svg.attr('aria-hidden', 'true');\n    const path = svg.path().node;\n    parser.nodes = {\n      svg,\n      path\n    };\n  }\n  if (!parser.nodes.svg.node.parentNode) {\n    const b = globals.document.body || globals.document.documentElement;\n    parser.nodes.svg.addTo(b);\n  }\n  return parser.nodes;\n}\n\nfunction isNulledBox(box) {\n  return !box.width && !box.height && !box.x && !box.y;\n}\nfunction domContains(node) {\n  return node === globals.document || (globals.document.documentElement.contains || function (node) {\n    // This is IE - it does not support contains() for top-level SVGs\n    while (node.parentNode) {\n      node = node.parentNode;\n    }\n    return node === globals.document;\n  }).call(globals.document.documentElement, node);\n}\nclass Box {\n  constructor(...args) {\n    this.init(...args);\n  }\n  addOffset() {\n    // offset by window scroll position, because getBoundingClientRect changes when window is scrolled\n    this.x += globals.window.pageXOffset;\n    this.y += globals.window.pageYOffset;\n    return new Box(this);\n  }\n  init(source) {\n    const base = [0, 0, 0, 0];\n    source = typeof source === 'string' ? source.split(delimiter).map(parseFloat) : Array.isArray(source) ? source : typeof source === 'object' ? [source.left != null ? source.left : source.x, source.top != null ? source.top : source.y, source.width, source.height] : arguments.length === 4 ? [].slice.call(arguments) : base;\n    this.x = source[0] || 0;\n    this.y = source[1] || 0;\n    this.width = this.w = source[2] || 0;\n    this.height = this.h = source[3] || 0;\n\n    // Add more bounding box properties\n    this.x2 = this.x + this.w;\n    this.y2 = this.y + this.h;\n    this.cx = this.x + this.w / 2;\n    this.cy = this.y + this.h / 2;\n    return this;\n  }\n  isNulled() {\n    return isNulledBox(this);\n  }\n\n  // Merge rect box with another, return a new instance\n  merge(box) {\n    const x = Math.min(this.x, box.x);\n    const y = Math.min(this.y, box.y);\n    const width = Math.max(this.x + this.width, box.x + box.width) - x;\n    const height = Math.max(this.y + this.height, box.y + box.height) - y;\n    return new Box(x, y, width, height);\n  }\n  toArray() {\n    return [this.x, this.y, this.width, this.height];\n  }\n  toString() {\n    return this.x + ' ' + this.y + ' ' + this.width + ' ' + this.height;\n  }\n  transform(m) {\n    if (!(m instanceof Matrix)) {\n      m = new Matrix(m);\n    }\n    let xMin = Infinity;\n    let xMax = -Infinity;\n    let yMin = Infinity;\n    let yMax = -Infinity;\n    const pts = [new Point(this.x, this.y), new Point(this.x2, this.y), new Point(this.x, this.y2), new Point(this.x2, this.y2)];\n    pts.forEach(function (p) {\n      p = p.transform(m);\n      xMin = Math.min(xMin, p.x);\n      xMax = Math.max(xMax, p.x);\n      yMin = Math.min(yMin, p.y);\n      yMax = Math.max(yMax, p.y);\n    });\n    return new Box(xMin, yMin, xMax - xMin, yMax - yMin);\n  }\n}\nfunction getBox(el, getBBoxFn, retry) {\n  let box;\n  try {\n    // Try to get the box with the provided function\n    box = getBBoxFn(el.node);\n\n    // If the box is worthless and not even in the dom, retry\n    // by throwing an error here...\n    if (isNulledBox(box) && !domContains(el.node)) {\n      throw new Error('Element not in the dom');\n    }\n  } catch (e) {\n    // ... and calling the retry handler here\n    box = retry(el);\n  }\n  return box;\n}\nfunction bbox() {\n  // Function to get bbox is getBBox()\n  const getBBox = node => node.getBBox();\n\n  // Take all measures so that a stupid browser renders the element\n  // so we can get the bbox from it when we try again\n  const retry = el => {\n    try {\n      const clone = el.clone().addTo(parser().svg).show();\n      const box = clone.node.getBBox();\n      clone.remove();\n      return box;\n    } catch (e) {\n      // We give up...\n      throw new Error(`Getting bbox of element \"${el.node.nodeName}\" is not possible: ${e.toString()}`);\n    }\n  };\n  const box = getBox(this, getBBox, retry);\n  const bbox = new Box(box);\n  return bbox;\n}\nfunction rbox(el) {\n  const getRBox = node => node.getBoundingClientRect();\n  const retry = el => {\n    // There is no point in trying tricks here because if we insert the element into the dom ourselves\n    // it obviously will be at the wrong position\n    throw new Error(`Getting rbox of element \"${el.node.nodeName}\" is not possible`);\n  };\n  const box = getBox(this, getRBox, retry);\n  const rbox = new Box(box);\n\n  // If an element was passed, we want the bbox in the coordinate system of that element\n  if (el) {\n    return rbox.transform(el.screenCTM().inverseO());\n  }\n\n  // Else we want it in absolute screen coordinates\n  // Therefore we need to add the scrollOffset\n  return rbox.addOffset();\n}\n\n// Checks whether the given point is inside the bounding box\nfunction inside(x, y) {\n  const box = this.bbox();\n  return x > box.x && y > box.y && x < box.x + box.width && y < box.y + box.height;\n}\nregisterMethods({\n  viewbox: {\n    viewbox(x, y, width, height) {\n      // act as getter\n      if (x == null) return new Box(this.attr('viewBox'));\n\n      // act as setter\n      return this.attr('viewBox', new Box(x, y, width, height));\n    },\n    zoom(level, point) {\n      // Its best to rely on the attributes here and here is why:\n      // clientXYZ: Doesn't work on non-root svgs because they dont have a CSSBox (silly!)\n      // getBoundingClientRect: Doesn't work because Chrome just ignores width and height of nested svgs completely\n      //                        that means, their clientRect is always as big as the content.\n      //                        Furthermore this size is incorrect if the element is further transformed by its parents\n      // computedStyle: Only returns meaningful values if css was used with px. We dont go this route here!\n      // getBBox: returns the bounding box of its content - that doesn't help!\n      let {\n        width,\n        height\n      } = this.attr(['width', 'height']);\n\n      // Width and height is a string when a number with a unit is present which we can't use\n      // So we try clientXYZ\n      if (!width && !height || typeof width === 'string' || typeof height === 'string') {\n        width = this.node.clientWidth;\n        height = this.node.clientHeight;\n      }\n\n      // Giving up...\n      if (!width || !height) {\n        throw new Error('Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element');\n      }\n      const v = this.viewbox();\n      const zoomX = width / v.width;\n      const zoomY = height / v.height;\n      const zoom = Math.min(zoomX, zoomY);\n      if (level == null) {\n        return zoom;\n      }\n      let zoomAmount = zoom / level;\n\n      // Set the zoomAmount to the highest value which is safe to process and recover from\n      // The * 100 is a bit of wiggle room for the matrix transformation\n      if (zoomAmount === Infinity) zoomAmount = Number.MAX_SAFE_INTEGER / 100;\n      point = point || new Point(width / 2 / zoomX + v.x, height / 2 / zoomY + v.y);\n      const box = new Box(v).transform(new Matrix({\n        scale: zoomAmount,\n        origin: point\n      }));\n      return this.viewbox(box);\n    }\n  }\n});\nregister(Box, 'Box');\n\n// import { subClassArray } from './ArrayPolyfill.js'\n\nclass List extends Array {\n  constructor(arr = [], ...args) {\n    super(arr, ...args);\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...arr);\n  }\n}\nextend([List], {\n  each(fnOrMethodName, ...args) {\n    if (typeof fnOrMethodName === 'function') {\n      return this.map((el, i, arr) => {\n        return fnOrMethodName.call(el, el, i, arr);\n      });\n    } else {\n      return this.map(el => {\n        return el[fnOrMethodName](...args);\n      });\n    }\n  },\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n});\nconst reserved = ['toArray', 'constructor', 'each'];\nList.extend = function (methods) {\n  methods = methods.reduce((obj, name) => {\n    // Don't overwrite own methods\n    if (reserved.includes(name)) return obj;\n\n    // Don't add private methods\n    if (name[0] === '_') return obj;\n\n    // Allow access to original Array methods through a prefix\n    if (name in Array.prototype) {\n      obj['$' + name] = Array.prototype[name];\n    }\n\n    // Relay every call to each()\n    obj[name] = function (...attrs) {\n      return this.each(name, ...attrs);\n    };\n    return obj;\n  }, {});\n  extend([List], methods);\n};\n\nfunction baseFind(query, parent) {\n  return new List(map((parent || globals.document).querySelectorAll(query), function (node) {\n    return adopt(node);\n  }));\n}\n\n// Scoped find method\nfunction find(query) {\n  return baseFind(query, this.node);\n}\nfunction findOne(query) {\n  return adopt(this.node.querySelector(query));\n}\n\nlet listenerId = 0;\nconst windowEvents = {};\nfunction getEvents(instance) {\n  let n = instance.getEventHolder();\n\n  // We dont want to save events in global space\n  if (n === globals.window) n = windowEvents;\n  if (!n.events) n.events = {};\n  return n.events;\n}\nfunction getEventTarget(instance) {\n  return instance.getEventTarget();\n}\nfunction clearEvents(instance) {\n  let n = instance.getEventHolder();\n  if (n === globals.window) n = windowEvents;\n  if (n.events) n.events = {};\n}\n\n// Add event binder in the SVG namespace\nfunction on(node, events, listener, binding, options) {\n  const l = listener.bind(binding || node);\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // events can be an array of events or a string of events\n  events = Array.isArray(events) ? events : events.split(delimiter);\n\n  // add id to listener\n  if (!listener._svgjsListenerId) {\n    listener._svgjsListenerId = ++listenerId;\n  }\n  events.forEach(function (event) {\n    const ev = event.split('.')[0];\n    const ns = event.split('.')[1] || '*';\n\n    // ensure valid object\n    bag[ev] = bag[ev] || {};\n    bag[ev][ns] = bag[ev][ns] || {};\n\n    // reference listener\n    bag[ev][ns][listener._svgjsListenerId] = l;\n\n    // add listener\n    n.addEventListener(ev, l, options || false);\n  });\n}\n\n// Add event unbinder in the SVG namespace\nfunction off(node, events, listener, options) {\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // listener can be a function or a number\n  if (typeof listener === 'function') {\n    listener = listener._svgjsListenerId;\n    if (!listener) return;\n  }\n\n  // events can be an array of events or a string or undefined\n  events = Array.isArray(events) ? events : (events || '').split(delimiter);\n  events.forEach(function (event) {\n    const ev = event && event.split('.')[0];\n    const ns = event && event.split('.')[1];\n    let namespace, l;\n    if (listener) {\n      // remove listener reference\n      if (bag[ev] && bag[ev][ns || '*']) {\n        // removeListener\n        n.removeEventListener(ev, bag[ev][ns || '*'][listener], options || false);\n        delete bag[ev][ns || '*'][listener];\n      }\n    } else if (ev && ns) {\n      // remove all listeners for a namespaced event\n      if (bag[ev] && bag[ev][ns]) {\n        for (l in bag[ev][ns]) {\n          off(n, [ev, ns].join('.'), l);\n        }\n        delete bag[ev][ns];\n      }\n    } else if (ns) {\n      // remove all listeners for a specific namespace\n      for (event in bag) {\n        for (namespace in bag[event]) {\n          if (ns === namespace) {\n            off(n, [event, ns].join('.'));\n          }\n        }\n      }\n    } else if (ev) {\n      // remove all listeners for the event\n      if (bag[ev]) {\n        for (namespace in bag[ev]) {\n          off(n, [ev, namespace].join('.'));\n        }\n        delete bag[ev];\n      }\n    } else {\n      // remove all listeners on a given node\n      for (event in bag) {\n        off(n, event);\n      }\n      clearEvents(instance);\n    }\n  });\n}\nfunction dispatch(node, event, data, options) {\n  const n = getEventTarget(node);\n\n  // Dispatch event\n  if (event instanceof globals.window.Event) {\n    n.dispatchEvent(event);\n  } else {\n    event = new globals.window.CustomEvent(event, {\n      detail: data,\n      cancelable: true,\n      ...options\n    });\n    n.dispatchEvent(event);\n  }\n  return event;\n}\n\nclass EventTarget extends Base {\n  addEventListener() {}\n  dispatch(event, data, options) {\n    return dispatch(this, event, data, options);\n  }\n  dispatchEvent(event) {\n    const bag = this.getEventHolder().events;\n    if (!bag) return true;\n    const events = bag[event.type];\n    for (const i in events) {\n      for (const j in events[i]) {\n        events[i][j](event);\n      }\n    }\n    return !event.defaultPrevented;\n  }\n\n  // Fire given event\n  fire(event, data, options) {\n    this.dispatch(event, data, options);\n    return this;\n  }\n  getEventHolder() {\n    return this;\n  }\n  getEventTarget() {\n    return this;\n  }\n\n  // Unbind event from listener\n  off(event, listener, options) {\n    off(this, event, listener, options);\n    return this;\n  }\n\n  // Bind given event to listener\n  on(event, listener, binding, options) {\n    on(this, event, listener, binding, options);\n    return this;\n  }\n  removeEventListener() {}\n}\nregister(EventTarget, 'EventTarget');\n\nfunction noop() {}\n\n// Default animation values\nconst timeline = {\n  duration: 400,\n  ease: '>',\n  delay: 0\n};\n\n// Default attribute values\nconst attrs = {\n  // fill and stroke\n  'fill-opacity': 1,\n  'stroke-opacity': 1,\n  'stroke-width': 0,\n  'stroke-linejoin': 'miter',\n  'stroke-linecap': 'butt',\n  fill: '#000000',\n  stroke: '#000000',\n  opacity: 1,\n  // position\n  x: 0,\n  y: 0,\n  cx: 0,\n  cy: 0,\n  // size\n  width: 0,\n  height: 0,\n  // radius\n  r: 0,\n  rx: 0,\n  ry: 0,\n  // gradient\n  offset: 0,\n  'stop-opacity': 1,\n  'stop-color': '#000000',\n  // text\n  'text-anchor': 'start'\n};\n\nvar defaults = {\n  __proto__: null,\n  attrs: attrs,\n  noop: noop,\n  timeline: timeline\n};\n\nclass SVGArray extends Array {\n  constructor(...args) {\n    super(...args);\n    this.init(...args);\n  }\n  clone() {\n    return new this.constructor(this);\n  }\n  init(arr) {\n    // This catches the case, that native map tries to create an array with new Array(1)\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...this.parse(arr));\n    return this;\n  }\n\n  // Parse whitespace separated string\n  parse(array = []) {\n    // If already is an array, no need to parse it\n    if (array instanceof Array) return array;\n    return array.trim().split(delimiter).map(parseFloat);\n  }\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n  toSet() {\n    return new Set(this);\n  }\n  toString() {\n    return this.join(' ');\n  }\n\n  // Flattens the array if needed\n  valueOf() {\n    const ret = [];\n    ret.push(...this);\n    return ret;\n  }\n}\n\n// Module for unit conversions\nclass SVGNumber {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n  convert(unit) {\n    return new SVGNumber(this.value, unit);\n  }\n\n  // Divide number\n  divide(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this / number, this.unit || number.unit);\n  }\n  init(value, unit) {\n    unit = Array.isArray(value) ? value[1] : unit;\n    value = Array.isArray(value) ? value[0] : value;\n\n    // initialize defaults\n    this.value = 0;\n    this.unit = unit || '';\n\n    // parse value\n    if (typeof value === 'number') {\n      // ensure a valid numeric value\n      this.value = isNaN(value) ? 0 : !isFinite(value) ? value < 0 ? -3.4e38 : +3.4e38 : value;\n    } else if (typeof value === 'string') {\n      unit = value.match(numberAndUnit);\n      if (unit) {\n        // make value numeric\n        this.value = parseFloat(unit[1]);\n\n        // normalize\n        if (unit[5] === '%') {\n          this.value /= 100;\n        } else if (unit[5] === 's') {\n          this.value *= 1000;\n        }\n\n        // store unit\n        this.unit = unit[5];\n      }\n    } else {\n      if (value instanceof SVGNumber) {\n        this.value = value.valueOf();\n        this.unit = value.unit;\n      }\n    }\n    return this;\n  }\n\n  // Subtract number\n  minus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this - number, this.unit || number.unit);\n  }\n\n  // Add number\n  plus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this + number, this.unit || number.unit);\n  }\n\n  // Multiply number\n  times(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this * number, this.unit || number.unit);\n  }\n  toArray() {\n    return [this.value, this.unit];\n  }\n  toJSON() {\n    return this.toString();\n  }\n  toString() {\n    return (this.unit === '%' ? ~~(this.value * 1e8) / 1e6 : this.unit === 's' ? this.value / 1e3 : this.value) + this.unit;\n  }\n  valueOf() {\n    return this.value;\n  }\n}\n\nconst colorAttributes = new Set(['fill', 'stroke', 'color', 'bgcolor', 'stop-color', 'flood-color', 'lighting-color']);\nconst hooks = [];\nfunction registerAttrHook(fn) {\n  hooks.push(fn);\n}\n\n// Set svg element attribute\nfunction attr(attr, val, ns) {\n  // act as full getter\n  if (attr == null) {\n    // get an object of attributes\n    attr = {};\n    val = this.node.attributes;\n    for (const node of val) {\n      attr[node.nodeName] = isNumber.test(node.nodeValue) ? parseFloat(node.nodeValue) : node.nodeValue;\n    }\n    return attr;\n  } else if (attr instanceof Array) {\n    // loop through array and get all values\n    return attr.reduce((last, curr) => {\n      last[curr] = this.attr(curr);\n      return last;\n    }, {});\n  } else if (typeof attr === 'object' && attr.constructor === Object) {\n    // apply every attribute individually if an object is passed\n    for (val in attr) this.attr(val, attr[val]);\n  } else if (val === null) {\n    // remove value\n    this.node.removeAttribute(attr);\n  } else if (val == null) {\n    // act as a getter if the first and only argument is not an object\n    val = this.node.getAttribute(attr);\n    return val == null ? attrs[attr] : isNumber.test(val) ? parseFloat(val) : val;\n  } else {\n    // Loop through hooks and execute them to convert value\n    val = hooks.reduce((_val, hook) => {\n      return hook(attr, _val, this);\n    }, val);\n\n    // ensure correct numeric values (also accepts NaN and Infinity)\n    if (typeof val === 'number') {\n      val = new SVGNumber(val);\n    } else if (colorAttributes.has(attr) && Color.isColor(val)) {\n      // ensure full hex color\n      val = new Color(val);\n    } else if (val.constructor === Array) {\n      // Check for plain arrays and parse array values\n      val = new SVGArray(val);\n    }\n\n    // if the passed attribute is leading...\n    if (attr === 'leading') {\n      // ... call the leading method instead\n      if (this.leading) {\n        this.leading(val);\n      }\n    } else {\n      // set given attribute on node\n      typeof ns === 'string' ? this.node.setAttributeNS(ns, attr, val.toString()) : this.node.setAttribute(attr, val.toString());\n    }\n\n    // rebuild if required\n    if (this.rebuild && (attr === 'font-size' || attr === 'x')) {\n      this.rebuild();\n    }\n  }\n  return this;\n}\n\nclass Dom extends EventTarget {\n  constructor(node, attrs) {\n    super();\n    this.node = node;\n    this.type = node.nodeName;\n    if (attrs && node !== attrs) {\n      this.attr(attrs);\n    }\n  }\n\n  // Add given element at a position\n  add(element, i) {\n    element = makeInstance(element);\n\n    // If non-root svg nodes are added we have to remove their namespaces\n    if (element.removeNamespace && this.node instanceof globals.window.SVGElement) {\n      element.removeNamespace();\n    }\n    if (i == null) {\n      this.node.appendChild(element.node);\n    } else if (element.node !== this.node.childNodes[i]) {\n      this.node.insertBefore(element.node, this.node.childNodes[i]);\n    }\n    return this;\n  }\n\n  // Add element to given container and return self\n  addTo(parent, i) {\n    return makeInstance(parent).put(this, i);\n  }\n\n  // Returns all child elements\n  children() {\n    return new List(map(this.node.children, function (node) {\n      return adopt(node);\n    }));\n  }\n\n  // Remove all elements in this container\n  clear() {\n    // remove children\n    while (this.node.hasChildNodes()) {\n      this.node.removeChild(this.node.lastChild);\n    }\n    return this;\n  }\n\n  // Clone element\n  clone(deep = true, assignNewIds = true) {\n    // write dom data to the dom so the clone can pickup the data\n    this.writeDataToDom();\n\n    // clone element\n    let nodeClone = this.node.cloneNode(deep);\n    if (assignNewIds) {\n      // assign new id\n      nodeClone = assignNewId(nodeClone);\n    }\n    return new this.constructor(nodeClone);\n  }\n\n  // Iterates over all children and invokes a given block\n  each(block, deep) {\n    const children = this.children();\n    let i, il;\n    for (i = 0, il = children.length; i < il; i++) {\n      block.apply(children[i], [i, children]);\n      if (deep) {\n        children[i].each(block, deep);\n      }\n    }\n    return this;\n  }\n  element(nodeName, attrs) {\n    return this.put(new Dom(create(nodeName), attrs));\n  }\n\n  // Get first child\n  first() {\n    return adopt(this.node.firstChild);\n  }\n\n  // Get a element at the given index\n  get(i) {\n    return adopt(this.node.childNodes[i]);\n  }\n  getEventHolder() {\n    return this.node;\n  }\n  getEventTarget() {\n    return this.node;\n  }\n\n  // Checks if the given element is a child\n  has(element) {\n    return this.index(element) >= 0;\n  }\n  html(htmlOrFn, outerHTML) {\n    return this.xml(htmlOrFn, outerHTML, html);\n  }\n\n  // Get / set id\n  id(id) {\n    // generate new id if no id set\n    if (typeof id === 'undefined' && !this.node.id) {\n      this.node.id = eid(this.type);\n    }\n\n    // don't set directly with this.node.id to make `null` work correctly\n    return this.attr('id', id);\n  }\n\n  // Gets index of given element\n  index(element) {\n    return [].slice.call(this.node.childNodes).indexOf(element.node);\n  }\n\n  // Get the last child\n  last() {\n    return adopt(this.node.lastChild);\n  }\n\n  // matches the element vs a css selector\n  matches(selector) {\n    const el = this.node;\n    const matcher = el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector || null;\n    return matcher && matcher.call(el, selector);\n  }\n\n  // Returns the parent element instance\n  parent(type) {\n    let parent = this;\n\n    // check for parent\n    if (!parent.node.parentNode) return null;\n\n    // get parent element\n    parent = adopt(parent.node.parentNode);\n    if (!type) return parent;\n\n    // loop through ancestors if type is given\n    do {\n      if (typeof type === 'string' ? parent.matches(type) : parent instanceof type) return parent;\n    } while (parent = adopt(parent.node.parentNode));\n    return parent;\n  }\n\n  // Basically does the same as `add()` but returns the added element instead\n  put(element, i) {\n    element = makeInstance(element);\n    this.add(element, i);\n    return element;\n  }\n\n  // Add element to given container and return container\n  putIn(parent, i) {\n    return makeInstance(parent).add(this, i);\n  }\n\n  // Remove element\n  remove() {\n    if (this.parent()) {\n      this.parent().removeElement(this);\n    }\n    return this;\n  }\n\n  // Remove a given child\n  removeElement(element) {\n    this.node.removeChild(element.node);\n    return this;\n  }\n\n  // Replace this with element\n  replace(element) {\n    element = makeInstance(element);\n    if (this.node.parentNode) {\n      this.node.parentNode.replaceChild(element.node, this.node);\n    }\n    return element;\n  }\n  round(precision = 2, map = null) {\n    const factor = 10 ** precision;\n    const attrs = this.attr(map);\n    for (const i in attrs) {\n      if (typeof attrs[i] === 'number') {\n        attrs[i] = Math.round(attrs[i] * factor) / factor;\n      }\n    }\n    this.attr(attrs);\n    return this;\n  }\n\n  // Import / Export raw svg\n  svg(svgOrFn, outerSVG) {\n    return this.xml(svgOrFn, outerSVG, svg);\n  }\n\n  // Return id on string conversion\n  toString() {\n    return this.id();\n  }\n  words(text) {\n    // This is faster than removing all children and adding a new one\n    this.node.textContent = text;\n    return this;\n  }\n  wrap(node) {\n    const parent = this.parent();\n    if (!parent) {\n      return this.addTo(node);\n    }\n    const position = parent.index(this);\n    return parent.put(node, position).put(this);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    // dump variables recursively\n    this.each(function () {\n      this.writeDataToDom();\n    });\n    return this;\n  }\n\n  // Import / Export raw svg\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // act as getter if no svg string is given\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      // The default for exports is, that the outerNode is included\n      outerXML = outerXML == null ? true : outerXML;\n\n      // write svgjs data to the dom\n      this.writeDataToDom();\n      let current = this;\n\n      // An export modifier was passed\n      if (xmlOrFn != null) {\n        current = adopt(current.node.cloneNode(true));\n\n        // If the user wants outerHTML we need to process this node, too\n        if (outerXML) {\n          const result = xmlOrFn(current);\n          current = result || current;\n\n          // The user does not want this node? Well, then he gets nothing\n          if (result === false) return '';\n        }\n\n        // Deep loop through all children and apply modifier\n        current.each(function () {\n          const result = xmlOrFn(this);\n          const _this = result || this;\n\n          // If modifier returns false, discard node\n          if (result === false) {\n            this.remove();\n\n            // If modifier returns new node, use it\n          } else if (result && this !== _this) {\n            this.replace(_this);\n          }\n        }, true);\n      }\n\n      // Return outer or inner content\n      return outerXML ? current.node.outerHTML : current.node.innerHTML;\n    }\n\n    // Act as setter if we got a string\n\n    // The default for import is, that the current node is not replaced\n    outerXML = outerXML == null ? false : outerXML;\n\n    // Create temporary holder\n    const well = create('wrapper', ns);\n    const fragment = globals.document.createDocumentFragment();\n\n    // Dump raw svg\n    well.innerHTML = xmlOrFn;\n\n    // Transplant nodes into the fragment\n    for (let len = well.children.length; len--;) {\n      fragment.appendChild(well.firstElementChild);\n    }\n    const parent = this.parent();\n\n    // Add the whole fragment at once\n    return outerXML ? this.replace(fragment) && parent : this.add(fragment);\n  }\n}\nextend(Dom, {\n  attr,\n  find,\n  findOne\n});\nregister(Dom, 'Dom');\n\nclass Element extends Dom {\n  constructor(node, attrs) {\n    super(node, attrs);\n\n    // initialize data object\n    this.dom = {};\n\n    // create circular reference\n    this.node.instance = this;\n    if (node.hasAttribute('data-svgjs') || node.hasAttribute('svgjs:data')) {\n      // pull svgjs data from the dom (getAttributeNS doesn't work in html5)\n      this.setData(JSON.parse(node.getAttribute('data-svgjs')) ?? JSON.parse(node.getAttribute('svgjs:data')) ?? {});\n    }\n  }\n\n  // Move element by its center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  }\n\n  // Move by center over x-axis\n  cx(x) {\n    return x == null ? this.x() + this.width() / 2 : this.x(x - this.width() / 2);\n  }\n\n  // Move by center over y-axis\n  cy(y) {\n    return y == null ? this.y() + this.height() / 2 : this.y(y - this.height() / 2);\n  }\n\n  // Get defs\n  defs() {\n    const root = this.root();\n    return root && root.defs();\n  }\n\n  // Relative move over x and y axes\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  }\n\n  // Relative move over x axis\n  dx(x = 0) {\n    return this.x(new SVGNumber(x).plus(this.x()));\n  }\n\n  // Relative move over y axis\n  dy(y = 0) {\n    return this.y(new SVGNumber(y).plus(this.y()));\n  }\n  getEventHolder() {\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('height', height);\n  }\n\n  // Move element to given x and y values\n  move(x, y) {\n    return this.x(x).y(y);\n  }\n\n  // return array of all ancestors of given type up to the root svg\n  parents(until = this.root()) {\n    const isSelector = typeof until === 'string';\n    if (!isSelector) {\n      until = makeInstance(until);\n    }\n    const parents = new List();\n    let parent = this;\n    while ((parent = parent.parent()) && parent.node !== globals.document && parent.nodeName !== '#document-fragment') {\n      parents.push(parent);\n      if (!isSelector && parent.node === until.node) {\n        break;\n      }\n      if (isSelector && parent.matches(until)) {\n        break;\n      }\n      if (parent.node === this.root().node) {\n        // We worked our way to the root and didn't match `until`\n        return null;\n      }\n    }\n    return parents;\n  }\n\n  // Get referenced element form attribute value\n  reference(attr) {\n    attr = this.attr(attr);\n    if (!attr) return null;\n    const m = (attr + '').match(reference);\n    return m ? makeInstance(m[1]) : null;\n  }\n\n  // Get parent document\n  root() {\n    const p = this.parent(getClass(root));\n    return p && p.root();\n  }\n\n  // set given data to the elements data property\n  setData(o) {\n    this.dom = o;\n    return this;\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.width(new SVGNumber(p.width)).height(new SVGNumber(p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('width', width);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    writeDataToDom(this, this.dom);\n    return super.writeDataToDom();\n  }\n\n  // Move over x-axis\n  x(x) {\n    return this.attr('x', x);\n  }\n\n  // Move over y-axis\n  y(y) {\n    return this.attr('y', y);\n  }\n}\nextend(Element, {\n  bbox,\n  rbox,\n  inside,\n  point,\n  ctm,\n  screenCTM\n});\nregister(Element, 'Element');\n\n// Define list of available attributes for stroke and fill\nconst sugar = {\n  stroke: ['color', 'width', 'opacity', 'linecap', 'linejoin', 'miterlimit', 'dasharray', 'dashoffset'],\n  fill: ['color', 'opacity', 'rule'],\n  prefix: function (t, a) {\n    return a === 'color' ? t : t + '-' + a;\n  }\n}\n\n// Add sugar for fill and stroke\n;\n['fill', 'stroke'].forEach(function (m) {\n  const extension = {};\n  let i;\n  extension[m] = function (o) {\n    if (typeof o === 'undefined') {\n      return this.attr(m);\n    }\n    if (typeof o === 'string' || o instanceof Color || Color.isRgb(o) || o instanceof Element) {\n      this.attr(m, o);\n    } else {\n      // set all attributes from sugar.fill and sugar.stroke list\n      for (i = sugar[m].length - 1; i >= 0; i--) {\n        if (o[sugar[m][i]] != null) {\n          this.attr(sugar.prefix(m, sugar[m][i]), o[sugar[m][i]]);\n        }\n      }\n    }\n    return this;\n  };\n  registerMethods(['Element', 'Runner'], extension);\n});\nregisterMethods(['Element', 'Runner'], {\n  // Let the user set the matrix directly\n  matrix: function (mat, b, c, d, e, f) {\n    // Act as a getter\n    if (mat == null) {\n      return new Matrix(this);\n    }\n\n    // Act as a setter, the user can pass a matrix or a set of numbers\n    return this.attr('transform', new Matrix(mat, b, c, d, e, f));\n  },\n  // Map rotation to transform\n  rotate: function (angle, cx, cy) {\n    return this.transform({\n      rotate: angle,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map skew to transform\n  skew: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      skew: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      skew: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  shear: function (lam, cx, cy) {\n    return this.transform({\n      shear: lam,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map scale to transform\n  scale: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      scale: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      scale: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map translate to transform\n  translate: function (x, y) {\n    return this.transform({\n      translate: [x, y]\n    }, true);\n  },\n  // Map relative translations to transform\n  relative: function (x, y) {\n    return this.transform({\n      relative: [x, y]\n    }, true);\n  },\n  // Map flip to transform\n  flip: function (direction = 'both', origin = 'center') {\n    if ('xybothtrue'.indexOf(direction) === -1) {\n      origin = direction;\n      direction = 'both';\n    }\n    return this.transform({\n      flip: direction,\n      origin: origin\n    }, true);\n  },\n  // Opacity\n  opacity: function (value) {\n    return this.attr('opacity', value);\n  }\n});\nregisterMethods('radius', {\n  // Add x and y radius\n  radius: function (x, y = x) {\n    const type = (this._element || this).type;\n    return type === 'radialGradient' ? this.attr('r', new SVGNumber(x)) : this.rx(x).ry(y);\n  }\n});\nregisterMethods('Path', {\n  // Get path length\n  length: function () {\n    return this.node.getTotalLength();\n  },\n  // Get point at length\n  pointAt: function (length) {\n    return new Point(this.node.getPointAtLength(length));\n  }\n});\nregisterMethods(['Element', 'Runner'], {\n  // Set font\n  font: function (a, v) {\n    if (typeof a === 'object') {\n      for (v in a) this.font(v, a[v]);\n      return this;\n    }\n    return a === 'leading' ? this.leading(v) : a === 'anchor' ? this.attr('text-anchor', v) : a === 'size' || a === 'family' || a === 'weight' || a === 'stretch' || a === 'variant' || a === 'style' ? this.attr('font-' + a, v) : this.attr(a, v);\n  }\n});\n\n// Add events to elements\nconst methods = ['click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'mousemove', 'mouseenter', 'mouseleave', 'touchstart', 'touchmove', 'touchleave', 'touchend', 'touchcancel', 'contextmenu', 'wheel', 'pointerdown', 'pointermove', 'pointerup', 'pointerleave', 'pointercancel'].reduce(function (last, event) {\n  // add event to Element\n  const fn = function (f) {\n    if (f === null) {\n      this.off(event);\n    } else {\n      this.on(event, f);\n    }\n    return this;\n  };\n  last[event] = fn;\n  return last;\n}, {});\nregisterMethods('Element', methods);\n\n// Reset all transformations\nfunction untransform() {\n  return this.attr('transform', null);\n}\n\n// merge the whole transformation chain into one matrix and returns it\nfunction matrixify() {\n  const matrix = (this.attr('transform') || ''\n  // split transformations\n  ).split(transforms).slice(0, -1).map(function (str) {\n    // generate key => value pairs\n    const kv = str.trim().split('(');\n    return [kv[0], kv[1].split(delimiter).map(function (str) {\n      return parseFloat(str);\n    })];\n  }).reverse()\n  // merge every transformation into one matrix\n  .reduce(function (matrix, transform) {\n    if (transform[0] === 'matrix') {\n      return matrix.lmultiply(Matrix.fromArray(transform[1]));\n    }\n    return matrix[transform[0]].apply(matrix, transform[1]);\n  }, new Matrix());\n  return matrix;\n}\n\n// add an element to another parent without changing the visual representation on the screen\nfunction toParent(parent, i) {\n  if (this === parent) return this;\n  if (isDescriptive(this.node)) return this.addTo(parent, i);\n  const ctm = this.screenCTM();\n  const pCtm = parent.screenCTM().inverse();\n  this.addTo(parent, i).untransform().transform(pCtm.multiply(ctm));\n  return this;\n}\n\n// same as above with parent equals root-svg\nfunction toRoot(i) {\n  return this.toParent(this.root(), i);\n}\n\n// Add transformations\nfunction transform(o, relative) {\n  // Act as a getter if no object was passed\n  if (o == null || typeof o === 'string') {\n    const decomposed = new Matrix(this).decompose();\n    return o == null ? decomposed : decomposed[o];\n  }\n  if (!Matrix.isMatrixLike(o)) {\n    // Set the origin according to the defined transform\n    o = {\n      ...o,\n      origin: getOrigin(o, this)\n    };\n  }\n\n  // The user can pass a boolean, an Element or an Matrix or nothing\n  const cleanRelative = relative === true ? this : relative || false;\n  const result = new Matrix(cleanRelative).transform(o);\n  return this.attr('transform', result);\n}\nregisterMethods('Element', {\n  untransform,\n  matrixify,\n  toParent,\n  toRoot,\n  transform\n});\n\nclass Container extends Element {\n  flatten() {\n    this.each(function () {\n      if (this instanceof Container) {\n        return this.flatten().ungroup();\n      }\n    });\n    return this;\n  }\n  ungroup(parent = this.parent(), index = parent.index(this)) {\n    // when parent != this, we want append all elements to the end\n    index = index === -1 ? parent.children().length : index;\n    this.each(function (i, children) {\n      // reverse each\n      return children[children.length - i - 1].toParent(parent, index);\n    });\n    return this.remove();\n  }\n}\nregister(Container, 'Container');\n\nclass Defs extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('defs', node), attrs);\n  }\n  flatten() {\n    return this;\n  }\n  ungroup() {\n    return this;\n  }\n}\nregister(Defs, 'Defs');\n\nclass Shape extends Element {}\nregister(Shape, 'Shape');\n\n// Radius x value\nfunction rx(rx) {\n  return this.attr('rx', rx);\n}\n\n// Radius y value\nfunction ry(ry) {\n  return this.attr('ry', ry);\n}\n\n// Move over x-axis\nfunction x$3(x) {\n  return x == null ? this.cx() - this.rx() : this.cx(x + this.rx());\n}\n\n// Move over y-axis\nfunction y$3(y) {\n  return y == null ? this.cy() - this.ry() : this.cy(y + this.ry());\n}\n\n// Move by center over x-axis\nfunction cx$1(x) {\n  return this.attr('cx', x);\n}\n\n// Move by center over y-axis\nfunction cy$1(y) {\n  return this.attr('cy', y);\n}\n\n// Set width of element\nfunction width$2(width) {\n  return width == null ? this.rx() * 2 : this.rx(new SVGNumber(width).divide(2));\n}\n\n// Set height of element\nfunction height$2(height) {\n  return height == null ? this.ry() * 2 : this.ry(new SVGNumber(height).divide(2));\n}\n\nvar circled = {\n  __proto__: null,\n  cx: cx$1,\n  cy: cy$1,\n  height: height$2,\n  rx: rx,\n  ry: ry,\n  width: width$2,\n  x: x$3,\n  y: y$3\n};\n\nclass Ellipse extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('ellipse', node), attrs);\n  }\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.rx(new SVGNumber(p.width).divide(2)).ry(new SVGNumber(p.height).divide(2));\n  }\n}\nextend(Ellipse, circled);\nregisterMethods('Container', {\n  // Create an ellipse\n  ellipse: wrapWithAttrCheck(function (width = 0, height = width) {\n    return this.put(new Ellipse()).size(width, height).move(0, 0);\n  })\n});\nregister(Ellipse, 'Ellipse');\n\nclass Fragment extends Dom {\n  constructor(node = globals.document.createDocumentFragment()) {\n    super(node);\n  }\n\n  // Import / Export raw xml\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // because this is a fragment we have to put all elements into a wrapper first\n    // before we can get the innerXML from it\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      const wrapper = new Dom(create('wrapper', ns));\n      wrapper.add(this.node.cloneNode(true));\n      return wrapper.xml(false, ns);\n    }\n\n    // Act as setter if we got a string\n    return super.xml(xmlOrFn, false, ns);\n  }\n}\nregister(Fragment, 'Fragment');\n\nfunction from(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    fx: new SVGNumber(x),\n    fy: new SVGNumber(y)\n  }) : this.attr({\n    x1: new SVGNumber(x),\n    y1: new SVGNumber(y)\n  });\n}\nfunction to(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    cx: new SVGNumber(x),\n    cy: new SVGNumber(y)\n  }) : this.attr({\n    x2: new SVGNumber(x),\n    y2: new SVGNumber(y)\n  });\n}\n\nvar gradiented = {\n  __proto__: null,\n  from: from,\n  to: to\n};\n\nclass Gradient extends Container {\n  constructor(type, attrs) {\n    super(nodeOrNew(type + 'Gradient', typeof type === 'string' ? null : type), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'gradientTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update gradient\n  update(block) {\n    // remove all stops\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nextend(Gradient, gradiented);\nregisterMethods({\n  Container: {\n    // Create gradient element in defs\n    gradient(...args) {\n      return this.defs().gradient(...args);\n    }\n  },\n  // define gradient\n  Defs: {\n    gradient: wrapWithAttrCheck(function (type, block) {\n      return this.put(new Gradient(type)).update(block);\n    })\n  }\n});\nregister(Gradient, 'Gradient');\n\nclass Pattern extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('pattern', node), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'patternTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update pattern by rebuilding\n  update(block) {\n    // remove content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nregisterMethods({\n  Container: {\n    // Create pattern element in defs\n    pattern(...args) {\n      return this.defs().pattern(...args);\n    }\n  },\n  Defs: {\n    pattern: wrapWithAttrCheck(function (width, height, block) {\n      return this.put(new Pattern()).update(block).attr({\n        x: 0,\n        y: 0,\n        width: width,\n        height: height,\n        patternUnits: 'userSpaceOnUse'\n      });\n    })\n  }\n});\nregister(Pattern, 'Pattern');\n\nclass Image extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('image', node), attrs);\n  }\n\n  // (re)load image\n  load(url, callback) {\n    if (!url) return this;\n    const img = new globals.window.Image();\n    on(img, 'load', function (e) {\n      const p = this.parent(Pattern);\n\n      // ensure image size\n      if (this.width() === 0 && this.height() === 0) {\n        this.size(img.width, img.height);\n      }\n      if (p instanceof Pattern) {\n        // ensure pattern size if not set\n        if (p.width() === 0 && p.height() === 0) {\n          p.size(this.width(), this.height());\n        }\n      }\n      if (typeof callback === 'function') {\n        callback.call(this, e);\n      }\n    }, this);\n    on(img, 'load error', function () {\n      // dont forget to unbind memory leaking events\n      off(img);\n    });\n    return this.attr('href', img.src = url, xlink);\n  }\n}\nregisterAttrHook(function (attr, val, _this) {\n  // convert image fill and stroke to patterns\n  if (attr === 'fill' || attr === 'stroke') {\n    if (isImage.test(val)) {\n      val = _this.root().defs().image(val);\n    }\n  }\n  if (val instanceof Image) {\n    val = _this.root().defs().pattern(0, 0, pattern => {\n      pattern.add(val);\n    });\n  }\n  return val;\n});\nregisterMethods({\n  Container: {\n    // create image element, load image and set its size\n    image: wrapWithAttrCheck(function (source, callback) {\n      return this.put(new Image()).size(0, 0).load(source, callback);\n    })\n  }\n});\nregister(Image, 'Image');\n\nclass PointArray extends SVGArray {\n  // Get bounding box of points\n  bbox() {\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    let minX = Infinity;\n    let minY = Infinity;\n    this.forEach(function (el) {\n      maxX = Math.max(el[0], maxX);\n      maxY = Math.max(el[1], maxY);\n      minX = Math.min(el[0], minX);\n      minY = Math.min(el[1], minY);\n    });\n    return new Box(minX, minY, maxX - minX, maxY - minY);\n  }\n\n  // Move point string\n  move(x, y) {\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n\n    // move every point\n    if (!isNaN(x) && !isNaN(y)) {\n      for (let i = this.length - 1; i >= 0; i--) {\n        this[i] = [this[i][0] + x, this[i][1] + y];\n      }\n    }\n    return this;\n  }\n\n  // Parse point string and flat array\n  parse(array = [0, 0]) {\n    const points = [];\n\n    // if it is an array, we flatten it and therefore clone it to 1 depths\n    if (array instanceof Array) {\n      array = Array.prototype.concat.apply([], array);\n    } else {\n      // Else, it is considered as a string\n      // parse points\n      array = array.trim().split(delimiter).map(parseFloat);\n    }\n\n    // validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints\n    // Odd number of coordinates is an error. In such cases, drop the last odd coordinate.\n    if (array.length % 2 !== 0) array.pop();\n\n    // wrap points in two-tuples\n    for (let i = 0, len = array.length; i < len; i = i + 2) {\n      points.push([array[i], array[i + 1]]);\n    }\n    return points;\n  }\n\n  // Resize poly string\n  size(width, height) {\n    let i;\n    const box = this.bbox();\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      if (box.width) this[i][0] = (this[i][0] - box.x) * width / box.width + box.x;\n      if (box.height) this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n    }\n    return this;\n  }\n\n  // Convert array to line object\n  toLine() {\n    return {\n      x1: this[0][0],\n      y1: this[0][1],\n      x2: this[1][0],\n      y2: this[1][1]\n    };\n  }\n\n  // Convert array to string\n  toString() {\n    const array = [];\n    // convert to a poly point string\n    for (let i = 0, il = this.length; i < il; i++) {\n      array.push(this[i].join(','));\n    }\n    return array.join(' ');\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // transform points with matrix (similar to Point.transform)\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    for (let i = this.length; i--;) {\n      // Perform the matrix multiplication\n      const [x, y] = this[i];\n      this[i][0] = m.a * x + m.c * y + m.e;\n      this[i][1] = m.b * x + m.d * y + m.f;\n    }\n    return this;\n  }\n}\n\nconst MorphArray = PointArray;\n\n// Move by left top corner over x-axis\nfunction x$2(x) {\n  return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n}\n\n// Move by left top corner over y-axis\nfunction y$2(y) {\n  return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n}\n\n// Set width of element\nfunction width$1(width) {\n  const b = this.bbox();\n  return width == null ? b.width : this.size(width, b.height);\n}\n\n// Set height of element\nfunction height$1(height) {\n  const b = this.bbox();\n  return height == null ? b.height : this.size(b.width, height);\n}\n\nvar pointed = {\n  __proto__: null,\n  MorphArray: MorphArray,\n  height: height$1,\n  width: width$1,\n  x: x$2,\n  y: y$2\n};\n\nclass Line extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('line', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return new PointArray([[this.attr('x1'), this.attr('y1')], [this.attr('x2'), this.attr('y2')]]);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr(this.array().move(x, y).toLine());\n  }\n\n  // Overwrite native plot() method\n  plot(x1, y1, x2, y2) {\n    if (x1 == null) {\n      return this.array();\n    } else if (typeof y1 !== 'undefined') {\n      x1 = {\n        x1,\n        y1,\n        x2,\n        y2\n      };\n    } else {\n      x1 = new PointArray(x1).toLine();\n    }\n    return this.attr(x1);\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr(this.array().size(p.width, p.height).toLine());\n  }\n}\nextend(Line, pointed);\nregisterMethods({\n  Container: {\n    // Create a line element\n    line: wrapWithAttrCheck(function (...args) {\n      // make sure plot is called as a setter\n      // x1 is not necessarily a number, it can also be an array, a string and a PointArray\n      return Line.prototype.plot.apply(this.put(new Line()), args[0] != null ? args : [0, 0, 0, 0]);\n    })\n  }\n});\nregister(Line, 'Line');\n\nclass Marker extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('marker', node), attrs);\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('markerHeight', height);\n  }\n  orient(orient) {\n    return this.attr('orient', orient);\n  }\n\n  // Set marker refX and refY\n  ref(x, y) {\n    return this.attr('refX', x).attr('refY', y);\n  }\n\n  // Return the fill id\n  toString() {\n    return 'url(#' + this.id() + ')';\n  }\n\n  // Update marker\n  update(block) {\n    // remove all content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('markerWidth', width);\n  }\n}\nregisterMethods({\n  Container: {\n    marker(...args) {\n      // Create marker element in defs\n      return this.defs().marker(...args);\n    }\n  },\n  Defs: {\n    // Create marker\n    marker: wrapWithAttrCheck(function (width, height, block) {\n      // Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto\n      return this.put(new Marker()).size(width, height).ref(width / 2, height / 2).viewbox(0, 0, width, height).attr('orient', 'auto').update(block);\n    })\n  },\n  marker: {\n    // Create and attach markers\n    marker(marker, width, height, block) {\n      let attr = ['marker'];\n\n      // Build attribute name\n      if (marker !== 'all') attr.push(marker);\n      attr = attr.join('-');\n\n      // Set marker attribute\n      marker = arguments[1] instanceof Marker ? arguments[1] : this.defs().marker(width, height, block);\n      return this.attr(attr, marker);\n    }\n  }\n});\nregister(Marker, 'Marker');\n\n/***\nBase Class\n==========\nThe base stepper class that will be\n***/\n\nfunction makeSetterGetter(k, f) {\n  return function (v) {\n    if (v == null) return this[k];\n    this[k] = v;\n    if (f) f.call(this);\n    return this;\n  };\n}\nconst easing = {\n  '-': function (pos) {\n    return pos;\n  },\n  '<>': function (pos) {\n    return -Math.cos(pos * Math.PI) / 2 + 0.5;\n  },\n  '>': function (pos) {\n    return Math.sin(pos * Math.PI / 2);\n  },\n  '<': function (pos) {\n    return -Math.cos(pos * Math.PI / 2) + 1;\n  },\n  bezier: function (x1, y1, x2, y2) {\n    // see https://www.w3.org/TR/css-easing-1/#cubic-bezier-algo\n    return function (t) {\n      if (t < 0) {\n        if (x1 > 0) {\n          return y1 / x1 * t;\n        } else if (x2 > 0) {\n          return y2 / x2 * t;\n        } else {\n          return 0;\n        }\n      } else if (t > 1) {\n        if (x2 < 1) {\n          return (1 - y2) / (1 - x2) * t + (y2 - x2) / (1 - x2);\n        } else if (x1 < 1) {\n          return (1 - y1) / (1 - x1) * t + (y1 - x1) / (1 - x1);\n        } else {\n          return 1;\n        }\n      } else {\n        return 3 * t * (1 - t) ** 2 * y1 + 3 * t ** 2 * (1 - t) * y2 + t ** 3;\n      }\n    };\n  },\n  // see https://www.w3.org/TR/css-easing-1/#step-timing-function-algo\n  steps: function (steps, stepPosition = 'end') {\n    // deal with \"jump-\" prefix\n    stepPosition = stepPosition.split('-').reverse()[0];\n    let jumps = steps;\n    if (stepPosition === 'none') {\n      --jumps;\n    } else if (stepPosition === 'both') {\n      ++jumps;\n    }\n\n    // The beforeFlag is essentially useless\n    return (t, beforeFlag = false) => {\n      // Step is called currentStep in referenced url\n      let step = Math.floor(t * steps);\n      const jumping = t * step % 1 === 0;\n      if (stepPosition === 'start' || stepPosition === 'both') {\n        ++step;\n      }\n      if (beforeFlag && jumping) {\n        --step;\n      }\n      if (t >= 0 && step < 0) {\n        step = 0;\n      }\n      if (t <= 1 && step > jumps) {\n        step = jumps;\n      }\n      return step / jumps;\n    };\n  }\n};\nclass Stepper {\n  done() {\n    return false;\n  }\n}\n\n/***\nEasing Functions\n================\n***/\n\nclass Ease extends Stepper {\n  constructor(fn = timeline.ease) {\n    super();\n    this.ease = easing[fn] || fn;\n  }\n  step(from, to, pos) {\n    if (typeof from !== 'number') {\n      return pos < 1 ? from : to;\n    }\n    return from + (to - from) * this.ease(pos);\n  }\n}\n\n/***\nController Types\n================\n***/\n\nclass Controller extends Stepper {\n  constructor(fn) {\n    super();\n    this.stepper = fn;\n  }\n  done(c) {\n    return c.done;\n  }\n  step(current, target, dt, c) {\n    return this.stepper(current, target, dt, c);\n  }\n}\nfunction recalculate() {\n  // Apply the default parameters\n  const duration = (this._duration || 500) / 1000;\n  const overshoot = this._overshoot || 0;\n\n  // Calculate the PID natural response\n  const eps = 1e-10;\n  const pi = Math.PI;\n  const os = Math.log(overshoot / 100 + eps);\n  const zeta = -os / Math.sqrt(pi * pi + os * os);\n  const wn = 3.9 / (zeta * duration);\n\n  // Calculate the Spring values\n  this.d = 2 * zeta * wn;\n  this.k = wn * wn;\n}\nclass Spring extends Controller {\n  constructor(duration = 500, overshoot = 0) {\n    super();\n    this.duration(duration).overshoot(overshoot);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    if (dt > 100) dt = 16;\n    dt /= 1000;\n\n    // Get the previous velocity\n    const velocity = c.velocity || 0;\n\n    // Apply the control to get the new position and store it\n    const acceleration = -this.d * velocity - this.k * (current - target);\n    const newPosition = current + velocity * dt + acceleration * dt * dt / 2;\n\n    // Store the velocity\n    c.velocity = velocity + acceleration * dt;\n\n    // Figure out if we have converged, and if so, pass the value\n    c.done = Math.abs(target - newPosition) + Math.abs(velocity) < 0.002;\n    return c.done ? target : newPosition;\n  }\n}\nextend(Spring, {\n  duration: makeSetterGetter('_duration', recalculate),\n  overshoot: makeSetterGetter('_overshoot', recalculate)\n});\nclass PID extends Controller {\n  constructor(p = 0.1, i = 0.01, d = 0, windup = 1000) {\n    super();\n    this.p(p).i(i).d(d).windup(windup);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    const p = target - current;\n    let i = (c.integral || 0) + p * dt;\n    const d = (p - (c.error || 0)) / dt;\n    const windup = this._windup;\n\n    // antiwindup\n    if (windup !== false) {\n      i = Math.max(-windup, Math.min(i, windup));\n    }\n    c.error = p;\n    c.integral = i;\n    c.done = Math.abs(p) < 0.001;\n    return c.done ? target : current + (this.P * p + this.I * i + this.D * d);\n  }\n}\nextend(PID, {\n  windup: makeSetterGetter('_windup'),\n  p: makeSetterGetter('P'),\n  i: makeSetterGetter('I'),\n  d: makeSetterGetter('D')\n});\n\nconst segmentParameters = {\n  M: 2,\n  L: 2,\n  H: 1,\n  V: 1,\n  C: 6,\n  S: 4,\n  Q: 4,\n  T: 2,\n  A: 7,\n  Z: 0\n};\nconst pathHandlers = {\n  M: function (c, p, p0) {\n    p.x = p0.x = c[0];\n    p.y = p0.y = c[1];\n    return ['M', p.x, p.y];\n  },\n  L: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['L', c[0], c[1]];\n  },\n  H: function (c, p) {\n    p.x = c[0];\n    return ['H', c[0]];\n  },\n  V: function (c, p) {\n    p.y = c[0];\n    return ['V', c[0]];\n  },\n  C: function (c, p) {\n    p.x = c[4];\n    p.y = c[5];\n    return ['C', c[0], c[1], c[2], c[3], c[4], c[5]];\n  },\n  S: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['S', c[0], c[1], c[2], c[3]];\n  },\n  Q: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['Q', c[0], c[1], c[2], c[3]];\n  },\n  T: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['T', c[0], c[1]];\n  },\n  Z: function (c, p, p0) {\n    p.x = p0.x;\n    p.y = p0.y;\n    return ['Z'];\n  },\n  A: function (c, p) {\n    p.x = c[5];\n    p.y = c[6];\n    return ['A', c[0], c[1], c[2], c[3], c[4], c[5], c[6]];\n  }\n};\nconst mlhvqtcsaz = 'mlhvqtcsaz'.split('');\nfor (let i = 0, il = mlhvqtcsaz.length; i < il; ++i) {\n  pathHandlers[mlhvqtcsaz[i]] = function (i) {\n    return function (c, p, p0) {\n      if (i === 'H') c[0] = c[0] + p.x;else if (i === 'V') c[0] = c[0] + p.y;else if (i === 'A') {\n        c[5] = c[5] + p.x;\n        c[6] = c[6] + p.y;\n      } else {\n        for (let j = 0, jl = c.length; j < jl; ++j) {\n          c[j] = c[j] + (j % 2 ? p.y : p.x);\n        }\n      }\n      return pathHandlers[i](c, p, p0);\n    };\n  }(mlhvqtcsaz[i].toUpperCase());\n}\nfunction makeAbsolut(parser) {\n  const command = parser.segment[0];\n  return pathHandlers[command](parser.segment.slice(1), parser.p, parser.p0);\n}\nfunction segmentComplete(parser) {\n  return parser.segment.length && parser.segment.length - 1 === segmentParameters[parser.segment[0].toUpperCase()];\n}\nfunction startNewSegment(parser, token) {\n  parser.inNumber && finalizeNumber(parser, false);\n  const pathLetter = isPathLetter.test(token);\n  if (pathLetter) {\n    parser.segment = [token];\n  } else {\n    const lastCommand = parser.lastCommand;\n    const small = lastCommand.toLowerCase();\n    const isSmall = lastCommand === small;\n    parser.segment = [small === 'm' ? isSmall ? 'l' : 'L' : lastCommand];\n  }\n  parser.inSegment = true;\n  parser.lastCommand = parser.segment[0];\n  return pathLetter;\n}\nfunction finalizeNumber(parser, inNumber) {\n  if (!parser.inNumber) throw new Error('Parser Error');\n  parser.number && parser.segment.push(parseFloat(parser.number));\n  parser.inNumber = inNumber;\n  parser.number = '';\n  parser.pointSeen = false;\n  parser.hasExponent = false;\n  if (segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n}\nfunction finalizeSegment(parser) {\n  parser.inSegment = false;\n  if (parser.absolute) {\n    parser.segment = makeAbsolut(parser);\n  }\n  parser.segments.push(parser.segment);\n}\nfunction isArcFlag(parser) {\n  if (!parser.segment.length) return false;\n  const isArc = parser.segment[0].toUpperCase() === 'A';\n  const length = parser.segment.length;\n  return isArc && (length === 4 || length === 5);\n}\nfunction isExponential(parser) {\n  return parser.lastToken.toUpperCase() === 'E';\n}\nconst pathDelimiters = new Set([' ', ',', '\\t', '\\n', '\\r', '\\f']);\nfunction pathParser(d, toAbsolute = true) {\n  let index = 0;\n  let token = '';\n  const parser = {\n    segment: [],\n    inNumber: false,\n    number: '',\n    lastToken: '',\n    inSegment: false,\n    segments: [],\n    pointSeen: false,\n    hasExponent: false,\n    absolute: toAbsolute,\n    p0: new Point(),\n    p: new Point()\n  };\n  while (parser.lastToken = token, token = d.charAt(index++)) {\n    if (!parser.inSegment) {\n      if (startNewSegment(parser, token)) {\n        continue;\n      }\n    }\n    if (token === '.') {\n      if (parser.pointSeen || parser.hasExponent) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.inNumber = true;\n      parser.pointSeen = true;\n      parser.number += token;\n      continue;\n    }\n    if (!isNaN(parseInt(token))) {\n      if (parser.number === '0' || isArcFlag(parser)) {\n        parser.inNumber = true;\n        parser.number = token;\n        finalizeNumber(parser, true);\n        continue;\n      }\n      parser.inNumber = true;\n      parser.number += token;\n      continue;\n    }\n    if (pathDelimiters.has(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      }\n      continue;\n    }\n    if (token === '-' || token === '+') {\n      if (parser.inNumber && !isExponential(parser)) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.number += token;\n      parser.inNumber = true;\n      continue;\n    }\n    if (token.toUpperCase() === 'E') {\n      parser.number += token;\n      parser.hasExponent = true;\n      continue;\n    }\n    if (isPathLetter.test(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      } else if (!segmentComplete(parser)) {\n        throw new Error('parser Error');\n      } else {\n        finalizeSegment(parser);\n      }\n      --index;\n    }\n  }\n  if (parser.inNumber) {\n    finalizeNumber(parser, false);\n  }\n  if (parser.inSegment && segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n  return parser.segments;\n}\n\nfunction arrayToString(a) {\n  let s = '';\n  for (let i = 0, il = a.length; i < il; i++) {\n    s += a[i][0];\n    if (a[i][1] != null) {\n      s += a[i][1];\n      if (a[i][2] != null) {\n        s += ' ';\n        s += a[i][2];\n        if (a[i][3] != null) {\n          s += ' ';\n          s += a[i][3];\n          s += ' ';\n          s += a[i][4];\n          if (a[i][5] != null) {\n            s += ' ';\n            s += a[i][5];\n            s += ' ';\n            s += a[i][6];\n            if (a[i][7] != null) {\n              s += ' ';\n              s += a[i][7];\n            }\n          }\n        }\n      }\n    }\n  }\n  return s + ' ';\n}\nclass PathArray extends SVGArray {\n  // Get bounding box of path\n  bbox() {\n    parser().path.setAttribute('d', this.toString());\n    return new Box(parser.nodes.path.getBBox());\n  }\n\n  // Move path string\n  move(x, y) {\n    // get bounding box of current situation\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n    if (!isNaN(x) && !isNaN(y)) {\n      // move every point\n      for (let l, i = this.length - 1; i >= 0; i--) {\n        l = this[i][0];\n        if (l === 'M' || l === 'L' || l === 'T') {\n          this[i][1] += x;\n          this[i][2] += y;\n        } else if (l === 'H') {\n          this[i][1] += x;\n        } else if (l === 'V') {\n          this[i][1] += y;\n        } else if (l === 'C' || l === 'S' || l === 'Q') {\n          this[i][1] += x;\n          this[i][2] += y;\n          this[i][3] += x;\n          this[i][4] += y;\n          if (l === 'C') {\n            this[i][5] += x;\n            this[i][6] += y;\n          }\n        } else if (l === 'A') {\n          this[i][6] += x;\n          this[i][7] += y;\n        }\n      }\n    }\n    return this;\n  }\n\n  // Absolutize and parse path to array\n  parse(d = 'M0 0') {\n    if (Array.isArray(d)) {\n      d = Array.prototype.concat.apply([], d).toString();\n    }\n    return pathParser(d);\n  }\n\n  // Resize path string\n  size(width, height) {\n    // get bounding box of current situation\n    const box = this.bbox();\n    let i, l;\n\n    // If the box width or height is 0 then we ignore\n    // transformations on the respective axis\n    box.width = box.width === 0 ? 1 : box.width;\n    box.height = box.height === 0 ? 1 : box.height;\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      l = this[i][0];\n      if (l === 'M' || l === 'L' || l === 'T') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n      } else if (l === 'H') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n      } else if (l === 'V') {\n        this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n      } else if (l === 'C' || l === 'S' || l === 'Q') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n        this[i][3] = (this[i][3] - box.x) * width / box.width + box.x;\n        this[i][4] = (this[i][4] - box.y) * height / box.height + box.y;\n        if (l === 'C') {\n          this[i][5] = (this[i][5] - box.x) * width / box.width + box.x;\n          this[i][6] = (this[i][6] - box.y) * height / box.height + box.y;\n        }\n      } else if (l === 'A') {\n        // resize radii\n        this[i][1] = this[i][1] * width / box.width;\n        this[i][2] = this[i][2] * height / box.height;\n\n        // move position values\n        this[i][6] = (this[i][6] - box.x) * width / box.width + box.x;\n        this[i][7] = (this[i][7] - box.y) * height / box.height + box.y;\n      }\n    }\n    return this;\n  }\n\n  // Convert array to string\n  toString() {\n    return arrayToString(this);\n  }\n}\n\nconst getClassForType = value => {\n  const type = typeof value;\n  if (type === 'number') {\n    return SVGNumber;\n  } else if (type === 'string') {\n    if (Color.isColor(value)) {\n      return Color;\n    } else if (delimiter.test(value)) {\n      return isPathLetter.test(value) ? PathArray : SVGArray;\n    } else if (numberAndUnit.test(value)) {\n      return SVGNumber;\n    } else {\n      return NonMorphable;\n    }\n  } else if (morphableTypes.indexOf(value.constructor) > -1) {\n    return value.constructor;\n  } else if (Array.isArray(value)) {\n    return SVGArray;\n  } else if (type === 'object') {\n    return ObjectBag;\n  } else {\n    return NonMorphable;\n  }\n};\nclass Morphable {\n  constructor(stepper) {\n    this._stepper = stepper || new Ease('-');\n    this._from = null;\n    this._to = null;\n    this._type = null;\n    this._context = null;\n    this._morphObj = null;\n  }\n  at(pos) {\n    return this._morphObj.morph(this._from, this._to, pos, this._stepper, this._context);\n  }\n  done() {\n    const complete = this._context.map(this._stepper.done).reduce(function (last, curr) {\n      return last && curr;\n    }, true);\n    return complete;\n  }\n  from(val) {\n    if (val == null) {\n      return this._from;\n    }\n    this._from = this._set(val);\n    return this;\n  }\n  stepper(stepper) {\n    if (stepper == null) return this._stepper;\n    this._stepper = stepper;\n    return this;\n  }\n  to(val) {\n    if (val == null) {\n      return this._to;\n    }\n    this._to = this._set(val);\n    return this;\n  }\n  type(type) {\n    // getter\n    if (type == null) {\n      return this._type;\n    }\n\n    // setter\n    this._type = type;\n    return this;\n  }\n  _set(value) {\n    if (!this._type) {\n      this.type(getClassForType(value));\n    }\n    let result = new this._type(value);\n    if (this._type === Color) {\n      result = this._to ? result[this._to[4]]() : this._from ? result[this._from[4]]() : result;\n    }\n    if (this._type === ObjectBag) {\n      result = this._to ? result.align(this._to) : this._from ? result.align(this._from) : result;\n    }\n    result = result.toConsumable();\n    this._morphObj = this._morphObj || new this._type();\n    this._context = this._context || Array.apply(null, Array(result.length)).map(Object).map(function (o) {\n      o.done = true;\n      return o;\n    });\n    return result;\n  }\n}\nclass NonMorphable {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(val) {\n    val = Array.isArray(val) ? val[0] : val;\n    this.value = val;\n    return this;\n  }\n  toArray() {\n    return [this.value];\n  }\n  valueOf() {\n    return this.value;\n  }\n}\nclass TransformBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(obj) {\n    if (Array.isArray(obj)) {\n      obj = {\n        scaleX: obj[0],\n        scaleY: obj[1],\n        shear: obj[2],\n        rotate: obj[3],\n        translateX: obj[4],\n        translateY: obj[5],\n        originX: obj[6],\n        originY: obj[7]\n      };\n    }\n    Object.assign(this, TransformBag.defaults, obj);\n    return this;\n  }\n  toArray() {\n    const v = this;\n    return [v.scaleX, v.scaleY, v.shear, v.rotate, v.translateX, v.translateY, v.originX, v.originY];\n  }\n}\nTransformBag.defaults = {\n  scaleX: 1,\n  scaleY: 1,\n  shear: 0,\n  rotate: 0,\n  translateX: 0,\n  translateY: 0,\n  originX: 0,\n  originY: 0\n};\nconst sortByKey = (a, b) => {\n  return a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0;\n};\nclass ObjectBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  align(other) {\n    const values = this.values;\n    for (let i = 0, il = values.length; i < il; ++i) {\n      // If the type is the same we only need to check if the color is in the correct format\n      if (values[i + 1] === other[i + 1]) {\n        if (values[i + 1] === Color && other[i + 7] !== values[i + 7]) {\n          const space = other[i + 7];\n          const color = new Color(this.values.splice(i + 3, 5))[space]().toArray();\n          this.values.splice(i + 3, 0, ...color);\n        }\n        i += values[i + 2] + 2;\n        continue;\n      }\n      if (!other[i + 1]) {\n        return this;\n      }\n\n      // The types differ, so we overwrite the new type with the old one\n      // And initialize it with the types default (e.g. black for color or 0 for number)\n      const defaultObject = new other[i + 1]().toArray();\n\n      // Than we fix the values array\n      const toDelete = values[i + 2] + 3;\n      values.splice(i, toDelete, other[i], other[i + 1], other[i + 2], ...defaultObject);\n      i += values[i + 2] + 2;\n    }\n    return this;\n  }\n  init(objOrArr) {\n    this.values = [];\n    if (Array.isArray(objOrArr)) {\n      this.values = objOrArr.slice();\n      return;\n    }\n    objOrArr = objOrArr || {};\n    const entries = [];\n    for (const i in objOrArr) {\n      const Type = getClassForType(objOrArr[i]);\n      const val = new Type(objOrArr[i]).toArray();\n      entries.push([i, Type, val.length, ...val]);\n    }\n    entries.sort(sortByKey);\n    this.values = entries.reduce((last, curr) => last.concat(curr), []);\n    return this;\n  }\n  toArray() {\n    return this.values;\n  }\n  valueOf() {\n    const obj = {};\n    const arr = this.values;\n\n    // for (var i = 0, len = arr.length; i < len; i += 2) {\n    while (arr.length) {\n      const key = arr.shift();\n      const Type = arr.shift();\n      const num = arr.shift();\n      const values = arr.splice(0, num);\n      obj[key] = new Type(values); // .valueOf()\n    }\n    return obj;\n  }\n}\nconst morphableTypes = [NonMorphable, TransformBag, ObjectBag];\nfunction registerMorphableType(type = []) {\n  morphableTypes.push(...[].concat(type));\n}\nfunction makeMorphable() {\n  extend(morphableTypes, {\n    to(val) {\n      return new Morphable().type(this.constructor).from(this.toArray()) // this.valueOf())\n      .to(val);\n    },\n    fromArray(arr) {\n      this.init(arr);\n      return this;\n    },\n    toConsumable() {\n      return this.toArray();\n    },\n    morph(from, to, pos, stepper, context) {\n      const mapper = function (i, index) {\n        return stepper.step(i, to[index], pos, context[index], context);\n      };\n      return this.fromArray(from.map(mapper));\n    }\n  });\n}\n\nclass Path extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('path', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return this._array || (this._array = new PathArray(this.attr('d')));\n  }\n\n  // Clear array cache\n  clear() {\n    delete this._array;\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return height == null ? this.bbox().height : this.size(this.bbox().width, height);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr('d', this.array().move(x, y));\n  }\n\n  // Plot new path\n  plot(d) {\n    return d == null ? this.array() : this.clear().attr('d', typeof d === 'string' ? d : this._array = new PathArray(d));\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr('d', this.array().size(p.width, p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return width == null ? this.bbox().width : this.size(width, this.bbox().height);\n  }\n\n  // Move by left top corner over x-axis\n  x(x) {\n    return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n  }\n\n  // Move by left top corner over y-axis\n  y(y) {\n    return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n  }\n}\n\n// Define morphable array\nPath.prototype.MorphArray = PathArray;\n\n// Add parent method\nregisterMethods({\n  Container: {\n    // Create a wrapped path element\n    path: wrapWithAttrCheck(function (d) {\n      // make sure plot is called as a setter\n      return this.put(new Path()).plot(d || new PathArray());\n    })\n  }\n});\nregister(Path, 'Path');\n\n// Get array\nfunction array() {\n  return this._array || (this._array = new PointArray(this.attr('points')));\n}\n\n// Clear array cache\nfunction clear() {\n  delete this._array;\n  return this;\n}\n\n// Move by left top corner\nfunction move$2(x, y) {\n  return this.attr('points', this.array().move(x, y));\n}\n\n// Plot new path\nfunction plot(p) {\n  return p == null ? this.array() : this.clear().attr('points', typeof p === 'string' ? p : this._array = new PointArray(p));\n}\n\n// Set element size to given width and height\nfunction size$1(width, height) {\n  const p = proportionalSize(this, width, height);\n  return this.attr('points', this.array().size(p.width, p.height));\n}\n\nvar poly = {\n  __proto__: null,\n  array: array,\n  clear: clear,\n  move: move$2,\n  plot: plot,\n  size: size$1\n};\n\nclass Polygon extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polygon', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polygon: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polygon()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polygon, pointed);\nextend(Polygon, poly);\nregister(Polygon, 'Polygon');\n\nclass Polyline extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polyline', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polyline: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polyline()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polyline, pointed);\nextend(Polyline, poly);\nregister(Polyline, 'Polyline');\n\nclass Rect extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('rect', node), attrs);\n  }\n}\nextend(Rect, {\n  rx,\n  ry\n});\nregisterMethods({\n  Container: {\n    // Create a rect element\n    rect: wrapWithAttrCheck(function (width, height) {\n      return this.put(new Rect()).size(width, height);\n    })\n  }\n});\nregister(Rect, 'Rect');\n\nclass Queue {\n  constructor() {\n    this._first = null;\n    this._last = null;\n  }\n\n  // Shows us the first item in the list\n  first() {\n    return this._first && this._first.value;\n  }\n\n  // Shows us the last item in the list\n  last() {\n    return this._last && this._last.value;\n  }\n  push(value) {\n    // An item stores an id and the provided value\n    const item = typeof value.next !== 'undefined' ? value : {\n      value: value,\n      next: null,\n      prev: null\n    };\n\n    // Deal with the queue being empty or populated\n    if (this._last) {\n      item.prev = this._last;\n      this._last.next = item;\n      this._last = item;\n    } else {\n      this._last = item;\n      this._first = item;\n    }\n\n    // Return the current item\n    return item;\n  }\n\n  // Removes the item that was returned from the push\n  remove(item) {\n    // Relink the previous item\n    if (item.prev) item.prev.next = item.next;\n    if (item.next) item.next.prev = item.prev;\n    if (item === this._last) this._last = item.prev;\n    if (item === this._first) this._first = item.next;\n\n    // Invalidate item\n    item.prev = null;\n    item.next = null;\n  }\n  shift() {\n    // Check if we have a value\n    const remove = this._first;\n    if (!remove) return null;\n\n    // If we do, remove it and relink things\n    this._first = remove.next;\n    if (this._first) this._first.prev = null;\n    this._last = this._first ? this._last : null;\n    return remove.value;\n  }\n}\n\nconst Animator = {\n  nextDraw: null,\n  frames: new Queue(),\n  timeouts: new Queue(),\n  immediates: new Queue(),\n  timer: () => globals.window.performance || globals.window.Date,\n  transforms: [],\n  frame(fn) {\n    // Store the node\n    const node = Animator.frames.push({\n      run: fn\n    });\n\n    // Request an animation frame if we don't have one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n\n    // Return the node so we can remove it easily\n    return node;\n  },\n  timeout(fn, delay) {\n    delay = delay || 0;\n\n    // Work out when the event should fire\n    const time = Animator.timer().now() + delay;\n\n    // Add the timeout to the end of the queue\n    const node = Animator.timeouts.push({\n      run: fn,\n      time: time\n    });\n\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  immediate(fn) {\n    // Add the immediate fn to the end of the queue\n    const node = Animator.immediates.push(fn);\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  cancelFrame(node) {\n    node != null && Animator.frames.remove(node);\n  },\n  clearTimeout(node) {\n    node != null && Animator.timeouts.remove(node);\n  },\n  cancelImmediate(node) {\n    node != null && Animator.immediates.remove(node);\n  },\n  _draw(now) {\n    // Run all the timeouts we can run, if they are not ready yet, add them\n    // to the end of the queue immediately! (bad timeouts!!! [sarcasm])\n    let nextTimeout = null;\n    const lastTimeout = Animator.timeouts.last();\n    while (nextTimeout = Animator.timeouts.shift()) {\n      // Run the timeout if its time, or push it to the end\n      if (now >= nextTimeout.time) {\n        nextTimeout.run();\n      } else {\n        Animator.timeouts.push(nextTimeout);\n      }\n\n      // If we hit the last item, we should stop shifting out more items\n      if (nextTimeout === lastTimeout) break;\n    }\n\n    // Run all of the animation frames\n    let nextFrame = null;\n    const lastFrame = Animator.frames.last();\n    while (nextFrame !== lastFrame && (nextFrame = Animator.frames.shift())) {\n      nextFrame.run(now);\n    }\n    let nextImmediate = null;\n    while (nextImmediate = Animator.immediates.shift()) {\n      nextImmediate();\n    }\n\n    // If we have remaining timeouts or frames, draw until we don't anymore\n    Animator.nextDraw = Animator.timeouts.first() || Animator.frames.first() ? globals.window.requestAnimationFrame(Animator._draw) : null;\n  }\n};\n\nconst makeSchedule = function (runnerInfo) {\n  const start = runnerInfo.start;\n  const duration = runnerInfo.runner.duration();\n  const end = start + duration;\n  return {\n    start: start,\n    duration: duration,\n    end: end,\n    runner: runnerInfo.runner\n  };\n};\nconst defaultSource = function () {\n  const w = globals.window;\n  return (w.performance || w.Date).now();\n};\nclass Timeline extends EventTarget {\n  // Construct a new timeline on the given element\n  constructor(timeSource = defaultSource) {\n    super();\n    this._timeSource = timeSource;\n\n    // terminate resets all variables to their initial state\n    this.terminate();\n  }\n  active() {\n    return !!this._nextFrame;\n  }\n  finish() {\n    // Go to end and pause\n    this.time(this.getEndTimeOfTimeline() + 1);\n    return this.pause();\n  }\n\n  // Calculates the end of the timeline\n  getEndTime() {\n    const lastRunnerInfo = this.getLastRunnerInfo();\n    const lastDuration = lastRunnerInfo ? lastRunnerInfo.runner.duration() : 0;\n    const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n    return lastStartTime + lastDuration;\n  }\n  getEndTimeOfTimeline() {\n    const endTimes = this._runners.map(i => i.start + i.runner.duration());\n    return Math.max(0, ...endTimes);\n  }\n  getLastRunnerInfo() {\n    return this.getRunnerInfoById(this._lastRunnerId);\n  }\n  getRunnerInfoById(id) {\n    return this._runners[this._runnerIds.indexOf(id)] || null;\n  }\n  pause() {\n    this._paused = true;\n    return this._continue();\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  play() {\n    // Now make sure we are not paused and continue the animation\n    this._paused = false;\n    return this.updateTime()._continue();\n  }\n  reverse(yes) {\n    const currentSpeed = this.speed();\n    if (yes == null) return this.speed(-currentSpeed);\n    const positive = Math.abs(currentSpeed);\n    return this.speed(yes ? -positive : positive);\n  }\n\n  // schedules a runner on the timeline\n  schedule(runner, delay, when) {\n    if (runner == null) {\n      return this._runners.map(makeSchedule);\n    }\n\n    // The start time for the next animation can either be given explicitly,\n    // derived from the current timeline time or it can be relative to the\n    // last start time to chain animations directly\n\n    let absoluteStartTime = 0;\n    const endTime = this.getEndTime();\n    delay = delay || 0;\n\n    // Work out when to start the animation\n    if (when == null || when === 'last' || when === 'after') {\n      // Take the last time and increment\n      absoluteStartTime = endTime;\n    } else if (when === 'absolute' || when === 'start') {\n      absoluteStartTime = delay;\n      delay = 0;\n    } else if (when === 'now') {\n      absoluteStartTime = this._time;\n    } else if (when === 'relative') {\n      const runnerInfo = this.getRunnerInfoById(runner.id);\n      if (runnerInfo) {\n        absoluteStartTime = runnerInfo.start + delay;\n        delay = 0;\n      }\n    } else if (when === 'with-last') {\n      const lastRunnerInfo = this.getLastRunnerInfo();\n      const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n      absoluteStartTime = lastStartTime;\n    } else {\n      throw new Error('Invalid value for the \"when\" parameter');\n    }\n\n    // Manage runner\n    runner.unschedule();\n    runner.timeline(this);\n    const persist = runner.persist();\n    const runnerInfo = {\n      persist: persist === null ? this._persist : persist,\n      start: absoluteStartTime + delay,\n      runner\n    };\n    this._lastRunnerId = runner.id;\n    this._runners.push(runnerInfo);\n    this._runners.sort((a, b) => a.start - b.start);\n    this._runnerIds = this._runners.map(info => info.runner.id);\n    this.updateTime()._continue();\n    return this;\n  }\n  seek(dt) {\n    return this.time(this._time + dt);\n  }\n  source(fn) {\n    if (fn == null) return this._timeSource;\n    this._timeSource = fn;\n    return this;\n  }\n  speed(speed) {\n    if (speed == null) return this._speed;\n    this._speed = speed;\n    return this;\n  }\n  stop() {\n    // Go to start and pause\n    this.time(0);\n    return this.pause();\n  }\n  time(time) {\n    if (time == null) return this._time;\n    this._time = time;\n    return this._continue(true);\n  }\n\n  // Remove the runner from this timeline\n  unschedule(runner) {\n    const index = this._runnerIds.indexOf(runner.id);\n    if (index < 0) return this;\n    this._runners.splice(index, 1);\n    this._runnerIds.splice(index, 1);\n    runner.timeline(null);\n    return this;\n  }\n\n  // Makes sure, that after pausing the time doesn't jump\n  updateTime() {\n    if (!this.active()) {\n      this._lastSourceTime = this._timeSource();\n    }\n    return this;\n  }\n\n  // Checks if we are running and continues the animation\n  _continue(immediateStep = false) {\n    Animator.cancelFrame(this._nextFrame);\n    this._nextFrame = null;\n    if (immediateStep) return this._stepImmediate();\n    if (this._paused) return this;\n    this._nextFrame = Animator.frame(this._step);\n    return this;\n  }\n  _stepFn(immediateStep = false) {\n    // Get the time delta from the last time and update the time\n    const time = this._timeSource();\n    let dtSource = time - this._lastSourceTime;\n    if (immediateStep) dtSource = 0;\n    const dtTime = this._speed * dtSource + (this._time - this._lastStepTime);\n    this._lastSourceTime = time;\n\n    // Only update the time if we use the timeSource.\n    // Otherwise use the current time\n    if (!immediateStep) {\n      // Update the time\n      this._time += dtTime;\n      this._time = this._time < 0 ? 0 : this._time;\n    }\n    this._lastStepTime = this._time;\n    this.fire('time', this._time);\n\n    // This is for the case that the timeline was seeked so that the time\n    // is now before the startTime of the runner. That is why we need to set\n    // the runner to position 0\n\n    // FIXME:\n    // However, resetting in insertion order leads to bugs. Considering the case,\n    // where 2 runners change the same attribute but in different times,\n    // resetting both of them will lead to the case where the later defined\n    // runner always wins the reset even if the other runner started earlier\n    // and therefore should win the attribute battle\n    // this can be solved by resetting them backwards\n    for (let k = this._runners.length; k--;) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[k];\n      const runner = runnerInfo.runner;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      // and try to reset it\n      if (dtToStart <= 0) {\n        runner.reset();\n      }\n    }\n\n    // Run all of the runners directly\n    let runnersLeft = false;\n    for (let i = 0, len = this._runners.length; i < len; i++) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[i];\n      const runner = runnerInfo.runner;\n      let dt = dtTime;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      if (dtToStart <= 0) {\n        runnersLeft = true;\n        continue;\n      } else if (dtToStart < dt) {\n        // Adjust dt to make sure that animation is on point\n        dt = dtToStart;\n      }\n      if (!runner.active()) continue;\n\n      // If this runner is still going, signal that we need another animation\n      // frame, otherwise, remove the completed runner\n      const finished = runner.step(dt).done;\n      if (!finished) {\n        runnersLeft = true;\n        // continue\n      } else if (runnerInfo.persist !== true) {\n        // runner is finished. And runner might get removed\n        const endTime = runner.duration() - runner.time() + this._time;\n        if (endTime + runnerInfo.persist < this._time) {\n          // Delete runner and correct index\n          runner.unschedule();\n          --i;\n          --len;\n        }\n      }\n    }\n\n    // Basically: we continue when there are runners right from us in time\n    // when -->, and when runners are left from us when <--\n    if (runnersLeft && !(this._speed < 0 && this._time === 0) || this._runnerIds.length && this._speed < 0 && this._time > 0) {\n      this._continue();\n    } else {\n      this.pause();\n      this.fire('finished');\n    }\n    return this;\n  }\n  terminate() {\n    // cleanup memory\n\n    // Store the timing variables\n    this._startTime = 0;\n    this._speed = 1.0;\n\n    // Determines how long a runner is hold in memory. Can be a dt or true/false\n    this._persist = 0;\n\n    // Keep track of the running animations and their starting parameters\n    this._nextFrame = null;\n    this._paused = true;\n    this._runners = [];\n    this._runnerIds = [];\n    this._lastRunnerId = -1;\n    this._time = 0;\n    this._lastSourceTime = 0;\n    this._lastStepTime = 0;\n\n    // Make sure that step is always called in class context\n    this._step = this._stepFn.bind(this, false);\n    this._stepImmediate = this._stepFn.bind(this, true);\n  }\n}\nregisterMethods({\n  Element: {\n    timeline: function (timeline) {\n      if (timeline == null) {\n        this._timeline = this._timeline || new Timeline();\n        return this._timeline;\n      } else {\n        this._timeline = timeline;\n        return this;\n      }\n    }\n  }\n});\n\nclass Runner extends EventTarget {\n  constructor(options) {\n    super();\n\n    // Store a unique id on the runner, so that we can identify it later\n    this.id = Runner.id++;\n\n    // Ensure a default value\n    options = options == null ? timeline.duration : options;\n\n    // Ensure that we get a controller\n    options = typeof options === 'function' ? new Controller(options) : options;\n\n    // Declare all of the variables\n    this._element = null;\n    this._timeline = null;\n    this.done = false;\n    this._queue = [];\n\n    // Work out the stepper and the duration\n    this._duration = typeof options === 'number' && options;\n    this._isDeclarative = options instanceof Controller;\n    this._stepper = this._isDeclarative ? options : new Ease();\n\n    // We copy the current values from the timeline because they can change\n    this._history = {};\n\n    // Store the state of the runner\n    this.enabled = true;\n    this._time = 0;\n    this._lastTime = 0;\n\n    // At creation, the runner is in reset state\n    this._reseted = true;\n\n    // Save transforms applied to this runner\n    this.transforms = new Matrix();\n    this.transformId = 1;\n\n    // Looping variables\n    this._haveReversed = false;\n    this._reverse = false;\n    this._loopsDone = 0;\n    this._swing = false;\n    this._wait = 0;\n    this._times = 1;\n    this._frameId = null;\n\n    // Stores how long a runner is stored after being done\n    this._persist = this._isDeclarative ? true : null;\n  }\n  static sanitise(duration, delay, when) {\n    // Initialise the default parameters\n    let times = 1;\n    let swing = false;\n    let wait = 0;\n    duration = duration ?? timeline.duration;\n    delay = delay ?? timeline.delay;\n    when = when || 'last';\n\n    // If we have an object, unpack the values\n    if (typeof duration === 'object' && !(duration instanceof Stepper)) {\n      delay = duration.delay ?? delay;\n      when = duration.when ?? when;\n      swing = duration.swing || swing;\n      times = duration.times ?? times;\n      wait = duration.wait ?? wait;\n      duration = duration.duration ?? timeline.duration;\n    }\n    return {\n      duration: duration,\n      delay: delay,\n      swing: swing,\n      times: times,\n      wait: wait,\n      when: when\n    };\n  }\n  active(enabled) {\n    if (enabled == null) return this.enabled;\n    this.enabled = enabled;\n    return this;\n  }\n\n  /*\n  Private Methods\n  ===============\n  Methods that shouldn't be used externally\n  */\n  addTransform(transform) {\n    this.transforms.lmultiplyO(transform);\n    return this;\n  }\n  after(fn) {\n    return this.on('finished', fn);\n  }\n  animate(duration, delay, when) {\n    const o = Runner.sanitise(duration, delay, when);\n    const runner = new Runner(o.duration);\n    if (this._timeline) runner.timeline(this._timeline);\n    if (this._element) runner.element(this._element);\n    return runner.loop(o).schedule(o.delay, o.when);\n  }\n  clearTransform() {\n    this.transforms = new Matrix();\n    return this;\n  }\n\n  // TODO: Keep track of all transformations so that deletion is faster\n  clearTransformsFromQueue() {\n    if (!this.done || !this._timeline || !this._timeline._runnerIds.includes(this.id)) {\n      this._queue = this._queue.filter(item => {\n        return !item.isTransform;\n      });\n    }\n  }\n  delay(delay) {\n    return this.animate(0, delay);\n  }\n  duration() {\n    return this._times * (this._wait + this._duration) - this._wait;\n  }\n  during(fn) {\n    return this.queue(null, fn);\n  }\n  ease(fn) {\n    this._stepper = new Ease(fn);\n    return this;\n  }\n  /*\n  Runner Definitions\n  ==================\n  These methods help us define the runtime behaviour of the Runner or they\n  help us make new runners from the current runner\n  */\n\n  element(element) {\n    if (element == null) return this._element;\n    this._element = element;\n    element._prepareRunner();\n    return this;\n  }\n  finish() {\n    return this.step(Infinity);\n  }\n  loop(times, swing, wait) {\n    // Deal with the user passing in an object\n    if (typeof times === 'object') {\n      swing = times.swing;\n      wait = times.wait;\n      times = times.times;\n    }\n\n    // Sanitise the values and store them\n    this._times = times || Infinity;\n    this._swing = swing || false;\n    this._wait = wait || 0;\n\n    // Allow true to be passed\n    if (this._times === true) {\n      this._times = Infinity;\n    }\n    return this;\n  }\n  loops(p) {\n    const loopDuration = this._duration + this._wait;\n    if (p == null) {\n      const loopsDone = Math.floor(this._time / loopDuration);\n      const relativeTime = this._time - loopsDone * loopDuration;\n      const position = relativeTime / this._duration;\n      return Math.min(loopsDone + position, this._times);\n    }\n    const whole = Math.floor(p);\n    const partial = p % 1;\n    const time = loopDuration * whole + this._duration * partial;\n    return this.time(time);\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  position(p) {\n    // Get all of the variables we need\n    const x = this._time;\n    const d = this._duration;\n    const w = this._wait;\n    const t = this._times;\n    const s = this._swing;\n    const r = this._reverse;\n    let position;\n    if (p == null) {\n      /*\n      This function converts a time to a position in the range [0, 1]\n      The full explanation can be found in this desmos demonstration\n        https://www.desmos.com/calculator/u4fbavgche\n      The logic is slightly simplified here because we can use booleans\n      */\n\n      // Figure out the value without thinking about the start or end time\n      const f = function (x) {\n        const swinging = s * Math.floor(x % (2 * (w + d)) / (w + d));\n        const backwards = swinging && !r || !swinging && r;\n        const uncliped = Math.pow(-1, backwards) * (x % (w + d)) / d + backwards;\n        const clipped = Math.max(Math.min(uncliped, 1), 0);\n        return clipped;\n      };\n\n      // Figure out the value by incorporating the start time\n      const endTime = t * (w + d) - w;\n      position = x <= 0 ? Math.round(f(1e-5)) : x < endTime ? f(x) : Math.round(f(endTime - 1e-5));\n      return position;\n    }\n\n    // Work out the loops done and add the position to the loops done\n    const loopsDone = Math.floor(this.loops());\n    const swingForward = s && loopsDone % 2 === 0;\n    const forwards = swingForward && !r || r && swingForward;\n    position = loopsDone + (forwards ? p : 1 - p);\n    return this.loops(position);\n  }\n  progress(p) {\n    if (p == null) {\n      return Math.min(1, this._time / this.duration());\n    }\n    return this.time(p * this.duration());\n  }\n\n  /*\n  Basic Functionality\n  ===================\n  These methods allow us to attach basic functions to the runner directly\n  */\n  queue(initFn, runFn, retargetFn, isTransform) {\n    this._queue.push({\n      initialiser: initFn || noop,\n      runner: runFn || noop,\n      retarget: retargetFn,\n      isTransform: isTransform,\n      initialised: false,\n      finished: false\n    });\n    const timeline = this.timeline();\n    timeline && this.timeline()._continue();\n    return this;\n  }\n  reset() {\n    if (this._reseted) return this;\n    this.time(0);\n    this._reseted = true;\n    return this;\n  }\n  reverse(reverse) {\n    this._reverse = reverse == null ? !this._reverse : reverse;\n    return this;\n  }\n  schedule(timeline, delay, when) {\n    // The user doesn't need to pass a timeline if we already have one\n    if (!(timeline instanceof Timeline)) {\n      when = delay;\n      delay = timeline;\n      timeline = this.timeline();\n    }\n\n    // If there is no timeline, yell at the user...\n    if (!timeline) {\n      throw Error('Runner cannot be scheduled without timeline');\n    }\n\n    // Schedule the runner on the timeline provided\n    timeline.schedule(this, delay, when);\n    return this;\n  }\n  step(dt) {\n    // If we are inactive, this stepper just gets skipped\n    if (!this.enabled) return this;\n\n    // Update the time and get the new position\n    dt = dt == null ? 16 : dt;\n    this._time += dt;\n    const position = this.position();\n\n    // Figure out if we need to run the stepper in this frame\n    const running = this._lastPosition !== position && this._time >= 0;\n    this._lastPosition = position;\n\n    // Figure out if we just started\n    const duration = this.duration();\n    const justStarted = this._lastTime <= 0 && this._time > 0;\n    const justFinished = this._lastTime < duration && this._time >= duration;\n    this._lastTime = this._time;\n    if (justStarted) {\n      this.fire('start', this);\n    }\n\n    // Work out if the runner is finished set the done flag here so animations\n    // know, that they are running in the last step (this is good for\n    // transformations which can be merged)\n    const declarative = this._isDeclarative;\n    this.done = !declarative && !justFinished && this._time >= duration;\n\n    // Runner is running. So its not in reset state anymore\n    this._reseted = false;\n    let converged = false;\n    // Call initialise and the run function\n    if (running || declarative) {\n      this._initialise(running);\n\n      // clear the transforms on this runner so they dont get added again and again\n      this.transforms = new Matrix();\n      converged = this._run(declarative ? dt : position);\n      this.fire('step', this);\n    }\n    // correct the done flag here\n    // declarative animations itself know when they converged\n    this.done = this.done || converged && declarative;\n    if (justFinished) {\n      this.fire('finished', this);\n    }\n    return this;\n  }\n\n  /*\n  Runner animation methods\n  ========================\n  Control how the animation plays\n  */\n  time(time) {\n    if (time == null) {\n      return this._time;\n    }\n    const dt = time - this._time;\n    this.step(dt);\n    return this;\n  }\n  timeline(timeline) {\n    // check explicitly for undefined so we can set the timeline to null\n    if (typeof timeline === 'undefined') return this._timeline;\n    this._timeline = timeline;\n    return this;\n  }\n  unschedule() {\n    const timeline = this.timeline();\n    timeline && timeline.unschedule(this);\n    return this;\n  }\n\n  // Run each initialise function in the runner if required\n  _initialise(running) {\n    // If we aren't running, we shouldn't initialise when not declarative\n    if (!running && !this._isDeclarative) return;\n\n    // Loop through all of the initialisers\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current initialiser\n      const current = this._queue[i];\n\n      // Determine whether we need to initialise\n      const needsIt = this._isDeclarative || !current.initialised && running;\n      running = !current.finished;\n\n      // Call the initialiser if we need to\n      if (needsIt && running) {\n        current.initialiser.call(this);\n        current.initialised = true;\n      }\n    }\n  }\n\n  // Save a morpher to the morpher list so that we can retarget it later\n  _rememberMorpher(method, morpher) {\n    this._history[method] = {\n      morpher: morpher,\n      caller: this._queue[this._queue.length - 1]\n    };\n\n    // We have to resume the timeline in case a controller\n    // is already done without being ever run\n    // This can happen when e.g. this is done:\n    //    anim = el.animate(new SVG.Spring)\n    // and later\n    //    anim.move(...)\n    if (this._isDeclarative) {\n      const timeline = this.timeline();\n      timeline && timeline.play();\n    }\n  }\n\n  // Try to set the target for a morpher if the morpher exists, otherwise\n  // Run each run function for the position or dt given\n  _run(positionOrDt) {\n    // Run all of the _queue directly\n    let allfinished = true;\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current function to run\n      const current = this._queue[i];\n\n      // Run the function if its not finished, we keep track of the finished\n      // flag for the sake of declarative _queue\n      const converged = current.runner.call(this, positionOrDt);\n      current.finished = current.finished || converged === true;\n      allfinished = allfinished && current.finished;\n    }\n\n    // We report when all of the constructors are finished\n    return allfinished;\n  }\n\n  // do nothing and return false\n  _tryRetarget(method, target, extra) {\n    if (this._history[method]) {\n      // if the last method wasn't even initialised, throw it away\n      if (!this._history[method].caller.initialised) {\n        const index = this._queue.indexOf(this._history[method].caller);\n        this._queue.splice(index, 1);\n        return false;\n      }\n\n      // for the case of transformations, we use the special retarget function\n      // which has access to the outer scope\n      if (this._history[method].caller.retarget) {\n        this._history[method].caller.retarget.call(this, target, extra);\n        // for everything else a simple morpher change is sufficient\n      } else {\n        this._history[method].morpher.to(target);\n      }\n      this._history[method].caller.finished = false;\n      const timeline = this.timeline();\n      timeline && timeline.play();\n      return true;\n    }\n    return false;\n  }\n}\nRunner.id = 0;\nclass FakeRunner {\n  constructor(transforms = new Matrix(), id = -1, done = true) {\n    this.transforms = transforms;\n    this.id = id;\n    this.done = done;\n  }\n  clearTransformsFromQueue() {}\n}\nextend([Runner, FakeRunner], {\n  mergeWith(runner) {\n    return new FakeRunner(runner.transforms.lmultiply(this.transforms), runner.id);\n  }\n});\n\n// FakeRunner.emptyRunner = new FakeRunner()\n\nconst lmultiply = (last, curr) => last.lmultiplyO(curr);\nconst getRunnerTransform = runner => runner.transforms;\nfunction mergeTransforms() {\n  // Find the matrix to apply to the element and apply it\n  const runners = this._transformationRunners.runners;\n  const netTransform = runners.map(getRunnerTransform).reduce(lmultiply, new Matrix());\n  this.transform(netTransform);\n  this._transformationRunners.merge();\n  if (this._transformationRunners.length() === 1) {\n    this._frameId = null;\n  }\n}\nclass RunnerArray {\n  constructor() {\n    this.runners = [];\n    this.ids = [];\n  }\n  add(runner) {\n    if (this.runners.includes(runner)) return;\n    const id = runner.id + 1;\n    this.runners.push(runner);\n    this.ids.push(id);\n    return this;\n  }\n  clearBefore(id) {\n    const deleteCnt = this.ids.indexOf(id + 1) || 1;\n    this.ids.splice(0, deleteCnt, 0);\n    this.runners.splice(0, deleteCnt, new FakeRunner()).forEach(r => r.clearTransformsFromQueue());\n    return this;\n  }\n  edit(id, newRunner) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1, id + 1);\n    this.runners.splice(index, 1, newRunner);\n    return this;\n  }\n  getByID(id) {\n    return this.runners[this.ids.indexOf(id + 1)];\n  }\n  length() {\n    return this.ids.length;\n  }\n  merge() {\n    let lastRunner = null;\n    for (let i = 0; i < this.runners.length; ++i) {\n      const runner = this.runners[i];\n      const condition = lastRunner && runner.done && lastRunner.done && (\n      // don't merge runner when persisted on timeline\n      !runner._timeline || !runner._timeline._runnerIds.includes(runner.id)) && (!lastRunner._timeline || !lastRunner._timeline._runnerIds.includes(lastRunner.id));\n      if (condition) {\n        // the +1 happens in the function\n        this.remove(runner.id);\n        const newRunner = runner.mergeWith(lastRunner);\n        this.edit(lastRunner.id, newRunner);\n        lastRunner = newRunner;\n        --i;\n      } else {\n        lastRunner = runner;\n      }\n    }\n    return this;\n  }\n  remove(id) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1);\n    this.runners.splice(index, 1);\n    return this;\n  }\n}\nregisterMethods({\n  Element: {\n    animate(duration, delay, when) {\n      const o = Runner.sanitise(duration, delay, when);\n      const timeline = this.timeline();\n      return new Runner(o.duration).loop(o).element(this).timeline(timeline.play()).schedule(o.delay, o.when);\n    },\n    delay(by, when) {\n      return this.animate(0, by, when);\n    },\n    // this function searches for all runners on the element and deletes the ones\n    // which run before the current one. This is because absolute transformations\n    // overwrite anything anyway so there is no need to waste time computing\n    // other runners\n    _clearTransformRunnersBefore(currentRunner) {\n      this._transformationRunners.clearBefore(currentRunner.id);\n    },\n    _currentTransform(current) {\n      return this._transformationRunners.runners\n      // we need the equal sign here to make sure, that also transformations\n      // on the same runner which execute before the current transformation are\n      // taken into account\n      .filter(runner => runner.id <= current.id).map(getRunnerTransform).reduce(lmultiply, new Matrix());\n    },\n    _addRunner(runner) {\n      this._transformationRunners.add(runner);\n\n      // Make sure that the runner merge is executed at the very end of\n      // all Animator functions. That is why we use immediate here to execute\n      // the merge right after all frames are run\n      Animator.cancelImmediate(this._frameId);\n      this._frameId = Animator.immediate(mergeTransforms.bind(this));\n    },\n    _prepareRunner() {\n      if (this._frameId == null) {\n        this._transformationRunners = new RunnerArray().add(new FakeRunner(new Matrix(this)));\n      }\n    }\n  }\n});\n\n// Will output the elements from array A that are not in the array B\nconst difference = (a, b) => a.filter(x => !b.includes(x));\nextend(Runner, {\n  attr(a, v) {\n    return this.styleAttr('attr', a, v);\n  },\n  // Add animatable styles\n  css(s, v) {\n    return this.styleAttr('css', s, v);\n  },\n  styleAttr(type, nameOrAttrs, val) {\n    if (typeof nameOrAttrs === 'string') {\n      return this.styleAttr(type, {\n        [nameOrAttrs]: val\n      });\n    }\n    let attrs = nameOrAttrs;\n    if (this._tryRetarget(type, attrs)) return this;\n    let morpher = new Morphable(this._stepper).to(attrs);\n    let keys = Object.keys(attrs);\n    this.queue(function () {\n      morpher = morpher.from(this.element()[type](keys));\n    }, function (pos) {\n      this.element()[type](morpher.at(pos).valueOf());\n      return morpher.done();\n    }, function (newToAttrs) {\n      // Check if any new keys were added\n      const newKeys = Object.keys(newToAttrs);\n      const differences = difference(newKeys, keys);\n\n      // If their are new keys, initialize them and add them to morpher\n      if (differences.length) {\n        // Get the values\n        const addedFromAttrs = this.element()[type](differences);\n\n        // Get the already initialized values\n        const oldFromAttrs = new ObjectBag(morpher.from()).valueOf();\n\n        // Merge old and new\n        Object.assign(oldFromAttrs, addedFromAttrs);\n        morpher.from(oldFromAttrs);\n      }\n\n      // Get the object from the morpher\n      const oldToAttrs = new ObjectBag(morpher.to()).valueOf();\n\n      // Merge in new attributes\n      Object.assign(oldToAttrs, newToAttrs);\n\n      // Change morpher target\n      morpher.to(oldToAttrs);\n\n      // Make sure that we save the work we did so we don't need it to do again\n      keys = newKeys;\n      attrs = newToAttrs;\n    });\n    this._rememberMorpher(type, morpher);\n    return this;\n  },\n  zoom(level, point) {\n    if (this._tryRetarget('zoom', level, point)) return this;\n    let morpher = new Morphable(this._stepper).to(new SVGNumber(level));\n    this.queue(function () {\n      morpher = morpher.from(this.element().zoom());\n    }, function (pos) {\n      this.element().zoom(morpher.at(pos), point);\n      return morpher.done();\n    }, function (newLevel, newPoint) {\n      point = newPoint;\n      morpher.to(newLevel);\n    });\n    this._rememberMorpher('zoom', morpher);\n    return this;\n  },\n  /**\n   ** absolute transformations\n   **/\n\n  //\n  // M v -----|-----(D M v = F v)------|----->  T v\n  //\n  // 1. define the final state (T) and decompose it (once)\n  //    t = [tx, ty, the, lam, sy, sx]\n  // 2. on every frame: pull the current state of all previous transforms\n  //    (M - m can change)\n  //   and then write this as m = [tx0, ty0, the0, lam0, sy0, sx0]\n  // 3. Find the interpolated matrix F(pos) = m + pos * (t - m)\n  //   - Note F(0) = M\n  //   - Note F(1) = T\n  // 4. Now you get the delta matrix as a result: D = F * inv(M)\n\n  transform(transforms, relative, affine) {\n    // If we have a declarative function, we should retarget it if possible\n    relative = transforms.relative || relative;\n    if (this._isDeclarative && !relative && this._tryRetarget('transform', transforms)) {\n      return this;\n    }\n\n    // Parse the parameters\n    const isMatrix = Matrix.isMatrixLike(transforms);\n    affine = transforms.affine != null ? transforms.affine : affine != null ? affine : !isMatrix;\n\n    // Create a morpher and set its type\n    const morpher = new Morphable(this._stepper).type(affine ? TransformBag : Matrix);\n    let origin;\n    let element;\n    let current;\n    let currentAngle;\n    let startTransform;\n    function setup() {\n      // make sure element and origin is defined\n      element = element || this.element();\n      origin = origin || getOrigin(transforms, element);\n      startTransform = new Matrix(relative ? undefined : element);\n\n      // add the runner to the element so it can merge transformations\n      element._addRunner(this);\n\n      // Deactivate all transforms that have run so far if we are absolute\n      if (!relative) {\n        element._clearTransformRunnersBefore(this);\n      }\n    }\n    function run(pos) {\n      // clear all other transforms before this in case something is saved\n      // on this runner. We are absolute. We dont need these!\n      if (!relative) this.clearTransform();\n      const {\n        x,\n        y\n      } = new Point(origin).transform(element._currentTransform(this));\n      let target = new Matrix({\n        ...transforms,\n        origin: [x, y]\n      });\n      let start = this._isDeclarative && current ? current : startTransform;\n      if (affine) {\n        target = target.decompose(x, y);\n        start = start.decompose(x, y);\n\n        // Get the current and target angle as it was set\n        const rTarget = target.rotate;\n        const rCurrent = start.rotate;\n\n        // Figure out the shortest path to rotate directly\n        const possibilities = [rTarget - 360, rTarget, rTarget + 360];\n        const distances = possibilities.map(a => Math.abs(a - rCurrent));\n        const shortest = Math.min(...distances);\n        const index = distances.indexOf(shortest);\n        target.rotate = possibilities[index];\n      }\n      if (relative) {\n        // we have to be careful here not to overwrite the rotation\n        // with the rotate method of Matrix\n        if (!isMatrix) {\n          target.rotate = transforms.rotate || 0;\n        }\n        if (this._isDeclarative && currentAngle) {\n          start.rotate = currentAngle;\n        }\n      }\n      morpher.from(start);\n      morpher.to(target);\n      const affineParameters = morpher.at(pos);\n      currentAngle = affineParameters.rotate;\n      current = new Matrix(affineParameters);\n      this.addTransform(current);\n      element._addRunner(this);\n      return morpher.done();\n    }\n    function retarget(newTransforms) {\n      // only get a new origin if it changed since the last call\n      if ((newTransforms.origin || 'center').toString() !== (transforms.origin || 'center').toString()) {\n        origin = getOrigin(newTransforms, element);\n      }\n\n      // overwrite the old transformations with the new ones\n      transforms = {\n        ...newTransforms,\n        origin\n      };\n    }\n    this.queue(setup, run, retarget, true);\n    this._isDeclarative && this._rememberMorpher('transform', morpher);\n    return this;\n  },\n  // Animatable x-axis\n  x(x) {\n    return this._queueNumber('x', x);\n  },\n  // Animatable y-axis\n  y(y) {\n    return this._queueNumber('y', y);\n  },\n  ax(x) {\n    return this._queueNumber('ax', x);\n  },\n  ay(y) {\n    return this._queueNumber('ay', y);\n  },\n  dx(x = 0) {\n    return this._queueNumberDelta('x', x);\n  },\n  dy(y = 0) {\n    return this._queueNumberDelta('y', y);\n  },\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  },\n  _queueNumberDelta(method, to) {\n    to = new SVGNumber(to);\n\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    let from = null;\n    this.queue(function () {\n      from = this.element()[method]();\n      morpher.from(from);\n      morpher.to(from + to);\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    }, function (newTo) {\n      morpher.to(from + new SVGNumber(newTo));\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueObject(method, to) {\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    this.queue(function () {\n      morpher.from(this.element()[method]());\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueNumber(method, value) {\n    return this._queueObject(method, new SVGNumber(value));\n  },\n  // Animatable center x-axis\n  cx(x) {\n    return this._queueNumber('cx', x);\n  },\n  // Animatable center y-axis\n  cy(y) {\n    return this._queueNumber('cy', y);\n  },\n  // Add animatable move\n  move(x, y) {\n    return this.x(x).y(y);\n  },\n  amove(x, y) {\n    return this.ax(x).ay(y);\n  },\n  // Add animatable center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  },\n  // Add animatable size\n  size(width, height) {\n    // animate bbox based size for all other elements\n    let box;\n    if (!width || !height) {\n      box = this._element.bbox();\n    }\n    if (!width) {\n      width = box.width / box.height * height;\n    }\n    if (!height) {\n      height = box.height / box.width * width;\n    }\n    return this.width(width).height(height);\n  },\n  // Add animatable width\n  width(width) {\n    return this._queueNumber('width', width);\n  },\n  // Add animatable height\n  height(height) {\n    return this._queueNumber('height', height);\n  },\n  // Add animatable plot\n  plot(a, b, c, d) {\n    // Lines can be plotted with 4 arguments\n    if (arguments.length === 4) {\n      return this.plot([a, b, c, d]);\n    }\n    if (this._tryRetarget('plot', a)) return this;\n    const morpher = new Morphable(this._stepper).type(this._element.MorphArray).to(a);\n    this.queue(function () {\n      morpher.from(this._element.array());\n    }, function (pos) {\n      this._element.plot(morpher.at(pos));\n      return morpher.done();\n    });\n    this._rememberMorpher('plot', morpher);\n    return this;\n  },\n  // Add leading method\n  leading(value) {\n    return this._queueNumber('leading', value);\n  },\n  // Add animatable viewbox\n  viewbox(x, y, width, height) {\n    return this._queueObject('viewbox', new Box(x, y, width, height));\n  },\n  update(o) {\n    if (typeof o !== 'object') {\n      return this.update({\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      });\n    }\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', o.offset);\n    return this;\n  }\n});\nextend(Runner, {\n  rx,\n  ry,\n  from,\n  to\n});\nregister(Runner, 'Runner');\n\nclass Svg extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('svg', node), attrs);\n    this.namespace();\n  }\n\n  // Creates and returns defs element\n  defs() {\n    if (!this.isRoot()) return this.root().defs();\n    return adopt(this.node.querySelector('defs')) || this.put(new Defs());\n  }\n  isRoot() {\n    return !this.node.parentNode || !(this.node.parentNode instanceof globals.window.SVGElement) && this.node.parentNode.nodeName !== '#document-fragment';\n  }\n\n  // Add namespaces\n  namespace() {\n    if (!this.isRoot()) return this.root().namespace();\n    return this.attr({\n      xmlns: svg,\n      version: '1.1'\n    }).attr('xmlns:xlink', xlink, xmlns);\n  }\n  removeNamespace() {\n    return this.attr({\n      xmlns: null,\n      version: null\n    }).attr('xmlns:xlink', null, xmlns).attr('xmlns:svgjs', null, xmlns);\n  }\n\n  // Check if this is a root svg\n  // If not, call root() from this element\n  root() {\n    if (this.isRoot()) return this;\n    return super.root();\n  }\n}\nregisterMethods({\n  Container: {\n    // Create nested svg document\n    nested: wrapWithAttrCheck(function () {\n      return this.put(new Svg());\n    })\n  }\n});\nregister(Svg, 'Svg', true);\n\nclass Symbol extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('symbol', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    symbol: wrapWithAttrCheck(function () {\n      return this.put(new Symbol());\n    })\n  }\n});\nregister(Symbol, 'Symbol');\n\n// Create plain text node\nfunction plain(text) {\n  // clear if build mode is disabled\n  if (this._build === false) {\n    this.clear();\n  }\n\n  // create text node\n  this.node.appendChild(globals.document.createTextNode(text));\n  return this;\n}\n\n// Get length of text element\nfunction length() {\n  return this.node.getComputedTextLength();\n}\n\n// Move over x-axis\n// Text is moved by its bounding box\n// text-anchor does NOT matter\nfunction x$1(x, box = this.bbox()) {\n  if (x == null) {\n    return box.x;\n  }\n  return this.attr('x', this.attr('x') + x - box.x);\n}\n\n// Move over y-axis\nfunction y$1(y, box = this.bbox()) {\n  if (y == null) {\n    return box.y;\n  }\n  return this.attr('y', this.attr('y') + y - box.y);\n}\nfunction move$1(x, y, box = this.bbox()) {\n  return this.x(x, box).y(y, box);\n}\n\n// Move center over x-axis\nfunction cx(x, box = this.bbox()) {\n  if (x == null) {\n    return box.cx;\n  }\n  return this.attr('x', this.attr('x') + x - box.cx);\n}\n\n// Move center over y-axis\nfunction cy(y, box = this.bbox()) {\n  if (y == null) {\n    return box.cy;\n  }\n  return this.attr('y', this.attr('y') + y - box.cy);\n}\nfunction center(x, y, box = this.bbox()) {\n  return this.cx(x, box).cy(y, box);\n}\nfunction ax(x) {\n  return this.attr('x', x);\n}\nfunction ay(y) {\n  return this.attr('y', y);\n}\nfunction amove(x, y) {\n  return this.ax(x).ay(y);\n}\n\n// Enable / disable build mode\nfunction build(build) {\n  this._build = !!build;\n  return this;\n}\n\nvar textable = {\n  __proto__: null,\n  amove: amove,\n  ax: ax,\n  ay: ay,\n  build: build,\n  center: center,\n  cx: cx,\n  cy: cy,\n  length: length,\n  move: move$1,\n  plain: plain,\n  x: x$1,\n  y: y$1\n};\n\nclass Text extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('text', node), attrs);\n    this.dom.leading = this.dom.leading ?? new SVGNumber(1.3); // store leading value for rebuilding\n    this._rebuild = true; // enable automatic updating of dy values\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Set / get leading\n  leading(value) {\n    // act as getter\n    if (value == null) {\n      return this.dom.leading;\n    }\n\n    // act as setter\n    this.dom.leading = new SVGNumber(value);\n    return this.rebuild();\n  }\n\n  // Rebuild appearance type\n  rebuild(rebuild) {\n    // store new rebuild flag if given\n    if (typeof rebuild === 'boolean') {\n      this._rebuild = rebuild;\n    }\n\n    // define position of all lines\n    if (this._rebuild) {\n      const self = this;\n      let blankLineOffset = 0;\n      const leading = this.dom.leading;\n      this.each(function (i) {\n        if (isDescriptive(this.node)) return;\n        const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n        const dy = leading * new SVGNumber(fontSize);\n        if (this.dom.newLined) {\n          this.attr('x', self.attr('x'));\n          if (this.text() === '\\n') {\n            blankLineOffset += dy;\n          } else {\n            this.attr('dy', i ? dy + blankLineOffset : 0);\n            blankLineOffset = 0;\n          }\n        }\n      });\n      this.fire('rebuild');\n    }\n    return this;\n  }\n\n  // overwrite method from parent to set data properly\n  setData(o) {\n    this.dom = o;\n    this.dom.leading = new SVGNumber(o.leading || 1.3);\n    return this;\n  }\n  writeDataToDom() {\n    writeDataToDom(this, this.dom, {\n      leading: 1.3\n    });\n    return this;\n  }\n\n  // Set the text content\n  text(text) {\n    // act as getter\n    if (text === undefined) {\n      const children = this.node.childNodes;\n      let firstLine = 0;\n      text = '';\n      for (let i = 0, len = children.length; i < len; ++i) {\n        // skip textPaths - they are no lines\n        if (children[i].nodeName === 'textPath' || isDescriptive(children[i])) {\n          if (i === 0) firstLine = i + 1;\n          continue;\n        }\n\n        // add newline if its not the first child and newLined is set to true\n        if (i !== firstLine && children[i].nodeType !== 3 && adopt(children[i]).dom.newLined === true) {\n          text += '\\n';\n        }\n\n        // add content of this node\n        text += children[i].textContent;\n      }\n      return text;\n    }\n\n    // remove existing content\n    this.clear().build(true);\n    if (typeof text === 'function') {\n      // call block\n      text.call(this, this);\n    } else {\n      // store text and make sure text is not blank\n      text = (text + '').split('\\n');\n\n      // build new lines\n      for (let j = 0, jl = text.length; j < jl; j++) {\n        this.newLine(text[j]);\n      }\n    }\n\n    // disable build mode and rebuild lines\n    return this.build(false).rebuild();\n  }\n}\nextend(Text, textable);\nregisterMethods({\n  Container: {\n    // Create text element\n    text: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).text(text);\n    }),\n    // Create plain text element\n    plain: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).plain(text);\n    })\n  }\n});\nregister(Text, 'Text');\n\nclass Tspan extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('tspan', node), attrs);\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Shortcut dx\n  dx(dx) {\n    return this.attr('dx', dx);\n  }\n\n  // Shortcut dy\n  dy(dy) {\n    return this.attr('dy', dy);\n  }\n\n  // Create new line\n  newLine() {\n    // mark new line\n    this.dom.newLined = true;\n\n    // fetch parent\n    const text = this.parent();\n\n    // early return in case we are not in a text element\n    if (!(text instanceof Text)) {\n      return this;\n    }\n    const i = text.index(this);\n    const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n    const dy = text.dom.leading * new SVGNumber(fontSize);\n\n    // apply new position\n    return this.dy(i ? dy : 0).attr('x', text.x());\n  }\n\n  // Set text content\n  text(text) {\n    if (text == null) return this.node.textContent + (this.dom.newLined ? '\\n' : '');\n    if (typeof text === 'function') {\n      this.clear().build(true);\n      text.call(this, this);\n      this.build(false);\n    } else {\n      this.plain(text);\n    }\n    return this;\n  }\n}\nextend(Tspan, textable);\nregisterMethods({\n  Tspan: {\n    tspan: wrapWithAttrCheck(function (text = '') {\n      const tspan = new Tspan();\n\n      // clear if build mode is disabled\n      if (!this._build) {\n        this.clear();\n      }\n\n      // add new tspan\n      return this.put(tspan).text(text);\n    })\n  },\n  Text: {\n    newLine: function (text = '') {\n      return this.tspan(text).newLine();\n    }\n  }\n});\nregister(Tspan, 'Tspan');\n\nclass Circle extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('circle', node), attrs);\n  }\n  radius(r) {\n    return this.attr('r', r);\n  }\n\n  // Radius x value\n  rx(rx) {\n    return this.attr('r', rx);\n  }\n\n  // Alias radius x value\n  ry(ry) {\n    return this.rx(ry);\n  }\n  size(size) {\n    return this.radius(new SVGNumber(size).divide(2));\n  }\n}\nextend(Circle, {\n  x: x$3,\n  y: y$3,\n  cx: cx$1,\n  cy: cy$1,\n  width: width$2,\n  height: height$2\n});\nregisterMethods({\n  Container: {\n    // Create circle element\n    circle: wrapWithAttrCheck(function (size = 0) {\n      return this.put(new Circle()).size(size).move(0, 0);\n    })\n  }\n});\nregister(Circle, 'Circle');\n\nclass ClipPath extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('clipPath', node), attrs);\n  }\n\n  // Unclip all clipped elements and remove itself\n  remove() {\n    // unclip all targets\n    this.targets().forEach(function (el) {\n      el.unclip();\n    });\n\n    // remove clipPath from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [clip-path*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    // Create clipping element\n    clip: wrapWithAttrCheck(function () {\n      return this.defs().put(new ClipPath());\n    })\n  },\n  Element: {\n    // Distribute clipPath to svg element\n    clipper() {\n      return this.reference('clip-path');\n    },\n    clipWith(element) {\n      // use given clip or create a new one\n      const clipper = element instanceof ClipPath ? element : this.parent().clip().add(element);\n\n      // apply mask\n      return this.attr('clip-path', 'url(#' + clipper.id() + ')');\n    },\n    // Unclip element\n    unclip() {\n      return this.attr('clip-path', null);\n    }\n  }\n});\nregister(ClipPath, 'ClipPath');\n\nclass ForeignObject extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('foreignObject', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    foreignObject: wrapWithAttrCheck(function (width, height) {\n      return this.put(new ForeignObject()).size(width, height);\n    })\n  }\n});\nregister(ForeignObject, 'ForeignObject');\n\nfunction dmove(dx, dy) {\n  this.children().forEach(child => {\n    let bbox;\n\n    // We have to wrap this for elements that dont have a bbox\n    // e.g. title and other descriptive elements\n    try {\n      // Get the childs bbox\n      // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1905039\n      // Because bbox for nested svgs returns the contents bbox in the coordinate space of the svg itself (weird!), we cant use bbox for svgs\n      // Therefore we have to use getBoundingClientRect. But THAT is broken (as explained in the bug).\n      // Funnily enough the broken behavior would work for us but that breaks it in chrome\n      // So we have to replicate the broken behavior of FF by just reading the attributes of the svg itself\n      bbox = child.node instanceof getWindow().SVGSVGElement ? new Box(child.attr(['x', 'y', 'width', 'height'])) : child.bbox();\n    } catch (e) {\n      return;\n    }\n\n    // Get childs matrix\n    const m = new Matrix(child);\n    // Translate childs matrix by amount and\n    // transform it back into parents space\n    const matrix = m.translate(dx, dy).transform(m.inverse());\n    // Calculate new x and y from old box\n    const p = new Point(bbox.x, bbox.y).transform(matrix);\n    // Move element\n    child.move(p.x, p.y);\n  });\n  return this;\n}\nfunction dx(dx) {\n  return this.dmove(dx, 0);\n}\nfunction dy(dy) {\n  return this.dmove(0, dy);\n}\nfunction height(height, box = this.bbox()) {\n  if (height == null) return box.height;\n  return this.size(box.width, height, box);\n}\nfunction move(x = 0, y = 0, box = this.bbox()) {\n  const dx = x - box.x;\n  const dy = y - box.y;\n  return this.dmove(dx, dy);\n}\nfunction size(width, height, box = this.bbox()) {\n  const p = proportionalSize(this, width, height, box);\n  const scaleX = p.width / box.width;\n  const scaleY = p.height / box.height;\n  this.children().forEach(child => {\n    const o = new Point(box).transform(new Matrix(child).inverse());\n    child.scale(scaleX, scaleY, o.x, o.y);\n  });\n  return this;\n}\nfunction width(width, box = this.bbox()) {\n  if (width == null) return box.width;\n  return this.size(width, box.height, box);\n}\nfunction x(x, box = this.bbox()) {\n  if (x == null) return box.x;\n  return this.move(x, box.y, box);\n}\nfunction y(y, box = this.bbox()) {\n  if (y == null) return box.y;\n  return this.move(box.x, y, box);\n}\n\nvar containerGeometry = {\n  __proto__: null,\n  dmove: dmove,\n  dx: dx,\n  dy: dy,\n  height: height,\n  move: move,\n  size: size,\n  width: width,\n  x: x,\n  y: y\n};\n\nclass G extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('g', node), attrs);\n  }\n}\nextend(G, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a group element\n    group: wrapWithAttrCheck(function () {\n      return this.put(new G());\n    })\n  }\n});\nregister(G, 'G');\n\nclass A extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('a', node), attrs);\n  }\n\n  // Link target attribute\n  target(target) {\n    return this.attr('target', target);\n  }\n\n  // Link url\n  to(url) {\n    return this.attr('href', url, xlink);\n  }\n}\nextend(A, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a hyperlink element\n    link: wrapWithAttrCheck(function (url) {\n      return this.put(new A()).to(url);\n    })\n  },\n  Element: {\n    unlink() {\n      const link = this.linker();\n      if (!link) return this;\n      const parent = link.parent();\n      if (!parent) {\n        return this.remove();\n      }\n      const index = parent.index(link);\n      parent.add(this, index);\n      link.remove();\n      return this;\n    },\n    linkTo(url) {\n      // reuse old link if possible\n      let link = this.linker();\n      if (!link) {\n        link = new A();\n        this.wrap(link);\n      }\n      if (typeof url === 'function') {\n        url.call(link, link);\n      } else {\n        link.to(url);\n      }\n      return this;\n    },\n    linker() {\n      const link = this.parent();\n      if (link && link.node.nodeName.toLowerCase() === 'a') {\n        return link;\n      }\n      return null;\n    }\n  }\n});\nregister(A, 'A');\n\nclass Mask extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('mask', node), attrs);\n  }\n\n  // Unmask all masked elements and remove itself\n  remove() {\n    // unmask all targets\n    this.targets().forEach(function (el) {\n      el.unmask();\n    });\n\n    // remove mask from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [mask*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    mask: wrapWithAttrCheck(function () {\n      return this.defs().put(new Mask());\n    })\n  },\n  Element: {\n    // Distribute mask to svg element\n    masker() {\n      return this.reference('mask');\n    },\n    maskWith(element) {\n      // use given mask or create a new one\n      const masker = element instanceof Mask ? element : this.parent().mask().add(element);\n\n      // apply mask\n      return this.attr('mask', 'url(#' + masker.id() + ')');\n    },\n    // Unmask element\n    unmask() {\n      return this.attr('mask', null);\n    }\n  }\n});\nregister(Mask, 'Mask');\n\nclass Stop extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('stop', node), attrs);\n  }\n\n  // add color stops\n  update(o) {\n    if (typeof o === 'number' || o instanceof SVGNumber) {\n      o = {\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      };\n    }\n\n    // set attributes\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', new SVGNumber(o.offset));\n    return this;\n  }\n}\nregisterMethods({\n  Gradient: {\n    // Add a color stop\n    stop: function (offset, color, opacity) {\n      return this.put(new Stop()).update(offset, color, opacity);\n    }\n  }\n});\nregister(Stop, 'Stop');\n\nfunction cssRule(selector, rule) {\n  if (!selector) return '';\n  if (!rule) return selector;\n  let ret = selector + '{';\n  for (const i in rule) {\n    ret += unCamelCase(i) + ':' + rule[i] + ';';\n  }\n  ret += '}';\n  return ret;\n}\nclass Style extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('style', node), attrs);\n  }\n  addText(w = '') {\n    this.node.textContent += w;\n    return this;\n  }\n  font(name, src, params = {}) {\n    return this.rule('@font-face', {\n      fontFamily: name,\n      src: src,\n      ...params\n    });\n  }\n  rule(selector, obj) {\n    return this.addText(cssRule(selector, obj));\n  }\n}\nregisterMethods('Dom', {\n  style(selector, obj) {\n    return this.put(new Style()).rule(selector, obj);\n  },\n  fontface(name, src, params) {\n    return this.put(new Style()).font(name, src, params);\n  }\n});\nregister(Style, 'Style');\n\nclass TextPath extends Text {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('textPath', node), attrs);\n  }\n\n  // return the array of the path track element\n  array() {\n    const track = this.track();\n    return track ? track.array() : null;\n  }\n\n  // Plot path if any\n  plot(d) {\n    const track = this.track();\n    let pathArray = null;\n    if (track) {\n      pathArray = track.plot(d);\n    }\n    return d == null ? pathArray : this;\n  }\n\n  // Get the path element\n  track() {\n    return this.reference('href');\n  }\n}\nregisterMethods({\n  Container: {\n    textPath: wrapWithAttrCheck(function (text, path) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = this.text(text);\n      }\n      return text.path(path);\n    })\n  },\n  Text: {\n    // Create path for text to run on\n    path: wrapWithAttrCheck(function (track, importNodes = true) {\n      const textPath = new TextPath();\n\n      // if track is a path, reuse it\n      if (!(track instanceof Path)) {\n        // create path element\n        track = this.defs().path(track);\n      }\n\n      // link textPath to path and add content\n      textPath.attr('href', '#' + track, xlink);\n\n      // Transplant all nodes from text to textPath\n      let node;\n      if (importNodes) {\n        while (node = this.node.firstChild) {\n          textPath.node.appendChild(node);\n        }\n      }\n\n      // add textPath element as child node and return textPath\n      return this.put(textPath);\n    }),\n    // Get the textPath children\n    textPath() {\n      return this.findOne('textPath');\n    }\n  },\n  Path: {\n    // creates a textPath from this path\n    text: wrapWithAttrCheck(function (text) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = new Text().addTo(this.parent()).text(text);\n      }\n\n      // Create textPath from text and path and return\n      return text.path(this);\n    }),\n    targets() {\n      return baseFind('svg textPath').filter(node => {\n        return (node.attr('href') || '').includes(this.id());\n      });\n\n      // Does not work in IE11. Use when IE support is dropped\n      // return baseFind('svg textPath[*|href*=' + this.id() + ']')\n    }\n  }\n});\nTextPath.prototype.MorphArray = PathArray;\nregister(TextPath, 'TextPath');\n\nclass Use extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('use', node), attrs);\n  }\n\n  // Use element as a reference\n  use(element, file) {\n    // Set lined element\n    return this.attr('href', (file || '') + '#' + element, xlink);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a use element\n    use: wrapWithAttrCheck(function (element, file) {\n      return this.put(new Use()).use(element, file);\n    })\n  }\n});\nregister(Use, 'Use');\n\n/* Optional Modules */\nconst SVG = makeInstance;\nextend([Svg, Symbol, Image, Pattern, Marker], getMethodsFor('viewbox'));\nextend([Line, Polyline, Polygon, Path], getMethodsFor('marker'));\nextend(Text, getMethodsFor('Text'));\nextend(Path, getMethodsFor('Path'));\nextend(Defs, getMethodsFor('Defs'));\nextend([Text, Tspan], getMethodsFor('Tspan'));\nextend([Rect, Ellipse, Gradient, Runner], getMethodsFor('radius'));\nextend(EventTarget, getMethodsFor('EventTarget'));\nextend(Dom, getMethodsFor('Dom'));\nextend(Element, getMethodsFor('Element'));\nextend(Shape, getMethodsFor('Shape'));\nextend([Container, Fragment], getMethodsFor('Container'));\nextend(Gradient, getMethodsFor('Gradient'));\nextend(Runner, getMethodsFor('Runner'));\nList.extend(getMethodNames());\nregisterMorphableType([SVGNumber, Color, Box, Matrix, SVGArray, PointArray, PathArray, Point]);\nmakeMorphable();\n\nexports.A = A;\nexports.Animator = Animator;\nexports.Array = SVGArray;\nexports.Box = Box;\nexports.Circle = Circle;\nexports.ClipPath = ClipPath;\nexports.Color = Color;\nexports.Container = Container;\nexports.Controller = Controller;\nexports.Defs = Defs;\nexports.Dom = Dom;\nexports.Ease = Ease;\nexports.Element = Element;\nexports.Ellipse = Ellipse;\nexports.EventTarget = EventTarget;\nexports.ForeignObject = ForeignObject;\nexports.Fragment = Fragment;\nexports.G = G;\nexports.Gradient = Gradient;\nexports.Image = Image;\nexports.Line = Line;\nexports.List = List;\nexports.Marker = Marker;\nexports.Mask = Mask;\nexports.Matrix = Matrix;\nexports.Morphable = Morphable;\nexports.NonMorphable = NonMorphable;\nexports.Number = SVGNumber;\nexports.ObjectBag = ObjectBag;\nexports.PID = PID;\nexports.Path = Path;\nexports.PathArray = PathArray;\nexports.Pattern = Pattern;\nexports.Point = Point;\nexports.PointArray = PointArray;\nexports.Polygon = Polygon;\nexports.Polyline = Polyline;\nexports.Queue = Queue;\nexports.Rect = Rect;\nexports.Runner = Runner;\nexports.SVG = SVG;\nexports.Shape = Shape;\nexports.Spring = Spring;\nexports.Stop = Stop;\nexports.Style = Style;\nexports.Svg = Svg;\nexports.Symbol = Symbol;\nexports.Text = Text;\nexports.TextPath = TextPath;\nexports.Timeline = Timeline;\nexports.TransformBag = TransformBag;\nexports.Tspan = Tspan;\nexports.Use = Use;\nexports.adopt = adopt;\nexports.assignNewId = assignNewId;\nexports.clearEvents = clearEvents;\nexports.create = create;\nexports.defaults = defaults;\nexports.dispatch = dispatch;\nexports.easing = easing;\nexports.eid = eid;\nexports.extend = extend;\nexports.find = baseFind;\nexports.getClass = getClass;\nexports.getEventTarget = getEventTarget;\nexports.getEvents = getEvents;\nexports.getWindow = getWindow;\nexports.makeInstance = makeInstance;\nexports.makeMorphable = makeMorphable;\nexports.mockAdopt = mockAdopt;\nexports.namespaces = namespaces;\nexports.nodeOrNew = nodeOrNew;\nexports.off = off;\nexports.on = on;\nexports.parser = parser;\nexports.regex = regex;\nexports.register = register;\nexports.registerMorphableType = registerMorphableType;\nexports.registerWindow = registerWindow;\nexports.restoreWindow = restoreWindow;\nexports.root = root;\nexports.saveWindow = saveWindow;\nexports.utils = utils;\nexports.windowEvents = windowEvents;\nexports.withWindow = withWindow;\nexports.wrapWithAttrCheck = wrapWithAttrCheck;\n//# sourceMappingURL=svg.node.cjs.map\n","import './draggable';\r\nimport './input-box';\r\nimport './node-x-btn';\r\nimport './connector';\r\nimport './comment-drag-handle';\r\nimport './comment-input';\r\nimport './connection-line';","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(8156);\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","moduleId","cachedModule","__webpack_module_cache__","undefined","__webpack_modules__","call","obj","name","Object","prototype","hasOwnProperty","Constants","Renderer","Representer","RepresenterNode","UserState","state","callbacks","constructor","Set","Map","setState","has","add","triggerCallbacks","removeState","delete","hasState","onStateChange","cb","set","get","push","addedOrRemoved","cbs","userState","container","visible","toolbox","document","createElement","className","workspace","_wsTop","appendChild","body","fill","nodes","clear","forEach","node","headlessNode","type","nodeEl","createNodeElement","show","textContent","labelText","applyNodeStyles","colors","primary","addEventListener","e","onNodeMouseDown","el","bgColor","style","backgroundColor","parseColor","padding","cursor","renderer","constants","c","fontFamily","FONT_FAMILY","fontSize","FONT_SIZE","color","FONT_COLOR","ghostEl","createGhostNode","moveGhost","ev","left","clientX","top","clientY","releaseGhost","removeEventListener","dropNode","remove","preventDefault","position","pointerEvents","rect","svg","getBoundingClientRect","right","bottom","x","wsX","y","wsY","screenToWorkspace","nodews","spawnAt","argName","arguments","setFieldValue","drawNode","id","display","hide","innerHTML","RendererMap","atlas","NAME","apollo","isBrowser","FontManager","loadGoogleFont","register","cls","FieldMap","unregister","Kabel","env","UIX","events","windowListeners","addWindowListener","removeWindowListener","clearWindowListeners","Themes","Classic","Dark","ContextMenu","Utils","Path","waitFrames","SVG","UID","EventEmitter","hasProp","styler","Styler","escapeHTML","unescapeHTML","Widget","CategoryColors","Connection","Coordinates","Field","DummyField","NumberField","OptConnectField","TextField","inject","injectHeadless","createHeadlessNode","InjectMsg","clearMainWorkspace","getMainWorkspace","setMainWorkspace","NodeSvg","Nodes","Widgets","WorkspaceSvg","Workspace","WorkspaceController","WASDController","nodeRendering","rendererMap","RMap","Apollo","Atlas","RendererConstants","commentRendering","CommentModel","CommentRenderer","Dropdown","defineProperty","v","UIStyles","workspaceBGColor","toolboxCategoriesBG","width","height","background","overflowY","toolboxFlyoutBG","borderRadius","boxShadow","initCommentInput","element","rawArgs","getSelectionRange","start","Math","min","cursorPos","anchorPos","end","max","hasSelection","deleteSelection","buffer","slice","measureTextWidth","text","tempText","getSvg","font","size","family","bbox","measureTextBbox","updateText","hasSel","txt","tspan","replace","attr","Array","from","childNodes","child","nodeType","setAttribute","leading","parseFloat","textBeforeStart","textBeforeEnd","highlightX","highlightWidth","highlightY","highlightH","selectionRect","parent","parentNode","insertBefore","move","editing","caretXOffset","caretY","caretH","caretLine","rectW","ceil","PADDING_X","rectH","PADDING_Y","comment","_tempInputBBox","textX","textY","startEditing","getText","length","rectBox","zoom","getWs","getZoom","clickX","cumulativeWidth","i","charWidth","skipNextClick","onKeyDown","onClickOutside","stopEditing","commit","capture","setTextNoRedraw","getWorkspace","redraw","key","shiftKey","ctrlKey","metaKey","targ","target","args","onRectDown","onTextDown","on","off","registerEvent","randBytes","len","cryptoAPI","getRandomValues","buf","Uint8Array","floor","random","uuidv4","g","globalThis","crypto","randomUUID","b","hex","toString","padStart","ulid","date","Date","now","time48","t","BigInt","Number","out","acc","bits","CROCK32","rnd","nanoid","alphabet","DEFAULT_ALPHABET","Error","mask","log2","idx","shortId","ts","_ctr","map","join","strategy","opts","s","_text","_isWorkspaceComment","_parent","svgGroup","relativeCoords","svgLine","generateUID","value","setText","res","isHeadless","clearComments","drawComments","isNodeComment","isWorkspaceComment","toJson","coords","fromJson","data","COMMENT_G_TAG","COMMENT_LINE_TAG","COMMENT_TEXT_EL","COMMENT_DRAG_EL","RENDERER_TAG_EL","encodeForSvg","ensureTspansPreserve","textEl","drawComment","_removeExistingElements","group","addClass","JSON","stringify","isws","displayEncoded","_createTextElement","_createBackgroundRect","dragHandle","_createDragHandle","_addEventer","screenPos","_computeScreenPosition","transform","_drawLineToNode","refreshCommentTransforms","getComments","_nodeDB","values","n","getComment","filter","userSelect","webkitUserSelect","msUserSelect","MozUserSelect","handleRadius","stroke","radius","back","circle","addElement","tagElement","workspaceX","workspaceY","nodePos","workspaceToScreen","ws","nodeWSPos","nodeBBox","nodeTopCenter","parentWSPos","commentRelPos","commentAbsX","commentAbsY","commentBBox","commentTopCenter","line","dasharray","clearAllComments","find","destroyByTag","_","clearCommentLines","drawAllComments","_constants","_currentNode","_nodeGroup","_nodeDraw","_ws","_drawStates","_commentDrawer","representer","constantOverrides","NODE_G_TAG","ELEMENT_TAG","CONN_LINE_TAG","CONNECTOR_TAG","LINE_X_MARK_TAG","BACKGROUND_PATTERN","overrides","init","initCommentRenderer","initRepresenter","initConstants","setConnect","pendingConnections","setConstants","assign","secondary","tertiary","restColors","getNodeBaseMeasurements","NODE_BASE_WIDTH","NODE_BASE_HEIGHT","anchor","opacity","measureTextHeight","measureRawField","textW","FIELD_RAW_BASE_WIDTH","INPUT_BOX_PADDING","FIELD_RAW_BASE_HEIGHT","measureLabel","field","label","getLabel","measureRaw","hasRaw","raw","getValue","measureCustom","isCustomEditor","m","measureMyself","getFieldMeasurementPadding","FIELD_SPACEX","measureField","parts","w","h","measureNodeDimensions","base","measureBaseAndLabel","fieldResult","measureFields","TOPBAR_HEIGHT","FIELD_SPACEY","FOOTER_HEIGHT","fields","startY","startWidth","startHeight","totalWidth","totalHeight","allFields","FIELD_MARGIN_X","FIELD_MARGIN_Y","labelW","TOPBAR_LABEL_MARGIN_X","renderNode","nodeIdOrNode","startNode","build","storeState","getNode","drawState","nodeGroup","fieldPosY","drawFieldRaw","fieldGroup","startX","getDisplayValue","FIELD_RAW_COLOR","FIELD_RAW_OUTLINE_COLOR","FIELD_RAW_OUTLINE_STROKE","INPUT_BOX_TEXT_ANCHOR","FIELD_RAW_TEXT_COLOR","rawBox","box","offsetY","drawFieldLabel","LABEL_SPACING","drawNodeXButton","measurements","btnSize","xGroup","class","weight","translateX","translateY","xButton","drawConnector","nodeBg","side","CONNECTOR_TRIANGLE","triSize","CONNECTOR_TRI_SIZE","path","roundedTri","rotatePath","tri","offsetX","CONNECTOR_RADIUS","circlePath","circ","drawNodeLabel","TOPBAR_LABEL_BOLDED","TOPBAR_LABEL_MARGIN_Y","createNodeGroup","drawNodeBase","drawNodeTopbar","getNodeColors","makeNodeDraggable","topbar","createFieldGroup","drawAllFieldsForNode","drawPreviousNextConnections","CORNER_RADIUS","bg","roundedRect","NODE_BG_COLOR","NODE_OUTLINE_COLOR","shadow","dragel","fieldsGroup","fieldCol","drawFieldForNode","fm","alignX","xUsed","drawMyself","measuredWidth","measuredHeight","rawData","cBubbleData","hasConnectable","connection","halfHeight","absY","c3","FIELD_CONN_COLOR","to","getTo","previousConnection","fromCircle","originCircle","originConn","connector","connState","onDraw","nodeMeasurements","cY","c1","resolveConnectable","getFrom","_fillOtherNodeConnectorCircle","nextConnection","c2","refreshComments","applyZoomToNode","nodeG","refreshNodeTransforms","nodeGroups","refreshConnectionLines","clearLines","drawLinesForAllNodes","tertirary","category","fillAllNodeConnectorBubbles","connPair","match","flatMap","p","toCircle","connectable","fromConn","isPrevious","conn","wsSvg","drawnCircles","fromBox","rbox","toBox","cx","cy","endX","endY","CONNECTOR_LINE_WIDTH","toConn","mark","clearScreen","children","isBackground","hasClass","isDefs","tagName","isBgRect","classes","includes","BACKGROUND_CLASS","undoPendingConnsFor","conn0","rerenderNode","findIndex","pendingConn","splice","getRaw","isSpace","ch","SPECIAL_SPACES","indexOf","isDigit","code","isDigitStart","State","index","result","param","err","segmentStart","skipSpaces","charCodeAt","scanFlag","scanParam","zeroFirst","hasCeiling","hasDecimal","hasDot","finalizeSegment","cmd","cmdLC","toLowerCase","params","concat","paramCounts","scanSegment","cmdCode","is_arc","comma_found","need_params","isCommand","a","l","r","q","z","svgPath","segments","options","static","WIDGET_GLOBAL_ID","border","zIndex","html","setCoords","setHTML","reanimate","_addWidgetToDB","destroy","_delWidgetFromDB","undoStack","redoStack","isRecording","emitChange","recordHistory","undo","current","pop","prev","redo","entry","canUndo","canRedo","message","Ellipse","rx","ry","ax","epsilon","torad","PI","cos","sin","ma","J","K","D","JK","sqrt","L","l1","l2","abs","atan","isDegenerate","WorkspaceCoords","super","theme","grid","_camera","_root","_backgroundRect","noRedraw","controller","_widgetDB","_ctxMenu","_commentDB","history","recordHistoryRecord","_didMove","moveListeners","dragState","wsTop","addTo","RClass","resolve","rendererOverrides","themeKey","Controller","controls","wasd","resolveController","initUndoRedo","_initBackground","setTheme","structuredClone","updateStyles","didMove","setDragState","currentX","currentY","isDragging","lastX","lastY","deltaX","deltaY","beginDrag","updateDrag","endDrag","fireMoveListeners","addMoveListener","listener","removeMoveListener","toggleHistory","untoggleHistory","console","error","_updateBackgroundTransform","updateTransform","cloneNode","nodeSvg","fromNode","wdgt","newWidget","getWidget","getContentSize","getSize","refresh","drawAllNodes","nodeId","workX","workY","screenX","screenY","addNode","warn","newNode","derefNode","disconnectTo","ConnectableField","disconnect","next","disconnectFrom","removeNodeById","removeNode","pan","dx","dy","addComment","model","redrawComments","removeComment","commentOrId","json","recordBigEvent","entries","circular","deserialize","topLevel","serialize","startsWith","split","parseInt","trim","isArray","halfW","points","step","sides","angle","rotate","Matrix","operations","matrix","scale","translate","skewX","skewY","CMD_SPLIT_RE","PARAMS_SPLIT_RE","transformString","item","moveSpeed","doAccelerate","accelSpeed","friction","velocity","zoomSpeed","minZoom","maxZoom","isFalloff","wasdSmooth","wasdAccelerate","wasdFriction","onWheel","bind","passive","canMove","update","inputX","inputY","keysDown","_throttledFireDidMove","refreshPos","newZoom","mouseX","mouseY","wsMouse","setZoom","weights","loadedFonts","linkId","getElementById","link","rel","weightsParam","href","head","fontPromises","fonts","load","promise","Promise","all","then","handleClick","xMark","pair","midX","midY","center","editable","connectionBubble","canEditConnector","setEditable","val","canEdit","setName","Boolean","getName","setLabel","fieldVisualInfo","setValue","deep","alreadyProcessed","_deserialize","setTo","String","fldType","setFieldType","fld_type","DropdownField","_selected","_isOpen","toggle","toggleDropdown","click","getOwner","closeDropdown","openDropdown","items","option","onSelect","original","hideIfOwner","getSelected","setOptions","RendererCls","optName","list","keys","input","pattern","spacing","dotSize","strokeWidth","defs","findOne","patternUnits","resize","scaledSpacing","scaledDot","cam","patternTransform","updateOptions","newOpts","xBtnGroup","onClick","combine","m1","m2","queue","cache","tx","ty","sx","sy","rad","tan","toArray","calc","isRelative","mouseBtns","mousePos","lastMousePos","wheelDelta","movedListeners","_lastMoveFire","_moveThrottleMs","_queuedMove","_moveTimeout","_updateInt","_setupListeners","setInterval","fireDidMove","queueMicrotask","performance","wait","setTimeout","window","button","setCamera","pos","centerOn","wsSize","stop","clearInterval","log","ApolloRenderer","ElEMENT_TAG","dogear","SHAPES","Dogear","cutW","Width","Height","drawDogEar","pathDef","PathMain","dogEar","front","drawPrimaryConnector","CONNECTOR_COLOR","textBBox","paddedWidth","styles","appendStyles","css","styleEl","removeStyles","hasStyles","kabelStyles","querySelector","contains","msg","wrn","info","proto","isNode","process","versions","isWebWorker","self","importScripts","_fieldColumn","getCommentText","setCommentText","getFieldByName","fld","getField","getFieldValue","getFieldDisplayValue","emit","INITING","removed","REMOVING","hasCategoryStyle","getCategoryName","getStyle","_appendFieldItem","jsonInit","primaryColor","secondaryColor","tertiaryColor","applyJsonArguments","FieldConstructor","appendConnection","appendNumber","appendText","appendOptLink","setCategoryName","setStyle","setColor","setLabelText","setConnection","prevOrNext","stringed","cast","other","newField","FieldCls","_serializeConnection","returned","connected","fieldNode","serialized","flat","processNode","copy","prevNode","nextNode","allNodes","explicit","fldData","setFrom","refId","maybe","ContextOptsRegistry","registerOption","opt","onHoverStart","onHoverEnd","showFor","unregisterOption","confirm","widget","classList","fn","k","scroll","blur","focus","visibilitychange","pointerlockchange","beforeunload","event","handleEvent","listeners","handler","payload","once","wrapper","wsOptions","_flyout","_contents","_categories","getOptions","contents","initCategoryToolbox","initFlyoutToolbox","applyStyles","cData","mainws","draggableStore","onMouseDown","onMouseMove","onMouseUp","ondrag","movementX","movementY","mouseWS","newX","newY","onmove","enddrag","dragTarget","frames","callback","count","requestAnimationFrame","DropdownContainer","owner","rootEl","constraint","offset","currentRemoveListener","updatePosition","setContent","groupRect","scrollX","scrollY","onclick","isVisible","getCurrent","dropdownContainer","onPointerDown","pointerWS","startRelX","startRelY","onPointerMove","onPointerUp","Eventer","elements","eventRegistry","setupFn","tags","tagList","reg","tag","destroyed","destroyFn","types","typeList","setupElement","destroyElement","Function","eventer","unit_vector_angle","ux","uy","vx","vy","dot","acos","approximate_unit_arc","theta1","delta_theta","alpha","x1","y1","x2","y2","TAU","fa","fs","phi","sin_phi","cos_phi","x1p","y1p","lambda","cc","rx_sq","ry_sq","x1p_sq","y1p_sq","radicant","cxp","cyp","v1x","v1y","v2x","v2y","get_arc_center","curve","xp","yp","NodePrototypes","default","clone","distanceTo","toObject","PADDING_BIG","PADDING_MEDIUM","PADDING_SMALL","CONNECTION_STROKE_WIDTH","CONNECTION_STROKE_COLOR_CHOICE","CONNECTOR_LINE_CURVED","ZOOM_BASE","SvgPath","pstate","pathParse","__stack","transformParse","a2c","ellipse","src","sgm","__matrix","iterate","__evaluateStack","prevCmd","cmdSkipped","segment","degrees","round","d","contourStartDeltaX","contourStartDeltaY","toFixed","iterator","keepLazyStack","j","newSegments","replacements","needReplace","countourStartX","countourStartY","nameUC","toUpperCase","nameLC","unarc","new_segments","nextX","nextY","unshort","prevControlX","prevControlY","prevSegment","curControlX","curControlY","cState","one","two","isPrev","removeClass","connA","connB","_rowDiv","_toolbox","_makeDiv","btn","stopPropagation","setDisabled","disabled","toJSON","svgState","getConstant","moveTo","setScale","applyTransform","highlight","prevFrom","source","isolate","ApolloConstants","rectHeight","caretX","repNode","removeProperty","initListeners","renderOptions","HTMLElement","SVGSVGElement","elementFromPoint","hasAttribute","getAttribute","dta","parse","parentElement","outline","registerMethods","_name","addMethodNames","getOwnPropertyNames","methods$1","getMethodsFor","_names","names","array","block","il","radians","unCamelCase","capitalize","charAt","proportionalSize","getOrigin","o","origin","ox","originX","oy","originY","condX","condY","registerWindow","win","doc","globals","saveWindow","save","restoreWindow","getWindow","create","ns","createElementNS","makeInstance","isHTML","Base","adopter","firstChild","removeChild","nodeOrNew","Node","ownerDocument","defaultView","adopt","instance","nodeName","Fragment","asRoot","getClass","eid","did","assignNewId","extend","modules","methods","wrapWithAttrCheck","apply","componentHex","component","integer","is","object","space","hueToRgb","closeEnough","parser","cssText","documentElement","isNulledBox","getBox","getBBoxFn","retry","baseFind","query","List","querySelectorAll","getEvents","getEventHolder","windowEvents","getEventTarget","clearEvents","binding","bag","delimiter","_svgjsListenerId","listenerId","namespace","dispatch","Event","CustomEvent","detail","cancelable","dispatchEvent","noop","x$3","y$3","cx$1","cy$1","width$2","SVGNumber","divide","height$2","_element","fx","fy","makeSetterGetter","f","recalculate","duration","_duration","overshoot","_overshoot","pi","os","zeta","wn","segmentComplete","segmentParameters","startNewSegment","token","inNumber","finalizeNumber","pathLetter","isPathLetter","test","lastCommand","small","isSmall","inSegment","number","pointSeen","hasExponent","absolute","command","pathHandlers","p0","makeAbsolut","isArcFlag","isArc","isExponential","lastToken","registerMorphableType","morphableTypes","makeMorphable","Morphable","fromArray","arr","toConsumable","morph","stepper","context","mergeTransforms","netTransform","_transformationRunners","runners","getRunnerTransform","reduce","lmultiply","merge","_frameId","descriptiveElements","isDescriptive","writeDataToDom","defaults","cloned","valueOf","removeAttribute","utils","__proto__","xmlns","xlink","namespaces","siblings","forward","backward","before","after","insertAfter","numberAndUnit","rgb","reference","transforms","whitespace","isHex","isRgb","isBlank","isNumber","isImage","regex","toggleClass","ret","cased","getPropertyValue","setProperty","attributes","remember","memory","forget","_memory","Color","inputs","isColor","mode","grey","cmyk","_a","_b","_c","hsl","isGrey","delta","_d","getParameters","noWhitespace","exec","hexParse","substring","sixDigitHex","components","lab","xyz","lch","atan2","dToR","yL","xL","zL","ct","mx","nm","rU","gU","bU","pow","bd","toHex","_clamped","toRgb","rV","gV","bV","r255","g255","b255","rL","gL","bL","xU","yU","zU","Point","transformO","isMatrixLike","formatTransforms","flipBoth","flip","flipX","flipY","skew","isFinite","scaleX","scaleY","shear","theta","around","px","positionX","NaN","py","positionY","relative","relativeX","relativeY","matrixMultiply","aroundO","translateO","lmultiplyO","decompose","determinant","ccw","thetaRad","st","lam","equals","comp","axis","flipO","scaleO","Element","matrixify","inverse","inverseO","det","na","nb","nc","nd","ne","nf","multiply","multiplyO","rotateO","shearO","lx","skewO","ly","transformer","Box","addOffset","pageXOffset","pageYOffset","isNulled","xMin","Infinity","xMax","yMin","yMax","viewbox","level","point","clientWidth","clientHeight","zoomX","zoomY","zoomAmount","MAX_SAFE_INTEGER","each","fnOrMethodName","reserved","attrs","EventTarget","defaultPrevented","fire","timeline","ease","delay","SVGArray","toSet","convert","unit","isNaN","minus","plus","times","colorAttributes","hooks","Dom","removeNamespace","SVGElement","put","hasChildNodes","lastChild","assignNewIds","nodeClone","first","htmlOrFn","outerHTML","xml","last","matches","selector","matcher","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","putIn","removeElement","replaceChild","precision","factor","svgOrFn","outerSVG","words","wrap","xmlOrFn","outerXML","_this","well","fragment","createDocumentFragment","firstElementChild","nodeValue","curr","_val","hook","setAttributeNS","rebuild","dom","setData","dmove","parents","until","isSelector","getBBox","screenCTM","inside","ctm","getCTM","isRoot","getScreenCTM","sugar","prefix","extension","mat","direction","getTotalLength","pointAt","getPointAtLength","untransform","str","kv","reverse","toParent","pCtm","toRoot","decomposed","Container","flatten","ungroup","Defs","Shape","circled","gradiented","Gradient","targets","url","gradient","Pattern","Image","img","image","PointArray","maxX","maxY","minX","minY","toLine","pointed","MorphArray","Line","plot","Marker","orient","ref","marker","easing","bezier","steps","stepPosition","jumps","beforeFlag","jumping","Stepper","done","Ease","dt","Spring","acceleration","newPosition","PID","windup","integral","_windup","P","I","M","H","V","C","S","Q","T","A","Z","mlhvqtcsaz","jl","pathDelimiters","PathArray","toAbsolute","pathParser","arrayToString","getClassForType","NonMorphable","ObjectBag","_stepper","_from","_to","_type","_context","_morphObj","at","_set","align","TransformBag","sortByKey","defaultObject","toDelete","objOrArr","Type","sort","shift","num","_array","poly","Polygon","polygon","Polyline","polyline","Rect","Queue","_first","_last","Animator","nextDraw","timeouts","immediates","timer","frame","run","_draw","timeout","time","immediate","cancelFrame","clearTimeout","cancelImmediate","nextTimeout","lastTimeout","nextFrame","lastFrame","nextImmediate","makeSchedule","runnerInfo","runner","defaultSource","Timeline","timeSource","_timeSource","terminate","active","_nextFrame","finish","getEndTimeOfTimeline","pause","getEndTime","lastRunnerInfo","getLastRunnerInfo","lastDuration","_time","endTimes","_runners","getRunnerInfoById","_lastRunnerId","_runnerIds","_paused","_continue","persist","dtOrForever","_persist","play","updateTime","yes","currentSpeed","speed","positive","schedule","when","absoluteStartTime","endTime","unschedule","seek","_speed","_lastSourceTime","immediateStep","_stepImmediate","_step","_stepFn","dtSource","dtTime","_lastStepTime","reset","runnersLeft","dtToStart","_startTime","_timeline","Runner","_queue","_isDeclarative","_history","enabled","_lastTime","_reseted","transformId","_haveReversed","_reverse","_loopsDone","_swing","_wait","_times","sanitise","swing","addTransform","animate","loop","clearTransform","clearTransformsFromQueue","isTransform","during","_prepareRunner","loops","loopDuration","loopsDone","partial","swinging","backwards","uncliped","swingForward","progress","initFn","runFn","retargetFn","initialiser","retarget","initialised","finished","running","_lastPosition","justStarted","justFinished","declarative","converged","_initialise","_run","needsIt","_rememberMorpher","method","morpher","caller","positionOrDt","allfinished","_tryRetarget","extra","FakeRunner","mergeWith","RunnerArray","ids","clearBefore","deleteCnt","edit","newRunner","getByID","lastRunner","by","_clearTransformRunnersBefore","currentRunner","_currentTransform","_addRunner","styleAttr","nameOrAttrs","newToAttrs","newKeys","differences","addedFromAttrs","oldFromAttrs","oldToAttrs","newLevel","newPoint","affine","isMatrix","currentAngle","startTransform","rTarget","rCurrent","possibilities","distances","shortest","affineParameters","newTransforms","_queueNumber","ay","_queueNumberDelta","newTo","_queueObject","amove","Svg","version","nested","Symbol","symbol","textable","_build","getComputedTextLength","plain","createTextNode","Text","_rebuild","blankLineOffset","getComputedStyle","newLined","firstLine","newLine","Tspan","Circle","ClipPath","unclip","clip","clipper","clipWith","ForeignObject","foreignObject","containerGeometry","G","unlink","linker","linkTo","Mask","unmask","masker","maskWith","Stop","Style","addText","rule","cssRule","fontface","TextPath","track","pathArray","textPath","importNodes","Use","use","file","mockAdopt","mock","withWindow","definition","enumerable","prop","toStringTag"],"sourceRoot":""}