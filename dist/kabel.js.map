{"version":3,"file":"kabel.js","mappings":"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","sources":["webpack://Kabel/webpack/universalModuleDefinition","webpack://Kabel/webpack/bootstrap","webpack://Kabel/./util/has-prop.ts","webpack://Kabel/./util/user-state.ts","webpack://Kabel/./src/flyout.ts","webpack://Kabel/./src/core.ts","webpack://Kabel/./events/comment-input.ts","webpack://Kabel/./util/uid.ts","webpack://Kabel/./util/escape-html.ts","webpack://Kabel/./src/comment.ts","webpack://Kabel/./comment-renderer/renderer.ts","webpack://Kabel/./renderers/renderer.ts","webpack://Kabel/./node_modules/svgpath/lib/path_parse.js","webpack://Kabel/./util/unescape-html.ts","webpack://Kabel/./src/widget.ts","webpack://Kabel/./node_modules/svgpath/lib/ellipse.js","webpack://Kabel/./src/workspace-coords.ts","webpack://Kabel/./src/workspace-svg.ts","webpack://Kabel/./util/parse-color.ts","webpack://Kabel/./util/path.ts","webpack://Kabel/./node_modules/svgpath/lib/transform_parse.js","webpack://Kabel/./controllers/wasd.ts","webpack://Kabel/./events/connection-line.ts","webpack://Kabel/./src/field.ts","webpack://Kabel/./src/renderer-map.ts","webpack://Kabel/./events/node-x-btn.ts","webpack://Kabel/./src/colors.ts","webpack://Kabel/./node_modules/svgpath/lib/matrix.js","webpack://Kabel/./controllers/base.ts","webpack://Kabel/./util/styler.ts","webpack://Kabel/./src/inject.ts","webpack://Kabel/./src/headless-node.ts","webpack://Kabel/./src/nodesvg.ts","webpack://Kabel/./src/ctx-menu-registry.ts","webpack://Kabel/./util/emitter.ts","webpack://Kabel/./src/toolbox.ts","webpack://Kabel/./src/main-workspace.ts","webpack://Kabel/./events/draggable.ts","webpack://Kabel/./util/wait-anim-frames.ts","webpack://Kabel/./src/prototypes.ts","webpack://Kabel/./src/dropdown-menu.ts","webpack://Kabel/./src/widget-prototypes.ts","webpack://Kabel/./events/comment-drag-handle.ts","webpack://Kabel/./util/eventer.ts","webpack://Kabel/./node_modules/svgpath/lib/a2c.js","webpack://Kabel/./node_modules/svgpath/index.js","webpack://Kabel/./src/index.ts","webpack://Kabel/./src/coordinates.ts","webpack://Kabel/./renderers/constants.ts","webpack://Kabel/./node_modules/svgpath/lib/svgpath.js","webpack://Kabel/./src/styles.css","webpack://Kabel/./events/connector.ts","webpack://Kabel/./src/category.ts","webpack://Kabel/./src/connection.ts","webpack://Kabel/./events/input-box.ts","webpack://Kabel/./src/context-menu.ts","webpack://Kabel/./node_modules/@svgdotjs/svg.js/dist/svg.node.cjs","webpack://Kabel/./events/events.ts","webpack://Kabel/webpack/runtime/define property getters","webpack://Kabel/webpack/runtime/hasOwnProperty shorthand","webpack://Kabel/webpack/runtime/make namespace object","webpack://Kabel/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Kabel\"] = factory();\n\telse\n\t\troot[\"Kabel\"] = factory();\n})(this, () => {\nreturn ","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\r\nexport default function hasProp(obj: object, name: string) {\r\n    return Object.prototype.hasOwnProperty.call(obj, name)\r\n}","type StateChangeCallback = (addedOrRemoved: 0 | 1) => void;\r\n\r\nclass UserState {\r\n\tprivate state: Set<string>;\r\n\tprivate callbacks: Map<string, StateChangeCallback[]>;\r\n\r\n\tconstructor() {\r\n\t\tthis.state = new Set();\r\n\t\tthis.callbacks = new Map();\r\n\t}\r\n\r\n\t/** Adds a state */\r\n\tsetState(name: string) {\r\n\t\tconst wasPresent = this.state.has(name);\r\n\t\tif (!wasPresent) {\r\n\t\t\tthis.state.add(name);\r\n\t\t\tthis.triggerCallbacks(name, 1);\r\n\t\t}\r\n\t}\r\n\r\n\t/** Removes a state */\r\n\tremoveState(name: string) {\r\n\t\tconst wasPresent = this.state.has(name);\r\n\t\tif (wasPresent) {\r\n\t\t\tthis.state.delete(name);\r\n\t\t\tthis.triggerCallbacks(name, 0);\r\n\t\t}\r\n\t}\r\n\r\n\t/** Checks if state is active */\r\n\thasState(name: string) {\r\n\t\treturn this.state.has(name);\r\n\t}\r\n\r\n\t/** Registers a callback for state changes */\r\n\tonStateChange(name: string, cb: StateChangeCallback) {\r\n\t\tif (!this.callbacks.has(name)) this.callbacks.set(name, []);\r\n\t\tthis.callbacks.get(name)!.push(cb);\r\n\t}\r\n\r\n\t/** Internal: triggers callbacks for a state */\r\n\tprivate triggerCallbacks(name: string, addedOrRemoved: 0 | 1) {\r\n\t\tconst cbs = this.callbacks.get(name);\r\n\t\tif (!cbs) return;\r\n\t\tfor (const cb of cbs) cb(addedOrRemoved);\r\n\t}\r\n}\r\nconst userState = new UserState();\r\nexport default userState;\r\nexport { \r\n    UserState\r\n};","import newHeadlessNode from \"./headless-node\";\r\nimport { TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nclass Flyout {\r\n    container: HTMLDivElement;\r\n    visible: boolean;\r\n    toolbox?: Toolbox;\r\n\r\n    constructor(toolbox?: Toolbox) {\r\n        this.toolbox = toolbox as Toolbox;\r\n\r\n        this.container = document.createElement('div');\r\n        this.container.className = 'KabelFlyout';\r\n\r\n        this.visible = false;\r\n\r\n        if (toolbox) {\r\n            toolbox.workspace._wsTop.appendChild(this.container);\r\n        } else {\r\n            document.body.appendChild(this.container);\r\n        }\r\n    }\r\n\r\n    fill(nodes: TblxNodeStruct[]) {\r\n        this.container.innerHTML = '';\r\n        nodes.forEach(node => {\r\n            let _headlessNode = newHeadlessNode(node.type as string);\r\n            if (!_headlessNode) return;\r\n\r\n            const nodeEl = document.createElement('div');\r\n            nodeEl.className = 'KabelFlyoutNode';\r\n            nodeEl.textContent = _headlessNode.labelText;\r\n            nodeEl.style.backgroundColor = parseColor(_headlessNode.colors.primary);\r\n            nodeEl.style.padding = '4px 8px';\r\n            nodeEl.style.cursor = 'pointer';\r\n            nodeEl.style.fontFamily = this.toolbox!.workspace!.renderer!.constants.FONT_FAMILY;\r\n            nodeEl.style.fontSize = `${this.toolbox!.workspace!.renderer!.constants.FONT_SIZE}px`;\r\n            nodeEl.style.color = parseColor(this.toolbox!.workspace!.renderer!.constants!.FONT_COLOR);\r\n            nodeEl.addEventListener('mousedown', (e) => {\r\n                if (!this.toolbox) return;\r\n\r\n                // create ghost node element\r\n                const ghostEl = document.createElement('div');\r\n                ghostEl.className = 'KabelGhostNode';\r\n                ghostEl.textContent = _headlessNode.labelText;\r\n                ghostEl.style.position = 'absolute';\r\n                ghostEl.style.pointerEvents = 'none';\r\n                ghostEl.style.backgroundColor = parseColor(_headlessNode.colors.primary);\r\n                ghostEl.style.padding = '4px 8px';\r\n                ghostEl.style.fontFamily = this.toolbox!.workspace!.renderer!.constants.FONT_FAMILY;\r\n                ghostEl.style.fontSize = `${this.toolbox!.workspace!.renderer!.constants.FONT_SIZE}px`;\r\n                ghostEl.style.color = parseColor(this.toolbox!.workspace!.renderer!.constants!.FONT_COLOR);\r\n\r\n                document.body.appendChild(ghostEl);\r\n\r\n                const moveGhost = (ev: MouseEvent) => {\r\n                    ghostEl.style.left = ev.clientX + 4 + 'px';\r\n                    ghostEl.style.top = ev.clientY + 4 + 'px';\r\n                };\r\n\r\n                const releaseGhost = (ev: MouseEvent) => {\r\n                    document.removeEventListener('mousemove', moveGhost);\r\n                    document.removeEventListener('mouseup', releaseGhost);\r\n\r\n                    // check if over workspace svg\r\n                    const svg = this.toolbox!.workspace.svg.node as SVGSVGElement;\r\n                    const rect = svg.getBoundingClientRect();\r\n                    if (\r\n                        ev.clientX >= rect.left &&\r\n                        ev.clientX <= rect.right &&\r\n                        ev.clientY >= rect.top &&\r\n                        ev.clientY <= rect.bottom\r\n                    ) {\r\n                        // convert to svg coordinates\r\n                        const svgX = ev.clientX - rect.left;\r\n                        const svgY = ev.clientY - rect.top;\r\n\r\n                        // convert to workspace coordinates\r\n                        const { x: wsX, y: wsY } = this.toolbox!.workspace.screenToWorkspace(svgX, svgY);\r\n\r\n                        // spawn node\r\n                        this.toolbox!.workspace.spawnAt(node.type as string, wsX, wsY);\r\n                    }\r\n\r\n                    // remove ghost element\r\n                    ghostEl.remove();\r\n                };\r\n\r\n                document.addEventListener('mousemove', moveGhost);\r\n                document.addEventListener('mouseup', releaseGhost);\r\n\r\n                e.preventDefault();\r\n            });\r\n\r\n            this.container.appendChild(nodeEl);\r\n        });\r\n        this.show();\r\n    }\r\n\r\n\r\n    show() {\r\n        this.container.style.display = 'block';\r\n        this.visible = true;\r\n    }\r\n\r\n    hide() {\r\n        this.container.style.display = 'none';\r\n        this.visible = false;\r\n    }\r\n\r\n    clear() {\r\n        this.container.innerHTML = '';\r\n    }\r\n}\r\n\r\nexport default Flyout;\r\n","import RendererConstants from \"../renderers/constants\";\r\nimport Renderer from \"../renderers/renderer\";\r\nimport CategoryColors from \"./colors\";\r\nimport Connection, {Connectable} from \"./connection\";\r\nimport Coordinates from \"./coordinates\";\r\nimport Field, { FieldOptions, FieldVisualInfo, AnyFieldCls, AnyField, DummyField, FieldMap, NumberField, OptConnectField, TextField } from \"./field\";\r\nimport inject, { InjectMsg, InjectOptions } from \"./inject\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport NodeSvg, {NodeJson, NodeEvents, InputFieldJson} from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport eventer, {Eventer} from \"../util/eventer\";\r\nimport * as Path from '../util/path';\r\nimport * as SVG from '@svgdotjs/svg.js';\r\nimport * as UID from '../util/uid';\r\nimport hasProp from \"../util/has-prop\";\r\nimport EventEmitter from \"../util/emitter\";\r\nimport userState from '../util/user-state';\r\nimport '../events/events'\r\nimport WorkspaceController from \"../controllers/base\";\r\nimport WASDController from \"../controllers/wasd\";\r\nimport { RMap } from \"./renderer-map\";\r\nimport styler, { Styler } from \"../util/styler\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport Widget from \"./widget\";\r\nimport ContextOptsRegistry, {ContextMenu} from \"./ctx-menu-registry\";\r\nimport { Showable } from \"./context-menu\";\r\nimport escapeAttr from \"../util/escape-html\";\r\nimport unescapeAttr from \"../util/unescape-html\";\r\nimport waitFrames from \"../util/wait-anim-frames\";\r\nimport CommentModel from \"./comment\";\r\nimport CommentRenderer from '../comment-renderer/renderer';\r\nField.register = function (name: string, cls: Function) {\r\n    FieldMap[name] = cls as AnyFieldCls;\r\n}\r\nField.unregister = function (name: string) {\r\n    delete FieldMap[name];\r\n}\r\n\r\n\r\nconst Kabel = {\r\n    UIX: {\r\n        events: eventer as Eventer,\r\n        /**\r\n         * State Manager, Makes things possible: E.G (the 'typing' state when you type in a input box..)\r\n         * Used in controllers so you dont move when typing characters like a w s or d etc.\r\n         */\r\n        userState\r\n    },\r\n    ContextMenu,\r\n    Utils: {\r\n        Path,\r\n        waitFrames,\r\n        SVG,\r\n        parseColor,\r\n        UID,\r\n        EventEmitter,\r\n        hasProp,\r\n        styler,\r\n        Styler,\r\n        escapeHTML: escapeAttr,\r\n        unescapeHTML: unescapeAttr,\r\n    },\r\n    Widget,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    inject,\r\n    InjectMsg,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    Nodes: NodePrototypes,\r\n    Widgets: WidgetPrototypes,\r\n    WorkspaceSvg,\r\n    WorkspaceController,\r\n    WASDController,\r\n    nodeRendering: {\r\n        rendererMap: RMap,\r\n        Renderer,\r\n        RendererConstants\r\n    },\r\n    commentRendering: {\r\n        CommentModel,\r\n        CommentRenderer\r\n    }\r\n};\r\n// Export a getter/setter incase someone needs more internal access to main workspace and doesnt like the method interface.\r\nObject.defineProperty(Kabel, '_mainWorkspace', {\r\n    get(): WorkspaceSvg|null {\r\n        return getMainWorkspace();\r\n    },\r\n    set(v: WorkspaceSvg|undefined|null|false|0|string) {\r\n        if (v === undefined || v === null || v === false || v === 0 || typeof v === 'string') {\r\n            return clearMainWorkspace();\r\n        }\r\n        return setMainWorkspace(v);\r\n    }\r\n})\r\n\r\nexport default Kabel;","import { Element as SvgElement, Rect as SvgRect, Text as SvgText } from \"@svgdotjs/svg.js\";\r\nimport CommentModel from \"../src/comment\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\n\r\ntype InitArgs = {\r\n    comment: CommentModel;\r\n    text: SvgText;\r\n};\r\n\r\nfunction initCommentInput(element: SvgElement, rawArgs: any) {\r\n    const args = rawArgs as InitArgs;\r\n    const comment = args.comment;\r\n    const txt = args.text as SvgText;\r\n    const rect = element as unknown as SvgRect;\r\n    const ws = comment.getWorkspace();\r\n    const svg = ws.svg;\r\n    function measureTextWidth(text: string, fontSize: number, fontFamily: string): number {\r\n        if (!svg) return text.length * (fontSize) * 0.6;\r\n\r\n        // encode spaces so measurement matches display\r\n        const displayText = encodeForSvg(text);\r\n\r\n        const txt = svg.text(displayText)\r\n            .attr({ 'xml:space': 'preserve' })\r\n            .font({ family: fontFamily, size: fontSize, anchor: 'start' })\r\n            .opacity(0); // hide it\r\n\r\n        const width = txt.bbox().width;\r\n        txt.remove(); // clean up\r\n        return width;\r\n    }\r\n\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = comment.getText() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length; // selection anchor\r\n\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    // Helper: encode spaces into NBSPs for display so multiple spaces are visible.\r\n    // Simple and reliable: converts every regular space to NBSP.\r\n    // If you care about wrapping later we can make this fancier (only convert runs or leading spaces).\r\n    function encodeForSvg(s: string) {\r\n        // replace spaces with NBSPs\r\n        // replace newlines with SVG line breaks\r\n        return s.replace(/ /g, \"\\u00A0\").replace(/\\n/g, \"&#10;\");\r\n    }\r\n\r\n\r\n    function ensureTspansPreserve(node: Element) {\r\n        // set xml:space on all child elements (tspans)\r\n        Array.from(node.childNodes).forEach((child) => {\r\n            if (child.nodeType === 1) {\r\n                (child as Element).setAttribute(\"xml:space\", \"preserve\");\r\n            }\r\n        });\r\n    }\r\n\r\n    let caretLine: SvgRect | null = null;\r\n    let selectionRect: SvgRect | null = null;\r\n    let measureText: SvgText | null = null; // hidden measurement element\r\n\r\n    function updateText() {\r\n        const { start, end } = getSelectionRange();\r\n        const hasSel = hasSelection();\r\n\r\n        // --- redraw main text (full buffer, always) ---\r\n        txt.clear().tspan(encodeForSvg(buffer));\r\n        txt.attr({ \"xml:space\": \"preserve\" });\r\n\r\n\r\n        try { ensureTspansPreserve(txt.node as Element); } catch { }\r\n        txt.leading(1.2);\r\n\r\n        // --- selection highlight (same as before) ---\r\n        if (hasSel) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14;\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n\r\n            const { start, end } = getSelectionRange();\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n\r\n            const bbox = txt.bbox();\r\n            const highlightX = bbox.x + measureTextWidth(textBeforeStart, fontSize, fontFamily);\r\n            const highlightWidth = Math.max(\r\n                measureTextWidth(textBeforeEnd, fontSize, fontFamily) - measureTextWidth(textBeforeStart, fontSize, fontFamily),\r\n                1\r\n            );\r\n            const highlightY = bbox.y;\r\n            const highlightH = bbox.height;\r\n\r\n            if (!selectionRect) {\r\n                // explicitly append to parent so it actually exists in DOM\r\n                // @ts-ignore\r\n                selectionRect = rect!.parent()!.rect?.(highlightWidth, highlightH)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                console.log(highlightWidth, highlightH);\r\n                selectionRect.size(highlightWidth, highlightH);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n\r\n\r\n        // --- caret rect logic using measureTextWidth ---\r\n        if (editing) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14; // fallback if needed\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n\r\n            // get the width of all characters before the cursor\r\n            const textBeforeCaret = buffer.slice(0, cursorPos);\r\n            const caretXOffset = measureTextWidth(textBeforeCaret, fontSize, fontFamily);\r\n\r\n            // get bbox to know y and height\r\n            const bbox = txt.bbox();\r\n            const caretY = bbox.y;\r\n            const caretH = bbox.height;\r\n\r\n            if (!caretLine) {\r\n                // @ts-ignore\r\n                caretLine = rect.parent().rect(1, caretH).fill('#000');\r\n            }\r\n\r\n            caretLine!.size(1, caretH).move(bbox.x + caretXOffset, caretY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        // --- resize background rect ---\r\n        const bbox = txt.bbox();\r\n        const handleRadius = 6;\r\n        const textOffsetX = PADDING_X + handleRadius * 2 + 4;\r\n        const rectW = Math.max(16, Math.ceil(bbox.width) + textOffsetX + PADDING_X);\r\n        const rectH = Math.max(16, Math.ceil(bbox.height) + PADDING_Y * 2);\r\n        rect.size(rectW, rectH);\r\n\r\n        comment._tempInputBBox = {\r\n            width: rectW,\r\n            height: rectH,\r\n            textX: textOffsetX,\r\n            textY: PADDING_Y\r\n        };\r\n    }\r\n\r\n\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = comment.getText() ?? \"\";\r\n        cursorPos = buffer.length;\r\n\r\n        userState.setState(\"typing\");\r\n\r\n        if (ev && comment._tempInputBBox) {\r\n            let localX = ev.offsetX - comment._tempInputBBox.textX;\r\n            localX = Math.max(0, localX);\r\n            cursorPos = buffer.length / 2;\r\n            anchorPos = buffer.length / 2;\r\n        }\r\n\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing(commit = true) {\r\n        if (!editing) return;\r\n        editing = false;\r\n\r\n        userState.removeState(\"typing\");\r\n\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n\r\n        if (commit) comment.setTextNoRedraw(buffer);\r\n        updateText();\r\n        comment.getWorkspace()?.redraw?.();\r\n    }\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(false); return; }\r\n\r\n        if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            stopEditing(true);\r\n        } else if (e.key === \"Backspace\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        }\r\n        else if (e.key === \"ArrowLeft\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection left\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection right\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Home\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = 0; // anchor unchanged\r\n            } else {\r\n                cursorPos = 0;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"End\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = buffer.length;\r\n            } else {\r\n                cursorPos = buffer.length;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            e.preventDefault();\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        }\r\n\r\n        updateText();\r\n        comment.setTextNoRedraw(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const targ = ev.target as Node;\r\n        if (targ !== rect.node && targ !== txt.node) stopEditing(true);\r\n    }\r\n\r\n    const onRectDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n    const onTextDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n\r\n    rect.on(\"mousedown\", onRectDown as any);\r\n    txt.on(\"mousedown\", onTextDown as any);\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", onRectDown as any);\r\n        txt.off(\"mousedown\", onTextDown as any);\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_commentinp\", initCommentInput as EventSetupFn);\r\nexport default initCommentInput;\r\n","// uid.ts\r\n// Tiny UID toolkit  no deps. Tabs > spaces, obviously.\r\n\r\nexport type UIDStrategy = \"uuidv4\" | \"ulid\" | \"nanoid\" | \"short\";\r\n\r\nexport interface UIDOptions {\r\n    /** For \"nanoid\": length of the id (default 21) */\r\n    size?: number;\r\n    /** For \"nanoid\": custom alphabet (default URL-safe) */\r\n    alphabet?: string;\r\n}\r\n\r\n/** Web Crypto shim (browser + Node 16+) */\r\nconst cryptoAPI: Crypto | null =\r\n    (typeof globalThis !== \"undefined\" && (globalThis as any).crypto) || null;\r\n\r\n/** Random bytes helper */\r\nfunction randBytes(len: number): Uint8Array {\r\n    if (cryptoAPI?.getRandomValues) {\r\n        const buf = new Uint8Array(len);\r\n        cryptoAPI.getRandomValues(buf);\r\n        return buf;\r\n    }\r\n    // Last resort (very old envs). Not cryptographically strong.\r\n    const buf = new Uint8Array(len);\r\n    for (let i = 0; i < len; i++) buf[i] = Math.floor(Math.random() * 256);\r\n    return buf;\r\n}\r\n\r\n/** RFC4122 UUID v4 (uses crypto.randomUUID if available) */\r\nexport function uuidv4(): string {\r\n    const g: any = globalThis as any;\r\n    if (g?.crypto?.randomUUID) return g.crypto.randomUUID();\r\n\r\n    const b = randBytes(16);\r\n    // Per RFC: set version + variant bits\r\n    // @ts-ignore\r\n    b[6] = (b[6] & 0x0f) | 0x40;\r\n    // @ts-ignore\r\n    b[8] = (b[8] & 0x3f) | 0x80;\r\n\r\n    const hex: string[] = [];\r\n    for (let i = 0; i < 256; i++) hex.push(i.toString(16).padStart(2, \"0\"));\r\n\r\n    return (\r\n        // @ts-ignore\r\n        hex[b[0]] + hex[b[1]] + hex[b[2]] + hex[b[3]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[4]] + hex[b[5]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[6]] + hex[b[7]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[8]] + hex[b[9]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[10]] + hex[b[11]] + hex[b[12]] + hex[b[13]] + hex[b[14]] + hex[b[15]]\r\n    );\r\n}\r\n\r\n/** Crockford Base32 alphabet for ULID */\r\nconst CROCK32 = \"0123456789ABCDEFGHJKMNPQRSTVWXYZ\"; // no I L O U\r\n\r\n/** ULID: time-sortable, 26 chars */\r\nexport function ulid(date?: number): string {\r\n    const time = (typeof date === \"number\" ? date : Date.now()) >>> 0; // low 32 bits\r\n    const timeHi = Math.floor((typeof date === \"number\" ? date : Date.now()) / 0x100000000) >>> 0; // high 32\r\n    // ULID uses 48-bit time; do base32 encode 48 bits\r\n    const time48 = new Uint8Array(6);\r\n    // write 48-bit big-endian\r\n    let t = BigInt(typeof date === \"number\" ? date : Date.now());\r\n    for (let i = 5; i >= 0; i--) {\r\n        time48[i] = Number(t & 0xffn);\r\n        t >>= 8n;\r\n    }\r\n    // first 10 chars = time\r\n    let out = \"\";\r\n    let acc = 0;\r\n    let bits = 0;\r\n    for (let i = 0; i < 6; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | time48[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n    out = out.slice(0, 10);\r\n\r\n    // last 16 chars = randomness (80 bits)\r\n    const rnd = randBytes(10);\r\n    acc = 0; bits = 0;\r\n    for (let i = 0; i < rnd.length; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | rnd[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n\r\n    return out.slice(0, 26);\r\n}\r\n\r\n/** NanoID-style: URL-safe alphabet by default, configurable length/alphabet */\r\nconst DEFAULT_ALPHABET =\r\n    \"_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n\r\nexport function nanoid(size: number = 21, alphabet: string = DEFAULT_ALPHABET): string {\r\n    if (size <= 0) throw new Error(\"size must be > 0\");\r\n    const mask = (1 << Math.ceil(Math.log2(alphabet.length))) - 1;\r\n    let id = \"\";\r\n    while (id.length < size) {\r\n        const bytes = randBytes(1);\r\n        // @ts-ignore\r\n        const idx = bytes[0] & mask;\r\n        if (idx < alphabet.length) id += alphabet[idx];\r\n    }\r\n    return id;\r\n}\r\n\r\n/** Short, mostly-unique (not crypto-strong): timestamp base36 + counter + random */\r\nlet _ctr = 0;\r\nexport function shortId(): string {\r\n    const ts = Date.now().toString(36);\r\n    _ctr = (_ctr + 1) & 0xfff; // 0..4095\r\n    const c = _ctr.toString(36).padStart(3, \"0\");\r\n    const r = Array.from(randBytes(3))\r\n        .map(b => (b & 0x3f).toString(36).padStart(2, \"0\"))\r\n        .join(\"\")\r\n        .slice(0, 4);\r\n    return `${ts}${c}${r}`;\r\n}\r\n\r\n/** One-call wrapper */\r\nexport function generateUID(strategy: UIDStrategy = \"uuidv4\", opts: UIDOptions = {}): string {\r\n    switch (strategy) {\r\n        case \"uuidv4\": return uuidv4();\r\n        case \"ulid\": return ulid();\r\n        case \"nanoid\": return nanoid(opts.size ?? 21, opts.alphabet ?? DEFAULT_ALPHABET);\r\n        case \"short\": return shortId();\r\n        default: {\r\n            const _exhaustive: never = strategy;\r\n            return uuidv4();\r\n        }\r\n    }\r\n}\r\n","function escapeAttr(s: string) {\r\n    return s.replace(/&/g, \"&amp;\")\r\n            .replace(/'/g, \"&apos;\")\r\n            .replace(/\"/g, \"&quot;\")\r\n            .replace(/</g, \"&lt;\")\r\n            .replace(/>/g, \"&gt;\");\r\n}\r\n\r\nexport default escapeAttr;","import { G, Line } from \"@svgdotjs/svg.js\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\n\r\n\r\n/**\r\n * CommentModel\r\n */\r\nclass CommentModel {\r\n    _text: string;\r\n    _isWorkspaceComment: boolean;\r\n    _parent: NodeSvg | WorkspaceSvg;\r\n    svgGroup?: G | undefined;\r\n    relativeCoords: Coordinates;\r\n    svgLine?: Line | undefined;\r\n    _tempInputBBox?: {width: number, height: number, textX: number, textY: number};\r\n    id: string;\r\n    constructor(parent: NodeSvg | WorkspaceSvg) {\r\n        this._parent = parent;\r\n        this._isWorkspaceComment = parent instanceof WorkspaceSvg;\r\n        this._text = \"\";\r\n        this.relativeCoords = new Coordinates(0, 0); // Coordinates relative to this._parent.\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n\r\n    }\r\n    setTextNoRedraw(value: string) {\r\n        return (this._text = value);\r\n    }\r\n    getText() {\r\n        return this._text;\r\n    }\r\n    setText(value: string) {\r\n        const res = (this._text = value);\r\n        this.getWorkspace().renderer.clearComments();\r\n        this.getWorkspace().renderer.drawComments();\r\n        return res;\r\n    }\r\n    isNodeComment() {\r\n        return !this._isWorkspaceComment;\r\n    }\r\n    isWorkspaceComment() {\r\n        return this._isWorkspaceComment;\r\n    }\r\n    getWorkspace(): WorkspaceSvg {\r\n        if (this.isWorkspaceComment()) {\r\n            return this._parent as WorkspaceSvg;\r\n        } else {\r\n            return (this._parent as NodeSvg)?.workspace as WorkspaceSvg;\r\n        }\r\n    }\r\n}\r\n\r\nexport default CommentModel;","import Renderer from '../renderers/renderer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport CommentModel from '../src/comment';\r\nimport { Element, SVG, Svg } from '@svgdotjs/svg.js';\r\nimport eventer from '../util/eventer';\r\n\r\nclass CommentRenderer {\r\n    static get NAME() {\r\n        return 'cr_atlas';\r\n    }\r\n    static get COMMENT_G_TAG() {\r\n        return 'KabelCommentGroup';\r\n    }\r\n    static get COMMENT_LINE_TAG() {\r\n        return 'KabelCommentLine';\r\n    }\r\n    static get COMMENT_TEXT_EL() {\r\n        return 'KabelCommentText';\r\n    }\r\n    static get COMMENT_DRAG_EL() {\r\n        return 'KabelCommentDragHandle';\r\n    }\r\n    static get RENDERER_TAG_EL() {\r\n        return 'KabelCommentElTag'\r\n    }\r\n    workspace: WorkspaceSvg;\r\n\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n    }\r\n    encodeForSvg(s: string) {\r\n        // keep newline chars as-is; replace spaces with NBSP\r\n        return s.replace(/ /g, \"\\u00A0\");\r\n    }\r\n\r\n    ensureTspansPreserve(node: HTMLElement) {\r\n        // set xml:space on all child elements (tspans)\r\n        Array.from(node.childNodes).forEach((child) => {\r\n            if (child.nodeType === 1) {\r\n                (child as HTMLElement).setAttribute(\"xml:space\", \"preserve\");\r\n            }\r\n        });\r\n    }\r\n    drawComment(comment: CommentModel) {\r\n        const svg = this.getSvg();\r\n\r\n        if (comment.svgGroup) comment.svgGroup.remove();\r\n        if (comment.svgLine) comment.svgLine.remove();\r\n\r\n        const g = svg.group().addClass(CommentRenderer.COMMENT_G_TAG);\r\n        g.attr({\r\n            'comment-data': JSON.stringify({\r\n                id: comment.id,\r\n                isws: comment.isWorkspaceComment()\r\n            })\r\n        })\r\n        comment.svgGroup = g;\r\n\r\n        const padding = 4;\r\n        const handleRadius = 6;\r\n        const textOffsetX = padding + handleRadius * 2 + 4; // space for circle + small gap\r\n        const displayEncoded = this.encodeForSvg(comment.getText());\r\n        const textEl = g.text(displayEncoded)\r\n            .font({ family: 'Arial', size: 12 })\r\n            .fill('#000')\r\n            .move(textOffsetX, padding)\r\n            .addClass(CommentRenderer.COMMENT_TEXT_EL);\r\n        textEl.node.style.userSelect = 'none';          // standard\r\n        // @ts-ignore\r\n        textEl.node.style!.webkitUserSelect = 'none';    // Safari/Chrome\r\n        // @ts-ignore\r\n        textEl.node.style!.msUserSelect = 'none';        // IE/Edge\r\n        // @ts-ignore\r\n        textEl.node.style!.MozUserSelect = 'none';       // Firefox\r\n        const bbox = textEl.bbox();\r\n\r\n        // Background rectangle\r\n        const rect = g.rect(bbox.width + padding * 2 + handleRadius * 2 + 4, bbox.height + padding * 2)\r\n            .fill('#ffffcc')\r\n            .stroke({ color: '#cccc99', width: 1 })\r\n            .radius(4)\r\n            .back();\r\n\r\n        // Drag handle circle (just visual for now)\r\n        const dragHandle = g.circle(handleRadius * 2)\r\n            .fill('#adad7d')\r\n            .move(padding, padding + (bbox.height / 2) - handleRadius) // vertically centered with text\r\n            .addClass(CommentRenderer.COMMENT_DRAG_EL);\r\n\r\n        eventer.addElement(dragHandle, 'k_draghandle', {\r\n            comment\r\n        }).tagElement(dragHandle, CommentRenderer.RENDERER_TAG_EL)\r\n        eventer.addElement(rect, \"k_commentinp\", {\r\n            comment,\r\n            text: textEl\r\n        }).tagElement(rect, CommentRenderer.RENDERER_TAG_EL)\r\n\r\n        let workspaceX = comment.relativeCoords.x;\r\n        let workspaceY = comment.relativeCoords.y;\r\n\r\n        if (comment._parent instanceof NodeSvg) {\r\n            const nodePos = comment._parent.relativeCoords;\r\n            workspaceX += nodePos.x;\r\n            workspaceY += nodePos.y;\r\n        }\r\n\r\n        const screenPos = this.workspace.workspaceToScreen(workspaceX, workspaceY);\r\n        g.move(screenPos.x, screenPos.y);\r\n\r\n        if (comment._parent instanceof NodeSvg && comment._parent.svgGroup) {\r\n            this._drawLineToNode(comment, screenPos, bbox, padding);\r\n        }\r\n    }\r\n\r\n    refreshCommentTransforms() {\r\n        const svg = this.getSvg();\r\n\r\n        for (const comment of [\r\n            ...this.workspace.getComments(),\r\n            ...Array.from(this.workspace._nodeDB.values())\r\n                .map(n => n.getComment())\r\n                .filter(c => !!c) as CommentModel[]\r\n        ]) {\r\n            if (!comment.svgGroup) continue;\r\n\r\n            let workspaceX = comment.relativeCoords.x;\r\n            let workspaceY = comment.relativeCoords.y;\r\n\r\n            if (comment._parent instanceof NodeSvg) {\r\n                const nodePos = comment._parent.relativeCoords;\r\n                workspaceX += nodePos.x;\r\n                workspaceY += nodePos.y;\r\n            }\r\n\r\n            const screenPos = this.workspace.workspaceToScreen(workspaceX, workspaceY);\r\n\r\n            // Move comment group\r\n            comment.svgGroup.move(screenPos.x, screenPos.y);\r\n\r\n\r\n            // Remove line if it exists\r\n            if (comment.svgLine) {\r\n                comment.svgLine.remove();\r\n                comment.svgLine = undefined;\r\n            }\r\n            const textEl = comment.svgGroup.findOne(`.${CommentRenderer.COMMENT_TEXT_EL}`);\r\n            // Only redraw line if parent is a NodeSvg\r\n            if (comment._parent instanceof NodeSvg) {\r\n                const bbox = textEl ? (textEl as Element).bbox() : { width: 0, height: 0 };\r\n                this._drawLineToNode(comment, screenPos, bbox, 4);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private _drawLineToNode(comment: NodeSvg['getComment'] extends () => infer C ? C : never,\r\n        screenPos: { x: number, y: number }, bbox: { width: number, height: number }, padding: number) {\r\n        if (!comment) return;\r\n        if (!(comment._parent instanceof NodeSvg)) return;\r\n        const svg = this.getSvg();\r\n        const nodeScreenPos = this.workspace.workspaceToScreen(\r\n            comment._parent.relativeCoords.x,\r\n            comment._parent.relativeCoords.y\r\n        );\r\n        const nodeBBox = comment._parent.svgGroup!.bbox();\r\n\r\n        const nodeCenterX = nodeScreenPos.x + nodeBBox.width / 2;\r\n        const nodeCenterY = nodeScreenPos.y;\r\n\r\n        const commentCenterX = screenPos.x + (bbox.width + padding * 2) / 2;\r\n        const commentTopY = screenPos.y;\r\n\r\n        comment.svgLine = svg.line(nodeCenterX, nodeCenterY, commentCenterX, commentTopY)\r\n            .stroke({ color: '#888', width: 1, dasharray: '3,2' })\r\n            .addClass(CommentRenderer.COMMENT_LINE_TAG);\r\n    }\r\n\r\n    clearAllComments() {\r\n        const svg = this.getSvg();\r\n        svg.find(`.${CommentRenderer.COMMENT_G_TAG}`).forEach(el => el.remove());\r\n        svg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n        eventer.destroyByTag(CommentRenderer.RENDERER_TAG_EL)\r\n        for (let [_, node] of this.workspace._nodeDB) {\r\n            const comment = node.getComment();\r\n            if (comment) comment.svgGroup = undefined;\r\n        }\r\n        for (const comment of this.workspace.getComments()) {\r\n            comment.svgGroup = undefined;\r\n        }\r\n    }\r\n    clearCommentLines() {\r\n        const svg = this.getSvg();\r\n        svg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n    }\r\n    drawAllComments() {\r\n        for (const comment of this.workspace.getComments()) this.drawComment(comment);\r\n        for (let [_, node] of this.workspace._nodeDB) {\r\n            const comment = node.getComment();\r\n            if (comment) this.drawComment(comment);\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    getSvg(): Svg {\r\n        return this.workspace.svg;\r\n    }\r\n}\r\n\r\nexport default CommentRenderer;\r\n","import RendererConstants from \"./constants\";\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport * as Path from '../util/path';\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport { G, Path as SvgPath, Svg, StrokeData, Element, List, Rect } from \"@svgdotjs/svg.js\";\r\nimport { Color, ColorStyle, Hex } from \"../src/visual-types\";\r\nimport Field, { AnyField, ConnectableField, DummyField, FieldRawBoxData, OptConnectField } from \"../src/field\";\r\nimport eventer from '../util/eventer';\r\nimport Connection, { Connectable } from \"../src/connection\";\r\nimport escapeAttr from '../util/escape-html';\r\nimport unescapeAttr from '../util/unescape-html';\r\nimport CommentRenderer from \"../comment-renderer/renderer\";\r\nimport { FieldVisualInfo } from \"../src/field\";\r\n\r\nexport interface ConnectorToFrom {\r\n    to: Connection,\r\n    from: Connection,\r\n    fromCircle?: SvgPath,\r\n    toCircle?: SvgPath,\r\n    originConn: Connection,\r\n    originCircle: SvgPath\r\n}\r\nexport interface DrawState {\r\n    id: string;\r\n    topbar?: SvgPath | null;\r\n    bg?: SvgPath | null;\r\n    group?: G | null;\r\n    fieldCol?: G | null;\r\n    fieldPosY?: number | null; // starts under topbar, goes down by field height each time one is drawn. This determines position\r\n    xButton?: G;\r\n    pendingConnections: ConnectorToFrom[]\r\n}\r\n\r\nfunction drawState(nodeGroup: G, id: string): DrawState {\r\n    return {\r\n        id,\r\n        group: nodeGroup,\r\n        fieldPosY: 0,\r\n        pendingConnections: []\r\n    }\r\n}\r\n\r\nclass Renderer {\r\n    _constants: RendererConstants;\r\n    _currentNode: NodeSvg | null;\r\n    _nodeGroup: G | null;\r\n    _nodeDraw: DrawState | null;\r\n    _ws: WorkspaceSvg;\r\n    _drawStates: DrawState[];\r\n    _commentDrawer!: CommentRenderer;\r\n    static get NODE_G_TAG() {\r\n        return 'AtlasNodeSVG';\r\n    }\r\n    static get ELEMENT_TAG() {\r\n        return 'AtlasElement'\r\n    }\r\n    static get CONN_LINE_TAG() {\r\n        return 'AtlasConnectionLine';\r\n    }\r\n    static get CONNECTOR_TAG() {\r\n        return 'AtlasConnectionBubble';\r\n    }\r\n    static get LINE_X_MARK_TAG() {\r\n        return 'AtlasLineXMark';\r\n    }\r\n    static get NAME() {\r\n        return 'atlas'; // default is called atlas.\r\n    }\r\n\r\n    constructor(workspace: WorkspaceSvg, overrides: Partial<RendererConstants> = {}) {\r\n        this._ws = workspace;\r\n        this._currentNode = null;\r\n        this._constants = new RendererConstants(overrides);\r\n        this._nodeGroup = null;\r\n        this._nodeDraw = null;\r\n        this._drawStates = [];\r\n        this.initCommentRenderer()\r\n\r\n    }\r\n    initCommentRenderer() {\r\n        this._commentDrawer = new CommentRenderer(this.getWs());\r\n    }\r\n    enqueueSetConnect(c: ConnectorToFrom) {\r\n        this.state?.pendingConnections?.push?.(c);\r\n    }\r\n    setConstants(c: Partial<RendererConstants> = {}) {\r\n        return Object.assign(this._constants, c);\r\n    }\r\n    get constants(): RendererConstants {\r\n        if (!this.node) return this._constants;\r\n\r\n        const { primary, secondary, tertiary, ...restColors } = this.node.colors;\r\n\r\n        return {\r\n            ...this._constants,\r\n            ...restColors\r\n        };\r\n    }\r\n\r\n    set constants(c: Partial<RendererConstants>) {\r\n        this.setConstants(c);\r\n    }\r\n    get node() {\r\n        return this._currentNode;\r\n    }\r\n    get svg(): Svg {\r\n        return this.getWs().svg; // Svg.js instance\r\n    }\r\n    get state(): null | undefined | DrawState {\r\n        return this._nodeDraw;\r\n    }\r\n    getWs() {\r\n        return this._ws;\r\n    }\r\n    getNodeBaseMeasurements() {\r\n        const c = this.constants;\r\n        return {\r\n            width: c.NODE_BASE_WIDTH,\r\n            height: c.NODE_BASE_HEIGHT\r\n        }\r\n    }\r\n    measureTextWidth(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return text.length * (fontSize ?? c.FONT_SIZE) * 0.6;\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const width = txt.bbox().width;\r\n        txt.remove(); // clean up\r\n        return width;\r\n    }\r\n    measureTextHeight(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return (fontSize ?? c.FONT_SIZE);\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const height = txt.bbox().height;\r\n        txt.remove(); // clean up\r\n        return height;\r\n    }\r\n\r\n\r\n    measureRawField(text: string = \"\") {\r\n        const c = this.constants;\r\n        const textW = this.measureTextWidth(text);\r\n        const width = Math.max(c.FIELD_RAW_BASE_WIDTH, textW + c.INPUT_BOX_PADDING * 2);\r\n        const height = c.FIELD_RAW_BASE_HEIGHT;\r\n        return { width, height };\r\n    }\r\n    private measureLabel(field: AnyField): { width: number, height: number } {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return { width: 0, height: 0 };\r\n\r\n        const width = this.measureTextWidth(label);\r\n        const height = this.measureTextHeight(label);\r\n\r\n        return { width, height };\r\n    }\r\n\r\n    private measureRaw(field: AnyField): { width: number, height: number } {\r\n        if (!field.hasRaw()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const raw = this.measureRawField(field.getValue?.() ?? \"\");\r\n        return {\r\n            width: raw.width,\r\n            height: raw.height\r\n        };\r\n    }\r\n\r\n    private measureCustom(field: AnyField): { width: number, height: number } {\r\n        if (!field.isCustomEditor()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const m = field.measureMyself();\r\n        if (!m) return { width: 0, height: 0 };\r\n\r\n        let width = m.width as number;\r\n        let height = m.height as number;\r\n\r\n        return { width, height };\r\n    }\r\n    getFieldMeasurementPadding() {\r\n        return { width: this.constants.FIELD_SPACEX, height: 0 }\r\n    }\r\n    measureField(field: AnyField) {\r\n\r\n        const parts = [\r\n            this.getFieldMeasurementPadding(),\r\n            this.measureLabel(field),\r\n            this.measureRaw(field),\r\n            this.measureCustom(field),\r\n            this.getFieldMeasurementPadding()\r\n        ];\r\n\r\n        let width = 0, height = 0;\r\n        for (const { width: w, height: h } of parts) {\r\n            width += w;\r\n            height = Math.max(height, h);\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n\r\n    measureNodeDimensions() {\r\n        if (!this.node) return;\r\n\r\n        const c = this.constants;\r\n        const node: NodeSvg = this.node;\r\n        const fieldMeasurements: { width: number; height: number }[] = [];\r\n\r\n        const BASE = this.getNodeBaseMeasurements();\r\n        let totalWidth = BASE.width;\r\n        let totalHeight = BASE.height; // start at base\r\n        if (node.labelText) {\r\n            const labelW = this.measureTextWidth(node.labelText, c.FONT_SIZE, c.FONT_FAMILY);\r\n            totalWidth = Math.max(\r\n                totalWidth,\r\n                labelW + c.TOPBAR_LABEL_MARGIN_X * 2  // add left/right margin\r\n            );\r\n        }\r\n\r\n        let y = c.TOPBAR_HEIGHT + c.FIELD_SPACEY; // current y position for fields\r\n\r\n        for (let field of node.allFields()) {\r\n            let width = 0, height = 0;\r\n\r\n            const fldM = this.measureField(field);\r\n            width = fldM.width;\r\n            height = fldM.height;\r\n            // This adds to a list of all the like widths and heights for a field\r\n            fieldMeasurements.push(fldM);\r\n            totalWidth = Math.max(totalWidth, width + c.FIELD_MARGIN_X * 2);\r\n\r\n            // Check if this field goes beyond current totalHeight\r\n            const bottomOfField = y + height;\r\n            if (bottomOfField + c.FIELD_MARGIN_Y > totalHeight) {\r\n                totalHeight = bottomOfField + c.FIELD_MARGIN_Y; // grow node only if needed\r\n            }\r\n\r\n            y += height + c.FIELD_MARGIN_Y;\r\n        }\r\n        totalHeight += c.FOOTER_HEIGHT\r\n        return {\r\n            width: totalWidth,\r\n            height: totalHeight,\r\n            fields: fieldMeasurements\r\n        };\r\n    }\r\n    renderNode(nodeIdOrNode: NodeSvg | string) {\r\n        this.startNode(nodeIdOrNode);\r\n        this.drawNode();\r\n        this.storeState();\r\n    }\r\n    startNode(nodeIdOrNode: NodeSvg | string) {\r\n        const ws = this.getWs();\r\n        if (nodeIdOrNode instanceof NodeSvg) {\r\n            this._currentNode = nodeIdOrNode;\r\n        } else {\r\n            const node = ws.getNode(nodeIdOrNode);\r\n            if (node instanceof NodeSvg) {\r\n                this._currentNode = node;\r\n            } else {\r\n                this._currentNode = null;\r\n            }\r\n        }\r\n    }\r\n    storeState() {\r\n        this._drawStates.push(this.state as DrawState);\r\n    }\r\n    drawFieldRaw(fieldGroup: G, field: AnyField, startX: number = 0) {\r\n        const c = this.constants;\r\n        const value = field.getDisplayValue?.() ?? \"\";\r\n        const { width, height } = this.measureRawField(value);\r\n\r\n        const rect = fieldGroup.rect(width, height)\r\n            .fill(parseColor(c.FIELD_RAW_COLOR))\r\n            .stroke({ color: parseColor(c.FIELD_RAW_OUTLINE_COLOR), width: c.FIELD_RAW_OUTLINE_STROKE })\r\n            .radius(3);\r\n\r\n        const txt = fieldGroup.text(value)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: c.INPUT_BOX_TEXT_ANCHOR\r\n            })\r\n            .fill(parseColor(c.FIELD_RAW_TEXT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n\r\n        const rawBox: FieldRawBoxData = {\r\n            box: rect,\r\n            txt\r\n        }\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (height - textBBox.height) / 2;\r\n\r\n        // move relative to startX (after label)\r\n        rect.move(startX, 0);\r\n        txt.move(startX + c.INPUT_BOX_PADDING, offsetY);\r\n        eventer.addElement(rect, \"k_inputbox\", {\r\n            field,      // the field object that has .getValue() and .setValue(v)\r\n            text: txt,       // the svg.js Text element you drew\r\n            renderer: this,   // the renderer instance, must have .measureRawField and .constants\r\n            startX   // x-offset where the box should start (after label)\r\n        }).tagElement(rect, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${this.node!.id}`])\r\n\r\n        return { rect, txt, rawBox };\r\n    }\r\n\r\n\r\n\r\n    drawFieldLabel(fieldGroup: G, field: AnyField, startX: number = 0): number {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return 0;\r\n\r\n        const txt = fieldGroup.text(label)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .fill(parseColor(c.FONT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n        const bbox = txt.bbox();\r\n        const offsetY = (Math.max(c.FIELD_RAW_BASE_HEIGHT, bbox.height) - bbox.height) / 2;\r\n\r\n        // move label relative to startX\r\n        txt.move(startX, offsetY);\r\n\r\n        // return width used for next element\r\n        return bbox.width + c.LABEL_SPACING;\r\n    }\r\n\r\n    drawNodeXButton() {\r\n        const node = this.node;\r\n        const state = this._nodeDraw;\r\n        if (!node || !state || !state.topbar || !state.group) return;\r\n\r\n        const c = this.constants;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n\r\n        const btnSize = c.TOPBAR_HEIGHT * 0.6;\r\n        const padding = (c.TOPBAR_HEIGHT - btnSize) / 2;\r\n\r\n        // Button group\r\n        const xGroup = state.group.group().attr({ class: 'node-x-clse' });\r\n        eventer.addElement(xGroup, 'k_closenode', {\r\n            workspace: this.getWs(),\r\n            node\r\n        }).tagElement(xGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n        // Background\r\n        xGroup.rect(btnSize, btnSize)\r\n            .fill('#ffffff00')\r\n            .radius(2)\r\n            .move(width - btnSize - padding, padding);\r\n\r\n        // X mark\r\n        const txt = xGroup.text('')\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: btnSize * 0.8,\r\n                weight: 'bold',\r\n                anchor: 'middle'\r\n            })\r\n            .fill('#fff')\r\n            .attr({\r\n                'text-anchor': 'middle',        // horizontal centering\r\n                'dominant-baseline': 'middle'   // vertical centering\r\n            });\r\n        txt.node.style.userSelect = 'none';\r\n        // Apply transform to center it inside the button\r\n        txt.transform({\r\n            translateX: width - btnSize / 2 - padding,\r\n            translateY: padding + btnSize / 2\r\n        });\r\n\r\n        state.xButton = xGroup;\r\n    }\r\n\r\n    drawConnector(nodeGroup: G, nodeBg: SvgPath, y: number, side: 'left' | 'right', color: string): SvgPath | void | undefined | null {\r\n        const c = this.constants;\r\n        if (!nodeGroup || !nodeBg) return null;\r\n\r\n        const bbox = nodeBg.bbox(); // get dimensions of the background\r\n        const group = nodeGroup;     // attach connector to top-level node group\r\n        const x = side === 'left' ? 0 : bbox.width;\r\n\r\n        if (c.CONNECTOR_TRIANGLE) {\r\n            // small triangle connector\r\n            const triSize = c.CONNECTOR_TRI_SIZE;\r\n            let path = Path.roundedTri(triSize, triSize, 1);\r\n\r\n            // flip triangle horizontally for left side\r\n            if (side === 'left') path = Path.rotatePath(path, 180, triSize / 2, triSize / 2);\r\n\r\n            const tri = group.path(path)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 });\r\n            tri.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            const offsetX = side === 'left' ? -triSize : 0;\r\n            tri.transform({ translateX: x + offsetX, translateY: y - triSize / 2 });\r\n\r\n            return tri;\r\n        } else {\r\n            // circle connector\r\n            const radius = c.CONNECTOR_RADIUS;\r\n            const circlePath = Path.circle(radius);\r\n\r\n            const circ = group.path(circlePath)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .move(x - radius, y - radius); // center circle at (x, y)\r\n            circ.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            return circ;\r\n        }\r\n    }\r\n\r\n\r\n    drawNodeLabel(nodeGroup: G) {\r\n        const node = this.node;\r\n        const c = this.constants;\r\n        if (!node) return;\r\n\r\n        if (node.labelText) {\r\n            const txt = nodeGroup.text(node.labelText)\r\n                .font({\r\n                    family: c.FONT_FAMILY,\r\n                    size: c.FONT_SIZE,\r\n                    anchor: 'start',\r\n                    weight: c.TOPBAR_LABEL_BOLDED ? '600' : 'normal'\r\n                })\r\n                .fill(parseColor(c.FONT_COLOR));\r\n\r\n            txt.node.style.userSelect = 'none';\r\n\r\n            const bbox = txt.bbox();\r\n            const offsetY = (c.TOPBAR_HEIGHT - bbox.height) / 2;\r\n\r\n            txt.move(c.TOPBAR_LABEL_MARGIN_X, offsetY + c.TOPBAR_LABEL_MARGIN_Y);\r\n        }\r\n    }\r\n    resolveConnectable(connectable: Connectable, fromConn: Connection): Connection | null | undefined {\r\n        if (!connectable || !fromConn) return undefined;\r\n\r\n        // If the connection is an input (previous), return the connectable's output (next) connection\r\n        if (fromConn.isPrevious) {\r\n\r\n            if (connectable instanceof NodeSvg) return connectable.nextConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n\r\n        // If the connection is an output (next), return the connectable's input (previous) connection\r\n        if (!fromConn.isPrevious) {\r\n            if (connectable instanceof NodeSvg) return connectable.previousConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n    }\r\n    private _fillOtherNodeConnectorCircle(conn: Connection, circle: SvgPath, isPrevious: boolean) {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                // Only fill if the connection actually matches\r\n                if (isPrevious) {\r\n                    // fill toCircle if this connPair expects 'conn' as its 'to'\r\n                    if (connPair.to === conn && !connPair.toCircle) {\r\n                        connPair.toCircle = circle;\r\n                    }\r\n                } else {\r\n                    // fill fromCircle if this connPair expects 'conn' as its 'from'\r\n                    if (connPair.from === conn && !connPair.fromCircle) {\r\n                        connPair.fromCircle = circle;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    refreshComments() {\r\n        return this._commentDrawer?.refreshCommentTransforms?.();\r\n    }\r\n    clearComments() {\r\n        return this._commentDrawer?.clearAllComments?.();\r\n    }\r\n    drawComments() {\r\n        return this._commentDrawer?.drawAllComments?.();\r\n    }\r\n    refreshNodeTransforms() {\r\n        const nodeGroups: List<G> = this.svg.find(`.${(this.constructor as typeof Renderer).NODE_G_TAG}`) as List<G>;\r\n        for (let nodeG of nodeGroups) {\r\n            const node: NodeSvg | undefined = this.getWs().getNode(unescapeAttr(nodeG.attr('data-node-id')));\r\n            if (!node) continue;\r\n            const screenPos = this._ws.workspaceToScreen(\r\n                node.relativeCoords.x,\r\n                node.relativeCoords.y\r\n            );\r\n            nodeG.attr({ transform: `translate(${screenPos.x}, ${screenPos.y})` });\r\n        }\r\n        this.refreshConnectionLines();\r\n        this.refreshComments();\r\n    }\r\n    refreshConnectionLines() {\r\n        this.clearLines();\r\n        this.drawLinesForAllNodes();\r\n    }\r\n    createNodeDrawState(nodeGroup: G, id: string): DrawState {\r\n        return drawState(nodeGroup, id); // wraps this method so you can define your own drawstates by overriding this method\r\n    }\r\n    drawNode() {\r\n        if (!this.node) return;\r\n\r\n        const node: NodeSvg = this.node;\r\n        const c = this.constants;\r\n        const colors: ColorStyle = node.colors ?? {\r\n            primary: '#000',\r\n            secondary: '#000',\r\n            tertirary: '#000',\r\n            category: ''\r\n        };\r\n\r\n        // Main node group\r\n        const nodeGroup = this.svg.group().attr({ 'data-node-id': escapeAttr(node.id), 'class': (this.constructor as typeof Renderer).NODE_G_TAG });\r\n        // compute screen position from workspace-space relativeCoords\r\n        const screenPos = this._ws.workspaceToScreen(\r\n            node.relativeCoords.x,\r\n            node.relativeCoords.y\r\n        );\r\n\r\n        // apply it to the top-level node group\r\n        nodeGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y})` });\r\n\r\n        const state = this.createNodeDrawState(nodeGroup, node.id);\r\n        this._nodeDraw = state;\r\n\r\n        // Measure node\r\n        const measurements = this.measureNodeDimensions();\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const height = measurements?.height ?? c.NODE_BASE_HEIGHT;\r\n\r\n        // Base rectangle\r\n        const radius = c.CORNER_RADIUS;\r\n        state.bg = nodeGroup.path(Path.roundedRect(width, height, radius))\r\n            .fill(parseColor(c.NODE_BG_COLOR))\r\n            .stroke({ color: parseColor(c.NODE_OUTLINE_COLOR), width: 2 } as StrokeData);\r\n\r\n        // Topbar\r\n        state.topbar = nodeGroup.path(Path.roundedRect(width, c.TOPBAR_HEIGHT, radius))\r\n            .fill(parseColor(colors.primary))\r\n            .stroke({ color: parseColor(colors.tertiary), width: 2 } as StrokeData);\r\n\r\n        // add the X button\r\n        this.drawNodeXButton();\r\n        this.drawNodeLabel(nodeGroup);\r\n        eventer.addElement(nodeGroup, 'k_draggable', {\r\n            dragel: state.topbar, // the handle\r\n            node: node,     // NodeSvg instance\r\n            type: 2\r\n        }).tagElement(nodeGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n        // Outer fields group positioned under topbar using transform\r\n        const fieldsGroup = nodeGroup.group();\r\n        fieldsGroup.attr({ transform: `translate(0, ${c.TOPBAR_HEIGHT + c.FIELD_SPACEY})` });\r\n        state.fieldCol = fieldsGroup;\r\n\r\n\r\n        let y = 0;\r\n        node.allFields().forEach((field, idx) => {\r\n            const fm = measurements?.fields[idx];\r\n            if (!fm) return;\r\n\r\n            // default left alignment\r\n            let alignX = c.FIELD_MARGIN_X;\r\n\r\n            const fieldGroup = fieldsGroup.group();\r\n            fieldGroup.attr({ transform: `translate(${alignX}, ${y})` });\r\n            field.svgGroup = fieldGroup;\r\n            state.fieldPosY = y;\r\n\r\n            // draw label first, get its used width\r\n            const xUsed = this.drawFieldLabel(fieldGroup, field);\r\n            if (field.isCustomEditor()) {\r\n                // field fully owns drawing\r\n                field.drawMyself({\r\n                    measuredWidth: fm.width,\r\n                    measuredHeight: fm.height,\r\n                    xUsed,\r\n                    fieldGroup,\r\n                    nodeGroup,\r\n                    svg: this.svg,\r\n                    background: state!.bg as unknown as Rect\r\n                });\r\n            } else {\r\n                // fallback: renderer draws raw/connector as before\r\n                let rawData, cBubbleData = undefined;\r\n                // if raw, draw right after label\r\n                if (field.hasRaw()) {\r\n                    const { rawBox } = this.drawFieldRaw(fieldGroup, field, xUsed);\r\n                    rawData = rawBox;\r\n                }\r\n                // @ts-ignore\r\n                if (field.hasConnectable() && field!.connection) {\r\n                    // @ts-ignore\r\n                    const halfHeight = (fm.height + (field.hasRaw() ? 0 : c.FIELD_MARGIN_Y)) / 2;\r\n                    const absY = c.TOPBAR_HEIGHT + c.FIELD_SPACEY + y + halfHeight;\r\n\r\n\r\n                    const c3 = this.drawConnector(\r\n                        nodeGroup,\r\n                        state.bg as SvgPath,\r\n                        absY,\r\n                        'right',\r\n                        parseColor(c.FIELD_CONN_COLOR)\r\n                    );\r\n                    if (c3) {\r\n                        const c = {\r\n                            // @ts-ignore\r\n                            from: field!.connection as Connection,\r\n                            // @ts-ignore (typescript intellisense mad that field.connection isnt on some field types, so we ignore it.)\r\n                            to: field!.connection.getTo()?.previousConnection as Connection,\r\n                            fromCircle: c3 as SvgPath,\r\n                            originCircle: c3 as SvgPath,\r\n                            // @ts-ignore\r\n                            originConn: field!.connection as Connection\r\n                        };\r\n                        cBubbleData = {\r\n                            connector: c3,\r\n                            connState: c\r\n                        }\r\n                        this.enqueueSetConnect(c);\r\n                        eventer.addElement(c3, 'k_connectbubble', {\r\n                            // @ts-ignore\r\n                            connection: field!.connection,\r\n                            field\r\n                        }).tagElement(c3, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                    }\r\n                }\r\n                field.onDraw(rawData, cBubbleData);\r\n            }\r\n            y += fm.height + c.FIELD_MARGIN_Y;\r\n        });\r\n\r\n        state.fieldPosY = y;\r\n\r\n        /**\r\n         * Draw connectors.\r\n         */\r\n        const bbox = state.bg?.bbox();\r\n        const cY = (bbox?.height ?? height) - c.FOOTER_HEIGHT;\r\n\r\n        // Previous connection (left)\r\n        if (node.previousConnection) {\r\n            const c1 = this.drawConnector(nodeGroup, state.bg, cY, 'left', colors.primary as string);\r\n            if (c1) {\r\n                const c = ({\r\n                    from: node.previousConnection,\r\n                    to: this.resolveConnectable(node.previousConnection.getFrom(), node.previousConnection) as Connection,\r\n                    fromCircle: c1 as SvgPath,\r\n                    originConn: node.previousConnection,\r\n                    originCircle: c1\r\n                });\r\n                this.enqueueSetConnect(c);\r\n                eventer.addElement(c1, 'k_connectbubble', {\r\n                    connection: node.previousConnection,\r\n                    node\r\n                }).tagElement(c1, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.previousConnection, c1 as SvgPath, true);\r\n            }\r\n        }\r\n\r\n        // Next connection (right)\r\n        if (node.nextConnection) {\r\n            const c2 = this.drawConnector(nodeGroup, state.bg, cY, 'right', colors.primary as string);\r\n            if (c2) {\r\n                const c = ({\r\n                    from: node.nextConnection,\r\n                    to: this.resolveConnectable(node.nextConnection.getTo(), node.nextConnection) as Connection,\r\n                    fromCircle: c2 as SvgPath,\r\n                    originConn: node.nextConnection,\r\n                    originCircle: c2\r\n                });\r\n                this.enqueueSetConnect(c);\r\n                eventer.addElement(c2, 'k_connectbubble', {\r\n                    connection: node.nextConnection,\r\n                    node\r\n                }).tagElement(c2, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.nextConnection, c2 as SvgPath, false);\r\n            }\r\n        }\r\n\r\n        node.svgGroup = nodeGroup;\r\n\r\n    }\r\n    fillAllNodeConnectorBubbles() {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { originConn } = connPair;\r\n                if (!originConn) continue;\r\n\r\n                // Only try to fill missing sides with real circles from other pending connections\r\n                if (!connPair.fromCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.from && p.originCircle);\r\n                    if (match) connPair.fromCircle = match.originCircle;\r\n                }\r\n\r\n                if (!connPair.toCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.to && p.originCircle);\r\n                    if (match) connPair.toCircle = match.originCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    drawLinesForAllNodes() {\r\n        const c = this.constants;\r\n        const wsSvg = this._ws.svg;\r\n\r\n        this.fillAllNodeConnectorBubbles();\r\n        const drawnCircles = new Set<SvgPath>(); // store circles we've already drawn lines from/to\r\n\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { fromCircle, toCircle } = connPair;\r\n                if (connPair.from !== connPair.originConn) continue;\r\n                if (!fromCircle || !toCircle) continue;\r\n\r\n                // skip if either circle was already used\r\n                if (drawnCircles.has(fromCircle) || drawnCircles.has(toCircle)) continue;\r\n\r\n                // mark circles as used\r\n                drawnCircles.add(fromCircle);\r\n                drawnCircles.add(toCircle);\r\n                // Get DOM elements\r\n                const fromEl = fromCircle.node as SVGPathElement;\r\n                const toEl = toCircle.node as SVGPathElement;\r\n\r\n                // Use getBBox + getScreenCTM for absolute coordinates\r\n                const fromBBox = fromEl.getBBox();\r\n                const toBBox = toEl.getBBox();\r\n\r\n                const fromCTM = fromEl.getScreenCTM()!;\r\n                const toCTM = toEl.getScreenCTM()!;\r\n\r\n                const startX = fromBBox.x + fromBBox.width / 2;\r\n                const startY = fromBBox.y + fromBBox.height / 2;\r\n                const endX = toBBox.x + toBBox.width / 2;\r\n                const endY = toBBox.y + toBBox.height / 2;\r\n\r\n                // Transform to screen coordinates\r\n                const absStartX = startX * fromCTM.a + startY * fromCTM.c + fromCTM.e;\r\n                const absStartY = startX * fromCTM.b + startY * fromCTM.d + fromCTM.f;\r\n                const absEndX = endX * toCTM.a + endY * toCTM.c + toCTM.e;\r\n                const absEndY = endX * toCTM.b + endY * toCTM.d + toCTM.f;\r\n\r\n                // Draw the line\r\n                let pathStr: string;\r\n                if (c.CONNECTOR_LINE_CURVED) {\r\n                    const dx = Math.abs(absEndX - absStartX);\r\n                    const cp1x = absStartX + Math.sign(absEndX - absStartX) * Math.max(30, dx * 0.3);\r\n                    const cp2x = absEndX - Math.sign(absEndX - absStartX) * Math.max(30, dx * 0.3);\r\n                    pathStr = `M ${absStartX} ${absStartY} C ${cp1x} ${absStartY}, ${cp2x} ${absEndY}, ${absEndX} ${absEndY}`;\r\n                } else {\r\n                    pathStr = `M ${absStartX} ${absStartY} L ${absEndX} ${absEndY}`;\r\n                }\r\n\r\n                const line = wsSvg.path(pathStr)\r\n                    .stroke({ color: parseColor(fromCircle.fill() as Color), width: c.CONNECTOR_LINE_WIDTH })\r\n                    .fill('none')\r\n                    .attr({ class: (this.constructor as typeof Renderer).CONN_LINE_TAG });\r\n\r\n                eventer.addElement(line, 'k_connline', {\r\n                    fromConn: connPair.from,\r\n                    toConn: connPair.to,\r\n                    renderer: this\r\n                }).tagElement(line, [(this.constructor as typeof Renderer).ELEMENT_TAG, (this.constructor as typeof Renderer).LINE_X_MARK_TAG]);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    clearLines() {\r\n        for (let line of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).CONN_LINE_TAG}`)) {\r\n            line.remove();\r\n        }\r\n        for (let mark of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).LINE_X_MARK_TAG}`)) {\r\n            mark.remove();\r\n        }\r\n    }\r\n\r\n    clearScreen() {\r\n        eventer.destroyByTag((this.constructor as typeof Renderer).ELEMENT_TAG)\r\n        this._ws.svg.clear();\r\n        this._drawStates = [];\r\n    }\r\n    undoPendingConnsFor(conn: ConnectorToFrom) {\r\n        for (let state of this._drawStates) {\r\n            for (let conn0 of state.pendingConnections) {\r\n                if (conn0.toCircle == conn.originCircle) {\r\n                    delete conn0.toCircle;\r\n                }\r\n                if (conn0.fromCircle == conn.originCircle) {\r\n                    delete conn0.fromCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    rerenderNode(node: NodeSvg) {\r\n        // wipe old drawstate + events for this node\r\n        const idx = this._drawStates.findIndex(s => s.id === node.id);\r\n        if (idx !== -1) {\r\n            const state = this._drawStates[idx];\r\n            for (let pendingConn of state!.pendingConnections) {\r\n                this.undoPendingConnsFor(pendingConn);\r\n            }\r\n            state!.group?.remove();\r\n            eventer.destroyByTag(`node_${node.id}`);\r\n            this._drawStates.splice(idx, 1);\r\n        }\r\n\r\n        // rebuild node\r\n        this.startNode(node);\r\n        this.drawNode();\r\n        this.storeState();\r\n\r\n        // refresh *all* lines once the node is back in place\r\n        this.refreshConnectionLines();\r\n\r\n        return node.svgGroup;\r\n    }\r\n\r\n}\r\n\r\nexport default Renderer;\r\n","'use strict';\n\n\nvar paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0 };\n\nvar SPECIAL_SPACES = [\n  0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006,\n  0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF\n];\n\nfunction isSpace(ch) {\n  return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029) || // Line terminators\n    // White spaces\n    (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n    (ch >= 0x1680 && SPECIAL_SPACES.indexOf(ch) >= 0);\n}\n\nfunction isCommand(code) {\n  /*eslint-disable no-bitwise*/\n  switch (code | 0x20) {\n    case 0x6D/* m */:\n    case 0x7A/* z */:\n    case 0x6C/* l */:\n    case 0x68/* h */:\n    case 0x76/* v */:\n    case 0x63/* c */:\n    case 0x73/* s */:\n    case 0x71/* q */:\n    case 0x74/* t */:\n    case 0x61/* a */:\n    case 0x72/* r */:\n      return true;\n  }\n  return false;\n}\n\nfunction isArc(code) {\n  return (code | 0x20) === 0x61;\n}\n\nfunction isDigit(code) {\n  return (code >= 48 && code <= 57);   // 0..9\n}\n\nfunction isDigitStart(code) {\n  return (code >= 48 && code <= 57) || /* 0..9 */\n          code === 0x2B || /* + */\n          code === 0x2D || /* - */\n          code === 0x2E;   /* . */\n}\n\n\nfunction State(path) {\n  this.index  = 0;\n  this.path   = path;\n  this.max    = path.length;\n  this.result = [];\n  this.param  = 0.0;\n  this.err    = '';\n  this.segmentStart = 0;\n  this.data   = [];\n}\n\nfunction skipSpaces(state) {\n  while (state.index < state.max && isSpace(state.path.charCodeAt(state.index))) {\n    state.index++;\n  }\n}\n\n\nfunction scanFlag(state) {\n  var ch = state.path.charCodeAt(state.index);\n\n  if (ch === 0x30/* 0 */) {\n    state.param = 0;\n    state.index++;\n    return;\n  }\n\n  if (ch === 0x31/* 1 */) {\n    state.param = 1;\n    state.index++;\n    return;\n  }\n\n  state.err = 'SvgPath: arc flag can be 0 or 1 only (at pos ' + state.index + ')';\n}\n\n\nfunction scanParam(state) {\n  var start = state.index,\n      index = start,\n      max = state.max,\n      zeroFirst = false,\n      hasCeiling = false,\n      hasDecimal = false,\n      hasDot = false,\n      ch;\n\n  if (index >= max) {\n    state.err = 'SvgPath: missed param (at pos ' + index + ')';\n    return;\n  }\n  ch = state.path.charCodeAt(index);\n\n  if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n    index++;\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  // This logic is shamelessly borrowed from Esprima\n  // https://github.com/ariya/esprimas\n  //\n  if (!isDigit(ch) && ch !== 0x2E/* . */) {\n    state.err = 'SvgPath: param should start with 0..9 or `.` (at pos ' + index + ')';\n    return;\n  }\n\n  if (ch !== 0x2E/* . */) {\n    zeroFirst = (ch === 0x30/* 0 */);\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n\n    if (zeroFirst && index < max) {\n      // decimal number starts with '0' such as '09' is illegal.\n      if (ch && isDigit(ch)) {\n        state.err = 'SvgPath: numbers started with `0` such as `09` are illegal (at pos ' + start + ')';\n        return;\n      }\n    }\n\n    while (index < max && isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasCeiling = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x2E/* . */) {\n    hasDot = true;\n    index++;\n    while (isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasDecimal = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x65/* e */ || ch === 0x45/* E */) {\n    if (hasDot && !hasCeiling && !hasDecimal) {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n    if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n      index++;\n    }\n    if (index < max && isDigit(state.path.charCodeAt(index))) {\n      while (index < max && isDigit(state.path.charCodeAt(index))) {\n        index++;\n      }\n    } else {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n  }\n\n  state.index = index;\n  state.param = parseFloat(state.path.slice(start, index)) + 0.0;\n}\n\n\nfunction finalizeSegment(state) {\n  var cmd, cmdLC;\n\n  // Process duplicated commands (without comand name)\n\n  // This logic is shamelessly borrowed from Raphael\n  // https://github.com/DmitryBaranovskiy/raphael/\n  //\n  cmd   = state.path[state.segmentStart];\n  cmdLC = cmd.toLowerCase();\n\n  var params = state.data;\n\n  if (cmdLC === 'm' && params.length > 2) {\n    state.result.push([ cmd, params[0], params[1] ]);\n    params = params.slice(2);\n    cmdLC = 'l';\n    cmd = (cmd === 'm') ? 'l' : 'L';\n  }\n\n  if (cmdLC === 'r') {\n    state.result.push([ cmd ].concat(params));\n  } else {\n\n    while (params.length >= paramCounts[cmdLC]) {\n      state.result.push([ cmd ].concat(params.splice(0, paramCounts[cmdLC])));\n      if (!paramCounts[cmdLC]) {\n        break;\n      }\n    }\n  }\n}\n\n\nfunction scanSegment(state) {\n  var max = state.max,\n      cmdCode, is_arc, comma_found, need_params, i;\n\n  state.segmentStart = state.index;\n  cmdCode = state.path.charCodeAt(state.index);\n  is_arc = isArc(cmdCode);\n\n  if (!isCommand(cmdCode)) {\n    state.err = 'SvgPath: bad command ' + state.path[state.index] + ' (at pos ' + state.index + ')';\n    return;\n  }\n\n  need_params = paramCounts[state.path[state.index].toLowerCase()];\n\n  state.index++;\n  skipSpaces(state);\n\n  state.data = [];\n\n  if (!need_params) {\n    // Z\n    finalizeSegment(state);\n    return;\n  }\n\n  comma_found = false;\n\n  for (;;) {\n    for (i = need_params; i > 0; i--) {\n      if (is_arc && (i === 3 || i === 4)) scanFlag(state);\n      else scanParam(state);\n\n      if (state.err.length) {\n        finalizeSegment(state);\n        return;\n      }\n      state.data.push(state.param);\n\n      skipSpaces(state);\n      comma_found = false;\n\n      if (state.index < max && state.path.charCodeAt(state.index) === 0x2C/* , */) {\n        state.index++;\n        skipSpaces(state);\n        comma_found = true;\n      }\n    }\n\n    // after ',' param is mandatory\n    if (comma_found) {\n      continue;\n    }\n\n    if (state.index >= state.max) {\n      break;\n    }\n\n    // Stop on next segment\n    if (!isDigitStart(state.path.charCodeAt(state.index))) {\n      break;\n    }\n  }\n\n  finalizeSegment(state);\n}\n\n\n/* Returns array of segments:\n *\n * [\n *   [ command, coord1, coord2, ... ]\n * ]\n */\nmodule.exports = function pathParse(svgPath) {\n  var state = new State(svgPath);\n  var max = state.max;\n\n  skipSpaces(state);\n\n  while (state.index < max && !state.err.length) {\n    scanSegment(state);\n  }\n\n  if (state.result.length) {\n    if ('mM'.indexOf(state.result[0][0]) < 0) {\n      state.err = 'SvgPath: string should start with `M` or `m`';\n      state.result = [];\n    } else {\n      state.result[0][0] = 'M';\n    }\n  }\n\n  return {\n    err: state.err,\n    segments: state.result\n  };\n};\n","function unescapeAttr(s: string) {\r\n\treturn s.replace(/&lt;/g, \"<\")\r\n\t\t\t.replace(/&gt;/g, \">\")\r\n\t\t\t.replace(/&quot;/g, '\"')\r\n\t\t\t.replace(/&apos;/g, \"'\")\r\n\t\t\t.replace(/&amp;/g, \"&\");\r\n}\r\n\r\nexport default unescapeAttr;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\n\r\nexport interface WidgetOptions {\r\n    cls?: typeof Widget;\r\n    coords?: Coordinates;      // where to position the widget\r\n    width?: number;            // optional width\r\n    height?: number;           // optional height\r\n    className?: string;        // optional CSS class\r\n    html?: string;             // inner HTML\r\n    name: string;\r\n    init?: (this: WidgetOptions, widget: Widget, html: HTMLElement) => void;\r\n}\r\nclass Widget {\r\n    workspace: WorkspaceSvg;\r\n    container: HTMLDivElement;\r\n    coords: Coordinates;\r\n    width: number;\r\n    height: number;\r\n    visible: boolean;\r\n    name: string;\r\n    id: string;\r\n    options: WidgetOptions;\r\n    static WIDGET_GLOBAL_ID = 0;\r\n    constructor(workspace: WorkspaceSvg, options: WidgetOptions = { name: `Untitled(${Widget.WIDGET_GLOBAL_ID++})` }) {\r\n        this.workspace = workspace;\r\n        this.coords = options.coords ?? new Coordinates(0, 0);\r\n        this.width = options.width ?? 200;\r\n        this.height = options.height ?? 100;\r\n        this.visible = false;\r\n        this.name = options.name;\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        this.options = options;\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n\r\n        if (options.html) this.container.innerHTML = options.html;\r\n\r\n        this.workspace._wsTop.appendChild(this.container);\r\n        this.hide();\r\n        if (typeof options.init !== 'undefined' && options.init) {\r\n            options.init(this, this.container);\r\n        }\r\n    }\r\n\r\n    // Show the widget\r\n    show() {\r\n        this.container.style.display = \"block\";\r\n        this.visible = true;\r\n    }\r\n\r\n    // Hide the widget\r\n    hide() {\r\n        this.container.style.display = \"none\";\r\n        this.visible = false;\r\n    }\r\n\r\n    // Move the widget to new coords\r\n    setCoords(coords: Coordinates) {\r\n        this.coords = coords;\r\n        this.container.style.left = `${coords.x}px`;\r\n        this.container.style.top = `${coords.y}px`;\r\n    }\r\n\r\n    // Update the HTML content\r\n    setHTML(html: string) {\r\n        this.container.innerHTML = html;\r\n    }\r\n    // Bring widget back from the dead after a .destroy call\r\n    reanimate() {\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = this.options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n        \r\n        if (this.options.html) this.container.innerHTML = this.options.html;\r\n\r\n        this.workspace._wsTop.appendChild(this.container);\r\n        this.workspace._addWidgetToDB(this);\r\n    }\r\n    // Destroy widget & cleanup.\r\n    destroy() {\r\n        this.container.remove();\r\n        this.workspace._delWidgetFromDB(this);\r\n    }\r\n}\r\n\r\nexport default Widget;\r\n","'use strict';\n\n/* eslint-disable space-infix-ops */\n\n// The precision used to consider an ellipse as a circle\n//\nvar epsilon = 0.0000000001;\n\n// To convert degree in radians\n//\nvar torad = Math.PI / 180;\n\n// Class constructor :\n//  an ellipse centred at 0 with radii rx,ry and x - axis - angle ax.\n//\nfunction Ellipse(rx, ry, ax) {\n  if (!(this instanceof Ellipse)) { return new Ellipse(rx, ry, ax); }\n  this.rx = rx;\n  this.ry = ry;\n  this.ax = ax;\n}\n\n// Apply a linear transform m to the ellipse\n// m is an array representing a matrix :\n//    -         -\n//   | m[0] m[2] |\n//   | m[1] m[3] |\n//    -         -\n//\nEllipse.prototype.transform = function (m) {\n  // We consider the current ellipse as image of the unit circle\n  // by first scale(rx,ry) and then rotate(ax) ...\n  // So we apply ma =  m x rotate(ax) x scale(rx,ry) to the unit circle.\n  var c = Math.cos(this.ax * torad), s = Math.sin(this.ax * torad);\n  var ma = [\n    this.rx * (m[0]*c + m[2]*s),\n    this.rx * (m[1]*c + m[3]*s),\n    this.ry * (-m[0]*s + m[2]*c),\n    this.ry * (-m[1]*s + m[3]*c)\n  ];\n\n  // ma * transpose(ma) = [ J L ]\n  //                      [ L K ]\n  // L is calculated later (if the image is not a circle)\n  var J = ma[0]*ma[0] + ma[2]*ma[2],\n      K = ma[1]*ma[1] + ma[3]*ma[3];\n\n  // the discriminant of the characteristic polynomial of ma * transpose(ma)\n  var D = ((ma[0]-ma[3])*(ma[0]-ma[3]) + (ma[2]+ma[1])*(ma[2]+ma[1])) *\n          ((ma[0]+ma[3])*(ma[0]+ma[3]) + (ma[2]-ma[1])*(ma[2]-ma[1]));\n\n  // the \"mean eigenvalue\"\n  var JK = (J + K) / 2;\n\n  // check if the image is (almost) a circle\n  if (D < epsilon * JK) {\n    // if it is\n    this.rx = this.ry = Math.sqrt(JK);\n    this.ax = 0;\n    return this;\n  }\n\n  // if it is not a circle\n  var L = ma[0]*ma[1] + ma[2]*ma[3];\n\n  D = Math.sqrt(D);\n\n  // {l1,l2} = the two eigen values of ma * transpose(ma)\n  var l1 = JK + D/2,\n      l2 = JK - D/2;\n  // the x - axis - rotation angle is the argument of the l1 - eigenvector\n  /*eslint-disable indent*/\n  this.ax = (Math.abs(L) < epsilon && Math.abs(l1 - K) < epsilon) ?\n    90\n  :\n    Math.atan(Math.abs(L) > Math.abs(l1 - K) ?\n      (l1 - J) / L\n    :\n      L / (l1 - K)\n    ) * 180 / Math.PI;\n  /*eslint-enable indent*/\n\n  // if ax > 0 => rx = sqrt(l1), ry = sqrt(l2), else exchange axes and ax += 90\n  if (this.ax >= 0) {\n    // if ax in [0,90]\n    this.rx = Math.sqrt(l1);\n    this.ry = Math.sqrt(l2);\n  } else {\n    // if ax in ]-90,0[ => exchange axes\n    this.ax += 90;\n    this.rx = Math.sqrt(l2);\n    this.ry = Math.sqrt(l1);\n  }\n\n  return this;\n};\n\n// Check if the ellipse is (almost) degenerate, i.e. rx = 0 or ry = 0\n//\nEllipse.prototype.isDegenerate = function () {\n  return (this.rx < epsilon * this.ry || this.ry < epsilon * this.rx);\n};\n\nmodule.exports = Ellipse;\n","import Coordinates from \"./coordinates\";\r\n\r\n\r\n\r\n\r\nclass WorkspaceCoords extends Coordinates {\r\n    constructor(x = 0, y = 0) {\r\n        super(x, y);\r\n    }\r\n}\r\nexport default WorkspaceCoords;","import Coordinates from \"./coordinates\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { Svg, SVG } from '@svgdotjs/svg.js';\r\nimport Renderer from '../renderers/renderer';\r\nimport { InjectOptions } from \"./inject\";\r\nimport WorkspaceCoords from \"./workspace-coords\";\r\nimport WorkspaceController from '../controllers/base';\r\nimport WASDController from '../controllers/wasd';\r\nimport { RMap } from \"./renderer-map\";\r\nimport Toolbox from \"./toolbox\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport newHeadlessNode from \"./headless-node\";\r\nimport Widget from \"./widget\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport ContextMenuHTML from \"./context-menu\";\r\nimport CommentModel from \"./comment\";\r\nimport Field, { ConnectableField } from \"./field\";\r\n\r\n\r\nfunction resolveController(options: InjectOptions): typeof WorkspaceController {\r\n    if (options?.controls) {\r\n        if (options?.controls.wasd) {\r\n            return WASDController;\r\n        }\r\n    }\r\n    return WorkspaceController;\r\n}\r\n/** \r\n * Represents the visual workspace containing nodes and connections.\r\n * Handles rendering, panning, and coordinate transformations.\r\n */\r\nclass WorkspaceSvg {\r\n    /** Top-left offset of the workspace viewport */\r\n    _camera: WorkspaceCoords;\r\n\r\n    /** Node storage by unique ID */\r\n    _nodeDB: Map<string, NodeSvg>;\r\n\r\n    /** Root HTML container for the workspace */\r\n    _root: HTMLElement;\r\n\r\n    /** Top-level wrapper for the SVG */\r\n    _wsTop: HTMLElement;\r\n\r\n    /** SVG.js instance for rendering */\r\n    svg: Svg;\r\n\r\n    /** Renderer instance for drawing nodes and connections */\r\n    renderer: Renderer;\r\n\r\n    /** Options for workspace behavior and rendering overrides */\r\n    options: InjectOptions;\r\n\r\n    /** Flag to temporarily prevent redraws */\r\n    noRedraw: boolean;\r\n    /**\r\n     * A class instance that moves the camera based on user interactions.\r\n     */\r\n    controller: WorkspaceController;\r\n    /**\r\n     * Toolbox for the workspace.\r\n     */\r\n    toolbox?: Toolbox;\r\n    /**\r\n     * A list of widgets active in this workspace\r\n     */\r\n    _widgetDB: Map<string, Widget>\r\n\r\n    /**\r\n     * A manager for the context menu widget\r\n     */\r\n    _ctxMenu: ContextMenuHTML\r\n    /**\r\n     * A list of comments for this workspace.\r\n     */\r\n    _commentDB: Set<CommentModel>;\r\n    /**\r\n     * Creates a new WorkspaceSvg instance.\r\n     * @param root - The root HTML element containing the workspace.\r\n     * @param wsTop - The top-level wrapper element for the SVG.\r\n     * @param options - Configuration and renderer override options.\r\n     */\r\n    constructor(root: HTMLElement, wsTop: HTMLElement, options: InjectOptions) {\r\n        wsTop.style.width = '100%';\r\n        wsTop.style.height = '100%';\r\n\r\n        this._root = root;\r\n        this._wsTop = wsTop;\r\n        this.svg = SVG().addTo(this._wsTop).size('100%', '100%');\r\n        this.options = options;\r\n        let RClass: typeof Renderer = RMap.resolve(options.renderer);\r\n        this.renderer = new RClass(this, this.options.rendererOverrides || {});\r\n        if (this.options.toolbox) {\r\n            this.toolbox = new Toolbox(this);\r\n        }\r\n        this._camera = new WorkspaceCoords(0, 0);\r\n        this._nodeDB = new Map();\r\n        this.noRedraw = false;\r\n        this.controller = new (options.Controller ?? resolveController(options))(this);\r\n        this._widgetDB = new Map();\r\n        this._ctxMenu = new ContextMenuHTML(this);\r\n        this._commentDB = new Set();\r\n    }\r\n    /**\r\n     * Refresh comments.\r\n     */\r\n    refreshComments() {\r\n        this.renderer.refreshComments();\r\n    }\r\n    /**\r\n     * Get all comments\r\n     * @returns {CommentModel[]}\r\n     */\r\n    getComments() {\r\n        return Array.from(this._commentDB);\r\n    }\r\n    /**\r\n     * Duplicate node data from one to another\r\n     * @param nodeSvg - The node\r\n     */\r\n    cloneNode(nodeSvg: NodeSvg) {\r\n        const n = new NodeSvg(nodeSvg.prototype, this);\r\n        n.init();\r\n        n.fromNode(nodeSvg);\r\n        this.redraw();\r\n    }\r\n    /**\r\n     * Internal: Add widget to DB\r\n     * @param wdgt - The widget\r\n     */\r\n    _addWidgetToDB(wdgt: Widget) {\r\n        this._widgetDB.set(wdgt.id, wdgt);\r\n    }\r\n    /**\r\n     * Internal: Delete a widget from DB.\r\n     * @param wdgt - Widget to delete\r\n     */\r\n    _delWidgetFromDB(wdgt: Widget) {\r\n        this._widgetDB.delete(wdgt.id);\r\n    }\r\n    /**\r\n     * Create a new widget of type.\r\n     * @param type - The prototype\r\n     * @returns {Widget|void}\r\n     */\r\n    newWidget(type: string): void | Widget {\r\n        const opts = WidgetPrototypes[type];\r\n        if (!opts) return;\r\n        if (opts.cls) {\r\n            const wdgt = new (opts.cls)(this, opts);\r\n            this._addWidgetToDB(wdgt);\r\n            return wdgt;\r\n        }\r\n        const wdgt = new Widget(this, opts);\r\n        this._addWidgetToDB(wdgt);\r\n        return wdgt;\r\n    }\r\n    /**\r\n     * Get a widget\r\n     * @param id - Identifier\r\n     * @returns {Widget|undefined} - A widget\r\n     */\r\n    getWidget(id: string): Widget | undefined {\r\n        if (this._widgetDB.has(id)) return this._widgetDB.get(id);\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace's svg content size in pixels.\r\n     * Useful for camera positioning.\r\n     */\r\n    getContentSize(): { width: number; height: number } {\r\n        const bbox = this.svg.bbox();\r\n        return { width: bbox.width, height: bbox.height };\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace in pixels.\r\n     * Useful for camera centering, zoom calculations, and viewport sizing.\r\n     */\r\n    getSize(): { width: number; height: number } {\r\n        const rect = this._wsTop.getBoundingClientRect();\r\n        return { width: rect.width, height: rect.height };\r\n    }\r\n\r\n    /**\r\n     * Updates all connection lines & node screen positions without a full redraw.\r\n     * Used when nodes are dragged or the camera moves.\r\n     */\r\n    refresh() {\r\n        this.renderer.refreshNodeTransforms();\r\n    }\r\n\r\n    /** Draws all nodes in the workspace. Very heavy. */\r\n    drawAllNodes() {\r\n        for (let [nodeId, _] of this._nodeDB) {\r\n            this.drawNode(nodeId);\r\n        }\r\n    }\r\n\r\n    /** Redraws the entire workspace unless noRedraw is set. */\r\n    redraw() {\r\n        if (this.noRedraw) return;\r\n        this.renderer.clearScreen();\r\n        this.drawAllNodes();\r\n        this.refresh();\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n\r\n    /**\r\n     * Converts workspace coordinates to screen (SVG) coordinates.\r\n     * @param x - X position in workspace coordinates.\r\n     * @param y - Y position in workspace coordinates.\r\n     * @returns Screen coordinates as a Coordinates instance.\r\n     */\r\n    workspaceToScreen(x: number, y: number): Coordinates {\r\n        const { x: rx, y: ry } = this.controller.workspaceToScreen(x, y);\r\n        return new Coordinates(rx, ry);\r\n    }\r\n\r\n    /**\r\n     * Converts screen (SVG) coordinates to workspace coordinates.\r\n     * @param x - X position in screen coordinates.\r\n     * @param y - Y position in screen coordinates.\r\n     * @returns Workspace coordinates as a Coordinates instance.\r\n     */\r\n    screenToWorkspace(x: number, y: number): Coordinates {\r\n        const { x: rx, y: ry } = this.controller.screenToWorkspace(x, y);\r\n        return new Coordinates(rx, ry);\r\n    }\r\n\r\n    /**\r\n     * Draws a node by its ID.\r\n     * @param id - The ID of the node to render.\r\n     * @returns The rendered node.\r\n     */\r\n    drawNode(id: string) {\r\n        return this.renderer.renderNode(id);\r\n    }\r\n\r\n    /**\r\n     * Adds a node to the workspace.\r\n     * @param node - The node instance to add.\r\n     * @param nodeId - Optional custom ID to use instead of node.id.\r\n     */\r\n    addNode(node: NodeSvg, nodeId?: string) {\r\n        let id = nodeId || node.id;\r\n        if (this._nodeDB.has(id)) {\r\n            console.warn(`Node with id ${id} already exists, overwriting.`);\r\n        }\r\n        if (node.workspace !== this) {\r\n            node.workspace = this;\r\n        }\r\n        this._nodeDB.set(id, node);\r\n        this.redraw();\r\n    }\r\n\r\n    /**\r\n     * Create a new node of *type*.\r\n     * @param type - The node's prototype name.\r\n     */\r\n    newNode(type: keyof typeof NodePrototypes): NodeSvg | undefined {\r\n        if (!NodePrototypes[type]) return;\r\n        const node = newHeadlessNode(type as string);\r\n        if (!node) return;\r\n        this.addNode(node);\r\n        return node;\r\n    }\r\n    /**\r\n     * Spawns a node at x, y of prototype type\r\n     * @param type - The node prototype name\r\n     * @param x - X position\r\n     * @param y - Y position\r\n     * @returns {Node} - The new node\r\n     */\r\n    spawnAt(type: keyof typeof NodePrototypes, x: number, y: number): NodeSvg | undefined {\r\n        const node = this.newNode(type);\r\n        if (!node) return;\r\n        node.relativeCoords.set(x, y);\r\n        this.redraw();\r\n        return node;\r\n    }\r\n    /**\r\n     * Dereference a node from all of its connected neighbors\r\n     */\r\n    derefNode(node: NodeSvg) {\r\n        // Disconnect from previous node or field\r\n        const prev = node.previousConnection?.getFrom?.();\r\n        if (prev instanceof NodeSvg) {\r\n            prev.nextConnection?.disconnectTo();\r\n        } else if (prev instanceof ConnectableField && prev.hasConnectable()) {\r\n            prev.disconnect();\r\n        }\r\n\r\n        // Disconnect from next node\r\n        const next = node.nextConnection?.getTo?.();\r\n        if (next instanceof NodeSvg) {\r\n            next.previousConnection?.disconnectFrom();\r\n        }\r\n\r\n        // Disconnect all fields\r\n        for (let field of node.allFields()) {\r\n            if ((field as ConnectableField).hasConnectable?.()) {\r\n                (field as ConnectableField).disconnect();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Removes a node by its ID.\r\n     * @param id - The ID of the node to remove.\r\n     */\r\n    removeNodeById(id: string) {\r\n        const node = this._nodeDB.get(id);\r\n        if (!node) return;\r\n        this.derefNode(node);\r\n        this._nodeDB.delete(id);\r\n        this.redraw();\r\n    }\r\n\r\n    /**\r\n     * Removes a node by its instance.\r\n     * @param node - The node instance to remove.\r\n     */\r\n    removeNode(node: NodeSvg) {\r\n        if (!node) return;\r\n        this.removeNodeById(node.id);\r\n    }\r\n\r\n    /**\r\n     * Retrieves a node by its ID.\r\n     * @param id - The ID of the node.\r\n     * @returns The NodeSvg instance or undefined if not found.\r\n     */\r\n    getNode(id: string): NodeSvg | undefined {\r\n        return this._nodeDB.get(id);\r\n    }\r\n\r\n    /**\r\n     * Pans the camera by the given delta values.\r\n     * @param dx - Change in X direction.\r\n     * @param dy - Change in Y direction.\r\n     */\r\n    pan(dx: number, dy: number) {\r\n        this._camera.x += dx;\r\n        this._camera.y += dy;\r\n    }\r\n    /**\r\n     * Comment methods\r\n     */\r\n\r\n    /**\r\n     * Adds a comment, returns the model.\r\n     */\r\n    addComment() {\r\n        const model = new CommentModel(this);\r\n        this._commentDB.add(model);\r\n        this.redrawComments();\r\n        return model;\r\n    }\r\n    /**\r\n     * Gets a comment by id\r\n     * @param id - The comment id.\r\n     */\r\n    getComment(id: string) {\r\n        return Array.from(this._commentDB).find(e => e.id === id);\r\n    }\r\n    /**\r\n     * Remove a comment by its instance or id.\r\n     * @param commentOrId - The comment instance or its id.\r\n     */\r\n    removeComment(commentOrId: CommentModel | string) {\r\n        let comment: CommentModel | undefined;\r\n\r\n        if (typeof commentOrId === \"string\") {\r\n            comment = this.getComment(commentOrId);\r\n        } else {\r\n            comment = commentOrId;\r\n        }\r\n\r\n        if (!comment) return false;\r\n\r\n        this._commentDB.delete(comment);\r\n        this.redrawComments();\r\n        return true;\r\n    }\r\n    /**\r\n     * Redraw all comments in this workspace.\r\n     */\r\n    redrawComments() {\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n}\r\n\r\nexport default WorkspaceSvg;\r\n","// color-utils.ts\r\nimport type { Color, Hex } from '../src/visual-types';\r\n\r\n/**\r\n * Parse any Color type into a hex string \"#RRGGBB\"\r\n */\r\nexport function parseColor(color: Color): Hex {\r\n\tif (typeof color === 'string') {\r\n\t\tif (color.startsWith('#')) {\r\n\t\t\t// Already a hex string, normalize to full #RRGGBB\r\n\t\t\tlet hex = color.slice(1);\r\n\t\t\tif (hex.length === 3) hex = hex.split('').map(c => c + c).join('');\r\n\t\t\treturn `#${hex}`;\r\n\t\t} else {\r\n\t\t\t// RGB string \"r, g, b\"\r\n\t\t\tconst parts = color.split(',').map(s => parseInt(s.trim(), 10));\r\n\t\t\tif (parts.length !== 3) throw new Error(`Invalid RGB string: ${color}`);\r\n\t\t\tconst [r, g, b] = parts;\r\n            if (!r || !g || !b) {\r\n                console.warn(\r\n                    \"Invalid RGB tuple\"\r\n                );\r\n                return \"#000\";\r\n            }\r\n\t\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t\t.toString(16)\r\n\t\t\t\t.padStart(2, '0')}`;\r\n\t\t}\r\n\t} else if (Array.isArray(color)) {\r\n\t\t// RGBTuple [r,g,b]\r\n\t\tconst [r, g, b] = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t} else {\r\n\t\t// RGBObject {r,g,b}\r\n\t\tconst { r, g, b } = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t}\r\n}\r\n","// path.ts\r\n/**\r\n * Utility functions to generate SVG path strings or translate them.\r\n */\r\n\r\n/** Rounded rectangle */\r\nexport function roundedRect(width: number, height: number, radius: number): string {\r\n\tradius = Math.min(radius, width / 2, height / 2);\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tH${width - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width},${radius}\r\n\t\tV${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius},${height}\r\n\t\tH${radius}\r\n\t\tA${radius},${radius} 0 0 1 0,${height - radius}\r\n\t\tV${radius}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Rounded triangle pointing up */\r\nexport function roundedTri(width: number, height: number, radius: number): string {\r\n\tconst halfW = width / 2;\r\n\tradius = Math.min(radius, halfW, height / 2);\r\n\treturn `\r\n\t\tM${halfW},0\r\n\t\tL${width - radius},${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius*2},${height}\r\n\t\tL${radius*2},${height}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},${height - radius}\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Circle */\r\nexport function circle(radius: number): string {\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${-radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Ellipse */\r\nexport function ellipse(rx: number, ry: number): string {\r\n\treturn `\r\n\t\tM${rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${-rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${rx},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Star with n points */\r\nexport function star(radius: number, points: number = 5): string {\r\n\tif (points < 2) throw new Error('Star must have at least 2 points');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / (points * 2);\r\n\tfor (let i = 0; i < points * 2; i++) {\r\n\t\tconst r = i % 2 === 0 ? radius : radius / 2;\r\n\t\tconst x = r * Math.sin(i * step);\r\n\t\tconst y = -r * Math.cos(i * step);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\n\r\n/** Regular polygon (triangle, pentagon, hexagon, etc) */\r\nexport function polygon(radius: number, sides: number = 3): string {\r\n\tif (sides < 3) throw new Error('Polygon must have at least 3 sides');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / sides;\r\n\tfor (let i = 0; i < sides; i++) {\r\n\t\tconst x = radius * Math.cos(i * step - Math.PI / 2);\r\n\t\tconst y = radius * Math.sin(i * step - Math.PI / 2);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\nimport SvgPath from 'svgpath';\r\n\r\n/**\r\n * Rotate an SVG path string around a given point\r\n * @param path - SVG path string\r\n * @param angle - rotation angle in degrees\r\n * @param cx - x-coordinate of rotation center (default 0)\r\n * @param cy - y-coordinate of rotation center (default 0)\r\n * @returns new rotated SVG path string\r\n */\r\nexport function rotatePath(path: string, angle: number, cx = 0, cy = 0): string {\r\n\treturn new SvgPath(path)\r\n\t\t.rotate(angle, cx, cy)\r\n\t\t.toString();\r\n}\r\n","'use strict';\n\n\nvar Matrix = require('./matrix');\n\nvar operations = {\n  matrix: true,\n  scale: true,\n  rotate: true,\n  translate: true,\n  skewX: true,\n  skewY: true\n};\n\nvar CMD_SPLIT_RE    = /\\s*(matrix|translate|scale|rotate|skewX|skewY)\\s*\\(\\s*(.+?)\\s*\\)[\\s,]*/;\nvar PARAMS_SPLIT_RE = /[\\s,]+/;\n\n\nmodule.exports = function transformParse(transformString) {\n  var matrix = new Matrix();\n  var cmd, params;\n\n  // Split value into ['', 'translate', '10 50', '', 'scale', '2', '', 'rotate',  '-45', '']\n  transformString.split(CMD_SPLIT_RE).forEach(function (item) {\n\n    // Skip empty elements\n    if (!item.length) { return; }\n\n    // remember operation\n    if (typeof operations[item] !== 'undefined') {\n      cmd = item;\n      return;\n    }\n\n    // extract params & att operation to matrix\n    params = item.split(PARAMS_SPLIT_RE).map(function (i) {\n      return +i || 0;\n    });\n\n    // If params count is not correct - ignore command\n    switch (cmd) {\n      case 'matrix':\n        if (params.length === 6) {\n          matrix.matrix(params);\n        }\n        return;\n\n      case 'scale':\n        if (params.length === 1) {\n          matrix.scale(params[0], params[0]);\n        } else if (params.length === 2) {\n          matrix.scale(params[0], params[1]);\n        }\n        return;\n\n      case 'rotate':\n        if (params.length === 1) {\n          matrix.rotate(params[0], 0, 0);\n        } else if (params.length === 3) {\n          matrix.rotate(params[0], params[1], params[2]);\n        }\n        return;\n\n      case 'translate':\n        if (params.length === 1) {\n          matrix.translate(params[0], 0);\n        } else if (params.length === 2) {\n          matrix.translate(params[0], params[1]);\n        }\n        return;\n\n      case 'skewX':\n        if (params.length === 1) {\n          matrix.skewX(params[0]);\n        }\n        return;\n\n      case 'skewY':\n        if (params.length === 1) {\n          matrix.skewY(params[0]);\n        }\n        return;\n    }\n  });\n\n  return matrix;\n};\n","import WorkspaceController from './base';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WASDController extends WorkspaceController {\r\n\tmoveSpeed: number;\r\n\tdoAccelerate?: boolean;\r\n\taccelSpeed: number;\r\n\tfriction: number;\r\n\tvelocity: Vec2;\r\n\r\n\tconstructor(workspace: WorkspaceSvg, moveSpeed?: number) {\r\n\t\tsuper(workspace);\r\n\t\tthis.moveSpeed = workspace.options.moveSpeed || moveSpeed || 5;\r\n\r\n\t\tthis.doAccelerate = workspace.options?.controls?.wasdSmooth ?? false;\r\n\t\tthis.accelSpeed = workspace.options?.controls?.wasdAccelerate ?? 0.2;\r\n\t\tthis.friction = workspace.options?.controls?.wasdFriction ?? 0.85;\r\n\r\n\t\tthis.velocity = { x: 0, y: 0 };\r\n\t}\r\n    canMove() {\r\n        return !userState.hasState('typing');\r\n    }\r\n\tupdate() {\r\n\t\tsuper.update();\r\n\t\tif (!this.canMove()) return;\r\n\r\n\t\tlet inputX = 0;\r\n\t\tlet inputY = 0;\r\n\r\n\t\tif (this.keysDown.has('w') || this.keysDown.has('ArrowUp')) inputY -= 1;\r\n\t\tif (this.keysDown.has('s') || this.keysDown.has('ArrowDown')) inputY += 1;\r\n\t\tif (this.keysDown.has('a') || this.keysDown.has('ArrowLeft')) inputX -= 1;\r\n\t\tif (this.keysDown.has('d') || this.keysDown.has('ArrowRight')) inputX += 1;\r\n\r\n\t\tif (this.doAccelerate) {\r\n\t\t\t// Accelerate velocity towards input direction\r\n\t\t\tthis.velocity.x += inputX * this.accelSpeed;\r\n\t\t\tthis.velocity.y += inputY * this.accelSpeed;\r\n\r\n\t\t\t// Apply friction\r\n\t\t\tthis.velocity.x *= this.friction;\r\n\t\t\tthis.velocity.y *= this.friction;\r\n\r\n\t\t\t// Only pan if velocity is noticeable\r\n\t\t\tif (Math.abs(this.velocity.x) > 0.01 || Math.abs(this.velocity.y) > 0.01) {\r\n\t\t\t\tthis.pan(this.velocity.x, this.velocity.y);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Instant movement\r\n\t\t\tconst dx = inputX * this.moveSpeed;\r\n\t\t\tconst dy = inputY * this.moveSpeed;\r\n\t\t\tif (dx !== 0 || dy !== 0) this.pan(dx, dy);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Element, Svg } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport Renderer, { ConnectorToFrom, DrawState } from '../renderers/renderer';\r\n\r\nfunction initConnectionLine(element: Element, args: Record<string, any>): () => void {\r\n    // click destroys the line\r\n    const handleClick = () => {\r\n        args.fromConn.disconnectTo();\r\n        args.toConn.disconnectFrom();\r\n        element.remove();\r\n        xMark.remove();\r\n        const remove: ConnectorToFrom[] = [];\r\n        for (let state of args.renderer._drawStates as DrawState[]) {\r\n            for (let pair of state.pendingConnections) {\r\n                if (pair.from == args.fromConn && pair.to == args.toConn) {\r\n                    remove.push(pair);\r\n                }\r\n                if (pair.from = args.toConn && pair.to == args.fromConn) {\r\n                    remove.push(pair);\r\n                }\r\n            }\r\n            state.pendingConnections = state.pendingConnections.filter(e => !remove.includes(e));\r\n        }\r\n    };\r\n\r\n    // create X element\r\n    const bbox = element.bbox();\r\n    const midX = bbox.x + bbox.width / 2;\r\n    const midY = bbox.y + bbox.height / 2;\r\n    const xMark = (element.parent()! as Svg).text('X').font({\r\n        family: 'Arial, Helvetica, sans-serif',\r\n        size: 46,\r\n        weight: 'bold',\r\n        anchor: 'middle',\r\n        leading: '1em'\r\n    })\r\n        .addClass((args.renderer.constructor as typeof Renderer).LINE_X_MARK_TAG)\r\n        .center(midX, midY)\r\n        .fill('#fff')           // white fill\r\n        .stroke({ color: '#000', width: 2 })  // black outline\r\n        .hide();\r\n\r\n    xMark.on('click', handleClick)\r\n    xMark.node.style.userSelect = 'none';\r\n    // show X on hover\r\n    element.on('mouseover', () => xMark.show());\r\n    element.on('mouseout', () => xMark.hide());\r\n\r\n    // attach click event\r\n    element.on('click', handleClick);\r\n\r\n    // cleanup function\r\n    return () => {\r\n        element.off('click', handleClick);\r\n        element.off('mouseover');\r\n        element.off('mouseout');\r\n        xMark.off('click', handleClick);\r\n        xMark.remove();\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_connline', initConnectionLine as EventSetupFn);\r\n","import Connection from \"./connection\";\r\nimport { G, Path, Rect, Svg, SVG, Text } from '@svgdotjs/svg.js';\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { ConnectorToFrom } from \"../renderers/renderer\";\r\nimport dropdownContainer, { DropdownOptions } from \"./dropdown-menu\";\r\n/**\r\n * Options used to initialize a Field.\r\n */\r\nexport interface FieldOptions {    /** Name of the field */\r\n    name: string;\r\n    /** Human-readable label for the field */\r\n    label: string;\r\n    /** Key used to identify the field type in FieldTypesMap */\r\n    type: string;\r\n    /** Field value (optional) */\r\n    value?: any;\r\n    /** Only used by OptConnectField to determine internal value type */\r\n    fld_type?: \"number\" | \"string\";\r\n    [key: string]: any;\r\n};\r\n\r\nexport interface FieldVisualInfo {\r\n    measuredWidth: number; // The width approximated by the field itself.\r\n    measuredHeight: number; // The height approximated by the field itself.\r\n    background: Rect; // The node's background element.\r\n    svg: Svg; // The workspace's SVG.js svg\r\n    nodeGroup: G; // Group for the node\r\n    fieldGroup: G; // A group containing the label & input.\r\n    xUsed: number; // The amount of x space used up by the label.\r\n}\r\nexport interface FieldRawBoxData {\r\n    box: Rect;\r\n    txt: Text;\r\n}\r\nexport interface FieldConnectionData {\r\n    connector: Path;\r\n    connState: ConnectorToFrom\r\n}\r\n/**\r\n * Base class for all fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nclass Field<T = any> {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n    protected value: T | null;\r\n    static register(name: string, cls: Function) { };\r\n    static unregister(name: string) { };\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.value = null;\r\n        this.editable = true;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n        if (json.value !== undefined) this.value = json.value;\r\n        if (json.editable) this.setEditable(Boolean(json.editable));\r\n    }\r\n\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: null, height: null }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /** @returns The stored value */\r\n    getValue(): T | null {\r\n        return this.value;\r\n    }\r\n\r\n    /**\r\n     * Set the stored value\r\n     * @param val New value\r\n     */\r\n    setValue(val: T) {\r\n        this.value = val;\r\n    }\r\n\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue(): T | null {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Used when you want just a label with no actual value. Any value related methods are no-op.\r\n */\r\nexport class DummyField {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.editable = false;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n    }\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: 0, height: 0 }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /**\r\n     * Dummy fields have no value.\r\n     * @returns {null}\r\n     */\r\n    getValue() {\r\n        return null;\r\n    }\r\n    /**\r\n     * No-op for dummy fields\r\n     */\r\n    setValue(_: any) { }\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue() {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Base class for fields that can be connected to other fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nexport class ConnectableField<T = any> extends Field<T> {\r\n    connection: Connection;\r\n\r\n    constructor() {\r\n        super();\r\n        this.connection = new Connection(this, null);\r\n        this.value = null as T;\r\n    }\r\n    hasConnectable(): boolean {\r\n        return true;\r\n    }\r\n\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** Disconnect this field from any connected Connectable */\r\n    disconnect() {\r\n        const to = this.connection.to;\r\n        if (to instanceof NodeSvg && to?.previousConnection?.from) {\r\n            to.previousConnection.from = null;\r\n            this.connection.to = null;\r\n        }\r\n    }\r\n}\r\n\r\n/** Field storing a numeric value */\r\nexport class NumberField extends Field<number> {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    setValue(val: number) {\r\n        this.value = Number(val);\r\n    }\r\n}\r\n\r\n/** Field storing a string value */\r\nexport class TextField extends Field<string> {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    setValue(val: string) {\r\n        this.value = String(val);\r\n    }\r\n}\r\n\r\n/**\r\n * Optional connectable field.\r\n * Can store either a number or string depending on fld_type.\r\n */\r\nexport class OptConnectField extends ConnectableField<number | string | NodeSvg> {\r\n    fldType: \"number\" | \"string\";\r\n\r\n    constructor() {\r\n        super();\r\n        this.fldType = \"string\";\r\n    }\r\n    canEditConnector(): boolean {\r\n        return true;\r\n    }\r\n    canEdit() {\r\n        if (this.getValue() instanceof NodeSvg) {\r\n            return false;\r\n        }\r\n        return this.editable;\r\n    }\r\n    getValue(): string | number | NodeSvg | null {\r\n        if (this.connection && this.connection.getTo()) {\r\n            return this.connection.getTo() as NodeSvg;\r\n        } else {\r\n            return this.value;\r\n        }\r\n    }\r\n    hasRaw() {\r\n        return true;\r\n    }\r\n    hasConnectable() {\r\n        return true;\r\n    }\r\n    /**\r\n     * Set field type.\r\n     * @param type \"number\"|\"string\"\r\n     */\r\n    setFieldType(type: \"number\" | \"string\") {\r\n        this.fldType = type;\r\n    }\r\n    /**\r\n     * Initialize from JSON, respecting fld_type\r\n     * @param json FieldOptions\r\n     */\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        this.fldType = json.fld_type || \"string\";\r\n        if (this.value != null && typeof this.value == this.fldType) {\r\n            this.setValue(this.value as string | number);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the value, converting to number or string depending on fld_type\r\n     * @param val The new value\r\n     */\r\n    setValue(val: number | string) {\r\n        if (this.fldType === \"number\") this.value = Number(val);\r\n        else this.value = String(val);\r\n    }\r\n\r\n    /**\r\n     * @returns Display value for UI purposes (never null)\r\n     */\r\n    getDisplayValue(): string {\r\n        if (this.value == null) return this.fldType === \"number\" ? \"0\" : \"\";\r\n        if (this.getValue() instanceof NodeSvg) return '[NODE]'; // If theres a connection\r\n        return String(this.value);\r\n    }\r\n    toJson(deep: boolean): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: deep ? val.serialize() : val.id };\r\n\r\n        return {\r\n            ...super.toJson(true),\r\n            fld_type: this.fldType,\r\n            value: val\r\n        };\r\n    }\r\n}\r\nexport type DropdownItem = { text: string, value: string } | string\r\nexport class DropdownField extends Field<string> {\r\n    options: DropdownItem[] | null;\r\n    _selected: DropdownItem | null;\r\n    _isOpen: boolean;\r\n\r\n    constructor() {\r\n        super();\r\n        this.options = null;\r\n        this._selected = null;\r\n        this._isOpen = false;\r\n    }\r\n\r\n    onDraw(rawBox?: FieldRawBoxData) {\r\n        if (!rawBox || !this.options) return;\r\n\r\n        const { box, txt } = rawBox;\r\n        const toggle = () => this.toggleDropdown(rawBox);\r\n        box.click(toggle);\r\n        txt.click(toggle);\r\n    }\r\n\r\n    private toggleDropdown(rawBox: FieldRawBoxData) {\r\n        if (dropdownContainer.getOwner() === this) {\r\n            this.closeDropdown();\r\n        } else {\r\n            this.openDropdown(rawBox);\r\n        }\r\n        rawBox.txt.text(this.getDisplayValue());\r\n    }\r\n\r\n    private openDropdown(rawBox: FieldRawBoxData) {\r\n        if (!this.options) return;\r\n\r\n        const items = this.options.map(option => ({\r\n            label: typeof option === 'string' ? option : option.text,\r\n            value: typeof option === 'string' ? option : option.value\r\n        }));\r\n\r\n        dropdownContainer.show(this, {\r\n            items,\r\n            width: rawBox.box.bbox().width * 2,\r\n            onSelect: (value: string) => {\r\n                if (!this.options) return;\r\n                const original = this.options.find(\r\n                    e => e === value || (typeof e !== 'string' && e.value === value)\r\n                );\r\n                if (original) {\r\n                    this._selected = original;\r\n                    this.setValue(value);\r\n                    this.closeDropdown();\r\n                    this?.node?.workspace?.renderer?.rerenderNode?.(this.node);\r\n                }\r\n            }\r\n        } as DropdownOptions);\r\n    }\r\n\r\n    private closeDropdown() {\r\n        dropdownContainer.hideIfOwner(this);\r\n    }\r\n\r\n    canEdit() {\r\n        return false;\r\n    }\r\n\r\n    getSelected() {\r\n        return this._selected;\r\n    }\r\n\r\n    fromJson(options: FieldOptions) {\r\n        super.fromJson(options);\r\n        this.options = options.options as DropdownItem[];\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(\r\n            typeof this._selected === 'string' ? this._selected : this._selected.value\r\n        );\r\n    }\r\n\r\n    // Up/down arrows\r\n    getDisplayValue(): string {\r\n        const text = typeof this._selected === 'string' ? this._selected : this._selected?.text || '';\r\n        const arrow = dropdownContainer.getOwner() == this ? '' : ''; // toggles open/closed\r\n        return text + '  ' + arrow;\r\n    }\r\n\r\n\r\n    setOptions(options: DropdownItem[]) {\r\n        this.options = options;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(\r\n            typeof this._selected === 'string' ? this._selected : this._selected.value\r\n        );\r\n    }\r\n\r\n    toJson(deep: boolean): FieldOptions {\r\n        return { ...super.toJson(deep), options: this.options };\r\n    }\r\n}\r\n\r\n\r\nexport type AnyField = Field | OptConnectField | NumberField | TextField | DummyField | ConnectableField;\r\nexport type AnyFieldCls = typeof Field | typeof OptConnectField | typeof ConnectableField | typeof NumberField | typeof TextField | typeof DummyField;\r\nexport const FieldMap: {\r\n    field_both: typeof OptConnectField;\r\n    field_string: typeof TextField;\r\n    field_num: typeof NumberField;\r\n    field_dummy: typeof DummyField;\r\n    field_str: typeof TextField;\r\n    connection: typeof ConnectableField;\r\n    [key: string]: AnyFieldCls;\r\n} = {\r\n    'field_both': OptConnectField,\r\n    'field_string': TextField,\r\n    'field_num': NumberField,\r\n    'field_dummy': DummyField,\r\n    'field_str': TextField,\r\n    'connection': ConnectableField,\r\n    'dropdown': DropdownField\r\n}\r\n\r\n\r\nexport default Field;\r\n","import type RendererType from \"../renderers/renderer\";\r\n\r\ninterface RendererMapInterface {\r\n\t[key: string]: typeof RendererType;\r\n}\r\n\r\n// top-level map is fine\r\nconst RendererMap: RendererMapInterface = {};\r\n\r\n// merged RMap class\r\nclass RMap {\r\n\t// register a renderer\r\n\tstatic register(RendererCls: typeof RendererType, optName?: string) {\r\n\t\tconst name = optName ?? RendererCls.NAME;\r\n\t\tRendererMap[name] = RendererCls;\r\n\t}\r\n\r\n\t// delete a renderer by name\r\n\tstatic delete(name: string) {\r\n\t\tif (name === 'default') return false;\r\n\t\tif (RendererMap[name]) {\r\n\t\t\tdelete RendererMap[name];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// get a renderer by name\r\n\tstatic get(name: string): typeof RendererType {\r\n\t\tconst Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n\t\treturn RendererMap[name] ?? RendererMap['default'] ?? Renderer;\r\n\t}\r\n\r\n\t// list all registered renderers\r\n\tstatic list() {\r\n\t\treturn Object.keys(RendererMap);\r\n\t}\r\n\r\n\t// resolve any input into a renderer class\r\n\tstatic resolve(input?: string | typeof RendererType): typeof RendererType {\r\n\t\tconst Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n\r\n\t\tif (!input) return RendererMap['default'] ?? Renderer;\r\n\r\n\t\tif (typeof input === 'string') return RMap.get(input);\r\n\r\n\t\tif (typeof input === 'function') return input as typeof RendererType;\r\n\r\n\t\treturn RendererMap['default'] ?? Renderer;\r\n\t}\r\n}\r\n\r\n// pre-register default renderers if needed\r\nconst DefaultRenderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\nRendererMap['atlas'] = DefaultRenderer;\r\nRendererMap['default'] = DefaultRenderer;\r\n\r\nexport { RMap, RendererMap };\r\n","import { Element, G } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer, { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\n\r\nfunction initXButton(element: Element, args: Record<string, any>): () => void {\r\n\tconst xBtnGroup = element as G;\r\n\tconst ws: WorkspaceSvg = args.workspace;\r\n\r\n\t// click handler\r\n\tconst onClick = () => {\r\n\t\tws.removeNode(args.node);\r\n\t};\r\n\r\n\t// attach\r\n\txBtnGroup.on('click', onClick);\r\n\r\n\t// return cleanup function\r\n\treturn () => {\r\n\t\txBtnGroup.off('click', onClick);\r\n\t};\r\n}\r\n\r\n// register as Kabel event\r\neventer.registerEvent('k_closenode', initXButton as EventSetupFn);\r\n","import { Color, ColorStyle } from \"./visual-types\"\r\n\r\n\r\nconst CategoryColors: {\r\n    [key: string]: ColorStyle\r\n} = {};\r\n\r\nexport default CategoryColors;","'use strict';\n\n// combine 2 matrixes\n// m1, m2 - [a, b, c, d, e, g]\n//\nfunction combine(m1, m2) {\n  return [\n    m1[0] * m2[0] + m1[2] * m2[1],\n    m1[1] * m2[0] + m1[3] * m2[1],\n    m1[0] * m2[2] + m1[2] * m2[3],\n    m1[1] * m2[2] + m1[3] * m2[3],\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\n  ];\n}\n\n\nfunction Matrix() {\n  if (!(this instanceof Matrix)) { return new Matrix(); }\n  this.queue = [];   // list of matrixes to apply\n  this.cache = null; // combined matrix cache\n}\n\n\nMatrix.prototype.matrix = function (m) {\n  if (m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0) {\n    return this;\n  }\n  this.cache = null;\n  this.queue.push(m);\n  return this;\n};\n\n\nMatrix.prototype.translate = function (tx, ty) {\n  if (tx !== 0 || ty !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, 0, 1, tx, ty ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.scale = function (sx, sy) {\n  if (sx !== 1 || sy !== 1) {\n    this.cache = null;\n    this.queue.push([ sx, 0, 0, sy, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.rotate = function (angle, rx, ry) {\n  var rad, cos, sin;\n\n  if (angle !== 0) {\n    this.translate(rx, ry);\n\n    rad = angle * Math.PI / 180;\n    cos = Math.cos(rad);\n    sin = Math.sin(rad);\n\n    this.queue.push([ cos, sin, -sin, cos, 0, 0 ]);\n    this.cache = null;\n\n    this.translate(-rx, -ry);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewX = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, Math.tan(angle * Math.PI / 180), 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewY = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, Math.tan(angle * Math.PI / 180), 0, 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\n// Flatten queue\n//\nMatrix.prototype.toArray = function () {\n  if (this.cache) {\n    return this.cache;\n  }\n\n  if (!this.queue.length) {\n    this.cache = [ 1, 0, 0, 1, 0, 0 ];\n    return this.cache;\n  }\n\n  this.cache = this.queue[0];\n\n  if (this.queue.length === 1) {\n    return this.cache;\n  }\n\n  for (var i = 1; i < this.queue.length; i++) {\n    this.cache = combine(this.cache, this.queue[i]);\n  }\n\n  return this.cache;\n};\n\n\n// Apply list of matrixes to (x,y) point.\n// If `isRelative` set, `translate` component of matrix will be skipped\n//\nMatrix.prototype.calc = function (x, y, isRelative) {\n  var m;\n\n  // Don't change point on empty transforms queue\n  if (!this.queue.length) { return [ x, y ]; }\n\n  // Calculate final matrix, if not exists\n  //\n  // NB. if you deside to apply transforms to point one-by-one,\n  // they should be taken in reverse order\n\n  if (!this.cache) {\n    this.cache = this.toArray();\n  }\n\n  m = this.cache;\n\n  // Apply matrix to point\n  return [\n    x * m[0] + y * m[2] + (isRelative ? 0 : m[4]),\n    x * m[1] + y * m[3] + (isRelative ? 0 : m[5])\n  ];\n};\n\n\nmodule.exports = Matrix;\n","import WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WorkspaceController {\r\n\tworkspace: WorkspaceSvg;\r\n\r\n\tkeysDown: Set<string>;\r\n\tmouseBtns: Set<number>;\r\n\tmousePos: Vec2;\r\n\tlastMousePos: Vec2;\r\n\tisDragging: boolean;\r\n\r\n\twheelDelta: number;\r\n\r\n\tprivate _updateInt: any;\r\n\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\r\n\t\tthis.keysDown = new Set();\r\n\t\tthis.mouseBtns = new Set();\r\n\t\tthis.mousePos = { x: 0, y: 0 };\r\n\t\tthis.lastMousePos = { x: 0, y: 0 };\r\n\t\tthis.isDragging = false;\r\n        this.wheelDelta = 0;\r\n\r\n\t\tthis._setupListeners();\r\n\r\n\t\tthis._updateInt = setInterval(() => this.update(), 16);\r\n\t}\r\n    canMove() {\r\n        return true;\r\n    }\r\n\tprivate _setupListeners() {\r\n\t\twindow.addEventListener('keydown', e => this.keysDown.add(e.key));\r\n\t\twindow.addEventListener('keyup', e => this.keysDown.delete(e.key));\r\n\r\n\t\twindow.addEventListener('mousedown', e => this.mouseBtns.add(e.button));\r\n\t\twindow.addEventListener('mouseup', e => this.mouseBtns.delete(e.button));\r\n\r\n\t\twindow.addEventListener('mousemove', e => {\r\n\t\t\tthis.lastMousePos = { ...this.mousePos };\r\n\t\t\tthis.mousePos = { x: e.clientX, y: e.clientY };\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('wheel', e => {\r\n\t\t\tthis.wheelDelta = e.deltaY;\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('mousedown', e => {\r\n\t\t\tif (e.button === 0) this.isDragging = true;\r\n\t\t});\r\n\t\twindow.addEventListener('mouseup', e => {\r\n\t\t\tif (e.button === 0) this.isDragging = false;\r\n\t\t});\r\n\t}\r\n\r\n\tupdate() {\r\n\t\t// Can handle keyboard shortcuts or auto-pan here\r\n\t}\r\n\r\n\t// --- Camera methods ---\r\n\tpan(dx: number, dy: number) {\r\n\t\tthis.workspace._camera.x += dx;\r\n\t\tthis.workspace._camera.y += dy;\r\n\t\tthis.refreshPos();\r\n\t}\r\n\r\n\tsetCamera(pos: Vec2) {\r\n\t\tthis.workspace._camera.x = pos.x;\r\n\t\tthis.workspace._camera.y = pos.y;\r\n\t\tthis.refreshPos();\r\n\t}\r\n\r\n\tcenterOn(pos: Vec2) {\r\n\t\tconst wsSize = this.workspace.getSize?.() ?? { width: 0, height: 0 };\r\n\t\tthis.setCamera({\r\n\t\t\tx: pos.x - wsSize.width / 2,\r\n\t\t\ty: pos.y - wsSize.height / 2\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\t// --- Coordinate conversion ---\r\n\tscreenToWorkspace(x: number, y: number): Vec2 {\r\n\t\tconst cam = this.workspace._camera;\r\n\t\treturn {\r\n\t\t\tx: x + cam.x,\r\n\t\t\ty: y + cam.y\r\n\t\t};\r\n\t}\r\n\r\n\tworkspaceToScreen(x: number, y: number): Vec2 {\r\n\t\tconst cam = this.workspace._camera;\r\n\t\treturn {\r\n\t\t\tx: (x - cam.x),\r\n\t\t\ty: (y - cam.y)\r\n\t\t};\r\n\t}\r\n\r\n\t// --- Refresh ---\r\n\trefreshPos() {\r\n\t\tthis.workspace.refresh?.();\r\n\t}\r\n\r\n\tredraw() {\r\n\t\tthis.workspace.redraw?.();\r\n\t}\r\n\r\n\t// --- Cleanup ---\r\n\tstop() {\r\n\t\tclearInterval(this._updateInt);\r\n\t}\r\n}\r\n","class Styler {\r\n\tprivate styles: Map<string, HTMLStyleElement>;\r\n\r\n\tconstructor() {\r\n\t\tthis.styles = new Map();\r\n\t}\r\n\r\n\tappendStyles(id: string, css: string): void {\r\n\t\tif (this.styles.has(id)) return; // Do not append if id exists\r\n\r\n\t\tconst styleEl = document.createElement('style');\r\n\t\tstyleEl.id = id;\r\n\t\tstyleEl.textContent = css;\r\n\t\tdocument.head.appendChild(styleEl);\r\n\t\tthis.styles.set(id, styleEl);\r\n\t}\r\n\r\n\tremoveStyles(id: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.remove();\r\n\t\tthis.styles.delete(id);\r\n\t}\r\n\r\n\tupdateStyles(id: string, css: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.textContent = css;\r\n\t}\r\n\r\n\thasStyles(id: string): boolean {\r\n\t\treturn this.styles.has(id);\r\n\t}\r\n}\r\nexport {\r\n    Styler\r\n}\r\nconst styler = new Styler();\r\nexport default styler;","import WorkspaceController from \"../controllers/base\";\r\nimport Renderer from \"../renderers/renderer\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport NodePrototypes from \"./prototypes\"; // Object\r\nimport { FieldOptions } from \"./field\";\r\nimport { Color } from \"./visual-types\";\r\nimport styler from '../util/styler';\r\n// @ts-ignore\r\nimport _kabelStyles from './styles.css'\r\nconst kabelStyles : string = _kabelStyles;\r\n\r\nexport interface TblxFieldStruct {\r\n\tvalue: any;\r\n\t[key: string]: any;\r\n}\r\n\r\nexport interface TblxNodeStruct {\r\n\ttype: keyof typeof NodePrototypes | string;\r\n\targuments: {\r\n\t\t[key: string]: TblxFieldStruct;\r\n\t};\r\n}\r\n\r\nexport interface TblxCategoryStruct {\r\n\tname: string;\r\n\tcolor: Color;\r\n\tcontents: TblxNodeStruct[];\r\n}\r\n\r\n// Discriminated union for TlbxObjStruct\r\nexport type TblxObjStruct =\r\n\t| {\r\n\t\ttype: 'flyout';\r\n\t\tcontents: TblxNodeStruct[];\r\n\t}\r\n\t| {\r\n\t\ttype?: 'category';\r\n\t\tcontents: TblxCategoryStruct[];\r\n\t}\r\n\t| {\r\n\t\ttype?: undefined; // when type is not provided\r\n\t\tcontents: TblxCategoryStruct[];\r\n\t};\r\n\r\n\r\nexport interface InjectOptions {\r\n    rendererOverrides?: {[key: string] : any};\r\n    Controller?: typeof WorkspaceController;\r\n    controls?: {\r\n        wasd?: boolean;\r\n        wasdSmooth?: boolean;\r\n        wasdAccelerate?: number;\r\n        wasdFriction?: number;\r\n    }\r\n    toolbox?: TblxObjStruct;\r\n    moveSpeed?: number;\r\n    renderer?: string|typeof Renderer;\r\n}\r\nexport class InjectMsg {\r\n    msg: string;\r\n    constructor(msg: string) {\r\n        this.msg = msg;\r\n    }\r\n    err() {\r\n        console.error(`Failed to inject workspace: ${this.msg}`)\r\n    }\r\n    wrn() {\r\n        console.warn(`Inject warning: ${this.msg}`)\r\n    }\r\n    info() {\r\n        console.info(`Inject info: ${this.msg}`)\r\n    }\r\n}\r\nexport default function inject(element: HTMLElement | string, options: InjectOptions = {}) : undefined | WorkspaceSvg{\r\n    styler.appendStyles('KabelStyles', kabelStyles);\r\n    const root = typeof element == 'string' ? document.querySelector(`#${element}`) as HTMLElement : element as HTMLElement;\r\n    if ((!root) && typeof element == 'string') {\r\n        (new InjectMsg(`Document does not contain root element (Check element ID).`)).err();\r\n        return;\r\n    }\r\n    if (!document.contains(root)) {\r\n        (new InjectMsg(`Document does not contain root element.`)).err();\r\n        return;\r\n    }\r\n    const wsTop = document.createElement('div');\r\n    wsTop.className = `KabelWorkspaceWrapper`;\r\n    root.appendChild(wsTop);\r\n    const ws = new WorkspaceSvg(root, wsTop, options);\r\n    setMainWorkspace(ws); // Set the main workspace to the newest created.\r\n\r\n    return ws;\r\n}","import { NodePrototype } from \"./node-types\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\n\r\n\r\nfunction newHeadlessNode(type: string) {\r\n    const proto : NodePrototype = NodePrototypes[type as string] as NodePrototype;\r\n    if (!proto) return;\r\n    const node = new NodeSvg(proto);\r\n    node.init();\r\n    return node;\r\n}\r\n\r\nexport default newHeadlessNode;","import Connection from \"./connection\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { ColorStyle, Color } from './visual-types';\r\nimport hasProp from '../util/has-prop';\r\nimport Field, { AnyField, AnyFieldCls, DummyField, FieldMap, FieldOptions } from \"./field\";\r\nimport CategoryColors from \"./colors\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport EventEmitter from '../util/emitter';\r\nimport { G } from \"@svgdotjs/svg.js\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport CommentModel from \"./comment\";\r\n/** Represents a JSON structure to initialize a field on a node */\r\nexport interface InputFieldJson {\r\n    label: string;\r\n    type: string;\r\n    name: string;\r\n    [key: string]: any; // Extra field initialization properties\r\n}\r\n\r\n/** Represents a JSON structure to initialize a NodeSvg */\r\nexport interface NodeJson {\r\n    primaryColor?: Color;\r\n    secondaryColor?: Color;\r\n    tertiaryColor?: Color;\r\n    previousConnection?: any | undefined; // Presence triggers creation of a previous connection\r\n    nextConnection?: any | undefined;     // Presence triggers creation of a next connection\r\n    labelText?: string | undefined;\r\n    arguments?: InputFieldJson[];\r\n    category?: string | undefined;        // Optional node category for color theming\r\n    type: string;\r\n}\r\nexport interface SerializedNode {\r\n    type: string;\r\n    id: string;\r\n    relativeCoords: { x: number, y: number };\r\n    comment?: string | undefined;\r\n    fields?: any[],\r\n    previousConnection: {\r\n        field?: FieldOptions;\r\n        node?: SerializedNode;\r\n    } | undefined;\r\n    nextConnection: {\r\n        field?: FieldOptions;\r\n        node?: SerializedNode;\r\n    } | undefined;\r\n}\r\nexport type NodeStyle = ColorStyle & {\r\n    [key in keyof RendererConstants]?: RendererConstants[key];\r\n} & {\r\n    [key: string]: any;\r\n};\r\n\r\n\r\nexport interface NodeEvents {\r\n    \"REMOVING\": null;\r\n    \"INITING\": null;\r\n    \"NODE_DRAG\": null;\r\n}\r\nclass NodeSvg extends EventEmitter<NodeEvents> {\r\n    previousConnection: Connection | null;\r\n    nextConnection: Connection | null;\r\n    type: string | null;\r\n    prototype: NodePrototype | null;\r\n    colors: NodeStyle;      // Node's color scheme\r\n    labelText: string;       // Displayed node label\r\n    _fieldColumn: Set<AnyField>; // Stores attached fields\r\n    relativeCoords: Coordinates;\r\n    id: string;\r\n    svgGroup: G | null = null;\r\n    workspace: WorkspaceSvg | null = null;\r\n    comment: CommentModel | null\r\n    static REMOVING: keyof NodeEvents = \"REMOVING\";\r\n    static INITING: keyof NodeEvents = \"INITING\";\r\n    constructor(prototype: NodePrototype | null, workspace?: WorkspaceSvg, svgGroup?: G) {\r\n        super();\r\n        this.type = null;\r\n        this.comment = null;\r\n        this.prototype = prototype;\r\n        this.colors = {\r\n            primary: '#000000',   // Topbar & connection color\r\n            secondary: '#000000', // Field & dropdown backgrounds\r\n            tertiary: '#000000', // Outline color\r\n            category: ''          // Node category name (optional)\r\n        };\r\n        this.previousConnection = new Connection(null, this, true); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.nextConnection = new Connection(this, null, false); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.labelText = '';\r\n        this._fieldColumn = new Set();\r\n        this.relativeCoords = new Coordinates(0, 0);\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        if (workspace) {\r\n            this.workspace = workspace;\r\n            this.workspace.addNode(this,)\r\n        }\r\n        if (svgGroup) {\r\n            this.svgGroup = svgGroup;\r\n        }\r\n    }\r\n    getCommentText() {\r\n        return this.comment?.getText?.();\r\n    }\r\n    getComment() {\r\n        return this.comment;\r\n    }\r\n    addComment() {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n            return;\r\n        }\r\n        console.warn('Comment already exists.')\r\n    }\r\n    setCommentText(text: string) {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n        }\r\n        this.comment.setText(text);\r\n    }\r\n    removeComment() {\r\n        this.comment = null;\r\n        this.workspace?.redrawComments?.();\r\n    }\r\n    allFields() {\r\n        return Array.from(this._fieldColumn);\r\n    }\r\n    /** Get field by name */\r\n    getFieldByName(name: string): AnyField | null | undefined {\r\n        let field: AnyField | null | undefined = this.allFields().find(fld => fld.getName() === name);\r\n\r\n        return field;\r\n    }\r\n    getField(name: string): AnyField | null | undefined {\r\n        return this.getFieldByName(name);\r\n    }\r\n    getFieldValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    getFieldDisplayValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getDisplayValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Initiates the node, calling prototype methods.\r\n     */\r\n    init() {\r\n        this.emit(NodeSvg.INITING, null);\r\n        if (this.prototype) {\r\n            if (this.prototype.init) this.prototype.init.call(this, this.prototype, this);\r\n            if (this.prototype.removed) {\r\n                this.on(NodeSvg.REMOVING, () => {\r\n                    this.prototype?.removed.call(this, this.prototype, this);\r\n                })\r\n            }\r\n        } else {\r\n            console.warn(`Node with id ${this.id} is missing a prototype.`)\r\n        }\r\n    }\r\n    /** Returns whether this node has a category style applied */\r\n    hasCategoryStyle() {\r\n        return !!this.colors?.category && this.colors?.category?.length > 0;\r\n    }\r\n\r\n    /** Returns the category name or null if none */\r\n    getCategoryName() {\r\n        return this.colors?.category || null;\r\n    }\r\n\r\n    /** Returns the node's current ColorStyle */\r\n    getStyle() {\r\n        return this.colors;\r\n    }\r\n\r\n    /** Internal helper: attach a field to this node */\r\n    _appendFieldItem(field: AnyField) {\r\n        if (!field) console.warn(\"Falsey field passed to _appendFieldItem.\");\r\n        this._fieldColumn.add(field);\r\n    }\r\n\r\n    /** Initialize node from a NodeJson object */\r\n    jsonInit(json: NodeJson) {\r\n        if (json.primaryColor) this.colors.primary = json.primaryColor;\r\n        if (json.secondaryColor) this.colors.secondary = json.secondaryColor;\r\n        if (json.tertiaryColor) this.colors.tertiary = json.tertiaryColor;\r\n\r\n        // Apply category colors if defined\r\n        if (json.category && CategoryColors[json.category]) {\r\n            const style: ColorStyle = CategoryColors[json.category] as ColorStyle;\r\n            Object.assign(this.colors, { category: json.category }, style);\r\n        }\r\n\r\n        this.previousConnection = hasProp(json, 'previousConnection') ? new Connection(null, this, true) : null;\r\n        this.nextConnection = hasProp(json, 'nextConnection') ? new Connection(this, null, false) : null;\r\n\r\n        if (json.labelText) this.labelText = json.labelText;\r\n        if (json.arguments) this.applyJsonArguments(json.arguments);\r\n        if (json.type) {\r\n            this.type = json.type;\r\n        }\r\n    }\r\n\r\n    /* JAVASCRIPT API */\r\n\r\n    /** Apply field definitions from a JSON-like array without full NodeJson */\r\n    applyJsonArguments(args: InputFieldJson[]) {\r\n        for (let field of args) {\r\n            if (!field.type || !field.name) {\r\n                console.warn(`Invalid argument definition at: ${args.indexOf(field)}.`);\r\n                continue;\r\n            }\r\n\r\n            const FieldConstructor: AnyFieldCls | undefined = FieldMap[field.type] as AnyFieldCls | undefined;\r\n            if (!FieldConstructor) {\r\n                console.warn(`Missing field constructor for ${field.type}!`);\r\n                continue;\r\n            }\r\n\r\n            const fld: AnyField = new FieldConstructor();\r\n            fld.fromJson(field); // initialize field\r\n            fld.node = this;\r\n            this._appendFieldItem(fld);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    appendConnection(name: string): Field {\r\n        const fld = new (FieldMap['connection'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    appendNumber(name: string): Field {\r\n        const fld = new (FieldMap['field_num'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    appendText(name: string): Field {\r\n        const fld = new (FieldMap['field_str'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    /** Field that can hold a connection or raw value */\r\n    appendOptLink(name: string): Field {\r\n        const fld = new (FieldMap['field_both'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    setCategoryName(name: string) {\r\n        this.colors.category = name;\r\n        return this;\r\n    }\r\n\r\n    setStyle(style: ColorStyle) {\r\n        Object.assign(this.colors, {}, style);\r\n        return this;\r\n    }\r\n\r\n    setColor(primary: Color, secondary: Color, tertiary: Color) {\r\n        this.setStyle({ primary, secondary, tertiary });\r\n        return this;\r\n    }\r\n\r\n    setLabelText(text: string) {\r\n        this.labelText = text;\r\n        return this;\r\n    }\r\n\r\n    /** Add or replace a previous/next connection based on argument */\r\n    setConnection(prevOrNext: string | number | boolean) {\r\n        const stringed = String(prevOrNext).toLowerCase();\r\n        const cast = stringed == '0' ? 0 : (stringed == '1' ? 1 : (stringed == 'true' ? 1 : (stringed == 'false' ? 0 : 3)));\r\n\r\n        if (cast === 0) {\r\n            this.previousConnection = new Connection(null, this, true);\r\n        } else if (cast === 1) {\r\n            this.nextConnection = new Connection(this, null, false);\r\n        } else {\r\n            console.warn('Invalid prevOrNext argument for NodeSvg.setConnection');\r\n        }\r\n        return this;\r\n    }\r\n    /** Copies another NodeSvg into this node */\r\n    fromNode(other: NodeSvg) {\r\n        if (!other) return;\r\n\r\n        // Copy primitive props\r\n        this.type = other.type;\r\n        this.labelText = other.labelText;\r\n        this.relativeCoords = new Coordinates(other.relativeCoords.x, other.relativeCoords.y);\r\n\r\n        // Copy colors\r\n        this.colors = { ...other.colors };\r\n\r\n        // Copy connections\r\n        this.previousConnection = other.previousConnection\r\n            ? new Connection(null, this, true)\r\n            : null;\r\n        this.nextConnection = other.nextConnection\r\n            ? new Connection(this, null, false)\r\n            : null;\r\n\r\n        // Copy fields\r\n        this._fieldColumn.clear();\r\n        for (let field of other._fieldColumn) {\r\n            const FieldCls = field.constructor as AnyFieldCls;\r\n            const newField = (new FieldCls()) as any;\r\n\r\n            // Copy basic properties\r\n            newField.setName(field.getName());\r\n            if ('getValue' in field && 'setValue' in newField) {\r\n                newField.setValue(field.getValue());\r\n            }\r\n            if ('getLabel' in field && 'setLabel' in newField) {\r\n                newField.setLabel(field.getLabel())\r\n            }\r\n            this._appendFieldItem(newField);\r\n        }\r\n\r\n        // Copy workspace reference\r\n        this.workspace = other.workspace;\r\n\r\n        // Copy prototype reference\r\n        this.prototype = other.prototype;\r\n\r\n\r\n        return this;\r\n    }\r\n    _serializeConnection(\r\n        c: Connection,\r\n        alreadyProcessed: { [key: string]: SerializedNode }\r\n    ): {\r\n        field?: FieldOptions;\r\n        node?: SerializedNode;\r\n    } {\r\n        let connected = c.getTo();\r\n        if (c.isPrevious) {\r\n            connected = c.getFrom();\r\n        }\r\n        if (!connected) {\r\n            return {};\r\n        }\r\n\r\n        const returned: {\r\n            field?: FieldOptions;\r\n            node?: SerializedNode;\r\n        } = {};\r\n\r\n        if (connected instanceof NodeSvg) {\r\n            //  avoid recomputation if already serialized\r\n            if (alreadyProcessed[connected.id]) {\r\n                return { node: alreadyProcessed[connected.id] } as {\r\n                    field?: FieldOptions;\r\n                    node?: SerializedNode;\r\n                };\r\n            }\r\n            returned.node = connected.serialize(alreadyProcessed);\r\n        } else {\r\n            // It's a field\r\n            const fld = connected as unknown as AnyField;\r\n            returned.field = fld.toJson(false);\r\n            if (fld.node) {\r\n                if (alreadyProcessed[fld.node.id]) {\r\n                    returned.node = alreadyProcessed[fld.node.id] as SerializedNode;\r\n                } else {\r\n                    returned.node = fld.node.serialize(alreadyProcessed);\r\n                }\r\n            }\r\n        }\r\n        return returned;\r\n    }\r\n\r\n    serialize(alreadyProcessed: { [key: string]: SerializedNode } = {}): SerializedNode {\r\n        if (alreadyProcessed[this.id]) {\r\n            return alreadyProcessed[this.id] as SerializedNode;\r\n        }\r\n\r\n        // Put a placeholder in map *before* serializing connections\r\n        const serialized: SerializedNode = {\r\n            id: this.id,\r\n            type: this.type || '',\r\n            previousConnection: undefined,\r\n            nextConnection: undefined,\r\n            relativeCoords: { x: this.relativeCoords.x, y: this.relativeCoords.y },\r\n            comment: this.comment?.getText?.(),\r\n            fields: [], // fill after placeholder\r\n        };\r\n        alreadyProcessed[this.id] = serialized;\r\n\r\n        // Now safely fill in the heavy parts\r\n        serialized.fields = this.allFields().map(fld =>\r\n            fld.toJson\r\n                ? fld.toJson(true)\r\n                : {\r\n                    name: fld.getName(),\r\n                    type: fld.constructor.name,\r\n                    value: fld.getValue ? fld.getValue() : undefined,\r\n                }\r\n        );\r\n\r\n        serialized.previousConnection = this.previousConnection\r\n            ? this._serializeConnection(this.previousConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        serialized.nextConnection = this.nextConnection\r\n            ? this._serializeConnection(this.nextConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        return serialized;\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport default NodeSvg;\r\n","import CommentModel from \"./comment\";\r\nimport { ContextMenuOpts, Showable } from \"./context-menu\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\n\r\nconst ContextOptsRegistry: ContextMenuOpts[] = [];\r\n\r\nconst ContextMenu = {\r\n    registerOption(id: string, option: {\r\n        click: (target: NodeSvg | WorkspaceSvg | HTMLElement | CommentModel) => void;\r\n        onHoverStart?: () => void;\r\n        onHoverEnd?: () => void;\r\n        label: string;\r\n        showFor: Showable | Showable[];\r\n    }) {\r\n        const opt = {\r\n            id,\r\n            click: option.click,\r\n            label: option.label,\r\n            onHoverStart: option.onHoverStart || (() => { }),\r\n            onHoverEnd: option.onHoverEnd || (() => { }),\r\n            showFor: option.showFor || undefined\r\n        };\r\n        ContextOptsRegistry.push(opt);\r\n    },\r\n\r\n    unregisterOption(id: string) {\r\n        const index = ContextOptsRegistry.findIndex(opt => opt.id === id);\r\n        if (index >= 0) ContextOptsRegistry.splice(index, 1);\r\n    }\r\n};\r\n\r\nContextMenu.registerOption('k_delete', {\r\n    showFor: 'node',\r\n    label: 'Delete', // required\r\n    click: (t) => {\r\n        const target = t as NodeSvg;\r\n        if (!target.workspace) return;\r\n        target.workspace.removeNode(target);\r\n    }\r\n});\r\nContextMenu.registerOption('k_deleteall', {\r\n    showFor: 'ws',\r\n    label: 'Delete all', // required\r\n    click: (t) => {\r\n        const target = t as WorkspaceSvg;\r\n        const isSure = window.confirm(`Are you sure you want to delete ${Array.from(target._nodeDB.keys()).length} nodes?`);\r\n        if (!isSure) return;\r\n        for (let [id, _] of target._nodeDB) {\r\n            target.removeNodeById(id);\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_addcomment', {\r\n    showFor: ['ws', 'node'],\r\n    label: 'Add Comment',\r\n    click: (t) => {\r\n        const target = t;\r\n        if (target instanceof NodeSvg) {\r\n            target.addComment();\r\n            target.setCommentText('Comment!');\r\n        } else if (target instanceof WorkspaceSvg) {\r\n            const model = target.addComment();\r\n            const pos = target.screenToWorkspace(target._ctxMenu.widget.coords.x, target._ctxMenu.widget.coords.y);\r\n            model.relativeCoords.set(pos.x, pos.y);\r\n            model.setText('Comment!');\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_deletecomment', {\r\n    showFor: 'comment',\r\n    label: 'Delete Comment',\r\n    click: (t) => {\r\n        const target = t as CommentModel;\r\n        if (target.isNodeComment() && target._parent instanceof NodeSvg) {\r\n            target._parent.removeComment();\r\n        } else {\r\n            target.getWorkspace().removeComment(target);\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_duplicate', {\r\n    showFor: 'node',\r\n    label: 'Duplicate',\r\n    click: t => {\r\n        const node = t as NodeSvg;\r\n        if (!node.workspace) return;\r\n        node.workspace.cloneNode(node);\r\n    }\r\n});\r\n\r\n\r\nexport { ContextMenu }\r\nexport default ContextOptsRegistry;","type EventHandler<T = any> = (payload: T) => void;\r\n\r\nclass EventEmitter<Events extends Record<string, any>> {\r\n\tprivate listeners: { [K in keyof Events]?: EventHandler<Events[K]>[] } = {};\r\n\r\n\ton<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) this.listeners[event] = [];\r\n\t\tthis.listeners[event]!.push(handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) return this;\r\n\t\tthis.listeners[event] = this.listeners[event]!.filter(h => h !== handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\temit<K extends keyof Events>(event: K, payload: Events[K]) {\r\n\t\tif (!this.listeners[event]) return false;\r\n\t\tthis.listeners[event]!.forEach(handler => handler(payload));\r\n\t\treturn true;\r\n\t}\r\n\r\n\tonce<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tconst wrapper = (payload: Events[K]) => {\r\n\t\t\thandler(payload);\r\n\t\t\tthis.off(event, wrapper);\r\n\t\t};\r\n\t\tthis.on(event, wrapper);\r\n\t\treturn this;\r\n\t}\r\n}\r\nexport default EventEmitter;","import Flyout from \"./flyout\";\r\nimport { InjectOptions, TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport Category from \"./category\";\r\n\r\nclass Toolbox {\r\n\ttype: 1 | 2;\r\n\tworkspace: WorkspaceSvg;\r\n\twsOptions: InjectOptions;\r\n\t_flyout: Flyout;\r\n\t_contents: TblxNodeStruct[] | TblxCategoryStruct[];\r\n\tcontainer: HTMLDivElement;\r\n\t_categories: Category[] = [];\r\n\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\t\tthis.wsOptions = this.getOptions();\r\n\t\tthis.type = this.wsOptions.toolbox?.type == \"flyout\" ? 2 : 1;\r\n\t\tthis._contents = this.wsOptions.toolbox?.contents ?? [];\r\n\r\n\t\t// pass toolbox reference to flyout\r\n\t\tthis._flyout = new Flyout(this);\r\n\r\n\t\tthis.container = document.createElement(\"div\");\r\n\t\tthis.container.className = \"KabelToolbox\";\r\n\t\tthis.container.style.position = \"absolute\";\r\n\t\tthis.container.style.left = \"0\";\r\n\t\tthis.container.style.top = \"0\";\r\n\t\tthis.container.style.width = \"20%\";\r\n\t\tthis.container.style.height = \"100%\";\r\n\t\tthis.container.style.background = \"rgba(240,240,240,0.9)\";\r\n\t\tthis.container.style.overflowY = \"auto\";\r\n\t\tworkspace._wsTop.appendChild(this.container);\r\n\r\n\t\tif (this.type === 1) this.initCategoryToolbox();\r\n\t\tif (this.type === 2) this.initFlyoutToolbox();\r\n\t}\r\n\r\n\tgetOptions() {\r\n\t\treturn this.workspace.options;\r\n\t}\r\n\r\n\tinitCategoryToolbox() {\r\n\t\tconst categories = this._contents as TblxCategoryStruct[];\r\n\t\tcategories.forEach(cData => {\r\n\t\t\tconst category = new Category(this, cData);\r\n\t\t\tthis._categories.push(category);\r\n\t\t});\r\n\r\n\t\t// clicking workspace hides flyout\r\n\t\tthis.workspace.svg.on(\"click\", () => this._flyout.hide());\r\n\t}\r\n\r\n\tinitFlyoutToolbox() {\r\n\t\tthis.container.style.display = \"none\";\r\n\t\tconst nodes = this._contents as TblxNodeStruct[];\r\n\t\tthis._flyout.fill(nodes);\r\n\t}\r\n}\r\n\r\nexport default Toolbox;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\n\r\n\r\n\r\nlet mainws : WorkspaceSvg | null = null;\r\n\r\nfunction getMainWorkspace(): WorkspaceSvg|null {\r\n    return mainws;\r\n}\r\nfunction setMainWorkspace(ws: WorkspaceSvg | null) {\r\n    return mainws = ws;\r\n}\r\nfunction clearMainWorkspace() {\r\n    return mainws = null;\r\n}\r\n\r\nexport {\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    clearMainWorkspace\r\n}","import { Element } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\nconst draggableStore: Record<string, { x: number, y: number }> = {};\r\n\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    let isDragging = false;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    // fallback to element itself if no drag handle is given\r\n    const dragTarget: Element = args.dragel ?? element;\r\n\r\n    // Restore position if previously stored (type 3)\r\n    if (args.type === 3 && args.id && draggableStore[args.id]) {\r\n        const pos = draggableStore[args.id];\r\n        if (pos) element.move(pos.x, pos.y);\r\n    }\r\n\r\n    function onMouseDown(e: MouseEvent) {\r\n        if (args.type === 2 && args.node) {\r\n            const ws = args.node.workspace;\r\n            if (!ws) return;\r\n\r\n            const start = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const nodePos = args.node.relativeCoords;\r\n\r\n            offsetX = start.x - nodePos.x;\r\n            offsetY = start.y - nodePos.y;\r\n        } else {\r\n            const bbox = element.bbox();\r\n            offsetX = e.clientX - bbox.x;\r\n            offsetY = e.clientY - bbox.y;\r\n        }\r\n\r\n        isDragging = false;\r\n\r\n        // Mark user as dragging\r\n        userState.setState('dragging');\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        if (args.type === 1 && args.ondrag) args.ondrag(e);\r\n    }\r\n\r\n\r\n    function onMouseMove(e: MouseEvent) {\r\n        if (!isDragging) {\r\n            const dx = e.movementX || 0;\r\n            const dy = e.movementY || 0;\r\n            if (Math.abs(dx) > 2 || Math.abs(dy) > 2) isDragging = true;\r\n        }\r\n        if (!isDragging) return;\r\n\r\n        if (args.type === 2 && args.node && args.node instanceof NodeSvg) {\r\n            const ws: WorkspaceSvg = args.node.workspace as WorkspaceSvg;\r\n            if (!ws) return;\r\n\r\n            // Compute new workspace coordinates\r\n            const mouseWS = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const newX = mouseWS.x - offsetX;\r\n            const newY = mouseWS.y - offsetY;\r\n\r\n            args.node.relativeCoords.set(newX, newY);\r\n            ws.refresh();\r\n            // Move node visually\r\n            const screenPos = ws.workspaceToScreen(newX, newY);\r\n            element.attr({ transform: `translate(${screenPos.x}, ${screenPos.y})` });\r\n\r\n            args.node.emit('NODE_DRAG', null);\r\n        } else if (args.type === 1 && args.onmove) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            args.onmove({ x: newX, y: newY });\r\n        } else if (args.type === 3 && args.id) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            draggableStore[args.id] = { x: newX, y: newY };\r\n        }\r\n    }\r\n\r\n    function onMouseUp(e: MouseEvent) {\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n\r\n        // Remove dragging state\r\n        userState.removeState('dragging');\r\n\r\n        if (args.type === 1 && args.enddrag) args.enddrag(e);\r\n        isDragging = false;\r\n    }\r\n\r\n    dragTarget.node.addEventListener('mousedown', onMouseDown);\r\n\r\n    // cleanup\r\n    return () => {\r\n        dragTarget.node.removeEventListener('mousedown', onMouseDown);\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draggable', initDraggable as EventSetupFn);\r\n","function waitFrames(frames: number, callback: () => void): void {\r\n\tlet count = 0;\r\n\r\n\tfunction step() {\r\n\t\tcount++;\r\n\t\tif (count >= frames) {\r\n\t\t\tcallback();\r\n\t\t} else {\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t}\r\n\t}\r\n\r\n\trequestAnimationFrame(step);\r\n}\r\n\r\n\r\nexport default waitFrames;","import { NodePrototype } from \"./node-types\";\r\n\r\n\r\nconst NodePrototypes : {\r\n    [key: string]: NodePrototype\r\n}= {};\r\nexport default NodePrototypes;","import { G } from \"@svgdotjs/svg.js\";\r\nimport Field, { AnyField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\nexport type AllowedOwner = NodeSvg | AnyField;\r\n\r\nfunction getAbsolutePosition(el: HTMLElement) {\r\n    const rect = el.getBoundingClientRect();\r\n    return {\r\n        x: rect.left + window.scrollX,\r\n        y: rect.top + window.scrollY,\r\n        width: rect.width,\r\n        height: rect.height,\r\n    };\r\n}\r\n\r\nexport interface DropdownOptions {\r\n    items: { label: string; value: string }[];\r\n    onSelect?: (value: string, item: { label: string; value: string }) => void;\r\n    width?: number;\r\n}\r\n\r\nclass DropdownContainer {\r\n    private static current: DropdownContainer | null = null;\r\n    private owner: AllowedOwner | null = null;\r\n    private rootEl: HTMLDivElement;\r\n    private options: DropdownOptions | null = null;\r\n    private constraint: { x: number; y: number; width: number; height: number };\r\n    private offset: { dx: number; dy: number };\r\n\r\n    constructor() {\r\n        this.rootEl = document.createElement(\"div\");\r\n        this.rootEl.className = \"KabelDropdownMenu\";\r\n        this.rootEl.style.position = \"absolute\";\r\n        this.rootEl.style.display = \"none\";\r\n        document.body.appendChild(this.rootEl);\r\n\r\n        this.constraint = { x: 0, y: 0, width: 0, height: 0 };\r\n        this.offset = { dx: 0, dy: 0 };\r\n    }\r\n\r\n    move(dx: number, dy: number) {\r\n        this.offset.dx = dx;\r\n        this.offset.dy = dy;\r\n        this.updatePosition();\r\n    }\r\n\r\n    private updatePosition() {\r\n        const { x, y, height } = this.constraint;\r\n        const { dx, dy } = this.offset;\r\n        this.rootEl.style.left = `${x + dx}px`;\r\n        this.rootEl.style.top = `${y + height + dy}px`; // anchored below, with offset\r\n    }\r\n    setContent(html: string) {\r\n        this.rootEl.innerHTML = html;\r\n    }\r\n    appendChild(element: Element) {\r\n        this.rootEl.appendChild(element);\r\n        return element;\r\n    }\r\n    show(owner: AllowedOwner, options: DropdownOptions) {\r\n        if (!owner.svgGroup) return;\r\n        this.hide(); // close any existing one\r\n        this.owner = owner;\r\n        if (options) this.options = options;\r\n\r\n        // compute constraint using bbox\r\n        const groupRect = owner.svgGroup.node.getBoundingClientRect();\r\n        this.constraint = {\r\n            x: groupRect.left + window.scrollX,\r\n            y: groupRect.top + window.scrollY,\r\n            width: groupRect.width,\r\n            height: groupRect.height,\r\n        };\r\n\r\n        // xy always 0 no matter what???\r\n        // reset offset each time\r\n        this.offset = { dx: 0, dy: 0 };\r\n\r\n        // render dropdown items\r\n        this.rootEl.innerHTML = \"\";\r\n        if (options.width) this.rootEl.style.width = `${options.width}px`;\r\n        this.rootEl.style.display = \"block\";\r\n\r\n        if (options.items) options.items.forEach((item) => { // this is optional incase u want custom content via DropdownContainer.setContent or appendChild\r\n            const el = document.createElement(\"div\");\r\n            el.className = \"KabelDropdownItem\";\r\n            el.textContent = item.label;\r\n            el.onclick = () => {\r\n                options.onSelect?.(item.value, item);\r\n                this.hide();\r\n            };\r\n            this.rootEl.appendChild(el);\r\n        });\r\n\r\n        this.updatePosition();\r\n        DropdownContainer.current = this;\r\n    }\r\n\r\n\r\n    hide() {\r\n        if (DropdownContainer.current !== this) return;\r\n        this.rootEl.style.display = \"none\";\r\n        this.rootEl.innerHTML = \"\";\r\n        this.owner = null;\r\n        this.options = null;\r\n        DropdownContainer.current = null;\r\n    }\r\n    hideIfOwner(owner: AllowedOwner) {\r\n        if (this.owner == owner) {\r\n            this.hide();\r\n        }\r\n    }\r\n    isVisible(): boolean {\r\n        return DropdownContainer.current === this;\r\n    }\r\n    getOwner(): AllowedOwner | null {\r\n        return this.owner;\r\n    }\r\n    static getCurrent(): DropdownContainer | null {\r\n        return DropdownContainer.current;\r\n    }\r\n}\r\n\r\n// singleton export\r\nconst dropdownContainer = new DropdownContainer();\r\nexport default dropdownContainer;\r\n","import { WidgetOptions } from \"./widget\";\r\n\r\n\r\nexport interface WidgetPrototypeList {\r\n    [key: string]: WidgetOptions\r\n}\r\n\r\nconst WidgetPrototypes: WidgetPrototypeList = {};\r\nexport default WidgetPrototypes;","import { Element } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport CommentModel from '../src/comment';\r\n\r\n\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    const comment = args.comment as CommentModel;\r\n    if (!comment) return () => { };\r\n\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let startRelX = 0;\r\n    let startRelY = 0;\r\n\r\n    function onPointerDown(ev: PointerEvent) {\r\n        ev.preventDefault();\r\n\r\n        const ws = comment.getWorkspace();\r\n        const rel = comment.relativeCoords;\r\n\r\n        // Capture offset from pointer to comment in workspace coords\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n        startRelX = rel.x - pointerWS.x;\r\n        startRelY = rel.y - pointerWS.y;\r\n\r\n        document.addEventListener('pointermove', onPointerMove);\r\n        document.addEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    function onPointerMove(ev: PointerEvent) {\r\n        const ws = comment.getWorkspace();\r\n\r\n        // Map pointer to workspace\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n\r\n        // Add initial offset\r\n        comment.relativeCoords.set(pointerWS.x + startRelX, pointerWS.y + startRelY);\r\n\r\n        ws.refreshComments();\r\n    }\r\n\r\n\r\n\r\n    function onPointerUp() {\r\n        document.removeEventListener('pointermove', onPointerMove);\r\n        document.removeEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    element.node.addEventListener('pointerdown', onPointerDown);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n        element.node.removeEventListener('pointerdown', onPointerDown);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draghandle', initDraggable as EventSetupFn);\r\n","import { Svg, Rect, Circle, G, Path, Element } from '@svgdotjs/svg.js';\r\n\r\nexport type EventType = string;\r\nexport type EventArgs = Record<string, any>;\r\nexport type EventSetupFn = (el: Element, args?: EventArgs) => (() => void) | void;\r\n\r\ninterface RegisteredEl {\r\n    tags: string[],\r\n    el: Element;\r\n    type: EventType;\r\n    args?: EventArgs | undefined;      // allow undefined explicitly\r\n    destroyFn?: (() => void) | undefined; // allow undefined explicitly\r\n}\r\n\r\n/**\r\n * Used by the Kabel renderer to tag svg.js elements as interactable with the kabel system.\r\n */\r\nclass Eventer {\r\n    private elements: RegisteredEl[] = [];\r\n    private eventRegistry: Map<EventType, EventSetupFn> = new Map();\r\n\r\n    // Register an event type with a setup function\r\n    registerEvent(type: EventType, setupFn: EventSetupFn) {\r\n        this.eventRegistry.set(type, setupFn);\r\n        return this; // allow chaining\r\n    }\r\n    tagElement(el: Element, tags?: string[] | string) {\r\n        if (!tags) return this;\r\n        const tagList = Array.isArray(tags) ? tags : [tags];\r\n\r\n        // Find the registered elements for this el\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el) {\r\n                for (const t of tagList) {\r\n                    if (!reg.tags.includes(t)) reg.tags.push(t);\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    destroyByTag(tag: string) {\r\n        let destroyed = false;\r\n        this.elements = this.elements.filter(reg => {\r\n            if (reg.tags.includes(tag)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                return false; // remove this element\r\n            }\r\n            return true; // keep element\r\n        });\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    // addElement\r\n    addElement(el: Element, types: EventType | EventType[], args?: EventArgs) {\r\n        const typeList = Array.isArray(types) ? types : [types];\r\n        for (const type of typeList) {\r\n            const destroyFn = this.setupElement(el, type, args) as (() => void) | undefined;\r\n            this.elements.push({\r\n                tags: [],\r\n                el,\r\n                type,\r\n                args,\r\n                destroyFn\r\n            });\r\n        }\r\n        return this;\r\n    }\r\n\r\n    // refresh\r\n    refresh() {\r\n        for (const reg of this.elements) {\r\n            if (reg.destroyFn) reg.destroyFn();\r\n            reg.destroyFn = this.setupElement(reg.el, reg.type, reg.args) as (() => void) | undefined;\r\n        }\r\n    }\r\n\r\n\r\n    // Destroy event(s) for an element\r\n    destroyElement(el: Element, type?: EventType) {\r\n        let destroyed = false;\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el && (!type || reg.type === type)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                // Remove from elements array\r\n                this.elements = this.elements.filter(r => r !== reg);\r\n            }\r\n        }\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    private setupElement(el: Element, type: EventType, args?: EventArgs): (() => void) | undefined {\r\n        const setupFn = this.eventRegistry.get(type);\r\n        if (!setupFn) return;\r\n        const destroyFn = setupFn(el, args);\r\n        return destroyFn instanceof Function ? destroyFn : undefined;\r\n    }\r\n}\r\n\r\nconst eventer = new Eventer();\r\nexport default eventer;\r\nexport { Eventer };\r\n","// Convert an arc to a sequence of cubic bzier curves\n//\n'use strict';\n\n\nvar TAU = Math.PI * 2;\n\n\n/* eslint-disable space-infix-ops */\n\n// Calculate an angle between two unit vectors\n//\n// Since we measure angle between radii of circular arcs,\n// we can use simplified math (without length normalization)\n//\nfunction unit_vector_angle(ux, uy, vx, vy) {\n  var sign = (ux * vy - uy * vx < 0) ? -1 : 1;\n  var dot  = ux * vx + uy * vy;\n\n  // Add this to work with arbitrary vectors:\n  // dot /= Math.sqrt(ux * ux + uy * uy) * Math.sqrt(vx * vx + vy * vy);\n\n  // rounding errors, e.g. -1.0000000000000002 can screw up this\n  if (dot >  1.0) { dot =  1.0; }\n  if (dot < -1.0) { dot = -1.0; }\n\n  return sign * Math.acos(dot);\n}\n\n\n// Convert from endpoint to center parameterization,\n// see http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n//\n// Return [cx, cy, theta1, delta_theta]\n//\nfunction get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi) {\n  // Step 1.\n  //\n  // Moving an ellipse so origin will be the middlepoint between our two\n  // points. After that, rotate it to line up ellipse axes with coordinate\n  // axes.\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  var rx_sq  =  rx * rx;\n  var ry_sq  =  ry * ry;\n  var x1p_sq = x1p * x1p;\n  var y1p_sq = y1p * y1p;\n\n  // Step 2.\n  //\n  // Compute coordinates of the centre of this ellipse (cx', cy')\n  // in the new coordinate system.\n  //\n  var radicant = (rx_sq * ry_sq) - (rx_sq * y1p_sq) - (ry_sq * x1p_sq);\n\n  if (radicant < 0) {\n    // due to rounding errors it might be e.g. -1.3877787807814457e-17\n    radicant = 0;\n  }\n\n  radicant /=   (rx_sq * y1p_sq) + (ry_sq * x1p_sq);\n  radicant = Math.sqrt(radicant) * (fa === fs ? -1 : 1);\n\n  var cxp = radicant *  rx/ry * y1p;\n  var cyp = radicant * -ry/rx * x1p;\n\n  // Step 3.\n  //\n  // Transform back to get centre coordinates (cx, cy) in the original\n  // coordinate system.\n  //\n  var cx = cos_phi*cxp - sin_phi*cyp + (x1+x2)/2;\n  var cy = sin_phi*cxp + cos_phi*cyp + (y1+y2)/2;\n\n  // Step 4.\n  //\n  // Compute angles (theta1, delta_theta).\n  //\n  var v1x =  (x1p - cxp) / rx;\n  var v1y =  (y1p - cyp) / ry;\n  var v2x = (-x1p - cxp) / rx;\n  var v2y = (-y1p - cyp) / ry;\n\n  var theta1 = unit_vector_angle(1, 0, v1x, v1y);\n  var delta_theta = unit_vector_angle(v1x, v1y, v2x, v2y);\n\n  if (fs === 0 && delta_theta > 0) {\n    delta_theta -= TAU;\n  }\n  if (fs === 1 && delta_theta < 0) {\n    delta_theta += TAU;\n  }\n\n  return [ cx, cy, theta1, delta_theta ];\n}\n\n//\n// Approximate one unit arc segment with bzier curves,\n// see http://math.stackexchange.com/questions/873224\n//\nfunction approximate_unit_arc(theta1, delta_theta) {\n  var alpha = 4/3 * Math.tan(delta_theta/4);\n\n  var x1 = Math.cos(theta1);\n  var y1 = Math.sin(theta1);\n  var x2 = Math.cos(theta1 + delta_theta);\n  var y2 = Math.sin(theta1 + delta_theta);\n\n  return [ x1, y1, x1 - y1*alpha, y1 + x1*alpha, x2 + y2*alpha, y2 - x2*alpha, x2, y2 ];\n}\n\nmodule.exports = function a2c(x1, y1, x2, y2, fa, fs, rx, ry, phi) {\n  var sin_phi = Math.sin(phi * TAU / 360);\n  var cos_phi = Math.cos(phi * TAU / 360);\n\n  // Make sure radii are valid\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  if (x1p === 0 && y1p === 0) {\n    // we're asked to draw line to itself\n    return [];\n  }\n\n  if (rx === 0 || ry === 0) {\n    // one of the radii is zero\n    return [];\n  }\n\n\n  // Compensate out-of-range radii\n  //\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n\n  var lambda = (x1p * x1p) / (rx * rx) + (y1p * y1p) / (ry * ry);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n\n  // Get center parameters (cx, cy, theta1, delta_theta)\n  //\n  var cc = get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi);\n\n  var result = [];\n  var theta1 = cc[2];\n  var delta_theta = cc[3];\n\n  // Split an arc to multiple segments, so each segment\n  // will be less than /4 (= 90)\n  //\n  var segments = Math.max(Math.ceil(Math.abs(delta_theta) / (TAU / 4)), 1);\n  delta_theta /= segments;\n\n  for (var i = 0; i < segments; i++) {\n    result.push(approximate_unit_arc(theta1, delta_theta));\n    theta1 += delta_theta;\n  }\n\n  // We have a bezier approximation of a unit circle,\n  // now need to transform back to the original ellipse\n  //\n  return result.map(function (curve) {\n    for (var i = 0; i < curve.length; i += 2) {\n      var x = curve[i + 0];\n      var y = curve[i + 1];\n\n      // scale\n      x *= rx;\n      y *= ry;\n\n      // rotate\n      var xp = cos_phi*x - sin_phi*y;\n      var yp = sin_phi*x + cos_phi*y;\n\n      // translate\n      curve[i + 0] = xp + cc[0];\n      curve[i + 1] = yp + cc[1];\n    }\n\n    return curve;\n  });\n};\n","'use strict';\n\nmodule.exports = require('./lib/svgpath');\n","import RendererConstants from \"../renderers/constants\";\r\nimport Renderer, {DrawState, ConnectorToFrom} from \"../renderers/renderer\";\r\nimport CategoryColors from \"./colors\";\r\nimport Connection, {Connectable} from \"./connection\";\r\nimport Coordinates from \"./coordinates\";\r\nimport Field, { FieldOptions, FieldVisualInfo, AnyFieldCls, AnyField, DummyField, FieldMap, NumberField, OptConnectField, TextField } from \"./field\";\r\nimport inject, { InjectMsg, InjectOptions, TblxCategoryStruct, TblxObjStruct, TblxFieldStruct, TblxNodeStruct } from \"./inject\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport NodeSvg, {NodeJson, NodeEvents, InputFieldJson} from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport eventer, {Eventer} from \"../util/eventer\";\r\nimport * as Path from '../util/path';\r\nimport * as SVG from '@svgdotjs/svg.js';\r\nimport * as UID from '../util/uid';\r\nimport hasProp from \"../util/has-prop\";\r\nimport EventEmitter from \"../util/emitter\";\r\n\r\nimport K from './core';\r\nimport { WidgetOptions } from \"./widget\";\r\nimport { WidgetPrototypeList } from \"./widget-prototypes\";\r\nimport KabelInterface from \"./types\";\r\n\r\n//@ts-ignore\r\nconst Kabel: KabelInterface = K;\r\n\r\nexport default Kabel;\r\n\r\nexport type {\r\n    KabelInterface,\r\n    TblxCategoryStruct,\r\n    TblxNodeStruct,\r\n    TblxFieldStruct,\r\n    TblxObjStruct,\r\n    RendererConstants,\r\n    Renderer,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    inject,\r\n    InjectMsg,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    NodePrototypes,\r\n    WorkspaceSvg,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    InjectOptions,\r\n    Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple,\r\n    NodePrototype,\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n    NodeJson, NodeEvents, InputFieldJson,\r\n    Eventer,\r\n    Connectable,\r\n    DrawState,\r\n    ConnectorToFrom,\r\n    WidgetOptions,\r\n    WidgetPrototypeList\r\n}","class Coordinates {\r\n    x: number;\r\n    y: number;\r\n\r\n    constructor(x: number = 0, y: number = 0) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    /** Set coordinates */\r\n    set(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    /** Returns a copy of this coordinate */\r\n    clone(): Coordinates {\r\n        return new Coordinates(this.x, this.y);\r\n    }\r\n\r\n    /** Calculate distance to another coordinate */\r\n    distanceTo(other: Coordinates): number {\r\n        const dx = this.x - other.x;\r\n        const dy = this.y - other.y;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    /** Convert to string */\r\n    toString(): string {\r\n        return `(${this.x}, ${this.y})`;\r\n    }\r\n\r\n    /** Convert to array [x, y] */\r\n    toArray(): [number, number] {\r\n        return [this.x, this.y];\r\n    }\r\n\r\n    /** Convert to object { x, y } */\r\n    toObject(): { x: number; y: number } {\r\n        return { x: this.x, y: this.y };\r\n    }\r\n}\r\nexport default Coordinates;","import { Color, Hex } from \"../src/visual-types\";\r\n\r\nclass RendererConstants {\r\n    CORNER_RADIUS!: number;\r\n    NODE_BASE_WIDTH!: number;\r\n    NODE_BASE_HEIGHT!: number;\r\n    TOPBAR_HEIGHT!: number;\r\n    FOOTER_HEIGHT!: number;\r\n    PADDING_BIG!: number;\r\n    PADDING_MEDIUM!: number;\r\n    PADDING_SMALL!: number;\r\n    FIELD_SPACEY!: number;\r\n    FIELD_SPACEX!: number;\r\n    FIELD_RAW_BASE_WIDTH!: number;\r\n    FIELD_RAW_BASE_HEIGHT!: number;\r\n    INPUT_BOX_PADDING!: number;\r\n    INPUT_BOX_TEXT_ANCHOR!: 'start' | 'middle';\r\n    LABEL_SPACING!: number;\r\n\r\n    FIELD_RAW_COLOR: Color = '#2b2d36ff';         \r\n    FIELD_RAW_TEXT_COLOR: Color = '#e0e2e8ff';    \r\n    FIELD_RAW_OUTLINE_COLOR: Color = '#1f2027ff'; \r\n    FIELD_RAW_OUTLINE_STROKE!: number;\r\n    FIELD_CONN_COLOR: Color = '#0c7cccff'\r\n    NODE_BG_COLOR: Color = '#2c2d3aff';           \r\n    NODE_OUTLINE_COLOR: Color = '#1d1e25ff';\r\n    CONNECTOR_TRIANGLE!: boolean; \r\n    CONNECTION_STROKE_WIDTH!: number;\r\n    CONNECTION_STROKE_COLOR_CHOICE!: number;\r\n    CONNECTOR_TRI_SIZE!: number;\r\n    CONNECTOR_RADIUS!: number;\r\n    FONT_FAMILY: string =\r\n        '\"Inter\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif';\r\n    FONT_SIZE!: number;\r\n    FONT_COLOR: Color = '#e0e2e8ff';              \r\n\r\n    FIELD_MARGIN_X!: number;\r\n    FIELD_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_MARGIN_X!: number;\r\n    TOPBAR_LABEL_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_BOLDED!: boolean;\r\n    CONNECTOR_LINE_WIDTH: number = 6;          \r\n    CONNECTOR_LINE_CURVED: boolean = true;     \r\n\r\n    constructor(overrides: Partial<RendererConstants> = {}) {\r\n        this.CONNECTOR_TRI_SIZE = 8;\r\n        this.CONNECTOR_RADIUS = 10;\r\n        this.CORNER_RADIUS = 6;\r\n        this.NODE_BASE_WIDTH = 200;\r\n        this.NODE_BASE_HEIGHT = 240;\r\n\r\n        this.TOPBAR_HEIGHT = 50;\r\n        this.FOOTER_HEIGHT = 25;\r\n        this.PADDING_BIG = 16;\r\n        this.PADDING_MEDIUM = 8;\r\n        this.PADDING_SMALL = 4;\r\n        this.FIELD_RAW_BASE_WIDTH = 80;\r\n        this.FIELD_RAW_BASE_HEIGHT = 42;\r\n        this.INPUT_BOX_PADDING = 6;\r\n        this.LABEL_SPACING = 5;\r\n        this.INPUT_BOX_TEXT_ANCHOR = 'middle';\r\n        this.CONNECTOR_TRIANGLE = false;\r\n        this.CONNECTION_STROKE_WIDTH = 2;\r\n        this.CONNECTION_STROKE_COLOR_CHOICE = 1;\r\n        this.FIELD_RAW_OUTLINE_STROKE = 2;\r\n        this.FIELD_SPACEY = 20;\r\n        this.FIELD_SPACEX = 20;\r\n        this.FONT_SIZE = 20;\r\n        this.TOPBAR_LABEL_BOLDED = true;\r\n        this.FIELD_MARGIN_X = 16;\r\n        this.FIELD_MARGIN_Y = 16;\r\n        this.TOPBAR_LABEL_MARGIN_X = 12; \r\n        this.TOPBAR_LABEL_MARGIN_Y = 0;  \r\n\r\n        Object.assign(this, overrides);\r\n    }\r\n}\r\n\r\nexport default RendererConstants;\r\n","// SVG Path transformations library\n//\n// Usage:\n//\n//    SvgPath('...')\n//      .translate(-150, -100)\n//      .scale(0.5)\n//      .translate(-150, -100)\n//      .toFixed(1)\n//      .toString()\n//\n\n'use strict';\n\n\nvar pathParse      = require('./path_parse');\nvar transformParse = require('./transform_parse');\nvar matrix         = require('./matrix');\nvar a2c            = require('./a2c');\nvar ellipse        = require('./ellipse');\n\n\n// Class constructor\n//\nfunction SvgPath(path) {\n  if (!(this instanceof SvgPath)) { return new SvgPath(path); }\n\n  var pstate = pathParse(path);\n\n  // Array of path segments.\n  // Each segment is array [command, param1, param2, ...]\n  this.segments = pstate.segments;\n\n  // Error message on parse error.\n  this.err      = pstate.err;\n\n  // Transforms stack for lazy evaluation\n  this.__stack    = [];\n}\n\nSvgPath.from = function (src) {\n  if (typeof src === 'string') return new SvgPath(src);\n\n  if (src instanceof SvgPath) {\n    // Create empty object\n    var s = new SvgPath('');\n\n    // Clone properies\n    s.err = src.err;\n    s.segments = src.segments.map(function (sgm) { return sgm.slice(); });\n    s.__stack = src.__stack.map(function (m) {\n      return matrix().matrix(m.toArray());\n    });\n\n    return s;\n  }\n\n  throw new Error('SvgPath.from: invalid param type ' + src);\n};\n\n\nSvgPath.prototype.__matrix = function (m) {\n  var self = this, i;\n\n  // Quick leave for empty matrix\n  if (!m.queue.length) { return; }\n\n  this.iterate(function (s, index, x, y) {\n    var p, result, name, isRelative;\n\n    switch (s[0]) {\n\n      // Process 'assymetric' commands separately\n      case 'v':\n        p      = m.calc(0, s[1], true);\n        result = (p[0] === 0) ? [ 'v', p[1] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'V':\n        p      = m.calc(x, s[1], false);\n        result = (p[0] === m.calc(x, y, false)[0]) ? [ 'V', p[1] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'h':\n        p      = m.calc(s[1], 0, true);\n        result = (p[1] === 0) ? [ 'h', p[0] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'H':\n        p      = m.calc(s[1], y, false);\n        result = (p[1] === m.calc(x, y, false)[1]) ? [ 'H', p[0] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'a':\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n\n        // Drop segment if arc is empty (end point === start point)\n        /*if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          return [];\n        }*/\n\n        // Transform rx, ry and the x-axis-rotation\n        var ma = m.toArray();\n        var e = ellipse(s[1], s[2], s[3]).transform(ma);\n\n        // flip sweep-flag if matrix is not orientation-preserving\n        if (ma[0] * ma[3] - ma[1] * ma[2] < 0) {\n          s[5] = s[5] ? '0' : '1';\n        }\n\n        // Transform end point as usual (without translation for relative notation)\n        p = m.calc(s[6], s[7], s[0] === 'a');\n\n        // Empty arcs can be ignored by renderer, but should not be dropped\n        // to avoid collisions with `S A S` and so on. Replace with empty line.\n        if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n          break;\n        }\n\n        // if the resulting ellipse is (almost) a segment ...\n        if (e.isDegenerate()) {\n          // replace the arc by a line\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n        } else {\n          // if it is a real ellipse\n          // s[0], s[4] and s[5] are not modified\n          result = [ s[0], e.rx, e.ry, e.ax, s[4], s[5], p[0], p[1] ];\n        }\n\n        break;\n\n      case 'm':\n        // Edge case. The very first `m` should be processed as absolute, if happens.\n        // Make sense for coord shift transforms.\n        isRelative = index > 0;\n\n        p = m.calc(s[1], s[2], isRelative);\n        result = [ 'm', p[0], p[1] ];\n        break;\n\n      default:\n        name       = s[0];\n        result     = [ name ];\n        isRelative = (name.toLowerCase() === name);\n\n        // Apply transformations to the segment\n        for (i = 1; i < s.length; i += 2) {\n          p = m.calc(s[i], s[i + 1], isRelative);\n          result.push(p[0], p[1]);\n        }\n    }\n\n    self.segments[index] = result;\n  }, true);\n};\n\n\n// Apply stacked commands\n//\nSvgPath.prototype.__evaluateStack = function () {\n  var m, i;\n\n  if (!this.__stack.length) { return; }\n\n  if (this.__stack.length === 1) {\n    this.__matrix(this.__stack[0]);\n    this.__stack = [];\n    return;\n  }\n\n  m = matrix();\n  i = this.__stack.length;\n\n  while (--i >= 0) {\n    m.matrix(this.__stack[i].toArray());\n  }\n\n  this.__matrix(m);\n  this.__stack = [];\n};\n\n\n// Convert processed SVG Path back to string\n//\nSvgPath.prototype.toString = function () {\n  var result = '', prevCmd = '', cmdSkipped = false;\n\n  this.__evaluateStack();\n\n  for (var i = 0, len = this.segments.length; i < len; i++) {\n    var segment = this.segments[i];\n    var cmd = segment[0];\n\n    // Command not repeating => store\n    if (cmd !== prevCmd || cmd === 'm' || cmd === 'M') {\n      // workaround for FontForge SVG importing bug, keep space between \"z m\".\n      if (cmd === 'm' && prevCmd === 'z') result += ' ';\n      result += cmd;\n\n      cmdSkipped = false;\n    } else {\n      cmdSkipped = true;\n    }\n\n    // Store segment params\n    for (var pos = 1; pos < segment.length; pos++) {\n      var val = segment[pos];\n      // Space can be skipped\n      // 1. After command (always)\n      // 2. For negative value (with '-' at start)\n      if (pos === 1) {\n        if (cmdSkipped && val >= 0) result += ' ';\n      } else if (val >= 0) result += ' ';\n\n      result += val;\n    }\n\n    prevCmd = cmd;\n  }\n\n  return result;\n};\n\n\n// Translate path to (x [, y])\n//\nSvgPath.prototype.translate = function (x, y) {\n  this.__stack.push(matrix().translate(x, y || 0));\n  return this;\n};\n\n\n// Scale path to (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.scale = function (sx, sy) {\n  this.__stack.push(matrix().scale(sx, (!sy && (sy !== 0)) ? sx : sy));\n  return this;\n};\n\n\n// Rotate path around point (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.rotate = function (angle, rx, ry) {\n  this.__stack.push(matrix().rotate(angle, rx || 0, ry || 0));\n  return this;\n};\n\n\n// Skew path along the X axis by `degrees` angle\n//\nSvgPath.prototype.skewX = function (degrees) {\n  this.__stack.push(matrix().skewX(degrees));\n  return this;\n};\n\n\n// Skew path along the Y axis by `degrees` angle\n//\nSvgPath.prototype.skewY = function (degrees) {\n  this.__stack.push(matrix().skewY(degrees));\n  return this;\n};\n\n\n// Apply matrix transform (array of 6 elements)\n//\nSvgPath.prototype.matrix = function (m) {\n  this.__stack.push(matrix().matrix(m));\n  return this;\n};\n\n\n// Transform path according to \"transform\" attr of SVG spec\n//\nSvgPath.prototype.transform = function (transformString) {\n  if (!transformString.trim()) {\n    return this;\n  }\n  this.__stack.push(transformParse(transformString));\n  return this;\n};\n\n\n// Round coords with given decimal precition.\n// 0 by default (to integers)\n//\nSvgPath.prototype.round = function (d) {\n  var contourStartDeltaX = 0, contourStartDeltaY = 0, deltaX = 0, deltaY = 0, l;\n\n  d = d || 0;\n\n  this.__evaluateStack();\n\n  this.segments.forEach(function (s) {\n    var isRelative = (s[0].toLowerCase() === s[0]);\n\n    switch (s[0]) {\n      case 'H':\n      case 'h':\n        if (isRelative) { s[1] += deltaX; }\n        deltaX = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'V':\n      case 'v':\n        if (isRelative) { s[1] += deltaY; }\n        deltaY = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'Z':\n      case 'z':\n        deltaX = contourStartDeltaX;\n        deltaY = contourStartDeltaY;\n        return;\n\n      case 'M':\n      case 'm':\n        if (isRelative) {\n          s[1] += deltaX;\n          s[2] += deltaY;\n        }\n\n        deltaX = s[1] - s[1].toFixed(d);\n        deltaY = s[2] - s[2].toFixed(d);\n\n        contourStartDeltaX = deltaX;\n        contourStartDeltaY = deltaY;\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        return;\n\n      case 'A':\n      case 'a':\n        // [cmd, rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        if (isRelative) {\n          s[6] += deltaX;\n          s[7] += deltaY;\n        }\n\n        deltaX = s[6] - s[6].toFixed(d);\n        deltaY = s[7] - s[7].toFixed(d);\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        s[3] = +s[3].toFixed(d + 2); // better precision for rotation\n        s[6] = +s[6].toFixed(d);\n        s[7] = +s[7].toFixed(d);\n        return;\n\n      default:\n        // a c l q s t\n        l = s.length;\n\n        if (isRelative) {\n          s[l - 2] += deltaX;\n          s[l - 1] += deltaY;\n        }\n\n        deltaX = s[l - 2] - s[l - 2].toFixed(d);\n        deltaY = s[l - 1] - s[l - 1].toFixed(d);\n\n        s.forEach(function (val, i) {\n          if (!i) { return; }\n          s[i] = +s[i].toFixed(d);\n        });\n        return;\n    }\n  });\n\n  return this;\n};\n\n\n// Apply iterator function to all segments. If function returns result,\n// current segment will be replaced to array of returned segments.\n// If empty array is returned, current regment will be deleted.\n//\nSvgPath.prototype.iterate = function (iterator, keepLazyStack) {\n  var segments = this.segments,\n      replacements = {},\n      needReplace = false,\n      lastX = 0,\n      lastY = 0,\n      countourStartX = 0,\n      countourStartY = 0;\n  var i, j, newSegments;\n\n  if (!keepLazyStack) {\n    this.__evaluateStack();\n  }\n\n  segments.forEach(function (s, index) {\n\n    var res = iterator(s, index, lastX, lastY);\n\n    if (Array.isArray(res)) {\n      replacements[index] = res;\n      needReplace = true;\n    }\n\n    var isRelative = (s[0] === s[0].toLowerCase());\n\n    // calculate absolute X and Y\n    switch (s[0]) {\n      case 'm':\n      case 'M':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        lastY = s[2] + (isRelative ? lastY : 0);\n        countourStartX = lastX;\n        countourStartY = lastY;\n        return;\n\n      case 'h':\n      case 'H':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        return;\n\n      case 'v':\n      case 'V':\n        lastY = s[1] + (isRelative ? lastY : 0);\n        return;\n\n      case 'z':\n      case 'Z':\n        // That make sence for multiple contours\n        lastX = countourStartX;\n        lastY = countourStartY;\n        return;\n\n      default:\n        lastX = s[s.length - 2] + (isRelative ? lastX : 0);\n        lastY = s[s.length - 1] + (isRelative ? lastY : 0);\n    }\n  });\n\n  // Replace segments if iterator return results\n\n  if (!needReplace) { return this; }\n\n  newSegments = [];\n\n  for (i = 0; i < segments.length; i++) {\n    if (typeof replacements[i] !== 'undefined') {\n      for (j = 0; j < replacements[i].length; j++) {\n        newSegments.push(replacements[i][j]);\n      }\n    } else {\n      newSegments.push(segments[i]);\n    }\n  }\n\n  this.segments = newSegments;\n\n  return this;\n};\n\n\n// Converts segments from relative to absolute\n//\nSvgPath.prototype.abs = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameUC = name.toUpperCase(),\n        i;\n\n    // Skip absolute commands\n    if (name === nameUC) { return; }\n\n    s[0] = nameUC;\n\n    switch (name) {\n      case 'v':\n        // v has shifted coords parity\n        s[1] += y;\n        return;\n\n      case 'a':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] += x;\n        s[7] += y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] += i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts segments from absolute to relative\n//\nSvgPath.prototype.rel = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameLC = name.toLowerCase(),\n        i;\n\n    // Skip relative commands\n    if (name === nameLC) { return; }\n\n    // Don't touch the first M to avoid potential confusions.\n    if (index === 0 && name === 'M') { return; }\n\n    s[0] = nameLC;\n\n    switch (name) {\n      case 'V':\n        // V has shifted coords parity\n        s[1] -= y;\n        return;\n\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] -= x;\n        s[7] -= y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] -= i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts arcs to cubic bzier curves\n//\nSvgPath.prototype.unarc = function () {\n  this.iterate(function (s, index, x, y) {\n    var new_segments, nextX, nextY, result = [], name = s[0];\n\n    // Skip anything except arcs\n    if (name !== 'A' && name !== 'a') { return null; }\n\n    if (name === 'a') {\n      // convert relative arc coordinates to absolute\n      nextX = x + s[6];\n      nextY = y + s[7];\n    } else {\n      nextX = s[6];\n      nextY = s[7];\n    }\n\n    new_segments = a2c(x, y, nextX, nextY, s[4], s[5], s[1], s[2], s[3]);\n\n    // Degenerated arcs can be ignored by renderer, but should not be dropped\n    // to avoid collisions with `S A S` and so on. Replace with empty line.\n    if (new_segments.length === 0) {\n      return [ [ s[0] === 'a' ? 'l' : 'L', s[6], s[7] ] ];\n    }\n\n    new_segments.forEach(function (s) {\n      result.push([ 'C', s[2], s[3], s[4], s[5], s[6], s[7] ]);\n    });\n\n    return result;\n  });\n\n  return this;\n};\n\n\n// Converts smooth curves (with missed control point) to generic curves\n//\nSvgPath.prototype.unshort = function () {\n  var segments = this.segments;\n  var prevControlX, prevControlY, prevSegment;\n  var curControlX, curControlY;\n\n  // TODO: add lazy evaluation flag when relative commands supported\n\n  this.iterate(function (s, idx, x, y) {\n    var name = s[0], nameUC = name.toUpperCase(), isRelative;\n\n    // First command MUST be M|m, it's safe to skip.\n    // Protect from access to [-1] for sure.\n    if (!idx) { return; }\n\n    if (nameUC === 'T') { // quadratic curve\n      isRelative = (name === 't');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'Q') {\n        prevControlX = prevSegment[1] - x;\n        prevControlY = prevSegment[2] - y;\n      } else if (prevSegment[0] === 'q') {\n        prevControlX = prevSegment[1] - prevSegment[3];\n        prevControlY = prevSegment[2] - prevSegment[4];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'q' : 'Q',\n        curControlX, curControlY,\n        s[1], s[2]\n      ];\n\n    } else if (nameUC === 'S') { // cubic curve\n      isRelative = (name === 's');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'C') {\n        prevControlX = prevSegment[3] - x;\n        prevControlY = prevSegment[4] - y;\n      } else if (prevSegment[0] === 'c') {\n        prevControlX = prevSegment[3] - prevSegment[5];\n        prevControlY = prevSegment[4] - prevSegment[6];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'c' : 'C',\n        curControlX, curControlY,\n        s[1], s[2], s[3], s[4]\n      ];\n    }\n  });\n\n  return this;\n};\n\n\nmodule.exports = SvgPath;\n","export default \"/* Workspace wrapper: horizontal layout */\\r\\n.KabelWorkspaceWrapper {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #f0f0f0;\\r\\n    /* light gray background */\\r\\n    overflow: hidden;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n/* Toolbox panel (left) */\\r\\n.KabelToolbox {\\r\\n    width: 12%;\\r\\n    min-width: 150px;\\r\\n    height: 100%;\\r\\n    background: rgba(240, 240, 240, 0.95);\\r\\n    border-right: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    padding: 8px;\\r\\n    overflow-y: auto;\\r\\n}\\r\\n\\r\\n/* Context menu container */\\r\\n.KabelContextMenu {\\r\\n    position: absolute;\\r\\n    background: #1e1e2f;\\r\\n    color: #000000;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);\\r\\n    padding: 4px 0;\\r\\n    font-family: 'Segoe UI', sans-serif;\\r\\n    font-size: 14px;\\r\\n    min-width: 160px;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    overflow: visible;\\r\\n    height: auto;\\r\\n    transition: opacity 0.15s ease, transform 0.15s ease;\\r\\n    opacity: 0;\\r\\n    transform: scale(0.95);\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n}\\r\\n\\r\\n/* Show state */\\r\\n.KabelContextMenu.show {\\r\\n    opacity: 1;\\r\\n    transform: scale(1);\\r\\n}\\r\\n\\r\\n/* Individual option */\\r\\n.KabelContextOption {\\r\\n    padding: 8px 16px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s ease, color 0.15s ease;\\r\\n}\\r\\n\\r\\n.KabelContextOption:hover {\\r\\n    background: #b0adb0;\\r\\n    color: #fff;\\r\\n}\\r\\n\\r\\n/* Optional: active click effect */\\r\\n.KabelContextOption:active {\\r\\n    background: #fff;\\r\\n    color: #000;\\r\\n}\\r\\n\\r\\n/* Scrollbar if too many options */\\r\\n.KabelContextMenu::-webkit-scrollbar {\\r\\n    width: 6px;\\r\\n}\\r\\n\\r\\n.KabelContextMenu::-webkit-scrollbar-thumb {\\r\\n    background: rgba(255, 255, 255, 0.2);\\r\\n    border-radius: 3px;\\r\\n}\\r\\n\\r\\n/* Category buttons */\\r\\n\\r\\n.KabelCategoryRow {\\r\\n    background: #fff;\\r\\n    border: 1px solid #ccc;\\r\\n    padding: 4px 8px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    height: 5%;\\r\\n    padding: 6px;\\r\\n    cursor: pointer;\\r\\n    text-align: left;\\r\\n    transition: background 0.2s, color 0.2s;\\r\\n}\\r\\n\\r\\n.KabelToolbox button:hover {\\r\\n    background: #e6e6e6;\\r\\n    color: #333;\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlight {\\r\\n    stroke: yellow !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 255, 0, 0.9));\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlightWrong {\\r\\n    stroke: rgb(255, 0, 0) !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 0, 0, 0.9));\\r\\n}\\r\\n\\r\\n/* Container */\\r\\n.KabelDropdownMenu {\\r\\n    position: absolute;\\r\\n    display: none;\\r\\n    background: #1e1e1e;\\r\\n    color: #f0f0f0;\\r\\n    font-family: sans-serif;\\r\\n    font-size: 14px;\\r\\n    border: 1px solid #333;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);\\r\\n    padding: 4px 0;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    animation: fadeIn 0.15s ease-out;\\r\\n}\\r\\n\\r\\n/* Dropdown items */\\r\\n.KabelDropdownItem {\\r\\n    padding: 6px 12px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s;\\r\\n}\\r\\n\\r\\n/* Hover + focus states */\\r\\n.KabelDropdownItem:hover,\\r\\n.KabelDropdownItem:focus {\\r\\n    background: #2d2d2d;\\r\\n}\\r\\n\\r\\n/* Active (clicked) state */\\r\\n.KabelDropdownItem:active {\\r\\n    background: #3a3a3a;\\r\\n}\\r\\n\\r\\n/* Optional: highlight selected value */\\r\\n.KabelDropdownItem.selected {\\r\\n    background: #444;\\r\\n    font-weight: 600;\\r\\n}\\r\\n\\r\\n/* Smooth open effect */\\r\\n@keyframes fadeIn {\\r\\n    from {\\r\\n        opacity: 0;\\r\\n        transform: translateY(-3px);\\r\\n    }\\r\\n\\r\\n    to {\\r\\n        opacity: 1;\\r\\n        transform: translateY(0);\\r\\n    }\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\n/* Flyout panel (right) */\\r\\n.KabelFlyout {\\r\\n    width: 20%;\\r\\n    height: 100%;\\r\\n    background: rgba(255, 255, 255, 0.95);\\r\\n    border-left: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    overflow-y: auto;\\r\\n    position: relative;\\r\\n    /* for absolute positioning of nodes inside */\\r\\n    display: none;\\r\\n    /* hidden by default */\\r\\n    padding: 8px;\\r\\n}\\r\\n\\r\\n/* Flyout nodes */\\r\\n.KabelFlyoutNode {\\r\\n    padding: 6px 10px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    cursor: pointer;\\r\\n    user-select: none;\\r\\n    transition: background 0.2s;\\r\\n}\\r\\n\\r\\n.KabelFlyoutNode:hover {\\r\\n    background: #e0e0e0;\\r\\n}\\r\\n\\r\\n/* SVG workspace area */\\r\\n.KabelWorkspaceWrapper svg {\\r\\n    flex: 1;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #fff;\\r\\n    /* white canvas background */\\r\\n    display: block;\\r\\n}\";","import { Element } from '@svgdotjs/svg.js';\r\nimport Connection, { Connectable } from '../src/connection';\r\nimport eventer, { EventArgs } from '../util/eventer';\r\nimport userState from '../util/user-state';\r\nimport Field, { AnyField } from '../src/field';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport waitFrames from '../util/wait-anim-frames';\r\ninterface ConnectionV {\r\n    conn: Connection,\r\n    el: Element,\r\n    args?: EventArgs\r\n}\r\ninterface ConnectionState {\r\n    one: null | ConnectionV,\r\n    two: null | ConnectionV\r\n}\r\n\r\n\r\nconst cState: ConnectionState = {\r\n    one: null,\r\n    two: null\r\n}\r\n\r\n\r\nfunction initConnector(el: Element, args?: EventArgs) {\r\n    args = args as {\r\n        connection: Connection,\r\n        node?: NodeSvg,\r\n        field?: AnyField\r\n    };\r\n    if (args.field && !args.field?.canEditConnector) { // If editing isnt allowed, close the event early.\r\n        return; \r\n    }\r\n    el.on('click', () => {\r\n        const isPrev = args.connection.isPrevious;\r\n\r\n        // First click  must NOT be previous\r\n        if (!cState.one) {\r\n            if (isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            cState.one = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n            userState.setState('connecting')\r\n            return;\r\n        }\r\n\r\n        // Second click  must be previous\r\n        if (!cState.two && (args?.node !== cState.one?.args?.node)) {\r\n            if (!isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            if (cState.one.conn === args.connection) return; // ignore clicking the same again\r\n            cState.two = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n        }\r\n\r\n        // Both are filled  attempt to connect\r\n        if (cState.one && cState.two) {\r\n            if (cState.two.args?.node == cState.one.args?.node || cState.two.args?.node === cState.one?.args?.field?.node) {\r\n                cState.one.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                cState.two.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    if (!cState) return;\r\n                    if (!cState.one || !cState.two) return;\r\n                    cState.one.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.two.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.one = null;\r\n                    cState.two = null;\r\n                })\r\n                userState.removeState('connecting');\r\n                return;\r\n            }\r\n            const { conn: connA } = cState.one;\r\n            const { conn: connB } = cState.two;\r\n\r\n            connA.disconnectTo();\r\n            connB.disconnectFrom();\r\n\r\n            connA.to = cState.two.args?.node;\r\n            connB.from = cState.one.args?.node || cState.one.args?.field;\r\n\r\n            waitFrames(2, () => {\r\n                if (cState.one?.args?.node) {\r\n                    cState.one.args.node.workspace?.redraw();\r\n                } else if (cState.two?.args?.node) {\r\n                    cState.two.args.node.workspace?.redraw();\r\n                }\r\n                cState.one = null;\r\n                cState.two = null;\r\n                userState.removeState('connecting');\r\n            });\r\n        }\r\n    });\r\n    return () => {\r\n        el.off('click'); // removes the click listener\r\n    };\r\n\r\n}\r\n\r\neventer.registerEvent('k_connectbubble', initConnector);\r\n","import { parseColor } from \"../util/parse-color\";\r\nimport { TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { Color } from \"./visual-types\";\r\n\r\nclass Category {\r\n\tlabel: string;\r\n\tcolor: Color;\r\n\tcontents: TblxNodeStruct[];\r\n\t_rowDiv!: HTMLButtonElement;\r\n\t_toolbox: Toolbox;\r\n\r\n\tconstructor(toolbox: Toolbox, cData: TblxCategoryStruct) {\r\n\t\tthis.label = cData.name;\r\n\t\tthis.color = cData.color;\r\n\t\tthis.contents = cData.contents;\r\n\t\tthis._toolbox = toolbox;\r\n\t\tthis._makeDiv();\r\n\t}\r\n\r\n\t_makeDiv() {\r\n\t\tconst btn = document.createElement(\"button\");\r\n\t\tbtn.textContent = this.label;\r\n\t\tbtn.className = \"KabelCategoryRow\";\r\n\t\tbtn.style.backgroundColor = parseColor(this.color);\r\n        btn.style.color = parseColor('#ffffff');\r\n\t\tthis._rowDiv = btn;\r\n\r\n\t\tbtn.addEventListener(\"click\", e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis._toolbox._flyout.clear();\r\n\t\t\tthis._toolbox._flyout.fill(this.contents);\r\n\t\t\tthis._toolbox._flyout.show();\r\n\t\t});\r\n\r\n\t\tthis._toolbox.container.appendChild(btn);\r\n\t}\r\n\r\n\t/** Refreshes the UI for this category (label, color, contents) */\r\n\trefresh(cData: Partial<TblxCategoryStruct>) {\r\n\t\tif (cData.name !== undefined) {\r\n\t\t\tthis.label = cData.name;\r\n\t\t\tthis._rowDiv.textContent = this.label;\r\n\t\t}\r\n\t\tif (cData.color !== undefined) {\r\n\t\t\tthis.color = cData.color;\r\n\t\t\tthis._rowDiv.style.backgroundColor = parseColor(this.color);\r\n\t\t}\r\n\t\tif (cData.contents !== undefined) {\r\n\t\t\tthis.contents = cData.contents;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Remove category row from toolbox */\r\n\tdestroy() {\r\n\t\tthis._rowDiv.remove();\r\n\t\tthis._toolbox = null as unknown as Toolbox; // optional: release ref\r\n\t}\r\n\r\n\t/** Hide this category from the UI */\r\n\thide() {\r\n\t\tthis._rowDiv.style.display = \"none\";\r\n\t}\r\n\r\n\t/** Show this category in the UI */\r\n\tshow() {\r\n\t\tthis._rowDiv.style.display = \"\";\r\n\t}\r\n\r\n\t/** Enable/disable interaction */\r\n\tsetDisabled(disabled: boolean) {\r\n\t\tthis._rowDiv.disabled = disabled;\r\n\t}\r\n\r\n\t/** Returns a plain object copy of this category */\r\n\ttoJSON(): TblxCategoryStruct {\r\n\t\treturn {\r\n\t\t\tname: this.label,\r\n\t\t\tcolor: this.color,\r\n\t\t\tcontents: this.contents,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default Category;\r\n","import Field, { ConnectableField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\nexport type Connectable = NodeSvg | null | Field;\r\nclass Connection {\r\n    from: Connectable;\r\n    to: Connectable;\r\n    isPrevious: boolean;\r\n    constructor(from: Connectable, to: Connectable, isPrevious: boolean = false) {\r\n        this.from = from;\r\n        this.to = to;\r\n        this.isPrevious = isPrevious;\r\n    }\r\n\r\n    getTo(): Connectable {\r\n        return this.to;\r\n    }\r\n    getFrom(): Connectable {\r\n        return this.from;\r\n    }\r\n    disconnectTo() {\r\n        if (!this.to) return;\r\n\r\n        if (this.to instanceof NodeSvg && this.to.previousConnection) {\r\n            const prevConn = this.to.previousConnection;\r\n            const prevFrom = prevConn.from;\r\n\r\n            // disconnect NodeSvg chain safely\r\n            if (prevFrom instanceof NodeSvg && prevFrom.nextConnection?.to) {\r\n                prevFrom.nextConnection.to = null;\r\n            }\r\n\r\n            // disconnect Field chain safely\r\n            if (prevFrom instanceof Field && prevFrom.hasConnectable?.()) {\r\n                (prevFrom as ConnectableField).disconnect();\r\n            }\r\n        }\r\n\r\n        this.to = null;\r\n    }\r\n\r\n    disconnectFrom() {\r\n        if (!this.from) {\r\n            return;\r\n        }\r\n        if (this.from instanceof NodeSvg && this.from.nextConnection) {\r\n            const next = this.from.nextConnection;\r\n            if (next.to instanceof NodeSvg && next.to.previousConnection?.from) {\r\n                next.to.previousConnection.from = null;\r\n            } else if (next.to instanceof Field && next.to.hasConnectable()) {\r\n                (next.to as ConnectableField).disconnect();\r\n            }\r\n            next.to = null;\r\n        } else if (this.from instanceof Field && this.from.hasConnectable()) {\r\n            (this.from as ConnectableField).disconnect();\r\n        }\r\n        this.from = null;\r\n    }\r\n\r\n    isolate() {\r\n        this.from = null as any;\r\n        this.to = null as any;\r\n    }\r\n}\r\nexport default Connection;","import { Element, Rect, Text } from \"@svgdotjs/svg.js\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\nimport { Renderer } from \"../src\";\r\n\r\nfunction initInputBox(element: Element, args: Record<string, any>) {\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = args.field.getDisplayValue?.() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length;\r\n    const txt: Text = args.text;\r\n    const rect: Rect = element as Rect;\r\n    const renderer = args.renderer as Renderer;\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n    let caretLine: Rect | null = null;\r\n    let selectionRect: Rect | null = null;\r\n    // @ts-ignore\r\n    txt!.style('user-select', 'none');\r\n    // @ts-ignore\r\n    rect!.style('user-select', 'none');\r\n\r\n    // Helper: measure width of text using renderer or fallback\r\n    function measureTextWidth(text: string) {\r\n\r\n        if (renderer.measureTextWidth) return renderer.measureTextWidth(text);\r\n        return text.length * 8; // rough fallback\r\n    }\r\n\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    function updateText() {\r\n        // redraw main text\r\n        txt.text(buffer);\r\n\r\n        const { start, end } = getSelectionRange();\r\n        const { width: totalWidth } = renderer.measureRawField(buffer);\r\n        const { height: rectHeight } = rect.bbox(); // actual rect height\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (rectHeight - textBBox.height) / 2; // center vertically\r\n\r\n        // --- selection highlight ---\r\n        if (hasSelection()) {\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n            const highlightX = args.startX + PADDING_X + measureTextWidth(textBeforeStart);\r\n            const highlightWidth = Math.max(measureTextWidth(textBeforeEnd) - measureTextWidth(textBeforeStart), 1);\r\n            const highlightY = offsetY; // use offsetY for vertical alignment\r\n\r\n            if (!selectionRect) {\r\n                // @ts-ignore\r\n                selectionRect = rect.parent()!.rect(highlightWidth, textBBox.height)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                selectionRect.size(highlightWidth, textBBox.height);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n        // --- caret ---\r\n        if (editing) {\r\n            const caretX = args.startX + PADDING_X + measureTextWidth(buffer.slice(0, cursorPos));\r\n            const caretH = textBBox.height;\r\n            // @ts-ignore\r\n            if (!caretLine) caretLine = rect.parent()!.rect(1, caretH).fill(renderer.constants.FIELD_RAW_TEXT_COLOR);\r\n            caretLine!.size(1, caretH).move(caretX, offsetY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n        // --- background rect ---\r\n        rect.size(Math.max(16, totalWidth + PADDING_X * 2), Math.max(rectHeight, textBBox.height + PADDING_Y * 2));\r\n        txt.move(args.startX + PADDING_X, offsetY);\r\n    }\r\n\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(); return; }\r\n        if (e.key === \"Enter\") { e.preventDefault(); stopEditing(); return; }\r\n\r\n        if (e.key === \"Backspace\") {\r\n            if (!deleteSelection() && cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            if (!deleteSelection() && cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        } else if (e.key === \"ArrowLeft\") {\r\n            if (e.shiftKey) cursorPos = Math.max(0, cursorPos - 1);\r\n            else { cursorPos = Math.max(0, cursorPos - 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            if (e.shiftKey) cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            else { cursorPos = Math.min(buffer.length, cursorPos + 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"Home\") {\r\n            if (!e.shiftKey) anchorPos = 0;\r\n            cursorPos = 0;\r\n        } else if (e.key === \"End\") {\r\n            if (!e.shiftKey) anchorPos = buffer.length;\r\n            cursorPos = buffer.length;\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        } else return;\r\n\r\n        e.preventDefault();\r\n        updateText();\r\n        args.field.setValue(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const target = ev.target as Node;\r\n        if (target !== rect.node && target !== txt.node) stopEditing();\r\n    }\r\n\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = args.field.getValue?.() ?? \"\";\r\n        cursorPos = buffer.length;\r\n        anchorPos = buffer.length;\r\n\r\n        userState.setState('typing');\r\n\r\n        if (ev) {\r\n            const rectBox = rect.node.getBoundingClientRect();\r\n            const clickX = ev.clientX - rectBox.left - PADDING_X;\r\n            let cumulativeWidth = 0;\r\n            cursorPos = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                const charWidth = measureTextWidth(buffer[i]);\r\n                if (cumulativeWidth + charWidth / 2 >= clickX) break;\r\n                cumulativeWidth += charWidth;\r\n                cursorPos = i + 1;\r\n            }\r\n        }\r\n        anchorPos = cursorPos;\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown);\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing() {\r\n        editing = false;\r\n        userState.removeState('typing');\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n        args.field.setValue(buffer);\r\n        updateText();\r\n        renderer.getWs().redraw();\r\n    }\r\n\r\n    rect.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n    txt.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", startEditing as EventListener);\r\n        txt.off(\"mousedown\", startEditing as EventListener);\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_inputbox\", initInputBox as EventSetupFn);\r\n","import WorkspaceController from \"../controllers/base\";\r\nimport unescapeAttr from \"../util/unescape-html\";\r\nimport CommentModel from \"./comment\";\r\nimport Coordinates from \"./coordinates\";\r\nimport ContextOptsRegistry from \"./ctx-menu-registry\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport Widget from \"./widget\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\nexport type Showable = 'node' | 'ws' | 'html' | 'comment';\r\nexport interface ContextMenuOpts {\r\n    click: (target: NodeSvg | WorkspaceSvg | CommentModel | HTMLElement) => void;\r\n    onHoverStart?: () => void;\r\n    onHoverEnd?: () => void;\r\n    showFor?: Showable | Showable[]\r\n    label: string;\r\n    id: string;\r\n}\r\nclass ContextMenuHTML {\r\n    workspace: WorkspaceSvg;\r\n    controller: WorkspaceController;\r\n    widget: Widget;\r\n    options: ContextMenuOpts[];\r\n\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n        this.controller = this.workspace.controller;\r\n        this.widget = new Widget(this.workspace, {\r\n            coords: new Coordinates(0, 0),\r\n            name: 'k_contextmenu',\r\n            className: 'KabelContextMenu'\r\n        });\r\n        this.widget.show = () => {\r\n            this.widget.container.classList.add('show');\r\n            this.widget.container.style.display = 'flex';\r\n            this.widget.visible = true;\r\n        };\r\n\r\n        this.widget.hide = () => {\r\n            this.widget.container.classList.remove('show');\r\n            this.widget.container.style.display = 'none';\r\n            this.widget.visible = false;\r\n        };\r\n        this.widget.container.style.removeProperty('height');\r\n        this.widget.container.style.removeProperty('width');\r\n\r\n        this.widget.hide();\r\n        this.options = ContextOptsRegistry;\r\n        this.initListeners();\r\n    }\r\n\r\n    renderOptions(target: NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null) {\r\n        // Clear any previous options\r\n        this.widget.container.innerHTML = '';\r\n\r\n        // Filter options based on showFor\r\n        const filteredOptions = this.options.filter(opt => {\r\n            if (!target) return false;\r\n            const showFor = Array.isArray(opt.showFor) ? opt.showFor : [opt.showFor];\r\n\r\n            if (target instanceof NodeSvg && showFor.includes('node')) return true;\r\n            if (target instanceof WorkspaceSvg && showFor.includes('ws')) return true;\r\n            if (target instanceof HTMLElement && !(target instanceof SVGSVGElement) && showFor.includes('html')) return true;\r\n            if (target instanceof CommentModel && showFor.includes('comment')) return true;\r\n            return false;\r\n        });\r\n\r\n        filteredOptions.forEach((opt, i) => {\r\n            const el = document.createElement('div');\r\n            el.className = 'KabelContextOption';\r\n            el.textContent = opt.label || 'Option ' + i;\r\n\r\n            el.addEventListener('click', () => {\r\n                if (target) opt.click(target);\r\n                this.hide();\r\n            });\r\n\r\n            if (opt.onHoverStart) el.addEventListener('mouseenter', () => opt.onHoverStart?.());\r\n            if (opt.onHoverEnd) el.addEventListener('mouseleave', () => opt.onHoverEnd?.());\r\n\r\n            this.widget.container.appendChild(el);\r\n        });\r\n    }\r\n\r\n    initListeners() {\r\n        // Show the menu on right-click\r\n        this.workspace.svg.node.addEventListener('contextmenu', e => {\r\n            e.preventDefault();\r\n            const mouseX = e.clientX;\r\n            const mouseY = e.clientY;\r\n\r\n            this.widget.setCoords(new Coordinates(mouseX, mouseY));\r\n            this.renderOptions(this.target);\r\n            this.widget.show();\r\n        });\r\n\r\n        // Hide menu on click elsewhere\r\n        document.addEventListener('mousedown', e => {\r\n            if (!this.widget.container.contains(e.target as Node)) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    hide() {\r\n        this.widget.hide();\r\n    }\r\n\r\n    get mousePos(): { x: number, y: number } {\r\n        return this.controller.mousePos;\r\n    }\r\n\r\n    get target(): NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null {\r\n        let el = document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n\r\n        if ((el as unknown as SVGSVGElement) === this.workspace.svg.node) return this.workspace;\r\n\r\n        while (el && el !== document.body) {\r\n            // Node check\r\n            if (el.tagName.toLowerCase() === 'g' && el.hasAttribute('data-node-id')) {\r\n                const nodeId = unescapeAttr(el.getAttribute('data-node-id') as string);\r\n                const node = this.workspace.getNode(nodeId);\r\n                if (node) return node;\r\n            }\r\n            if (el.tagName.toLowerCase() === 'g' && el.hasAttribute('comment-data')) {\r\n                const dta = JSON.parse(el.getAttribute('comment-data') as string);\r\n                if (!dta.id && !dta.isws) {\r\n                    continue;\r\n                }\r\n                if (dta.isws) {\r\n                    for (let comment of this.workspace._commentDB) {\r\n                        if (comment.id === dta.id) {\r\n                            return comment;\r\n                        }\r\n                    }\r\n                } else {\r\n                    for (let [_, node] of this.workspace._nodeDB) {\r\n                        if (node.comment && node.comment.id == dta.id) {\r\n                            return node.comment;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            el = el.parentElement;\r\n        }\r\n\r\n        // fallback\r\n        return document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n    }\r\n}\r\n\r\nexport default ContextMenuHTML;","/*!\n* @svgdotjs/svg.js - A lightweight library for manipulating and animating SVG.\n* @version 3.2.4\n* https://svgjs.dev/\n*\n* @copyright Wout Fierens <wout@mick-wout.com>\n* @license MIT\n*\n* BUILT: Thu Jun 27 2024 12:00:16 GMT+0200 (Central European Summer Time)\n*/;\n'use strict';\n\nconst methods$1 = {};\nconst names = [];\nfunction registerMethods(name, m) {\n  if (Array.isArray(name)) {\n    for (const _name of name) {\n      registerMethods(_name, m);\n    }\n    return;\n  }\n  if (typeof name === 'object') {\n    for (const _name in name) {\n      registerMethods(_name, name[_name]);\n    }\n    return;\n  }\n  addMethodNames(Object.getOwnPropertyNames(m));\n  methods$1[name] = Object.assign(methods$1[name] || {}, m);\n}\nfunction getMethodsFor(name) {\n  return methods$1[name] || {};\n}\nfunction getMethodNames() {\n  return [...new Set(names)];\n}\nfunction addMethodNames(_names) {\n  names.push(..._names);\n}\n\n// Map function\nfunction map(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    result.push(block(array[i]));\n  }\n  return result;\n}\n\n// Filter function\nfunction filter(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    if (block(array[i])) {\n      result.push(array[i]);\n    }\n  }\n  return result;\n}\n\n// Degrees to radians\nfunction radians(d) {\n  return d % 360 * Math.PI / 180;\n}\n\n// Radians to degrees\nfunction degrees(r) {\n  return r * 180 / Math.PI % 360;\n}\n\n// Convert camel cased string to dash separated\nfunction unCamelCase(s) {\n  return s.replace(/([A-Z])/g, function (m, g) {\n    return '-' + g.toLowerCase();\n  });\n}\n\n// Capitalize first letter of a string\nfunction capitalize(s) {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\n// Calculate proportional width and height values when necessary\nfunction proportionalSize(element, width, height, box) {\n  if (width == null || height == null) {\n    box = box || element.bbox();\n    if (width == null) {\n      width = box.width / box.height * height;\n    } else if (height == null) {\n      height = box.height / box.width * width;\n    }\n  }\n  return {\n    width: width,\n    height: height\n  };\n}\n\n/**\n * This function adds support for string origins.\n * It searches for an origin in o.origin o.ox and o.originX.\n * This way, origin: {x: 'center', y: 50} can be passed as well as ox: 'center', oy: 50\n **/\nfunction getOrigin(o, element) {\n  const origin = o.origin;\n  // First check if origin is in ox or originX\n  let ox = o.ox != null ? o.ox : o.originX != null ? o.originX : 'center';\n  let oy = o.oy != null ? o.oy : o.originY != null ? o.originY : 'center';\n\n  // Then check if origin was used and overwrite in that case\n  if (origin != null) {\n    [ox, oy] = Array.isArray(origin) ? origin : typeof origin === 'object' ? [origin.x, origin.y] : [origin, origin];\n  }\n\n  // Make sure to only call bbox when actually needed\n  const condX = typeof ox === 'string';\n  const condY = typeof oy === 'string';\n  if (condX || condY) {\n    const {\n      height,\n      width,\n      x,\n      y\n    } = element.bbox();\n\n    // And only overwrite if string was passed for this specific axis\n    if (condX) {\n      ox = ox.includes('left') ? x : ox.includes('right') ? x + width : x + width / 2;\n    }\n    if (condY) {\n      oy = oy.includes('top') ? y : oy.includes('bottom') ? y + height : y + height / 2;\n    }\n  }\n\n  // Return the origin as it is if it wasn't a string\n  return [ox, oy];\n}\nconst descriptiveElements = new Set(['desc', 'metadata', 'title']);\nconst isDescriptive = element => descriptiveElements.has(element.nodeName);\nconst writeDataToDom = (element, data, defaults = {}) => {\n  const cloned = {\n    ...data\n  };\n  for (const key in cloned) {\n    if (cloned[key].valueOf() === defaults[key]) {\n      delete cloned[key];\n    }\n  }\n  if (Object.keys(cloned).length) {\n    element.node.setAttribute('data-svgjs', JSON.stringify(cloned)); // see #428\n  } else {\n    element.node.removeAttribute('data-svgjs');\n    element.node.removeAttribute('svgjs:data');\n  }\n};\n\nvar utils = {\n  __proto__: null,\n  capitalize: capitalize,\n  degrees: degrees,\n  filter: filter,\n  getOrigin: getOrigin,\n  isDescriptive: isDescriptive,\n  map: map,\n  proportionalSize: proportionalSize,\n  radians: radians,\n  unCamelCase: unCamelCase,\n  writeDataToDom: writeDataToDom\n};\n\n// Default namespaces\nconst svg = 'http://www.w3.org/2000/svg';\nconst html = 'http://www.w3.org/1999/xhtml';\nconst xmlns = 'http://www.w3.org/2000/xmlns/';\nconst xlink = 'http://www.w3.org/1999/xlink';\n\nvar namespaces = {\n  __proto__: null,\n  html: html,\n  svg: svg,\n  xlink: xlink,\n  xmlns: xmlns\n};\n\nconst globals = {\n  window: typeof window === 'undefined' ? null : window,\n  document: typeof document === 'undefined' ? null : document\n};\nfunction registerWindow(win = null, doc = null) {\n  globals.window = win;\n  globals.document = doc;\n}\nconst save = {};\nfunction saveWindow() {\n  save.window = globals.window;\n  save.document = globals.document;\n}\nfunction restoreWindow() {\n  globals.window = save.window;\n  globals.document = save.document;\n}\nfunction withWindow(win, fn) {\n  saveWindow();\n  registerWindow(win, win.document);\n  fn(win, win.document);\n  restoreWindow();\n}\nfunction getWindow() {\n  return globals.window;\n}\n\nclass Base {\n  // constructor (node/*, {extensions = []} */) {\n  //   // this.tags = []\n  //   //\n  //   // for (let extension of extensions) {\n  //   //   extension.setup.call(this, node)\n  //   //   this.tags.push(extension.name)\n  //   // }\n  // }\n}\n\nconst elements = {};\nconst root = '___SYMBOL___ROOT___';\n\n// Method for element creation\nfunction create(name, ns = svg) {\n  // create element\n  return globals.document.createElementNS(ns, name);\n}\nfunction makeInstance(element, isHTML = false) {\n  if (element instanceof Base) return element;\n  if (typeof element === 'object') {\n    return adopter(element);\n  }\n  if (element == null) {\n    return new elements[root]();\n  }\n  if (typeof element === 'string' && element.charAt(0) !== '<') {\n    return adopter(globals.document.querySelector(element));\n  }\n\n  // Make sure, that HTML elements are created with the correct namespace\n  const wrapper = isHTML ? globals.document.createElement('div') : create('svg');\n  wrapper.innerHTML = element;\n\n  // We can use firstChild here because we know,\n  // that the first char is < and thus an element\n  element = adopter(wrapper.firstChild);\n\n  // make sure, that element doesn't have its wrapper attached\n  wrapper.removeChild(wrapper.firstChild);\n  return element;\n}\nfunction nodeOrNew(name, node) {\n  return node && (node instanceof globals.window.Node || node.ownerDocument && node instanceof node.ownerDocument.defaultView.Node) ? node : create(name);\n}\n\n// Adopt existing svg elements\nfunction adopt(node) {\n  // check for presence of node\n  if (!node) return null;\n\n  // make sure a node isn't already adopted\n  if (node.instance instanceof Base) return node.instance;\n  if (node.nodeName === '#document-fragment') {\n    return new elements.Fragment(node);\n  }\n\n  // initialize variables\n  let className = capitalize(node.nodeName || 'Dom');\n\n  // Make sure that gradients are adopted correctly\n  if (className === 'LinearGradient' || className === 'RadialGradient') {\n    className = 'Gradient';\n\n    // Fallback to Dom if element is not known\n  } else if (!elements[className]) {\n    className = 'Dom';\n  }\n  return new elements[className](node);\n}\nlet adopter = adopt;\nfunction mockAdopt(mock = adopt) {\n  adopter = mock;\n}\nfunction register(element, name = element.name, asRoot = false) {\n  elements[name] = element;\n  if (asRoot) elements[root] = element;\n  addMethodNames(Object.getOwnPropertyNames(element.prototype));\n  return element;\n}\nfunction getClass(name) {\n  return elements[name];\n}\n\n// Element id sequence\nlet did = 1000;\n\n// Get next named element id\nfunction eid(name) {\n  return 'Svgjs' + capitalize(name) + did++;\n}\n\n// Deep new id assignment\nfunction assignNewId(node) {\n  // do the same for SVG child nodes as well\n  for (let i = node.children.length - 1; i >= 0; i--) {\n    assignNewId(node.children[i]);\n  }\n  if (node.id) {\n    node.id = eid(node.nodeName);\n    return node;\n  }\n  return node;\n}\n\n// Method for extending objects\nfunction extend(modules, methods) {\n  let key, i;\n  modules = Array.isArray(modules) ? modules : [modules];\n  for (i = modules.length - 1; i >= 0; i--) {\n    for (key in methods) {\n      modules[i].prototype[key] = methods[key];\n    }\n  }\n}\nfunction wrapWithAttrCheck(fn) {\n  return function (...args) {\n    const o = args[args.length - 1];\n    if (o && o.constructor === Object && !(o instanceof Array)) {\n      return fn.apply(this, args.slice(0, -1)).attr(o);\n    } else {\n      return fn.apply(this, args);\n    }\n  };\n}\n\n// Get all siblings, including myself\nfunction siblings() {\n  return this.parent().children();\n}\n\n// Get the current position siblings\nfunction position() {\n  return this.parent().index(this);\n}\n\n// Get the next element (will return null if there is none)\nfunction next() {\n  return this.siblings()[this.position() + 1];\n}\n\n// Get the next element (will return null if there is none)\nfunction prev() {\n  return this.siblings()[this.position() - 1];\n}\n\n// Send given element one step forward\nfunction forward() {\n  const i = this.position();\n  const p = this.parent();\n\n  // move node one step forward\n  p.add(this.remove(), i + 1);\n  return this;\n}\n\n// Send given element one step backward\nfunction backward() {\n  const i = this.position();\n  const p = this.parent();\n  p.add(this.remove(), i ? i - 1 : 0);\n  return this;\n}\n\n// Send given element all the way to the front\nfunction front() {\n  const p = this.parent();\n\n  // Move node forward\n  p.add(this.remove());\n  return this;\n}\n\n// Send given element all the way to the back\nfunction back() {\n  const p = this.parent();\n\n  // Move node back\n  p.add(this.remove(), 0);\n  return this;\n}\n\n// Inserts a given element before the targeted element\nfunction before(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i);\n  return this;\n}\n\n// Inserts a given element after the targeted element\nfunction after(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i + 1);\n  return this;\n}\nfunction insertBefore(element) {\n  element = makeInstance(element);\n  element.before(this);\n  return this;\n}\nfunction insertAfter(element) {\n  element = makeInstance(element);\n  element.after(this);\n  return this;\n}\nregisterMethods('Dom', {\n  siblings,\n  position,\n  next,\n  prev,\n  forward,\n  backward,\n  front,\n  back,\n  before,\n  after,\n  insertBefore,\n  insertAfter\n});\n\n// Parse unit value\nconst numberAndUnit = /^([+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?)([a-z%]*)$/i;\n\n// Parse hex value\nconst hex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\n\n// Parse rgb value\nconst rgb = /rgb\\((\\d+),(\\d+),(\\d+)\\)/;\n\n// Parse reference id\nconst reference = /(#[a-z_][a-z0-9\\-_]*)/i;\n\n// splits a transformation chain\nconst transforms = /\\)\\s*,?\\s*/;\n\n// Whitespace\nconst whitespace = /\\s/g;\n\n// Test hex value\nconst isHex = /^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i;\n\n// Test rgb value\nconst isRgb = /^rgb\\(/;\n\n// Test for blank string\nconst isBlank = /^(\\s+)?$/;\n\n// Test for numeric string\nconst isNumber = /^[+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n// Test for image url\nconst isImage = /\\.(jpg|jpeg|png|gif|svg)(\\?[^=]+.*)?/i;\n\n// split at whitespace and comma\nconst delimiter = /[\\s,]+/;\n\n// Test for path letter\nconst isPathLetter = /[MLHVCSQTAZ]/i;\n\nvar regex = {\n  __proto__: null,\n  delimiter: delimiter,\n  hex: hex,\n  isBlank: isBlank,\n  isHex: isHex,\n  isImage: isImage,\n  isNumber: isNumber,\n  isPathLetter: isPathLetter,\n  isRgb: isRgb,\n  numberAndUnit: numberAndUnit,\n  reference: reference,\n  rgb: rgb,\n  transforms: transforms,\n  whitespace: whitespace\n};\n\n// Return array of classes on the node\nfunction classes() {\n  const attr = this.attr('class');\n  return attr == null ? [] : attr.trim().split(delimiter);\n}\n\n// Return true if class exists on the node, false otherwise\nfunction hasClass(name) {\n  return this.classes().indexOf(name) !== -1;\n}\n\n// Add class to the node\nfunction addClass(name) {\n  if (!this.hasClass(name)) {\n    const array = this.classes();\n    array.push(name);\n    this.attr('class', array.join(' '));\n  }\n  return this;\n}\n\n// Remove class from the node\nfunction removeClass(name) {\n  if (this.hasClass(name)) {\n    this.attr('class', this.classes().filter(function (c) {\n      return c !== name;\n    }).join(' '));\n  }\n  return this;\n}\n\n// Toggle the presence of a class on the node\nfunction toggleClass(name) {\n  return this.hasClass(name) ? this.removeClass(name) : this.addClass(name);\n}\nregisterMethods('Dom', {\n  classes,\n  hasClass,\n  addClass,\n  removeClass,\n  toggleClass\n});\n\n// Dynamic style generator\nfunction css(style, val) {\n  const ret = {};\n  if (arguments.length === 0) {\n    // get full style as object\n    this.node.style.cssText.split(/\\s*;\\s*/).filter(function (el) {\n      return !!el.length;\n    }).forEach(function (el) {\n      const t = el.split(/\\s*:\\s*/);\n      ret[t[0]] = t[1];\n    });\n    return ret;\n  }\n  if (arguments.length < 2) {\n    // get style properties as array\n    if (Array.isArray(style)) {\n      for (const name of style) {\n        const cased = name;\n        ret[name] = this.node.style.getPropertyValue(cased);\n      }\n      return ret;\n    }\n\n    // get style for property\n    if (typeof style === 'string') {\n      return this.node.style.getPropertyValue(style);\n    }\n\n    // set styles in object\n    if (typeof style === 'object') {\n      for (const name in style) {\n        // set empty string if null/undefined/'' was given\n        this.node.style.setProperty(name, style[name] == null || isBlank.test(style[name]) ? '' : style[name]);\n      }\n    }\n  }\n\n  // set style for property\n  if (arguments.length === 2) {\n    this.node.style.setProperty(style, val == null || isBlank.test(val) ? '' : val);\n  }\n  return this;\n}\n\n// Show element\nfunction show() {\n  return this.css('display', '');\n}\n\n// Hide element\nfunction hide() {\n  return this.css('display', 'none');\n}\n\n// Is element visible?\nfunction visible() {\n  return this.css('display') !== 'none';\n}\nregisterMethods('Dom', {\n  css,\n  show,\n  hide,\n  visible\n});\n\n// Store data values on svg nodes\nfunction data(a, v, r) {\n  if (a == null) {\n    // get an object of attributes\n    return this.data(map(filter(this.node.attributes, el => el.nodeName.indexOf('data-') === 0), el => el.nodeName.slice(5)));\n  } else if (a instanceof Array) {\n    const data = {};\n    for (const key of a) {\n      data[key] = this.data(key);\n    }\n    return data;\n  } else if (typeof a === 'object') {\n    for (v in a) {\n      this.data(v, a[v]);\n    }\n  } else if (arguments.length < 2) {\n    try {\n      return JSON.parse(this.attr('data-' + a));\n    } catch (e) {\n      return this.attr('data-' + a);\n    }\n  } else {\n    this.attr('data-' + a, v === null ? null : r === true || typeof v === 'string' || typeof v === 'number' ? v : JSON.stringify(v));\n  }\n  return this;\n}\nregisterMethods('Dom', {\n  data\n});\n\n// Remember arbitrary data\nfunction remember(k, v) {\n  // remember every item in an object individually\n  if (typeof arguments[0] === 'object') {\n    for (const key in k) {\n      this.remember(key, k[key]);\n    }\n  } else if (arguments.length === 1) {\n    // retrieve memory\n    return this.memory()[k];\n  } else {\n    // store memory\n    this.memory()[k] = v;\n  }\n  return this;\n}\n\n// Erase a given memory\nfunction forget() {\n  if (arguments.length === 0) {\n    this._memory = {};\n  } else {\n    for (let i = arguments.length - 1; i >= 0; i--) {\n      delete this.memory()[arguments[i]];\n    }\n  }\n  return this;\n}\n\n// This triggers creation of a new hidden class which is not performant\n// However, this function is not rarely used so it will not happen frequently\n// Return local memory object\nfunction memory() {\n  return this._memory = this._memory || {};\n}\nregisterMethods('Dom', {\n  remember,\n  forget,\n  memory\n});\n\nfunction sixDigitHex(hex) {\n  return hex.length === 4 ? ['#', hex.substring(1, 2), hex.substring(1, 2), hex.substring(2, 3), hex.substring(2, 3), hex.substring(3, 4), hex.substring(3, 4)].join('') : hex;\n}\nfunction componentHex(component) {\n  const integer = Math.round(component);\n  const bounded = Math.max(0, Math.min(255, integer));\n  const hex = bounded.toString(16);\n  return hex.length === 1 ? '0' + hex : hex;\n}\nfunction is(object, space) {\n  for (let i = space.length; i--;) {\n    if (object[space[i]] == null) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction getParameters(a, b) {\n  const params = is(a, 'rgb') ? {\n    _a: a.r,\n    _b: a.g,\n    _c: a.b,\n    _d: 0,\n    space: 'rgb'\n  } : is(a, 'xyz') ? {\n    _a: a.x,\n    _b: a.y,\n    _c: a.z,\n    _d: 0,\n    space: 'xyz'\n  } : is(a, 'hsl') ? {\n    _a: a.h,\n    _b: a.s,\n    _c: a.l,\n    _d: 0,\n    space: 'hsl'\n  } : is(a, 'lab') ? {\n    _a: a.l,\n    _b: a.a,\n    _c: a.b,\n    _d: 0,\n    space: 'lab'\n  } : is(a, 'lch') ? {\n    _a: a.l,\n    _b: a.c,\n    _c: a.h,\n    _d: 0,\n    space: 'lch'\n  } : is(a, 'cmyk') ? {\n    _a: a.c,\n    _b: a.m,\n    _c: a.y,\n    _d: a.k,\n    space: 'cmyk'\n  } : {\n    _a: 0,\n    _b: 0,\n    _c: 0,\n    space: 'rgb'\n  };\n  params.space = b || params.space;\n  return params;\n}\nfunction cieSpace(space) {\n  if (space === 'lab' || space === 'xyz' || space === 'lch') {\n    return true;\n  } else {\n    return false;\n  }\n}\nfunction hueToRgb(p, q, t) {\n  if (t < 0) t += 1;\n  if (t > 1) t -= 1;\n  if (t < 1 / 6) return p + (q - p) * 6 * t;\n  if (t < 1 / 2) return q;\n  if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n  return p;\n}\nclass Color {\n  constructor(...inputs) {\n    this.init(...inputs);\n  }\n\n  // Test if given value is a color\n  static isColor(color) {\n    return color && (color instanceof Color || this.isRgb(color) || this.test(color));\n  }\n\n  // Test if given value is an rgb object\n  static isRgb(color) {\n    return color && typeof color.r === 'number' && typeof color.g === 'number' && typeof color.b === 'number';\n  }\n\n  /*\n  Generating random colors\n  */\n  static random(mode = 'vibrant', t) {\n    // Get the math modules\n    const {\n      random,\n      round,\n      sin,\n      PI: pi\n    } = Math;\n\n    // Run the correct generator\n    if (mode === 'vibrant') {\n      const l = (81 - 57) * random() + 57;\n      const c = (83 - 45) * random() + 45;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'sine') {\n      t = t == null ? random() : t;\n      const r = round(80 * sin(2 * pi * t / 0.5 + 0.01) + 150);\n      const g = round(50 * sin(2 * pi * t / 0.5 + 4.6) + 200);\n      const b = round(100 * sin(2 * pi * t / 0.5 + 2.3) + 150);\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'pastel') {\n      const l = (94 - 86) * random() + 86;\n      const c = (26 - 9) * random() + 9;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'dark') {\n      const l = 10 + 10 * random();\n      const c = (125 - 75) * random() + 86;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'rgb') {\n      const r = 255 * random();\n      const g = 255 * random();\n      const b = 255 * random();\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'lab') {\n      const l = 100 * random();\n      const a = 256 * random() - 128;\n      const b = 256 * random() - 128;\n      const color = new Color(l, a, b, 'lab');\n      return color;\n    } else if (mode === 'grey') {\n      const grey = 255 * random();\n      const color = new Color(grey, grey, grey);\n      return color;\n    } else {\n      throw new Error('Unsupported random color mode');\n    }\n  }\n\n  // Test if given value is a color string\n  static test(color) {\n    return typeof color === 'string' && (isHex.test(color) || isRgb.test(color));\n  }\n  cmyk() {\n    // Get the rgb values for the current color\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Get the cmyk values in an unbounded format\n    const k = Math.min(1 - r, 1 - g, 1 - b);\n    if (k === 1) {\n      // Catch the black case\n      return new Color(0, 0, 0, 1, 'cmyk');\n    }\n    const c = (1 - r - k) / (1 - k);\n    const m = (1 - g - k) / (1 - k);\n    const y = (1 - b - k) / (1 - k);\n\n    // Construct the new color\n    const color = new Color(c, m, y, k, 'cmyk');\n    return color;\n  }\n  hsl() {\n    // Get the rgb values\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Find the maximum and minimum values to get the lightness\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    const l = (max + min) / 2;\n\n    // If the r, g, v values are identical then we are grey\n    const isGrey = max === min;\n\n    // Calculate the hue and saturation\n    const delta = max - min;\n    const s = isGrey ? 0 : l > 0.5 ? delta / (2 - max - min) : delta / (max + min);\n    const h = isGrey ? 0 : max === r ? ((g - b) / delta + (g < b ? 6 : 0)) / 6 : max === g ? ((b - r) / delta + 2) / 6 : max === b ? ((r - g) / delta + 4) / 6 : 0;\n\n    // Construct and return the new color\n    const color = new Color(360 * h, 100 * s, 100 * l, 'hsl');\n    return color;\n  }\n  init(a = 0, b = 0, c = 0, d = 0, space = 'rgb') {\n    // This catches the case when a falsy value is passed like ''\n    a = !a ? 0 : a;\n\n    // Reset all values in case the init function is rerun with new color space\n    if (this.space) {\n      for (const component in this.space) {\n        delete this[this.space[component]];\n      }\n    }\n    if (typeof a === 'number') {\n      // Allow for the case that we don't need d...\n      space = typeof d === 'string' ? d : space;\n      d = typeof d === 'string' ? 0 : d;\n\n      // Assign the values straight to the color\n      Object.assign(this, {\n        _a: a,\n        _b: b,\n        _c: c,\n        _d: d,\n        space\n      });\n      // If the user gave us an array, make the color from it\n    } else if (a instanceof Array) {\n      this.space = b || (typeof a[3] === 'string' ? a[3] : a[4]) || 'rgb';\n      Object.assign(this, {\n        _a: a[0],\n        _b: a[1],\n        _c: a[2],\n        _d: a[3] || 0\n      });\n    } else if (a instanceof Object) {\n      // Set the object up and assign its values directly\n      const values = getParameters(a, b);\n      Object.assign(this, values);\n    } else if (typeof a === 'string') {\n      if (isRgb.test(a)) {\n        const noWhitespace = a.replace(whitespace, '');\n        const [_a, _b, _c] = rgb.exec(noWhitespace).slice(1, 4).map(v => parseInt(v));\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else if (isHex.test(a)) {\n        const hexParse = v => parseInt(v, 16);\n        const [, _a, _b, _c] = hex.exec(sixDigitHex(a)).map(hexParse);\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else throw Error(\"Unsupported string format, can't construct Color\");\n    }\n\n    // Now add the components as a convenience\n    const {\n      _a,\n      _b,\n      _c,\n      _d\n    } = this;\n    const components = this.space === 'rgb' ? {\n      r: _a,\n      g: _b,\n      b: _c\n    } : this.space === 'xyz' ? {\n      x: _a,\n      y: _b,\n      z: _c\n    } : this.space === 'hsl' ? {\n      h: _a,\n      s: _b,\n      l: _c\n    } : this.space === 'lab' ? {\n      l: _a,\n      a: _b,\n      b: _c\n    } : this.space === 'lch' ? {\n      l: _a,\n      c: _b,\n      h: _c\n    } : this.space === 'cmyk' ? {\n      c: _a,\n      m: _b,\n      y: _c,\n      k: _d\n    } : {};\n    Object.assign(this, components);\n  }\n  lab() {\n    // Get the xyz color\n    const {\n      x,\n      y,\n      z\n    } = this.xyz();\n\n    // Get the lab components\n    const l = 116 * y - 16;\n    const a = 500 * (x - y);\n    const b = 200 * (y - z);\n\n    // Construct and return a new color\n    const color = new Color(l, a, b, 'lab');\n    return color;\n  }\n  lch() {\n    // Get the lab color directly\n    const {\n      l,\n      a,\n      b\n    } = this.lab();\n\n    // Get the chromaticity and the hue using polar coordinates\n    const c = Math.sqrt(a ** 2 + b ** 2);\n    let h = 180 * Math.atan2(b, a) / Math.PI;\n    if (h < 0) {\n      h *= -1;\n      h = 360 - h;\n    }\n\n    // Make a new color and return it\n    const color = new Color(l, c, h, 'lch');\n    return color;\n  }\n  /*\n  Conversion Methods\n  */\n\n  rgb() {\n    if (this.space === 'rgb') {\n      return this;\n    } else if (cieSpace(this.space)) {\n      // Convert to the xyz color space\n      let {\n        x,\n        y,\n        z\n      } = this;\n      if (this.space === 'lab' || this.space === 'lch') {\n        // Get the values in the lab space\n        let {\n          l,\n          a,\n          b\n        } = this;\n        if (this.space === 'lch') {\n          const {\n            c,\n            h\n          } = this;\n          const dToR = Math.PI / 180;\n          a = c * Math.cos(dToR * h);\n          b = c * Math.sin(dToR * h);\n        }\n\n        // Undo the nonlinear function\n        const yL = (l + 16) / 116;\n        const xL = a / 500 + yL;\n        const zL = yL - b / 200;\n\n        // Get the xyz values\n        const ct = 16 / 116;\n        const mx = 0.008856;\n        const nm = 7.787;\n        x = 0.95047 * (xL ** 3 > mx ? xL ** 3 : (xL - ct) / nm);\n        y = 1.0 * (yL ** 3 > mx ? yL ** 3 : (yL - ct) / nm);\n        z = 1.08883 * (zL ** 3 > mx ? zL ** 3 : (zL - ct) / nm);\n      }\n\n      // Convert xyz to unbounded rgb values\n      const rU = x * 3.2406 + y * -1.5372 + z * -0.4986;\n      const gU = x * -0.9689 + y * 1.8758 + z * 0.0415;\n      const bU = x * 0.0557 + y * -0.204 + z * 1.057;\n\n      // Convert the values to true rgb values\n      const pow = Math.pow;\n      const bd = 0.0031308;\n      const r = rU > bd ? 1.055 * pow(rU, 1 / 2.4) - 0.055 : 12.92 * rU;\n      const g = gU > bd ? 1.055 * pow(gU, 1 / 2.4) - 0.055 : 12.92 * gU;\n      const b = bU > bd ? 1.055 * pow(bU, 1 / 2.4) - 0.055 : 12.92 * bU;\n\n      // Make and return the color\n      const color = new Color(255 * r, 255 * g, 255 * b);\n      return color;\n    } else if (this.space === 'hsl') {\n      // https://bgrins.github.io/TinyColor/docs/tinycolor.html\n      // Get the current hsl values\n      let {\n        h,\n        s,\n        l\n      } = this;\n      h /= 360;\n      s /= 100;\n      l /= 100;\n\n      // If we are grey, then just make the color directly\n      if (s === 0) {\n        l *= 255;\n        const color = new Color(l, l, l);\n        return color;\n      }\n\n      // TODO I have no idea what this does :D If you figure it out, tell me!\n      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      const p = 2 * l - q;\n\n      // Get the rgb values\n      const r = 255 * hueToRgb(p, q, h + 1 / 3);\n      const g = 255 * hueToRgb(p, q, h);\n      const b = 255 * hueToRgb(p, q, h - 1 / 3);\n\n      // Make a new color\n      const color = new Color(r, g, b);\n      return color;\n    } else if (this.space === 'cmyk') {\n      // https://gist.github.com/felipesabino/5066336\n      // Get the normalised cmyk values\n      const {\n        c,\n        m,\n        y,\n        k\n      } = this;\n\n      // Get the rgb values\n      const r = 255 * (1 - Math.min(1, c * (1 - k) + k));\n      const g = 255 * (1 - Math.min(1, m * (1 - k) + k));\n      const b = 255 * (1 - Math.min(1, y * (1 - k) + k));\n\n      // Form the color and return it\n      const color = new Color(r, g, b);\n      return color;\n    } else {\n      return this;\n    }\n  }\n  toArray() {\n    const {\n      _a,\n      _b,\n      _c,\n      _d,\n      space\n    } = this;\n    return [_a, _b, _c, _d, space];\n  }\n  toHex() {\n    const [r, g, b] = this._clamped().map(componentHex);\n    return `#${r}${g}${b}`;\n  }\n  toRgb() {\n    const [rV, gV, bV] = this._clamped();\n    const string = `rgb(${rV},${gV},${bV})`;\n    return string;\n  }\n  toString() {\n    return this.toHex();\n  }\n  xyz() {\n    // Normalise the red, green and blue values\n    const {\n      _a: r255,\n      _b: g255,\n      _c: b255\n    } = this.rgb();\n    const [r, g, b] = [r255, g255, b255].map(v => v / 255);\n\n    // Convert to the lab rgb space\n    const rL = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\n    const gL = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\n    const bL = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\n\n    // Convert to the xyz color space without bounding the values\n    const xU = (rL * 0.4124 + gL * 0.3576 + bL * 0.1805) / 0.95047;\n    const yU = (rL * 0.2126 + gL * 0.7152 + bL * 0.0722) / 1.0;\n    const zU = (rL * 0.0193 + gL * 0.1192 + bL * 0.9505) / 1.08883;\n\n    // Get the proper xyz values by applying the bounding\n    const x = xU > 0.008856 ? Math.pow(xU, 1 / 3) : 7.787 * xU + 16 / 116;\n    const y = yU > 0.008856 ? Math.pow(yU, 1 / 3) : 7.787 * yU + 16 / 116;\n    const z = zU > 0.008856 ? Math.pow(zU, 1 / 3) : 7.787 * zU + 16 / 116;\n\n    // Make and return the color\n    const color = new Color(x, y, z, 'xyz');\n    return color;\n  }\n\n  /*\n  Input and Output methods\n  */\n\n  _clamped() {\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const {\n      max,\n      min,\n      round\n    } = Math;\n    const format = v => max(0, min(round(v), 255));\n    return [_a, _b, _c].map(format);\n  }\n\n  /*\n  Constructing colors\n  */\n}\n\nclass Point {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n\n  // Clone point\n  clone() {\n    return new Point(this);\n  }\n  init(x, y) {\n    const base = {\n      x: 0,\n      y: 0\n    };\n\n    // ensure source as object\n    const source = Array.isArray(x) ? {\n      x: x[0],\n      y: x[1]\n    } : typeof x === 'object' ? {\n      x: x.x,\n      y: x.y\n    } : {\n      x: x,\n      y: y\n    };\n\n    // merge source\n    this.x = source.x == null ? base.x : source.x;\n    this.y = source.y == null ? base.y : source.y;\n    return this;\n  }\n  toArray() {\n    return [this.x, this.y];\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // Transform point with matrix\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    const {\n      x,\n      y\n    } = this;\n\n    // Perform the matrix multiplication\n    this.x = m.a * x + m.c * y + m.e;\n    this.y = m.b * x + m.d * y + m.f;\n    return this;\n  }\n}\nfunction point(x, y) {\n  return new Point(x, y).transformO(this.screenCTM().inverseO());\n}\n\nfunction closeEnough(a, b, threshold) {\n  return Math.abs(b - a) < (1e-6);\n}\nclass Matrix {\n  constructor(...args) {\n    this.init(...args);\n  }\n  static formatTransforms(o) {\n    // Get all of the parameters required to form the matrix\n    const flipBoth = o.flip === 'both' || o.flip === true;\n    const flipX = o.flip && (flipBoth || o.flip === 'x') ? -1 : 1;\n    const flipY = o.flip && (flipBoth || o.flip === 'y') ? -1 : 1;\n    const skewX = o.skew && o.skew.length ? o.skew[0] : isFinite(o.skew) ? o.skew : isFinite(o.skewX) ? o.skewX : 0;\n    const skewY = o.skew && o.skew.length ? o.skew[1] : isFinite(o.skew) ? o.skew : isFinite(o.skewY) ? o.skewY : 0;\n    const scaleX = o.scale && o.scale.length ? o.scale[0] * flipX : isFinite(o.scale) ? o.scale * flipX : isFinite(o.scaleX) ? o.scaleX * flipX : flipX;\n    const scaleY = o.scale && o.scale.length ? o.scale[1] * flipY : isFinite(o.scale) ? o.scale * flipY : isFinite(o.scaleY) ? o.scaleY * flipY : flipY;\n    const shear = o.shear || 0;\n    const theta = o.rotate || o.theta || 0;\n    const origin = new Point(o.origin || o.around || o.ox || o.originX, o.oy || o.originY);\n    const ox = origin.x;\n    const oy = origin.y;\n    // We need Point to be invalid if nothing was passed because we cannot default to 0 here. That is why NaN\n    const position = new Point(o.position || o.px || o.positionX || NaN, o.py || o.positionY || NaN);\n    const px = position.x;\n    const py = position.y;\n    const translate = new Point(o.translate || o.tx || o.translateX, o.ty || o.translateY);\n    const tx = translate.x;\n    const ty = translate.y;\n    const relative = new Point(o.relative || o.rx || o.relativeX, o.ry || o.relativeY);\n    const rx = relative.x;\n    const ry = relative.y;\n\n    // Populate all of the values\n    return {\n      scaleX,\n      scaleY,\n      skewX,\n      skewY,\n      shear,\n      theta,\n      rx,\n      ry,\n      tx,\n      ty,\n      ox,\n      oy,\n      px,\n      py\n    };\n  }\n  static fromArray(a) {\n    return {\n      a: a[0],\n      b: a[1],\n      c: a[2],\n      d: a[3],\n      e: a[4],\n      f: a[5]\n    };\n  }\n  static isMatrixLike(o) {\n    return o.a != null || o.b != null || o.c != null || o.d != null || o.e != null || o.f != null;\n  }\n\n  // left matrix, right matrix, target matrix which is overwritten\n  static matrixMultiply(l, r, o) {\n    // Work out the product directly\n    const a = l.a * r.a + l.c * r.b;\n    const b = l.b * r.a + l.d * r.b;\n    const c = l.a * r.c + l.c * r.d;\n    const d = l.b * r.c + l.d * r.d;\n    const e = l.e + l.a * r.e + l.c * r.f;\n    const f = l.f + l.b * r.e + l.d * r.f;\n\n    // make sure to use local variables because l/r and o could be the same\n    o.a = a;\n    o.b = b;\n    o.c = c;\n    o.d = d;\n    o.e = e;\n    o.f = f;\n    return o;\n  }\n  around(cx, cy, matrix) {\n    return this.clone().aroundO(cx, cy, matrix);\n  }\n\n  // Transform around a center point\n  aroundO(cx, cy, matrix) {\n    const dx = cx || 0;\n    const dy = cy || 0;\n    return this.translateO(-dx, -dy).lmultiplyO(matrix).translateO(dx, dy);\n  }\n\n  // Clones this matrix\n  clone() {\n    return new Matrix(this);\n  }\n\n  // Decomposes this matrix into its affine parameters\n  decompose(cx = 0, cy = 0) {\n    // Get the parameters from the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Figure out if the winding direction is clockwise or counterclockwise\n    const determinant = a * d - b * c;\n    const ccw = determinant > 0 ? 1 : -1;\n\n    // Since we only shear in x, we can use the x basis to get the x scale\n    // and the rotation of the resulting matrix\n    const sx = ccw * Math.sqrt(a * a + b * b);\n    const thetaRad = Math.atan2(ccw * b, ccw * a);\n    const theta = 180 / Math.PI * thetaRad;\n    const ct = Math.cos(thetaRad);\n    const st = Math.sin(thetaRad);\n\n    // We can then solve the y basis vector simultaneously to get the other\n    // two affine parameters directly from these parameters\n    const lam = (a * c + b * d) / determinant;\n    const sy = c * sx / (lam * a - b) || d * sx / (lam * b + a);\n\n    // Use the translations\n    const tx = e - cx + cx * ct * sx + cy * (lam * ct * sx - st * sy);\n    const ty = f - cy + cx * st * sx + cy * (lam * st * sx + ct * sy);\n\n    // Construct the decomposition and return it\n    return {\n      // Return the affine parameters\n      scaleX: sx,\n      scaleY: sy,\n      shear: lam,\n      rotate: theta,\n      translateX: tx,\n      translateY: ty,\n      originX: cx,\n      originY: cy,\n      // Return the matrix parameters\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n\n  // Check if two matrices are equal\n  equals(other) {\n    if (other === this) return true;\n    const comp = new Matrix(other);\n    return closeEnough(this.a, comp.a) && closeEnough(this.b, comp.b) && closeEnough(this.c, comp.c) && closeEnough(this.d, comp.d) && closeEnough(this.e, comp.e) && closeEnough(this.f, comp.f);\n  }\n\n  // Flip matrix on x or y, at a given offset\n  flip(axis, around) {\n    return this.clone().flipO(axis, around);\n  }\n  flipO(axis, around) {\n    return axis === 'x' ? this.scaleO(-1, 1, around, 0) : axis === 'y' ? this.scaleO(1, -1, 0, around) : this.scaleO(-1, -1, axis, around || axis); // Define an x, y flip point\n  }\n\n  // Initialize\n  init(source) {\n    const base = Matrix.fromArray([1, 0, 0, 1, 0, 0]);\n\n    // ensure source as object\n    source = source instanceof Element ? source.matrixify() : typeof source === 'string' ? Matrix.fromArray(source.split(delimiter).map(parseFloat)) : Array.isArray(source) ? Matrix.fromArray(source) : typeof source === 'object' && Matrix.isMatrixLike(source) ? source : typeof source === 'object' ? new Matrix().transform(source) : arguments.length === 6 ? Matrix.fromArray([].slice.call(arguments)) : base;\n\n    // Merge the source matrix with the base matrix\n    this.a = source.a != null ? source.a : base.a;\n    this.b = source.b != null ? source.b : base.b;\n    this.c = source.c != null ? source.c : base.c;\n    this.d = source.d != null ? source.d : base.d;\n    this.e = source.e != null ? source.e : base.e;\n    this.f = source.f != null ? source.f : base.f;\n    return this;\n  }\n  inverse() {\n    return this.clone().inverseO();\n  }\n\n  // Inverses matrix\n  inverseO() {\n    // Get the current parameters out of the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Invert the 2x2 matrix in the top left\n    const det = a * d - b * c;\n    if (!det) throw new Error('Cannot invert ' + this);\n\n    // Calculate the top 2x2 matrix\n    const na = d / det;\n    const nb = -b / det;\n    const nc = -c / det;\n    const nd = a / det;\n\n    // Apply the inverted matrix to the top right\n    const ne = -(na * e + nc * f);\n    const nf = -(nb * e + nd * f);\n\n    // Construct the inverted matrix\n    this.a = na;\n    this.b = nb;\n    this.c = nc;\n    this.d = nd;\n    this.e = ne;\n    this.f = nf;\n    return this;\n  }\n  lmultiply(matrix) {\n    return this.clone().lmultiplyO(matrix);\n  }\n  lmultiplyO(matrix) {\n    const r = this;\n    const l = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Left multiplies by the given matrix\n  multiply(matrix) {\n    return this.clone().multiplyO(matrix);\n  }\n  multiplyO(matrix) {\n    // Get the matrices\n    const l = this;\n    const r = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Rotate matrix\n  rotate(r, cx, cy) {\n    return this.clone().rotateO(r, cx, cy);\n  }\n  rotateO(r, cx = 0, cy = 0) {\n    // Convert degrees to radians\n    r = radians(r);\n    const cos = Math.cos(r);\n    const sin = Math.sin(r);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * cos - b * sin;\n    this.b = b * cos + a * sin;\n    this.c = c * cos - d * sin;\n    this.d = d * cos + c * sin;\n    this.e = e * cos - f * sin + cy * sin - cx * cos + cx;\n    this.f = f * cos + e * sin - cx * sin - cy * cos + cy;\n    return this;\n  }\n\n  // Scale matrix\n  scale() {\n    return this.clone().scaleO(...arguments);\n  }\n  scaleO(x, y = x, cx = 0, cy = 0) {\n    // Support uniform scaling\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * x;\n    this.b = b * y;\n    this.c = c * x;\n    this.d = d * y;\n    this.e = e * x - cx * x + cx;\n    this.f = f * y - cy * y + cy;\n    return this;\n  }\n\n  // Shear matrix\n  shear(a, cx, cy) {\n    return this.clone().shearO(a, cx, cy);\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  shearO(lx, cx = 0, cy = 0) {\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.c = c + d * lx;\n    this.e = e + f * lx - cy * lx;\n    return this;\n  }\n\n  // Skew Matrix\n  skew() {\n    return this.clone().skewO(...arguments);\n  }\n  skewO(x, y = x, cx = 0, cy = 0) {\n    // support uniformal skew\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n\n    // Convert degrees to radians\n    x = radians(x);\n    y = radians(y);\n    const lx = Math.tan(x);\n    const ly = Math.tan(y);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.b = b + a * ly;\n    this.c = c + d * lx;\n    this.d = d + c * ly;\n    this.e = e + f * lx - cy * lx;\n    this.f = f + e * ly - cx * ly;\n    return this;\n  }\n\n  // SkewX\n  skewX(x, cx, cy) {\n    return this.skew(x, 0, cx, cy);\n  }\n\n  // SkewY\n  skewY(y, cx, cy) {\n    return this.skew(0, y, cx, cy);\n  }\n  toArray() {\n    return [this.a, this.b, this.c, this.d, this.e, this.f];\n  }\n\n  // Convert matrix to string\n  toString() {\n    return 'matrix(' + this.a + ',' + this.b + ',' + this.c + ',' + this.d + ',' + this.e + ',' + this.f + ')';\n  }\n\n  // Transform a matrix into another matrix by manipulating the space\n  transform(o) {\n    // Check if o is a matrix and then left multiply it directly\n    if (Matrix.isMatrixLike(o)) {\n      const matrix = new Matrix(o);\n      return matrix.multiplyO(this);\n    }\n\n    // Get the proposed transformations and the current transformations\n    const t = Matrix.formatTransforms(o);\n    const current = this;\n    const {\n      x: ox,\n      y: oy\n    } = new Point(t.ox, t.oy).transform(current);\n\n    // Construct the resulting matrix\n    const transformer = new Matrix().translateO(t.rx, t.ry).lmultiplyO(current).translateO(-ox, -oy).scaleO(t.scaleX, t.scaleY).skewO(t.skewX, t.skewY).shearO(t.shear).rotateO(t.theta).translateO(ox, oy);\n\n    // If we want the origin at a particular place, we force it there\n    if (isFinite(t.px) || isFinite(t.py)) {\n      const origin = new Point(ox, oy).transform(transformer);\n      // TODO: Replace t.px with isFinite(t.px)\n      // Doesn't work because t.px is also 0 if it wasn't passed\n      const dx = isFinite(t.px) ? t.px - origin.x : 0;\n      const dy = isFinite(t.py) ? t.py - origin.y : 0;\n      transformer.translateO(dx, dy);\n    }\n\n    // Translate now after positioning\n    transformer.translateO(t.tx, t.ty);\n    return transformer;\n  }\n\n  // Translate matrix\n  translate(x, y) {\n    return this.clone().translateO(x, y);\n  }\n  translateO(x, y) {\n    this.e += x || 0;\n    this.f += y || 0;\n    return this;\n  }\n  valueOf() {\n    return {\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n}\nfunction ctm() {\n  return new Matrix(this.node.getCTM());\n}\nfunction screenCTM() {\n  try {\n    /* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537\n       This is needed because FF does not return the transformation matrix\n       for the inner coordinate system when getScreenCTM() is called on nested svgs.\n       However all other Browsers do that */\n    if (typeof this.isRoot === 'function' && !this.isRoot()) {\n      const rect = this.rect(1, 1);\n      const m = rect.node.getScreenCTM();\n      rect.remove();\n      return new Matrix(m);\n    }\n    return new Matrix(this.node.getScreenCTM());\n  } catch (e) {\n    console.warn(`Cannot get CTM from SVG node ${this.node.nodeName}. Is the element rendered?`);\n    return new Matrix();\n  }\n}\nregister(Matrix, 'Matrix');\n\nfunction parser() {\n  // Reuse cached element if possible\n  if (!parser.nodes) {\n    const svg = makeInstance().size(2, 0);\n    svg.node.style.cssText = ['opacity: 0', 'position: absolute', 'left: -100%', 'top: -100%', 'overflow: hidden'].join(';');\n    svg.attr('focusable', 'false');\n    svg.attr('aria-hidden', 'true');\n    const path = svg.path().node;\n    parser.nodes = {\n      svg,\n      path\n    };\n  }\n  if (!parser.nodes.svg.node.parentNode) {\n    const b = globals.document.body || globals.document.documentElement;\n    parser.nodes.svg.addTo(b);\n  }\n  return parser.nodes;\n}\n\nfunction isNulledBox(box) {\n  return !box.width && !box.height && !box.x && !box.y;\n}\nfunction domContains(node) {\n  return node === globals.document || (globals.document.documentElement.contains || function (node) {\n    // This is IE - it does not support contains() for top-level SVGs\n    while (node.parentNode) {\n      node = node.parentNode;\n    }\n    return node === globals.document;\n  }).call(globals.document.documentElement, node);\n}\nclass Box {\n  constructor(...args) {\n    this.init(...args);\n  }\n  addOffset() {\n    // offset by window scroll position, because getBoundingClientRect changes when window is scrolled\n    this.x += globals.window.pageXOffset;\n    this.y += globals.window.pageYOffset;\n    return new Box(this);\n  }\n  init(source) {\n    const base = [0, 0, 0, 0];\n    source = typeof source === 'string' ? source.split(delimiter).map(parseFloat) : Array.isArray(source) ? source : typeof source === 'object' ? [source.left != null ? source.left : source.x, source.top != null ? source.top : source.y, source.width, source.height] : arguments.length === 4 ? [].slice.call(arguments) : base;\n    this.x = source[0] || 0;\n    this.y = source[1] || 0;\n    this.width = this.w = source[2] || 0;\n    this.height = this.h = source[3] || 0;\n\n    // Add more bounding box properties\n    this.x2 = this.x + this.w;\n    this.y2 = this.y + this.h;\n    this.cx = this.x + this.w / 2;\n    this.cy = this.y + this.h / 2;\n    return this;\n  }\n  isNulled() {\n    return isNulledBox(this);\n  }\n\n  // Merge rect box with another, return a new instance\n  merge(box) {\n    const x = Math.min(this.x, box.x);\n    const y = Math.min(this.y, box.y);\n    const width = Math.max(this.x + this.width, box.x + box.width) - x;\n    const height = Math.max(this.y + this.height, box.y + box.height) - y;\n    return new Box(x, y, width, height);\n  }\n  toArray() {\n    return [this.x, this.y, this.width, this.height];\n  }\n  toString() {\n    return this.x + ' ' + this.y + ' ' + this.width + ' ' + this.height;\n  }\n  transform(m) {\n    if (!(m instanceof Matrix)) {\n      m = new Matrix(m);\n    }\n    let xMin = Infinity;\n    let xMax = -Infinity;\n    let yMin = Infinity;\n    let yMax = -Infinity;\n    const pts = [new Point(this.x, this.y), new Point(this.x2, this.y), new Point(this.x, this.y2), new Point(this.x2, this.y2)];\n    pts.forEach(function (p) {\n      p = p.transform(m);\n      xMin = Math.min(xMin, p.x);\n      xMax = Math.max(xMax, p.x);\n      yMin = Math.min(yMin, p.y);\n      yMax = Math.max(yMax, p.y);\n    });\n    return new Box(xMin, yMin, xMax - xMin, yMax - yMin);\n  }\n}\nfunction getBox(el, getBBoxFn, retry) {\n  let box;\n  try {\n    // Try to get the box with the provided function\n    box = getBBoxFn(el.node);\n\n    // If the box is worthless and not even in the dom, retry\n    // by throwing an error here...\n    if (isNulledBox(box) && !domContains(el.node)) {\n      throw new Error('Element not in the dom');\n    }\n  } catch (e) {\n    // ... and calling the retry handler here\n    box = retry(el);\n  }\n  return box;\n}\nfunction bbox() {\n  // Function to get bbox is getBBox()\n  const getBBox = node => node.getBBox();\n\n  // Take all measures so that a stupid browser renders the element\n  // so we can get the bbox from it when we try again\n  const retry = el => {\n    try {\n      const clone = el.clone().addTo(parser().svg).show();\n      const box = clone.node.getBBox();\n      clone.remove();\n      return box;\n    } catch (e) {\n      // We give up...\n      throw new Error(`Getting bbox of element \"${el.node.nodeName}\" is not possible: ${e.toString()}`);\n    }\n  };\n  const box = getBox(this, getBBox, retry);\n  const bbox = new Box(box);\n  return bbox;\n}\nfunction rbox(el) {\n  const getRBox = node => node.getBoundingClientRect();\n  const retry = el => {\n    // There is no point in trying tricks here because if we insert the element into the dom ourselves\n    // it obviously will be at the wrong position\n    throw new Error(`Getting rbox of element \"${el.node.nodeName}\" is not possible`);\n  };\n  const box = getBox(this, getRBox, retry);\n  const rbox = new Box(box);\n\n  // If an element was passed, we want the bbox in the coordinate system of that element\n  if (el) {\n    return rbox.transform(el.screenCTM().inverseO());\n  }\n\n  // Else we want it in absolute screen coordinates\n  // Therefore we need to add the scrollOffset\n  return rbox.addOffset();\n}\n\n// Checks whether the given point is inside the bounding box\nfunction inside(x, y) {\n  const box = this.bbox();\n  return x > box.x && y > box.y && x < box.x + box.width && y < box.y + box.height;\n}\nregisterMethods({\n  viewbox: {\n    viewbox(x, y, width, height) {\n      // act as getter\n      if (x == null) return new Box(this.attr('viewBox'));\n\n      // act as setter\n      return this.attr('viewBox', new Box(x, y, width, height));\n    },\n    zoom(level, point) {\n      // Its best to rely on the attributes here and here is why:\n      // clientXYZ: Doesn't work on non-root svgs because they dont have a CSSBox (silly!)\n      // getBoundingClientRect: Doesn't work because Chrome just ignores width and height of nested svgs completely\n      //                        that means, their clientRect is always as big as the content.\n      //                        Furthermore this size is incorrect if the element is further transformed by its parents\n      // computedStyle: Only returns meaningful values if css was used with px. We dont go this route here!\n      // getBBox: returns the bounding box of its content - that doesn't help!\n      let {\n        width,\n        height\n      } = this.attr(['width', 'height']);\n\n      // Width and height is a string when a number with a unit is present which we can't use\n      // So we try clientXYZ\n      if (!width && !height || typeof width === 'string' || typeof height === 'string') {\n        width = this.node.clientWidth;\n        height = this.node.clientHeight;\n      }\n\n      // Giving up...\n      if (!width || !height) {\n        throw new Error('Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element');\n      }\n      const v = this.viewbox();\n      const zoomX = width / v.width;\n      const zoomY = height / v.height;\n      const zoom = Math.min(zoomX, zoomY);\n      if (level == null) {\n        return zoom;\n      }\n      let zoomAmount = zoom / level;\n\n      // Set the zoomAmount to the highest value which is safe to process and recover from\n      // The * 100 is a bit of wiggle room for the matrix transformation\n      if (zoomAmount === Infinity) zoomAmount = Number.MAX_SAFE_INTEGER / 100;\n      point = point || new Point(width / 2 / zoomX + v.x, height / 2 / zoomY + v.y);\n      const box = new Box(v).transform(new Matrix({\n        scale: zoomAmount,\n        origin: point\n      }));\n      return this.viewbox(box);\n    }\n  }\n});\nregister(Box, 'Box');\n\n// import { subClassArray } from './ArrayPolyfill.js'\n\nclass List extends Array {\n  constructor(arr = [], ...args) {\n    super(arr, ...args);\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...arr);\n  }\n}\nextend([List], {\n  each(fnOrMethodName, ...args) {\n    if (typeof fnOrMethodName === 'function') {\n      return this.map((el, i, arr) => {\n        return fnOrMethodName.call(el, el, i, arr);\n      });\n    } else {\n      return this.map(el => {\n        return el[fnOrMethodName](...args);\n      });\n    }\n  },\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n});\nconst reserved = ['toArray', 'constructor', 'each'];\nList.extend = function (methods) {\n  methods = methods.reduce((obj, name) => {\n    // Don't overwrite own methods\n    if (reserved.includes(name)) return obj;\n\n    // Don't add private methods\n    if (name[0] === '_') return obj;\n\n    // Allow access to original Array methods through a prefix\n    if (name in Array.prototype) {\n      obj['$' + name] = Array.prototype[name];\n    }\n\n    // Relay every call to each()\n    obj[name] = function (...attrs) {\n      return this.each(name, ...attrs);\n    };\n    return obj;\n  }, {});\n  extend([List], methods);\n};\n\nfunction baseFind(query, parent) {\n  return new List(map((parent || globals.document).querySelectorAll(query), function (node) {\n    return adopt(node);\n  }));\n}\n\n// Scoped find method\nfunction find(query) {\n  return baseFind(query, this.node);\n}\nfunction findOne(query) {\n  return adopt(this.node.querySelector(query));\n}\n\nlet listenerId = 0;\nconst windowEvents = {};\nfunction getEvents(instance) {\n  let n = instance.getEventHolder();\n\n  // We dont want to save events in global space\n  if (n === globals.window) n = windowEvents;\n  if (!n.events) n.events = {};\n  return n.events;\n}\nfunction getEventTarget(instance) {\n  return instance.getEventTarget();\n}\nfunction clearEvents(instance) {\n  let n = instance.getEventHolder();\n  if (n === globals.window) n = windowEvents;\n  if (n.events) n.events = {};\n}\n\n// Add event binder in the SVG namespace\nfunction on(node, events, listener, binding, options) {\n  const l = listener.bind(binding || node);\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // events can be an array of events or a string of events\n  events = Array.isArray(events) ? events : events.split(delimiter);\n\n  // add id to listener\n  if (!listener._svgjsListenerId) {\n    listener._svgjsListenerId = ++listenerId;\n  }\n  events.forEach(function (event) {\n    const ev = event.split('.')[0];\n    const ns = event.split('.')[1] || '*';\n\n    // ensure valid object\n    bag[ev] = bag[ev] || {};\n    bag[ev][ns] = bag[ev][ns] || {};\n\n    // reference listener\n    bag[ev][ns][listener._svgjsListenerId] = l;\n\n    // add listener\n    n.addEventListener(ev, l, options || false);\n  });\n}\n\n// Add event unbinder in the SVG namespace\nfunction off(node, events, listener, options) {\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // listener can be a function or a number\n  if (typeof listener === 'function') {\n    listener = listener._svgjsListenerId;\n    if (!listener) return;\n  }\n\n  // events can be an array of events or a string or undefined\n  events = Array.isArray(events) ? events : (events || '').split(delimiter);\n  events.forEach(function (event) {\n    const ev = event && event.split('.')[0];\n    const ns = event && event.split('.')[1];\n    let namespace, l;\n    if (listener) {\n      // remove listener reference\n      if (bag[ev] && bag[ev][ns || '*']) {\n        // removeListener\n        n.removeEventListener(ev, bag[ev][ns || '*'][listener], options || false);\n        delete bag[ev][ns || '*'][listener];\n      }\n    } else if (ev && ns) {\n      // remove all listeners for a namespaced event\n      if (bag[ev] && bag[ev][ns]) {\n        for (l in bag[ev][ns]) {\n          off(n, [ev, ns].join('.'), l);\n        }\n        delete bag[ev][ns];\n      }\n    } else if (ns) {\n      // remove all listeners for a specific namespace\n      for (event in bag) {\n        for (namespace in bag[event]) {\n          if (ns === namespace) {\n            off(n, [event, ns].join('.'));\n          }\n        }\n      }\n    } else if (ev) {\n      // remove all listeners for the event\n      if (bag[ev]) {\n        for (namespace in bag[ev]) {\n          off(n, [ev, namespace].join('.'));\n        }\n        delete bag[ev];\n      }\n    } else {\n      // remove all listeners on a given node\n      for (event in bag) {\n        off(n, event);\n      }\n      clearEvents(instance);\n    }\n  });\n}\nfunction dispatch(node, event, data, options) {\n  const n = getEventTarget(node);\n\n  // Dispatch event\n  if (event instanceof globals.window.Event) {\n    n.dispatchEvent(event);\n  } else {\n    event = new globals.window.CustomEvent(event, {\n      detail: data,\n      cancelable: true,\n      ...options\n    });\n    n.dispatchEvent(event);\n  }\n  return event;\n}\n\nclass EventTarget extends Base {\n  addEventListener() {}\n  dispatch(event, data, options) {\n    return dispatch(this, event, data, options);\n  }\n  dispatchEvent(event) {\n    const bag = this.getEventHolder().events;\n    if (!bag) return true;\n    const events = bag[event.type];\n    for (const i in events) {\n      for (const j in events[i]) {\n        events[i][j](event);\n      }\n    }\n    return !event.defaultPrevented;\n  }\n\n  // Fire given event\n  fire(event, data, options) {\n    this.dispatch(event, data, options);\n    return this;\n  }\n  getEventHolder() {\n    return this;\n  }\n  getEventTarget() {\n    return this;\n  }\n\n  // Unbind event from listener\n  off(event, listener, options) {\n    off(this, event, listener, options);\n    return this;\n  }\n\n  // Bind given event to listener\n  on(event, listener, binding, options) {\n    on(this, event, listener, binding, options);\n    return this;\n  }\n  removeEventListener() {}\n}\nregister(EventTarget, 'EventTarget');\n\nfunction noop() {}\n\n// Default animation values\nconst timeline = {\n  duration: 400,\n  ease: '>',\n  delay: 0\n};\n\n// Default attribute values\nconst attrs = {\n  // fill and stroke\n  'fill-opacity': 1,\n  'stroke-opacity': 1,\n  'stroke-width': 0,\n  'stroke-linejoin': 'miter',\n  'stroke-linecap': 'butt',\n  fill: '#000000',\n  stroke: '#000000',\n  opacity: 1,\n  // position\n  x: 0,\n  y: 0,\n  cx: 0,\n  cy: 0,\n  // size\n  width: 0,\n  height: 0,\n  // radius\n  r: 0,\n  rx: 0,\n  ry: 0,\n  // gradient\n  offset: 0,\n  'stop-opacity': 1,\n  'stop-color': '#000000',\n  // text\n  'text-anchor': 'start'\n};\n\nvar defaults = {\n  __proto__: null,\n  attrs: attrs,\n  noop: noop,\n  timeline: timeline\n};\n\nclass SVGArray extends Array {\n  constructor(...args) {\n    super(...args);\n    this.init(...args);\n  }\n  clone() {\n    return new this.constructor(this);\n  }\n  init(arr) {\n    // This catches the case, that native map tries to create an array with new Array(1)\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...this.parse(arr));\n    return this;\n  }\n\n  // Parse whitespace separated string\n  parse(array = []) {\n    // If already is an array, no need to parse it\n    if (array instanceof Array) return array;\n    return array.trim().split(delimiter).map(parseFloat);\n  }\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n  toSet() {\n    return new Set(this);\n  }\n  toString() {\n    return this.join(' ');\n  }\n\n  // Flattens the array if needed\n  valueOf() {\n    const ret = [];\n    ret.push(...this);\n    return ret;\n  }\n}\n\n// Module for unit conversions\nclass SVGNumber {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n  convert(unit) {\n    return new SVGNumber(this.value, unit);\n  }\n\n  // Divide number\n  divide(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this / number, this.unit || number.unit);\n  }\n  init(value, unit) {\n    unit = Array.isArray(value) ? value[1] : unit;\n    value = Array.isArray(value) ? value[0] : value;\n\n    // initialize defaults\n    this.value = 0;\n    this.unit = unit || '';\n\n    // parse value\n    if (typeof value === 'number') {\n      // ensure a valid numeric value\n      this.value = isNaN(value) ? 0 : !isFinite(value) ? value < 0 ? -3.4e38 : +3.4e38 : value;\n    } else if (typeof value === 'string') {\n      unit = value.match(numberAndUnit);\n      if (unit) {\n        // make value numeric\n        this.value = parseFloat(unit[1]);\n\n        // normalize\n        if (unit[5] === '%') {\n          this.value /= 100;\n        } else if (unit[5] === 's') {\n          this.value *= 1000;\n        }\n\n        // store unit\n        this.unit = unit[5];\n      }\n    } else {\n      if (value instanceof SVGNumber) {\n        this.value = value.valueOf();\n        this.unit = value.unit;\n      }\n    }\n    return this;\n  }\n\n  // Subtract number\n  minus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this - number, this.unit || number.unit);\n  }\n\n  // Add number\n  plus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this + number, this.unit || number.unit);\n  }\n\n  // Multiply number\n  times(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this * number, this.unit || number.unit);\n  }\n  toArray() {\n    return [this.value, this.unit];\n  }\n  toJSON() {\n    return this.toString();\n  }\n  toString() {\n    return (this.unit === '%' ? ~~(this.value * 1e8) / 1e6 : this.unit === 's' ? this.value / 1e3 : this.value) + this.unit;\n  }\n  valueOf() {\n    return this.value;\n  }\n}\n\nconst colorAttributes = new Set(['fill', 'stroke', 'color', 'bgcolor', 'stop-color', 'flood-color', 'lighting-color']);\nconst hooks = [];\nfunction registerAttrHook(fn) {\n  hooks.push(fn);\n}\n\n// Set svg element attribute\nfunction attr(attr, val, ns) {\n  // act as full getter\n  if (attr == null) {\n    // get an object of attributes\n    attr = {};\n    val = this.node.attributes;\n    for (const node of val) {\n      attr[node.nodeName] = isNumber.test(node.nodeValue) ? parseFloat(node.nodeValue) : node.nodeValue;\n    }\n    return attr;\n  } else if (attr instanceof Array) {\n    // loop through array and get all values\n    return attr.reduce((last, curr) => {\n      last[curr] = this.attr(curr);\n      return last;\n    }, {});\n  } else if (typeof attr === 'object' && attr.constructor === Object) {\n    // apply every attribute individually if an object is passed\n    for (val in attr) this.attr(val, attr[val]);\n  } else if (val === null) {\n    // remove value\n    this.node.removeAttribute(attr);\n  } else if (val == null) {\n    // act as a getter if the first and only argument is not an object\n    val = this.node.getAttribute(attr);\n    return val == null ? attrs[attr] : isNumber.test(val) ? parseFloat(val) : val;\n  } else {\n    // Loop through hooks and execute them to convert value\n    val = hooks.reduce((_val, hook) => {\n      return hook(attr, _val, this);\n    }, val);\n\n    // ensure correct numeric values (also accepts NaN and Infinity)\n    if (typeof val === 'number') {\n      val = new SVGNumber(val);\n    } else if (colorAttributes.has(attr) && Color.isColor(val)) {\n      // ensure full hex color\n      val = new Color(val);\n    } else if (val.constructor === Array) {\n      // Check for plain arrays and parse array values\n      val = new SVGArray(val);\n    }\n\n    // if the passed attribute is leading...\n    if (attr === 'leading') {\n      // ... call the leading method instead\n      if (this.leading) {\n        this.leading(val);\n      }\n    } else {\n      // set given attribute on node\n      typeof ns === 'string' ? this.node.setAttributeNS(ns, attr, val.toString()) : this.node.setAttribute(attr, val.toString());\n    }\n\n    // rebuild if required\n    if (this.rebuild && (attr === 'font-size' || attr === 'x')) {\n      this.rebuild();\n    }\n  }\n  return this;\n}\n\nclass Dom extends EventTarget {\n  constructor(node, attrs) {\n    super();\n    this.node = node;\n    this.type = node.nodeName;\n    if (attrs && node !== attrs) {\n      this.attr(attrs);\n    }\n  }\n\n  // Add given element at a position\n  add(element, i) {\n    element = makeInstance(element);\n\n    // If non-root svg nodes are added we have to remove their namespaces\n    if (element.removeNamespace && this.node instanceof globals.window.SVGElement) {\n      element.removeNamespace();\n    }\n    if (i == null) {\n      this.node.appendChild(element.node);\n    } else if (element.node !== this.node.childNodes[i]) {\n      this.node.insertBefore(element.node, this.node.childNodes[i]);\n    }\n    return this;\n  }\n\n  // Add element to given container and return self\n  addTo(parent, i) {\n    return makeInstance(parent).put(this, i);\n  }\n\n  // Returns all child elements\n  children() {\n    return new List(map(this.node.children, function (node) {\n      return adopt(node);\n    }));\n  }\n\n  // Remove all elements in this container\n  clear() {\n    // remove children\n    while (this.node.hasChildNodes()) {\n      this.node.removeChild(this.node.lastChild);\n    }\n    return this;\n  }\n\n  // Clone element\n  clone(deep = true, assignNewIds = true) {\n    // write dom data to the dom so the clone can pickup the data\n    this.writeDataToDom();\n\n    // clone element\n    let nodeClone = this.node.cloneNode(deep);\n    if (assignNewIds) {\n      // assign new id\n      nodeClone = assignNewId(nodeClone);\n    }\n    return new this.constructor(nodeClone);\n  }\n\n  // Iterates over all children and invokes a given block\n  each(block, deep) {\n    const children = this.children();\n    let i, il;\n    for (i = 0, il = children.length; i < il; i++) {\n      block.apply(children[i], [i, children]);\n      if (deep) {\n        children[i].each(block, deep);\n      }\n    }\n    return this;\n  }\n  element(nodeName, attrs) {\n    return this.put(new Dom(create(nodeName), attrs));\n  }\n\n  // Get first child\n  first() {\n    return adopt(this.node.firstChild);\n  }\n\n  // Get a element at the given index\n  get(i) {\n    return adopt(this.node.childNodes[i]);\n  }\n  getEventHolder() {\n    return this.node;\n  }\n  getEventTarget() {\n    return this.node;\n  }\n\n  // Checks if the given element is a child\n  has(element) {\n    return this.index(element) >= 0;\n  }\n  html(htmlOrFn, outerHTML) {\n    return this.xml(htmlOrFn, outerHTML, html);\n  }\n\n  // Get / set id\n  id(id) {\n    // generate new id if no id set\n    if (typeof id === 'undefined' && !this.node.id) {\n      this.node.id = eid(this.type);\n    }\n\n    // don't set directly with this.node.id to make `null` work correctly\n    return this.attr('id', id);\n  }\n\n  // Gets index of given element\n  index(element) {\n    return [].slice.call(this.node.childNodes).indexOf(element.node);\n  }\n\n  // Get the last child\n  last() {\n    return adopt(this.node.lastChild);\n  }\n\n  // matches the element vs a css selector\n  matches(selector) {\n    const el = this.node;\n    const matcher = el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector || null;\n    return matcher && matcher.call(el, selector);\n  }\n\n  // Returns the parent element instance\n  parent(type) {\n    let parent = this;\n\n    // check for parent\n    if (!parent.node.parentNode) return null;\n\n    // get parent element\n    parent = adopt(parent.node.parentNode);\n    if (!type) return parent;\n\n    // loop through ancestors if type is given\n    do {\n      if (typeof type === 'string' ? parent.matches(type) : parent instanceof type) return parent;\n    } while (parent = adopt(parent.node.parentNode));\n    return parent;\n  }\n\n  // Basically does the same as `add()` but returns the added element instead\n  put(element, i) {\n    element = makeInstance(element);\n    this.add(element, i);\n    return element;\n  }\n\n  // Add element to given container and return container\n  putIn(parent, i) {\n    return makeInstance(parent).add(this, i);\n  }\n\n  // Remove element\n  remove() {\n    if (this.parent()) {\n      this.parent().removeElement(this);\n    }\n    return this;\n  }\n\n  // Remove a given child\n  removeElement(element) {\n    this.node.removeChild(element.node);\n    return this;\n  }\n\n  // Replace this with element\n  replace(element) {\n    element = makeInstance(element);\n    if (this.node.parentNode) {\n      this.node.parentNode.replaceChild(element.node, this.node);\n    }\n    return element;\n  }\n  round(precision = 2, map = null) {\n    const factor = 10 ** precision;\n    const attrs = this.attr(map);\n    for (const i in attrs) {\n      if (typeof attrs[i] === 'number') {\n        attrs[i] = Math.round(attrs[i] * factor) / factor;\n      }\n    }\n    this.attr(attrs);\n    return this;\n  }\n\n  // Import / Export raw svg\n  svg(svgOrFn, outerSVG) {\n    return this.xml(svgOrFn, outerSVG, svg);\n  }\n\n  // Return id on string conversion\n  toString() {\n    return this.id();\n  }\n  words(text) {\n    // This is faster than removing all children and adding a new one\n    this.node.textContent = text;\n    return this;\n  }\n  wrap(node) {\n    const parent = this.parent();\n    if (!parent) {\n      return this.addTo(node);\n    }\n    const position = parent.index(this);\n    return parent.put(node, position).put(this);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    // dump variables recursively\n    this.each(function () {\n      this.writeDataToDom();\n    });\n    return this;\n  }\n\n  // Import / Export raw svg\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // act as getter if no svg string is given\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      // The default for exports is, that the outerNode is included\n      outerXML = outerXML == null ? true : outerXML;\n\n      // write svgjs data to the dom\n      this.writeDataToDom();\n      let current = this;\n\n      // An export modifier was passed\n      if (xmlOrFn != null) {\n        current = adopt(current.node.cloneNode(true));\n\n        // If the user wants outerHTML we need to process this node, too\n        if (outerXML) {\n          const result = xmlOrFn(current);\n          current = result || current;\n\n          // The user does not want this node? Well, then he gets nothing\n          if (result === false) return '';\n        }\n\n        // Deep loop through all children and apply modifier\n        current.each(function () {\n          const result = xmlOrFn(this);\n          const _this = result || this;\n\n          // If modifier returns false, discard node\n          if (result === false) {\n            this.remove();\n\n            // If modifier returns new node, use it\n          } else if (result && this !== _this) {\n            this.replace(_this);\n          }\n        }, true);\n      }\n\n      // Return outer or inner content\n      return outerXML ? current.node.outerHTML : current.node.innerHTML;\n    }\n\n    // Act as setter if we got a string\n\n    // The default for import is, that the current node is not replaced\n    outerXML = outerXML == null ? false : outerXML;\n\n    // Create temporary holder\n    const well = create('wrapper', ns);\n    const fragment = globals.document.createDocumentFragment();\n\n    // Dump raw svg\n    well.innerHTML = xmlOrFn;\n\n    // Transplant nodes into the fragment\n    for (let len = well.children.length; len--;) {\n      fragment.appendChild(well.firstElementChild);\n    }\n    const parent = this.parent();\n\n    // Add the whole fragment at once\n    return outerXML ? this.replace(fragment) && parent : this.add(fragment);\n  }\n}\nextend(Dom, {\n  attr,\n  find,\n  findOne\n});\nregister(Dom, 'Dom');\n\nclass Element extends Dom {\n  constructor(node, attrs) {\n    super(node, attrs);\n\n    // initialize data object\n    this.dom = {};\n\n    // create circular reference\n    this.node.instance = this;\n    if (node.hasAttribute('data-svgjs') || node.hasAttribute('svgjs:data')) {\n      // pull svgjs data from the dom (getAttributeNS doesn't work in html5)\n      this.setData(JSON.parse(node.getAttribute('data-svgjs')) ?? JSON.parse(node.getAttribute('svgjs:data')) ?? {});\n    }\n  }\n\n  // Move element by its center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  }\n\n  // Move by center over x-axis\n  cx(x) {\n    return x == null ? this.x() + this.width() / 2 : this.x(x - this.width() / 2);\n  }\n\n  // Move by center over y-axis\n  cy(y) {\n    return y == null ? this.y() + this.height() / 2 : this.y(y - this.height() / 2);\n  }\n\n  // Get defs\n  defs() {\n    const root = this.root();\n    return root && root.defs();\n  }\n\n  // Relative move over x and y axes\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  }\n\n  // Relative move over x axis\n  dx(x = 0) {\n    return this.x(new SVGNumber(x).plus(this.x()));\n  }\n\n  // Relative move over y axis\n  dy(y = 0) {\n    return this.y(new SVGNumber(y).plus(this.y()));\n  }\n  getEventHolder() {\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('height', height);\n  }\n\n  // Move element to given x and y values\n  move(x, y) {\n    return this.x(x).y(y);\n  }\n\n  // return array of all ancestors of given type up to the root svg\n  parents(until = this.root()) {\n    const isSelector = typeof until === 'string';\n    if (!isSelector) {\n      until = makeInstance(until);\n    }\n    const parents = new List();\n    let parent = this;\n    while ((parent = parent.parent()) && parent.node !== globals.document && parent.nodeName !== '#document-fragment') {\n      parents.push(parent);\n      if (!isSelector && parent.node === until.node) {\n        break;\n      }\n      if (isSelector && parent.matches(until)) {\n        break;\n      }\n      if (parent.node === this.root().node) {\n        // We worked our way to the root and didn't match `until`\n        return null;\n      }\n    }\n    return parents;\n  }\n\n  // Get referenced element form attribute value\n  reference(attr) {\n    attr = this.attr(attr);\n    if (!attr) return null;\n    const m = (attr + '').match(reference);\n    return m ? makeInstance(m[1]) : null;\n  }\n\n  // Get parent document\n  root() {\n    const p = this.parent(getClass(root));\n    return p && p.root();\n  }\n\n  // set given data to the elements data property\n  setData(o) {\n    this.dom = o;\n    return this;\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.width(new SVGNumber(p.width)).height(new SVGNumber(p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('width', width);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    writeDataToDom(this, this.dom);\n    return super.writeDataToDom();\n  }\n\n  // Move over x-axis\n  x(x) {\n    return this.attr('x', x);\n  }\n\n  // Move over y-axis\n  y(y) {\n    return this.attr('y', y);\n  }\n}\nextend(Element, {\n  bbox,\n  rbox,\n  inside,\n  point,\n  ctm,\n  screenCTM\n});\nregister(Element, 'Element');\n\n// Define list of available attributes for stroke and fill\nconst sugar = {\n  stroke: ['color', 'width', 'opacity', 'linecap', 'linejoin', 'miterlimit', 'dasharray', 'dashoffset'],\n  fill: ['color', 'opacity', 'rule'],\n  prefix: function (t, a) {\n    return a === 'color' ? t : t + '-' + a;\n  }\n}\n\n// Add sugar for fill and stroke\n;\n['fill', 'stroke'].forEach(function (m) {\n  const extension = {};\n  let i;\n  extension[m] = function (o) {\n    if (typeof o === 'undefined') {\n      return this.attr(m);\n    }\n    if (typeof o === 'string' || o instanceof Color || Color.isRgb(o) || o instanceof Element) {\n      this.attr(m, o);\n    } else {\n      // set all attributes from sugar.fill and sugar.stroke list\n      for (i = sugar[m].length - 1; i >= 0; i--) {\n        if (o[sugar[m][i]] != null) {\n          this.attr(sugar.prefix(m, sugar[m][i]), o[sugar[m][i]]);\n        }\n      }\n    }\n    return this;\n  };\n  registerMethods(['Element', 'Runner'], extension);\n});\nregisterMethods(['Element', 'Runner'], {\n  // Let the user set the matrix directly\n  matrix: function (mat, b, c, d, e, f) {\n    // Act as a getter\n    if (mat == null) {\n      return new Matrix(this);\n    }\n\n    // Act as a setter, the user can pass a matrix or a set of numbers\n    return this.attr('transform', new Matrix(mat, b, c, d, e, f));\n  },\n  // Map rotation to transform\n  rotate: function (angle, cx, cy) {\n    return this.transform({\n      rotate: angle,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map skew to transform\n  skew: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      skew: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      skew: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  shear: function (lam, cx, cy) {\n    return this.transform({\n      shear: lam,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map scale to transform\n  scale: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      scale: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      scale: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map translate to transform\n  translate: function (x, y) {\n    return this.transform({\n      translate: [x, y]\n    }, true);\n  },\n  // Map relative translations to transform\n  relative: function (x, y) {\n    return this.transform({\n      relative: [x, y]\n    }, true);\n  },\n  // Map flip to transform\n  flip: function (direction = 'both', origin = 'center') {\n    if ('xybothtrue'.indexOf(direction) === -1) {\n      origin = direction;\n      direction = 'both';\n    }\n    return this.transform({\n      flip: direction,\n      origin: origin\n    }, true);\n  },\n  // Opacity\n  opacity: function (value) {\n    return this.attr('opacity', value);\n  }\n});\nregisterMethods('radius', {\n  // Add x and y radius\n  radius: function (x, y = x) {\n    const type = (this._element || this).type;\n    return type === 'radialGradient' ? this.attr('r', new SVGNumber(x)) : this.rx(x).ry(y);\n  }\n});\nregisterMethods('Path', {\n  // Get path length\n  length: function () {\n    return this.node.getTotalLength();\n  },\n  // Get point at length\n  pointAt: function (length) {\n    return new Point(this.node.getPointAtLength(length));\n  }\n});\nregisterMethods(['Element', 'Runner'], {\n  // Set font\n  font: function (a, v) {\n    if (typeof a === 'object') {\n      for (v in a) this.font(v, a[v]);\n      return this;\n    }\n    return a === 'leading' ? this.leading(v) : a === 'anchor' ? this.attr('text-anchor', v) : a === 'size' || a === 'family' || a === 'weight' || a === 'stretch' || a === 'variant' || a === 'style' ? this.attr('font-' + a, v) : this.attr(a, v);\n  }\n});\n\n// Add events to elements\nconst methods = ['click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'mousemove', 'mouseenter', 'mouseleave', 'touchstart', 'touchmove', 'touchleave', 'touchend', 'touchcancel', 'contextmenu', 'wheel', 'pointerdown', 'pointermove', 'pointerup', 'pointerleave', 'pointercancel'].reduce(function (last, event) {\n  // add event to Element\n  const fn = function (f) {\n    if (f === null) {\n      this.off(event);\n    } else {\n      this.on(event, f);\n    }\n    return this;\n  };\n  last[event] = fn;\n  return last;\n}, {});\nregisterMethods('Element', methods);\n\n// Reset all transformations\nfunction untransform() {\n  return this.attr('transform', null);\n}\n\n// merge the whole transformation chain into one matrix and returns it\nfunction matrixify() {\n  const matrix = (this.attr('transform') || ''\n  // split transformations\n  ).split(transforms).slice(0, -1).map(function (str) {\n    // generate key => value pairs\n    const kv = str.trim().split('(');\n    return [kv[0], kv[1].split(delimiter).map(function (str) {\n      return parseFloat(str);\n    })];\n  }).reverse()\n  // merge every transformation into one matrix\n  .reduce(function (matrix, transform) {\n    if (transform[0] === 'matrix') {\n      return matrix.lmultiply(Matrix.fromArray(transform[1]));\n    }\n    return matrix[transform[0]].apply(matrix, transform[1]);\n  }, new Matrix());\n  return matrix;\n}\n\n// add an element to another parent without changing the visual representation on the screen\nfunction toParent(parent, i) {\n  if (this === parent) return this;\n  if (isDescriptive(this.node)) return this.addTo(parent, i);\n  const ctm = this.screenCTM();\n  const pCtm = parent.screenCTM().inverse();\n  this.addTo(parent, i).untransform().transform(pCtm.multiply(ctm));\n  return this;\n}\n\n// same as above with parent equals root-svg\nfunction toRoot(i) {\n  return this.toParent(this.root(), i);\n}\n\n// Add transformations\nfunction transform(o, relative) {\n  // Act as a getter if no object was passed\n  if (o == null || typeof o === 'string') {\n    const decomposed = new Matrix(this).decompose();\n    return o == null ? decomposed : decomposed[o];\n  }\n  if (!Matrix.isMatrixLike(o)) {\n    // Set the origin according to the defined transform\n    o = {\n      ...o,\n      origin: getOrigin(o, this)\n    };\n  }\n\n  // The user can pass a boolean, an Element or an Matrix or nothing\n  const cleanRelative = relative === true ? this : relative || false;\n  const result = new Matrix(cleanRelative).transform(o);\n  return this.attr('transform', result);\n}\nregisterMethods('Element', {\n  untransform,\n  matrixify,\n  toParent,\n  toRoot,\n  transform\n});\n\nclass Container extends Element {\n  flatten() {\n    this.each(function () {\n      if (this instanceof Container) {\n        return this.flatten().ungroup();\n      }\n    });\n    return this;\n  }\n  ungroup(parent = this.parent(), index = parent.index(this)) {\n    // when parent != this, we want append all elements to the end\n    index = index === -1 ? parent.children().length : index;\n    this.each(function (i, children) {\n      // reverse each\n      return children[children.length - i - 1].toParent(parent, index);\n    });\n    return this.remove();\n  }\n}\nregister(Container, 'Container');\n\nclass Defs extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('defs', node), attrs);\n  }\n  flatten() {\n    return this;\n  }\n  ungroup() {\n    return this;\n  }\n}\nregister(Defs, 'Defs');\n\nclass Shape extends Element {}\nregister(Shape, 'Shape');\n\n// Radius x value\nfunction rx(rx) {\n  return this.attr('rx', rx);\n}\n\n// Radius y value\nfunction ry(ry) {\n  return this.attr('ry', ry);\n}\n\n// Move over x-axis\nfunction x$3(x) {\n  return x == null ? this.cx() - this.rx() : this.cx(x + this.rx());\n}\n\n// Move over y-axis\nfunction y$3(y) {\n  return y == null ? this.cy() - this.ry() : this.cy(y + this.ry());\n}\n\n// Move by center over x-axis\nfunction cx$1(x) {\n  return this.attr('cx', x);\n}\n\n// Move by center over y-axis\nfunction cy$1(y) {\n  return this.attr('cy', y);\n}\n\n// Set width of element\nfunction width$2(width) {\n  return width == null ? this.rx() * 2 : this.rx(new SVGNumber(width).divide(2));\n}\n\n// Set height of element\nfunction height$2(height) {\n  return height == null ? this.ry() * 2 : this.ry(new SVGNumber(height).divide(2));\n}\n\nvar circled = {\n  __proto__: null,\n  cx: cx$1,\n  cy: cy$1,\n  height: height$2,\n  rx: rx,\n  ry: ry,\n  width: width$2,\n  x: x$3,\n  y: y$3\n};\n\nclass Ellipse extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('ellipse', node), attrs);\n  }\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.rx(new SVGNumber(p.width).divide(2)).ry(new SVGNumber(p.height).divide(2));\n  }\n}\nextend(Ellipse, circled);\nregisterMethods('Container', {\n  // Create an ellipse\n  ellipse: wrapWithAttrCheck(function (width = 0, height = width) {\n    return this.put(new Ellipse()).size(width, height).move(0, 0);\n  })\n});\nregister(Ellipse, 'Ellipse');\n\nclass Fragment extends Dom {\n  constructor(node = globals.document.createDocumentFragment()) {\n    super(node);\n  }\n\n  // Import / Export raw xml\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // because this is a fragment we have to put all elements into a wrapper first\n    // before we can get the innerXML from it\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      const wrapper = new Dom(create('wrapper', ns));\n      wrapper.add(this.node.cloneNode(true));\n      return wrapper.xml(false, ns);\n    }\n\n    // Act as setter if we got a string\n    return super.xml(xmlOrFn, false, ns);\n  }\n}\nregister(Fragment, 'Fragment');\n\nfunction from(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    fx: new SVGNumber(x),\n    fy: new SVGNumber(y)\n  }) : this.attr({\n    x1: new SVGNumber(x),\n    y1: new SVGNumber(y)\n  });\n}\nfunction to(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    cx: new SVGNumber(x),\n    cy: new SVGNumber(y)\n  }) : this.attr({\n    x2: new SVGNumber(x),\n    y2: new SVGNumber(y)\n  });\n}\n\nvar gradiented = {\n  __proto__: null,\n  from: from,\n  to: to\n};\n\nclass Gradient extends Container {\n  constructor(type, attrs) {\n    super(nodeOrNew(type + 'Gradient', typeof type === 'string' ? null : type), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'gradientTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update gradient\n  update(block) {\n    // remove all stops\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nextend(Gradient, gradiented);\nregisterMethods({\n  Container: {\n    // Create gradient element in defs\n    gradient(...args) {\n      return this.defs().gradient(...args);\n    }\n  },\n  // define gradient\n  Defs: {\n    gradient: wrapWithAttrCheck(function (type, block) {\n      return this.put(new Gradient(type)).update(block);\n    })\n  }\n});\nregister(Gradient, 'Gradient');\n\nclass Pattern extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('pattern', node), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'patternTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update pattern by rebuilding\n  update(block) {\n    // remove content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nregisterMethods({\n  Container: {\n    // Create pattern element in defs\n    pattern(...args) {\n      return this.defs().pattern(...args);\n    }\n  },\n  Defs: {\n    pattern: wrapWithAttrCheck(function (width, height, block) {\n      return this.put(new Pattern()).update(block).attr({\n        x: 0,\n        y: 0,\n        width: width,\n        height: height,\n        patternUnits: 'userSpaceOnUse'\n      });\n    })\n  }\n});\nregister(Pattern, 'Pattern');\n\nclass Image extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('image', node), attrs);\n  }\n\n  // (re)load image\n  load(url, callback) {\n    if (!url) return this;\n    const img = new globals.window.Image();\n    on(img, 'load', function (e) {\n      const p = this.parent(Pattern);\n\n      // ensure image size\n      if (this.width() === 0 && this.height() === 0) {\n        this.size(img.width, img.height);\n      }\n      if (p instanceof Pattern) {\n        // ensure pattern size if not set\n        if (p.width() === 0 && p.height() === 0) {\n          p.size(this.width(), this.height());\n        }\n      }\n      if (typeof callback === 'function') {\n        callback.call(this, e);\n      }\n    }, this);\n    on(img, 'load error', function () {\n      // dont forget to unbind memory leaking events\n      off(img);\n    });\n    return this.attr('href', img.src = url, xlink);\n  }\n}\nregisterAttrHook(function (attr, val, _this) {\n  // convert image fill and stroke to patterns\n  if (attr === 'fill' || attr === 'stroke') {\n    if (isImage.test(val)) {\n      val = _this.root().defs().image(val);\n    }\n  }\n  if (val instanceof Image) {\n    val = _this.root().defs().pattern(0, 0, pattern => {\n      pattern.add(val);\n    });\n  }\n  return val;\n});\nregisterMethods({\n  Container: {\n    // create image element, load image and set its size\n    image: wrapWithAttrCheck(function (source, callback) {\n      return this.put(new Image()).size(0, 0).load(source, callback);\n    })\n  }\n});\nregister(Image, 'Image');\n\nclass PointArray extends SVGArray {\n  // Get bounding box of points\n  bbox() {\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    let minX = Infinity;\n    let minY = Infinity;\n    this.forEach(function (el) {\n      maxX = Math.max(el[0], maxX);\n      maxY = Math.max(el[1], maxY);\n      minX = Math.min(el[0], minX);\n      minY = Math.min(el[1], minY);\n    });\n    return new Box(minX, minY, maxX - minX, maxY - minY);\n  }\n\n  // Move point string\n  move(x, y) {\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n\n    // move every point\n    if (!isNaN(x) && !isNaN(y)) {\n      for (let i = this.length - 1; i >= 0; i--) {\n        this[i] = [this[i][0] + x, this[i][1] + y];\n      }\n    }\n    return this;\n  }\n\n  // Parse point string and flat array\n  parse(array = [0, 0]) {\n    const points = [];\n\n    // if it is an array, we flatten it and therefore clone it to 1 depths\n    if (array instanceof Array) {\n      array = Array.prototype.concat.apply([], array);\n    } else {\n      // Else, it is considered as a string\n      // parse points\n      array = array.trim().split(delimiter).map(parseFloat);\n    }\n\n    // validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints\n    // Odd number of coordinates is an error. In such cases, drop the last odd coordinate.\n    if (array.length % 2 !== 0) array.pop();\n\n    // wrap points in two-tuples\n    for (let i = 0, len = array.length; i < len; i = i + 2) {\n      points.push([array[i], array[i + 1]]);\n    }\n    return points;\n  }\n\n  // Resize poly string\n  size(width, height) {\n    let i;\n    const box = this.bbox();\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      if (box.width) this[i][0] = (this[i][0] - box.x) * width / box.width + box.x;\n      if (box.height) this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n    }\n    return this;\n  }\n\n  // Convert array to line object\n  toLine() {\n    return {\n      x1: this[0][0],\n      y1: this[0][1],\n      x2: this[1][0],\n      y2: this[1][1]\n    };\n  }\n\n  // Convert array to string\n  toString() {\n    const array = [];\n    // convert to a poly point string\n    for (let i = 0, il = this.length; i < il; i++) {\n      array.push(this[i].join(','));\n    }\n    return array.join(' ');\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // transform points with matrix (similar to Point.transform)\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    for (let i = this.length; i--;) {\n      // Perform the matrix multiplication\n      const [x, y] = this[i];\n      this[i][0] = m.a * x + m.c * y + m.e;\n      this[i][1] = m.b * x + m.d * y + m.f;\n    }\n    return this;\n  }\n}\n\nconst MorphArray = PointArray;\n\n// Move by left top corner over x-axis\nfunction x$2(x) {\n  return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n}\n\n// Move by left top corner over y-axis\nfunction y$2(y) {\n  return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n}\n\n// Set width of element\nfunction width$1(width) {\n  const b = this.bbox();\n  return width == null ? b.width : this.size(width, b.height);\n}\n\n// Set height of element\nfunction height$1(height) {\n  const b = this.bbox();\n  return height == null ? b.height : this.size(b.width, height);\n}\n\nvar pointed = {\n  __proto__: null,\n  MorphArray: MorphArray,\n  height: height$1,\n  width: width$1,\n  x: x$2,\n  y: y$2\n};\n\nclass Line extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('line', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return new PointArray([[this.attr('x1'), this.attr('y1')], [this.attr('x2'), this.attr('y2')]]);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr(this.array().move(x, y).toLine());\n  }\n\n  // Overwrite native plot() method\n  plot(x1, y1, x2, y2) {\n    if (x1 == null) {\n      return this.array();\n    } else if (typeof y1 !== 'undefined') {\n      x1 = {\n        x1,\n        y1,\n        x2,\n        y2\n      };\n    } else {\n      x1 = new PointArray(x1).toLine();\n    }\n    return this.attr(x1);\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr(this.array().size(p.width, p.height).toLine());\n  }\n}\nextend(Line, pointed);\nregisterMethods({\n  Container: {\n    // Create a line element\n    line: wrapWithAttrCheck(function (...args) {\n      // make sure plot is called as a setter\n      // x1 is not necessarily a number, it can also be an array, a string and a PointArray\n      return Line.prototype.plot.apply(this.put(new Line()), args[0] != null ? args : [0, 0, 0, 0]);\n    })\n  }\n});\nregister(Line, 'Line');\n\nclass Marker extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('marker', node), attrs);\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('markerHeight', height);\n  }\n  orient(orient) {\n    return this.attr('orient', orient);\n  }\n\n  // Set marker refX and refY\n  ref(x, y) {\n    return this.attr('refX', x).attr('refY', y);\n  }\n\n  // Return the fill id\n  toString() {\n    return 'url(#' + this.id() + ')';\n  }\n\n  // Update marker\n  update(block) {\n    // remove all content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('markerWidth', width);\n  }\n}\nregisterMethods({\n  Container: {\n    marker(...args) {\n      // Create marker element in defs\n      return this.defs().marker(...args);\n    }\n  },\n  Defs: {\n    // Create marker\n    marker: wrapWithAttrCheck(function (width, height, block) {\n      // Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto\n      return this.put(new Marker()).size(width, height).ref(width / 2, height / 2).viewbox(0, 0, width, height).attr('orient', 'auto').update(block);\n    })\n  },\n  marker: {\n    // Create and attach markers\n    marker(marker, width, height, block) {\n      let attr = ['marker'];\n\n      // Build attribute name\n      if (marker !== 'all') attr.push(marker);\n      attr = attr.join('-');\n\n      // Set marker attribute\n      marker = arguments[1] instanceof Marker ? arguments[1] : this.defs().marker(width, height, block);\n      return this.attr(attr, marker);\n    }\n  }\n});\nregister(Marker, 'Marker');\n\n/***\nBase Class\n==========\nThe base stepper class that will be\n***/\n\nfunction makeSetterGetter(k, f) {\n  return function (v) {\n    if (v == null) return this[k];\n    this[k] = v;\n    if (f) f.call(this);\n    return this;\n  };\n}\nconst easing = {\n  '-': function (pos) {\n    return pos;\n  },\n  '<>': function (pos) {\n    return -Math.cos(pos * Math.PI) / 2 + 0.5;\n  },\n  '>': function (pos) {\n    return Math.sin(pos * Math.PI / 2);\n  },\n  '<': function (pos) {\n    return -Math.cos(pos * Math.PI / 2) + 1;\n  },\n  bezier: function (x1, y1, x2, y2) {\n    // see https://www.w3.org/TR/css-easing-1/#cubic-bezier-algo\n    return function (t) {\n      if (t < 0) {\n        if (x1 > 0) {\n          return y1 / x1 * t;\n        } else if (x2 > 0) {\n          return y2 / x2 * t;\n        } else {\n          return 0;\n        }\n      } else if (t > 1) {\n        if (x2 < 1) {\n          return (1 - y2) / (1 - x2) * t + (y2 - x2) / (1 - x2);\n        } else if (x1 < 1) {\n          return (1 - y1) / (1 - x1) * t + (y1 - x1) / (1 - x1);\n        } else {\n          return 1;\n        }\n      } else {\n        return 3 * t * (1 - t) ** 2 * y1 + 3 * t ** 2 * (1 - t) * y2 + t ** 3;\n      }\n    };\n  },\n  // see https://www.w3.org/TR/css-easing-1/#step-timing-function-algo\n  steps: function (steps, stepPosition = 'end') {\n    // deal with \"jump-\" prefix\n    stepPosition = stepPosition.split('-').reverse()[0];\n    let jumps = steps;\n    if (stepPosition === 'none') {\n      --jumps;\n    } else if (stepPosition === 'both') {\n      ++jumps;\n    }\n\n    // The beforeFlag is essentially useless\n    return (t, beforeFlag = false) => {\n      // Step is called currentStep in referenced url\n      let step = Math.floor(t * steps);\n      const jumping = t * step % 1 === 0;\n      if (stepPosition === 'start' || stepPosition === 'both') {\n        ++step;\n      }\n      if (beforeFlag && jumping) {\n        --step;\n      }\n      if (t >= 0 && step < 0) {\n        step = 0;\n      }\n      if (t <= 1 && step > jumps) {\n        step = jumps;\n      }\n      return step / jumps;\n    };\n  }\n};\nclass Stepper {\n  done() {\n    return false;\n  }\n}\n\n/***\nEasing Functions\n================\n***/\n\nclass Ease extends Stepper {\n  constructor(fn = timeline.ease) {\n    super();\n    this.ease = easing[fn] || fn;\n  }\n  step(from, to, pos) {\n    if (typeof from !== 'number') {\n      return pos < 1 ? from : to;\n    }\n    return from + (to - from) * this.ease(pos);\n  }\n}\n\n/***\nController Types\n================\n***/\n\nclass Controller extends Stepper {\n  constructor(fn) {\n    super();\n    this.stepper = fn;\n  }\n  done(c) {\n    return c.done;\n  }\n  step(current, target, dt, c) {\n    return this.stepper(current, target, dt, c);\n  }\n}\nfunction recalculate() {\n  // Apply the default parameters\n  const duration = (this._duration || 500) / 1000;\n  const overshoot = this._overshoot || 0;\n\n  // Calculate the PID natural response\n  const eps = 1e-10;\n  const pi = Math.PI;\n  const os = Math.log(overshoot / 100 + eps);\n  const zeta = -os / Math.sqrt(pi * pi + os * os);\n  const wn = 3.9 / (zeta * duration);\n\n  // Calculate the Spring values\n  this.d = 2 * zeta * wn;\n  this.k = wn * wn;\n}\nclass Spring extends Controller {\n  constructor(duration = 500, overshoot = 0) {\n    super();\n    this.duration(duration).overshoot(overshoot);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    if (dt > 100) dt = 16;\n    dt /= 1000;\n\n    // Get the previous velocity\n    const velocity = c.velocity || 0;\n\n    // Apply the control to get the new position and store it\n    const acceleration = -this.d * velocity - this.k * (current - target);\n    const newPosition = current + velocity * dt + acceleration * dt * dt / 2;\n\n    // Store the velocity\n    c.velocity = velocity + acceleration * dt;\n\n    // Figure out if we have converged, and if so, pass the value\n    c.done = Math.abs(target - newPosition) + Math.abs(velocity) < 0.002;\n    return c.done ? target : newPosition;\n  }\n}\nextend(Spring, {\n  duration: makeSetterGetter('_duration', recalculate),\n  overshoot: makeSetterGetter('_overshoot', recalculate)\n});\nclass PID extends Controller {\n  constructor(p = 0.1, i = 0.01, d = 0, windup = 1000) {\n    super();\n    this.p(p).i(i).d(d).windup(windup);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    const p = target - current;\n    let i = (c.integral || 0) + p * dt;\n    const d = (p - (c.error || 0)) / dt;\n    const windup = this._windup;\n\n    // antiwindup\n    if (windup !== false) {\n      i = Math.max(-windup, Math.min(i, windup));\n    }\n    c.error = p;\n    c.integral = i;\n    c.done = Math.abs(p) < 0.001;\n    return c.done ? target : current + (this.P * p + this.I * i + this.D * d);\n  }\n}\nextend(PID, {\n  windup: makeSetterGetter('_windup'),\n  p: makeSetterGetter('P'),\n  i: makeSetterGetter('I'),\n  d: makeSetterGetter('D')\n});\n\nconst segmentParameters = {\n  M: 2,\n  L: 2,\n  H: 1,\n  V: 1,\n  C: 6,\n  S: 4,\n  Q: 4,\n  T: 2,\n  A: 7,\n  Z: 0\n};\nconst pathHandlers = {\n  M: function (c, p, p0) {\n    p.x = p0.x = c[0];\n    p.y = p0.y = c[1];\n    return ['M', p.x, p.y];\n  },\n  L: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['L', c[0], c[1]];\n  },\n  H: function (c, p) {\n    p.x = c[0];\n    return ['H', c[0]];\n  },\n  V: function (c, p) {\n    p.y = c[0];\n    return ['V', c[0]];\n  },\n  C: function (c, p) {\n    p.x = c[4];\n    p.y = c[5];\n    return ['C', c[0], c[1], c[2], c[3], c[4], c[5]];\n  },\n  S: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['S', c[0], c[1], c[2], c[3]];\n  },\n  Q: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['Q', c[0], c[1], c[2], c[3]];\n  },\n  T: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['T', c[0], c[1]];\n  },\n  Z: function (c, p, p0) {\n    p.x = p0.x;\n    p.y = p0.y;\n    return ['Z'];\n  },\n  A: function (c, p) {\n    p.x = c[5];\n    p.y = c[6];\n    return ['A', c[0], c[1], c[2], c[3], c[4], c[5], c[6]];\n  }\n};\nconst mlhvqtcsaz = 'mlhvqtcsaz'.split('');\nfor (let i = 0, il = mlhvqtcsaz.length; i < il; ++i) {\n  pathHandlers[mlhvqtcsaz[i]] = function (i) {\n    return function (c, p, p0) {\n      if (i === 'H') c[0] = c[0] + p.x;else if (i === 'V') c[0] = c[0] + p.y;else if (i === 'A') {\n        c[5] = c[5] + p.x;\n        c[6] = c[6] + p.y;\n      } else {\n        for (let j = 0, jl = c.length; j < jl; ++j) {\n          c[j] = c[j] + (j % 2 ? p.y : p.x);\n        }\n      }\n      return pathHandlers[i](c, p, p0);\n    };\n  }(mlhvqtcsaz[i].toUpperCase());\n}\nfunction makeAbsolut(parser) {\n  const command = parser.segment[0];\n  return pathHandlers[command](parser.segment.slice(1), parser.p, parser.p0);\n}\nfunction segmentComplete(parser) {\n  return parser.segment.length && parser.segment.length - 1 === segmentParameters[parser.segment[0].toUpperCase()];\n}\nfunction startNewSegment(parser, token) {\n  parser.inNumber && finalizeNumber(parser, false);\n  const pathLetter = isPathLetter.test(token);\n  if (pathLetter) {\n    parser.segment = [token];\n  } else {\n    const lastCommand = parser.lastCommand;\n    const small = lastCommand.toLowerCase();\n    const isSmall = lastCommand === small;\n    parser.segment = [small === 'm' ? isSmall ? 'l' : 'L' : lastCommand];\n  }\n  parser.inSegment = true;\n  parser.lastCommand = parser.segment[0];\n  return pathLetter;\n}\nfunction finalizeNumber(parser, inNumber) {\n  if (!parser.inNumber) throw new Error('Parser Error');\n  parser.number && parser.segment.push(parseFloat(parser.number));\n  parser.inNumber = inNumber;\n  parser.number = '';\n  parser.pointSeen = false;\n  parser.hasExponent = false;\n  if (segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n}\nfunction finalizeSegment(parser) {\n  parser.inSegment = false;\n  if (parser.absolute) {\n    parser.segment = makeAbsolut(parser);\n  }\n  parser.segments.push(parser.segment);\n}\nfunction isArcFlag(parser) {\n  if (!parser.segment.length) return false;\n  const isArc = parser.segment[0].toUpperCase() === 'A';\n  const length = parser.segment.length;\n  return isArc && (length === 4 || length === 5);\n}\nfunction isExponential(parser) {\n  return parser.lastToken.toUpperCase() === 'E';\n}\nconst pathDelimiters = new Set([' ', ',', '\\t', '\\n', '\\r', '\\f']);\nfunction pathParser(d, toAbsolute = true) {\n  let index = 0;\n  let token = '';\n  const parser = {\n    segment: [],\n    inNumber: false,\n    number: '',\n    lastToken: '',\n    inSegment: false,\n    segments: [],\n    pointSeen: false,\n    hasExponent: false,\n    absolute: toAbsolute,\n    p0: new Point(),\n    p: new Point()\n  };\n  while (parser.lastToken = token, token = d.charAt(index++)) {\n    if (!parser.inSegment) {\n      if (startNewSegment(parser, token)) {\n        continue;\n      }\n    }\n    if (token === '.') {\n      if (parser.pointSeen || parser.hasExponent) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.inNumber = true;\n      parser.pointSeen = true;\n      parser.number += token;\n      continue;\n    }\n    if (!isNaN(parseInt(token))) {\n      if (parser.number === '0' || isArcFlag(parser)) {\n        parser.inNumber = true;\n        parser.number = token;\n        finalizeNumber(parser, true);\n        continue;\n      }\n      parser.inNumber = true;\n      parser.number += token;\n      continue;\n    }\n    if (pathDelimiters.has(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      }\n      continue;\n    }\n    if (token === '-' || token === '+') {\n      if (parser.inNumber && !isExponential(parser)) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.number += token;\n      parser.inNumber = true;\n      continue;\n    }\n    if (token.toUpperCase() === 'E') {\n      parser.number += token;\n      parser.hasExponent = true;\n      continue;\n    }\n    if (isPathLetter.test(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      } else if (!segmentComplete(parser)) {\n        throw new Error('parser Error');\n      } else {\n        finalizeSegment(parser);\n      }\n      --index;\n    }\n  }\n  if (parser.inNumber) {\n    finalizeNumber(parser, false);\n  }\n  if (parser.inSegment && segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n  return parser.segments;\n}\n\nfunction arrayToString(a) {\n  let s = '';\n  for (let i = 0, il = a.length; i < il; i++) {\n    s += a[i][0];\n    if (a[i][1] != null) {\n      s += a[i][1];\n      if (a[i][2] != null) {\n        s += ' ';\n        s += a[i][2];\n        if (a[i][3] != null) {\n          s += ' ';\n          s += a[i][3];\n          s += ' ';\n          s += a[i][4];\n          if (a[i][5] != null) {\n            s += ' ';\n            s += a[i][5];\n            s += ' ';\n            s += a[i][6];\n            if (a[i][7] != null) {\n              s += ' ';\n              s += a[i][7];\n            }\n          }\n        }\n      }\n    }\n  }\n  return s + ' ';\n}\nclass PathArray extends SVGArray {\n  // Get bounding box of path\n  bbox() {\n    parser().path.setAttribute('d', this.toString());\n    return new Box(parser.nodes.path.getBBox());\n  }\n\n  // Move path string\n  move(x, y) {\n    // get bounding box of current situation\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n    if (!isNaN(x) && !isNaN(y)) {\n      // move every point\n      for (let l, i = this.length - 1; i >= 0; i--) {\n        l = this[i][0];\n        if (l === 'M' || l === 'L' || l === 'T') {\n          this[i][1] += x;\n          this[i][2] += y;\n        } else if (l === 'H') {\n          this[i][1] += x;\n        } else if (l === 'V') {\n          this[i][1] += y;\n        } else if (l === 'C' || l === 'S' || l === 'Q') {\n          this[i][1] += x;\n          this[i][2] += y;\n          this[i][3] += x;\n          this[i][4] += y;\n          if (l === 'C') {\n            this[i][5] += x;\n            this[i][6] += y;\n          }\n        } else if (l === 'A') {\n          this[i][6] += x;\n          this[i][7] += y;\n        }\n      }\n    }\n    return this;\n  }\n\n  // Absolutize and parse path to array\n  parse(d = 'M0 0') {\n    if (Array.isArray(d)) {\n      d = Array.prototype.concat.apply([], d).toString();\n    }\n    return pathParser(d);\n  }\n\n  // Resize path string\n  size(width, height) {\n    // get bounding box of current situation\n    const box = this.bbox();\n    let i, l;\n\n    // If the box width or height is 0 then we ignore\n    // transformations on the respective axis\n    box.width = box.width === 0 ? 1 : box.width;\n    box.height = box.height === 0 ? 1 : box.height;\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      l = this[i][0];\n      if (l === 'M' || l === 'L' || l === 'T') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n      } else if (l === 'H') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n      } else if (l === 'V') {\n        this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n      } else if (l === 'C' || l === 'S' || l === 'Q') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n        this[i][3] = (this[i][3] - box.x) * width / box.width + box.x;\n        this[i][4] = (this[i][4] - box.y) * height / box.height + box.y;\n        if (l === 'C') {\n          this[i][5] = (this[i][5] - box.x) * width / box.width + box.x;\n          this[i][6] = (this[i][6] - box.y) * height / box.height + box.y;\n        }\n      } else if (l === 'A') {\n        // resize radii\n        this[i][1] = this[i][1] * width / box.width;\n        this[i][2] = this[i][2] * height / box.height;\n\n        // move position values\n        this[i][6] = (this[i][6] - box.x) * width / box.width + box.x;\n        this[i][7] = (this[i][7] - box.y) * height / box.height + box.y;\n      }\n    }\n    return this;\n  }\n\n  // Convert array to string\n  toString() {\n    return arrayToString(this);\n  }\n}\n\nconst getClassForType = value => {\n  const type = typeof value;\n  if (type === 'number') {\n    return SVGNumber;\n  } else if (type === 'string') {\n    if (Color.isColor(value)) {\n      return Color;\n    } else if (delimiter.test(value)) {\n      return isPathLetter.test(value) ? PathArray : SVGArray;\n    } else if (numberAndUnit.test(value)) {\n      return SVGNumber;\n    } else {\n      return NonMorphable;\n    }\n  } else if (morphableTypes.indexOf(value.constructor) > -1) {\n    return value.constructor;\n  } else if (Array.isArray(value)) {\n    return SVGArray;\n  } else if (type === 'object') {\n    return ObjectBag;\n  } else {\n    return NonMorphable;\n  }\n};\nclass Morphable {\n  constructor(stepper) {\n    this._stepper = stepper || new Ease('-');\n    this._from = null;\n    this._to = null;\n    this._type = null;\n    this._context = null;\n    this._morphObj = null;\n  }\n  at(pos) {\n    return this._morphObj.morph(this._from, this._to, pos, this._stepper, this._context);\n  }\n  done() {\n    const complete = this._context.map(this._stepper.done).reduce(function (last, curr) {\n      return last && curr;\n    }, true);\n    return complete;\n  }\n  from(val) {\n    if (val == null) {\n      return this._from;\n    }\n    this._from = this._set(val);\n    return this;\n  }\n  stepper(stepper) {\n    if (stepper == null) return this._stepper;\n    this._stepper = stepper;\n    return this;\n  }\n  to(val) {\n    if (val == null) {\n      return this._to;\n    }\n    this._to = this._set(val);\n    return this;\n  }\n  type(type) {\n    // getter\n    if (type == null) {\n      return this._type;\n    }\n\n    // setter\n    this._type = type;\n    return this;\n  }\n  _set(value) {\n    if (!this._type) {\n      this.type(getClassForType(value));\n    }\n    let result = new this._type(value);\n    if (this._type === Color) {\n      result = this._to ? result[this._to[4]]() : this._from ? result[this._from[4]]() : result;\n    }\n    if (this._type === ObjectBag) {\n      result = this._to ? result.align(this._to) : this._from ? result.align(this._from) : result;\n    }\n    result = result.toConsumable();\n    this._morphObj = this._morphObj || new this._type();\n    this._context = this._context || Array.apply(null, Array(result.length)).map(Object).map(function (o) {\n      o.done = true;\n      return o;\n    });\n    return result;\n  }\n}\nclass NonMorphable {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(val) {\n    val = Array.isArray(val) ? val[0] : val;\n    this.value = val;\n    return this;\n  }\n  toArray() {\n    return [this.value];\n  }\n  valueOf() {\n    return this.value;\n  }\n}\nclass TransformBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(obj) {\n    if (Array.isArray(obj)) {\n      obj = {\n        scaleX: obj[0],\n        scaleY: obj[1],\n        shear: obj[2],\n        rotate: obj[3],\n        translateX: obj[4],\n        translateY: obj[5],\n        originX: obj[6],\n        originY: obj[7]\n      };\n    }\n    Object.assign(this, TransformBag.defaults, obj);\n    return this;\n  }\n  toArray() {\n    const v = this;\n    return [v.scaleX, v.scaleY, v.shear, v.rotate, v.translateX, v.translateY, v.originX, v.originY];\n  }\n}\nTransformBag.defaults = {\n  scaleX: 1,\n  scaleY: 1,\n  shear: 0,\n  rotate: 0,\n  translateX: 0,\n  translateY: 0,\n  originX: 0,\n  originY: 0\n};\nconst sortByKey = (a, b) => {\n  return a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0;\n};\nclass ObjectBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  align(other) {\n    const values = this.values;\n    for (let i = 0, il = values.length; i < il; ++i) {\n      // If the type is the same we only need to check if the color is in the correct format\n      if (values[i + 1] === other[i + 1]) {\n        if (values[i + 1] === Color && other[i + 7] !== values[i + 7]) {\n          const space = other[i + 7];\n          const color = new Color(this.values.splice(i + 3, 5))[space]().toArray();\n          this.values.splice(i + 3, 0, ...color);\n        }\n        i += values[i + 2] + 2;\n        continue;\n      }\n      if (!other[i + 1]) {\n        return this;\n      }\n\n      // The types differ, so we overwrite the new type with the old one\n      // And initialize it with the types default (e.g. black for color or 0 for number)\n      const defaultObject = new other[i + 1]().toArray();\n\n      // Than we fix the values array\n      const toDelete = values[i + 2] + 3;\n      values.splice(i, toDelete, other[i], other[i + 1], other[i + 2], ...defaultObject);\n      i += values[i + 2] + 2;\n    }\n    return this;\n  }\n  init(objOrArr) {\n    this.values = [];\n    if (Array.isArray(objOrArr)) {\n      this.values = objOrArr.slice();\n      return;\n    }\n    objOrArr = objOrArr || {};\n    const entries = [];\n    for (const i in objOrArr) {\n      const Type = getClassForType(objOrArr[i]);\n      const val = new Type(objOrArr[i]).toArray();\n      entries.push([i, Type, val.length, ...val]);\n    }\n    entries.sort(sortByKey);\n    this.values = entries.reduce((last, curr) => last.concat(curr), []);\n    return this;\n  }\n  toArray() {\n    return this.values;\n  }\n  valueOf() {\n    const obj = {};\n    const arr = this.values;\n\n    // for (var i = 0, len = arr.length; i < len; i += 2) {\n    while (arr.length) {\n      const key = arr.shift();\n      const Type = arr.shift();\n      const num = arr.shift();\n      const values = arr.splice(0, num);\n      obj[key] = new Type(values); // .valueOf()\n    }\n    return obj;\n  }\n}\nconst morphableTypes = [NonMorphable, TransformBag, ObjectBag];\nfunction registerMorphableType(type = []) {\n  morphableTypes.push(...[].concat(type));\n}\nfunction makeMorphable() {\n  extend(morphableTypes, {\n    to(val) {\n      return new Morphable().type(this.constructor).from(this.toArray()) // this.valueOf())\n      .to(val);\n    },\n    fromArray(arr) {\n      this.init(arr);\n      return this;\n    },\n    toConsumable() {\n      return this.toArray();\n    },\n    morph(from, to, pos, stepper, context) {\n      const mapper = function (i, index) {\n        return stepper.step(i, to[index], pos, context[index], context);\n      };\n      return this.fromArray(from.map(mapper));\n    }\n  });\n}\n\nclass Path extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('path', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return this._array || (this._array = new PathArray(this.attr('d')));\n  }\n\n  // Clear array cache\n  clear() {\n    delete this._array;\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return height == null ? this.bbox().height : this.size(this.bbox().width, height);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr('d', this.array().move(x, y));\n  }\n\n  // Plot new path\n  plot(d) {\n    return d == null ? this.array() : this.clear().attr('d', typeof d === 'string' ? d : this._array = new PathArray(d));\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr('d', this.array().size(p.width, p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return width == null ? this.bbox().width : this.size(width, this.bbox().height);\n  }\n\n  // Move by left top corner over x-axis\n  x(x) {\n    return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n  }\n\n  // Move by left top corner over y-axis\n  y(y) {\n    return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n  }\n}\n\n// Define morphable array\nPath.prototype.MorphArray = PathArray;\n\n// Add parent method\nregisterMethods({\n  Container: {\n    // Create a wrapped path element\n    path: wrapWithAttrCheck(function (d) {\n      // make sure plot is called as a setter\n      return this.put(new Path()).plot(d || new PathArray());\n    })\n  }\n});\nregister(Path, 'Path');\n\n// Get array\nfunction array() {\n  return this._array || (this._array = new PointArray(this.attr('points')));\n}\n\n// Clear array cache\nfunction clear() {\n  delete this._array;\n  return this;\n}\n\n// Move by left top corner\nfunction move$2(x, y) {\n  return this.attr('points', this.array().move(x, y));\n}\n\n// Plot new path\nfunction plot(p) {\n  return p == null ? this.array() : this.clear().attr('points', typeof p === 'string' ? p : this._array = new PointArray(p));\n}\n\n// Set element size to given width and height\nfunction size$1(width, height) {\n  const p = proportionalSize(this, width, height);\n  return this.attr('points', this.array().size(p.width, p.height));\n}\n\nvar poly = {\n  __proto__: null,\n  array: array,\n  clear: clear,\n  move: move$2,\n  plot: plot,\n  size: size$1\n};\n\nclass Polygon extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polygon', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polygon: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polygon()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polygon, pointed);\nextend(Polygon, poly);\nregister(Polygon, 'Polygon');\n\nclass Polyline extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polyline', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polyline: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polyline()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polyline, pointed);\nextend(Polyline, poly);\nregister(Polyline, 'Polyline');\n\nclass Rect extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('rect', node), attrs);\n  }\n}\nextend(Rect, {\n  rx,\n  ry\n});\nregisterMethods({\n  Container: {\n    // Create a rect element\n    rect: wrapWithAttrCheck(function (width, height) {\n      return this.put(new Rect()).size(width, height);\n    })\n  }\n});\nregister(Rect, 'Rect');\n\nclass Queue {\n  constructor() {\n    this._first = null;\n    this._last = null;\n  }\n\n  // Shows us the first item in the list\n  first() {\n    return this._first && this._first.value;\n  }\n\n  // Shows us the last item in the list\n  last() {\n    return this._last && this._last.value;\n  }\n  push(value) {\n    // An item stores an id and the provided value\n    const item = typeof value.next !== 'undefined' ? value : {\n      value: value,\n      next: null,\n      prev: null\n    };\n\n    // Deal with the queue being empty or populated\n    if (this._last) {\n      item.prev = this._last;\n      this._last.next = item;\n      this._last = item;\n    } else {\n      this._last = item;\n      this._first = item;\n    }\n\n    // Return the current item\n    return item;\n  }\n\n  // Removes the item that was returned from the push\n  remove(item) {\n    // Relink the previous item\n    if (item.prev) item.prev.next = item.next;\n    if (item.next) item.next.prev = item.prev;\n    if (item === this._last) this._last = item.prev;\n    if (item === this._first) this._first = item.next;\n\n    // Invalidate item\n    item.prev = null;\n    item.next = null;\n  }\n  shift() {\n    // Check if we have a value\n    const remove = this._first;\n    if (!remove) return null;\n\n    // If we do, remove it and relink things\n    this._first = remove.next;\n    if (this._first) this._first.prev = null;\n    this._last = this._first ? this._last : null;\n    return remove.value;\n  }\n}\n\nconst Animator = {\n  nextDraw: null,\n  frames: new Queue(),\n  timeouts: new Queue(),\n  immediates: new Queue(),\n  timer: () => globals.window.performance || globals.window.Date,\n  transforms: [],\n  frame(fn) {\n    // Store the node\n    const node = Animator.frames.push({\n      run: fn\n    });\n\n    // Request an animation frame if we don't have one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n\n    // Return the node so we can remove it easily\n    return node;\n  },\n  timeout(fn, delay) {\n    delay = delay || 0;\n\n    // Work out when the event should fire\n    const time = Animator.timer().now() + delay;\n\n    // Add the timeout to the end of the queue\n    const node = Animator.timeouts.push({\n      run: fn,\n      time: time\n    });\n\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  immediate(fn) {\n    // Add the immediate fn to the end of the queue\n    const node = Animator.immediates.push(fn);\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  cancelFrame(node) {\n    node != null && Animator.frames.remove(node);\n  },\n  clearTimeout(node) {\n    node != null && Animator.timeouts.remove(node);\n  },\n  cancelImmediate(node) {\n    node != null && Animator.immediates.remove(node);\n  },\n  _draw(now) {\n    // Run all the timeouts we can run, if they are not ready yet, add them\n    // to the end of the queue immediately! (bad timeouts!!! [sarcasm])\n    let nextTimeout = null;\n    const lastTimeout = Animator.timeouts.last();\n    while (nextTimeout = Animator.timeouts.shift()) {\n      // Run the timeout if its time, or push it to the end\n      if (now >= nextTimeout.time) {\n        nextTimeout.run();\n      } else {\n        Animator.timeouts.push(nextTimeout);\n      }\n\n      // If we hit the last item, we should stop shifting out more items\n      if (nextTimeout === lastTimeout) break;\n    }\n\n    // Run all of the animation frames\n    let nextFrame = null;\n    const lastFrame = Animator.frames.last();\n    while (nextFrame !== lastFrame && (nextFrame = Animator.frames.shift())) {\n      nextFrame.run(now);\n    }\n    let nextImmediate = null;\n    while (nextImmediate = Animator.immediates.shift()) {\n      nextImmediate();\n    }\n\n    // If we have remaining timeouts or frames, draw until we don't anymore\n    Animator.nextDraw = Animator.timeouts.first() || Animator.frames.first() ? globals.window.requestAnimationFrame(Animator._draw) : null;\n  }\n};\n\nconst makeSchedule = function (runnerInfo) {\n  const start = runnerInfo.start;\n  const duration = runnerInfo.runner.duration();\n  const end = start + duration;\n  return {\n    start: start,\n    duration: duration,\n    end: end,\n    runner: runnerInfo.runner\n  };\n};\nconst defaultSource = function () {\n  const w = globals.window;\n  return (w.performance || w.Date).now();\n};\nclass Timeline extends EventTarget {\n  // Construct a new timeline on the given element\n  constructor(timeSource = defaultSource) {\n    super();\n    this._timeSource = timeSource;\n\n    // terminate resets all variables to their initial state\n    this.terminate();\n  }\n  active() {\n    return !!this._nextFrame;\n  }\n  finish() {\n    // Go to end and pause\n    this.time(this.getEndTimeOfTimeline() + 1);\n    return this.pause();\n  }\n\n  // Calculates the end of the timeline\n  getEndTime() {\n    const lastRunnerInfo = this.getLastRunnerInfo();\n    const lastDuration = lastRunnerInfo ? lastRunnerInfo.runner.duration() : 0;\n    const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n    return lastStartTime + lastDuration;\n  }\n  getEndTimeOfTimeline() {\n    const endTimes = this._runners.map(i => i.start + i.runner.duration());\n    return Math.max(0, ...endTimes);\n  }\n  getLastRunnerInfo() {\n    return this.getRunnerInfoById(this._lastRunnerId);\n  }\n  getRunnerInfoById(id) {\n    return this._runners[this._runnerIds.indexOf(id)] || null;\n  }\n  pause() {\n    this._paused = true;\n    return this._continue();\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  play() {\n    // Now make sure we are not paused and continue the animation\n    this._paused = false;\n    return this.updateTime()._continue();\n  }\n  reverse(yes) {\n    const currentSpeed = this.speed();\n    if (yes == null) return this.speed(-currentSpeed);\n    const positive = Math.abs(currentSpeed);\n    return this.speed(yes ? -positive : positive);\n  }\n\n  // schedules a runner on the timeline\n  schedule(runner, delay, when) {\n    if (runner == null) {\n      return this._runners.map(makeSchedule);\n    }\n\n    // The start time for the next animation can either be given explicitly,\n    // derived from the current timeline time or it can be relative to the\n    // last start time to chain animations directly\n\n    let absoluteStartTime = 0;\n    const endTime = this.getEndTime();\n    delay = delay || 0;\n\n    // Work out when to start the animation\n    if (when == null || when === 'last' || when === 'after') {\n      // Take the last time and increment\n      absoluteStartTime = endTime;\n    } else if (when === 'absolute' || when === 'start') {\n      absoluteStartTime = delay;\n      delay = 0;\n    } else if (when === 'now') {\n      absoluteStartTime = this._time;\n    } else if (when === 'relative') {\n      const runnerInfo = this.getRunnerInfoById(runner.id);\n      if (runnerInfo) {\n        absoluteStartTime = runnerInfo.start + delay;\n        delay = 0;\n      }\n    } else if (when === 'with-last') {\n      const lastRunnerInfo = this.getLastRunnerInfo();\n      const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n      absoluteStartTime = lastStartTime;\n    } else {\n      throw new Error('Invalid value for the \"when\" parameter');\n    }\n\n    // Manage runner\n    runner.unschedule();\n    runner.timeline(this);\n    const persist = runner.persist();\n    const runnerInfo = {\n      persist: persist === null ? this._persist : persist,\n      start: absoluteStartTime + delay,\n      runner\n    };\n    this._lastRunnerId = runner.id;\n    this._runners.push(runnerInfo);\n    this._runners.sort((a, b) => a.start - b.start);\n    this._runnerIds = this._runners.map(info => info.runner.id);\n    this.updateTime()._continue();\n    return this;\n  }\n  seek(dt) {\n    return this.time(this._time + dt);\n  }\n  source(fn) {\n    if (fn == null) return this._timeSource;\n    this._timeSource = fn;\n    return this;\n  }\n  speed(speed) {\n    if (speed == null) return this._speed;\n    this._speed = speed;\n    return this;\n  }\n  stop() {\n    // Go to start and pause\n    this.time(0);\n    return this.pause();\n  }\n  time(time) {\n    if (time == null) return this._time;\n    this._time = time;\n    return this._continue(true);\n  }\n\n  // Remove the runner from this timeline\n  unschedule(runner) {\n    const index = this._runnerIds.indexOf(runner.id);\n    if (index < 0) return this;\n    this._runners.splice(index, 1);\n    this._runnerIds.splice(index, 1);\n    runner.timeline(null);\n    return this;\n  }\n\n  // Makes sure, that after pausing the time doesn't jump\n  updateTime() {\n    if (!this.active()) {\n      this._lastSourceTime = this._timeSource();\n    }\n    return this;\n  }\n\n  // Checks if we are running and continues the animation\n  _continue(immediateStep = false) {\n    Animator.cancelFrame(this._nextFrame);\n    this._nextFrame = null;\n    if (immediateStep) return this._stepImmediate();\n    if (this._paused) return this;\n    this._nextFrame = Animator.frame(this._step);\n    return this;\n  }\n  _stepFn(immediateStep = false) {\n    // Get the time delta from the last time and update the time\n    const time = this._timeSource();\n    let dtSource = time - this._lastSourceTime;\n    if (immediateStep) dtSource = 0;\n    const dtTime = this._speed * dtSource + (this._time - this._lastStepTime);\n    this._lastSourceTime = time;\n\n    // Only update the time if we use the timeSource.\n    // Otherwise use the current time\n    if (!immediateStep) {\n      // Update the time\n      this._time += dtTime;\n      this._time = this._time < 0 ? 0 : this._time;\n    }\n    this._lastStepTime = this._time;\n    this.fire('time', this._time);\n\n    // This is for the case that the timeline was seeked so that the time\n    // is now before the startTime of the runner. That is why we need to set\n    // the runner to position 0\n\n    // FIXME:\n    // However, resetting in insertion order leads to bugs. Considering the case,\n    // where 2 runners change the same attribute but in different times,\n    // resetting both of them will lead to the case where the later defined\n    // runner always wins the reset even if the other runner started earlier\n    // and therefore should win the attribute battle\n    // this can be solved by resetting them backwards\n    for (let k = this._runners.length; k--;) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[k];\n      const runner = runnerInfo.runner;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      // and try to reset it\n      if (dtToStart <= 0) {\n        runner.reset();\n      }\n    }\n\n    // Run all of the runners directly\n    let runnersLeft = false;\n    for (let i = 0, len = this._runners.length; i < len; i++) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[i];\n      const runner = runnerInfo.runner;\n      let dt = dtTime;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      if (dtToStart <= 0) {\n        runnersLeft = true;\n        continue;\n      } else if (dtToStart < dt) {\n        // Adjust dt to make sure that animation is on point\n        dt = dtToStart;\n      }\n      if (!runner.active()) continue;\n\n      // If this runner is still going, signal that we need another animation\n      // frame, otherwise, remove the completed runner\n      const finished = runner.step(dt).done;\n      if (!finished) {\n        runnersLeft = true;\n        // continue\n      } else if (runnerInfo.persist !== true) {\n        // runner is finished. And runner might get removed\n        const endTime = runner.duration() - runner.time() + this._time;\n        if (endTime + runnerInfo.persist < this._time) {\n          // Delete runner and correct index\n          runner.unschedule();\n          --i;\n          --len;\n        }\n      }\n    }\n\n    // Basically: we continue when there are runners right from us in time\n    // when -->, and when runners are left from us when <--\n    if (runnersLeft && !(this._speed < 0 && this._time === 0) || this._runnerIds.length && this._speed < 0 && this._time > 0) {\n      this._continue();\n    } else {\n      this.pause();\n      this.fire('finished');\n    }\n    return this;\n  }\n  terminate() {\n    // cleanup memory\n\n    // Store the timing variables\n    this._startTime = 0;\n    this._speed = 1.0;\n\n    // Determines how long a runner is hold in memory. Can be a dt or true/false\n    this._persist = 0;\n\n    // Keep track of the running animations and their starting parameters\n    this._nextFrame = null;\n    this._paused = true;\n    this._runners = [];\n    this._runnerIds = [];\n    this._lastRunnerId = -1;\n    this._time = 0;\n    this._lastSourceTime = 0;\n    this._lastStepTime = 0;\n\n    // Make sure that step is always called in class context\n    this._step = this._stepFn.bind(this, false);\n    this._stepImmediate = this._stepFn.bind(this, true);\n  }\n}\nregisterMethods({\n  Element: {\n    timeline: function (timeline) {\n      if (timeline == null) {\n        this._timeline = this._timeline || new Timeline();\n        return this._timeline;\n      } else {\n        this._timeline = timeline;\n        return this;\n      }\n    }\n  }\n});\n\nclass Runner extends EventTarget {\n  constructor(options) {\n    super();\n\n    // Store a unique id on the runner, so that we can identify it later\n    this.id = Runner.id++;\n\n    // Ensure a default value\n    options = options == null ? timeline.duration : options;\n\n    // Ensure that we get a controller\n    options = typeof options === 'function' ? new Controller(options) : options;\n\n    // Declare all of the variables\n    this._element = null;\n    this._timeline = null;\n    this.done = false;\n    this._queue = [];\n\n    // Work out the stepper and the duration\n    this._duration = typeof options === 'number' && options;\n    this._isDeclarative = options instanceof Controller;\n    this._stepper = this._isDeclarative ? options : new Ease();\n\n    // We copy the current values from the timeline because they can change\n    this._history = {};\n\n    // Store the state of the runner\n    this.enabled = true;\n    this._time = 0;\n    this._lastTime = 0;\n\n    // At creation, the runner is in reset state\n    this._reseted = true;\n\n    // Save transforms applied to this runner\n    this.transforms = new Matrix();\n    this.transformId = 1;\n\n    // Looping variables\n    this._haveReversed = false;\n    this._reverse = false;\n    this._loopsDone = 0;\n    this._swing = false;\n    this._wait = 0;\n    this._times = 1;\n    this._frameId = null;\n\n    // Stores how long a runner is stored after being done\n    this._persist = this._isDeclarative ? true : null;\n  }\n  static sanitise(duration, delay, when) {\n    // Initialise the default parameters\n    let times = 1;\n    let swing = false;\n    let wait = 0;\n    duration = duration ?? timeline.duration;\n    delay = delay ?? timeline.delay;\n    when = when || 'last';\n\n    // If we have an object, unpack the values\n    if (typeof duration === 'object' && !(duration instanceof Stepper)) {\n      delay = duration.delay ?? delay;\n      when = duration.when ?? when;\n      swing = duration.swing || swing;\n      times = duration.times ?? times;\n      wait = duration.wait ?? wait;\n      duration = duration.duration ?? timeline.duration;\n    }\n    return {\n      duration: duration,\n      delay: delay,\n      swing: swing,\n      times: times,\n      wait: wait,\n      when: when\n    };\n  }\n  active(enabled) {\n    if (enabled == null) return this.enabled;\n    this.enabled = enabled;\n    return this;\n  }\n\n  /*\n  Private Methods\n  ===============\n  Methods that shouldn't be used externally\n  */\n  addTransform(transform) {\n    this.transforms.lmultiplyO(transform);\n    return this;\n  }\n  after(fn) {\n    return this.on('finished', fn);\n  }\n  animate(duration, delay, when) {\n    const o = Runner.sanitise(duration, delay, when);\n    const runner = new Runner(o.duration);\n    if (this._timeline) runner.timeline(this._timeline);\n    if (this._element) runner.element(this._element);\n    return runner.loop(o).schedule(o.delay, o.when);\n  }\n  clearTransform() {\n    this.transforms = new Matrix();\n    return this;\n  }\n\n  // TODO: Keep track of all transformations so that deletion is faster\n  clearTransformsFromQueue() {\n    if (!this.done || !this._timeline || !this._timeline._runnerIds.includes(this.id)) {\n      this._queue = this._queue.filter(item => {\n        return !item.isTransform;\n      });\n    }\n  }\n  delay(delay) {\n    return this.animate(0, delay);\n  }\n  duration() {\n    return this._times * (this._wait + this._duration) - this._wait;\n  }\n  during(fn) {\n    return this.queue(null, fn);\n  }\n  ease(fn) {\n    this._stepper = new Ease(fn);\n    return this;\n  }\n  /*\n  Runner Definitions\n  ==================\n  These methods help us define the runtime behaviour of the Runner or they\n  help us make new runners from the current runner\n  */\n\n  element(element) {\n    if (element == null) return this._element;\n    this._element = element;\n    element._prepareRunner();\n    return this;\n  }\n  finish() {\n    return this.step(Infinity);\n  }\n  loop(times, swing, wait) {\n    // Deal with the user passing in an object\n    if (typeof times === 'object') {\n      swing = times.swing;\n      wait = times.wait;\n      times = times.times;\n    }\n\n    // Sanitise the values and store them\n    this._times = times || Infinity;\n    this._swing = swing || false;\n    this._wait = wait || 0;\n\n    // Allow true to be passed\n    if (this._times === true) {\n      this._times = Infinity;\n    }\n    return this;\n  }\n  loops(p) {\n    const loopDuration = this._duration + this._wait;\n    if (p == null) {\n      const loopsDone = Math.floor(this._time / loopDuration);\n      const relativeTime = this._time - loopsDone * loopDuration;\n      const position = relativeTime / this._duration;\n      return Math.min(loopsDone + position, this._times);\n    }\n    const whole = Math.floor(p);\n    const partial = p % 1;\n    const time = loopDuration * whole + this._duration * partial;\n    return this.time(time);\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  position(p) {\n    // Get all of the variables we need\n    const x = this._time;\n    const d = this._duration;\n    const w = this._wait;\n    const t = this._times;\n    const s = this._swing;\n    const r = this._reverse;\n    let position;\n    if (p == null) {\n      /*\n      This function converts a time to a position in the range [0, 1]\n      The full explanation can be found in this desmos demonstration\n        https://www.desmos.com/calculator/u4fbavgche\n      The logic is slightly simplified here because we can use booleans\n      */\n\n      // Figure out the value without thinking about the start or end time\n      const f = function (x) {\n        const swinging = s * Math.floor(x % (2 * (w + d)) / (w + d));\n        const backwards = swinging && !r || !swinging && r;\n        const uncliped = Math.pow(-1, backwards) * (x % (w + d)) / d + backwards;\n        const clipped = Math.max(Math.min(uncliped, 1), 0);\n        return clipped;\n      };\n\n      // Figure out the value by incorporating the start time\n      const endTime = t * (w + d) - w;\n      position = x <= 0 ? Math.round(f(1e-5)) : x < endTime ? f(x) : Math.round(f(endTime - 1e-5));\n      return position;\n    }\n\n    // Work out the loops done and add the position to the loops done\n    const loopsDone = Math.floor(this.loops());\n    const swingForward = s && loopsDone % 2 === 0;\n    const forwards = swingForward && !r || r && swingForward;\n    position = loopsDone + (forwards ? p : 1 - p);\n    return this.loops(position);\n  }\n  progress(p) {\n    if (p == null) {\n      return Math.min(1, this._time / this.duration());\n    }\n    return this.time(p * this.duration());\n  }\n\n  /*\n  Basic Functionality\n  ===================\n  These methods allow us to attach basic functions to the runner directly\n  */\n  queue(initFn, runFn, retargetFn, isTransform) {\n    this._queue.push({\n      initialiser: initFn || noop,\n      runner: runFn || noop,\n      retarget: retargetFn,\n      isTransform: isTransform,\n      initialised: false,\n      finished: false\n    });\n    const timeline = this.timeline();\n    timeline && this.timeline()._continue();\n    return this;\n  }\n  reset() {\n    if (this._reseted) return this;\n    this.time(0);\n    this._reseted = true;\n    return this;\n  }\n  reverse(reverse) {\n    this._reverse = reverse == null ? !this._reverse : reverse;\n    return this;\n  }\n  schedule(timeline, delay, when) {\n    // The user doesn't need to pass a timeline if we already have one\n    if (!(timeline instanceof Timeline)) {\n      when = delay;\n      delay = timeline;\n      timeline = this.timeline();\n    }\n\n    // If there is no timeline, yell at the user...\n    if (!timeline) {\n      throw Error('Runner cannot be scheduled without timeline');\n    }\n\n    // Schedule the runner on the timeline provided\n    timeline.schedule(this, delay, when);\n    return this;\n  }\n  step(dt) {\n    // If we are inactive, this stepper just gets skipped\n    if (!this.enabled) return this;\n\n    // Update the time and get the new position\n    dt = dt == null ? 16 : dt;\n    this._time += dt;\n    const position = this.position();\n\n    // Figure out if we need to run the stepper in this frame\n    const running = this._lastPosition !== position && this._time >= 0;\n    this._lastPosition = position;\n\n    // Figure out if we just started\n    const duration = this.duration();\n    const justStarted = this._lastTime <= 0 && this._time > 0;\n    const justFinished = this._lastTime < duration && this._time >= duration;\n    this._lastTime = this._time;\n    if (justStarted) {\n      this.fire('start', this);\n    }\n\n    // Work out if the runner is finished set the done flag here so animations\n    // know, that they are running in the last step (this is good for\n    // transformations which can be merged)\n    const declarative = this._isDeclarative;\n    this.done = !declarative && !justFinished && this._time >= duration;\n\n    // Runner is running. So its not in reset state anymore\n    this._reseted = false;\n    let converged = false;\n    // Call initialise and the run function\n    if (running || declarative) {\n      this._initialise(running);\n\n      // clear the transforms on this runner so they dont get added again and again\n      this.transforms = new Matrix();\n      converged = this._run(declarative ? dt : position);\n      this.fire('step', this);\n    }\n    // correct the done flag here\n    // declarative animations itself know when they converged\n    this.done = this.done || converged && declarative;\n    if (justFinished) {\n      this.fire('finished', this);\n    }\n    return this;\n  }\n\n  /*\n  Runner animation methods\n  ========================\n  Control how the animation plays\n  */\n  time(time) {\n    if (time == null) {\n      return this._time;\n    }\n    const dt = time - this._time;\n    this.step(dt);\n    return this;\n  }\n  timeline(timeline) {\n    // check explicitly for undefined so we can set the timeline to null\n    if (typeof timeline === 'undefined') return this._timeline;\n    this._timeline = timeline;\n    return this;\n  }\n  unschedule() {\n    const timeline = this.timeline();\n    timeline && timeline.unschedule(this);\n    return this;\n  }\n\n  // Run each initialise function in the runner if required\n  _initialise(running) {\n    // If we aren't running, we shouldn't initialise when not declarative\n    if (!running && !this._isDeclarative) return;\n\n    // Loop through all of the initialisers\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current initialiser\n      const current = this._queue[i];\n\n      // Determine whether we need to initialise\n      const needsIt = this._isDeclarative || !current.initialised && running;\n      running = !current.finished;\n\n      // Call the initialiser if we need to\n      if (needsIt && running) {\n        current.initialiser.call(this);\n        current.initialised = true;\n      }\n    }\n  }\n\n  // Save a morpher to the morpher list so that we can retarget it later\n  _rememberMorpher(method, morpher) {\n    this._history[method] = {\n      morpher: morpher,\n      caller: this._queue[this._queue.length - 1]\n    };\n\n    // We have to resume the timeline in case a controller\n    // is already done without being ever run\n    // This can happen when e.g. this is done:\n    //    anim = el.animate(new SVG.Spring)\n    // and later\n    //    anim.move(...)\n    if (this._isDeclarative) {\n      const timeline = this.timeline();\n      timeline && timeline.play();\n    }\n  }\n\n  // Try to set the target for a morpher if the morpher exists, otherwise\n  // Run each run function for the position or dt given\n  _run(positionOrDt) {\n    // Run all of the _queue directly\n    let allfinished = true;\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current function to run\n      const current = this._queue[i];\n\n      // Run the function if its not finished, we keep track of the finished\n      // flag for the sake of declarative _queue\n      const converged = current.runner.call(this, positionOrDt);\n      current.finished = current.finished || converged === true;\n      allfinished = allfinished && current.finished;\n    }\n\n    // We report when all of the constructors are finished\n    return allfinished;\n  }\n\n  // do nothing and return false\n  _tryRetarget(method, target, extra) {\n    if (this._history[method]) {\n      // if the last method wasn't even initialised, throw it away\n      if (!this._history[method].caller.initialised) {\n        const index = this._queue.indexOf(this._history[method].caller);\n        this._queue.splice(index, 1);\n        return false;\n      }\n\n      // for the case of transformations, we use the special retarget function\n      // which has access to the outer scope\n      if (this._history[method].caller.retarget) {\n        this._history[method].caller.retarget.call(this, target, extra);\n        // for everything else a simple morpher change is sufficient\n      } else {\n        this._history[method].morpher.to(target);\n      }\n      this._history[method].caller.finished = false;\n      const timeline = this.timeline();\n      timeline && timeline.play();\n      return true;\n    }\n    return false;\n  }\n}\nRunner.id = 0;\nclass FakeRunner {\n  constructor(transforms = new Matrix(), id = -1, done = true) {\n    this.transforms = transforms;\n    this.id = id;\n    this.done = done;\n  }\n  clearTransformsFromQueue() {}\n}\nextend([Runner, FakeRunner], {\n  mergeWith(runner) {\n    return new FakeRunner(runner.transforms.lmultiply(this.transforms), runner.id);\n  }\n});\n\n// FakeRunner.emptyRunner = new FakeRunner()\n\nconst lmultiply = (last, curr) => last.lmultiplyO(curr);\nconst getRunnerTransform = runner => runner.transforms;\nfunction mergeTransforms() {\n  // Find the matrix to apply to the element and apply it\n  const runners = this._transformationRunners.runners;\n  const netTransform = runners.map(getRunnerTransform).reduce(lmultiply, new Matrix());\n  this.transform(netTransform);\n  this._transformationRunners.merge();\n  if (this._transformationRunners.length() === 1) {\n    this._frameId = null;\n  }\n}\nclass RunnerArray {\n  constructor() {\n    this.runners = [];\n    this.ids = [];\n  }\n  add(runner) {\n    if (this.runners.includes(runner)) return;\n    const id = runner.id + 1;\n    this.runners.push(runner);\n    this.ids.push(id);\n    return this;\n  }\n  clearBefore(id) {\n    const deleteCnt = this.ids.indexOf(id + 1) || 1;\n    this.ids.splice(0, deleteCnt, 0);\n    this.runners.splice(0, deleteCnt, new FakeRunner()).forEach(r => r.clearTransformsFromQueue());\n    return this;\n  }\n  edit(id, newRunner) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1, id + 1);\n    this.runners.splice(index, 1, newRunner);\n    return this;\n  }\n  getByID(id) {\n    return this.runners[this.ids.indexOf(id + 1)];\n  }\n  length() {\n    return this.ids.length;\n  }\n  merge() {\n    let lastRunner = null;\n    for (let i = 0; i < this.runners.length; ++i) {\n      const runner = this.runners[i];\n      const condition = lastRunner && runner.done && lastRunner.done && (\n      // don't merge runner when persisted on timeline\n      !runner._timeline || !runner._timeline._runnerIds.includes(runner.id)) && (!lastRunner._timeline || !lastRunner._timeline._runnerIds.includes(lastRunner.id));\n      if (condition) {\n        // the +1 happens in the function\n        this.remove(runner.id);\n        const newRunner = runner.mergeWith(lastRunner);\n        this.edit(lastRunner.id, newRunner);\n        lastRunner = newRunner;\n        --i;\n      } else {\n        lastRunner = runner;\n      }\n    }\n    return this;\n  }\n  remove(id) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1);\n    this.runners.splice(index, 1);\n    return this;\n  }\n}\nregisterMethods({\n  Element: {\n    animate(duration, delay, when) {\n      const o = Runner.sanitise(duration, delay, when);\n      const timeline = this.timeline();\n      return new Runner(o.duration).loop(o).element(this).timeline(timeline.play()).schedule(o.delay, o.when);\n    },\n    delay(by, when) {\n      return this.animate(0, by, when);\n    },\n    // this function searches for all runners on the element and deletes the ones\n    // which run before the current one. This is because absolute transformations\n    // overwrite anything anyway so there is no need to waste time computing\n    // other runners\n    _clearTransformRunnersBefore(currentRunner) {\n      this._transformationRunners.clearBefore(currentRunner.id);\n    },\n    _currentTransform(current) {\n      return this._transformationRunners.runners\n      // we need the equal sign here to make sure, that also transformations\n      // on the same runner which execute before the current transformation are\n      // taken into account\n      .filter(runner => runner.id <= current.id).map(getRunnerTransform).reduce(lmultiply, new Matrix());\n    },\n    _addRunner(runner) {\n      this._transformationRunners.add(runner);\n\n      // Make sure that the runner merge is executed at the very end of\n      // all Animator functions. That is why we use immediate here to execute\n      // the merge right after all frames are run\n      Animator.cancelImmediate(this._frameId);\n      this._frameId = Animator.immediate(mergeTransforms.bind(this));\n    },\n    _prepareRunner() {\n      if (this._frameId == null) {\n        this._transformationRunners = new RunnerArray().add(new FakeRunner(new Matrix(this)));\n      }\n    }\n  }\n});\n\n// Will output the elements from array A that are not in the array B\nconst difference = (a, b) => a.filter(x => !b.includes(x));\nextend(Runner, {\n  attr(a, v) {\n    return this.styleAttr('attr', a, v);\n  },\n  // Add animatable styles\n  css(s, v) {\n    return this.styleAttr('css', s, v);\n  },\n  styleAttr(type, nameOrAttrs, val) {\n    if (typeof nameOrAttrs === 'string') {\n      return this.styleAttr(type, {\n        [nameOrAttrs]: val\n      });\n    }\n    let attrs = nameOrAttrs;\n    if (this._tryRetarget(type, attrs)) return this;\n    let morpher = new Morphable(this._stepper).to(attrs);\n    let keys = Object.keys(attrs);\n    this.queue(function () {\n      morpher = morpher.from(this.element()[type](keys));\n    }, function (pos) {\n      this.element()[type](morpher.at(pos).valueOf());\n      return morpher.done();\n    }, function (newToAttrs) {\n      // Check if any new keys were added\n      const newKeys = Object.keys(newToAttrs);\n      const differences = difference(newKeys, keys);\n\n      // If their are new keys, initialize them and add them to morpher\n      if (differences.length) {\n        // Get the values\n        const addedFromAttrs = this.element()[type](differences);\n\n        // Get the already initialized values\n        const oldFromAttrs = new ObjectBag(morpher.from()).valueOf();\n\n        // Merge old and new\n        Object.assign(oldFromAttrs, addedFromAttrs);\n        morpher.from(oldFromAttrs);\n      }\n\n      // Get the object from the morpher\n      const oldToAttrs = new ObjectBag(morpher.to()).valueOf();\n\n      // Merge in new attributes\n      Object.assign(oldToAttrs, newToAttrs);\n\n      // Change morpher target\n      morpher.to(oldToAttrs);\n\n      // Make sure that we save the work we did so we don't need it to do again\n      keys = newKeys;\n      attrs = newToAttrs;\n    });\n    this._rememberMorpher(type, morpher);\n    return this;\n  },\n  zoom(level, point) {\n    if (this._tryRetarget('zoom', level, point)) return this;\n    let morpher = new Morphable(this._stepper).to(new SVGNumber(level));\n    this.queue(function () {\n      morpher = morpher.from(this.element().zoom());\n    }, function (pos) {\n      this.element().zoom(morpher.at(pos), point);\n      return morpher.done();\n    }, function (newLevel, newPoint) {\n      point = newPoint;\n      morpher.to(newLevel);\n    });\n    this._rememberMorpher('zoom', morpher);\n    return this;\n  },\n  /**\n   ** absolute transformations\n   **/\n\n  //\n  // M v -----|-----(D M v = F v)------|----->  T v\n  //\n  // 1. define the final state (T) and decompose it (once)\n  //    t = [tx, ty, the, lam, sy, sx]\n  // 2. on every frame: pull the current state of all previous transforms\n  //    (M - m can change)\n  //   and then write this as m = [tx0, ty0, the0, lam0, sy0, sx0]\n  // 3. Find the interpolated matrix F(pos) = m + pos * (t - m)\n  //   - Note F(0) = M\n  //   - Note F(1) = T\n  // 4. Now you get the delta matrix as a result: D = F * inv(M)\n\n  transform(transforms, relative, affine) {\n    // If we have a declarative function, we should retarget it if possible\n    relative = transforms.relative || relative;\n    if (this._isDeclarative && !relative && this._tryRetarget('transform', transforms)) {\n      return this;\n    }\n\n    // Parse the parameters\n    const isMatrix = Matrix.isMatrixLike(transforms);\n    affine = transforms.affine != null ? transforms.affine : affine != null ? affine : !isMatrix;\n\n    // Create a morpher and set its type\n    const morpher = new Morphable(this._stepper).type(affine ? TransformBag : Matrix);\n    let origin;\n    let element;\n    let current;\n    let currentAngle;\n    let startTransform;\n    function setup() {\n      // make sure element and origin is defined\n      element = element || this.element();\n      origin = origin || getOrigin(transforms, element);\n      startTransform = new Matrix(relative ? undefined : element);\n\n      // add the runner to the element so it can merge transformations\n      element._addRunner(this);\n\n      // Deactivate all transforms that have run so far if we are absolute\n      if (!relative) {\n        element._clearTransformRunnersBefore(this);\n      }\n    }\n    function run(pos) {\n      // clear all other transforms before this in case something is saved\n      // on this runner. We are absolute. We dont need these!\n      if (!relative) this.clearTransform();\n      const {\n        x,\n        y\n      } = new Point(origin).transform(element._currentTransform(this));\n      let target = new Matrix({\n        ...transforms,\n        origin: [x, y]\n      });\n      let start = this._isDeclarative && current ? current : startTransform;\n      if (affine) {\n        target = target.decompose(x, y);\n        start = start.decompose(x, y);\n\n        // Get the current and target angle as it was set\n        const rTarget = target.rotate;\n        const rCurrent = start.rotate;\n\n        // Figure out the shortest path to rotate directly\n        const possibilities = [rTarget - 360, rTarget, rTarget + 360];\n        const distances = possibilities.map(a => Math.abs(a - rCurrent));\n        const shortest = Math.min(...distances);\n        const index = distances.indexOf(shortest);\n        target.rotate = possibilities[index];\n      }\n      if (relative) {\n        // we have to be careful here not to overwrite the rotation\n        // with the rotate method of Matrix\n        if (!isMatrix) {\n          target.rotate = transforms.rotate || 0;\n        }\n        if (this._isDeclarative && currentAngle) {\n          start.rotate = currentAngle;\n        }\n      }\n      morpher.from(start);\n      morpher.to(target);\n      const affineParameters = morpher.at(pos);\n      currentAngle = affineParameters.rotate;\n      current = new Matrix(affineParameters);\n      this.addTransform(current);\n      element._addRunner(this);\n      return morpher.done();\n    }\n    function retarget(newTransforms) {\n      // only get a new origin if it changed since the last call\n      if ((newTransforms.origin || 'center').toString() !== (transforms.origin || 'center').toString()) {\n        origin = getOrigin(newTransforms, element);\n      }\n\n      // overwrite the old transformations with the new ones\n      transforms = {\n        ...newTransforms,\n        origin\n      };\n    }\n    this.queue(setup, run, retarget, true);\n    this._isDeclarative && this._rememberMorpher('transform', morpher);\n    return this;\n  },\n  // Animatable x-axis\n  x(x) {\n    return this._queueNumber('x', x);\n  },\n  // Animatable y-axis\n  y(y) {\n    return this._queueNumber('y', y);\n  },\n  ax(x) {\n    return this._queueNumber('ax', x);\n  },\n  ay(y) {\n    return this._queueNumber('ay', y);\n  },\n  dx(x = 0) {\n    return this._queueNumberDelta('x', x);\n  },\n  dy(y = 0) {\n    return this._queueNumberDelta('y', y);\n  },\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  },\n  _queueNumberDelta(method, to) {\n    to = new SVGNumber(to);\n\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    let from = null;\n    this.queue(function () {\n      from = this.element()[method]();\n      morpher.from(from);\n      morpher.to(from + to);\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    }, function (newTo) {\n      morpher.to(from + new SVGNumber(newTo));\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueObject(method, to) {\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    this.queue(function () {\n      morpher.from(this.element()[method]());\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueNumber(method, value) {\n    return this._queueObject(method, new SVGNumber(value));\n  },\n  // Animatable center x-axis\n  cx(x) {\n    return this._queueNumber('cx', x);\n  },\n  // Animatable center y-axis\n  cy(y) {\n    return this._queueNumber('cy', y);\n  },\n  // Add animatable move\n  move(x, y) {\n    return this.x(x).y(y);\n  },\n  amove(x, y) {\n    return this.ax(x).ay(y);\n  },\n  // Add animatable center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  },\n  // Add animatable size\n  size(width, height) {\n    // animate bbox based size for all other elements\n    let box;\n    if (!width || !height) {\n      box = this._element.bbox();\n    }\n    if (!width) {\n      width = box.width / box.height * height;\n    }\n    if (!height) {\n      height = box.height / box.width * width;\n    }\n    return this.width(width).height(height);\n  },\n  // Add animatable width\n  width(width) {\n    return this._queueNumber('width', width);\n  },\n  // Add animatable height\n  height(height) {\n    return this._queueNumber('height', height);\n  },\n  // Add animatable plot\n  plot(a, b, c, d) {\n    // Lines can be plotted with 4 arguments\n    if (arguments.length === 4) {\n      return this.plot([a, b, c, d]);\n    }\n    if (this._tryRetarget('plot', a)) return this;\n    const morpher = new Morphable(this._stepper).type(this._element.MorphArray).to(a);\n    this.queue(function () {\n      morpher.from(this._element.array());\n    }, function (pos) {\n      this._element.plot(morpher.at(pos));\n      return morpher.done();\n    });\n    this._rememberMorpher('plot', morpher);\n    return this;\n  },\n  // Add leading method\n  leading(value) {\n    return this._queueNumber('leading', value);\n  },\n  // Add animatable viewbox\n  viewbox(x, y, width, height) {\n    return this._queueObject('viewbox', new Box(x, y, width, height));\n  },\n  update(o) {\n    if (typeof o !== 'object') {\n      return this.update({\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      });\n    }\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', o.offset);\n    return this;\n  }\n});\nextend(Runner, {\n  rx,\n  ry,\n  from,\n  to\n});\nregister(Runner, 'Runner');\n\nclass Svg extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('svg', node), attrs);\n    this.namespace();\n  }\n\n  // Creates and returns defs element\n  defs() {\n    if (!this.isRoot()) return this.root().defs();\n    return adopt(this.node.querySelector('defs')) || this.put(new Defs());\n  }\n  isRoot() {\n    return !this.node.parentNode || !(this.node.parentNode instanceof globals.window.SVGElement) && this.node.parentNode.nodeName !== '#document-fragment';\n  }\n\n  // Add namespaces\n  namespace() {\n    if (!this.isRoot()) return this.root().namespace();\n    return this.attr({\n      xmlns: svg,\n      version: '1.1'\n    }).attr('xmlns:xlink', xlink, xmlns);\n  }\n  removeNamespace() {\n    return this.attr({\n      xmlns: null,\n      version: null\n    }).attr('xmlns:xlink', null, xmlns).attr('xmlns:svgjs', null, xmlns);\n  }\n\n  // Check if this is a root svg\n  // If not, call root() from this element\n  root() {\n    if (this.isRoot()) return this;\n    return super.root();\n  }\n}\nregisterMethods({\n  Container: {\n    // Create nested svg document\n    nested: wrapWithAttrCheck(function () {\n      return this.put(new Svg());\n    })\n  }\n});\nregister(Svg, 'Svg', true);\n\nclass Symbol extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('symbol', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    symbol: wrapWithAttrCheck(function () {\n      return this.put(new Symbol());\n    })\n  }\n});\nregister(Symbol, 'Symbol');\n\n// Create plain text node\nfunction plain(text) {\n  // clear if build mode is disabled\n  if (this._build === false) {\n    this.clear();\n  }\n\n  // create text node\n  this.node.appendChild(globals.document.createTextNode(text));\n  return this;\n}\n\n// Get length of text element\nfunction length() {\n  return this.node.getComputedTextLength();\n}\n\n// Move over x-axis\n// Text is moved by its bounding box\n// text-anchor does NOT matter\nfunction x$1(x, box = this.bbox()) {\n  if (x == null) {\n    return box.x;\n  }\n  return this.attr('x', this.attr('x') + x - box.x);\n}\n\n// Move over y-axis\nfunction y$1(y, box = this.bbox()) {\n  if (y == null) {\n    return box.y;\n  }\n  return this.attr('y', this.attr('y') + y - box.y);\n}\nfunction move$1(x, y, box = this.bbox()) {\n  return this.x(x, box).y(y, box);\n}\n\n// Move center over x-axis\nfunction cx(x, box = this.bbox()) {\n  if (x == null) {\n    return box.cx;\n  }\n  return this.attr('x', this.attr('x') + x - box.cx);\n}\n\n// Move center over y-axis\nfunction cy(y, box = this.bbox()) {\n  if (y == null) {\n    return box.cy;\n  }\n  return this.attr('y', this.attr('y') + y - box.cy);\n}\nfunction center(x, y, box = this.bbox()) {\n  return this.cx(x, box).cy(y, box);\n}\nfunction ax(x) {\n  return this.attr('x', x);\n}\nfunction ay(y) {\n  return this.attr('y', y);\n}\nfunction amove(x, y) {\n  return this.ax(x).ay(y);\n}\n\n// Enable / disable build mode\nfunction build(build) {\n  this._build = !!build;\n  return this;\n}\n\nvar textable = {\n  __proto__: null,\n  amove: amove,\n  ax: ax,\n  ay: ay,\n  build: build,\n  center: center,\n  cx: cx,\n  cy: cy,\n  length: length,\n  move: move$1,\n  plain: plain,\n  x: x$1,\n  y: y$1\n};\n\nclass Text extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('text', node), attrs);\n    this.dom.leading = this.dom.leading ?? new SVGNumber(1.3); // store leading value for rebuilding\n    this._rebuild = true; // enable automatic updating of dy values\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Set / get leading\n  leading(value) {\n    // act as getter\n    if (value == null) {\n      return this.dom.leading;\n    }\n\n    // act as setter\n    this.dom.leading = new SVGNumber(value);\n    return this.rebuild();\n  }\n\n  // Rebuild appearance type\n  rebuild(rebuild) {\n    // store new rebuild flag if given\n    if (typeof rebuild === 'boolean') {\n      this._rebuild = rebuild;\n    }\n\n    // define position of all lines\n    if (this._rebuild) {\n      const self = this;\n      let blankLineOffset = 0;\n      const leading = this.dom.leading;\n      this.each(function (i) {\n        if (isDescriptive(this.node)) return;\n        const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n        const dy = leading * new SVGNumber(fontSize);\n        if (this.dom.newLined) {\n          this.attr('x', self.attr('x'));\n          if (this.text() === '\\n') {\n            blankLineOffset += dy;\n          } else {\n            this.attr('dy', i ? dy + blankLineOffset : 0);\n            blankLineOffset = 0;\n          }\n        }\n      });\n      this.fire('rebuild');\n    }\n    return this;\n  }\n\n  // overwrite method from parent to set data properly\n  setData(o) {\n    this.dom = o;\n    this.dom.leading = new SVGNumber(o.leading || 1.3);\n    return this;\n  }\n  writeDataToDom() {\n    writeDataToDom(this, this.dom, {\n      leading: 1.3\n    });\n    return this;\n  }\n\n  // Set the text content\n  text(text) {\n    // act as getter\n    if (text === undefined) {\n      const children = this.node.childNodes;\n      let firstLine = 0;\n      text = '';\n      for (let i = 0, len = children.length; i < len; ++i) {\n        // skip textPaths - they are no lines\n        if (children[i].nodeName === 'textPath' || isDescriptive(children[i])) {\n          if (i === 0) firstLine = i + 1;\n          continue;\n        }\n\n        // add newline if its not the first child and newLined is set to true\n        if (i !== firstLine && children[i].nodeType !== 3 && adopt(children[i]).dom.newLined === true) {\n          text += '\\n';\n        }\n\n        // add content of this node\n        text += children[i].textContent;\n      }\n      return text;\n    }\n\n    // remove existing content\n    this.clear().build(true);\n    if (typeof text === 'function') {\n      // call block\n      text.call(this, this);\n    } else {\n      // store text and make sure text is not blank\n      text = (text + '').split('\\n');\n\n      // build new lines\n      for (let j = 0, jl = text.length; j < jl; j++) {\n        this.newLine(text[j]);\n      }\n    }\n\n    // disable build mode and rebuild lines\n    return this.build(false).rebuild();\n  }\n}\nextend(Text, textable);\nregisterMethods({\n  Container: {\n    // Create text element\n    text: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).text(text);\n    }),\n    // Create plain text element\n    plain: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).plain(text);\n    })\n  }\n});\nregister(Text, 'Text');\n\nclass Tspan extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('tspan', node), attrs);\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Shortcut dx\n  dx(dx) {\n    return this.attr('dx', dx);\n  }\n\n  // Shortcut dy\n  dy(dy) {\n    return this.attr('dy', dy);\n  }\n\n  // Create new line\n  newLine() {\n    // mark new line\n    this.dom.newLined = true;\n\n    // fetch parent\n    const text = this.parent();\n\n    // early return in case we are not in a text element\n    if (!(text instanceof Text)) {\n      return this;\n    }\n    const i = text.index(this);\n    const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n    const dy = text.dom.leading * new SVGNumber(fontSize);\n\n    // apply new position\n    return this.dy(i ? dy : 0).attr('x', text.x());\n  }\n\n  // Set text content\n  text(text) {\n    if (text == null) return this.node.textContent + (this.dom.newLined ? '\\n' : '');\n    if (typeof text === 'function') {\n      this.clear().build(true);\n      text.call(this, this);\n      this.build(false);\n    } else {\n      this.plain(text);\n    }\n    return this;\n  }\n}\nextend(Tspan, textable);\nregisterMethods({\n  Tspan: {\n    tspan: wrapWithAttrCheck(function (text = '') {\n      const tspan = new Tspan();\n\n      // clear if build mode is disabled\n      if (!this._build) {\n        this.clear();\n      }\n\n      // add new tspan\n      return this.put(tspan).text(text);\n    })\n  },\n  Text: {\n    newLine: function (text = '') {\n      return this.tspan(text).newLine();\n    }\n  }\n});\nregister(Tspan, 'Tspan');\n\nclass Circle extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('circle', node), attrs);\n  }\n  radius(r) {\n    return this.attr('r', r);\n  }\n\n  // Radius x value\n  rx(rx) {\n    return this.attr('r', rx);\n  }\n\n  // Alias radius x value\n  ry(ry) {\n    return this.rx(ry);\n  }\n  size(size) {\n    return this.radius(new SVGNumber(size).divide(2));\n  }\n}\nextend(Circle, {\n  x: x$3,\n  y: y$3,\n  cx: cx$1,\n  cy: cy$1,\n  width: width$2,\n  height: height$2\n});\nregisterMethods({\n  Container: {\n    // Create circle element\n    circle: wrapWithAttrCheck(function (size = 0) {\n      return this.put(new Circle()).size(size).move(0, 0);\n    })\n  }\n});\nregister(Circle, 'Circle');\n\nclass ClipPath extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('clipPath', node), attrs);\n  }\n\n  // Unclip all clipped elements and remove itself\n  remove() {\n    // unclip all targets\n    this.targets().forEach(function (el) {\n      el.unclip();\n    });\n\n    // remove clipPath from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [clip-path*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    // Create clipping element\n    clip: wrapWithAttrCheck(function () {\n      return this.defs().put(new ClipPath());\n    })\n  },\n  Element: {\n    // Distribute clipPath to svg element\n    clipper() {\n      return this.reference('clip-path');\n    },\n    clipWith(element) {\n      // use given clip or create a new one\n      const clipper = element instanceof ClipPath ? element : this.parent().clip().add(element);\n\n      // apply mask\n      return this.attr('clip-path', 'url(#' + clipper.id() + ')');\n    },\n    // Unclip element\n    unclip() {\n      return this.attr('clip-path', null);\n    }\n  }\n});\nregister(ClipPath, 'ClipPath');\n\nclass ForeignObject extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('foreignObject', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    foreignObject: wrapWithAttrCheck(function (width, height) {\n      return this.put(new ForeignObject()).size(width, height);\n    })\n  }\n});\nregister(ForeignObject, 'ForeignObject');\n\nfunction dmove(dx, dy) {\n  this.children().forEach(child => {\n    let bbox;\n\n    // We have to wrap this for elements that dont have a bbox\n    // e.g. title and other descriptive elements\n    try {\n      // Get the childs bbox\n      // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1905039\n      // Because bbox for nested svgs returns the contents bbox in the coordinate space of the svg itself (weird!), we cant use bbox for svgs\n      // Therefore we have to use getBoundingClientRect. But THAT is broken (as explained in the bug).\n      // Funnily enough the broken behavior would work for us but that breaks it in chrome\n      // So we have to replicate the broken behavior of FF by just reading the attributes of the svg itself\n      bbox = child.node instanceof getWindow().SVGSVGElement ? new Box(child.attr(['x', 'y', 'width', 'height'])) : child.bbox();\n    } catch (e) {\n      return;\n    }\n\n    // Get childs matrix\n    const m = new Matrix(child);\n    // Translate childs matrix by amount and\n    // transform it back into parents space\n    const matrix = m.translate(dx, dy).transform(m.inverse());\n    // Calculate new x and y from old box\n    const p = new Point(bbox.x, bbox.y).transform(matrix);\n    // Move element\n    child.move(p.x, p.y);\n  });\n  return this;\n}\nfunction dx(dx) {\n  return this.dmove(dx, 0);\n}\nfunction dy(dy) {\n  return this.dmove(0, dy);\n}\nfunction height(height, box = this.bbox()) {\n  if (height == null) return box.height;\n  return this.size(box.width, height, box);\n}\nfunction move(x = 0, y = 0, box = this.bbox()) {\n  const dx = x - box.x;\n  const dy = y - box.y;\n  return this.dmove(dx, dy);\n}\nfunction size(width, height, box = this.bbox()) {\n  const p = proportionalSize(this, width, height, box);\n  const scaleX = p.width / box.width;\n  const scaleY = p.height / box.height;\n  this.children().forEach(child => {\n    const o = new Point(box).transform(new Matrix(child).inverse());\n    child.scale(scaleX, scaleY, o.x, o.y);\n  });\n  return this;\n}\nfunction width(width, box = this.bbox()) {\n  if (width == null) return box.width;\n  return this.size(width, box.height, box);\n}\nfunction x(x, box = this.bbox()) {\n  if (x == null) return box.x;\n  return this.move(x, box.y, box);\n}\nfunction y(y, box = this.bbox()) {\n  if (y == null) return box.y;\n  return this.move(box.x, y, box);\n}\n\nvar containerGeometry = {\n  __proto__: null,\n  dmove: dmove,\n  dx: dx,\n  dy: dy,\n  height: height,\n  move: move,\n  size: size,\n  width: width,\n  x: x,\n  y: y\n};\n\nclass G extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('g', node), attrs);\n  }\n}\nextend(G, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a group element\n    group: wrapWithAttrCheck(function () {\n      return this.put(new G());\n    })\n  }\n});\nregister(G, 'G');\n\nclass A extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('a', node), attrs);\n  }\n\n  // Link target attribute\n  target(target) {\n    return this.attr('target', target);\n  }\n\n  // Link url\n  to(url) {\n    return this.attr('href', url, xlink);\n  }\n}\nextend(A, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a hyperlink element\n    link: wrapWithAttrCheck(function (url) {\n      return this.put(new A()).to(url);\n    })\n  },\n  Element: {\n    unlink() {\n      const link = this.linker();\n      if (!link) return this;\n      const parent = link.parent();\n      if (!parent) {\n        return this.remove();\n      }\n      const index = parent.index(link);\n      parent.add(this, index);\n      link.remove();\n      return this;\n    },\n    linkTo(url) {\n      // reuse old link if possible\n      let link = this.linker();\n      if (!link) {\n        link = new A();\n        this.wrap(link);\n      }\n      if (typeof url === 'function') {\n        url.call(link, link);\n      } else {\n        link.to(url);\n      }\n      return this;\n    },\n    linker() {\n      const link = this.parent();\n      if (link && link.node.nodeName.toLowerCase() === 'a') {\n        return link;\n      }\n      return null;\n    }\n  }\n});\nregister(A, 'A');\n\nclass Mask extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('mask', node), attrs);\n  }\n\n  // Unmask all masked elements and remove itself\n  remove() {\n    // unmask all targets\n    this.targets().forEach(function (el) {\n      el.unmask();\n    });\n\n    // remove mask from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [mask*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    mask: wrapWithAttrCheck(function () {\n      return this.defs().put(new Mask());\n    })\n  },\n  Element: {\n    // Distribute mask to svg element\n    masker() {\n      return this.reference('mask');\n    },\n    maskWith(element) {\n      // use given mask or create a new one\n      const masker = element instanceof Mask ? element : this.parent().mask().add(element);\n\n      // apply mask\n      return this.attr('mask', 'url(#' + masker.id() + ')');\n    },\n    // Unmask element\n    unmask() {\n      return this.attr('mask', null);\n    }\n  }\n});\nregister(Mask, 'Mask');\n\nclass Stop extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('stop', node), attrs);\n  }\n\n  // add color stops\n  update(o) {\n    if (typeof o === 'number' || o instanceof SVGNumber) {\n      o = {\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      };\n    }\n\n    // set attributes\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', new SVGNumber(o.offset));\n    return this;\n  }\n}\nregisterMethods({\n  Gradient: {\n    // Add a color stop\n    stop: function (offset, color, opacity) {\n      return this.put(new Stop()).update(offset, color, opacity);\n    }\n  }\n});\nregister(Stop, 'Stop');\n\nfunction cssRule(selector, rule) {\n  if (!selector) return '';\n  if (!rule) return selector;\n  let ret = selector + '{';\n  for (const i in rule) {\n    ret += unCamelCase(i) + ':' + rule[i] + ';';\n  }\n  ret += '}';\n  return ret;\n}\nclass Style extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('style', node), attrs);\n  }\n  addText(w = '') {\n    this.node.textContent += w;\n    return this;\n  }\n  font(name, src, params = {}) {\n    return this.rule('@font-face', {\n      fontFamily: name,\n      src: src,\n      ...params\n    });\n  }\n  rule(selector, obj) {\n    return this.addText(cssRule(selector, obj));\n  }\n}\nregisterMethods('Dom', {\n  style(selector, obj) {\n    return this.put(new Style()).rule(selector, obj);\n  },\n  fontface(name, src, params) {\n    return this.put(new Style()).font(name, src, params);\n  }\n});\nregister(Style, 'Style');\n\nclass TextPath extends Text {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('textPath', node), attrs);\n  }\n\n  // return the array of the path track element\n  array() {\n    const track = this.track();\n    return track ? track.array() : null;\n  }\n\n  // Plot path if any\n  plot(d) {\n    const track = this.track();\n    let pathArray = null;\n    if (track) {\n      pathArray = track.plot(d);\n    }\n    return d == null ? pathArray : this;\n  }\n\n  // Get the path element\n  track() {\n    return this.reference('href');\n  }\n}\nregisterMethods({\n  Container: {\n    textPath: wrapWithAttrCheck(function (text, path) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = this.text(text);\n      }\n      return text.path(path);\n    })\n  },\n  Text: {\n    // Create path for text to run on\n    path: wrapWithAttrCheck(function (track, importNodes = true) {\n      const textPath = new TextPath();\n\n      // if track is a path, reuse it\n      if (!(track instanceof Path)) {\n        // create path element\n        track = this.defs().path(track);\n      }\n\n      // link textPath to path and add content\n      textPath.attr('href', '#' + track, xlink);\n\n      // Transplant all nodes from text to textPath\n      let node;\n      if (importNodes) {\n        while (node = this.node.firstChild) {\n          textPath.node.appendChild(node);\n        }\n      }\n\n      // add textPath element as child node and return textPath\n      return this.put(textPath);\n    }),\n    // Get the textPath children\n    textPath() {\n      return this.findOne('textPath');\n    }\n  },\n  Path: {\n    // creates a textPath from this path\n    text: wrapWithAttrCheck(function (text) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = new Text().addTo(this.parent()).text(text);\n      }\n\n      // Create textPath from text and path and return\n      return text.path(this);\n    }),\n    targets() {\n      return baseFind('svg textPath').filter(node => {\n        return (node.attr('href') || '').includes(this.id());\n      });\n\n      // Does not work in IE11. Use when IE support is dropped\n      // return baseFind('svg textPath[*|href*=' + this.id() + ']')\n    }\n  }\n});\nTextPath.prototype.MorphArray = PathArray;\nregister(TextPath, 'TextPath');\n\nclass Use extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('use', node), attrs);\n  }\n\n  // Use element as a reference\n  use(element, file) {\n    // Set lined element\n    return this.attr('href', (file || '') + '#' + element, xlink);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a use element\n    use: wrapWithAttrCheck(function (element, file) {\n      return this.put(new Use()).use(element, file);\n    })\n  }\n});\nregister(Use, 'Use');\n\n/* Optional Modules */\nconst SVG = makeInstance;\nextend([Svg, Symbol, Image, Pattern, Marker], getMethodsFor('viewbox'));\nextend([Line, Polyline, Polygon, Path], getMethodsFor('marker'));\nextend(Text, getMethodsFor('Text'));\nextend(Path, getMethodsFor('Path'));\nextend(Defs, getMethodsFor('Defs'));\nextend([Text, Tspan], getMethodsFor('Tspan'));\nextend([Rect, Ellipse, Gradient, Runner], getMethodsFor('radius'));\nextend(EventTarget, getMethodsFor('EventTarget'));\nextend(Dom, getMethodsFor('Dom'));\nextend(Element, getMethodsFor('Element'));\nextend(Shape, getMethodsFor('Shape'));\nextend([Container, Fragment], getMethodsFor('Container'));\nextend(Gradient, getMethodsFor('Gradient'));\nextend(Runner, getMethodsFor('Runner'));\nList.extend(getMethodNames());\nregisterMorphableType([SVGNumber, Color, Box, Matrix, SVGArray, PointArray, PathArray, Point]);\nmakeMorphable();\n\nexports.A = A;\nexports.Animator = Animator;\nexports.Array = SVGArray;\nexports.Box = Box;\nexports.Circle = Circle;\nexports.ClipPath = ClipPath;\nexports.Color = Color;\nexports.Container = Container;\nexports.Controller = Controller;\nexports.Defs = Defs;\nexports.Dom = Dom;\nexports.Ease = Ease;\nexports.Element = Element;\nexports.Ellipse = Ellipse;\nexports.EventTarget = EventTarget;\nexports.ForeignObject = ForeignObject;\nexports.Fragment = Fragment;\nexports.G = G;\nexports.Gradient = Gradient;\nexports.Image = Image;\nexports.Line = Line;\nexports.List = List;\nexports.Marker = Marker;\nexports.Mask = Mask;\nexports.Matrix = Matrix;\nexports.Morphable = Morphable;\nexports.NonMorphable = NonMorphable;\nexports.Number = SVGNumber;\nexports.ObjectBag = ObjectBag;\nexports.PID = PID;\nexports.Path = Path;\nexports.PathArray = PathArray;\nexports.Pattern = Pattern;\nexports.Point = Point;\nexports.PointArray = PointArray;\nexports.Polygon = Polygon;\nexports.Polyline = Polyline;\nexports.Queue = Queue;\nexports.Rect = Rect;\nexports.Runner = Runner;\nexports.SVG = SVG;\nexports.Shape = Shape;\nexports.Spring = Spring;\nexports.Stop = Stop;\nexports.Style = Style;\nexports.Svg = Svg;\nexports.Symbol = Symbol;\nexports.Text = Text;\nexports.TextPath = TextPath;\nexports.Timeline = Timeline;\nexports.TransformBag = TransformBag;\nexports.Tspan = Tspan;\nexports.Use = Use;\nexports.adopt = adopt;\nexports.assignNewId = assignNewId;\nexports.clearEvents = clearEvents;\nexports.create = create;\nexports.defaults = defaults;\nexports.dispatch = dispatch;\nexports.easing = easing;\nexports.eid = eid;\nexports.extend = extend;\nexports.find = baseFind;\nexports.getClass = getClass;\nexports.getEventTarget = getEventTarget;\nexports.getEvents = getEvents;\nexports.getWindow = getWindow;\nexports.makeInstance = makeInstance;\nexports.makeMorphable = makeMorphable;\nexports.mockAdopt = mockAdopt;\nexports.namespaces = namespaces;\nexports.nodeOrNew = nodeOrNew;\nexports.off = off;\nexports.on = on;\nexports.parser = parser;\nexports.regex = regex;\nexports.register = register;\nexports.registerMorphableType = registerMorphableType;\nexports.registerWindow = registerWindow;\nexports.restoreWindow = restoreWindow;\nexports.root = root;\nexports.saveWindow = saveWindow;\nexports.utils = utils;\nexports.windowEvents = windowEvents;\nexports.withWindow = withWindow;\nexports.wrapWithAttrCheck = wrapWithAttrCheck;\n//# sourceMappingURL=svg.node.cjs.map\n","import './draggable';\r\nimport './input-box';\r\nimport './node-x-btn';\r\nimport './connector';\r\nimport './comment-drag-handle';\r\nimport './comment-input';\r\nimport './connection-line';","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(8156);\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","moduleId","cachedModule","__webpack_module_cache__","undefined","__webpack_modules__","call","obj","name","Object","prototype","hasOwnProperty","UserState","state","callbacks","constructor","Set","Map","setState","has","add","triggerCallbacks","removeState","delete","hasState","onStateChange","cb","set","get","push","addedOrRemoved","cbs","userState","container","visible","toolbox","document","createElement","className","workspace","_wsTop","appendChild","body","fill","nodes","innerHTML","forEach","node","_headlessNode","type","nodeEl","textContent","labelText","style","backgroundColor","parseColor","colors","primary","padding","cursor","fontFamily","renderer","constants","FONT_FAMILY","fontSize","FONT_SIZE","color","FONT_COLOR","addEventListener","e","ghostEl","position","pointerEvents","moveGhost","ev","left","clientX","top","clientY","releaseGhost","removeEventListener","rect","svg","getBoundingClientRect","right","bottom","svgX","svgY","x","wsX","y","wsY","screenToWorkspace","spawnAt","remove","preventDefault","show","display","hide","clear","register","cls","FieldMap","unregister","Kabel","UIX","events","ContextMenu","Utils","Path","waitFrames","SVG","UID","EventEmitter","hasProp","styler","Styler","escapeHTML","unescapeHTML","Widget","CategoryColors","Connection","Coordinates","Field","DummyField","NumberField","OptConnectField","TextField","inject","InjectMsg","clearMainWorkspace","getMainWorkspace","setMainWorkspace","NodeSvg","Nodes","Widgets","WorkspaceSvg","WorkspaceController","WASDController","nodeRendering","rendererMap","RMap","Renderer","RendererConstants","commentRendering","CommentModel","CommentRenderer","defineProperty","v","initCommentInput","element","rawArgs","measureTextWidth","text","length","displayText","encodeForSvg","txt","attr","font","family","size","anchor","opacity","width","bbox","getSelectionRange","start","Math","min","cursorPos","anchorPos","end","max","hasSelection","deleteSelection","buffer","slice","s","replace","updateText","hasSel","tspan","Array","from","childNodes","child","nodeType","setAttribute","leading","parseFloat","textBeforeStart","textBeforeEnd","highlightX","highlightWidth","highlightY","highlightH","height","selectionRect","console","log","parent","parentNode","insertBefore","move","editing","caretXOffset","caretY","caretH","caretLine","rectW","ceil","PADDING_X","rectH","PADDING_Y","comment","_tempInputBBox","textX","textY","startEditing","getText","localX","offsetX","skipNextClick","onKeyDown","capture","onClickOutside","stopEditing","commit","setTextNoRedraw","getWorkspace","redraw","key","shiftKey","ctrlKey","metaKey","targ","target","args","onRectDown","onTextDown","on","off","registerEvent","randBytes","len","cryptoAPI","getRandomValues","buf","Uint8Array","i","floor","random","uuidv4","g","globalThis","crypto","randomUUID","b","hex","toString","padStart","ulid","date","Date","now","time48","t","BigInt","Number","out","acc","bits","CROCK32","rnd","nanoid","alphabet","DEFAULT_ALPHABET","Error","mask","log2","id","idx","shortId","ts","_ctr","map","join","strategy","opts","_text","_isWorkspaceComment","_parent","svgGroup","relativeCoords","svgLine","generateUID","value","setText","res","clearComments","drawComments","isNodeComment","isWorkspaceComment","NAME","COMMENT_G_TAG","COMMENT_LINE_TAG","COMMENT_TEXT_EL","COMMENT_DRAG_EL","RENDERER_TAG_EL","ensureTspansPreserve","drawComment","getSvg","group","addClass","JSON","stringify","isws","displayEncoded","textEl","userSelect","webkitUserSelect","msUserSelect","MozUserSelect","handleRadius","stroke","radius","back","dragHandle","circle","addElement","tagElement","workspaceX","workspaceY","nodePos","screenPos","workspaceToScreen","_drawLineToNode","refreshCommentTransforms","getComments","_nodeDB","values","n","getComment","filter","c","findOne","nodeScreenPos","nodeBBox","nodeCenterX","nodeCenterY","commentCenterX","commentTopY","line","dasharray","clearAllComments","find","el","destroyByTag","_","clearCommentLines","drawAllComments","_constants","_currentNode","_nodeGroup","_nodeDraw","_ws","_drawStates","_commentDrawer","NODE_G_TAG","ELEMENT_TAG","CONN_LINE_TAG","CONNECTOR_TAG","LINE_X_MARK_TAG","overrides","initCommentRenderer","getWs","enqueueSetConnect","pendingConnections","setConstants","assign","secondary","tertiary","restColors","getNodeBaseMeasurements","NODE_BASE_WIDTH","NODE_BASE_HEIGHT","measureTextHeight","measureRawField","textW","FIELD_RAW_BASE_WIDTH","INPUT_BOX_PADDING","FIELD_RAW_BASE_HEIGHT","measureLabel","field","label","getLabel","measureRaw","hasRaw","raw","getValue","measureCustom","isCustomEditor","m","measureMyself","getFieldMeasurementPadding","FIELD_SPACEX","measureField","parts","w","h","measureNodeDimensions","fieldMeasurements","BASE","totalWidth","totalHeight","labelW","TOPBAR_LABEL_MARGIN_X","TOPBAR_HEIGHT","FIELD_SPACEY","allFields","fldM","FIELD_MARGIN_X","bottomOfField","FIELD_MARGIN_Y","FOOTER_HEIGHT","fields","renderNode","nodeIdOrNode","startNode","drawNode","storeState","ws","getNode","drawFieldRaw","fieldGroup","startX","getDisplayValue","FIELD_RAW_COLOR","FIELD_RAW_OUTLINE_COLOR","FIELD_RAW_OUTLINE_STROKE","INPUT_BOX_TEXT_ANCHOR","FIELD_RAW_TEXT_COLOR","rawBox","box","offsetY","drawFieldLabel","LABEL_SPACING","drawNodeXButton","topbar","measurements","btnSize","xGroup","class","weight","transform","translateX","translateY","xButton","drawConnector","nodeGroup","nodeBg","side","CONNECTOR_TRIANGLE","triSize","CONNECTOR_TRI_SIZE","path","roundedTri","rotatePath","tri","CONNECTOR_RADIUS","circlePath","circ","drawNodeLabel","TOPBAR_LABEL_BOLDED","TOPBAR_LABEL_MARGIN_Y","resolveConnectable","connectable","fromConn","isPrevious","nextConnection","connection","previousConnection","_fillOtherNodeConnectorCircle","conn","connPair","to","toCircle","fromCircle","refreshComments","refreshNodeTransforms","nodeGroups","nodeG","refreshConnectionLines","clearLines","drawLinesForAllNodes","createNodeDrawState","fieldPosY","drawState","tertirary","category","CORNER_RADIUS","bg","roundedRect","NODE_BG_COLOR","NODE_OUTLINE_COLOR","dragel","fieldsGroup","fieldCol","fm","alignX","xUsed","drawMyself","measuredWidth","measuredHeight","background","rawData","cBubbleData","hasConnectable","halfHeight","absY","c3","FIELD_CONN_COLOR","getTo","originCircle","originConn","connector","connState","onDraw","cY","c1","getFrom","c2","fillAllNodeConnectorBubbles","match","flatMap","p","wsSvg","drawnCircles","fromEl","toEl","fromBBox","getBBox","toBBox","fromCTM","getScreenCTM","toCTM","startY","endX","endY","absStartX","a","absStartY","d","f","absEndX","absEndY","pathStr","CONNECTOR_LINE_CURVED","dx","abs","sign","CONNECTOR_LINE_WIDTH","toConn","mark","clearScreen","undoPendingConnsFor","conn0","rerenderNode","findIndex","pendingConn","splice","isSpace","ch","SPECIAL_SPACES","indexOf","isDigit","code","isDigitStart","State","index","result","param","err","segmentStart","data","skipSpaces","charCodeAt","scanFlag","scanParam","zeroFirst","hasCeiling","hasDecimal","hasDot","finalizeSegment","cmd","cmdLC","toLowerCase","params","concat","paramCounts","scanSegment","cmdCode","is_arc","comma_found","need_params","isCommand","l","r","q","z","svgPath","segments","coords","options","static","WIDGET_GLOBAL_ID","border","borderRadius","boxShadow","zIndex","html","init","setCoords","setHTML","reanimate","_addWidgetToDB","destroy","_delWidgetFromDB","Ellipse","rx","ry","ax","epsilon","torad","PI","cos","sin","ma","J","K","D","JK","sqrt","L","l1","l2","atan","isDegenerate","WorkspaceCoords","super","_camera","_root","noRedraw","controller","_widgetDB","_ctxMenu","_commentDB","wsTop","addTo","RClass","resolve","rendererOverrides","Controller","controls","wasd","resolveController","cloneNode","nodeSvg","fromNode","wdgt","newWidget","getWidget","getContentSize","getSize","refresh","drawAllNodes","nodeId","addNode","warn","newNode","derefNode","prev","disconnectTo","ConnectableField","disconnect","next","disconnectFrom","removeNodeById","removeNode","pan","dy","addComment","model","redrawComments","removeComment","commentOrId","startsWith","split","parseInt","trim","isArray","halfW","points","step","sides","angle","cx","cy","rotate","Matrix","operations","matrix","scale","translate","skewX","skewY","CMD_SPLIT_RE","PARAMS_SPLIT_RE","transformString","item","moveSpeed","doAccelerate","accelSpeed","friction","velocity","wasdSmooth","wasdAccelerate","wasdFriction","canMove","update","inputX","inputY","keysDown","handleClick","xMark","pair","includes","midX","midY","center","editable","connectionBubble","canEditConnector","setEditable","val","canEdit","setName","fromJson","json","Boolean","getName","setLabel","fieldVisualInfo","setValue","toJson","deep","String","fldType","setFieldType","fld_type","serialize","DropdownField","_selected","_isOpen","toggle","toggleDropdown","click","getOwner","closeDropdown","openDropdown","items","option","onSelect","original","hideIfOwner","getSelected","setOptions","RendererMap","RendererCls","optName","list","keys","input","DefaultRenderer","xBtnGroup","onClick","combine","m1","m2","queue","cache","tx","ty","sx","sy","rad","tan","toArray","calc","isRelative","mouseBtns","mousePos","lastMousePos","isDragging","wheelDelta","_updateInt","_setupListeners","setInterval","window","button","deltaY","refreshPos","setCamera","pos","centerOn","wsSize","cam","stop","clearInterval","styles","appendStyles","css","styleEl","head","removeStyles","updateStyles","hasStyles","kabelStyles","querySelector","contains","msg","error","wrn","info","proto","_fieldColumn","getCommentText","setCommentText","getFieldByName","fld","getField","getFieldValue","getFieldDisplayValue","emit","INITING","removed","REMOVING","hasCategoryStyle","getCategoryName","getStyle","_appendFieldItem","jsonInit","primaryColor","secondaryColor","tertiaryColor","arguments","applyJsonArguments","FieldConstructor","appendConnection","appendNumber","appendText","appendOptLink","setCategoryName","setStyle","setColor","setLabelText","setConnection","prevOrNext","stringed","cast","other","newField","FieldCls","_serializeConnection","alreadyProcessed","connected","returned","serialized","ContextOptsRegistry","registerOption","opt","onHoverStart","onHoverEnd","showFor","unregisterOption","confirm","widget","listeners","event","handler","payload","once","wrapper","wsOptions","_flyout","_contents","_categories","getOptions","contents","overflowY","initCategoryToolbox","initFlyoutToolbox","cData","mainws","draggableStore","onMouseDown","onMouseMove","onMouseUp","ondrag","movementX","movementY","mouseWS","newX","newY","onmove","enddrag","dragTarget","frames","callback","count","requestAnimationFrame","DropdownContainer","owner","rootEl","constraint","offset","updatePosition","setContent","groupRect","scrollX","scrollY","onclick","current","isVisible","getCurrent","dropdownContainer","onPointerDown","rel","pointerWS","startRelX","startRelY","onPointerMove","onPointerUp","Eventer","elements","eventRegistry","setupFn","tags","tagList","reg","tag","destroyed","destroyFn","types","typeList","setupElement","destroyElement","Function","eventer","unit_vector_angle","ux","uy","vx","vy","dot","acos","approximate_unit_arc","theta1","delta_theta","alpha","x1","y1","x2","y2","TAU","fa","fs","phi","sin_phi","cos_phi","x1p","y1p","lambda","cc","rx_sq","ry_sq","x1p_sq","y1p_sq","radicant","cxp","cyp","v1x","v1y","v2x","v2y","get_arc_center","curve","xp","yp","clone","distanceTo","toObject","PADDING_BIG","PADDING_MEDIUM","PADDING_SMALL","CONNECTION_STROKE_WIDTH","CONNECTION_STROKE_COLOR_CHOICE","SvgPath","pstate","pathParse","__stack","transformParse","a2c","ellipse","src","sgm","__matrix","self","iterate","__evaluateStack","prevCmd","cmdSkipped","segment","degrees","round","contourStartDeltaX","contourStartDeltaY","deltaX","toFixed","iterator","keepLazyStack","j","newSegments","replacements","needReplace","lastX","lastY","countourStartX","countourStartY","nameUC","toUpperCase","nameLC","unarc","new_segments","nextX","nextY","unshort","prevControlX","prevControlY","prevSegment","curControlX","curControlY","cState","one","two","isPrev","removeClass","connA","connB","_rowDiv","_toolbox","_makeDiv","btn","stopPropagation","setDisabled","disabled","toJSON","prevFrom","isolate","rectHeight","textBBox","caretX","rectBox","clickX","cumulativeWidth","charWidth","classList","removeProperty","initListeners","renderOptions","HTMLElement","SVGSVGElement","mouseX","mouseY","elementFromPoint","tagName","hasAttribute","getAttribute","dta","parse","parentElement","registerMethods","_name","addMethodNames","getOwnPropertyNames","methods$1","getMethodsFor","_names","names","array","block","il","radians","unCamelCase","capitalize","charAt","proportionalSize","getOrigin","o","origin","ox","originX","oy","originY","condX","condY","registerWindow","win","doc","globals","saveWindow","save","restoreWindow","getWindow","create","ns","createElementNS","makeInstance","isHTML","Base","adopter","firstChild","removeChild","nodeOrNew","Node","ownerDocument","defaultView","adopt","instance","nodeName","Fragment","asRoot","getClass","eid","did","assignNewId","children","extend","modules","methods","wrapWithAttrCheck","fn","apply","componentHex","component","integer","is","object","space","hueToRgb","closeEnough","parser","cssText","documentElement","isNulledBox","getBox","getBBoxFn","retry","baseFind","query","List","querySelectorAll","getEvents","getEventHolder","windowEvents","getEventTarget","clearEvents","listener","binding","bind","bag","delimiter","_svgjsListenerId","listenerId","namespace","dispatch","Event","CustomEvent","detail","cancelable","dispatchEvent","noop","x$3","y$3","cx$1","cy$1","width$2","SVGNumber","divide","height$2","_element","fx","fy","makeSetterGetter","k","recalculate","duration","_duration","overshoot","_overshoot","pi","os","zeta","wn","segmentComplete","segmentParameters","startNewSegment","token","inNumber","finalizeNumber","pathLetter","isPathLetter","test","lastCommand","small","isSmall","inSegment","number","pointSeen","hasExponent","absolute","command","pathHandlers","p0","makeAbsolut","isArcFlag","isArc","isExponential","lastToken","registerMorphableType","morphableTypes","makeMorphable","Morphable","fromArray","arr","toConsumable","morph","stepper","context","mergeTransforms","netTransform","_transformationRunners","runners","getRunnerTransform","reduce","lmultiply","merge","_frameId","descriptiveElements","isDescriptive","writeDataToDom","defaults","cloned","valueOf","removeAttribute","utils","__proto__","xmlns","xlink","namespaces","siblings","forward","backward","front","before","after","insertAfter","numberAndUnit","rgb","reference","transforms","whitespace","isHex","isRgb","isBlank","isNumber","isImage","regex","classes","hasClass","toggleClass","ret","cased","getPropertyValue","setProperty","attributes","remember","memory","forget","_memory","Color","inputs","isColor","mode","grey","cmyk","_a","_b","_c","hsl","isGrey","delta","_d","getParameters","noWhitespace","exec","hexParse","substring","sixDigitHex","components","lab","xyz","lch","atan2","dToR","yL","xL","zL","ct","mx","nm","rU","gU","bU","pow","bd","toHex","_clamped","toRgb","rV","gV","bV","r255","g255","b255","rL","gL","bL","xU","yU","zU","Point","source","transformO","isMatrixLike","formatTransforms","flipBoth","flip","flipX","flipY","skew","isFinite","scaleX","scaleY","shear","theta","around","px","positionX","NaN","py","positionY","relative","relativeX","relativeY","matrixMultiply","aroundO","translateO","lmultiplyO","decompose","determinant","ccw","thetaRad","st","lam","equals","comp","axis","flipO","scaleO","base","Element","matrixify","inverse","inverseO","det","na","nb","nc","nd","ne","nf","multiply","multiplyO","rotateO","shearO","lx","skewO","ly","transformer","Box","addOffset","pageXOffset","pageYOffset","isNulled","xMin","Infinity","xMax","yMin","yMax","viewbox","zoom","level","point","clientWidth","clientHeight","zoomX","zoomY","zoomAmount","MAX_SAFE_INTEGER","each","fnOrMethodName","reserved","attrs","EventTarget","defaultPrevented","fire","timeline","ease","delay","SVGArray","toSet","convert","unit","isNaN","minus","plus","times","colorAttributes","hooks","Dom","removeNamespace","SVGElement","put","hasChildNodes","lastChild","assignNewIds","nodeClone","first","htmlOrFn","outerHTML","xml","last","matches","selector","matcher","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","putIn","removeElement","replaceChild","precision","factor","svgOrFn","outerSVG","words","wrap","xmlOrFn","outerXML","_this","well","fragment","createDocumentFragment","firstElementChild","nodeValue","curr","_val","hook","setAttributeNS","rebuild","dom","setData","defs","dmove","parents","until","isSelector","rbox","screenCTM","inside","ctm","getCTM","isRoot","sugar","prefix","extension","mat","direction","getTotalLength","pointAt","getPointAtLength","untransform","str","kv","reverse","toParent","pCtm","toRoot","decomposed","Container","flatten","ungroup","Defs","Shape","circled","gradiented","Gradient","targets","url","gradient","Pattern","pattern","patternUnits","Image","load","img","image","PointArray","maxX","maxY","minX","minY","pop","toLine","pointed","MorphArray","Line","plot","Marker","orient","ref","marker","easing","bezier","steps","stepPosition","jumps","beforeFlag","jumping","Stepper","done","Ease","dt","Spring","acceleration","newPosition","PID","windup","integral","_windup","P","I","M","H","V","C","S","Q","T","A","Z","mlhvqtcsaz","jl","pathDelimiters","PathArray","toAbsolute","pathParser","arrayToString","getClassForType","NonMorphable","ObjectBag","_stepper","_from","_to","_type","_context","_morphObj","at","_set","align","TransformBag","sortByKey","defaultObject","toDelete","objOrArr","entries","Type","sort","shift","num","_array","poly","Polygon","polygon","Polyline","polyline","Rect","Queue","_first","_last","Animator","nextDraw","timeouts","immediates","timer","performance","frame","run","_draw","timeout","time","immediate","cancelFrame","clearTimeout","cancelImmediate","nextTimeout","lastTimeout","nextFrame","lastFrame","nextImmediate","makeSchedule","runnerInfo","runner","defaultSource","Timeline","timeSource","_timeSource","terminate","active","_nextFrame","finish","getEndTimeOfTimeline","pause","getEndTime","lastRunnerInfo","getLastRunnerInfo","lastDuration","_time","endTimes","_runners","getRunnerInfoById","_lastRunnerId","_runnerIds","_paused","_continue","persist","dtOrForever","_persist","play","updateTime","yes","currentSpeed","speed","positive","schedule","when","absoluteStartTime","endTime","unschedule","seek","_speed","_lastSourceTime","immediateStep","_stepImmediate","_step","_stepFn","dtSource","dtTime","_lastStepTime","reset","runnersLeft","dtToStart","_startTime","_timeline","Runner","_queue","_isDeclarative","_history","enabled","_lastTime","_reseted","transformId","_haveReversed","_reverse","_loopsDone","_swing","_wait","_times","sanitise","swing","wait","addTransform","animate","loop","clearTransform","clearTransformsFromQueue","isTransform","during","_prepareRunner","loops","loopDuration","loopsDone","partial","swinging","backwards","uncliped","swingForward","progress","initFn","runFn","retargetFn","initialiser","retarget","initialised","finished","running","_lastPosition","justStarted","justFinished","declarative","converged","_initialise","_run","needsIt","_rememberMorpher","method","morpher","caller","positionOrDt","allfinished","_tryRetarget","extra","FakeRunner","mergeWith","RunnerArray","ids","clearBefore","deleteCnt","edit","newRunner","getByID","lastRunner","by","_clearTransformRunnersBefore","currentRunner","_currentTransform","_addRunner","styleAttr","nameOrAttrs","newToAttrs","newKeys","differences","addedFromAttrs","oldFromAttrs","oldToAttrs","newLevel","newPoint","affine","isMatrix","currentAngle","startTransform","rTarget","rCurrent","possibilities","distances","shortest","affineParameters","newTransforms","_queueNumber","ay","_queueNumberDelta","newTo","_queueObject","amove","Svg","version","nested","Symbol","symbol","textable","build","_build","getComputedTextLength","plain","createTextNode","Text","_rebuild","blankLineOffset","getComputedStyle","newLined","firstLine","newLine","Tspan","Circle","ClipPath","unclip","clip","clipper","clipWith","ForeignObject","foreignObject","containerGeometry","G","link","unlink","linker","linkTo","Mask","unmask","masker","maskWith","Stop","Style","addText","rule","cssRule","fontface","TextPath","track","pathArray","textPath","importNodes","Use","use","file","mockAdopt","mock","withWindow","definition","enumerable","prop","toStringTag"],"sourceRoot":""}