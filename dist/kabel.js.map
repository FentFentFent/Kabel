{"version":3,"file":"kabel.js","mappings":"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","sources":["webpack://Kabel/webpack/universalModuleDefinition","webpack://Kabel/webpack/bootstrap","webpack://Kabel/./util/has-prop.ts","webpack://Kabel/./renderers/atlas/atlas.ts","webpack://Kabel/./util/user-state.ts","webpack://Kabel/./src/flyout.ts","webpack://Kabel/./src/core.ts","webpack://Kabel/./themes/default.ts","webpack://Kabel/./events/comment-input.ts","webpack://Kabel/./util/uid.ts","webpack://Kabel/./util/escape-html.ts","webpack://Kabel/./src/comment.ts","webpack://Kabel/./comment-renderer/renderer.ts","webpack://Kabel/./renderers/apollo/apollo.ts","webpack://Kabel/./renderers/renderer.ts","webpack://Kabel/./node_modules/svgpath/lib/path_parse.js","webpack://Kabel/./themes/themes.ts","webpack://Kabel/./util/unescape-html.ts","webpack://Kabel/./src/widget.ts","webpack://Kabel/./src/undo-redo.ts","webpack://Kabel/./src/inject-headless.ts","webpack://Kabel/./node_modules/svgpath/lib/ellipse.js","webpack://Kabel/./src/workspace-coords.ts","webpack://Kabel/./src/workspace-svg.ts","webpack://Kabel/./util/parse-color.ts","webpack://Kabel/./util/path.ts","webpack://Kabel/./node_modules/svgpath/lib/transform_parse.js","webpack://Kabel/./controllers/wasd.ts","webpack://Kabel/./src/fonts-manager.ts","webpack://Kabel/./events/connection-line.ts","webpack://Kabel/./src/field.ts","webpack://Kabel/./src/renderer-map.ts","webpack://Kabel/./src/grid.ts","webpack://Kabel/./events/node-x-btn.ts","webpack://Kabel/./src/colors.ts","webpack://Kabel/./node_modules/svgpath/lib/matrix.js","webpack://Kabel/./controllers/base.ts","webpack://Kabel/./renderers/apollo/renderer.ts","webpack://Kabel/./src/workspace.ts","webpack://Kabel/./util/styler.ts","webpack://Kabel/./src/inject.ts","webpack://Kabel/./src/headless-node.ts","webpack://Kabel/./util/env.ts","webpack://Kabel/./src/nodesvg.ts","webpack://Kabel/./src/ctx-menu-registry.ts","webpack://Kabel/./util/window-listeners.ts","webpack://Kabel/./util/emitter.ts","webpack://Kabel/./src/toolbox.ts","webpack://Kabel/./src/main-workspace.ts","webpack://Kabel/./events/draggable.ts","webpack://Kabel/./util/wait-anim-frames.ts","webpack://Kabel/./src/prototypes.ts","webpack://Kabel/./src/dropdown-menu.ts","webpack://Kabel/./src/widget-prototypes.ts","webpack://Kabel/./events/comment-drag-handle.ts","webpack://Kabel/./util/eventer.ts","webpack://Kabel/./node_modules/svgpath/lib/a2c.js","webpack://Kabel/./node_modules/svgpath/index.js","webpack://Kabel/./src/index.ts","webpack://Kabel/./src/coordinates.ts","webpack://Kabel/./renderers/constants.ts","webpack://Kabel/./node_modules/svgpath/lib/svgpath.js","webpack://Kabel/./src/styles.css","webpack://Kabel/./events/connector.ts","webpack://Kabel/./src/category.ts","webpack://Kabel/./renderers/representer-node.ts","webpack://Kabel/./src/connection.ts","webpack://Kabel/./renderers/apollo/constants.ts","webpack://Kabel/./events/input-box.ts","webpack://Kabel/./renderers/representer.ts","webpack://Kabel/./src/context-menu.ts","webpack://Kabel/./themes/dark.ts","webpack://Kabel/./node_modules/@svgdotjs/svg.js/dist/svg.node.cjs","webpack://Kabel/./events/events.ts","webpack://Kabel/webpack/runtime/define property getters","webpack://Kabel/webpack/runtime/hasOwnProperty shorthand","webpack://Kabel/webpack/runtime/make namespace object","webpack://Kabel/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Kabel\"] = factory();\n\telse\n\t\troot[\"Kabel\"] = factory();\n})(this, () => {\nreturn ","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\r\nexport default function hasProp(obj: object, name: string) {\r\n    return Object.prototype.hasOwnProperty.call(obj, name)\r\n}","import RendererConstants from \"../constants\";\r\nimport Renderer from \"../renderer\";\r\nimport Representer from \"../representer\";\r\nimport { RepresenterNode } from \"../representer-node\";\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n    Renderer,\r\n    RendererConstants as Constants,\r\n    Representer,\r\n    RepresenterNode\r\n}","type StateChangeCallback = (addedOrRemoved: 0 | 1) => void;\r\n\r\nclass UserState {\r\n    private state: Set<string>;\r\n    private callbacks: Map<string, StateChangeCallback[]>;\r\n    /**\r\n     * Stores the user's current UIX state\r\n     * Ex: 'typing'\r\n     */\r\n    constructor() {\r\n        this.state = new Set();\r\n        this.callbacks = new Map();\r\n    }\r\n\r\n    /** \r\n     * Adds a state\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    setState(name: string) {\r\n        const wasPresent = this.state.has(name);\r\n        if (!wasPresent) {\r\n            this.state.add(name);\r\n            this.triggerCallbacks(name, 1);\r\n        }\r\n    }\r\n\r\n    /** \r\n     * Removes a state\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    removeState(name: string) {\r\n        const wasPresent = this.state.has(name);\r\n        if (wasPresent) {\r\n            this.state.delete(name);\r\n            this.triggerCallbacks(name, 0);\r\n        }\r\n    }\r\n\r\n    /** \r\n     * Checks if a state is active\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    hasState(name: string) {\r\n        return this.state.has(name);\r\n    }\r\n\r\n    /** \r\n     * Registers a callback for state changes \r\n     * @param name - Name of the state to check changes for.\r\n     * @param cb - Callback to call on state change.\r\n     */\r\n    onStateChange(name: string, cb: StateChangeCallback) {\r\n        if (!this.callbacks.has(name)) this.callbacks.set(name, []);\r\n        this.callbacks.get(name)!.push(cb);\r\n    }\r\n\r\n    /** Internal: triggers callbacks for a state */\r\n    private triggerCallbacks(name: string, addedOrRemoved: 0 | 1) {\r\n        const cbs = this.callbacks.get(name);\r\n        if (!cbs) return;\r\n        for (const cb of cbs) cb(addedOrRemoved);\r\n    }\r\n}\r\nconst userState = new UserState();\r\nexport default userState;\r\nexport {\r\n    UserState\r\n};","import newHeadlessNode from \"./headless-node\";\r\nimport { TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport { Color } from \"./visual-types\";\r\n\r\n/**\r\n * Represents a flyout menu for a toolbox in Kabel.\r\n * Displays a list of nodes that can be dragged into a workspace.\r\n */\r\nclass Flyout {\r\n\tcontainer: HTMLDivElement;\r\n\tvisible: boolean;\r\n\ttoolbox?: Toolbox|undefined;\r\n\r\n\tconstructor(toolbox?: Toolbox) {\r\n\t\tthis.toolbox = toolbox;\r\n\r\n\t\tthis.container = document.createElement(\"div\");\r\n\t\tthis.container.className = \"KabelFlyout\";\r\n\r\n\t\tthis.visible = false;\r\n\r\n\t\tif (toolbox) {\r\n\t\t\ttoolbox.workspace._wsTop.appendChild(this.container);\r\n\t\t} else {\r\n\t\t\tdocument.body.appendChild(this.container);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Populates the flyout with a list of nodes.\r\n\t */\r\n\tfill(nodes: TblxNodeStruct[]) {\r\n\t\tthis.clear();\r\n\t\tnodes.forEach(node => {\r\n\t\t\tconst headlessNode = newHeadlessNode(node.type as string);\r\n\t\t\tif (!headlessNode) return;\r\n\r\n\t\t\tconst nodeEl = this.createNodeElement(headlessNode);\r\n\t\t\tthis.container.appendChild(nodeEl);\r\n\t\t});\r\n\r\n\t\tthis.show();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a DOM element for a node with event listeners attached.\r\n\t */\r\n\tprivate createNodeElement(headlessNode: any): HTMLDivElement {\r\n\t\tconst nodeEl = document.createElement(\"div\");\r\n\t\tnodeEl.className = \"KabelFlyoutNode\";\r\n\t\tnodeEl.textContent = headlessNode.labelText;\r\n\r\n\t\tthis.applyNodeStyles(nodeEl, headlessNode.colors.primary);\r\n\r\n\t\tnodeEl.addEventListener(\"mousedown\", e => this.onNodeMouseDown(e, headlessNode));\r\n\t\treturn nodeEl;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies consistent styling to a node element.\r\n\t */\r\n\tprivate applyNodeStyles(el: HTMLElement, bgColor: Color) {\r\n\t\tel.style.backgroundColor = parseColor(bgColor);\r\n\t\tel.style.padding = \"4px 8px\";\r\n\t\tel.style.cursor = \"pointer\";\r\n\r\n\t\tif (this.toolbox?.workspace?.renderer?.constants) {\r\n\t\t\tconst c = this.toolbox.workspace.renderer.constants;\r\n\t\t\tel.style.fontFamily = c.FONT_FAMILY;\r\n\t\t\tel.style.fontSize = `${c.FONT_SIZE}px`;\r\n\t\t\tel.style.color = parseColor(c.FONT_COLOR);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles starting a drag operation for a node.\r\n\t */\r\n\tprivate onNodeMouseDown(e: MouseEvent, headlessNode: any) {\r\n\t\tif (!this.toolbox) return;\r\n\r\n\t\tconst ghostEl = this.createGhostNode(headlessNode);\r\n\t\tdocument.body.appendChild(ghostEl);\r\n\r\n\t\tconst moveGhost = (ev: MouseEvent) => {\r\n\t\t\tghostEl.style.left = ev.clientX + 4 + \"px\";\r\n\t\t\tghostEl.style.top = ev.clientY + 4 + \"px\";\r\n\t\t};\r\n\r\n\t\tconst releaseGhost = (ev: MouseEvent) => {\r\n\t\t\tdocument.removeEventListener(\"mousemove\", moveGhost);\r\n\t\t\tdocument.removeEventListener(\"mouseup\", releaseGhost);\r\n\r\n\t\t\tthis.dropNode(ev, headlessNode);\r\n\r\n\t\t\tghostEl.remove();\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener(\"mousemove\", moveGhost);\r\n\t\tdocument.addEventListener(\"mouseup\", releaseGhost);\r\n\r\n\t\te.preventDefault();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a ghost element that follows the mouse during drag.\r\n\t */\r\n\tprivate createGhostNode(headlessNode: any): HTMLDivElement {\r\n\t\tconst ghostEl = document.createElement(\"div\");\r\n\t\tghostEl.className = \"KabelGhostNode\";\r\n\t\tghostEl.textContent = headlessNode.labelText;\r\n\t\tghostEl.style.position = \"absolute\";\r\n\t\tghostEl.style.pointerEvents = \"none\";\r\n\r\n\t\tthis.applyNodeStyles(ghostEl, headlessNode.colors.primary);\r\n\t\treturn ghostEl;\r\n\t}\r\n\r\n\t/**\r\n\t * Handles dropping a node into the workspace if the mouse is over it.\r\n\t */\r\n\tprivate dropNode(ev: MouseEvent, node: TblxNodeStruct) {\r\n\t\tif (!this.toolbox) return;\r\n\r\n\t\tconst svg = this.toolbox.workspace.svg.node as SVGSVGElement;\r\n\t\tconst rect = svg.getBoundingClientRect();\r\n\r\n\t\tif (\r\n\t\t\tev.clientX >= rect.left &&\r\n\t\t\tev.clientX <= rect.right &&\r\n\t\t\tev.clientY >= rect.top &&\r\n\t\t\tev.clientY <= rect.bottom\r\n\t\t) {\r\n\t\t\tconst { x: wsX, y: wsY } = this.toolbox.workspace.screenToWorkspace(\r\n\t\t\t\tev.clientX - rect.left,\r\n\t\t\t\tev.clientY - rect.top\r\n\t\t\t);\r\n\r\n\t\t\tconst nodews = this.toolbox.workspace.spawnAt(node.type as string, wsX, wsY);\r\n\t\t\tif (nodews) {\r\n\t\t\t\tfor (let argName in node.arguments) {\r\n\t\t\t\t\tnodews.setFieldValue(argName, node.arguments[argName]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.toolbox.workspace.drawNode(nodews.id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.container.style.display = \"block\";\r\n\t\tthis.visible = true;\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.container.style.display = \"none\";\r\n\t\tthis.visible = false;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.container.innerHTML = \"\";\r\n\t}\r\n}\r\n\r\nexport default Flyout;\r\n","import RendererConstants from '../renderers/constants'\r\nimport Renderer from '../renderers/renderer'\r\nimport CategoryColors from './colors'\r\nimport Connection, { Connectable } from './connection'\r\nimport Coordinates from './coordinates'\r\nimport Field, {\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField\r\n} from './field'\r\nimport inject, { InjectMsg, InjectOptions } from './inject'\r\nimport {\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace\r\n} from './main-workspace'\r\nimport NodeSvg, { NodeJson, NodeEvents, InputFieldJson } from './nodesvg'\r\nimport NodePrototypes from './prototypes'\r\nimport WorkspaceSvg from './workspace-svg'\r\nimport { NodePrototype } from './node-types'\r\nimport {\r\n    Color,\r\n    ColorStyle,\r\n    Hex,\r\n    RGBObject,\r\n    RGBString,\r\n    RGBTuple\r\n} from './visual-types'\r\nimport { parseColor } from '../util/parse-color'\r\nimport eventer, { Eventer } from '../util/eventer'\r\nimport * as Path from '../util/path'\r\nimport * as SVG from '@svgdotjs/svg.js'\r\nimport * as UID from '../util/uid'\r\nimport hasProp from '../util/has-prop'\r\nimport EventEmitter from '../util/emitter'\r\nimport userState from '../util/user-state'\r\nimport '../events/events'\r\nimport WorkspaceController from '../controllers/base'\r\nimport WASDController from '../controllers/wasd'\r\nimport { RMap, RendererMap } from './renderer-map'\r\nimport styler, { Styler } from '../util/styler'\r\nimport WidgetPrototypes from './widget-prototypes'\r\nimport Widget from './widget'\r\nimport ContextOptsRegistry, { ContextMenu } from './ctx-menu-registry'\r\nimport { Showable } from './context-menu'\r\nimport escapeAttr from '../util/escape-html'\r\nimport unescapeAttr from '../util/unescape-html'\r\nimport waitFrames from '../util/wait-anim-frames'\r\nimport CommentModel from './comment'\r\nimport CommentRenderer from '../comment-renderer/renderer'\r\nimport dropdownContainer from './dropdown-menu'\r\nimport Representer from '../renderers/representer'\r\nimport { RepresenterNode } from '../renderers/representer-node'\r\nimport windowListeners, { addWindowListener, clearWindowListeners, removeWindowListener } from '../util/window-listeners'\r\nimport * as FontManager from './fonts-manager';\r\nimport env from \"../util/env\";\r\nimport Workspace from './workspace'\r\nimport injectHeadless from './inject-headless'\r\nimport createHeadlessNode from './headless-node';\r\nimport * as apollo from '../renderers/apollo/apollo';\r\nimport * as atlas from '../renderers/atlas/atlas';\r\nimport KabelWSTheme from '../themes/default'\r\nimport KabelDarkTheme from '../themes/dark'\r\n/** Register default renderers. */\r\nRendererMap['default'] = atlas.Renderer;\r\nRendererMap[atlas.Renderer.NAME] = atlas.Renderer;\r\nRendererMap[apollo.Renderer.NAME] = apollo.Renderer;\r\n\r\nif (env.isBrowser) {\r\n    // Use FontsManager to load default Kabel fonts.\r\n    FontManager.loadGoogleFont('Fredoka');\r\n}\r\n/**\r\n * Utility method to register a field globally by name\r\n * @param name - Field identifier\r\n * @param cls - Class constructor for the field\r\n */\r\nField.register = function (name: string, cls: Function) {\r\n    FieldMap[name] = cls as AnyFieldCls\r\n}\r\n\r\n/**\r\n * Utility method to unregister a field globally by name\r\n * @param name - Field identifier\r\n */\r\nField.unregister = function (name: string) {\r\n    delete FieldMap[name]\r\n}\r\n\r\n/**\r\n * Central Kabel object exposing all main modules, utilities, and defaults\r\n */\r\nconst Kabel = {\r\n    env, // Environment information\r\n    UIX: { // User experience enhancing utilities.\r\n        /** Event manager, loads events from '../events' and lets us attach them to svg.js elements to give them behavior that's seperated from the renderer. */\r\n        events: eventer as Eventer,\r\n        /** Font manager, used to load fonts. */\r\n        FontManager,\r\n        /** * State Manager, Makes things possible: E.G (the 'typing' state when you type in a input box..) * Used in controllers so you dont move when typing characters like a w s or d etc. */\r\n        userState,\r\n        /** Window listeners manager */\r\n        windowListeners: {\r\n            addWindowListener,\r\n            removeWindowListener,\r\n            clearWindowListeners,\r\n            windowListeners\r\n        }\r\n    },\r\n    Themes: {\r\n        Classic: KabelWSTheme,\r\n        Dark: KabelDarkTheme\r\n    },\r\n    /** Context menu manager */\r\n    ContextMenu,\r\n    /**\r\n     * Utility methods and constants for various purposes.\r\n     * @property Path - Utility methods for handling SVG paths.\r\n     * @property waitFrames - Utility method to wait for a certain number of animation frames.\r\n     */\r\n    Utils: {\r\n        Path,\r\n        waitFrames,\r\n        SVG, // Re-exporting svg.js for convenience\r\n        parseColor,\r\n        UID,\r\n        EventEmitter,\r\n        hasProp,\r\n        styler,\r\n        Styler,\r\n        escapeHTML: escapeAttr,\r\n        unescapeHTML: unescapeAttr\r\n    },\r\n    Widget,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    inject,\r\n    injectHeadless,\r\n    createHeadlessNode,\r\n    InjectMsg,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    Nodes: NodePrototypes,\r\n    Widgets: WidgetPrototypes,\r\n    WorkspaceSvg,\r\n    Workspace,\r\n    WorkspaceController,\r\n    WASDController,\r\n    nodeRendering: {\r\n        SVG: SVG, // also re-export svg.js here for easier access in renderers\r\n        rendererMap: RMap,\r\n        Apollo: apollo,\r\n        Atlas: atlas,\r\n        Renderer: Renderer,\r\n        RendererConstants: RendererConstants,\r\n        Representer: Representer,\r\n        RepresenterNode: RepresenterNode\r\n    },\r\n    atlas,\r\n    apollo,\r\n    commentRendering: { CommentModel, CommentRenderer },\r\n    Dropdown: dropdownContainer\r\n}\r\n\r\n/**\r\n * Provides a getter/setter for the main workspace\r\n * @property _mainWorkspace - Get or set the currently active workspace\r\n */\r\nObject.defineProperty(Kabel, '_mainWorkspace', {\r\n    get(): WorkspaceSvg | Workspace | null {\r\n        return getMainWorkspace()\r\n    },\r\n    set(v: WorkspaceSvg | Workspace | undefined | null | false | 0 | string) {\r\n        if (\r\n            v === undefined ||\r\n            v === null ||\r\n            v === false ||\r\n            v === 0 ||\r\n            typeof v === 'string'\r\n        ) {\r\n            return clearMainWorkspace()\r\n        }\r\n        return setMainWorkspace(v)\r\n    }\r\n})\r\n\r\nexport default Kabel\r\n","import type {WSTheme} from '../src/workspace-svg'\r\n\r\n\r\n\r\nconst KabelWSTheme: WSTheme = {\r\n\tUIStyles: {\r\n        workspaceBGColor: '#ffffff',\r\n\t\ttoolboxCategoriesBG: {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tleft: '0',\r\n\t\t\ttop: '0',\r\n\t\t\twidth: '20%',\r\n\t\t\theight: '100%',\r\n\t\t\tbackground: 'rgba(240,240,240,0.9)',\r\n\t\t\toverflowY: 'auto',\r\n\t\t},\r\n\t\ttoolboxFlyoutBG: {\r\n\t\t\tbackground: 'rgba(240,240,240,0.9)', // reuse same neutral bg\r\n\t\t\toverflowY: 'auto',\r\n\t\t\tpadding: '4px', // like nodes padding\r\n\t\t\tborderRadius: '4px',\r\n\t\t\tboxShadow: '0 2px 6px rgba(0,0,0,0.15)',\r\n\t\t},\r\n\t},\r\n};\r\n\r\nexport default KabelWSTheme;","import { Element as SvgElement, Rect as SvgRect, Text as SvgText } from \"@svgdotjs/svg.js\";\r\nimport CommentModel from \"../src/comment\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\nimport Renderer from \"../comment-renderer/renderer\"\r\n\r\ntype InitArgs = {\r\n    comment: CommentModel;\r\n    text: SvgText;\r\n    renderer: Renderer;\r\n};\r\n\r\nfunction initCommentInput(element: SvgElement, rawArgs: any) {\r\n    const args = rawArgs as InitArgs;\r\n    const comment = args.comment;\r\n    const txt = args.text as SvgText;\r\n    const rect = element as unknown as SvgRect;\r\n    const renderer = args.renderer;\r\n\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = comment.getText() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length;\r\n\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    function encodeForSvg(s: string) {\r\n        return s.replace(/ /g, \"\\u00A0\").replace(/\\n/g, \"&#10;\");\r\n    }\r\n\r\n    function ensureTspansPreserve(node: Element) {\r\n        Array.from(node.childNodes).forEach((child) => {\r\n            if (child.nodeType === 1) (child as Element).setAttribute(\"xml:space\", \"preserve\");\r\n        });\r\n    }\r\n\r\n    let caretLine: SvgRect | null = null;\r\n    let selectionRect: SvgRect | null = null;\r\n\r\n    // --- MEASURE TEXT WIDTH USING COMMENT RENDERER ---\r\n    function measureTextWidth(text: string, fontSize?: number, fontFamily?: string) {\r\n        // Delegate to renderers measureTextBbox logic\r\n        const tempText = renderer.getSvg().text(text).font({ size: fontSize || 12, family: fontFamily || \"Arial\" });\r\n        const bbox = renderer.measureTextBbox(tempText);\r\n        tempText.remove();\r\n        return bbox.width;\r\n    }\r\n\r\n    function updateText() {\r\n        const { start, end } = getSelectionRange();\r\n        const hasSel = hasSelection();\r\n\r\n        // redraw main text\r\n        txt.clear().tspan(encodeForSvg(buffer));\r\n        txt.attr({ \"xml:space\": \"preserve\" });\r\n        try { ensureTspansPreserve(txt.node as Element); } catch { }\r\n        txt.leading(1.2);\r\n\r\n        // --- selection highlight ---\r\n        if (hasSel) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14;\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n\r\n            const bbox = txt.bbox();\r\n            const highlightX = bbox.x + measureTextWidth(textBeforeStart, fontSize, fontFamily);\r\n            const highlightWidth = Math.max(\r\n                measureTextWidth(textBeforeEnd, fontSize, fontFamily) - measureTextWidth(textBeforeStart, fontSize, fontFamily),\r\n                1\r\n            );\r\n            const highlightY = bbox.y;\r\n            const highlightH = bbox.height;\r\n\r\n            if (!selectionRect) {\r\n                //@ts-ignore\r\n                selectionRect = rect!.parent()!.rect?.(highlightWidth, highlightH)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                selectionRect.size(highlightWidth, highlightH);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n        // --- caret ---\r\n        if (editing) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14;\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n            const textBeforeCaret = buffer.slice(0, cursorPos);\r\n            const caretXOffset = measureTextWidth(textBeforeCaret, fontSize, fontFamily);\r\n\r\n            const bbox = txt.bbox();\r\n            const caretY = bbox.y;\r\n            const caretH = bbox.height;\r\n\r\n            //@ts-ignore\r\n            if (!caretLine) caretLine = rect.parent().rect(1, caretH).fill('#000');\r\n\r\n            caretLine!.size(1, caretH).move(bbox.x + caretXOffset, caretY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n        // --- resize background rect ---\r\n        const bbox = txt.bbox();\r\n        const handleRadius = 6;\r\n        const textOffsetX = PADDING_X + handleRadius * 2 + 4;\r\n        const rectW = Math.max(16, Math.ceil(bbox.width) + textOffsetX + PADDING_X);\r\n        const rectH = Math.max(16, Math.ceil(bbox.height) + PADDING_Y * 2);\r\n        rect.size(rectW, rectH);\r\n\r\n        comment._tempInputBBox = {\r\n            width: rectW,\r\n            height: rectH,\r\n            textX: textOffsetX,\r\n            textY: PADDING_Y\r\n        };\r\n    }\r\n\r\n    // --- editing lifecycle ---\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = comment.getText() ?? \"\";\r\n        cursorPos = buffer.length;\r\n        anchorPos = buffer.length;\r\n\r\n        userState.setState('typing');\r\n\r\n        if (ev) {\r\n            const rectBox = txt.node.getBoundingClientRect();\r\n            //@ts-ignore\r\n            const zoom = renderer.getWs().getZoom();\r\n            const clickX = (ev.clientX - rectBox.left - PADDING_X) / zoom;\r\n\r\n            let cumulativeWidth = 0;\r\n            cursorPos = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                const charWidth = measureTextWidth(buffer[i] as string);\r\n                if (cumulativeWidth + charWidth / 2 >= clickX) break;\r\n                cumulativeWidth += charWidth;\r\n                cursorPos = i + 1;\r\n            }\r\n        }\r\n\r\n        anchorPos = cursorPos;\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown);\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing(commit = true) {\r\n        if (!editing) return;\r\n        editing = false;\r\n        userState.removeState(\"typing\");\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n\r\n        if (commit) comment.setTextNoRedraw(buffer);\r\n        updateText();\r\n        comment.getWorkspace()?.redraw?.();\r\n    }\r\n\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(false); return; }\r\n\r\n        if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            stopEditing(true);\r\n        } else if (e.key === \"Backspace\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        }\r\n        else if (e.key === \"ArrowLeft\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection left\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection right\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Home\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = 0; // anchor unchanged\r\n            } else {\r\n                cursorPos = 0;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"End\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = buffer.length;\r\n            } else {\r\n                cursorPos = buffer.length;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            e.preventDefault();\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        }\r\n\r\n        updateText();\r\n        comment.setTextNoRedraw(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const targ = ev.target as Node;\r\n        if (targ !== rect.node && targ !== txt.node) stopEditing(true);\r\n    }\r\n\r\n    const onRectDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n    const onTextDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n\r\n    rect.on(\"mousedown\", onRectDown as any);\r\n    txt.on(\"mousedown\", onTextDown as any);\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", onRectDown as any);\r\n        txt.off(\"mousedown\", onTextDown as any);\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_commentinp\", initCommentInput as EventSetupFn);\r\nexport default initCommentInput;\r\n","// uid.ts\r\n\r\n/**\r\n * Strategy used to generate UIDs.\r\n */\r\nexport type UIDStrategy = \"uuidv4\" | \"ulid\" | \"nanoid\" | \"short\";\r\n\r\nexport interface UIDOptions {\r\n    /** For \"nanoid\": length of the id (default 21) */\r\n    size?: number;\r\n    /** For \"nanoid\": custom alphabet (default URL-safe) */\r\n    alphabet?: string;\r\n}\r\n\r\n/** Web Crypto shim (browser + Node 16+) */\r\nconst cryptoAPI: Crypto | null =\r\n    (typeof globalThis !== \"undefined\" && (globalThis as any).crypto) || null;\r\n\r\n/**\r\n * Returns a Uint8Array of random bytes.\r\n * Uses Web Crypto if available; falls back to Math.random otherwise (not cryptographically secure).\r\n *\r\n * @param {number} len - Number of random bytes to generate.\r\n * @returns {Uint8Array} Random bytes array.\r\n */\r\nfunction randBytes(len: number): Uint8Array {\r\n    if (cryptoAPI?.getRandomValues) {\r\n        const buf = new Uint8Array(len);\r\n        cryptoAPI.getRandomValues(buf);\r\n        return buf;\r\n    }\r\n    // Last resort (very old envs). Not cryptographically strong.\r\n    const buf = new Uint8Array(len);\r\n    for (let i = 0; i < len; i++) buf[i] = Math.floor(Math.random() * 256);\r\n    return buf;\r\n}\r\n\r\n/**\r\n * Generates an RFC4122-compliant UUID v4.\r\n * Uses `crypto.randomUUID` if available.\r\n *\r\n * @returns {string} UUID v4 string.\r\n */\r\nexport function uuidv4(): string {\r\n    const g: any = globalThis as any;\r\n    if (g?.crypto?.randomUUID) return g.crypto.randomUUID();\r\n\r\n    const b = randBytes(16);\r\n    // Per RFC: set version + variant bits\r\n    // @ts-ignore\r\n    b[6] = (b[6] & 0x0f) | 0x40;\r\n    // @ts-ignore\r\n    b[8] = (b[8] & 0x3f) | 0x80;\r\n\r\n    const hex: string[] = [];\r\n    for (let i = 0; i < 256; i++) hex.push(i.toString(16).padStart(2, \"0\"));\r\n\r\n    return (\r\n        // @ts-ignore\r\n        hex[b[0]] + hex[b[1]] + hex[b[2]] + hex[b[3]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[4]] + hex[b[5]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[6]] + hex[b[7]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[8]] + hex[b[9]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[10]] + hex[b[11]] + hex[b[12]] + hex[b[13]] + hex[b[14]] + hex[b[15]]\r\n    );\r\n}\r\n\r\n/** Crockford Base32 alphabet for ULID */\r\nconst CROCK32 = \"0123456789ABCDEFGHJKMNPQRSTVWXYZ\"; // no I L O U\r\n\r\n/**\r\n * Generates a 26-character ULID (time-sortable unique ID).\r\n *\r\n * @param {number} [date] - Optional timestamp in milliseconds. Defaults to `Date.now()`.\r\n * @returns {string} ULID string.\r\n */\r\nexport function ulid(date?: number): string {\r\n    const time = (typeof date === \"number\" ? date : Date.now()) >>> 0; // low 32 bits\r\n    const timeHi = Math.floor((typeof date === \"number\" ? date : Date.now()) / 0x100000000) >>> 0; // high 32\r\n    // ULID uses 48-bit time; do base32 encode 48 bits\r\n    const time48 = new Uint8Array(6);\r\n    // write 48-bit big-endian\r\n    let t = BigInt(typeof date === \"number\" ? date : Date.now());\r\n    for (let i = 5; i >= 0; i--) {\r\n        time48[i] = Number(t & 0xffn);\r\n        t >>= 8n;\r\n    }\r\n    // first 10 chars = time\r\n    let out = \"\";\r\n    let acc = 0;\r\n    let bits = 0;\r\n    for (let i = 0; i < 6; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | time48[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n    out = out.slice(0, 10);\r\n\r\n    // last 16 chars = randomness (80 bits)\r\n    const rnd = randBytes(10);\r\n    acc = 0; bits = 0;\r\n    for (let i = 0; i < rnd.length; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | rnd[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n\r\n    return out.slice(0, 26);\r\n}\r\n\r\n/** NanoID-style: URL-safe alphabet by default, configurable length/alphabet */\r\nconst DEFAULT_ALPHABET =\r\n    \"_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n/**\r\n * Generates a NanoID-style string.\r\n *\r\n * @param {number} [size=21] - Length of the generated ID.\r\n * @param {string} [alphabet=DEFAULT_ALPHABET] - Alphabet to use.\r\n * @returns {string} Generated NanoID string.\r\n */\r\nexport function nanoid(size: number = 21, alphabet: string = DEFAULT_ALPHABET): string {\r\n    if (size <= 0) throw new Error(\"size must be > 0\");\r\n    const mask = (1 << Math.ceil(Math.log2(alphabet.length))) - 1;\r\n    let id = \"\";\r\n    while (id.length < size) {\r\n        const bytes = randBytes(1);\r\n        // @ts-ignore\r\n        const idx = bytes[0] & mask;\r\n        if (idx < alphabet.length) id += alphabet[idx];\r\n    }\r\n    return id;\r\n}\r\n\r\n/**\r\n * Generates a short, mostly-unique ID (timestamp + counter + random).\r\n * Not cryptographically strong.\r\n *\r\n * @returns {string} Short UID string.\r\n */\r\nlet _ctr = 0;\r\nexport function shortId(): string {\r\n    const ts = Date.now().toString(36);\r\n    _ctr = (_ctr + 1) & 0xfff; // 0..4095\r\n    const c = _ctr.toString(36).padStart(3, \"0\");\r\n    const r = Array.from(randBytes(3))\r\n        .map(b => (b & 0x3f).toString(36).padStart(2, \"0\"))\r\n        .join(\"\")\r\n        .slice(0, 4);\r\n    return `${ts}${c}${r}`;\r\n}\r\n\r\n/**\r\n * Generates a UID using the specified strategy.\r\n *\r\n * @param {UIDStrategy} [strategy=\"uuidv4\"] - The UID strategy to use.\r\n * @param {UIDOptions} [opts={}] - Options for the selected strategy.\r\n * @returns {string} Generated UID.\r\n */\r\nexport function generateUID(strategy: UIDStrategy = \"uuidv4\", opts: UIDOptions = {}): string {\r\n    switch (strategy) {\r\n        case \"uuidv4\": return uuidv4();\r\n        case \"ulid\": return ulid();\r\n        case \"nanoid\": return nanoid(opts.size ?? 21, opts.alphabet ?? DEFAULT_ALPHABET);\r\n        case \"short\": return shortId();\r\n        default: {\r\n            const _exhaustive: never = strategy;\r\n            return uuidv4();\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Escapes special characters in a string to their corresponding HTML entities.\r\n *\r\n * Specifically, it replaces:\r\n * - `&` with `&amp;`\r\n * - `'` with `&apos;`\r\n * - `\"` with `&quot;`\r\n * - `<` with `&lt;`\r\n * - `>` with `&gt;`\r\n *\r\n * @param {string} s - The string to escape.\r\n * @returns {string} The escaped string with special characters replaced by HTML entities.\r\n */\r\nfunction escapeAttr(s: string): string {\r\n    return s.replace(/&/g, \"&amp;\")\r\n            .replace(/'/g, \"&apos;\")\r\n            .replace(/\"/g, \"&quot;\")\r\n            .replace(/</g, \"&lt;\")\r\n            .replace(/>/g, \"&gt;\");\r\n}\r\n\r\nexport default escapeAttr;\r\n","import { G, Line } from \"@svgdotjs/svg.js\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport Workspace from \"./workspace\";\r\n\r\n\r\nexport interface CommentSerialized {\r\n    id: string;\r\n    text: string;\r\n    coords: { x: number; y: number };\r\n    parent: string | null; // node ID if node comment, null if workspace comment\r\n}\r\n/**\r\n * Represents a comment attached to either a NodeSvg or a WorkspaceSvg.\r\n */\r\nclass CommentModel {\r\n    /** The comment text */\r\n    _text: string;\r\n\r\n    /** True if this comment belongs to the workspace instead of a node */\r\n    _isWorkspaceComment: boolean;\r\n\r\n    /** Parent NodeSvg or WorkspaceSvg to which this comment belongs */\r\n    _parent: NodeSvg | WorkspaceSvg | Workspace;\r\n\r\n    /** SVG group representing this comment in the DOM */\r\n    svgGroup?: G | undefined;\r\n\r\n    /** Coordinates relative to parent */\r\n    relativeCoords: Coordinates;\r\n\r\n    /** Optional SVG line connecting the comment to its node */\r\n    svgLine?: Line | undefined;\r\n\r\n    /** Temporary bounding box info for input handling */\r\n    _tempInputBBox?: { width: number; height: number; textX: number; textY: number };\r\n\r\n    /** Unique identifier for this comment */\r\n    id: string;\r\n\r\n    /**\r\n     * Creates a new comment attached to a node or workspace.\r\n     * @param parent - NodeSvg or WorkspaceSvg this comment belongs to\r\n     */\r\n    constructor(parent: NodeSvg | WorkspaceSvg | Workspace) {\r\n        this._parent = parent;\r\n        this._isWorkspaceComment = parent instanceof WorkspaceSvg;\r\n        this._text = \"\";\r\n        this.relativeCoords = new Coordinates(0, 0); // Coordinates relative to this._parent\r\n        this.id = generateUID(\"nanoid\", {\r\n            alphabet: \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^\",\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sets the text of the comment without triggering a comment redraw.\r\n     * @param value - New text content\r\n     * @returns The updated text\r\n     */\r\n    setTextNoRedraw(value: string): string {\r\n        return (this._text = value);\r\n    }\r\n\r\n    /**\r\n     * Retrieves the current text of the comment.\r\n     * @returns The comment text\r\n     */\r\n    getText(): string {\r\n        return this._text;\r\n    }\r\n\r\n    /**\r\n     * Sets the text of the comment and triggers a redraw of all comments in the workspace.\r\n     * @param value - New text content\r\n     * @returns The updated text\r\n     */\r\n    setText(value: string): string {\r\n        const res = (this._text = value);\r\n        if (this.getWorkspace().isHeadless) return res;\r\n        this.getWorkspace().renderer.clearComments();\r\n        this.getWorkspace().renderer.drawComments();\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns true if this comment is attached to a node.\r\n     */\r\n    isNodeComment(): boolean {\r\n        return !this._isWorkspaceComment;\r\n    }\r\n\r\n    /**\r\n     * Returns true if this comment is attached to the workspace.\r\n     */\r\n    isWorkspaceComment(): boolean {\r\n        return this._isWorkspaceComment;\r\n    }\r\n\r\n    /**\r\n     * Gets the workspace that owns this comment.\r\n     */\r\n    getWorkspace(): WorkspaceSvg {\r\n        if (this.isWorkspaceComment()) {\r\n            return this._parent as WorkspaceSvg;\r\n        } else {\r\n            return (this._parent as NodeSvg)?.workspace as WorkspaceSvg;\r\n        }\r\n    }\r\n    /**\r\n     * Convert to JSON structure holding all important data.\r\n     */\r\n    toJson(): CommentSerialized {\r\n        return {\r\n            text: this.getText(),\r\n            coords: { x: this.relativeCoords.x, y: this.relativeCoords.y },\r\n            parent: this.isWorkspaceComment() ? null : (this._parent as NodeSvg).id,\r\n            id: this.id\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a CommentModel from serialized data.\r\n     * @param data - The serialized comment\r\n     * @param workspace - The workspace to attach the comment to\r\n     * @param nodeMap - Optional map of node IDs to NodeSvg instances\r\n     */\r\n    static fromJson(\r\n        data: CommentSerialized,\r\n    ): CommentModel {\r\n        const comment = new CommentModel(null as any as WorkspaceSvg | NodeSvg);\r\n        comment.id = data.id;\r\n        comment.relativeCoords = new Coordinates(data.coords.x, data.coords.y);\r\n        comment.setTextNoRedraw(data.text);\r\n\r\n        return comment;\r\n    }\r\n}\r\n\r\nexport default CommentModel;\r\nexport { CommentModel };\r\n","import Renderer from '../renderers/renderer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport CommentModel from '../src/comment';\r\nimport { Element, SVG, Svg } from '@svgdotjs/svg.js';\r\nimport eventer from '../util/eventer';\r\n\r\nclass CommentRenderer {\r\n\tstatic get NAME() { return 'cr_atlas'; }\r\n\tstatic get COMMENT_G_TAG() { return 'KabelCommentGroup'; }\r\n\tstatic get COMMENT_LINE_TAG() { return 'KabelCommentLine'; }\r\n\tstatic get COMMENT_TEXT_EL() { return 'KabelCommentText'; }\r\n\tstatic get COMMENT_DRAG_EL() { return 'KabelCommentDragHandle'; }\r\n\tstatic get RENDERER_TAG_EL() { return 'KabelCommentElTag'; }\r\n\r\n\tworkspace: WorkspaceSvg;\r\n\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\t}\r\n\r\n\tencodeForSvg(s: string) {\r\n\t\treturn s.replace(/ /g, \"\\u00A0\");\r\n\t}\r\n\r\n\tensureTspansPreserve(node: HTMLElement) {\r\n\t\tArray.from(node.childNodes).forEach((child) => {\r\n\t\t\tif (child.nodeType === 1) {\r\n\t\t\t\t(child as HTMLElement).setAttribute(\"xml:space\", \"preserve\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tmeasureTextBbox(textEl: Element) {\r\n\t\treturn textEl.bbox();\r\n\t}\r\n\r\n\tdrawComment(comment: CommentModel) {\r\n\t\tconst svg = this.getSvg();\r\n\t\tthis._removeExistingElements(comment);\r\n\r\n\t\tconst g = svg.group().addClass(CommentRenderer.COMMENT_G_TAG);\r\n\t\tg.attr({\r\n\t\t\t'comment-data': JSON.stringify({\r\n\t\t\t\tid: comment.id,\r\n\t\t\t\tisws: comment.isWorkspaceComment()\r\n\t\t\t})\r\n\t\t});\r\n\t\tcomment.svgGroup = g;\r\n\r\n\t\tconst padding = 4;\r\n\t\tconst handleRadius = 6;\r\n\t\tconst textOffsetX = padding + handleRadius * 2 + 4;\r\n\r\n\t\tconst displayEncoded = this.encodeForSvg(comment.getText());\r\n\t\tconst textEl = this._createTextElement(g, displayEncoded, textOffsetX, padding);\r\n\r\n\t\tconst bbox = this.measureTextBbox(textEl);\r\n\r\n\t\tconst rect = this._createBackgroundRect(g, bbox, padding, handleRadius);\r\n\t\tconst dragHandle = this._createDragHandle(g, bbox, padding, handleRadius);\r\n\r\n\t\tthis._addEventer(rect, dragHandle, comment, textEl);\r\n\r\n\t\tconst { screenPos, zoom } = this._computeScreenPosition(comment);\r\n\t\tg.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${zoom})` });\r\n\r\n\t\tif (comment._parent instanceof NodeSvg && comment._parent.svgGroup) {\r\n\t\t\tthis._drawLineToNode(comment, padding);\r\n\t\t}\r\n\t}\r\n\r\n\trefreshCommentTransforms() {\r\n\t\tfor (const comment of [\r\n\t\t\t...this.workspace.getComments(),\r\n\t\t\t...Array.from(this.workspace._nodeDB.values())\r\n\t\t\t\t.map(n => n.getComment())\r\n\t\t\t\t.filter(c => !!c) as CommentModel[]\r\n\t\t]) {\r\n\t\t\tif (!comment.svgGroup) continue;\r\n\r\n\t\t\tconst { screenPos, zoom } = this._computeScreenPosition(comment);\r\n\t\t\tcomment.svgGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${zoom})` });\r\n\r\n\t\t\tif (comment.svgLine) {\r\n\t\t\t\tcomment.svgLine.remove();\r\n\t\t\t\tcomment.svgLine = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tif (comment._parent instanceof NodeSvg) {\r\n\t\t\t\tthis._drawLineToNode(comment, 4);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _removeExistingElements(comment: CommentModel) {\r\n\t\tif (comment.svgGroup) comment.svgGroup.remove();\r\n\t\tif (comment.svgLine) comment.svgLine.remove();\r\n\t}\r\n\r\n\tprivate _createTextElement(parent: Element, text: string, x: number, y: number) {\r\n        //@ts-ignore\r\n\t\tconst textEl = parent.text(text)\r\n\t\t\t.font({ family: 'Arial', size: 12 })\r\n\t\t\t.fill('#000')\r\n\t\t\t.move(x, y)\r\n\t\t\t.addClass(CommentRenderer.COMMENT_TEXT_EL);\r\n\r\n\t\ttextEl.node.style.userSelect = 'none';\r\n\t\t// @ts-ignore\r\n\t\ttextEl.node.style!.webkitUserSelect = 'none';\r\n\t\t// @ts-ignore\r\n\t\ttextEl.node.style!.msUserSelect = 'none';\r\n\t\t// @ts-ignore\r\n\t\ttextEl.node.style!.MozUserSelect = 'none';\r\n\t\treturn textEl;\r\n\t}\r\n\r\n\tprivate _createBackgroundRect(parent: Element, bbox: any, padding: number, handleRadius: number) {\r\n        //@ts-ignore\r\n\t\treturn parent.rect(bbox.width + padding * 2 + handleRadius * 2 + 4, bbox.height + padding * 2)\r\n\t\t\t.fill('#ffffcc')\r\n\t\t\t.stroke({ color: '#cccc99', width: 1 })\r\n\t\t\t.radius(4)\r\n\t\t\t.back();\r\n\t}\r\n\r\n\tprivate _createDragHandle(parent: Element, bbox: any, padding: number, handleRadius: number) {\r\n        //@ts-ignore\r\n\t\treturn parent.circle(handleRadius * 2)\r\n\t\t\t.fill('#adad7d')\r\n\t\t\t.move(padding, padding + (bbox.height / 2) - handleRadius)\r\n\t\t\t.addClass(CommentRenderer.COMMENT_DRAG_EL);\r\n\t}\r\n\r\n\tprivate _addEventer(rect: Element, dragHandle: Element, comment: CommentModel, textEl: Element) {\r\n\t\teventer.addElement(dragHandle, 'k_draghandle', { comment })\r\n\t\t\t.tagElement(dragHandle, CommentRenderer.RENDERER_TAG_EL);\r\n\t\teventer.addElement(rect, \"k_commentinp\", { comment, text: textEl, renderer: this })\r\n\t\t\t.tagElement(rect, CommentRenderer.RENDERER_TAG_EL);\r\n\t}\r\n\r\n\tprivate _computeScreenPosition(comment: CommentModel) {\r\n\t\tlet workspaceX = comment.relativeCoords.x;\r\n\t\tlet workspaceY = comment.relativeCoords.y;\r\n\r\n\t\tif (comment._parent instanceof NodeSvg) {\r\n\t\t\tconst nodePos = comment._parent.relativeCoords;\r\n\t\t\tworkspaceX += nodePos.x;\r\n\t\t\tworkspaceY += nodePos.y;\r\n\t\t}\r\n\r\n\t\tconst screenPos = this.workspace.workspaceToScreen(workspaceX, workspaceY);\r\n\t\tconst zoom = this.workspace.getZoom();\r\n\t\treturn { screenPos, zoom };\r\n\t}\r\n\r\n\tprivate _drawLineToNode(comment: CommentModel, padding: number) {\r\n\t\tif (!comment || !(comment._parent instanceof NodeSvg) || !comment.svgGroup) return;\r\n\t\tconst svg = this.getSvg();\r\n\t\tconst ws = this.workspace;\r\n\r\n\t\tif (comment.svgLine) comment.svgLine.remove();\r\n\r\n\t\tconst nodeWSPos = comment._parent.relativeCoords;\r\n\t\tconst nodeBBox = comment._parent.svgGroup!.bbox();\r\n\t\tconst nodeTopCenter = ws.workspaceToScreen(\r\n\t\t\tnodeWSPos.x + nodeBBox.width / 2,\r\n\t\t\tnodeWSPos.y\r\n\t\t);\r\n\r\n\t\tconst parentWSPos = comment._parent.relativeCoords;\r\n\t\tconst commentRelPos = comment.relativeCoords;\r\n\t\tconst commentAbsX = parentWSPos.x + commentRelPos.x;\r\n\t\tconst commentAbsY = parentWSPos.y + commentRelPos.y;\r\n\t\tconst commentBBox = comment.svgGroup!.bbox();\r\n\t\tconst commentTopCenter = ws.workspaceToScreen(\r\n\t\t\tcommentAbsX + (commentBBox.width + padding * 2) / 2,\r\n\t\t\tcommentAbsY\r\n\t\t);\r\n\r\n\t\tcomment.svgLine = svg.line(\r\n\t\t\tnodeTopCenter.x, nodeTopCenter.y,\r\n\t\t\tcommentTopCenter.x, commentTopCenter.y\r\n\t\t)\r\n\t\t\t.stroke({ color: '#888', width: 1, dasharray: '3,2' })\r\n\t\t\t.addClass(CommentRenderer.COMMENT_LINE_TAG)\r\n\t\t\t.back();\r\n\t}\r\n\r\n\tclearAllComments() {\r\n\t\tconst svg = this.getSvg();\r\n\t\tsvg.find(`.${CommentRenderer.COMMENT_G_TAG}`).forEach(el => el.remove());\r\n\t\tsvg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n\t\teventer.destroyByTag(CommentRenderer.RENDERER_TAG_EL);\r\n\r\n\t\tfor (let [_, node] of this.workspace._nodeDB) {\r\n\t\t\tconst comment = node.getComment();\r\n\t\t\tif (comment) comment.svgGroup = undefined;\r\n\t\t}\r\n\r\n\t\tfor (const comment of this.workspace.getComments()) {\r\n\t\t\tcomment.svgGroup = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tclearCommentLines() {\r\n\t\tconst svg = this.getSvg();\r\n\t\tsvg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n\t}\r\n\r\n\tdrawAllComments() {\r\n\t\tfor (const comment of this.workspace.getComments()) this.drawComment(comment);\r\n\t\tfor (let [_, node] of this.workspace._nodeDB) {\r\n\t\t\tconst comment = node.getComment();\r\n\t\t\tif (comment) this.drawComment(comment);\r\n\t\t}\r\n\t}\r\n\r\n\tgetSvg(): Svg {\r\n\t\treturn this.workspace.svg;\r\n\t}\r\n    getWs(): WorkspaceSvg {\r\n        return this.workspace;\r\n    }\r\n}\r\n\r\nexport default CommentRenderer;\r\n","\r\nimport ApolloRenderer from \"./renderer\"\r\nimport ApolloConstants from \"./constants\"\r\nimport Representer from \"../representer\"\r\nimport { RepresenterNode } from \"../representer-node\"\r\n\r\nexport interface apolloType {\r\n    Renderer: typeof ApolloRenderer;\r\n    Constants: typeof ApolloConstants;\r\n    Representer: typeof Representer;\r\n    RepresenterNode: typeof RepresenterNode;\r\n}\r\n\r\n\r\nexport {\r\n    ApolloRenderer as Renderer,\r\n    ApolloConstants as Constants,\r\n    // Despite apollo not extending these, we still need to re-export them for the API.\r\n    Representer,\r\n    RepresenterNode\r\n}","import RendererConstants from \"./constants\";\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport * as Path from '../util/path';\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport { G, Path as SvgPath, Svg, StrokeData, Element, List, Rect } from \"@svgdotjs/svg.js\";\r\nimport { Color, ColorStyle, Hex } from \"../src/visual-types\";\r\nimport Field, { AnyField, ConnectableField, DummyField, FieldRawBoxData, OptConnectField } from \"../src/field\";\r\nimport eventer from '../util/eventer';\r\nimport Connection, { Connectable } from \"../src/connection\";\r\nimport escapeAttr from '../util/escape-html';\r\nimport unescapeAttr from '../util/unescape-html';\r\nimport CommentRenderer from \"../comment-renderer/renderer\";\r\nimport { FieldVisualInfo } from \"../src/field\";\r\nimport { RepresenterNode } from \"./representer-node\";\r\nimport type Representer from \"./representer\";\r\n\r\nexport interface ConnectorToFrom {\r\n    to: Connection,\r\n    from: Connection,\r\n    fromCircle?: SvgPath,\r\n    toCircle?: SvgPath,\r\n    originConn: Connection,\r\n    originCircle: SvgPath\r\n}\r\nexport interface DrawState {\r\n    id: string;\r\n    shadow?: SvgPath;\r\n    topbar?: SvgPath | null;\r\n    bg?: SvgPath | null;\r\n    group?: G | null;\r\n    fieldCol?: G | null;\r\n    fieldPosY?: number | null; // starts under topbar, goes down by field height each time one is drawn. This determines position\r\n    xButton?: G;\r\n    pendingConnections: ConnectorToFrom[]\r\n}\r\nexport interface NodeMeasurements {\r\n    width: number;\r\n    height: number;\r\n    fields: { width: number; height: number }[];\r\n}\r\n\r\nclass Renderer {\r\n    /**\r\n     * Set of constants the renderer uses for drawing nodes.\r\n     */\r\n    _constants!: RendererConstants;\r\n    /**\r\n     * The current node being rendered.\r\n     */\r\n    _currentNode: NodeSvg | null;\r\n    /**\r\n     * The SVG group element for the current node.\r\n     */\r\n    _nodeGroup: G | null;\r\n    /**\r\n     * The current drawing state for the node.\r\n     */\r\n    _nodeDraw: DrawState | null;\r\n    /**\r\n     * The workspace this renderer is associated with.\r\n     */\r\n    _ws: WorkspaceSvg;\r\n    /**\r\n     * Array of stored draw states for rendered nodes.\r\n     */\r\n    _drawStates: DrawState[];\r\n    /**\r\n     * Comment renderer instance used for rendering comments.\r\n     */\r\n    _commentDrawer!: CommentRenderer;\r\n    /**\r\n     * Representer instance used for building node representations.\r\n     */\r\n    representer!: Representer;\r\n    /**\r\n     * Constant overrides provided during renderer instantiation.\r\n     */\r\n    constantOverrides: Partial<RendererConstants>;\r\n    /**\r\n     * Tag used for node group elements in the SVG.\r\n     */\r\n    static get NODE_G_TAG() {\r\n        return 'AtlasNodeSVG';\r\n    }\r\n    /**\r\n     * Tag used for renderer elements in the SVG.\r\n     */\r\n    static get ELEMENT_TAG() {\r\n        return 'AtlasElement'\r\n    }\r\n    /**\r\n     * Tag used for connection line elements in the SVG.\r\n     */\r\n    static get CONN_LINE_TAG() {\r\n        return 'AtlasConnectionLine';\r\n    }\r\n    /**\r\n     * Tag used for connector elements in the SVG.\r\n     */\r\n    static get CONNECTOR_TAG() {\r\n        return 'AtlasConnectionBubble';\r\n    }\r\n    /**\r\n     * Tag used for line X mark elements in the SVG.\r\n     */\r\n    static get LINE_X_MARK_TAG() {\r\n        return 'AtlasLineXMark';\r\n    }\r\n    /**\r\n     * Tag used for background pattern elements in the SVG. This is constant, do not modify it in subclasses.\r\n     */\r\n    static get BACKGROUND_PATTERN() {\r\n        /** ! CONSTANT ! DO NOT CHANGE ! CONSTANT ! */\r\n        return 'WorkspaceBgPattern'\r\n    }\r\n    /**\r\n     * Name of the renderer.\r\n     */\r\n    static get NAME() {\r\n        return 'atlas'; // default is called atlas.\r\n    }\r\n    /**\r\n     * Constructor for the Renderer class.\r\n     * @param workspace - The workspace associated with the renderer.\r\n     * @param overrides - Optional constant overrides for the renderer.\r\n     */\r\n    constructor(workspace: WorkspaceSvg, overrides: Partial<RendererConstants> = {}) {\r\n        this._ws = workspace;\r\n        this._currentNode = null;\r\n        this._nodeGroup = null;\r\n        this._nodeDraw = null;\r\n        this._drawStates = [];\r\n        this.constantOverrides = overrides;\r\n        this.init();\r\n    }\r\n    /**\r\n     * Initializes the renderer by setting up the comment renderer, representer, and constants.\r\n     */\r\n    init() {\r\n        this.initCommentRenderer();\r\n        this.initRepresenter();\r\n        this.initConstants();\r\n    }\r\n    /**\r\n     * Initializes the renderer constants with any provided overrides.\r\n     */\r\n    initConstants() {\r\n        this._constants = new RendererConstants(this.constantOverrides);\r\n    }\r\n    /**\r\n     * Initializes the representer for the renderer.\r\n     */\r\n    initRepresenter() {\r\n        const Representer = (require('./representer').default);\r\n        this.representer = new Representer();\r\n    }\r\n    /**\r\n     * Initializes the comment renderer for the workspace.\r\n     */\r\n    initCommentRenderer() {\r\n        this._commentDrawer = new CommentRenderer(this.getWs());\r\n    }\r\n    /**\r\n     * Sets the connection to be processed.\r\n     * @param c - The connection to set.\r\n     */\r\n    setConnect(c: ConnectorToFrom) {\r\n        this.state?.pendingConnections?.push?.(c);\r\n    }\r\n    /**\r\n     * Sets the renderer constants.\r\n     * @param c - Partial constants to override.\r\n     * @returns The updated constants.\r\n     */\r\n    setConstants(c: Partial<RendererConstants> = {}) {\r\n        return Object.assign(this._constants, c);\r\n    }\r\n    /**\r\n     * Gets the renderer constants, merging with node style if applicable.\r\n     */\r\n    get constants(): RendererConstants {\r\n        if (!this.node) return this._constants;\r\n\r\n        const { primary, secondary, tertiary, ...restColors } = this.node.colors;\r\n\r\n        return {\r\n            ...this._constants,\r\n            ...restColors\r\n        };\r\n    }\r\n    /**\r\n     * Sets the renderer constants.\r\n     */\r\n    set constants(c: Partial<RendererConstants>) {\r\n        this.setConstants(c);\r\n    }\r\n    /**\r\n     * Gets the current node being rendered.\r\n     */\r\n    get node() {\r\n        return this._currentNode;\r\n    }\r\n    /**\r\n     * Gets the SVG.js instance from the workspace.\r\n     */\r\n    get svg(): Svg {\r\n        return this.getWs().svg; // Svg.js instance\r\n    }\r\n    /**\r\n     * Gets the current drawing state.\r\n     */\r\n    get state(): null | undefined | DrawState {\r\n        return this._nodeDraw;\r\n    }\r\n    /**\r\n     * Gets the workspace associated with the renderer.\r\n     * @returns The workspace instance.\r\n     */\r\n    getWs() {\r\n        return this._ws;\r\n    }\r\n    // MEASURING -\r\n\r\n    /**\r\n     * Gets the base measurements for a node.\r\n     * @returns The base width and height of the node.\r\n     */\r\n    getNodeBaseMeasurements() {\r\n        const c = this.constants;\r\n        return {\r\n            width: c.NODE_BASE_WIDTH,\r\n            height: c.NODE_BASE_HEIGHT\r\n        }\r\n    }\r\n    /**\r\n     * Measures the width of the given text.\r\n     * @param text - The text to measure.\r\n     * @param fontSize - The font size to use.\r\n     * @param fontFamily - The font family to use.\r\n     * @returns The width of the text.\r\n     */\r\n    measureTextWidth(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return text.length * (fontSize ?? c.FONT_SIZE) * 0.6;\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const width = txt.bbox().width;\r\n        txt.remove(); // clean up\r\n        return width;\r\n    }\r\n    /**\r\n     * Measures the height of the given text.\r\n     * @param text - The text to measure.\r\n     * @param fontSize - The font size to use.\r\n     * @param fontFamily - The font family to use.\r\n     * @returns The height of the text.\r\n     */\r\n    measureTextHeight(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return (fontSize ?? c.FONT_SIZE);\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const height = txt.bbox().height;\r\n        txt.remove(); // clean up\r\n        return height;\r\n    }\r\n    /**\r\n     * Measures the dimensions of a raw input field.\r\n     * @param text - The text content of the raw field.\r\n     * @returns The width and height of the raw field.\r\n     */\r\n    measureRawField(text: string = \"\") {\r\n        const c = this.constants;\r\n        const textW = this.measureTextWidth(text);\r\n        const width = Math.max(c.FIELD_RAW_BASE_WIDTH, textW + c.INPUT_BOX_PADDING * 2);\r\n        const height = c.FIELD_RAW_BASE_HEIGHT;\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Measures the label of a field.\r\n     * @param field - The field to measure the label for.\r\n     * @returns The width and height of the label.\r\n     */\r\n    measureLabel(field: AnyField): { width: number, height: number } {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return { width: 0, height: 0 };\r\n\r\n        const width = this.measureTextWidth(label);\r\n        const height = this.measureTextHeight(label);\r\n\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Measures the raw input of a field.\r\n     * @param field - The field to measure the raw input for.\r\n     * @returns The width and height of the raw input.\r\n     */\r\n    measureRaw(field: AnyField): { width: number, height: number } {\r\n        if (!field.hasRaw()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const raw = this.measureRawField(field.getValue?.() ?? \"\");\r\n        return {\r\n            width: raw.width,\r\n            height: raw.height\r\n        };\r\n    }\r\n    /**\r\n     * Measures the custom editor of a field.\r\n     * @param field - The field to measure the custom editor for.\r\n     * @returns The width and height of the custom editor.\r\n     */\r\n    measureCustom(field: AnyField): { width: number, height: number } {\r\n        if (!field.isCustomEditor()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const m = field.measureMyself();\r\n        if (!m) return { width: 0, height: 0 };\r\n\r\n        let width = m.width as number;\r\n        let height = m.height as number;\r\n\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Gets the padding to apply when measuring a field.\r\n     * @returns The width and height padding for the field.\r\n     */\r\n    getFieldMeasurementPadding() {\r\n        return { width: this.constants.FIELD_SPACEX, height: 0 }\r\n    }\r\n    /**\r\n     * Measures the overall dimensions of a field.\r\n     * @param field - The field to measure.\r\n     * @returns The width and height of the field.\r\n     */\r\n    measureField(field: AnyField) {\r\n        // parts of the measurement, correct order matters.\r\n        const parts = [\r\n            this.getFieldMeasurementPadding(),\r\n            this.measureLabel(field),\r\n            this.measureRaw(field),\r\n            this.measureCustom(field),\r\n            this.getFieldMeasurementPadding()\r\n        ];\r\n\r\n        let width = 0, height = 0;\r\n        for (const { width: w, height: h } of parts) {\r\n            width += w;\r\n            height = Math.max(height, h);\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n    /**\r\n     * Measures the overall dimensions of the current node.\r\n     * @returns The measurements of the node including width, height, and field dimensions.\r\n     */\r\n    measureNodeDimensions(): NodeMeasurements | void | null {\r\n        if (!this.node) return;\r\n\r\n        const c = this.constants;\r\n\r\n        const base = this.measureBaseAndLabel();\r\n\r\n        const fieldResult = this.measureFields(\r\n            c.TOPBAR_HEIGHT + c.FIELD_SPACEY,\r\n            base.width,\r\n            base.height\r\n        );\r\n\r\n        return {\r\n            width: fieldResult.width,\r\n            height: fieldResult.height + c.FOOTER_HEIGHT,\r\n            fields: fieldResult.fields\r\n        };\r\n    }\r\n    /**\r\n     * Measures all fields of the current node.\r\n     * @param startY The starting Y position for the fields.\r\n     * @param startWidth The starting width of the node.\r\n     * @param startHeight The starting height of the node.\r\n     * @returns The width, height, and field dimensions.\r\n     */\r\n    measureFields(\r\n        startY: number,\r\n        startWidth: number,\r\n        startHeight: number\r\n    ): {\r\n        width: number;\r\n        height: number;\r\n        fields: { width: number; height: number }[];\r\n    } {\r\n        const c = this.constants;\r\n        const node = this.node!;\r\n\r\n        let y = startY;\r\n        let totalWidth = startWidth;\r\n        let totalHeight = startHeight;\r\n        const fields: { width: number; height: number }[] = [];\r\n\r\n        for (const field of node.allFields()) {\r\n            const m = this.measureField(field);\r\n            fields.push(m);\r\n\r\n            totalWidth = Math.max(\r\n                totalWidth,\r\n                m.width + c.FIELD_MARGIN_X * 2\r\n            );\r\n\r\n            const bottom = y + m.height;\r\n            if (bottom + c.FIELD_MARGIN_Y > totalHeight) {\r\n                totalHeight = bottom + c.FIELD_MARGIN_Y;\r\n            }\r\n\r\n            y += m.height + c.FIELD_MARGIN_Y;\r\n        }\r\n\r\n        return { width: totalWidth, height: totalHeight, fields };\r\n    }\r\n    /**\r\n     * Measures the base dimensions of the current node including label.\r\n     * @returns The width and height of the node base and label.\r\n     */\r\n    private measureBaseAndLabel(): { width: number; height: number } {\r\n        const c = this.constants;\r\n        const node = this.node!;\r\n\r\n        const base = this.getNodeBaseMeasurements();\r\n        let width = base.width;\r\n        let height = base.height;\r\n\r\n        if (node.labelText) {\r\n            const labelW = this.measureTextWidth(\r\n                node.labelText,\r\n                c.FONT_SIZE,\r\n                c.FONT_FAMILY\r\n            );\r\n\r\n            width = Math.max(\r\n                width,\r\n                labelW + c.TOPBAR_LABEL_MARGIN_X * 2\r\n            );\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n    // renderNode METHOD + NODE DRAW INITING.\r\n    /**\r\n     * Renders the specified node by drawing it and building its representation.\r\n     * @param nodeIdOrNode The node or node ID to render.\r\n     * @returns Void.\r\n     */\r\n    renderNode(nodeIdOrNode: NodeSvg | string) {\r\n        this.startNode(nodeIdOrNode);\r\n        if (!this.node) return;\r\n        this.drawNode();\r\n        this.representer.build(this.node as NodeSvg, this, this.state as DrawState);\r\n        this.storeState();\r\n    }\r\n    /**\r\n     * Starts rendering the specified node.\r\n     * @param nodeIdOrNode The node or node ID to start rendering.\r\n     */\r\n    startNode(nodeIdOrNode: NodeSvg | string) {\r\n        const ws = this.getWs();\r\n        if (nodeIdOrNode instanceof NodeSvg) {\r\n            this._currentNode = nodeIdOrNode;\r\n        } else {\r\n            const node = ws.getNode(nodeIdOrNode);\r\n            if (node instanceof NodeSvg) {\r\n                this._currentNode = node;\r\n            } else {\r\n                this._currentNode = null;\r\n            }\r\n        }\r\n    }\r\n    // DRAW-STATE MANAGEMENT -\r\n    /**\r\n     * Build a draw state for the given node group and ID.\r\n     * @param nodeGroup - The SVG group element for the node.\r\n     * @param id  - The ID of the node.\r\n     * @returns - The constructed DrawState object.\r\n     */\r\n    drawState(nodeGroup: G, id: string): DrawState {\r\n        return {\r\n            id,\r\n            group: nodeGroup,\r\n            fieldPosY: 0,\r\n            pendingConnections: []\r\n        }\r\n    }\r\n    /**\r\n     * Stores the current draw state.\r\n     */\r\n    storeState() {\r\n        this._drawStates.push(this.state as DrawState);\r\n    }\r\n    // DRAWING + EVENT INITIALIZING VIA EVENTER\r\n    /**\r\n     * Draws a raw input field.\r\n     * @param fieldGroup - The SVG group element for the field.\r\n     * @param field - The field to draw.\r\n     * @param startX - The starting X position for the field.\r\n     * @returns The rectangle and text elements of the raw field.\r\n     */\r\n    drawFieldRaw(fieldGroup: G, field: AnyField, startX: number = 0) {\r\n        const c = this.constants;\r\n        const value = field.getDisplayValue?.() ?? \"\";\r\n        const { width, height } = this.measureRawField(value);\r\n\r\n        const rect = fieldGroup.rect(width, height)\r\n            .fill(parseColor(c.FIELD_RAW_COLOR))\r\n            .stroke({ color: parseColor(c.FIELD_RAW_OUTLINE_COLOR), width: c.FIELD_RAW_OUTLINE_STROKE })\r\n            .radius(3);\r\n\r\n        const txt = fieldGroup.text(value)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: c.INPUT_BOX_TEXT_ANCHOR\r\n            })\r\n            .fill(parseColor(c.FIELD_RAW_TEXT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n\r\n        const rawBox: FieldRawBoxData = {\r\n            box: rect,\r\n            txt\r\n        }\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (height - textBBox.height) / 2;\r\n\r\n        // move relative to startX (after label)\r\n        rect.move(startX, 0);\r\n        txt.move(startX + c.INPUT_BOX_PADDING, offsetY);\r\n        eventer.addElement(rect, \"k_inputbox\", {\r\n            field,      // the field object that has .getValue() and .setValue(v)\r\n            text: txt,       // the svg.js Text element you drew\r\n            renderer: this,   // the renderer instance, must have .measureRawField and .constants\r\n            startX   // x-offset where the box should start (after label)\r\n        }).tagElement(rect, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${this.node!.id}`])\r\n\r\n        return { rect, txt, rawBox };\r\n    }\r\n\r\n    /**\r\n     * Draws the label of a field.\r\n     * @param fieldGroup - The SVG group element for the field.\r\n     * @param field - The field to draw the label for.\r\n     * @param startX - The starting X position for the label.\r\n     * @returns The width used by the label including spacing.\r\n     */\r\n    drawFieldLabel(fieldGroup: G, field: AnyField, startX: number = 0): number {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return 0;\r\n\r\n        const txt = fieldGroup.text(label)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .fill(parseColor(c.FONT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n        const bbox = txt.bbox();\r\n        const offsetY = (Math.max(c.FIELD_RAW_BASE_HEIGHT, bbox.height) - bbox.height) / 2;\r\n\r\n        // move label relative to startX\r\n        txt.move(startX, offsetY);\r\n\r\n        // return width used for next element\r\n        return bbox.width + c.LABEL_SPACING;\r\n    }\r\n    /**\r\n     * Draws the X button on the node's top bar.\r\n     * @returns Void.\r\n     */\r\n    drawNodeXButton() {\r\n        const node = this.node;\r\n        const state = this._nodeDraw;\r\n        if (!node || !state || !state.group) return;\r\n\r\n        const c = this.constants;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n\r\n        const btnSize = c.TOPBAR_HEIGHT * 0.6;\r\n        const padding = (c.TOPBAR_HEIGHT - btnSize) / 2;\r\n\r\n        // Button group\r\n        const xGroup = state.group.group().attr({ class: 'node-x-clse' });\r\n        eventer.addElement(xGroup, 'k_closenode', {\r\n            workspace: this.getWs(),\r\n            node\r\n        }).tagElement(xGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n        // Background\r\n        xGroup.rect(btnSize, btnSize)\r\n            .fill('#ffffff00')\r\n            .radius(2)\r\n            .move(width - btnSize - padding, padding);\r\n\r\n        // X mark\r\n        const txt = xGroup.text('')\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: btnSize * 0.8,\r\n                weight: 'bold',\r\n                anchor: 'middle'\r\n            })\r\n            .fill('#fff')\r\n            .attr({\r\n                'text-anchor': 'middle',        // horizontal centering\r\n                'dominant-baseline': 'middle'   // vertical centering\r\n            });\r\n        txt.node.style.userSelect = 'none';\r\n        // Apply transform to center it inside the button\r\n        txt.transform({\r\n            translateX: width - btnSize / 2 - padding,\r\n            translateY: padding + btnSize / 2\r\n        });\r\n\r\n        state.xButton = xGroup;\r\n    }\r\n    /**\r\n     * Draws a connector on the specified side of the node.\r\n     * @param nodeGroup - The SVG group element for the node.\r\n     * @param nodeBg - The background SVG path of the node.\r\n     * @param y - The Y position for the connector.\r\n     * @param side - The side to draw the connector on ('left' or 'right').\r\n     * @param color - The color of the connector.\r\n     * @returns The SVG path of the connector or null if not drawn.\r\n     */\r\n    drawConnector(nodeGroup: G, nodeBg: SvgPath, y: number, side: 'left' | 'right', color: string): SvgPath | void | undefined | null {\r\n        const c = this.constants;\r\n        if (!nodeGroup || !nodeBg) return null;\r\n\r\n        const bbox = nodeBg.bbox(); // get dimensions of the background\r\n        const group = nodeGroup;     // attach connector to top-level node group\r\n        const x = side === 'left' ? 0 : bbox.width;\r\n\r\n        if (c.CONNECTOR_TRIANGLE) {\r\n            // small triangle connector\r\n            const triSize = c.CONNECTOR_TRI_SIZE;\r\n            let path = Path.roundedTri(triSize, triSize, 1);\r\n\r\n            // flip triangle horizontally for left side\r\n            if (side === 'left') path = Path.rotatePath(path, 180, triSize / 2, triSize / 2);\r\n\r\n            const tri = group.path(path)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 });\r\n            tri.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            const offsetX = side === 'left' ? -triSize : 0;\r\n            tri.transform({ translateX: x + offsetX, translateY: y - triSize / 2 });\r\n\r\n            return tri;\r\n        } else {\r\n            // circle connector\r\n            const radius = c.CONNECTOR_RADIUS;\r\n            const circlePath = Path.circle(radius);\r\n\r\n            const circ = group.path(circlePath)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .move(x - radius, y - radius); // center circle at (x, y)\r\n            circ.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            return circ;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws the label on the node's top bar.\r\n     * @param nodeGroup - The SVG group element for the node.\r\n     * @returns Void.\r\n     */\r\n    drawNodeLabel(nodeGroup: G) {\r\n        const node = this.node;\r\n        const c = this.constants;\r\n        if (!node) return;\r\n\r\n        if (node.labelText) {\r\n            const txt = nodeGroup.text(node.labelText)\r\n                .font({\r\n                    family: c.FONT_FAMILY,\r\n                    size: c.FONT_SIZE,\r\n                    anchor: 'start',\r\n                    weight: c.TOPBAR_LABEL_BOLDED ? '600' : 'normal'\r\n                })\r\n                .fill(parseColor(c.FONT_COLOR));\r\n\r\n            txt.node.style.userSelect = 'none';\r\n\r\n            const bbox = txt.bbox();\r\n            const offsetY = (c.TOPBAR_HEIGHT - bbox.height) / 2;\r\n\r\n            txt.move(c.TOPBAR_LABEL_MARGIN_X, offsetY + c.TOPBAR_LABEL_MARGIN_Y);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws the current node.\r\n     * @returns Void.\r\n     */\r\n    drawNode() {\r\n        if (!this.node) return;\r\n\r\n        const node = this.node;\r\n        const state = this.drawState(this.createNodeGroup(node), node.id);\r\n        this._nodeDraw = state;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n\r\n        this.drawNodeBase(state, measurements as NodeMeasurements);\r\n        this.drawNodeTopbar(state, this.getNodeColors(), measurements as NodeMeasurements);\r\n        this.drawNodeXButton();\r\n        this.drawNodeLabel(state.group!);\r\n        this.makeNodeDraggable(state.group!, state.topbar!, node);\r\n\r\n        this.createFieldGroup(state);\r\n        this.drawAllFieldsForNode(measurements as NodeMeasurements);\r\n\r\n        this.drawPreviousNextConnections(state, node, state.group!, measurements as NodeMeasurements);\r\n    }\r\n    /**\r\n     * Creates the SVG group for the given node.\r\n     * @param node - The node to create the group for.\r\n     * @returns The created SVG group element.\r\n     */\r\n    createNodeGroup(node: NodeSvg): G {\r\n        const nodeGroup = this.svg.group().attr({\r\n            'data-node-id': escapeAttr(node.id),\r\n            'class': (this.constructor as typeof Renderer).NODE_G_TAG\r\n        });\r\n        const screenPos = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n        nodeGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y})` });\r\n        return nodeGroup;\r\n    }\r\n    /**\r\n     * Draws the base and shadow of the node.\r\n     * @param state - The current drawing state.\r\n     * @param measurements - The measurements of the node.\r\n     */\r\n    drawNodeBase(state: DrawState, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const height = measurements?.height ?? c.NODE_BASE_HEIGHT;\r\n        const radius = c.CORNER_RADIUS;\r\n        state.bg = state.group!.path(Path.roundedRect(width, height, radius))\r\n            .fill(parseColor(c.NODE_BG_COLOR))\r\n            .stroke({ color: parseColor(c.NODE_OUTLINE_COLOR), width: 2 } as StrokeData);\r\n        state.shadow = state.group!.path(Path.roundedRect(width, height, radius))\r\n            .fill('rgba(0,0,0,0.2)')\r\n            .move(Number(state.bg.x()) + 5, Number(state.bg.y()) + 5)\r\n            .back(); // make sure it's behind the node\r\n    }\r\n    /**\r\n     * Draw the node's topbar\r\n     * @param state - The draw state\r\n     * @param colors - The colors of the node.\r\n     * @param measurements - The measurement data of the node.\r\n     */\r\n    drawNodeTopbar(state: DrawState, colors: ColorStyle, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const radius = c.CORNER_RADIUS;\r\n        state.topbar = state.group!.path(Path.roundedRect(width, c.TOPBAR_HEIGHT, radius))\r\n            .fill(parseColor(colors.primary))\r\n            .stroke({ color: parseColor(colors.tertiary), width: 2 } as StrokeData);\r\n    }\r\n    /**\r\n     * Make a node draggable.\r\n     * @param nodeGroup - The node group to make draggable\r\n     * @param dragHandle - The drag handle\r\n     * @param node - The nodesvg\r\n     */\r\n    makeNodeDraggable(nodeGroup: G, dragHandle: SvgPath, node: NodeSvg) {\r\n        eventer.addElement(nodeGroup, 'k_draggable', {\r\n            dragel: dragHandle,\r\n            group: nodeGroup,\r\n            node,\r\n            type: 2\r\n        }).tagElement(nodeGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n    }\r\n    /** Create the field group for the node */\r\n    createFieldGroup(state: DrawState) {\r\n        const c = this.constants;\r\n        const fieldsGroup = state.group!.group();\r\n        fieldsGroup.attr({ transform: `translate(0, ${c.TOPBAR_HEIGHT + c.FIELD_SPACEY})` });\r\n        state.fieldCol = fieldsGroup;\r\n    }\r\n    /**\r\n     * Draw a field on a node.\r\n     * @param field - The field to draw\r\n     * @param measurements - The node's measurements\r\n     * @param idx - Index of the field in the fieldColumn list\r\n     * @param y - the y position of the field\r\n     * @returns \r\n     */\r\n    drawFieldForNode(field: AnyField, measurements: NodeMeasurements, idx: number, y: number) {\r\n        const node = this.node;\r\n        const state = this.state;\r\n        const c = this.constants;\r\n        if (!node || !state || !state.fieldCol) return;\r\n        const fieldsGroup = state.fieldCol;\r\n        const nodeGroup = state.group as G;\r\n        const fm = measurements?.fields[idx];\r\n        if (!fm) return;\r\n\r\n        // default left alignment\r\n        let alignX = c.FIELD_MARGIN_X;\r\n\r\n        const fieldGroup = fieldsGroup.group();\r\n        fieldGroup.attr({ transform: `translate(${alignX}, ${y})` });\r\n        field.svgGroup = fieldGroup;\r\n        state.fieldPosY = y;\r\n\r\n        // draw label first, get its used width\r\n        const xUsed = this.drawFieldLabel(fieldGroup, field);\r\n        if (field.isCustomEditor()) {\r\n            // field fully owns drawing\r\n            field.drawMyself({\r\n                measuredWidth: fm.width,\r\n                measuredHeight: fm.height,\r\n                xUsed,\r\n                fieldGroup,\r\n                nodeGroup,\r\n                svg: this.svg,\r\n                background: state!.bg as unknown as Rect\r\n            });\r\n        } else {\r\n            let rawData, cBubbleData = undefined;\r\n            // if raw, draw right after label\r\n            if (field.hasRaw()) {\r\n                const { rawBox } = this.drawFieldRaw(fieldGroup, field, xUsed);\r\n                rawData = rawBox;\r\n            }\r\n            if (field.hasConnectable() && (field as ConnectableField)!.connection) {\r\n                const halfHeight = (fm.height + (field.hasRaw() ? 0 : c.FIELD_MARGIN_Y)) / 2;\r\n                const absY = c.TOPBAR_HEIGHT + c.FIELD_SPACEY + y + halfHeight;\r\n\r\n\r\n                const c3 = this.drawConnector(\r\n                    nodeGroup,\r\n                    state.bg as SvgPath,\r\n                    absY,\r\n                    'right',\r\n                    parseColor(c.FIELD_CONN_COLOR)\r\n                );\r\n                if (c3) {\r\n                    const c = {\r\n                        from: (field as ConnectableField)!.connection as Connection,\r\n                        to: ((field as ConnectableField)!.connection.getTo() as NodeSvg)?.previousConnection as Connection,\r\n                        fromCircle: c3 as SvgPath,\r\n                        originCircle: c3 as SvgPath,\r\n                        originConn: (field as ConnectableField)!.connection as Connection\r\n                    };\r\n                    cBubbleData = {\r\n                        connector: c3,\r\n                        connState: c\r\n                    }\r\n                    this.setConnect(c);\r\n                    eventer.addElement(c3, 'k_connectbubble', {\r\n                        connection: (field as ConnectableField)!.connection as Connection,\r\n                        field\r\n                    }).tagElement(c3, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                }\r\n            }\r\n            field.onDraw(rawData, cBubbleData);\r\n        }\r\n    }\r\n    /**\r\n     * Draw all fields on a node\r\n     * @param nodeMeasurements - The node's measurements\r\n     * @returns The final Y position.\r\n     */\r\n    drawAllFieldsForNode(nodeMeasurements: NodeMeasurements | null = null) {\r\n        const node = this.node;\r\n        let y = 0;\r\n        const state = this.state;\r\n        const c = this.constants;\r\n        if (!node || !state || !state.fieldCol) return;\r\n        const fieldsGroup = state.fieldCol;\r\n        const nodeGroup = state.group as G;\r\n\r\n        const measurements = nodeMeasurements ?? this.measureNodeDimensions();\r\n\r\n        node.allFields().forEach((field, idx) => {\r\n            this.drawFieldForNode(field, measurements as NodeMeasurements, idx, y);\r\n            const fm = measurements?.fields[idx];\r\n            if (!fm) return;\r\n            y += fm.height + c.FIELD_MARGIN_Y;\r\n        });\r\n\r\n        state.fieldPosY = y;\r\n        return y;\r\n    }\r\n    /**\r\n     * Draw the previous and next connections of a node.\r\n     * @param state - The draw-state\r\n     * @param node - The node-svg\r\n     * @param nodeGroup - the node's group\r\n     * @param measurements - the node's measurements\r\n     * @returns Void\r\n     */\r\n    drawPreviousNextConnections(state: DrawState, node: NodeSvg, nodeGroup: G, measurements: { width: number, height: number } | null = null) {\r\n        if (!state || !node) return;\r\n        if (!state.bg) return;\r\n        const c = this.constants;\r\n        const colors: ColorStyle = this.getNodeColors();\r\n        /**\r\n         * Draw connectors.\r\n         */\r\n        const bbox = state.bg?.bbox();\r\n        const cY = (bbox?.height ?? measurements?.height) - c.FOOTER_HEIGHT;\r\n\r\n        // Previous connection (left)\r\n        if (node.previousConnection) {\r\n            const c1 = this.drawConnector(nodeGroup, state.bg, cY, 'left', parseColor(colors.primary) as string);\r\n            if (c1) {\r\n                const c = ({\r\n                    from: node.previousConnection,\r\n                    to: this.resolveConnectable(node.previousConnection.getFrom(), node.previousConnection) as Connection,\r\n                    fromCircle: c1 as SvgPath,\r\n                    originConn: node.previousConnection,\r\n                    originCircle: c1\r\n                });\r\n                this.setConnect(c);\r\n                eventer.addElement(c1, 'k_connectbubble', {\r\n                    connection: node.previousConnection,\r\n                    node\r\n                }).tagElement(c1, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.previousConnection, c1 as SvgPath, true);\r\n            }\r\n        }\r\n\r\n        // Next connection (right)\r\n        if (node.nextConnection) {\r\n            const c2 = this.drawConnector(nodeGroup, state.bg, cY, 'right', parseColor(colors.primary) as string);\r\n            if (c2) {\r\n                const c = ({\r\n                    from: node.nextConnection,\r\n                    to: this.resolveConnectable(node.nextConnection.getTo(), node.nextConnection) as Connection,\r\n                    fromCircle: c2 as SvgPath,\r\n                    originConn: node.nextConnection,\r\n                    originCircle: c2\r\n                });\r\n                this.setConnect(c);\r\n                eventer.addElement(c2, 'k_connectbubble', {\r\n                    connection: node.nextConnection,\r\n                    node\r\n                }).tagElement(c2, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.nextConnection, c2 as SvgPath, false);\r\n            }\r\n        }\r\n    }\r\n    // REFRESHING TRANSFORMS AND COMMENTS -\r\n    /**\r\n     * Refreshes the comment transforms.\r\n     * @returns Void.\r\n     */\r\n    refreshComments() {\r\n        return this._commentDrawer?.refreshCommentTransforms?.();\r\n    }\r\n    /**\r\n     * Clears all comments from the workspace.\r\n     * @returns Void.\r\n     */\r\n    clearComments() {\r\n        return this._commentDrawer?.clearAllComments?.();\r\n    }\r\n    /**\r\n     * Draws all comments in the workspace.\r\n     * @returns Void.\r\n     */\r\n    drawComments() {\r\n        return this._commentDrawer?.drawAllComments?.();\r\n    }\r\n    /**\r\n     * Gets the current zoom level of the workspace.\r\n     * @returns The zoom level.\r\n     */\r\n    getZoom() {\r\n        return this._ws.getZoom() ?? 1;\r\n    }\r\n    /**\r\n     * Applies the current zoom level to the specified node group.\r\n     * @param nodeG - The SVG group element of the node.\r\n     * @param node - The node to apply zoom to.\r\n     */\r\n    applyZoomToNode(nodeG: G, node: NodeSvg) {\r\n        const zoom = this.getZoom();\r\n        const { x, y } = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n        nodeG.attr({ transform: `translate(${x}, ${y}) scale(${zoom})` });\r\n    }\r\n    /**\r\n     * Refreshes the transforms of all nodes in the workspace.\r\n     * @returns Void.\r\n     */\r\n    refreshNodeTransforms() {\r\n        const nodeGroups = this.svg.find(`.${(this.constructor as typeof Renderer).NODE_G_TAG}`);\r\n        const zoom = this.getZoom();\r\n\r\n        for (let nodeG of nodeGroups) {\r\n            const node = this._ws.getNode(unescapeAttr(nodeG.attr('data-node-id')));\r\n            if (!node) continue;\r\n            const { x, y } = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n            nodeG.attr({ transform: `translate(${x}, ${y}) scale(${zoom})` });\r\n        }\r\n\r\n        this.refreshConnectionLines();\r\n        this.refreshComments();\r\n    }\r\n\r\n    /**\r\n     * Refreshes all connection lines in the workspace.\r\n     * @returns Void.\r\n     */\r\n    refreshConnectionLines() {\r\n        this.clearLines();\r\n        this.drawLinesForAllNodes();\r\n    }\r\n    /**\r\n     * Gets the colors for the current node.\r\n     * @returns The color style of the node.\r\n     */\r\n    getNodeColors(): ColorStyle {\r\n        const node: NodeSvg = this.node as NodeSvg;\r\n        const colors: ColorStyle = node.colors ?? {\r\n            primary: '#000',\r\n            secondary: '#000',\r\n            tertirary: '#000',\r\n            category: ''\r\n        };\r\n        return colors;\r\n    }\r\n    // CONNECTOR BUBBLE HANDLING + CONNECTION RESOLVING -\r\n    /**\r\n     * Fill every node's connector bubble data with the corresponding bubble its connected to on a sibling node.\r\n     */\r\n    fillAllNodeConnectorBubbles() {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { originConn } = connPair;\r\n                if (!originConn) continue;\r\n\r\n                // Only try to fill missing sides with real circles from other pending connections\r\n                if (!connPair.fromCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.from && p.originCircle);\r\n                    if (match) connPair.fromCircle = match.originCircle;\r\n                }\r\n\r\n                if (!connPair.toCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.to && p.originCircle);\r\n                    if (match) connPair.toCircle = match.originCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Resolves the connectable to the appropriate connection based on the originating connection.\r\n     * @param connectable - The connectable entity (NodeSvg or Field).\r\n     * @param fromConn - The originating connection.\r\n     * @returns \r\n     */\r\n    resolveConnectable(connectable: Connectable, fromConn: Connection): Connection | null | undefined {\r\n        if (!connectable || !fromConn) return undefined;\r\n\r\n        // If the connection is an input (previous), return the connectable's output (next) connection\r\n        if (fromConn.isPrevious) {\r\n\r\n            if (connectable instanceof NodeSvg) return connectable.nextConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n\r\n        // If the connection is an output (next), return the connectable's input (previous) connection\r\n        if (!fromConn.isPrevious) {\r\n            if (connectable instanceof NodeSvg) return connectable.previousConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n    }\r\n    /**\r\n     * Fills in the connector circle for other nodes based on the given connection.\r\n     * @param conn - The connection to match.\r\n     * @param circle - The SVG path of the connector circle.\r\n     * @param isPrevious - Whether the connection is a previous connection.\r\n     */\r\n    _fillOtherNodeConnectorCircle(conn: Connection, circle: SvgPath, isPrevious: boolean) {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                // Only fill if the connection actually matches\r\n                if (isPrevious) {\r\n                    // fill toCircle if this connPair expects 'conn' as its 'to'\r\n                    if (connPair.to === conn && !connPair.toCircle) {\r\n                        connPair.toCircle = circle;\r\n                    }\r\n                } else {\r\n                    // fill fromCircle if this connPair expects 'conn' as its 'from'\r\n                    if (connPair.from === conn && !connPair.fromCircle) {\r\n                        connPair.fromCircle = circle;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // LINE DRAWING -\r\n    /**\r\n     * Draw the connection lines between node's connector bubbles.\r\n     */\r\n    drawLinesForAllNodes() {\r\n        const c = this.constants;\r\n        const wsSvg = this._ws.svg;\r\n\r\n        this.fillAllNodeConnectorBubbles();\r\n        const drawnCircles = new Set<SvgPath>();\r\n\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { fromCircle, toCircle } = connPair;\r\n                if (connPair.from !== connPair.originConn) continue;\r\n                if (!fromCircle || !toCircle) continue;\r\n\r\n                if (drawnCircles.has(fromCircle) || drawnCircles.has(toCircle)) continue;\r\n\r\n                drawnCircles.add(fromCircle);\r\n                drawnCircles.add(toCircle);\r\n\r\n                const fromEl = fromCircle.node as SVGPathElement;\r\n                const toEl = toCircle.node as SVGPathElement;\r\n\r\n                const fromBBox = fromEl.getBBox();\r\n                const toBBox = toEl.getBBox();\r\n\r\n                const fromCTM = fromEl.getScreenCTM()!;\r\n                const toCTM = toEl.getScreenCTM()!;\r\n\r\n                const startX = fromBBox.x + fromBBox.width / 2;\r\n                const startY = fromBBox.y + fromBBox.height / 2;\r\n                const endX = toBBox.x + toBBox.width / 2;\r\n                const endY = toBBox.y + toBBox.height / 2;\r\n\r\n                const absStartX = startX * fromCTM.a + startY * fromCTM.c + fromCTM.e;\r\n                const absStartY = startX * fromCTM.b + startY * fromCTM.d + fromCTM.f;\r\n                const absEndX = endX * toCTM.a + endY * toCTM.c + toCTM.e;\r\n                const absEndY = endX * toCTM.b + endY * toCTM.d + toCTM.f;\r\n\r\n                // STRAIGHT LINE ONLY\r\n                const pathStr = `M ${absStartX} ${absStartY} L ${absEndX} ${absEndY}`;\r\n\r\n                const zoom = this._ws.getZoom();\r\n                const strokeWidth = c.CONNECTOR_LINE_WIDTH * zoom;\r\n                const line = wsSvg.path(pathStr)\r\n                    .stroke({ color: parseColor(fromCircle.fill() as Color), width: strokeWidth })\r\n                    .fill('none')\r\n                    .attr({ class: (this.constructor as typeof Renderer).CONN_LINE_TAG });\r\n\r\n                eventer.addElement(line, 'k_connline', {\r\n                    fromConn: connPair.from,\r\n                    toConn: connPair.to,\r\n                    renderer: this\r\n                }).tagElement(line, [(this.constructor as typeof Renderer).ELEMENT_TAG, (this.constructor as typeof Renderer).LINE_X_MARK_TAG]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear connection lines and their X marks.\r\n     */\r\n    clearLines() {\r\n        for (let line of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).CONN_LINE_TAG}`)) {\r\n            line.remove();\r\n        }\r\n        for (let mark of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).LINE_X_MARK_TAG}`)) {\r\n            mark.remove();\r\n        }\r\n    }\r\n    /**\r\n     * Clear the entire screen.\r\n     */\r\n    clearScreen() {\r\n        // Destroy elements that were tagged (eventer system)\r\n        eventer.destroyByTag((this.constructor as typeof Renderer).ELEMENT_TAG);\r\n\r\n        // Remove all SVG children **except the background pattern rect**\r\n        this._ws.svg.children().forEach((el) => {\r\n            const isBackground = el.hasClass((this.constructor as typeof Renderer).BACKGROUND_PATTERN);\r\n            const isDefs = el.node.tagName == 'defs';\r\n            const isBgRect = el.classes().includes(WorkspaceSvg.BACKGROUND_CLASS);\r\n            if (!isBackground && !isDefs && !isBgRect) el.remove();\r\n        });\r\n\r\n        // Reset internal draw state\r\n        this._drawStates = [];\r\n    }\r\n    /**\r\n     * Remove pending connections for a specific connection\r\n     * @param conn - The connection\r\n     */\r\n    undoPendingConnsFor(conn: ConnectorToFrom) {\r\n        for (let state of this._drawStates) {\r\n            for (let conn0 of state.pendingConnections) {\r\n                if (conn0.toCircle == conn.originCircle) {\r\n                    delete conn0.toCircle;\r\n                }\r\n                if (conn0.fromCircle == conn.originCircle) {\r\n                    delete conn0.fromCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Called whenever a node must be visually rendered or rerendered.\r\n     * Implementations must be idempotent.\r\n     * @param node - The node to render/rerender\r\n     * @returns SVG group of the node.\r\n     */\r\n    rerenderNode(node: NodeSvg) {\r\n        // wipe old drawstate + events for this node\r\n        const idx = this._drawStates.findIndex(s => s.id === node.id);\r\n        if (idx !== -1) {\r\n            const state = this._drawStates[idx];\r\n            for (let pendingConn of state!.pendingConnections) {\r\n                this.undoPendingConnsFor(pendingConn);\r\n            }\r\n            state!.group?.remove();\r\n            eventer.destroyByTag(`node_${node.id}`);\r\n            this._drawStates.splice(idx, 1);\r\n        }\r\n\r\n        // rebuild node\r\n        this.startNode(node);\r\n        this.drawNode();\r\n        this.representer.build(this.node as NodeSvg, this, this.state as DrawState);\r\n        this.storeState();\r\n\r\n        // refresh *all* lines once the node is back in place\r\n        this.refreshNodeTransforms();\r\n        return (node.svg as RepresenterNode).getRaw();\r\n    }\r\n\r\n}\r\n\r\nexport default Renderer;\r\n","'use strict';\n\n\nvar paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0 };\n\nvar SPECIAL_SPACES = [\n  0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006,\n  0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF\n];\n\nfunction isSpace(ch) {\n  return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029) || // Line terminators\n    // White spaces\n    (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n    (ch >= 0x1680 && SPECIAL_SPACES.indexOf(ch) >= 0);\n}\n\nfunction isCommand(code) {\n  /*eslint-disable no-bitwise*/\n  switch (code | 0x20) {\n    case 0x6D/* m */:\n    case 0x7A/* z */:\n    case 0x6C/* l */:\n    case 0x68/* h */:\n    case 0x76/* v */:\n    case 0x63/* c */:\n    case 0x73/* s */:\n    case 0x71/* q */:\n    case 0x74/* t */:\n    case 0x61/* a */:\n    case 0x72/* r */:\n      return true;\n  }\n  return false;\n}\n\nfunction isArc(code) {\n  return (code | 0x20) === 0x61;\n}\n\nfunction isDigit(code) {\n  return (code >= 48 && code <= 57);   // 0..9\n}\n\nfunction isDigitStart(code) {\n  return (code >= 48 && code <= 57) || /* 0..9 */\n          code === 0x2B || /* + */\n          code === 0x2D || /* - */\n          code === 0x2E;   /* . */\n}\n\n\nfunction State(path) {\n  this.index  = 0;\n  this.path   = path;\n  this.max    = path.length;\n  this.result = [];\n  this.param  = 0.0;\n  this.err    = '';\n  this.segmentStart = 0;\n  this.data   = [];\n}\n\nfunction skipSpaces(state) {\n  while (state.index < state.max && isSpace(state.path.charCodeAt(state.index))) {\n    state.index++;\n  }\n}\n\n\nfunction scanFlag(state) {\n  var ch = state.path.charCodeAt(state.index);\n\n  if (ch === 0x30/* 0 */) {\n    state.param = 0;\n    state.index++;\n    return;\n  }\n\n  if (ch === 0x31/* 1 */) {\n    state.param = 1;\n    state.index++;\n    return;\n  }\n\n  state.err = 'SvgPath: arc flag can be 0 or 1 only (at pos ' + state.index + ')';\n}\n\n\nfunction scanParam(state) {\n  var start = state.index,\n      index = start,\n      max = state.max,\n      zeroFirst = false,\n      hasCeiling = false,\n      hasDecimal = false,\n      hasDot = false,\n      ch;\n\n  if (index >= max) {\n    state.err = 'SvgPath: missed param (at pos ' + index + ')';\n    return;\n  }\n  ch = state.path.charCodeAt(index);\n\n  if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n    index++;\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  // This logic is shamelessly borrowed from Esprima\n  // https://github.com/ariya/esprimas\n  //\n  if (!isDigit(ch) && ch !== 0x2E/* . */) {\n    state.err = 'SvgPath: param should start with 0..9 or `.` (at pos ' + index + ')';\n    return;\n  }\n\n  if (ch !== 0x2E/* . */) {\n    zeroFirst = (ch === 0x30/* 0 */);\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n\n    if (zeroFirst && index < max) {\n      // decimal number starts with '0' such as '09' is illegal.\n      if (ch && isDigit(ch)) {\n        state.err = 'SvgPath: numbers started with `0` such as `09` are illegal (at pos ' + start + ')';\n        return;\n      }\n    }\n\n    while (index < max && isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasCeiling = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x2E/* . */) {\n    hasDot = true;\n    index++;\n    while (isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasDecimal = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x65/* e */ || ch === 0x45/* E */) {\n    if (hasDot && !hasCeiling && !hasDecimal) {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n    if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n      index++;\n    }\n    if (index < max && isDigit(state.path.charCodeAt(index))) {\n      while (index < max && isDigit(state.path.charCodeAt(index))) {\n        index++;\n      }\n    } else {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n  }\n\n  state.index = index;\n  state.param = parseFloat(state.path.slice(start, index)) + 0.0;\n}\n\n\nfunction finalizeSegment(state) {\n  var cmd, cmdLC;\n\n  // Process duplicated commands (without comand name)\n\n  // This logic is shamelessly borrowed from Raphael\n  // https://github.com/DmitryBaranovskiy/raphael/\n  //\n  cmd   = state.path[state.segmentStart];\n  cmdLC = cmd.toLowerCase();\n\n  var params = state.data;\n\n  if (cmdLC === 'm' && params.length > 2) {\n    state.result.push([ cmd, params[0], params[1] ]);\n    params = params.slice(2);\n    cmdLC = 'l';\n    cmd = (cmd === 'm') ? 'l' : 'L';\n  }\n\n  if (cmdLC === 'r') {\n    state.result.push([ cmd ].concat(params));\n  } else {\n\n    while (params.length >= paramCounts[cmdLC]) {\n      state.result.push([ cmd ].concat(params.splice(0, paramCounts[cmdLC])));\n      if (!paramCounts[cmdLC]) {\n        break;\n      }\n    }\n  }\n}\n\n\nfunction scanSegment(state) {\n  var max = state.max,\n      cmdCode, is_arc, comma_found, need_params, i;\n\n  state.segmentStart = state.index;\n  cmdCode = state.path.charCodeAt(state.index);\n  is_arc = isArc(cmdCode);\n\n  if (!isCommand(cmdCode)) {\n    state.err = 'SvgPath: bad command ' + state.path[state.index] + ' (at pos ' + state.index + ')';\n    return;\n  }\n\n  need_params = paramCounts[state.path[state.index].toLowerCase()];\n\n  state.index++;\n  skipSpaces(state);\n\n  state.data = [];\n\n  if (!need_params) {\n    // Z\n    finalizeSegment(state);\n    return;\n  }\n\n  comma_found = false;\n\n  for (;;) {\n    for (i = need_params; i > 0; i--) {\n      if (is_arc && (i === 3 || i === 4)) scanFlag(state);\n      else scanParam(state);\n\n      if (state.err.length) {\n        finalizeSegment(state);\n        return;\n      }\n      state.data.push(state.param);\n\n      skipSpaces(state);\n      comma_found = false;\n\n      if (state.index < max && state.path.charCodeAt(state.index) === 0x2C/* , */) {\n        state.index++;\n        skipSpaces(state);\n        comma_found = true;\n      }\n    }\n\n    // after ',' param is mandatory\n    if (comma_found) {\n      continue;\n    }\n\n    if (state.index >= state.max) {\n      break;\n    }\n\n    // Stop on next segment\n    if (!isDigitStart(state.path.charCodeAt(state.index))) {\n      break;\n    }\n  }\n\n  finalizeSegment(state);\n}\n\n\n/* Returns array of segments:\n *\n * [\n *   [ command, coord1, coord2, ... ]\n * ]\n */\nmodule.exports = function pathParse(svgPath) {\n  var state = new State(svgPath);\n  var max = state.max;\n\n  skipSpaces(state);\n\n  while (state.index < max && !state.err.length) {\n    scanSegment(state);\n  }\n\n  if (state.result.length) {\n    if ('mM'.indexOf(state.result[0][0]) < 0) {\n      state.err = 'SvgPath: string should start with `M` or `m`';\n      state.result = [];\n    } else {\n      state.result[0][0] = 'M';\n    }\n  }\n\n  return {\n    err: state.err,\n    segments: state.result\n  };\n};\n","import KabelWSTheme from './default';\r\nimport KabelDarkTheme from './dark';\r\n\r\nconst Themes = {\r\n    Classic: KabelWSTheme,\r\n    Dark: KabelDarkTheme\r\n}\r\n\r\nexport default Themes;","/**\r\n * Converts HTML-escaped characters in a string back to their literal form.\r\n *\r\n * Specifically, it replaces:\r\n * - `&lt;` with `<`\r\n * - `&gt;` with `>`\r\n * - `&quot;` with `\"`\r\n * - `&apos;` with `'`\r\n * - `&amp;` with `&`\r\n *\r\n * @param {string} s - The string containing HTML-escaped characters.\r\n * @returns {string} The unescaped string with HTML entities replaced by their literal characters.\r\n */\r\nfunction unescapeAttr(s: string): string {\r\n\treturn s.replace(/&lt;/g, \"<\")\r\n\t\t\t.replace(/&gt;/g, \">\")\r\n\t\t\t.replace(/&quot;/g, '\"')\r\n\t\t\t.replace(/&apos;/g, \"'\")\r\n\t\t\t.replace(/&amp;/g, \"&\");\r\n}\r\n\r\nexport default unescapeAttr;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport Workspace from \"./workspace\";\r\n\r\nexport interface WidgetOptions {\r\n    /**\r\n     * Widget class to instantiate for the widget, by default it uses Kabel's\r\n     */\r\n    cls?: typeof Widget;\r\n    /**\r\n     * Coordinates to spawn the widget at.\r\n     */\r\n    coords?: Coordinates;      // where to position the widget\r\n    /**\r\n     * Width of the widget\r\n     */\r\n    width?: number;            // optional width\r\n    /**\r\n     * Height of the widget.\r\n     */\r\n    height?: number;           // optional height\r\n    /**\r\n     * Class to give the widget's html container.\r\n     */\r\n    className?: string;        // optional CSS class\r\n    /**\r\n     * Widget inner HTML default content.\r\n     */\r\n    html?: string;             // inner HTML\r\n    /**\r\n     * Widget name\r\n     */\r\n    name: string;\r\n    /**\r\n     * Sets up a new widget of this type\r\n     * @param this - This context of the function points to widget.\r\n     * @param widget - The widget this function is called on.\r\n     * @param html - The html container of the widget.\r\n     * @returns - Void.\r\n     */\r\n    init?: (this: WidgetOptions, widget: Widget, html: HTMLElement) => void;\r\n}\r\nclass Widget {\r\n    workspace: WorkspaceSvg|Workspace;\r\n    container: HTMLDivElement;\r\n    coords: Coordinates;\r\n    width: number;\r\n    height: number;\r\n    visible: boolean;\r\n    name: string;\r\n    id: string;\r\n    options: WidgetOptions;\r\n    static WIDGET_GLOBAL_ID = 0;\r\n    constructor(workspace: WorkspaceSvg|Workspace, options: WidgetOptions = { name: `Untitled(${Widget.WIDGET_GLOBAL_ID++})` }) {\r\n        this.workspace = workspace;\r\n        this.coords = options.coords ?? new Coordinates(0, 0);\r\n        this.width = options.width ?? 200;\r\n        this.height = options.height ?? 100;\r\n        this.visible = false;\r\n        this.name = options.name;\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        this.options = options;\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n\r\n        if (options.html) this.container.innerHTML = options.html;\r\n\r\n        if (!this.workspace.isHeadless) (this.workspace as WorkspaceSvg)._wsTop.appendChild(this.container);\r\n        this.hide();\r\n        if (typeof options.init !== 'undefined' && options.init) {\r\n            options.init(this, this.container);\r\n        }\r\n    }\r\n\r\n    // Show the widget\r\n    show() {\r\n        this.container.style.display = \"block\";\r\n        this.visible = true;\r\n    }\r\n\r\n    // Hide the widget\r\n    hide() {\r\n        this.container.style.display = \"none\";\r\n        this.visible = false;\r\n    }\r\n\r\n    // Move the widget to new coords\r\n    setCoords(coords: Coordinates) {\r\n        this.coords = coords;\r\n        this.container.style.left = `${coords.x}px`;\r\n        this.container.style.top = `${coords.y}px`;\r\n    }\r\n\r\n    // Update the HTML content\r\n    setHTML(html: string) {\r\n        this.container.innerHTML = html;\r\n    }\r\n    // Bring widget back from the dead after a .destroy call\r\n    reanimate() {\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = this.options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n        \r\n        if (this.options.html) this.container.innerHTML = this.options.html;\r\n        if (this.workspace.isHeadless) return;\r\n\r\n        (this.workspace as WorkspaceSvg)._wsTop.appendChild(this.container);\r\n        this.workspace._addWidgetToDB(this);\r\n    }\r\n    // Destroy widget & cleanup.\r\n    destroy() {\r\n        this.container.remove();\r\n        this.workspace._delWidgetFromDB(this);\r\n    }\r\n}\r\n\r\nexport default Widget;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\n\r\ninterface HistoryEntry {\r\n\tstate: any; // serialized workspace or diff\r\n}\r\n\r\nexport default class UndoRedoHistory {\r\n\tprivate ws: WorkspaceSvg;\r\n\tprivate undoStack: HistoryEntry[] = [];\r\n\tprivate redoStack: HistoryEntry[] = [];\r\n\tprivate isRecording: boolean = true;\r\n\r\n\tconstructor(ws: WorkspaceSvg) {\r\n\t\tthis.ws = ws;\r\n\t}\r\n\r\n\temitChange() {\r\n\t\tif (!this.isRecording) return;\r\n\t\tif (!this.ws.recordHistory) return;\r\n\r\n\t\tconst state = this.ws.toJson ? this.ws.toJson(true) : {};\r\n\t\tthis.undoStack.push({ state });\r\n\t\tthis.redoStack.length = 0;\r\n\r\n\t\t//console.log(\"[emitChange] pushed state. undoStack size:\", this.undoStack.length, \"redoStack cleared\");\r\n\t}\r\n\r\n\tundo() {\r\n\t\t//console.log(\"[undo] called. undoStack size:\", this.undoStack.length, \"redoStack size:\", this.redoStack.length);\r\n\r\n\t\tif (this.undoStack.length <= 1) {\r\n\t\t\t//console.log(\"[undo] nothing to undo.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst current = this.undoStack.pop();\r\n\t\t//console.log(\"[undo] popped current state:\", current);\r\n\r\n\t\tconst prev = this.undoStack[this.undoStack.length - 1];\r\n\t\t//console.log(\"[undo] previous state to restore:\", prev);\r\n\r\n\t\tif (!prev) {\r\n\t\t\t//console.log(\"[undo] no previous state found.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isRecording = false;\r\n\t\tthis.ws.fromJson?.(prev.state);\r\n\t\tthis.isRecording = true;\r\n\r\n\t\tthis.redoStack.push(current as HistoryEntry);\r\n\t\t//console.log(\"[undo] state restored. undoStack size now:\", this.undoStack.length, \"redoStack size now:\", this.redoStack.length);\r\n\t}\r\n\r\n\tredo() {\r\n\t\t//console.log(\"[redo] called. undoStack size:\", this.undoStack.length, \"redoStack size:\", this.redoStack.length);\r\n\r\n\t\tconst entry = this.redoStack.pop();\r\n\t\tif (!entry) {\r\n\t\t\t//console.log(\"[redo] nothing to redo.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//console.log(\"[redo] popping state from redoStack:\", entry);\r\n\r\n\t\tthis.isRecording = false;\r\n\t\tthis.ws.fromJson?.(entry.state);\r\n\t\tthis.isRecording = true;\r\n\r\n\t\tthis.undoStack.push(entry);\r\n\t\t//console.log(\"[redo] state restored. undoStack size now:\", this.undoStack.length, \"redoStack size now:\", this.redoStack.length);\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.undoStack = [];\r\n\t\tthis.redoStack = [];\r\n\t\t//console.log(\"[clear] undo and redo stacks cleared\");\r\n\t}\r\n\r\n\tcanUndo() {\r\n\t\treturn this.undoStack.length > 1;\r\n\t}\r\n\r\n\tcanRedo() {\r\n\t\treturn this.redoStack.length > 0;\r\n\t}\r\n}\r\n","import { InjectMsg } from \"./inject\";\r\nimport { setMainWorkspace } from \"./main-workspace\";\r\nimport Workspace from \"./workspace\";\r\n\r\n\r\n\r\n\r\nfunction injectHeadless() : Workspace | undefined {\r\n    try {\r\n        const ws = new Workspace();\r\n        setMainWorkspace(ws);\r\n        return ws;\r\n    } catch (e) {\r\n        new InjectMsg(`Failed to initialize workspace: ${(e as Error).message}`).err();\r\n    }\r\n}\r\n\r\nexport default injectHeadless;","'use strict';\n\n/* eslint-disable space-infix-ops */\n\n// The precision used to consider an ellipse as a circle\n//\nvar epsilon = 0.0000000001;\n\n// To convert degree in radians\n//\nvar torad = Math.PI / 180;\n\n// Class constructor :\n//  an ellipse centred at 0 with radii rx,ry and x - axis - angle ax.\n//\nfunction Ellipse(rx, ry, ax) {\n  if (!(this instanceof Ellipse)) { return new Ellipse(rx, ry, ax); }\n  this.rx = rx;\n  this.ry = ry;\n  this.ax = ax;\n}\n\n// Apply a linear transform m to the ellipse\n// m is an array representing a matrix :\n//    -         -\n//   | m[0] m[2] |\n//   | m[1] m[3] |\n//    -         -\n//\nEllipse.prototype.transform = function (m) {\n  // We consider the current ellipse as image of the unit circle\n  // by first scale(rx,ry) and then rotate(ax) ...\n  // So we apply ma =  m x rotate(ax) x scale(rx,ry) to the unit circle.\n  var c = Math.cos(this.ax * torad), s = Math.sin(this.ax * torad);\n  var ma = [\n    this.rx * (m[0]*c + m[2]*s),\n    this.rx * (m[1]*c + m[3]*s),\n    this.ry * (-m[0]*s + m[2]*c),\n    this.ry * (-m[1]*s + m[3]*c)\n  ];\n\n  // ma * transpose(ma) = [ J L ]\n  //                      [ L K ]\n  // L is calculated later (if the image is not a circle)\n  var J = ma[0]*ma[0] + ma[2]*ma[2],\n      K = ma[1]*ma[1] + ma[3]*ma[3];\n\n  // the discriminant of the characteristic polynomial of ma * transpose(ma)\n  var D = ((ma[0]-ma[3])*(ma[0]-ma[3]) + (ma[2]+ma[1])*(ma[2]+ma[1])) *\n          ((ma[0]+ma[3])*(ma[0]+ma[3]) + (ma[2]-ma[1])*(ma[2]-ma[1]));\n\n  // the \"mean eigenvalue\"\n  var JK = (J + K) / 2;\n\n  // check if the image is (almost) a circle\n  if (D < epsilon * JK) {\n    // if it is\n    this.rx = this.ry = Math.sqrt(JK);\n    this.ax = 0;\n    return this;\n  }\n\n  // if it is not a circle\n  var L = ma[0]*ma[1] + ma[2]*ma[3];\n\n  D = Math.sqrt(D);\n\n  // {l1,l2} = the two eigen values of ma * transpose(ma)\n  var l1 = JK + D/2,\n      l2 = JK - D/2;\n  // the x - axis - rotation angle is the argument of the l1 - eigenvector\n  /*eslint-disable indent*/\n  this.ax = (Math.abs(L) < epsilon && Math.abs(l1 - K) < epsilon) ?\n    90\n  :\n    Math.atan(Math.abs(L) > Math.abs(l1 - K) ?\n      (l1 - J) / L\n    :\n      L / (l1 - K)\n    ) * 180 / Math.PI;\n  /*eslint-enable indent*/\n\n  // if ax > 0 => rx = sqrt(l1), ry = sqrt(l2), else exchange axes and ax += 90\n  if (this.ax >= 0) {\n    // if ax in [0,90]\n    this.rx = Math.sqrt(l1);\n    this.ry = Math.sqrt(l2);\n  } else {\n    // if ax in ]-90,0[ => exchange axes\n    this.ax += 90;\n    this.rx = Math.sqrt(l2);\n    this.ry = Math.sqrt(l1);\n  }\n\n  return this;\n};\n\n// Check if the ellipse is (almost) degenerate, i.e. rx = 0 or ry = 0\n//\nEllipse.prototype.isDegenerate = function () {\n  return (this.rx < epsilon * this.ry || this.ry < epsilon * this.rx);\n};\n\nmodule.exports = Ellipse;\n","import Coordinates from \"./coordinates\";\r\n\r\n\r\n\r\n/**\r\n * A class that represents Workspace Camera Coords.\r\n * May be used in the future, right now its a no-op Coords wrapper.\r\n */\r\nclass WorkspaceCoords extends Coordinates {\r\n    constructor(x = 0, y = 0) {\r\n        super(x, y);\r\n    }\r\n}\r\nexport default WorkspaceCoords;","import Coordinates from \"./coordinates\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { Svg, SVG, Pattern, Rect } from '@svgdotjs/svg.js';\r\nimport Renderer from '../renderers/renderer';\r\nimport { InjectOptions } from \"./inject\";\r\nimport WorkspaceCoords from \"./workspace-coords\";\r\nimport WorkspaceController from '../controllers/base';\r\nimport WASDController from '../controllers/wasd';\r\nimport { RMap } from \"./renderer-map\";\r\nimport Toolbox from \"./toolbox\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport newHeadlessNode from \"./headless-node\";\r\nimport Widget from \"./widget\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport ContextMenuHTML from \"./context-menu\";\r\nimport CommentModel from \"./comment\";\r\nimport Field, { ConnectableField } from \"./field\";\r\nimport waitFrames from \"../util/wait-anim-frames\";\r\nimport { addWindowListener } from \"../util/window-listeners\";\r\nimport Grid from \"./grid\";\r\nimport UndoRedoHistory from \"./undo-redo\";\r\nimport hasProp from \"../util/has-prop\";\r\nimport Workspace from \"./workspace\";\r\nimport Themes from '../themes/themes';\r\nimport { Color } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\n\r\nexport interface IDragState {\r\n    isDragging: boolean;\r\n    startX: number;\r\n    startY: number;\r\n    lastX: number;\r\n    lastY: number;\r\n    deltaX: number;\r\n    deltaY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    node: NodeSvg | null;\r\n}\r\n\r\nfunction resolveController(options: InjectOptions): typeof WorkspaceController {\r\n    if (options?.controls) {\r\n        if (options?.controls.wasd) {\r\n            return WASDController;\r\n        }\r\n    }\r\n    return WorkspaceController;\r\n}\r\n\r\nexport interface WSTheme {\r\n    UIStyles?: {\r\n        workspaceBGColor?: Color;\r\n        toolboxCategoriesBG?: Partial<CSSStyleDeclaration>;\r\n        toolboxFlyoutBG?: Partial<CSSStyleDeclaration>;\r\n    }\r\n}\r\ntype ThemeKeys = keyof typeof Themes; // \"Classic\" | \"Dark\"\r\n/** \r\n * Represents the visual workspace containing nodes and connections.\r\n * Handles rendering, panning, and coordinate transformations.\r\n */\r\nclass WorkspaceSvg extends Workspace {\r\n    static get BACKGROUND_CLASS() {\r\n        return 'WorkspaceBackgroundRect';\r\n    }\r\n    /**\r\n     * Theme of the workspace\r\n     */\r\n    theme!: WSTheme;\r\n    /**\r\n     * Workspace background pattern items.\r\n     */\r\n    grid?: Grid;\r\n    /** Top-left offset of the workspace viewport */\r\n    _camera: WorkspaceCoords;\r\n\r\n    /** Node storage by unique ID */\r\n    _nodeDB: Map<string, NodeSvg>;\r\n\r\n    /** Root HTML container for the workspace */\r\n    _root: HTMLElement;\r\n\r\n    /** Top-level wrapper for the SVG */\r\n    _wsTop: HTMLElement;\r\n\r\n    /** SVG.js instance for rendering */\r\n    svg: Svg;\r\n    /** The background element */\r\n    _backgroundRect!: Rect;\r\n    /** Renderer instance for drawing nodes and connections */\r\n    renderer: Renderer;\r\n\r\n    /** Options for workspace behavior and rendering overrides */\r\n    options: InjectOptions;\r\n\r\n    /** Flag to temporarily prevent redraws */\r\n    noRedraw: boolean;\r\n    /**\r\n     * A class instance that moves the camera based on user interactions.\r\n     */\r\n    controller: WorkspaceController;\r\n    /**\r\n     * Toolbox for the workspace.\r\n     */\r\n    toolbox?: Toolbox;\r\n    /**\r\n     * A list of widgets active in this workspace\r\n     */\r\n    _widgetDB: Map<string, Widget>\r\n\r\n    /**\r\n     * A manager for the context menu widget\r\n     */\r\n    _ctxMenu: ContextMenuHTML\r\n    /**\r\n     * A list of comments for this workspace.\r\n     */\r\n    _commentDB: Set<CommentModel>;\r\n    /**\r\n     * Undo/redo history\r\n     */\r\n    history: UndoRedoHistory;\r\n    /**\r\n     * Whether to record undo/redo history or not\r\n     */\r\n    recordHistory: boolean = true;\r\n    /**\r\n     * Stack of old recordHistory values for toggleHistory\r\n     */\r\n    recordHistoryRecord: boolean[];\r\n    /**\r\n     * Internal flag to indicate if the camera has moved this frame.\r\n     */\r\n    _didMove: boolean = false;\r\n    /**\r\n     * Listeners to call when the workspace moves.\r\n     */\r\n    moveListeners: (() => void)[];\r\n    /** Current drag state for node dragging */\r\n    dragState: IDragState | null = null;\r\n    /**\r\n     * Creates a new WorkspaceSvg instance.\r\n     * @param root - The root HTML element containing the workspace.\r\n     * @param wsTop - The top-level wrapper element for the SVG.\r\n     * @param options - Configuration and renderer override options.\r\n     */\r\n    constructor(root: HTMLElement, wsTop: HTMLElement, options: InjectOptions) {\r\n        super();\r\n        this.isHeadless = false;\r\n        wsTop.style.width = '100%';\r\n        wsTop.style.height = '100%';\r\n\r\n        this._root = root;\r\n        this._wsTop = wsTop;\r\n        this.svg = SVG().addTo(this._wsTop).size('100%', '100%');\r\n        this.options = options;\r\n        let RClass: typeof Renderer = RMap.resolve(options.renderer);\r\n        this.renderer = new RClass(this, this.options.rendererOverrides || {});\r\n\r\n        const themeKey = (typeof options.theme === 'string' && options.theme in Themes)\r\n            ? options.theme as ThemeKeys\r\n            : 'Classic';\r\n\r\n        const theme = (typeof options.theme === 'object' && options.theme)\r\n            ? options.theme\r\n            : Themes[themeKey];\r\n\r\n        if (this.options.toolbox) {\r\n            this.toolbox = new Toolbox(this);\r\n        }\r\n\r\n        this._camera = new WorkspaceCoords(0, 0);\r\n        this._nodeDB = new Map();\r\n        this.noRedraw = false;\r\n        this.controller = new (options.Controller ?? resolveController(options))(this);\r\n        this._widgetDB = new Map();\r\n        this._ctxMenu = new ContextMenuHTML(this);\r\n        this._commentDB = new Set();\r\n        this.history = new UndoRedoHistory(this);\r\n        this.recordHistoryRecord = [];\r\n        this.moveListeners = [];\r\n        if (options.initUndoRedo !== false) {\r\n            this.history.emitChange();\r\n        }\r\n        this.theme = {}; //placeholder\r\n        this._initBackground();\r\n\r\n        this.setTheme(theme); // set theme to user-defined theme.\r\n    }\r\n    setTheme(theme: WSTheme) {\r\n        try {\r\n            this.theme = structuredClone(theme);\r\n        } catch {\r\n            this.theme = Object.assign({}, theme);\r\n        }\r\n        // Clone theme so you can mutate ws.theme seperate from Kabels.Themes[ThemeName]\r\n        if (this.toolbox) this.toolbox.updateStyles(this.theme);\r\n        if (this.theme.UIStyles) {\r\n            this._backgroundRect.fill(parseColor(this.theme.UIStyles.workspaceBGColor || '#fffffff'))\r\n        }\r\n    }\r\n    /**\r\n     * Getter and setter for whether we moved or not this frame.\r\n     */\r\n    get didMove() { return this._didMove; }\r\n    set didMove(value: boolean) {\r\n        this._didMove = value;\r\n        if (value) {\r\n            waitFrames(1, () => { this._didMove = false; });\r\n        }\r\n    }\r\n    /**\r\n     * Sets the drag state of the workspace.\r\n     * @param params - Drag state parameters.\r\n     * @returns Void.\r\n     */\r\n    setDragState(params: {\r\n        node: NodeSvg | null;\r\n        startX: number;\r\n        startY: number;\r\n        currentX: number;\r\n        currentY: number;\r\n        offsetX?: number;\r\n        offsetY?: number;\r\n    }) {\r\n        if (!params.node) {\r\n            this.dragState = null;\r\n            return;\r\n        }\r\n\r\n        const {\r\n            node,\r\n            startX,\r\n            startY,\r\n            currentX,\r\n            currentY,\r\n            offsetX = 0,\r\n            offsetY = 0\r\n        } = params;\r\n\r\n        this.dragState = {\r\n            isDragging: true,\r\n            node,\r\n            startX,\r\n            startY,\r\n            offsetX,\r\n            offsetY,\r\n            lastX: currentX,\r\n            lastY: currentY,\r\n            deltaX: currentX - startX,\r\n            deltaY: currentY - startY\r\n        };\r\n    }\r\n    beginDrag(node: NodeSvg, startX: number, startY: number, offsetX: number = 0, offsetY: number = 0) {\r\n        this.dragState = {\r\n            isDragging: true,\r\n            node,\r\n            startX,\r\n            startY,\r\n            offsetX,\r\n            offsetY,\r\n            lastX: startX,\r\n            lastY: startY,\r\n            deltaX: 0,\r\n            deltaY: 0\r\n        };\r\n    }\r\n    /**\r\n     * Updates the current drag position.\r\n     * @param currentX - Current X position.\r\n     * @param currentY - Current Y position.\r\n     * @returns Void.\r\n     */\r\n    updateDrag(currentX: number, currentY: number) {\r\n        if (!this.dragState || !this.dragState.node) return;\r\n\r\n        this.dragState.lastX = currentX;\r\n        this.dragState.lastY = currentY;\r\n        this.dragState.deltaX = currentX - this.dragState.startX;\r\n        this.dragState.deltaY = currentY - this.dragState.startY;\r\n    }\r\n    endDrag() {\r\n        // Set drag state.isDragging to false instead of clearing.\r\n        if (this.dragState) this.dragState.isDragging = false;\r\n    }\r\n\r\n\r\n    /**\r\n     * Fires all move listeners registered to this workspace.\r\n     */\r\n    fireMoveListeners() {\r\n        this.moveListeners.forEach(e => e());\r\n    }\r\n    /**\r\n     * Adds a move listener to the workspace.\r\n     * @param listener - The listener function to add.\r\n     * @returns A function to remove the added listener.\r\n     */\r\n    addMoveListener(listener: () => void): () => void {\r\n        this.moveListeners.push(listener);\r\n        return () => {\r\n            this.removeMoveListener(listener);\r\n        }\r\n    }\r\n    /**\r\n     * Removes a move listener from the workspace.\r\n     * @param listener - The listener function to remove.\r\n     */\r\n    removeMoveListener(listener: () => void) {\r\n        this.moveListeners = this.moveListeners.filter(e => e != listener);\r\n    }\r\n    /**\r\n     * Emits a change event for the workspace, triggering\r\n     * undo/redo history tracking.\r\n     */\r\n    emitChange() {\r\n        this.history.emitChange();\r\n    }\r\n\r\n    /**\r\n     * Temporarily sets the workspace's history recording state.\r\n     * Pushes the previous state onto a stack for later restoration.\r\n     * \r\n     * @param {boolean} value - Whether history recording should be enabled.\r\n     */\r\n    toggleHistory(value: boolean) {\r\n        this.recordHistoryRecord.push(this.recordHistory);\r\n        this.recordHistory = value;\r\n    }\r\n\r\n    /**\r\n     * Restores the previous history recording state from the stack.\r\n     * Use after a temporary toggle to revert to the previous state.\r\n     */\r\n    untoggleHistory() {\r\n        if (this.recordHistoryRecord.length == 0 || this.recordHistoryRecord.length < 0) return;\r\n        this.recordHistory = this.recordHistoryRecord.pop() as boolean;\r\n    }\r\n\r\n    /**\r\n     * Sets the background grid up based on user selected options.\r\n     */\r\n    _initBackground() {\r\n        try {\r\n            this._backgroundRect = this.svg.rect(this.svg.width(), this.svg.height())\r\n                .fill(parseColor(this.theme.UIStyles?.workspaceBGColor || '#ffffff'))\r\n                .addClass(WorkspaceSvg.BACKGROUND_CLASS)\r\n                .addTo(this.svg);\r\n\r\n            // ensure it has a parent\r\n            this.svg.add(this._backgroundRect);\r\n\r\n            // now you can safely move it to the back\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n        if (this.options.grid) {\r\n            this.grid = new Grid(this, this.svg, this.options.grid);\r\n        }\r\n        this._backgroundRect?.back();\r\n    }\r\n    /**\r\n     * Updates the transform of the background grid\r\n     */\r\n    _updateBackgroundTransform() {\r\n        this.grid?.updateTransform?.();\r\n        try {\r\n            this._backgroundRect.back();\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current zoom factor of the workspace.\r\n     * @returns - The zoom factor\r\n     */\r\n    getZoom() {\r\n        return this.controller.getZoom();\r\n    }\r\n    /**\r\n     * Refresh comments.\r\n     */\r\n    refreshComments() {\r\n        this.renderer.refreshComments();\r\n    }\r\n    /**\r\n     * Get all comments\r\n     * @returns {CommentModel[]}\r\n     */\r\n    getComments() {\r\n        return Array.from(this._commentDB);\r\n    }\r\n    /**\r\n     * Duplicate node data from one to another\r\n     * @param nodeSvg - The node\r\n     */\r\n    cloneNode(nodeSvg: NodeSvg) {\r\n        const n = new NodeSvg(nodeSvg.prototype, this);\r\n        n.init();\r\n        n.fromNode(nodeSvg);\r\n        this.redraw();\r\n    }\r\n    /**\r\n     * Internal: Add widget to DB\r\n     * @param wdgt - The widget\r\n     */\r\n    _addWidgetToDB(wdgt: Widget) {\r\n        this._widgetDB.set(wdgt.id, wdgt);\r\n    }\r\n    /**\r\n     * Internal: Delete a widget from DB.\r\n     * @param wdgt - Widget to delete\r\n     */\r\n    _delWidgetFromDB(wdgt: Widget) {\r\n        this._widgetDB.delete(wdgt.id);\r\n    }\r\n    /**\r\n     * Create a new widget of type.\r\n     * @param type - The prototype\r\n     * @returns {Widget|void}\r\n     */\r\n    newWidget(type: string): void | Widget {\r\n        const opts = WidgetPrototypes[type];\r\n        if (!opts) return;\r\n        if (opts.cls) {\r\n            const wdgt = new (opts.cls)(this, opts);\r\n            this._addWidgetToDB(wdgt);\r\n            return wdgt;\r\n        }\r\n        const wdgt = new Widget(this, opts);\r\n        this._addWidgetToDB(wdgt);\r\n        return wdgt;\r\n    }\r\n    /**\r\n     * Get a widget\r\n     * @param id - Identifier\r\n     * @returns {Widget|undefined} - A widget\r\n     */\r\n    getWidget(id: string): Widget | undefined {\r\n        if (this._widgetDB.has(id)) return this._widgetDB.get(id);\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace's svg content size in pixels.\r\n     * Useful for camera positioning.\r\n     */\r\n    getContentSize(): { width: number; height: number } {\r\n        const bbox = this.svg.bbox();\r\n        return { width: bbox.width, height: bbox.height };\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace in pixels.\r\n     * Useful for camera centering, zoom calculations, and viewport sizing.\r\n     */\r\n    getSize(): { width: number; height: number } {\r\n        const rect = this._wsTop.getBoundingClientRect();\r\n        return { width: rect.width, height: rect.height };\r\n    }\r\n\r\n    /**\r\n     * Updates all connection lines & node screen positions without a full redraw.\r\n     * Used when nodes are dragged or the camera moves.\r\n     */\r\n    refresh() {\r\n        this.renderer.refreshNodeTransforms();\r\n        this._updateBackgroundTransform();\r\n    }\r\n\r\n    /** Draws all nodes in the workspace. Very heavy. */\r\n    drawAllNodes() {\r\n        for (let [nodeId, _] of this._nodeDB) {\r\n            this.drawNode(nodeId);\r\n        }\r\n    }\r\n\r\n    /** Redraws the entire workspace unless noRedraw is set. */\r\n    redraw() {\r\n        if (this.noRedraw) return;\r\n        this.renderer.clearScreen();\r\n        this.drawAllNodes();\r\n        this.refresh();\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n\r\n    /**\r\n     * Converts workspace coordinates to screen (SVG) coordinates.\r\n     * @param x - X position in workspace coordinates.\r\n     * @param y - Y position in workspace coordinates.\r\n     * @returns Screen coordinates as a Coordinates instance.\r\n     */\r\n    workspaceToScreen(workX: number, workY: number) {\r\n        const zoom = this.getZoom();\r\n        // _camera represents the top-left of the visible viewport in workspace coords\r\n        const x = (workX - this._camera.x) * zoom;\r\n        const y = (workY - this._camera.y) * zoom;\r\n        return { x, y };\r\n    }\r\n\r\n    /**\r\n     * Converts screen (SVG) coordinates to workspace coordinates.\r\n     * @param x - X position in screen coordinates.\r\n     * @param y - Y position in screen coordinates.\r\n     * @returns Workspace coordinates as a Coordinates instance.\r\n     */\r\n    screenToWorkspace(screenX: number, screenY: number) {\r\n        const zoom = this.getZoom();\r\n        const workX = screenX / zoom + this._camera.x;\r\n        const workY = screenY / zoom + this._camera.y;\r\n        return { x: workX, y: workY };\r\n    }\r\n\r\n    /**\r\n     * Draws a node by its ID.\r\n     * @param id - The ID of the node to render.\r\n     * @returns The rendered node.\r\n     */\r\n    drawNode(id: string) {\r\n        return this.renderer.rerenderNode(this._nodeDB.get(id) as NodeSvg);\r\n    }\r\n\r\n    /**\r\n     * Adds a node to the workspace.\r\n     * @param node - The node instance to add.\r\n     * @param nodeId - Optional custom ID to use instead of node.id.\r\n     */\r\n    addNode(node: NodeSvg, nodeId?: string) {\r\n        let id = nodeId || node.id;\r\n        if (this._nodeDB.has(id)) {\r\n            console.warn(`Node with id ${id} already exists, overwriting.`);\r\n        }\r\n        if (node.workspace !== this) {\r\n            node.workspace = this;\r\n        }\r\n        this._nodeDB.set(id, node);\r\n        this.drawNode(id);\r\n        this.history.emitChange();\r\n\r\n    }\r\n\r\n    /**\r\n     * Create a new node of *type*.\r\n     * @param type - The node's prototype name.\r\n     */\r\n    newNode(type: keyof typeof NodePrototypes, add: boolean = true): NodeSvg | undefined {\r\n        if (!NodePrototypes[type]) return;\r\n        const node = newHeadlessNode(type as string);\r\n        if (!node) return;\r\n        if (add) this.addNode(node);\r\n        return node;\r\n    }\r\n    /**\r\n     * Spawns a node at x, y of prototype type\r\n     * @param type - The node prototype name\r\n     * @param x - X position\r\n     * @param y - Y position\r\n     * @returns {Node} - The new node\r\n     */\r\n    spawnAt(type: keyof typeof NodePrototypes, x: number, y: number): NodeSvg | undefined {\r\n        const node = this.newNode(type, false);\r\n        if (!node) return;\r\n        node.relativeCoords.set(x, y);\r\n        this.addNode(node);\r\n        this.drawNode(node.id);\r\n        return node;\r\n    }\r\n    /**\r\n     * Dereference a node from all of its connected neighbors\r\n     */\r\n    derefNode(node: NodeSvg) {\r\n        // Disconnect from previous node or field\r\n        const prev = node.previousConnection?.getFrom?.();\r\n        if (prev instanceof NodeSvg) {\r\n            prev.nextConnection?.disconnectTo();\r\n        } else if (prev instanceof ConnectableField && prev.hasConnectable()) {\r\n            prev.disconnect();\r\n        }\r\n\r\n        // Disconnect from next node\r\n        const next = node.nextConnection?.getTo?.();\r\n        if (next instanceof NodeSvg) {\r\n            next.previousConnection?.disconnectFrom();\r\n        }\r\n\r\n        // Disconnect all fields\r\n        for (let field of node.allFields()) {\r\n            if ((field as ConnectableField).hasConnectable?.()) {\r\n                (field as ConnectableField).disconnect();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Removes a node by its ID.\r\n     * @param id - The ID of the node to remove.\r\n     */\r\n    removeNodeById(id: string) {\r\n        const node = this._nodeDB.get(id);\r\n        if (!node) return;\r\n\r\n        this.derefNode(node);\r\n        this._nodeDB.delete(id);\r\n        this.redraw();\r\n        this.history.emitChange();\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * Removes a node by its instance.\r\n     * @param node - The node instance to remove.\r\n     */\r\n    removeNode(node: NodeSvg) {\r\n        if (!node) return;\r\n        this.removeNodeById(node.id);\r\n    }\r\n\r\n    /**\r\n     * Retrieves a node by its ID.\r\n     * @param id - The ID of the node.\r\n     * @returns The NodeSvg instance or undefined if not found.\r\n     */\r\n    getNode(id: string | NodeSvg): NodeSvg | undefined {\r\n        if (id instanceof NodeSvg) return id;\r\n        return this._nodeDB.get(id);\r\n    }\r\n\r\n    /**\r\n     * Pans the camera by the given delta values.\r\n     * @param dx - Change in X direction.\r\n     * @param dy - Change in Y direction.\r\n     */\r\n    pan(dx: number, dy: number) {\r\n        this.controller.pan(dx, dy);\r\n    }\r\n    /**\r\n     * Comment methods\r\n     */\r\n\r\n    /**\r\n     * Adds a comment, returns the model.\r\n     */\r\n    addComment() {\r\n        const model = new CommentModel(this);\r\n        this._commentDB.add(model);\r\n        this.redrawComments();\r\n        return model;\r\n    }\r\n    /**\r\n     * Gets a comment by id\r\n     * @param id - The comment id.\r\n     */\r\n    getComment(id: string) {\r\n        return Array.from(this._commentDB).find(e => e.id === id);\r\n    }\r\n    /**\r\n     * Remove a comment by its instance or id.\r\n     * @param commentOrId - The comment instance or its id.\r\n     */\r\n    removeComment(commentOrId: CommentModel | string) {\r\n        let comment: CommentModel | undefined;\r\n\r\n        if (typeof commentOrId === \"string\") {\r\n            comment = this.getComment(commentOrId);\r\n        } else {\r\n            comment = commentOrId;\r\n        }\r\n\r\n        if (!comment) return false;\r\n\r\n        this._commentDB.delete(comment);\r\n        this.redrawComments();\r\n        return true;\r\n    }\r\n    /**\r\n     * Redraw all comments in this workspace.\r\n     */\r\n    redrawComments() {\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n    /**\r\n     * Deserialize this workspace from json data.\r\n     * @param json - Serialized workspace\r\n     */\r\n    fromJson(json: { nodes: any[]; circular: boolean }, recordBigEvent: boolean = false) {\r\n        this.toggleHistory(false); // disable recording\r\n\r\n        for (let [_, node] of this._nodeDB.entries()) {\r\n            this.removeNode(node);\r\n        }\r\n        if (json.circular) {\r\n            for (let node of json.nodes) {\r\n                NodeSvg.deserialize(node, this);\r\n            }\r\n        } else {\r\n            for (let node of json.nodes) {\r\n                NodeSvg.fromJson(node, this);\r\n            }\r\n        }\r\n\r\n        this.untoggleHistory(); // restore previous history state\r\n\r\n        // only emit a single snapshot if we were told to treat it as a user-level event\r\n        if (recordBigEvent && this.recordHistory) {\r\n            this.history.emitChange();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Serialize this workspace, optionally using circular references.\r\n     */\r\n    toJson(circular: boolean) {\r\n        const nodes = [];\r\n        if (circular) {\r\n            for (let [id, node] of this._nodeDB) {\r\n                if (node.topLevel) {\r\n                    nodes.push(node.serialize());\r\n                }\r\n            }\r\n        } else {\r\n            for (let [id, node] of this._nodeDB) {\r\n                if (node.topLevel) {\r\n                    nodes.push(node.toJson());\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            circular,\r\n            nodes\r\n        }\r\n    }\r\n}\r\n\r\nexport default WorkspaceSvg;\r\n","// color-utils.ts\r\nimport type { Color, Hex } from '../src/visual-types';\r\n\r\n/**\r\n * Parse any Color type into a hex string \"#RRGGBB\"\r\n */\r\nexport function parseColor(color: Color): Hex {\r\n\tif (typeof color === 'string') {\r\n\t\tif (color.startsWith('#')) {\r\n\t\t\t// Already a hex string, normalize to full #RRGGBB\r\n\t\t\tlet hex = color.slice(1);\r\n\t\t\tif (hex.length === 3) hex = hex.split('').map(c => c + c).join('');\r\n\t\t\treturn `#${hex}`;\r\n\t\t} else {\r\n\t\t\t// RGB string \"r, g, b\"\r\n\t\t\tconst parts = color.split(',').map(s => parseInt(s.trim(), 10));\r\n\t\t\tif (parts.length !== 3) throw new Error(`Invalid RGB string: ${color}`);\r\n\t\t\tconst [r, g, b] = parts;\r\n            if ((!r && r!== 0) || (!g && g!== 0) || (!b && b !== 0)) {\r\n                console.warn(\r\n                    \"Invalid RGB tuple\"\r\n                );\r\n                return \"#000\";\r\n            }\r\n\t\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t\t.toString(16)\r\n\t\t\t\t.padStart(2, '0')}`;\r\n\t\t}\r\n\t} else if (Array.isArray(color)) {\r\n\t\t// RGBTuple [r,g,b]\r\n\t\tconst [r, g, b] = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t} else {\r\n\t\t// RGBObject {r,g,b}\r\n\t\tconst { r, g, b } = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t}\r\n}\r\n","// path.ts\r\n/**\r\n * Utility functions to generate SVG path strings or translate them.\r\n */\r\n\r\n/** Rounded rectangle */\r\nexport function roundedRect(width: number, height: number, radius: number): string {\r\n\tradius = Math.min(radius, width / 2, height / 2);\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tH${width - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width},${radius}\r\n\t\tV${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius},${height}\r\n\t\tH${radius}\r\n\t\tA${radius},${radius} 0 0 1 0,${height - radius}\r\n\t\tV${radius}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Rounded triangle pointing up */\r\nexport function roundedTri(width: number, height: number, radius: number): string {\r\n\tconst halfW = width / 2;\r\n\tradius = Math.min(radius, halfW, height / 2);\r\n\treturn `\r\n\t\tM${halfW},0\r\n\t\tL${width - radius},${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius*2},${height}\r\n\t\tL${radius*2},${height}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},${height - radius}\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Circle */\r\nexport function circle(radius: number): string {\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${-radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Ellipse */\r\nexport function ellipse(rx: number, ry: number): string {\r\n\treturn `\r\n\t\tM${rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${-rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${rx},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Star with n points */\r\nexport function star(radius: number, points: number = 5): string {\r\n\tif (points < 2) throw new Error('Star must have at least 2 points');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / (points * 2);\r\n\tfor (let i = 0; i < points * 2; i++) {\r\n\t\tconst r = i % 2 === 0 ? radius : radius / 2;\r\n\t\tconst x = r * Math.sin(i * step);\r\n\t\tconst y = -r * Math.cos(i * step);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\n\r\n/** Regular polygon (triangle, pentagon, hexagon, etc) */\r\nexport function polygon(radius: number, sides: number = 3): string {\r\n\tif (sides < 3) throw new Error('Polygon must have at least 3 sides');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / sides;\r\n\tfor (let i = 0; i < sides; i++) {\r\n\t\tconst x = radius * Math.cos(i * step - Math.PI / 2);\r\n\t\tconst y = radius * Math.sin(i * step - Math.PI / 2);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\nimport SvgPath from 'svgpath';\r\n\r\n/**\r\n * Rotate an SVG path string around a given point\r\n * @param path - SVG path string\r\n * @param angle - rotation angle in degrees\r\n * @param cx - x-coordinate of rotation center (default 0)\r\n * @param cy - y-coordinate of rotation center (default 0)\r\n * @returns new rotated SVG path string\r\n */\r\nexport function rotatePath(path: string, angle: number, cx = 0, cy = 0): string {\r\n\treturn new SvgPath(path)\r\n\t\t.rotate(angle, cx, cy)\r\n\t\t.toString();\r\n}\r\n","'use strict';\n\n\nvar Matrix = require('./matrix');\n\nvar operations = {\n  matrix: true,\n  scale: true,\n  rotate: true,\n  translate: true,\n  skewX: true,\n  skewY: true\n};\n\nvar CMD_SPLIT_RE    = /\\s*(matrix|translate|scale|rotate|skewX|skewY)\\s*\\(\\s*(.+?)\\s*\\)[\\s,]*/;\nvar PARAMS_SPLIT_RE = /[\\s,]+/;\n\n\nmodule.exports = function transformParse(transformString) {\n  var matrix = new Matrix();\n  var cmd, params;\n\n  // Split value into ['', 'translate', '10 50', '', 'scale', '2', '', 'rotate',  '-45', '']\n  transformString.split(CMD_SPLIT_RE).forEach(function (item) {\n\n    // Skip empty elements\n    if (!item.length) { return; }\n\n    // remember operation\n    if (typeof operations[item] !== 'undefined') {\n      cmd = item;\n      return;\n    }\n\n    // extract params & att operation to matrix\n    params = item.split(PARAMS_SPLIT_RE).map(function (i) {\n      return +i || 0;\n    });\n\n    // If params count is not correct - ignore command\n    switch (cmd) {\n      case 'matrix':\n        if (params.length === 6) {\n          matrix.matrix(params);\n        }\n        return;\n\n      case 'scale':\n        if (params.length === 1) {\n          matrix.scale(params[0], params[0]);\n        } else if (params.length === 2) {\n          matrix.scale(params[0], params[1]);\n        }\n        return;\n\n      case 'rotate':\n        if (params.length === 1) {\n          matrix.rotate(params[0], 0, 0);\n        } else if (params.length === 3) {\n          matrix.rotate(params[0], params[1], params[2]);\n        }\n        return;\n\n      case 'translate':\n        if (params.length === 1) {\n          matrix.translate(params[0], 0);\n        } else if (params.length === 2) {\n          matrix.translate(params[0], params[1]);\n        }\n        return;\n\n      case 'skewX':\n        if (params.length === 1) {\n          matrix.skewX(params[0]);\n        }\n        return;\n\n      case 'skewY':\n        if (params.length === 1) {\n          matrix.skewY(params[0]);\n        }\n        return;\n    }\n  });\n\n  return matrix;\n};\n","import WorkspaceController from './base';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WASDController extends WorkspaceController {\r\n    moveSpeed: number;\r\n    doAccelerate?: boolean;\r\n    accelSpeed: number;\r\n    friction: number;\r\n    velocity: Vec2;\r\n    zoom: number = 1;\r\n    zoomSpeed: number;\r\n    minZoom: number;\r\n    maxZoom: number;\r\n    isFalloff: boolean;\r\n    constructor(workspace: WorkspaceSvg, moveSpeed?: number) {\r\n        super(workspace);\r\n        this.moveSpeed = workspace.options.moveSpeed || moveSpeed || 5;\r\n\r\n        this.doAccelerate = workspace.options?.controls?.wasdSmooth ?? false;\r\n        this.accelSpeed = workspace.options?.controls?.wasdAccelerate ?? 0.2;\r\n        this.friction = workspace.options?.controls?.wasdFriction ?? 0.85;\r\n\r\n        this.velocity = { x: 0, y: 0 };\r\n        this.isFalloff = false;\r\n\r\n        // Zoom settings\r\n        this.zoomSpeed = workspace.options?.controls?.zoomSpeed ?? 0.1;\r\n        this.minZoom = workspace.options?.controls?.minZoom ?? 0.1;\r\n        this.maxZoom = workspace.options?.controls?.maxZoom ?? 4;\r\n        this.zoom = 1;\r\n        // Bind wheel for zoom\r\n        workspace._wsTop.addEventListener('wheel', this.onWheel.bind(this), { passive: false });\r\n    }\r\n\r\n    canMove() {\r\n        return !userState.hasState('typing');\r\n    }\r\n\r\n    update() {\r\n        super.update();\r\n        if (!this.canMove()) return;\r\n\r\n        let inputX = 0;\r\n        let inputY = 0;\r\n\r\n        if (this.keysDown.has('w') || this.keysDown.has('ArrowUp')) inputY -= 1;\r\n        if (this.keysDown.has('s') || this.keysDown.has('ArrowDown')) inputY += 1;\r\n        if (this.keysDown.has('a') || this.keysDown.has('ArrowLeft')) inputX -= 1;\r\n        if (this.keysDown.has('d') || this.keysDown.has('ArrowRight')) inputX += 1;\r\n\r\n        if (this.doAccelerate) {\r\n            // Accelerate velocity towards input direction\r\n            this.velocity.x += inputX * this.accelSpeed;\r\n            this.velocity.y += inputY * this.accelSpeed;\r\n\r\n            // Apply friction\r\n            this.velocity.x *= this.friction;\r\n            this.velocity.y *= this.friction;\r\n            if (inputX == 0 && inputY == 0) {\r\n                this.isFalloff = true;\r\n            } else {\r\n                this.isFalloff = false;\r\n            }\r\n            // Only pan if velocity is noticeable\r\n            if (Math.abs(this.velocity.x) > 0.01 || Math.abs(this.velocity.y) > 0.01) {\r\n                this.pan(this.velocity.x, this.velocity.y);\r\n            }\r\n        } else {\r\n            // Instant movement\r\n            const dx = inputX * this.moveSpeed;\r\n            const dy = inputY * this.moveSpeed;\r\n            if (dx !== 0 || dy !== 0) this.pan(dx, dy);\r\n        }\r\n    }\r\n    pan(dx: number, dy: number) {\r\n        const x = this.workspace._camera.x, y = this.workspace._camera.y;\r\n        this.workspace._camera.x += dx;\r\n        this.workspace._camera.y += dy;\r\n        if (x == this.workspace._camera.x && y == this.workspace._camera.y) {\r\n            return;\r\n        }\r\n        if (!this.isFalloff) {\r\n            this._throttledFireDidMove();\r\n            this.workspace.didMove = true;\r\n            this.workspace.fireMoveListeners();\r\n            this.refreshPos();\r\n        }\r\n        this.refreshPos();\r\n    }\r\n    /**\r\n     * Handles wheel events for zooming.\r\n     * Zooms around the mouse position for intuitive zooming.\r\n     */\r\n    onWheel(e: WheelEvent) {\r\n        e.preventDefault();\r\n\r\n        const oldZoom = this.getZoom();\r\n        let delta = -e.deltaY * this.zoomSpeed * 0.01; // normalize wheel\r\n        let newZoom = oldZoom * (1 + delta);\r\n\r\n        // Clamp zoom\r\n        newZoom = Math.max(this.minZoom, Math.min(this.maxZoom, newZoom));\r\n\r\n        // Zoom around cursor\r\n        const mouseX = e.clientX;\r\n        const mouseY = e.clientY;\r\n\r\n        const wsMouse = this.workspace.screenToWorkspace(mouseX, mouseY);\r\n\r\n        // Apply new zoom\r\n        this.setZoom(newZoom);\r\n\r\n        // Adjust camera so the point under cursor stays stable\r\n        this.workspace._camera.x = wsMouse.x - mouseX / newZoom;\r\n        this.workspace._camera.y = wsMouse.y - mouseY / newZoom;\r\n\r\n        this.workspace.refresh();\r\n    }\r\n\r\n    /** Returns current zoom level */\r\n    getZoom() {\r\n        return this.zoom;\r\n    }\r\n\r\n    /** Sets zoom directly */\r\n    setZoom(zoom: number) {\r\n        this.zoom = zoom;\r\n    }\r\n}\r\n","\r\n\r\n// fonts-manager.ts\r\n\r\nconst loadedFonts: Record<string, Promise<void>> = {};\r\n\r\n/**\r\n * Load a Google Font by name and optional weights.\r\n * Returns a promise that resolves when the font is available.\r\n */\r\nexport function loadGoogleFont(\r\n\tname: string,\r\n\tweights: number[] = [400, 700]\r\n): Promise<void> {\r\n\tif (loadedFonts[name]) return loadedFonts[name]; // already loading/loaded\r\n\r\n\tconst linkId = `gf-${name.replace(/\\s+/g, '-')}`;\r\n\tif (!document.getElementById(linkId)) {\r\n\t\tconst link = document.createElement('link');\r\n\t\tlink.id = linkId;\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tconst weightsParam = weights.join(';');\r\n\t\tlink.href = `https://fonts.googleapis.com/css2?family=${name.replace(\r\n\t\t\t/\\s+/g,\r\n\t\t\t'+'\r\n\t\t)}:wght@${weightsParam}&display=swap`;\r\n\t\tdocument.head.appendChild(link);\r\n\t}\r\n\r\n\t// wait for all requested weights to be loaded\r\n\tconst fontPromises = weights.map((w) =>\r\n\t\tdocument.fonts.load(`${w} 1em ${name}`)\r\n\t);\r\n\r\n\tconst promise = Promise.all(fontPromises).then(() => undefined);\r\n\tloadedFonts[name] = promise;\r\n\treturn promise;\r\n}\r\n","import { Element, Svg } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport Renderer, { ConnectorToFrom, DrawState } from '../renderers/renderer';\r\n\r\n\r\n\r\nfunction initConnectionLine(element: Element, args: Record<string, any>): () => void {\r\n    // click destroys the line\r\n    const handleClick = () => {\r\n        args.fromConn.disconnectTo();\r\n        args.toConn.disconnectFrom();\r\n        element.remove();\r\n        xMark.remove();\r\n        const remove: ConnectorToFrom[] = [];\r\n        for (let state of args.renderer._drawStates as DrawState[]) {\r\n            for (let pair of state.pendingConnections) {\r\n                if (pair.from == args.fromConn && pair.to == args.toConn) {\r\n                    remove.push(pair);\r\n                }\r\n                if (pair.from = args.toConn && pair.to == args.fromConn) {\r\n                    remove.push(pair);\r\n                }\r\n            }\r\n            state.pendingConnections = state.pendingConnections.filter(e => !remove.includes(e));\r\n        }\r\n    };\r\n\r\n    // create X element\r\n    const bbox = element.bbox();\r\n    const midX = bbox.x + bbox.width / 2;\r\n    const midY = bbox.y + bbox.height / 2;\r\n    const xMark = (element.parent()! as Svg).text('X').font({\r\n        family: 'Fredoka, sans-serif',\r\n        size: 46,\r\n        weight: '700',\r\n        anchor: 'middle',\r\n        leading: '1em'\r\n    })\r\n        .addClass((args.renderer.constructor as typeof Renderer).LINE_X_MARK_TAG)\r\n        .center(midX, midY)\r\n        .fill('#fff')           // white fill\r\n        .stroke({ color: '#000', width: 2 })  // black outline\r\n        .hide();\r\n\r\n    xMark.on('click', handleClick)\r\n    xMark.node.style.userSelect = 'none';\r\n    // show X on hover\r\n    element.on('mouseover', () => xMark.show());\r\n    element.on('mouseout', () => xMark.hide());\r\n\r\n    // attach click event\r\n    element.on('click', handleClick);\r\n\r\n    // cleanup function\r\n    return () => {\r\n        element.off('click', handleClick);\r\n        element.off('mouseover');\r\n        element.off('mouseout');\r\n        xMark.off('click', handleClick);\r\n        xMark.remove();\r\n    };\r\n}\r\n// ok\r\neventer.registerEvent('k_connline', initConnectionLine as EventSetupFn);\r\n","import Connection, { Connectable } from \"./connection\";\r\nimport { G, Path, Rect, Svg, SVG, Text } from '@svgdotjs/svg.js';\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { ConnectorToFrom } from \"../renderers/renderer\";\r\nimport dropdownContainer, { DropdownOptions } from \"./dropdown-menu\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n/**\r\n * Options used to initialize a Field.\r\n */\r\nexport interface FieldOptions {    /** Name of the field */\r\n    name: string;\r\n    /** Human-readable label for the field */\r\n    label: string;\r\n    /** Key used to identify the field type in FieldTypesMap */\r\n    type: string;\r\n    /** Field value (optional) */\r\n    value?: any;\r\n    /** Only used by OptConnectField to determine internal value type */\r\n    fld_type?: \"number\" | \"string\";\r\n    [key: string]: any;\r\n};\r\n\r\nexport interface FieldVisualInfo {\r\n    measuredWidth: number; // The width approximated by the field itself.\r\n    measuredHeight: number; // The height approximated by the field itself.\r\n    background: Rect; // The node's background element.\r\n    svg: Svg; // The workspace's SVG.js svg\r\n    nodeGroup: G; // Group for the node\r\n    fieldGroup: G; // A group containing the label & input.\r\n    xUsed: number; // The amount of x space used up by the label.\r\n}\r\nexport interface FieldRawBoxData {\r\n    box: Rect;\r\n    txt: Text;\r\n}\r\nexport interface FieldConnectionData {\r\n    connector: Path;\r\n    connState: ConnectorToFrom\r\n}\r\n/**\r\n * Base class for all fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nclass Field<T = any> {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n    protected value: T | null;\r\n    static register(name: string, cls: Function) { };\r\n    static unregister(name: string) { };\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.value = null;\r\n        this.editable = true;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n        if (json.value !== undefined) this.value = json.value;\r\n        if (json.editable) this.setEditable(Boolean(json.editable));\r\n    }\r\n\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: null, height: null }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /** @returns The stored value */\r\n    getValue(): T | null {\r\n        return this.value;\r\n    }\r\n\r\n    /**\r\n     * Set the stored value\r\n     * @param val New value\r\n     */\r\n    setValue(val: T) {\r\n        this.value = val;\r\n    }\r\n\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue(): T | null {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Used when you want just a label with no actual value. Any value related methods are no-op.\r\n */\r\nexport class DummyField {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.editable = false;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n    }\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: 0, height: 0 }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /**\r\n     * Dummy fields have no value.\r\n     * @returns {null}\r\n     */\r\n    getValue() {\r\n        return null;\r\n    }\r\n    /**\r\n     * No-op for dummy fields\r\n     */\r\n    setValue(_: any) { }\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue() {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Base class for fields that can be connected to other fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nexport class ConnectableField<T = any> extends Field<T> {\r\n    connection: Connection;\r\n\r\n    constructor() {\r\n        super();\r\n        this.connection = new Connection(this, null);\r\n        this.value = null as T;\r\n    }\r\n    hasConnectable(): boolean {\r\n        return true;\r\n    }\r\n\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** Disconnect this field from any connected Connectable */\r\n    disconnect() {\r\n        const to = this.connection.to;\r\n        if (to instanceof NodeSvg && to?.previousConnection?.from) {\r\n            to.previousConnection.from = null;\r\n            this.connection.to = null;\r\n        }\r\n    }\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        super.fromJson(json);\r\n\r\n        // If the value is a serialized node, rebuild it\r\n        if (json.value && typeof json.value === \"object\" && json.value.id) {\r\n            this.value = NodeSvg._deserialize(json.value, {}, workspace) as any;\r\n            this.connection.setTo(this.value as Connectable);\r\n        } else if (json.value instanceof NodeSvg) {\r\n            this.value = json.value as any;\r\n            this.connection.setTo(this.value as Connectable);\r\n        } else {\r\n            this.value = json.value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: alreadyProcessed[val.id] ? (deep ? alreadyProcessed[val.id] : val.id) : val.serialize(alreadyProcessed) };\r\n\r\n        return {\r\n            ...super.toJson(true, alreadyProcessed),\r\n            value: val\r\n        };\r\n    }\r\n}\r\n\r\n/** Field storing a numeric value */\r\nexport class NumberField extends Field<number> {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        if (json.value !== undefined) this.setValue(Number(json.value));\r\n    }\r\n    setValue(val: number) {\r\n        this.value = Number(val);\r\n    }\r\n}\r\n\r\n/** Field storing a string value */\r\nexport class TextField extends Field<string> {\r\n    constructor() {\r\n        super();\r\n    }\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        if (json.value !== undefined) this.setValue(String(json.value));\r\n    }\r\n    setValue(val: string) {\r\n        this.value = String(val);\r\n    }\r\n}\r\n\r\n/**\r\n * Optional connectable field.\r\n * Can store either a number or string depending on fld_type.\r\n */\r\nexport class OptConnectField extends ConnectableField<number | string | NodeSvg> {\r\n    fldType: \"number\" | \"string\";\r\n\r\n    constructor() {\r\n        super();\r\n        this.fldType = \"string\";\r\n    }\r\n    canEditConnector(): boolean {\r\n        return true;\r\n    }\r\n    canEdit() {\r\n        if (this.getValue() instanceof NodeSvg) {\r\n            return false;\r\n        }\r\n        return this.editable;\r\n    }\r\n    getValue(): string | number | NodeSvg | null {\r\n        if (this.connection && this.connection.getTo()) {\r\n            return this.connection.getTo() as NodeSvg;\r\n        } else {\r\n            return this.value;\r\n        }\r\n    }\r\n    hasRaw() {\r\n        return true;\r\n    }\r\n    hasConnectable() {\r\n        return true;\r\n    }\r\n    /**\r\n     * Set field type.\r\n     * @param type \"number\"|\"string\"\r\n     */\r\n    setFieldType(type: \"number\" | \"string\") {\r\n        this.fldType = type;\r\n    }\r\n    /**\r\n     * Initialize from JSON, respecting fld_type\r\n     * @param json FieldOptions\r\n     */\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        super.fromJson(json, workspace);\r\n        this.fldType = json.fld_type || \"string\";\r\n        if (this.value != null && typeof this.value === this.fldType) {\r\n            this.setValue(this.value as number | string);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set the value, converting to number or string depending on fld_type\r\n     * @param val The new value\r\n     */\r\n    setValue(val: number | string) {\r\n        if (this.fldType === \"number\") this.value = Number(val);\r\n        else this.value = String(val);\r\n    }\r\n\r\n    /**\r\n     * @returns Display value for UI purposes (never null)\r\n     */\r\n    getDisplayValue(): string {\r\n        if (this.value == null) return this.fldType === \"number\" ? \"0\" : \"\";\r\n        if (this.getValue() instanceof NodeSvg) return '[NODE]'; // If theres a connection\r\n        return String(this.value);\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: deep ? val.serialize(alreadyProcessed) : val.id };\r\n\r\n        return {\r\n            ...super.toJson(true, alreadyProcessed),\r\n            fld_type: this.fldType,\r\n            value: val\r\n        };\r\n    }\r\n}\r\nexport type DropdownItem = { text: string, value: string } | string\r\nexport class DropdownField extends Field<string> {\r\n    options: DropdownItem[] | null;\r\n    _selected: DropdownItem | null;\r\n    _isOpen: boolean;\r\n\r\n    constructor() {\r\n        super();\r\n        this.options = null;\r\n        this._selected = null;\r\n        this._isOpen = false;\r\n    }\r\n\r\n    onDraw(rawBox?: FieldRawBoxData) {\r\n        if (!rawBox || !this.options) return;\r\n\r\n        const { box, txt } = rawBox;\r\n        const toggle = () => this.toggleDropdown(rawBox);\r\n        box.click(toggle);\r\n        txt.click(toggle);\r\n    }\r\n\r\n    private toggleDropdown(rawBox: FieldRawBoxData) {\r\n        if (dropdownContainer.getOwner() === this) {\r\n            this.closeDropdown();\r\n        } else {\r\n            this.openDropdown(rawBox);\r\n        }\r\n        rawBox.txt.text(this.getDisplayValue());\r\n    }\r\n\r\n    private openDropdown(rawBox: FieldRawBoxData) {\r\n        if (!this.options) return;\r\n\r\n        const items = this.options.map(option => ({\r\n            label: typeof option === 'string' ? option : option.text,\r\n            value: typeof option === 'string' ? option : option.value\r\n        }));\r\n\r\n        dropdownContainer.show(this, {\r\n            items,\r\n            width: rawBox.box.bbox().width * 2,\r\n            onSelect: (value: string) => {\r\n                if (!this.options) return;\r\n                const original = this.options.find(\r\n                    e => e === value || (typeof e !== 'string' && e.value === value)\r\n                );\r\n                if (original) {\r\n                    this._selected = original;\r\n                    this.setValue(value);\r\n                    this.closeDropdown();\r\n                    this?.node?.workspace?.emitChange?.();\r\n                    this?.node?.workspace?.renderer?.rerenderNode?.(this.node);\r\n                }\r\n            }\r\n        } as DropdownOptions);\r\n    }\r\n\r\n    private closeDropdown() {\r\n        dropdownContainer.hideIfOwner(this);\r\n    }\r\n\r\n    canEdit() {\r\n        return false;\r\n    }\r\n\r\n    getSelected() {\r\n        return this._selected;\r\n    }\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        this.options = json.options as DropdownItem[] || null;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(typeof this._selected === 'string' ? this._selected : this._selected.value);\r\n    }\r\n\r\n    /**\r\n     * Display value of dropdowns.\r\n     * @returns - Display value\r\n     */\r\n    getDisplayValue(): string {\r\n        const text = typeof this._selected === 'string' ? this._selected : this._selected?.text || '';\r\n        const arrow = dropdownContainer.getOwner() == this ? '' : ''; // toggles open/closed\r\n        return text + '  ' + arrow;\r\n    }\r\n\r\n    /**\r\n     * Set options on this dropdown\r\n     * @param options - List of options\r\n     */\r\n    setOptions(options: DropdownItem[]) {\r\n        this.options = options;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(\r\n            typeof this._selected === 'string' ? this._selected : this._selected.value\r\n        );\r\n    }\r\n    /**\r\n     * \r\n     * @param deep - Whether to recursive it.\r\n     * @param alreadyProcessed - Map of already serialized nodes.\r\n     * @returns - Json of this field.\r\n     */\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return { ...super.toJson(deep, alreadyProcessed), options: this.options };\r\n    }\r\n}\r\n\r\n/**\r\n * Any field instance type\r\n */\r\nexport type AnyField = Field | OptConnectField | NumberField | TextField | DummyField | ConnectableField;\r\n/**\r\n * Any field class type\r\n */\r\nexport type AnyFieldCls = typeof Field | typeof OptConnectField | typeof ConnectableField | typeof NumberField | typeof TextField | typeof DummyField;\r\nexport const FieldMap: {\r\n    field_both: typeof OptConnectField;\r\n    field_string: typeof TextField;\r\n    field_num: typeof NumberField;\r\n    field_dummy: typeof DummyField;\r\n    field_str: typeof TextField;\r\n    connection: typeof ConnectableField;\r\n    [key: string]: AnyFieldCls;\r\n} = {\r\n    'field_both': OptConnectField,\r\n    'field_string': TextField,\r\n    'field_num': NumberField,\r\n    'field_dummy': DummyField,\r\n    'field_str': TextField,\r\n    'connection': ConnectableField,\r\n    'dropdown': DropdownField\r\n}\r\n\r\n\r\nexport default Field;\r\n","import type RendererType from \"../renderers/renderer\";\r\nimport Renderer from \"../renderers/renderer\";\r\n/**\r\n * Interface for the renderer map.\r\n * Maps a string key (renderer name) to a renderer class.\r\n */\r\ninterface RendererMapInterface {\r\n    [key: string]: typeof RendererType;\r\n}\r\n\r\n// Top-level renderer map storage\r\nconst RendererMap: RendererMapInterface = {};\r\n\r\n/**\r\n * Class for managing registered renderer classes.\r\n * Provides methods to register, delete, get, list, and resolve renderers.\r\n */\r\nclass RMap {\r\n    /**\r\n     * Registers a renderer class under a given name.\r\n     * @param RendererCls The renderer class to register\r\n     * @param optName Optional name to register under. Defaults to `RendererCls.NAME`\r\n     */\r\n    static register(RendererCls: typeof RendererType, optName?: string) {\r\n        const name = optName ?? RendererCls.NAME;\r\n        RendererMap[name] = RendererCls;\r\n    }\r\n\r\n    /**\r\n     * Deletes a renderer from the map by name.\r\n     * Cannot delete the \"default\" renderer.\r\n     * @param name The name of the renderer to delete\r\n     * @returns `true` if deleted, `false` otherwise\r\n     */\r\n    static delete(name: string) {\r\n        if (name === 'default') return false;\r\n        if (RendererMap[name]) {\r\n            delete RendererMap[name];\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Retrieves a renderer class by name.\r\n     * Returns the default renderer if the name is not found.\r\n     * @param name The name of the renderer to get\r\n     * @returns The renderer class\r\n     */\r\n    static get(name: string): typeof RendererType {\r\n        const Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n        return RendererMap[name] ?? RendererMap['default'] ?? Renderer;\r\n    }\r\n\r\n    /**\r\n     * Lists all registered renderer names.\r\n     * @returns Array of registered renderer names\r\n     */\r\n    static list() {\r\n        return Object.keys(RendererMap);\r\n    }\r\n\r\n    /**\r\n     * Resolves input into a renderer class.\r\n     * - If `input` is undefined, returns the default renderer\r\n     * - If `input` is a string, returns the renderer with that name\r\n     * - If `input` is a class, returns the class itself\r\n     * @param input Optional renderer name or class\r\n     * @returns Renderer class\r\n     */\r\n    static resolve(input?: string | typeof RendererType): typeof RendererType {\r\n        const Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n\r\n        if (!input) return RendererMap['default'] ?? Renderer;\r\n\r\n        if (typeof input === 'string') return RMap.get(input);\r\n\r\n        if (typeof input === 'function') return input as typeof RendererType;\r\n\r\n        return RendererMap['default'] ?? Renderer;\r\n    }\r\n}\r\n\r\n// Default renderers registered in core.ts\r\n\r\nexport { RMap, RendererMap };\r\n","import { Svg, Pattern, Rect } from \"@svgdotjs/svg.js\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport { addWindowListener } from \"../util/window-listeners\";\r\n\r\n/**\r\n * Options for configuring the workspace grid.\r\n * @typedef {Object} GridOptions\r\n * @property {\"dotted\"|\"celled\"} [type=\"dotted\"] - The type of grid to render.\r\n * @property {number} [spacing=40] - The spacing between grid dots or cells.\r\n * @property {number} [dotSize=2] - The radius of the dots (only for dotted type).\r\n * @property {number} [strokeWidth=2] - Stroke width of the cells (only for celled type).\r\n * @property {string} [color=\"#bebebeff\"] - Color of the grid.\r\n */\r\nexport interface GridOptions {\r\n    type?: \"dotted\" | \"celled\";\r\n    spacing?: number;\r\n    dotSize?: number;\r\n    strokeWidth?: number;\r\n    color?: string;\r\n}\r\n\r\n/**\r\n * Handles drawing and managing a workspace background grid.\r\n */\r\nexport default class Grid {\r\n    private ws: WorkspaceSvg;\r\n    private svg: Svg;\r\n    private pattern?: Pattern;\r\n    private rect?: Rect;\r\n\r\n    /** Cached + normalized grid values */\r\n    private grid: Required<GridOptions>;\r\n\r\n    /**\r\n     * Creates a new Grid instance and attaches it to the given workspace SVG.\r\n     * @param {WorkspaceSvg} ws - The workspace this grid belongs to.\r\n     * @param {Svg} svg - The SVG element to draw the grid into.\r\n     * @param {GridOptions} opts - Initial options for the grid.\r\n     */\r\n    constructor(ws: WorkspaceSvg, svg: Svg, opts: GridOptions) {\r\n        this.ws = ws;\r\n        this.svg = svg;\r\n\r\n        this.grid = {\r\n            type: opts.type ?? \"dotted\",\r\n            spacing: opts.spacing ?? 40,\r\n            dotSize: opts.dotSize ?? 2,\r\n            strokeWidth: opts.strokeWidth ?? 2,\r\n            color: opts.color ?? \"#bebebeff\",\r\n        };\r\n\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Initializes the grid pattern, background rect, and attaches resize listener.\r\n     * @private\r\n     */\r\n    private init() {\r\n        if (this.rect) {\r\n            this.rect.remove();\r\n        }\r\n        const { type, spacing, dotSize, strokeWidth, color } = this.grid;\r\n\r\n        let defs = this.svg.findOne(\"defs\");\r\n        if (!defs) defs = this.svg.defs();\r\n\r\n        this.pattern = this.svg.pattern(spacing, spacing, (add) => {\r\n            if (type === \"dotted\") {\r\n                add\r\n                    .circle(dotSize * 2)\r\n                    .fill(color)\r\n                    .move(spacing / 2 - dotSize, spacing / 2 - dotSize);\r\n            } else {\r\n                add.rect(spacing, spacing).stroke({ color, width: strokeWidth }).fill(\"none\");\r\n            }\r\n        });\r\n        this.pattern.attr({ patternUnits: \"userSpaceOnUse\" });\r\n        defs.add(this.pattern);\r\n\r\n        const { width, height } = this.ws.getSize();\r\n        this.rect = this.svg\r\n            .rect(width, height)\r\n            .fill(this.pattern)\r\n            .back()\r\n            .addClass(\"WorkspaceBgPattern\");\r\n\r\n        addWindowListener(\"resize\", () => this.resize());\r\n    }\r\n\r\n    /**\r\n     * Resizes the grid background rect to fit the workspace size.\r\n     */\r\n    resize() {\r\n        if (!this.rect) return;\r\n        const { width, height } = this.ws.getSize();\r\n        this.rect.size(width, height).back();\r\n        this.ws._backgroundRect.back();\r\n    }\r\n\r\n    /**\r\n     * Updates the grid pattern transform according to zoom and camera position.\r\n     * Scales the dots/cells to match zoom and repositions them based on camera.\r\n     */\r\n    updateTransform() {\r\n        if (!this.pattern || !this.rect) return;\r\n        const { type, spacing, dotSize, strokeWidth, color } = this.grid;\r\n\r\n        const zoom = this.ws.getZoom();\r\n        const scaledSpacing = spacing * zoom;\r\n\r\n        this.pattern.attr({ width: scaledSpacing, height: scaledSpacing });\r\n        this.pattern.clear();\r\n\r\n        if (type === \"dotted\") {\r\n            const scaledDot = Math.max(dotSize * zoom, 0.5);\r\n            this.pattern\r\n                .circle(scaledDot * 2)\r\n                .fill(color)\r\n                .move(scaledSpacing / 2 - scaledDot, scaledSpacing / 2 - scaledDot);\r\n        } else {\r\n            this.pattern\r\n                .rect(scaledSpacing, scaledSpacing)\r\n                .stroke({ color, width: strokeWidth * zoom })\r\n                .fill(\"none\");\r\n        }\r\n\r\n        const cam = this.ws._camera;\r\n        this.pattern.attr({\r\n            patternTransform: `translate(${-cam.x * zoom % scaledSpacing}, ${-cam.y * zoom % scaledSpacing})`,\r\n        });\r\n\r\n        this.resize();\r\n        this.ws._backgroundRect.back();\r\n    }\r\n\r\n    /**\r\n     * Updates internal grid options from the workspace configuration.\r\n     */\r\n    updateOptions() {\r\n        const opts = this.ws.options!.grid;\r\n        this.grid = {\r\n            type: opts!.type ?? \"dotted\",\r\n            spacing: opts!.spacing ?? 40,\r\n            dotSize: opts!.dotSize ?? 2,\r\n            strokeWidth: opts!.strokeWidth ?? 2,\r\n            color: opts!.color ?? \"#bebebeff\",\r\n        };\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Dynamically sets new grid options and rebuilds the grid pattern.\r\n     * @param {Partial<GridOptions>} newOpts - New options to apply.\r\n     */\r\n    setOptions(newOpts: Partial<GridOptions>) {\r\n        Object.assign(this.grid, newOpts);\r\n        this.rect?.remove?.();\r\n        this.pattern?.remove?.();\r\n        this.init(); // rebuild\r\n    }\r\n}\r\n","import { Element, G } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer, { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\n\r\nfunction initXButton(element: Element, args: Record<string, any>): () => void {\r\n\tconst xBtnGroup = element as G;\r\n\tconst ws: WorkspaceSvg = args.workspace;\r\n\r\n\t// click handler\r\n\tconst onClick = () => {\r\n\t\tws.removeNode(args.node);\r\n\t};\r\n\r\n\t// attach\r\n\txBtnGroup.on('click', onClick);\r\n\r\n\t// return cleanup function\r\n\treturn () => {\r\n\t\txBtnGroup.off('click', onClick);\r\n\t};\r\n}\r\n\r\n// register as Kabel event\r\neventer.registerEvent('k_closenode', initXButton as EventSetupFn);\r\n","import { Color, ColorStyle } from \"./visual-types\";\r\n\r\n/**\r\n * Stores color styles for node categories.\r\n * \r\n * Each key is a category name, and the value is a ColorStyle object\r\n * containing colors like primary, secondary, and tertiary.\r\n * \r\n * Example:\r\n * ```ts\r\n * CategoryColors[\"logic\"] = {\r\n *   primary: \"#FF0000\",\r\n *   secondary: \"#00FF00\",\r\n *   tertiary: \"#0000FF\"\r\n * };\r\n * ```\r\n */\r\nconst CategoryColors: { [key: string]: ColorStyle } = {};\r\n\r\nexport default CategoryColors;\r\n","'use strict';\n\n// combine 2 matrixes\n// m1, m2 - [a, b, c, d, e, g]\n//\nfunction combine(m1, m2) {\n  return [\n    m1[0] * m2[0] + m1[2] * m2[1],\n    m1[1] * m2[0] + m1[3] * m2[1],\n    m1[0] * m2[2] + m1[2] * m2[3],\n    m1[1] * m2[2] + m1[3] * m2[3],\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\n  ];\n}\n\n\nfunction Matrix() {\n  if (!(this instanceof Matrix)) { return new Matrix(); }\n  this.queue = [];   // list of matrixes to apply\n  this.cache = null; // combined matrix cache\n}\n\n\nMatrix.prototype.matrix = function (m) {\n  if (m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0) {\n    return this;\n  }\n  this.cache = null;\n  this.queue.push(m);\n  return this;\n};\n\n\nMatrix.prototype.translate = function (tx, ty) {\n  if (tx !== 0 || ty !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, 0, 1, tx, ty ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.scale = function (sx, sy) {\n  if (sx !== 1 || sy !== 1) {\n    this.cache = null;\n    this.queue.push([ sx, 0, 0, sy, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.rotate = function (angle, rx, ry) {\n  var rad, cos, sin;\n\n  if (angle !== 0) {\n    this.translate(rx, ry);\n\n    rad = angle * Math.PI / 180;\n    cos = Math.cos(rad);\n    sin = Math.sin(rad);\n\n    this.queue.push([ cos, sin, -sin, cos, 0, 0 ]);\n    this.cache = null;\n\n    this.translate(-rx, -ry);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewX = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, Math.tan(angle * Math.PI / 180), 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewY = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, Math.tan(angle * Math.PI / 180), 0, 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\n// Flatten queue\n//\nMatrix.prototype.toArray = function () {\n  if (this.cache) {\n    return this.cache;\n  }\n\n  if (!this.queue.length) {\n    this.cache = [ 1, 0, 0, 1, 0, 0 ];\n    return this.cache;\n  }\n\n  this.cache = this.queue[0];\n\n  if (this.queue.length === 1) {\n    return this.cache;\n  }\n\n  for (var i = 1; i < this.queue.length; i++) {\n    this.cache = combine(this.cache, this.queue[i]);\n  }\n\n  return this.cache;\n};\n\n\n// Apply list of matrixes to (x,y) point.\n// If `isRelative` set, `translate` component of matrix will be skipped\n//\nMatrix.prototype.calc = function (x, y, isRelative) {\n  var m;\n\n  // Don't change point on empty transforms queue\n  if (!this.queue.length) { return [ x, y ]; }\n\n  // Calculate final matrix, if not exists\n  //\n  // NB. if you deside to apply transforms to point one-by-one,\n  // they should be taken in reverse order\n\n  if (!this.cache) {\n    this.cache = this.toArray();\n  }\n\n  m = this.cache;\n\n  // Apply matrix to point\n  return [\n    x * m[0] + y * m[2] + (isRelative ? 0 : m[4]),\n    x * m[1] + y * m[3] + (isRelative ? 0 : m[5])\n  ];\n};\n\n\nmodule.exports = Matrix;\n","import WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WorkspaceController {\r\n    workspace: WorkspaceSvg;\r\n\r\n    keysDown: Set<string>;\r\n    mouseBtns: Set<number>;\r\n    mousePos: Vec2;\r\n    lastMousePos: Vec2;\r\n    isDragging: boolean;\r\n\r\n    wheelDelta: number;\r\n    movedListeners: (() => void)[];\r\n    _lastMoveFire = 0;\r\n    _moveThrottleMs = 100; // bump this to whatever doesn't lag you\r\n    _queuedMove = false;\r\n    _moveTimeout: any = null;\r\n    _updateInt: any;\r\n\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n\r\n        this.keysDown = new Set();\r\n        this.mouseBtns = new Set();\r\n        this.mousePos = { x: 0, y: 0 };\r\n        this.lastMousePos = { x: 0, y: 0 };\r\n        this.isDragging = false;\r\n        this.wheelDelta = 0;\r\n        this.movedListeners = [];\r\n\r\n        this._setupListeners();\r\n\r\n        this._updateInt = setInterval(() => this.update(), 16);\r\n    }\r\n    addMoveListener(cb: () => void) {\r\n        this.movedListeners.push(cb);\r\n    }\r\n\r\n    removeMoveListener(cb: () => void) {\r\n        const i = this.movedListeners.indexOf(cb);\r\n        if (i !== -1) this.movedListeners.splice(i, 1);\r\n    }\r\n\r\n    fireDidMove() {\r\n        if (typeof queueMicrotask !== 'undefined') {\r\n            queueMicrotask(() => {\r\n                for (let cb of this.movedListeners) {\r\n                    try { cb(); } catch (e) { console.error(e); }\r\n                }\r\n            });\r\n        } else {\r\n            Promise.resolve().then(() => {\r\n                for (let cb of this.movedListeners) {\r\n                    try { cb(); } catch (e) { console.error(e); }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    _throttledFireDidMove() {\r\n        const now = performance.now();\r\n\r\n        // enough time passed  fire instantly\r\n        if (now - this._lastMoveFire >= this._moveThrottleMs) {\r\n            this._lastMoveFire = now;\r\n            this.fireDidMove();\r\n            return;\r\n        }\r\n\r\n        // otherwise queue ONE fire\r\n        if (!this._queuedMove) {\r\n            this._queuedMove = true;\r\n            const wait = this._moveThrottleMs - (now - this._lastMoveFire);\r\n\r\n            this._moveTimeout = setTimeout(() => {\r\n                this._queuedMove = false;\r\n                this._lastMoveFire = performance.now();\r\n                this.fireDidMove();\r\n            }, wait);\r\n        }\r\n    }\r\n    getZoom() {\r\n        return 1;\r\n    }\r\n    canMove() {\r\n        return true;\r\n    }\r\n    private _setupListeners() {\r\n        window.addEventListener('keydown', e => this.keysDown.add(e.key));\r\n        window.addEventListener('keyup', e => this.keysDown.delete(e.key));\r\n\r\n        window.addEventListener('mousedown', e => this.mouseBtns.add(e.button));\r\n        window.addEventListener('mouseup', e => this.mouseBtns.delete(e.button));\r\n\r\n        window.addEventListener('mousemove', e => {\r\n            this.lastMousePos = { ...this.mousePos };\r\n            this.mousePos = { x: e.clientX, y: e.clientY };\r\n        });\r\n\r\n        window.addEventListener('wheel', e => {\r\n            this.wheelDelta = e.deltaY;\r\n        });\r\n\r\n        window.addEventListener('mousedown', e => {\r\n            if (e.button === 0) this.isDragging = true;\r\n        });\r\n        window.addEventListener('mouseup', e => {\r\n            if (e.button === 0) this.isDragging = false;\r\n        });\r\n    }\r\n\r\n    update() {\r\n        // Can handle keyboard shortcuts or auto-pan here\r\n    }\r\n\r\n    // --- Camera methods ---\r\n    pan(dx: number, dy: number) {\r\n        const x = this.workspace._camera.x, y = this.workspace._camera.y;\r\n        this.workspace._camera.x += dx;\r\n        this.workspace._camera.y += dy;\r\n        if (x == this.workspace._camera.x && y == this.workspace._camera.y) {\r\n            return;\r\n        }\r\n        this._throttledFireDidMove();\r\n        this.workspace.didMove = true;\r\n        this.workspace.fireMoveListeners();\r\n        this.refreshPos();\r\n    }\r\n\r\n    setCamera(pos: Vec2) {\r\n        const x = this.workspace._camera.x, y = this.workspace._camera.y;\r\n        this.workspace._camera.x = pos.x;\r\n        this.workspace._camera.y = pos.y;\r\n        if (x == this.workspace._camera.x && y == this.workspace._camera.y) {\r\n            return;\r\n        }\r\n        this._throttledFireDidMove();\r\n        this.workspace.didMove = true;\r\n        this.workspace.fireMoveListeners();\r\n        this.refreshPos();\r\n    }\r\n\r\n    centerOn(pos: Vec2) {\r\n        const wsSize = this.workspace.getSize?.() ?? { width: 0, height: 0 };\r\n        this.setCamera({\r\n            x: pos.x - wsSize.width / 2,\r\n            y: pos.y - wsSize.height / 2\r\n        });\r\n    }\r\n\r\n\r\n\r\n    // --- Coordinate conversion ---\r\n    screenToWorkspace(x: number, y: number): Vec2 {\r\n        const cam = this.workspace._camera;\r\n        return {\r\n            x: x + cam.x,\r\n            y: y + cam.y\r\n        };\r\n    }\r\n\r\n    workspaceToScreen(x: number, y: number): Vec2 {\r\n        const cam = this.workspace._camera;\r\n        return {\r\n            x: (x - cam.x),\r\n            y: (y - cam.y)\r\n        };\r\n    }\r\n\r\n    // --- Refresh ---\r\n    refreshPos() {\r\n        this.workspace.refresh?.();\r\n    }\r\n\r\n    redraw() {\r\n        this.workspace.redraw?.();\r\n    }\r\n\r\n    // --- Cleanup ---\r\n    stop() {\r\n        clearInterval(this._updateInt);\r\n    }\r\n}\r\n","\r\nimport { Path as SvgPath, StrokeData, G } from \"@svgdotjs/svg.js\";\r\nimport * as Path from '../../util/path'\r\nimport { ColorStyle, Hex } from \"../../src/visual-types\";\r\nimport WorkspaceSvg from \"../../src/workspace-svg\";\r\nimport Renderer, { DrawState, NodeMeasurements } from \"../renderer\"; // Saying the value of \"Renderer\" is undefined when it's clearly defined and theres no circular refs.\r\nimport ApolloConstants from \"./constants\";\r\nimport { parseColor } from \"../../util/parse-color\";\r\nimport eventer from \"../../util/eventer\";\r\nimport NodeSvg from \"../../src/nodesvg\";\r\nimport Connection from \"../../src/connection\";\r\nimport { AnyField, FieldRawBoxData } from \"../../src/field\";\r\nconsole.log(Renderer);\r\n\r\nfunction darkenColor(hex: string, amount: number = 0.2): string {\r\n    // Remove # if present\r\n    hex = hex.replace(/^#/, \"\");\r\n\r\n    // Parse r, g, b\r\n    const r = parseInt(hex.substring(0, 2), 16);\r\n    const g = parseInt(hex.substring(2, 4), 16);\r\n    const b = parseInt(hex.substring(4, 6), 16);\r\n\r\n    // Darken each channel\r\n    const newR = Math.max(0, Math.floor(r * (1 - amount)));\r\n    const newG = Math.max(0, Math.floor(g * (1 - amount)));\r\n    const newB = Math.max(0, Math.floor(b * (1 - amount)));\r\n\r\n    // Convert back to hex and pad with 0s\r\n    const toHex = (c: number) => c.toString(16).padStart(2, \"0\");\r\n\r\n    return `#${toHex(newR)}${toHex(newG)}${toHex(newB)}`;\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * ApolloRenderer\r\n * \r\n * Custom renderer extending the base `Renderer` for a visual programming workspace.\r\n * This renderer provides a distinct node style:\r\n * - Node background uses the primary color entirely\r\n * - Topbar is hidden (but still present for dragging)\r\n * - Bottom-right dog-ear decoration\r\n * - Previous connection at the top, next connection at the bottom\r\n */\r\nclass ApolloRenderer extends Renderer {\r\n    declare _constants: ApolloConstants;\r\n\r\n    static get NAME() {\r\n        return 'apollo';\r\n    }\r\n    static get ElEMENT_TAG() {\r\n        return 'ApolloElement';\r\n    }\r\n    /**\r\n     * Constructor\r\n     * @param workspace - The WorkspaceSvg instance\r\n     * @param overrides - Partial constant overrides for ApolloConstants\r\n     */\r\n    constructor(workspace: WorkspaceSvg, overrides: Partial<ApolloConstants>) {\r\n        super(workspace, overrides);\r\n    }\r\n\r\n    /** \r\n     * Typed getter for renderer constants\r\n     */\r\n    get constants(): ApolloConstants {\r\n        return super.constants as ApolloConstants;\r\n    }\r\n\r\n    /** Initialize constants using Apollo-specific overrides */\r\n    initConstants() {\r\n        this._constants = new ApolloConstants(this.constantOverrides);\r\n    }\r\n\r\n    /**\r\n     * Draws the node's topbar.\r\n     * Overridden to hide the topbar visually while retaining its group for dragging.\r\n     * @param state - Current draw state\r\n     * @param colors - Node colors\r\n     * @param measurements - Node dimensions\r\n     */\r\n    drawNodeTopbar(state: DrawState, colors: ColorStyle, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const radius = c.CORNER_RADIUS;\r\n\r\n        state.topbar = state.group!.path(Path.roundedRect(width, c.TOPBAR_HEIGHT, radius))\r\n            .fill('transparent');\r\n    }\r\n\r\n    /**\r\n     * Draws the node background with rounded corners and bottom-right dog-ear cut.\r\n     * Also creates a shadow.\r\n     * @param state - Current draw state\r\n     * @param measurements - Node dimensions\r\n     */\r\n    drawNodeBase(state: DrawState, measurements: NodeMeasurements | null) {\r\n        const c = this.constants;\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const height = measurements?.height ?? c.NODE_BASE_HEIGHT;\r\n        const r = c.CORNER_RADIUS;\r\n\r\n        const dogear = this.constants.SHAPES.Dogear;\r\n        const cutW = dogear?.Width ?? 0;\r\n        const cutH = dogear?.Height ?? 0;\r\n\r\n        // Rounded rect with bottom-right cut\r\n        const roundedRect = `M${r},0 H${width - r} Q${width},0 ${width},${r} V${height - cutH} L${width - cutW},${height} H${r} Q0,${height} 0,${height - r} V${r} Q0,0 ${r},0 Z`;\r\n\r\n        const colors = this.getNodeColors();\r\n        const primary = parseColor(colors.primary) as string;\r\n        const stroke = parseColor(colors.secondary) as string;\r\n\r\n        // Node background\r\n        state.bg = state.group!.path(roundedRect)\r\n            .fill(primary)\r\n            .stroke({ color: stroke, width: 2 });\r\n\r\n        // Dog-ear decoration\r\n        this.drawDogEar(state, state.group as G, width, height, colors);\r\n\r\n        // Node shadow\r\n        state.shadow = state.group!.path(roundedRect)\r\n            .fill('rgba(0,0,0,0.2)')\r\n            .stroke('none')\r\n            .attr({ 'pointer-events': 'none' })\r\n            .move(Number(state.bg.x()) + 5, Number(state.bg.y()) + 5)\r\n            .back();\r\n    }\r\n\r\n    /**\r\n     * Draws a dog-ear decoration at the node's bottom-right corner\r\n     * @param state - Current draw state\r\n     * @param nodeG - Node's SVG group\r\n     * @param w - Node width\r\n     * @param h - Node height\r\n     * @param colors - Node colors\r\n     */\r\n    drawDogEar(state: DrawState, nodeG: G, w: number, h: number, colors: ColorStyle) {\r\n        const pathDef = this.constants.SHAPES.Dogear?.PathMain;\r\n        if (!pathDef) return;\r\n\r\n        const dogEar = nodeG.path(pathDef)\r\n            .fill(parseColor(colors.secondary) as string)\r\n            .stroke({ color: parseColor(colors.tertiary) as string, width: 1 } as StrokeData);\r\n\r\n        const offsetX = w - this.constants.SHAPES.Dogear!.Width;\r\n        const offsetY = h - this.constants.SHAPES.Dogear!.Height;\r\n        dogEar.move(offsetX, offsetY);\r\n        dogEar.front();\r\n    }\r\n\r\n    /**\r\n     * Draws previous and next connections for the node.\r\n     * Previous connection is on top, next is on bottom.\r\n     * @param state - Draw state\r\n     * @param node - NodeSvg instance\r\n     * @param nodeGroup - Node's SVG group\r\n     * @param measurements - Node dimensions\r\n     */\r\n    drawPreviousNextConnections(state: DrawState, node: NodeSvg, nodeGroup: G, measurements: { width: number, height: number } | null = null) {\r\n        if (!state || !node || !state.bg) return;\r\n\r\n        const c = this.constants;\r\n        const colors: ColorStyle = this.getNodeColors();\r\n        const bbox = state.bg.bbox();\r\n\r\n        // Top connector (previous)\r\n        if (node.previousConnection) {\r\n            const c1 = this.drawPrimaryConnector(nodeGroup, state.bg, 'top', parseColor(this._constants.CONNECTOR_COLOR) as string);\r\n            if (c1) {\r\n                const conn = {\r\n                    from: node.previousConnection,\r\n                    to: this.resolveConnectable(node.previousConnection.getFrom(), node.previousConnection) as Connection,\r\n                    fromCircle: c1 as SvgPath,\r\n                    originConn: node.previousConnection,\r\n                    originCircle: c1\r\n                };\r\n                this.setConnect(conn);\r\n                eventer.addElement(c1, 'k_connectbubble', { connection: node.previousConnection, node })\r\n                    .tagElement(c1, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                this._fillOtherNodeConnectorCircle(node.previousConnection, c1 as SvgPath, true);\r\n            }\r\n        }\r\n\r\n        // Bottom connector (next)\r\n        if (node.nextConnection) {\r\n            const c2 = this.drawPrimaryConnector(nodeGroup, state.bg, 'bottom', parseColor(this._constants.CONNECTOR_COLOR) as string);\r\n            if (c2) {\r\n                const conn = {\r\n                    from: node.nextConnection,\r\n                    to: this.resolveConnectable(node.nextConnection.getTo(), node.nextConnection) as Connection,\r\n                    fromCircle: c2 as SvgPath,\r\n                    originConn: node.nextConnection,\r\n                    originCircle: c2\r\n                };\r\n                this.setConnect(conn);\r\n                eventer.addElement(c2, 'k_connectbubble', { connection: node.nextConnection, node })\r\n                    .tagElement(c2, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                this._fillOtherNodeConnectorCircle(node.nextConnection, c2 as SvgPath, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draws a primary connector (triangle or circle) on either the top or bottom edge.\r\n     * @param nodeGroup - Node's SVG group\r\n     * @param nodeBg - Node background path\r\n     * @param side - 'top' or 'bottom'\r\n     * @param color - Connector color\r\n     * @returns SvgPath of the connector\r\n     */\r\n    drawPrimaryConnector(nodeGroup: G, nodeBg: SvgPath, side: 'top' | 'bottom', color: string): SvgPath | void {\r\n        const c = this.constants;\r\n        if (!nodeGroup || !nodeBg) return;\r\n\r\n        const bbox = nodeBg.bbox();\r\n        const triSize = c.CONNECTOR_TRI_SIZE;\r\n        const radius = c.CONNECTOR_RADIUS;\r\n        const x = bbox.width / 2;\r\n        let y: number;\r\n        let element: SvgPath;\r\n\r\n        if (c.CONNECTOR_TRIANGLE) {\r\n            let path = Path.roundedTri(triSize, triSize, 1);\r\n            if (side === 'top') y = -triSize;\r\n            else { y = bbox.height; path = Path.rotatePath(path, 180, triSize / 2, triSize / 2); }\r\n\r\n            element = nodeGroup.path(path)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .transform({ translateX: x - triSize / 2, translateY: y });\r\n        } else {\r\n            const circlePath = Path.circle(radius);\r\n            y = side === 'top' ? 0 : bbox.height;\r\n\r\n            element = nodeGroup.path(circlePath)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .move(x - radius, y - radius);\r\n        }\r\n\r\n        element.attr({ class: (this.constructor as typeof Renderer).CONNECTOR_TAG });\r\n        return element;\r\n    }\r\n    /**\r\n     * Draws a raw input field.\r\n     * @param fieldGroup - The SVG group element for the field.\r\n     * @param field - The field to draw.\r\n     * @param startX - The starting X position for the field.\r\n     * @returns The rectangle and text elements of the raw field.\r\n     */\r\n    drawFieldRaw(fieldGroup: G, field: AnyField, startX: number = 0) {\r\n        const c = this.constants;\r\n        const value = field.getDisplayValue?.() ?? \"\";\r\n        const { width, height } = this.measureRawField(value);\r\n\r\n        // Draw the rectangle\r\n        const rect = fieldGroup.rect(width, height)\r\n            .fill(parseColor(c.FIELD_RAW_COLOR))\r\n            .stroke({ color: parseColor(c.FIELD_RAW_OUTLINE_COLOR), width: c.FIELD_RAW_OUTLINE_STROKE })\r\n            .radius(20);\r\n\r\n        // Draw the text\r\n        const txt = fieldGroup.text(value)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .fill(parseColor(c.FIELD_RAW_TEXT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n\r\n        const rawBox: FieldRawBoxData = { box: rect, txt };\r\n\r\n        // Measure text dimensions\r\n        const textBBox = txt.bbox();\r\n\r\n        // Vertical centering\r\n        const offsetY = (height - textBBox.height) / 2;\r\n\r\n        // Horizontal centering with padding\r\n        const paddedWidth = width - 2 * c.INPUT_BOX_PADDING;\r\n        const offsetX = startX + c.INPUT_BOX_PADDING + Math.max(0, (paddedWidth - textBBox.width) / 2);\r\n\r\n        // Move elements\r\n        rect.move(startX, 0);\r\n        txt.move(offsetX, offsetY);\r\n\r\n        // Add event listener\r\n        eventer.addElement(rect, \"k_inputbox\", {\r\n            field,\r\n            text: txt,\r\n            renderer: this,\r\n            startX\r\n        }).tagElement(rect, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${this.node!.id}`]);\r\n\r\n        return { rect, txt, rawBox };\r\n    }\r\n\r\n    /**\r\n     * Draws the full node (base, topbar, fields, connectors, label, etc.)\r\n     */\r\n    drawNode() {\r\n        if (!this.node) return;\r\n\r\n        const colors = this.getNodeColors();\r\n        const node = this.node;\r\n        const state = this.drawState(this.createNodeGroup(node), node.id);\r\n        this._nodeDraw = state;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n        if (!measurements) return;\r\n\r\n        this.drawNodeBase(state, measurements as NodeMeasurements);\r\n        this.drawNodeTopbar(state, colors, measurements as NodeMeasurements);\r\n        this.drawNodeXButton();\r\n        this.drawNodeLabel(state.group!);\r\n        this.makeNodeDraggable(state.group!, state.topbar!, node);\r\n\r\n        this.createFieldGroup(state);\r\n        this.drawAllFieldsForNode(measurements as NodeMeasurements);\r\n        this.drawPreviousNextConnections(state, node, state.group!, measurements as NodeMeasurements);\r\n    }\r\n}\r\n\r\n\r\nexport default ApolloRenderer;","import NodePrototypes from \"./prototypes\";\r\nimport newHeadlessNode from \"./headless-node\";\r\nimport Widget from \"./widget\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport CommentModel from \"./comment\";\r\nimport UndoRedoHistory from \"./undo-redo\";\r\nimport { ConnectableField } from \"./field\";\r\n\r\n/**\r\n * Headless workspace that holds nodes, widgets, and comments without any rendering or camera.\r\n */\r\nclass Workspace {\r\n\t_nodeDB: Map<string, any>; // Node storage\r\n\t_widgetDB: Map<string, Widget>;\r\n\t_commentDB: Set<CommentModel>;\r\n    isHeadless: boolean = true;\r\n\tconstructor() {\r\n\t\tthis._nodeDB = new Map();\r\n\t\tthis._widgetDB = new Map();\r\n\t\tthis._commentDB = new Set();\r\n\t}\r\n\r\n\t/** Node management */\r\n\taddNode(node: any, nodeId?: string) {\r\n\t\tconst id = nodeId || node.id;\r\n\t\tif (this._nodeDB.has(id)) {\r\n\t\t\tconsole.warn(`Node with id ${id} already exists, overwriting.`);\r\n\t\t}\r\n\t\tif (node.workspace !== this) node.workspace = this;\r\n\t\tthis._nodeDB.set(id, node);\r\n\t}\r\n\r\n\tnewNode(type: keyof typeof NodePrototypes, add: boolean = true) {\r\n\t\tif (!NodePrototypes[type]) return;\r\n\t\tconst node = newHeadlessNode(type as string);\r\n\t\tif (!node) return;\r\n\t\tif (add) this.addNode(node);\r\n\t\treturn node;\r\n\t}\r\n\r\n\tspawnAt(type: keyof typeof NodePrototypes, x: number, y: number) {\r\n\t\tconst node = this.newNode(type, false);\r\n\t\tif (!node) return;\r\n\t\tnode.relativeCoords.set(x, y);\r\n\t\tthis.addNode(node);\r\n\t\treturn node;\r\n\t}\r\n\r\n\tgetNode(id: string | any) {\r\n\t\tif (id instanceof Object && id.id) return id;\r\n\t\treturn this._nodeDB.get(id);\r\n\t}\r\n\r\n\tremoveNodeById(id: string) {\r\n\t\tconst node = this._nodeDB.get(id);\r\n\t\tif (!node) return;\r\n\t\tthis.derefNode(node);\r\n\t\tthis._nodeDB.delete(id);\r\n\t}\r\n\r\n\tremoveNode(node: any) {\r\n\t\tif (!node) return;\r\n\t\tthis.removeNodeById(node.id);\r\n\t}\r\n\r\n\tderefNode(node: any) {\r\n\t\tconst prev = node.previousConnection?.getFrom?.();\r\n\t\tif (prev?.nextConnection) prev.nextConnection.disconnectTo?.();\r\n\t\tconst next = node.nextConnection?.getTo?.();\r\n\t\tif (next?.previousConnection) next.previousConnection.disconnectFrom?.();\r\n\r\n\t\tfor (let field of node.allFields()) {\r\n\t\t\tif ((field as ConnectableField).hasConnectable?.()) {\r\n\t\t\t\t(field as ConnectableField).disconnect();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Widget management */\r\n\tnewWidget(type: string): Widget | void {\r\n\t\tconst opts = WidgetPrototypes[type];\r\n\t\tif (!opts) return;\r\n\t\tconst wdgt = opts.cls ? new opts.cls(this, opts) : new Widget(this, opts);\r\n\t\tthis._widgetDB.set(wdgt.id, wdgt);\r\n\t\treturn wdgt;\r\n\t}\r\n\r\n\tgetWidget(id: string): Widget | undefined {\r\n\t\treturn this._widgetDB.get(id);\r\n\t}\r\n\r\n\t/** Comment management */\r\n\taddComment() {\r\n\t\tconst model = new CommentModel(this);\r\n\t\tthis._commentDB.add(model);\r\n\t\treturn model;\r\n\t}\r\n\r\n\tgetComment(id: string) {\r\n\t\treturn Array.from(this._commentDB).find(e => e.id === id);\r\n\t}\r\n\r\n\tremoveComment(commentOrId: CommentModel | string) {\r\n\t\tlet comment: CommentModel | undefined;\r\n\t\tif (typeof commentOrId === \"string\") comment = this.getComment(commentOrId);\r\n\t\telse comment = commentOrId;\r\n\t\tif (!comment) return false;\r\n\t\tthis._commentDB.delete(comment);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgetComments() {\r\n\t\treturn Array.from(this._commentDB);\r\n\t}\r\n\r\n    /**\r\n     * Internal: Add widget to DB\r\n     * @param wdgt - The widget\r\n     */\r\n    _addWidgetToDB(wdgt: Widget) {\r\n        this._widgetDB.set(wdgt.id, wdgt);\r\n    }\r\n    /**\r\n     * Internal: Delete a widget from DB.\r\n     * @param wdgt - Widget to delete\r\n     */\r\n    _delWidgetFromDB(wdgt: Widget) {\r\n        this._widgetDB.delete(wdgt.id);\r\n    }\r\n    \r\n\t/** Serialization */\r\n\tfromJson(json: { nodes: any[]; circular: boolean }, recordBigEvent: boolean = false) {\r\n\t\tfor (let [, node] of this._nodeDB.entries()) this.removeNode(node);\r\n\r\n\t\tif (json.circular) {\r\n\t\t\tfor (let node of json.nodes) {\r\n\t\t\t\t(node.constructor as any).deserialize(node, this);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (let node of json.nodes) {\r\n\t\t\t\t(node.constructor as any).fromJson(node, this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoJson(circular: boolean) {\r\n\t\tconst nodes = [];\r\n\t\tfor (let [, node] of this._nodeDB) {\r\n\t\t\tif (node.topLevel) nodes.push(circular ? node.serialize() : node.toJson());\r\n\t\t}\r\n\t\treturn { circular, nodes };\r\n\t}\r\n}\r\n\r\nexport default Workspace;\r\n","class Styler {\r\n\tprivate styles: Map<string, HTMLStyleElement>;\r\n\r\n\tconstructor() {\r\n\t\tthis.styles = new Map();\r\n\t}\r\n\r\n\tappendStyles(id: string, css: string): void {\r\n\t\tif (this.styles.has(id)) return; // Do not append if id exists\r\n\r\n\t\tconst styleEl = document.createElement('style');\r\n\t\tstyleEl.id = id;\r\n\t\tstyleEl.textContent = css;\r\n\t\tdocument.head.appendChild(styleEl);\r\n\t\tthis.styles.set(id, styleEl);\r\n\t}\r\n\r\n\tremoveStyles(id: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.remove();\r\n\t\tthis.styles.delete(id);\r\n\t}\r\n\r\n\tupdateStyles(id: string, css: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.textContent = css;\r\n\t}\r\n\r\n\thasStyles(id: string): boolean {\r\n\t\treturn this.styles.has(id);\r\n\t}\r\n}\r\nexport {\r\n    Styler\r\n}\r\nconst styler = new Styler();\r\nexport default styler;","import WorkspaceController from \"../controllers/base\";\r\nimport Renderer from \"../renderers/renderer\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport WorkspaceSvg, { WSTheme } from \"./workspace-svg\";\r\nimport NodePrototypes from \"./prototypes\"; // Object\r\nimport { FieldOptions } from \"./field\";\r\nimport { Color, Hex } from \"./visual-types\";\r\nimport styler from '../util/styler';\r\n// @ts-ignore\r\nimport _kabelStyles from './styles.css';\r\nimport env from \"../util/env\";\r\n\r\nconst kabelStyles: string = _kabelStyles;\r\n\r\n/**\r\n * Represents a field in a toolbox node.\r\n * Can contain any extra properties as needed by the field type.\r\n */\r\nexport interface TblxFieldStruct {\r\n    /** Field value */\r\n    value: any;\r\n\r\n    /** Additional field-specific properties */\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents a node in a toolbox.\r\n */\r\nexport interface TblxNodeStruct {\r\n    /** Node type (matches NodePrototypes key or arbitrary string) */\r\n    type: keyof typeof NodePrototypes | string;\r\n\r\n    /** Map of field names to field data */\r\n    arguments: {\r\n        [key: string]: TblxFieldStruct;\r\n    };\r\n}\r\n\r\n/**\r\n * Represents a category in the toolbox, which contains multiple nodes.\r\n */\r\nexport interface TblxCategoryStruct {\r\n    /** Category name */\r\n    name: string;\r\n\r\n    /** Category color */\r\n    color: Color;\r\n\r\n    /** Nodes contained in this category */\r\n    contents: TblxNodeStruct[];\r\n}\r\n\r\n/**\r\n * Discriminated union type representing possible toolbox structures.\r\n * Can be a flyout (list of nodes) or a categorized toolbox.\r\n */\r\nexport type TblxObjStruct =\r\n    | {\r\n        /** Flyout toolbox type */\r\n        type: 'flyout';\r\n        contents: TblxNodeStruct[];\r\n    }\r\n    | {\r\n        /** Categorized toolbox type */\r\n        type?: 'category';\r\n        contents: TblxCategoryStruct[];\r\n    }\r\n    | {\r\n        /** When type is omitted, defaults to categories */\r\n        type?: undefined;\r\n        contents: TblxCategoryStruct[];\r\n    };\r\nexport interface GridOptions {\r\n    /**\r\n     * The grid's type.\r\n     * 'celled' - The grid is celled.\r\n     * 'dotted' - The grid is dotted.\r\n     */\r\n\ttype: 'celled' | 'dotted';\r\n    /**\r\n     * Spacing, optional. Default is 40.\r\n     */\r\n\tspacing?: number;\r\n    /**\r\n     * Dot size for 'dotted' grid type.\r\n     */\r\n\tdotSize?: number;\r\n    /**\r\n     * stroke width for 'celled' grid type.\r\n     */\r\n\tstrokeWidth?: number;\r\n    /**\r\n     * Option color for any grid type. Color is #bebebeff by default.\r\n     */\r\n    color?: Hex\r\n}\r\n/**\r\n * Options used when injecting a new workspace.\r\n */\r\nexport interface InjectOptions {\r\n    /** Optional renderer overrides */\r\n    rendererOverrides?: { [key: string]: any };\r\n    /** Theme for the workspace */\r\n    theme?: string|WSTheme;\r\n    /** Optional custom controller class */\r\n    Controller?: typeof WorkspaceController;\r\n    /** Init the workspace's undo state for you, or not. */\r\n    initUndoRedo?: boolean;\r\n    /** Optional controls configuration */\r\n    controls?: {\r\n        zoomSpeed?: number;\r\n        minZoom?: number;\r\n        maxZoom?: number;\r\n        wasd?: boolean;\r\n        wasdSmooth?: boolean;\r\n        wasdAccelerate?: number;\r\n        wasdFriction?: number;\r\n    };\r\n\r\n    /** Optional toolbox structure */\r\n    toolbox?: TblxObjStruct;\r\n\r\n    /** Optional movement speed of the workspace */\r\n    moveSpeed?: number;\r\n\r\n    /** Optional renderer: name string or class */\r\n    renderer?: string | typeof Renderer;\r\n    /**\r\n     * Optional grid settings.\r\n     */\r\n    grid?: GridOptions;\r\n}\r\n\r\n/**\r\n * Utility class for logging injection messages in a structured way.\r\n */\r\nexport class InjectMsg {\r\n    /** Message content */\r\n    msg: string;\r\n\r\n    /**\r\n     * Creates a new InjectMsg instance.\r\n     * @param msg - Message text\r\n     */\r\n    constructor(msg: string) {\r\n        this.msg = msg;\r\n    }\r\n\r\n    /** Log as error */\r\n    err() {\r\n        console.error(`Failed to inject workspace: ${this.msg}`);\r\n    }\r\n\r\n    /** Log as warning */\r\n    wrn() {\r\n        console.warn(`Inject warning: ${this.msg}`);\r\n    }\r\n\r\n    /** Log as info */\r\n    info() {\r\n        console.info(`Inject info: ${this.msg}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Injects a new Kabel workspace into the document.\r\n * Appends the workspace container to the given element (or element ID) and\r\n * sets it as the main workspace.\r\n *\r\n * @param element - HTMLElement or string ID to attach the workspace to\r\n * @param options - Optional InjectOptions to configure the workspace\r\n * @returns The newly created WorkspaceSvg instance, or undefined if injection failed\r\n */\r\nexport default function inject(\r\n    element: HTMLElement | string,\r\n    options: InjectOptions = {}\r\n): WorkspaceSvg | undefined {\r\n    if (!env.isBrowser) {\r\n        new InjectMsg(`Cannot inject workspace-svg in non-browser environment (use Kabel.injectHeadless).`).err();\r\n        return;\r\n    }\r\n    // Apply global Kabel styles\r\n    styler.appendStyles('KabelStyles', kabelStyles);\r\n\r\n    const root =\r\n        typeof element === 'string'\r\n            ? document.querySelector(`#${element}`) as HTMLElement\r\n            : element as HTMLElement;\r\n\r\n    if (!root) {\r\n        new InjectMsg(`Document does not contain root element (Check element ID).`).err();\r\n        return;\r\n    }\r\n\r\n    if (!document.contains(root)) {\r\n        new InjectMsg(`Document does not contain root element.`).err();\r\n        return;\r\n    }\r\n\r\n    // Create workspace wrapper element\r\n    const wsTop = document.createElement('div');\r\n    wsTop.className = `KabelWorkspaceWrapper`;\r\n    root.appendChild(wsTop);\r\n\r\n    // Initialize workspace\r\n    const ws = new WorkspaceSvg(root, wsTop, options);\r\n\r\n    // Set as the main workspace globally\r\n    setMainWorkspace(ws);\r\n\r\n    return ws;\r\n}\r\n","import { NodePrototype } from \"./node-types\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\n\r\n/**\r\n * Creates a new headless NodeSvg instance without attaching it to a workspace.\r\n * This is useful for programmatic node generation, testing, or serialization.\r\n *\r\n * @param type - The type of node to create. Must exist in NodePrototypes.\r\n * @returns The initialized NodeSvg instance, or `undefined` if the prototype does not exist.\r\n */\r\nfunction newHeadlessNode(type: string): NodeSvg | undefined {\r\n    const proto: NodePrototype = NodePrototypes[type as string] as NodePrototype;\r\n\r\n    // Return undefined if prototype not found\r\n    if (!proto) return;\r\n\r\n    // Create a new node instance\r\n    const node = new NodeSvg(proto);\r\n\r\n    // Initialize the node (calls prototype init, sets defaults)\r\n    node.init();\r\n\r\n    return node;\r\n}\r\n\r\nexport default newHeadlessNode;\r\n","const isNode = typeof process !== 'undefined' && !!process.versions?.node;\r\nconst isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\r\nconst isWebWorker = typeof self !== 'undefined' && typeof self.importScripts === 'function';\r\n\r\nconst env: {\r\n    isBrowser: boolean;\r\n    isNode: boolean;\r\n    isWebWorker: boolean;\r\n} = { isNode, isBrowser, isWebWorker };\r\n\r\nexport default env;","import Connection, { Connectable } from \"./connection\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { ColorStyle, Color } from './visual-types';\r\nimport hasProp from '../util/has-prop';\r\nimport Field, { AnyField, AnyFieldCls, DummyField, FieldMap, FieldOptions } from \"./field\";\r\nimport CategoryColors from \"./colors\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport EventEmitter from '../util/emitter';\r\nimport { G } from \"@svgdotjs/svg.js\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport CommentModel, { CommentSerialized } from \"./comment\";\r\nimport { RepresenterNode } from '../renderers/representer-node';\r\nimport NodePrototypes from \"./prototypes\";\r\n/**\r\n * Represents the JSON structure used to initialize a field on a node.\r\n * Each field has a type, label, and name. Additional properties can be included for field-specific configuration.\r\n */\r\nexport interface InputFieldJson {\r\n    /** Human-readable label for the field, shown on the node UI */\r\n    label: string;\r\n\r\n    /** Field type identifier, corresponding to a field constructor in FieldMap */\r\n    type: string;\r\n\r\n    /** Unique field name within the node */\r\n    name: string;\r\n\r\n    /**\r\n     * Optional additional properties for field initialization.\r\n     * Can include type-specific options like min/max for number fields,\r\n     * default values, dropdown options, etc.\r\n     */\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents a JSON structure for initializing a NodeSvg instance.\r\n * Includes colors, connections, label, fields, category, and type information.\r\n */\r\nexport interface NodeJson {\r\n    /** Primary color of the node (e.g., top bar, main connections) */\r\n    primaryColor?: Color | undefined;\r\n\r\n    /** Secondary color of the node (e.g., field backgrounds) */\r\n    secondaryColor?: Color | undefined;\r\n\r\n    /** Tertiary color of the node (e.g., outlines) */\r\n    tertiaryColor?: Color | undefined;\r\n\r\n    /**\r\n     * Optional previous connection data.\r\n     * Presence triggers creation of a previous connection when initializing NodeSvg.\r\n     */\r\n    previousConnection?: any | undefined;\r\n\r\n    /**\r\n     * Optional next connection data.\r\n     * Presence triggers creation of a next connection when initializing NodeSvg.\r\n     */\r\n    nextConnection?: any | undefined;\r\n\r\n    /** Optional node label text to display */\r\n    labelText?: string | undefined;\r\n\r\n    /** Array of field definitions (InputFieldJson) to attach to this node */\r\n    arguments?: InputFieldJson[] | undefined;\r\n\r\n    /** Optional category name for color theming */\r\n    category?: string | undefined;\r\n\r\n    /** Node type identifier, used to look up the NodePrototype */\r\n    type: string;\r\n}\r\n\r\n/**\r\n * Represents a fully serialized node including its fields, colors, coordinates, connections, and optional comment.\r\n * Used for saving or transferring node data.\r\n */\r\nexport interface SerializedNode {\r\n    /** Node type string */\r\n    type: string;\r\n\r\n    /** Unique node ID */\r\n    id: string;\r\n\r\n    /** Display label of the node */\r\n    label: string;\r\n\r\n    /** Node colors including primary, secondary, tertiary, and category */\r\n    colors: ColorStyle;\r\n\r\n    /** Coordinates of the node relative to its workspace */\r\n    relativeCoords: { x: number; y: number };\r\n\r\n    /** Optional comment text attached to the node */\r\n    comment?: CommentSerialized | undefined;\r\n\r\n    /** Array of serialized fields, may contain any field-specific structure */\r\n    fields?: any[] | undefined;\r\n\r\n    /**\r\n     * Serialized representation of the previous connection.\r\n     * If `field` is true, the connection originates from a field rather than a node.\r\n     */\r\n    previousConnection?: { field?: boolean | undefined; node?: SerializedNode | undefined } | undefined;\r\n\r\n    /**\r\n     * Serialized representation of the next connection.\r\n     * If `field` is true, the connection originates from a field rather than a node.\r\n     */\r\n    nextConnection?: { field?: boolean | undefined; node?: SerializedNode | undefined } | undefined;\r\n}\r\n\r\n/**\r\n * NodeStyle represents the styling configuration of a node.\r\n * Includes ColorStyle properties plus optional renderer-specific constants and arbitrary additional fields.\r\n */\r\nexport type NodeStyle = ColorStyle &\r\n{\r\n    /** Optional renderer-specific constants from RendererConstants */\r\n    [key in keyof RendererConstants]?: RendererConstants[key];\r\n} &\r\n{\r\n    /** Any additional style properties supported by extensions or custom renderers */\r\n    [key: string]: any;\r\n};\r\n\r\n/**\r\n * Events emitted by NodeSvg instances.\r\n * Consumers can listen to these events to react to node lifecycle changes.\r\n */\r\nexport interface NodeEvents {\r\n    /** Triggered before the node is removed from the workspace */\r\n    \"REMOVING\": null;\r\n\r\n    /** Triggered immediately after node initialization */\r\n    \"INITING\": null;\r\n\r\n    /** Triggered while the node is being dragged */\r\n    \"NODE_DRAG\": null;\r\n}\r\n\r\n/**\r\n * Represents a node in the workspace.\r\n * Handles connections, fields, colors, serialization, and events.\r\n */\r\nclass NodeSvg extends EventEmitter<NodeEvents> {\r\n    /** The previous connection for this node (null if none) */\r\n    previousConnection: Connection | null;\r\n    /** The next connection for this node (null if none) */\r\n    nextConnection: Connection | null;\r\n    /** Node type string, usually derived from prototype */\r\n    type: string | null;\r\n    /** Prototype object providing behavior for this node */\r\n    prototype: NodePrototype | null;\r\n    /** Node color style object */\r\n    colors: NodeStyle;      // Node's color scheme\r\n    /** Displayed label text for this node */\r\n    labelText: string;       // Displayed node label\r\n    /** Set of fields attached to this node */\r\n    _fieldColumn: Set<AnyField>; // Stores attached fields\r\n    /** Node coordinates relative to workspace */\r\n    relativeCoords: Coordinates;\r\n    /** Unique node ID */\r\n    id: string;\r\n    /** SVG representation of this node */\r\n    svg?: RepresenterNode | object | null = null;\r\n    /** Workspace this node belongs to */\r\n    workspace: WorkspaceSvg | null = null;\r\n    /** Optional comment attached to this node */\r\n    comment: CommentModel | null\r\n    /** Event key: \"REMOVING\" */\r\n    static REMOVING: keyof NodeEvents = \"REMOVING\";\r\n\r\n    /** Event key: \"INITING\" */\r\n    static INITING: keyof NodeEvents = \"INITING\";\r\n    /**\r\n     * Creates a NodeSvg instance.\r\n     * @param prototype Optional NodePrototype to associate with this node.\r\n     * @param workspace Optional WorkspaceSvg this node belongs to.\r\n     * @param svgGroup Optional SVG group to attach node visuals.\r\n     */\r\n    constructor(prototype: NodePrototype | null, workspace?: WorkspaceSvg, svgGroup?: G) {\r\n        super();\r\n        this.type = null;\r\n        this.comment = null;\r\n        this.prototype = prototype;\r\n        this.colors = {\r\n            primary: '#000000',   // Topbar & connection color\r\n            secondary: '#000000', // Field & dropdown backgrounds\r\n            tertiary: '#000000', // Outline color\r\n            category: ''          // Node category name (optional)\r\n        };\r\n        this.previousConnection = new Connection(null, this, true); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.nextConnection = new Connection(this, null, false); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.labelText = '';\r\n        this._fieldColumn = new Set();\r\n        this.relativeCoords = new Coordinates(0, 0);\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        if (workspace) {\r\n            this.workspace = workspace;\r\n        }\r\n        if (svgGroup) {\r\n            this.svg = new RepresenterNode(this, {\r\n                id: this.id,\r\n                pendingConnections: [],\r\n                group: svgGroup\r\n            }, workspace!.renderer)\r\n        }\r\n    }\r\n    /** Returns true if this node has no previous connection (i.e., top-level node) */\r\n    get topLevel() {\r\n        return !(this.previousConnection?.getFrom());\r\n    }\r\n    /** Returns the raw SVG group element if present */\r\n    get svgGroup() {\r\n        return (this.svg as RepresenterNode)?.getRaw?.();\r\n    }\r\n    /** Returns the text of the node's comment, if any */\r\n    getCommentText() {\r\n        return this.comment?.getText?.();\r\n    }\r\n    /** Returns the CommentModel instance for this node, if any */\r\n    getComment() {\r\n        return this.comment;\r\n    }\r\n    /** Adds a new comment to this node if none exists */\r\n    addComment() {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n            return;\r\n        }\r\n        console.warn('Comment already exists.')\r\n    }\r\n    /** Sets the text for the node's comment, creating one if needed */\r\n    setCommentText(text: string) {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n        }\r\n        this.comment.setText(text);\r\n    }\r\n    /** Removes the comment from the node and triggers workspace redraw */\r\n    removeComment() {\r\n        this.comment = null;\r\n        this.workspace?.redrawComments?.();\r\n    }\r\n    /** Returns an array of all fields attached to this node */\r\n    allFields() {\r\n        return Array.from(this._fieldColumn);\r\n    }\r\n    /** Retrieves a field by name from this node */\r\n    getFieldByName(name: string): AnyField | null | undefined {\r\n        let field: AnyField | null | undefined = this.allFields().find(fld => fld.getName() === name);\r\n\r\n        return field;\r\n    }\r\n    /** Alias for getFieldByName */\r\n    getField(name: string): AnyField | null | undefined {\r\n        return this.getFieldByName(name);\r\n    }\r\n    /** Retrieves the current value of a field by name */\r\n    getFieldValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /** Retrieves the display value of a field by name */\r\n    getFieldDisplayValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getDisplayValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /** Sets the value of a field by name */\r\n    setFieldValue(name: string, value: any) {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            fld.setValue(value as never); // I don't like using the \"as\" statement here, but it's necessary to satisfy TypeScript.\r\n        }\r\n        return fld;\r\n    }\r\n\r\n    /**\r\n     * Initiates the node, calling prototype methods.\r\n     */\r\n    init() {\r\n        this.emit(NodeSvg.INITING, null);\r\n        if (this.prototype) {\r\n            if (this.prototype.init) this.prototype.init.call(this, this.prototype, this);\r\n            if (this.workspace) {\r\n                this.workspace.addNode(this)\r\n            }\r\n            if (this.prototype.removed) {\r\n                this.on(NodeSvg.REMOVING, () => {\r\n                    this.prototype?.removed.call(this, this.prototype, this);\r\n                })\r\n            }\r\n        } else {\r\n            console.warn(`Node with id ${this.id} is missing a prototype.`)\r\n        }\r\n    }\r\n    /** Returns whether this node has a category style applied */\r\n    hasCategoryStyle() {\r\n        return !!this.colors?.category && this.colors?.category?.length > 0;\r\n    }\r\n\r\n    /** Returns the category name or null if none */\r\n    getCategoryName() {\r\n        return this.colors?.category || null;\r\n    }\r\n\r\n    /** Returns the node's current ColorStyle */\r\n    getStyle() {\r\n        return this.colors;\r\n    }\r\n\r\n    /** Internal helper: attach a field to this node */\r\n    _appendFieldItem(field: AnyField) {\r\n        if (!field) console.warn(\"Falsey field passed to _appendFieldItem.\");\r\n        this._fieldColumn.add(field);\r\n    }\r\n\r\n    /** Initialize node from a NodeJson object */\r\n    jsonInit(json: NodeJson) {\r\n        if (json.primaryColor) this.colors.primary = json.primaryColor;\r\n        if (json.secondaryColor) this.colors.secondary = json.secondaryColor;\r\n        if (json.tertiaryColor) this.colors.tertiary = json.tertiaryColor;\r\n\r\n        // Apply category colors if defined\r\n        if (json.category && CategoryColors[json.category]) {\r\n            const style: ColorStyle = CategoryColors[json.category] as ColorStyle;\r\n            Object.assign(this.colors, { category: json.category }, style);\r\n        }\r\n\r\n        this.previousConnection = hasProp(json, 'previousConnection') ? new Connection(null, this, true) : null;\r\n        this.nextConnection = hasProp(json, 'nextConnection') ? new Connection(this, null, false) : null;\r\n\r\n        if (json.labelText) this.labelText = json.labelText;\r\n        if (json.arguments) this.applyJsonArguments(json.arguments);\r\n        if (json.type) {\r\n            this.type = json.type;\r\n        }\r\n    }\r\n\r\n    /* JAVASCRIPT API */\r\n\r\n    /** Apply field definitions from a JSON-like array without full NodeJson */\r\n    applyJsonArguments(args: InputFieldJson[]) {\r\n        for (let field of args) {\r\n            if (!field.type || !field.name) {\r\n                console.warn(`Invalid argument definition at: ${args.indexOf(field)}.`);\r\n                continue;\r\n            }\r\n\r\n            const FieldConstructor: AnyFieldCls | undefined = FieldMap[field.type] as AnyFieldCls | undefined;\r\n            if (!FieldConstructor) {\r\n                console.warn(`Missing field constructor for ${field.type}!`);\r\n                continue;\r\n            }\r\n\r\n            const fld: AnyField = new FieldConstructor();\r\n            fld.fromJson(field); // initialize field\r\n            fld.node = this;\r\n            this._appendFieldItem(fld);\r\n        }\r\n        return this;\r\n    }\r\n    /** Appends a connection field to this node */\r\n    appendConnection(name: string): Field {\r\n        const fld = new (FieldMap['connection'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Appends a numeric input field to this node */\r\n    appendNumber(name: string): Field {\r\n        const fld = new (FieldMap['field_num'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Appends a text input field to this node */\r\n    appendText(name: string): Field {\r\n        const fld = new (FieldMap['field_str'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    /** Appends a field that can hold a connection or raw value */\r\n    appendOptLink(name: string): Field {\r\n        const fld = new (FieldMap['field_both'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Sets the category name for the node */\r\n    setCategoryName(name: string) {\r\n        this.colors.category = name;\r\n        return this;\r\n    }\r\n    /** Applies a ColorStyle to the node */\r\n    setStyle(style: ColorStyle) {\r\n        // apply properties from style into this.colors\r\n        Object.assign(this.colors, style);\r\n        return this;\r\n    }\r\n\r\n    /** Sets primary, secondary, and tertiary colors for the node */\r\n    setColor(primary: Color, secondary: Color, tertiary: Color) {\r\n        this.setStyle({ primary, secondary, tertiary });\r\n        return this;\r\n    }\r\n    /** Sets the label text for the node */\r\n    setLabelText(text: string) {\r\n        this.labelText = text;\r\n        return this;\r\n    }\r\n\r\n    /** Add or replace a previous/next connection based on argument */\r\n    setConnection(prevOrNext: string | number | boolean) {\r\n        const stringed = String(prevOrNext).toLowerCase();\r\n        const cast = stringed == '0' ? 0 : (stringed == '1' ? 1 : (stringed == 'true' ? 1 : (stringed == 'false' ? 0 : 3)));\r\n\r\n        if (cast === 0) {\r\n            this.previousConnection = new Connection(null, this, true);\r\n        } else if (cast === 1) {\r\n            this.nextConnection = new Connection(this, null, false);\r\n        } else {\r\n            console.warn('Invalid prevOrNext argument for NodeSvg.setConnection');\r\n        }\r\n        return this;\r\n    }\r\n    /** Copies another NodeSvg into this node */\r\n    fromNode(other: NodeSvg) {\r\n        if (!other) return;\r\n\r\n        // Copy primitive props\r\n        this.type = other.type;\r\n        this.labelText = other.labelText;\r\n        this.relativeCoords = new Coordinates(other.relativeCoords.x, other.relativeCoords.y);\r\n\r\n        // Copy colors\r\n        this.colors = { ...other.colors };\r\n\r\n        // Copy connections\r\n        this.previousConnection = other.previousConnection\r\n            ? new Connection(null, this, true)\r\n            : null;\r\n        this.nextConnection = other.nextConnection\r\n            ? new Connection(this, null, false)\r\n            : null;\r\n\r\n        // Copy fields\r\n        this._fieldColumn.clear();\r\n        for (let field of other._fieldColumn) {\r\n            const FieldCls = field.constructor as AnyFieldCls;\r\n            const newField = (new FieldCls()) as any;\r\n\r\n            // Copy basic properties\r\n            newField.setName(field.getName());\r\n            if ('getValue' in field && 'setValue' in newField) {\r\n                newField.setValue(field.getValue());\r\n            }\r\n            if ('getLabel' in field && 'setLabel' in newField) {\r\n                newField.setLabel(field.getLabel())\r\n            }\r\n            this._appendFieldItem(newField);\r\n        }\r\n\r\n        // Copy workspace reference\r\n        this.workspace = other.workspace;\r\n\r\n        // Copy prototype reference\r\n        this.prototype = other.prototype;\r\n\r\n\r\n        return this;\r\n    }\r\n    /** Serializes a Connection object, handling fields and nested nodes */\r\n    _serializeConnection(\r\n        c: Connection,\r\n        alreadyProcessed: { [key: string]: SerializedNode }\r\n    ): { field?: boolean | undefined; node?: SerializedNode | undefined } {\r\n        const returned: { field?: boolean; node?: SerializedNode } = {};\r\n        let connected: NodeSvg | AnyField | null = c.isPrevious ? c.getFrom() : c.getTo();\r\n\r\n        if (!connected) return returned;\r\n\r\n        if (connected instanceof NodeSvg) {\r\n            // Avoid serializing the same node twice\r\n            if (alreadyProcessed[connected.id]) {\r\n                return { node: alreadyProcessed[connected.id] };\r\n            }\r\n            returned.node = connected.serialize(alreadyProcessed);\r\n        } else {\r\n            // Field serialization\r\n            const fld = connected as AnyField;\r\n            // If the field has a node, we serialize the node first\r\n            let fieldNode: SerializedNode | undefined;\r\n            if (fld.node) {\r\n                if (alreadyProcessed[fld.node.id]) {\r\n                    fieldNode = alreadyProcessed[fld.node.id];\r\n                } else {\r\n                    fieldNode = fld.node.serialize(alreadyProcessed);\r\n                }\r\n            }\r\n            returned.field = true;\r\n            if (fieldNode) returned.node = fieldNode;\r\n        }\r\n\r\n        return returned;\r\n    }\r\n\r\n    /**\r\n     * Serialize a node, this includes circular references. use toJson to avoid those.\r\n     * @param alreadyProcessed - Internal.\r\n     * @returns \r\n     */\r\n    serialize(alreadyProcessed: { [key: string]: SerializedNode } = {}): SerializedNode {\r\n        if (alreadyProcessed[this.id]) {\r\n            return alreadyProcessed[this.id] as SerializedNode;\r\n        }\r\n\r\n        // Put a placeholder in map *before* serializing connections\r\n        const serialized: SerializedNode = {\r\n            id: this.id,\r\n            type: this.type || '',\r\n            colors: { primary: this.colors.primary, secondary: this.colors.secondary, tertiary: this.colors.tertiary, category: this.colors.category } as ColorStyle,\r\n            label: this.labelText,\r\n            previousConnection: undefined,\r\n            nextConnection: undefined,\r\n            relativeCoords: { x: this.relativeCoords.x, y: this.relativeCoords.y },\r\n            comment: this.comment?.toJson?.(),\r\n            fields: [], // fill after placeholder\r\n        };\r\n        alreadyProcessed[this.id] = serialized;\r\n\r\n        // Now safely fill in the heavy parts\r\n        serialized.fields = this.allFields().map(fld =>\r\n            fld.toJson\r\n                ? fld.toJson(true, alreadyProcessed)\r\n                : {\r\n                    name: fld.getName(),\r\n                    type: fld.constructor.name,\r\n                    value: fld.getValue ? fld.getValue() : undefined,\r\n                }\r\n        );\r\n\r\n        serialized.previousConnection = this.previousConnection\r\n            ? this._serializeConnection(this.previousConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        serialized.nextConnection = this.nextConnection\r\n            ? this._serializeConnection(this.nextConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        return serialized;\r\n    }\r\n\r\n    /**\r\n     * Return a flattened version of the serialized node structure, which is non-circular.\r\n     * Any node reference inside connections or fields is replaced by its ID.\r\n     */\r\n    toJson(): {\r\n        [id: string]: Omit<SerializedNode, 'previousConnection' | 'nextConnection'> & {\r\n            previousConnection?: { field?: FieldOptions; node?: string };\r\n            nextConnection?: { field?: FieldOptions; node?: string };\r\n        }\r\n    } {\r\n        const serialized = this.serialize();\r\n        const flat: { [id: string]: any } = {};\r\n\r\n        const processNode = (node: SerializedNode) => {\r\n            if (flat[node.id]) return;\r\n\r\n            const copy: any = {\r\n                ...node,\r\n                previousConnection: node.previousConnection ? { ...node.previousConnection } : undefined,\r\n                nextConnection: node.nextConnection ? { ...node.nextConnection } : undefined,\r\n            };\r\n\r\n            flat[node.id] = copy;\r\n\r\n            // Handle connections\r\n            if (copy.previousConnection?.node) {\r\n                const prevNode = copy.previousConnection.node;\r\n                copy.previousConnection.node = prevNode.id;\r\n                processNode(prevNode);\r\n            }\r\n            if (copy.nextConnection?.node) {\r\n                const nextNode = copy.nextConnection.node;\r\n                copy.nextConnection.node = nextNode.id;\r\n                processNode(nextNode);\r\n            }\r\n\r\n            // Handle fields recursively\r\n            if (Array.isArray(copy.fields)) {\r\n                for (let fld of copy.fields) {\r\n                    if (fld.node) {\r\n                        processNode(fld.node);\r\n                        fld.node = fld.node.id;\r\n                    }\r\n                    for (let key in fld) {\r\n                        if (fld[key]?.node) {\r\n                            processNode(fld[key]?.node);\r\n                            fld[key].node = fld[key].node.id;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        processNode(serialized);\r\n        return flat;\r\n    }\r\n\r\n    /**\r\n      * Reconstruct a NodeSvg from a SerializedNode structure (handles circular references)\r\n      */\r\n    static _deserialize(\r\n        data: SerializedNode,\r\n        allNodes: { [id: string]: NodeSvg } = {},\r\n        workspace?: WorkspaceSvg\r\n    ): NodeSvg {\r\n        // If already created, return the existing instance\r\n        if (allNodes[data.id]) return allNodes[data.id] as NodeSvg;\r\n\r\n        if (workspace && workspace.getNode(data.id)) {\r\n            workspace.removeNodeById(data.id); // remove old node which had the same id.\r\n        }\r\n        // Create a new node with minimal prototype info (can be patched later)\r\n        const node = new NodeSvg(NodePrototypes[data.type] as NodePrototype, workspace);\r\n        node.id = data.id;\r\n        node.init();\r\n        node.type = data.type;\r\n        node.relativeCoords.set(data.relativeCoords.x, data.relativeCoords.y);\r\n        node.labelText = data.label || '';\r\n        if (data.comment && workspace) {\r\n            node.comment = CommentModel.fromJson(data.comment as CommentSerialized);\r\n            node.comment._parent = node;\r\n            node.comment._isWorkspaceComment = false;\r\n        }\r\n        // IMPORTANT: restore colors from serialized data (if present)\r\n        if (data.colors) {\r\n            // Start with category colors if a category is present and known\r\n            if (data.colors.category && CategoryColors[data.colors.category]) {\r\n                const style: ColorStyle = CategoryColors[data.colors.category] as ColorStyle;\r\n                Object.assign(node.colors, style, { category: data.colors.category });\r\n            }\r\n            // Then override with explicit serialized colors (primary/secondary/tertiary)\r\n            // This preserves explicit color values even when a category was saved\r\n            const explicit: Partial<ColorStyle> = {};\r\n            if (data.colors.primary) explicit.primary = data.colors.primary;\r\n            if (data.colors.secondary) explicit.secondary = data.colors.secondary;\r\n            if (data.colors.tertiary) explicit.tertiary = data.colors.tertiary;\r\n            if (data.colors.category) explicit.category = data.colors.category;\r\n            node.setStyle(explicit as ColorStyle);\r\n        }\r\n        // Register placeholder before deserializing connections to handle circular refs\r\n        allNodes[node.id] = node;\r\n\r\n        // Deserialize fields\r\n        if (Array.isArray(data.fields)) {\r\n            node._fieldColumn = new Set();\r\n            for (let fldData of data.fields) {\r\n                const FieldConstructor = FieldMap[fldData.type];\r\n                if (!FieldConstructor) continue;\r\n\r\n                const fld: AnyField = new FieldConstructor();\r\n                fld.fromJson(fldData, workspace); // ONLY fldData and workspace\r\n                fld.node = node;\r\n                node._appendFieldItem(fld);\r\n            }\r\n        }\r\n\r\n        // Deserialize previous/next connections\r\n        if (data.previousConnection?.node) {\r\n            node.previousConnection = new Connection(null, node, true);\r\n            node.previousConnection.setFrom(NodeSvg._deserialize(data.previousConnection.node, allNodes, workspace));\r\n        }\r\n\r\n        if (data.nextConnection?.node) {\r\n            node.nextConnection = new Connection(node, null, false);\r\n            node.nextConnection.setTo(NodeSvg._deserialize(data.nextConnection.node, allNodes, workspace));\r\n        } else {\r\n            workspace?.redraw(); // redraw if we reached the end.\r\n        }\r\n\r\n        return node;\r\n    }\r\n    /** Public: Deserialize a SerializedNode or plain object into a NodeSvg attached to a workspace */\r\n    static deserialize(json: SerializedNode | any, workspace: WorkspaceSvg) {\r\n        return this._deserialize(json as SerializedNode, {}, workspace);\r\n    }\r\n    /** Reconstructs nodes from a flattened JSON structure into a NodeSvg tree */\r\n    static fromJson(flat: Record<string, any>, workspace: WorkspaceSvg): any {\r\n        const nodes: Record<string, any> = {};\r\n        // shallow clone so we can safely mutate\r\n        for (const id in flat) {\r\n            nodes[id] = { ...flat[id] };\r\n        }\r\n\r\n        // rebuild references\r\n        for (const id in nodes) {\r\n            const node = nodes[id];\r\n\r\n            // fix connection refs\r\n            if (node.previousConnection?.node) {\r\n                const refId = node.previousConnection.node as string;\r\n                node.previousConnection = {\r\n                    ...node.previousConnection,\r\n                    node: nodes[refId],\r\n                };\r\n            }\r\n            if (node.nextConnection?.node) {\r\n                const refId = node.nextConnection.node as string;\r\n                node.nextConnection = {\r\n                    ...node.nextConnection,\r\n                    node: nodes[refId],\r\n                };\r\n            }\r\n\r\n            // fix fields\r\n            if (Array.isArray(node.fields)) {\r\n                for (const fld of node.fields) {\r\n                    if (typeof fld.node === 'string')\r\n                        fld.node = nodes[fld.node];\r\n\r\n                    for (const key in fld) {\r\n                        const maybe = fld[key];\r\n                        if (maybe?.node && typeof maybe.node === 'string')\r\n                            maybe.node = nodes[maybe.node];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // the root is just the one w/ no previousConnection\r\n        const root = Object.values(nodes).find(n => !n.previousConnection?.node) ?? null;\r\n        return this._deserialize(root, {}, workspace);\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default NodeSvg;\r\n","import CommentModel from \"./comment\";\r\nimport { ContextMenuOpts, Showable } from \"./context-menu\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\n/** Registry for all context menu options */\r\nconst ContextOptsRegistry: ContextMenuOpts[] = [];\r\n\r\n/**\r\n * Global context menu manager\r\n */\r\nconst ContextMenu = {\r\n    /**\r\n     * Register a new context menu option\r\n     * @param id - Unique identifier for the option\r\n     * @param option - Configuration for the context menu item\r\n     */\r\n    registerOption(id: string, option: Omit<ContextMenuOpts, 'id'>) {\r\n        const opt = {\r\n            id,\r\n            click: option.click,\r\n            label: option.label,\r\n            onHoverStart: option.onHoverStart || (() => { }),\r\n            onHoverEnd: option.onHoverEnd || (() => { }),\r\n            showFor: option.showFor || 'any'\r\n        };\r\n        ContextOptsRegistry.push(opt);\r\n    },\r\n\r\n    /**\r\n     * Unregister an existing context menu option by ID\r\n     * @param id - ID of the option to remove\r\n     */\r\n    unregisterOption(id: string) {\r\n        const index = ContextOptsRegistry.findIndex(opt => opt.id === id);\r\n        if (index >= 0) ContextOptsRegistry.splice(index, 1);\r\n    }\r\n};\r\n\r\n// ----- Default options -----\r\n\r\nContextMenu.registerOption('k_delete', {\r\n    showFor: 'node',\r\n    label: 'Delete',\r\n    click: (t) => {\r\n        const target = t as NodeSvg;\r\n        if (!target.workspace) return;\r\n        target.workspace.removeNode(target);\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_deleteall', {\r\n    showFor: 'ws',\r\n    label: 'Delete all',\r\n    click: (t) => {\r\n        const target = t as WorkspaceSvg;\r\n        const isSure = window.confirm(`Are you sure you want to delete ${Array.from(target._nodeDB.keys()).length} nodes?`);\r\n        if (!isSure) return;\r\n        for (let [id, _] of target._nodeDB) {\r\n            target.removeNodeById(id);\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_addcomment', {\r\n    showFor: ['ws', 'node'],\r\n    label: 'Add Comment',\r\n    click: (t) => {\r\n        const target = t;\r\n        if (target instanceof NodeSvg) {\r\n            target.addComment();\r\n            target.setCommentText('Comment!');\r\n        } else if (target instanceof WorkspaceSvg) {\r\n            const model = target.addComment();\r\n            const pos = target.screenToWorkspace(target._ctxMenu.widget.coords.x, target._ctxMenu.widget.coords.y);\r\n            model.relativeCoords.set(pos.x, pos.y);\r\n            model.setText('Comment!');\r\n        }\r\n    }\r\n});\r\nContextMenu.registerOption('k_undo', {\r\n    showFor: ['ws', 'node', 'comment'],\r\n    label: 'Undo',\r\n    click: (t) => {\r\n        if (t instanceof NodeSvg) {\r\n            t.workspace?.history?.undo();\r\n        } else if (t instanceof CommentModel) {\r\n            t.getWorkspace()?.history?.undo();\r\n        } else if (t instanceof WorkspaceSvg) {\r\n            t.history.undo();\r\n        }\r\n    },\r\n    onDraw(el, ws, opt) {\r\n        console.log('onDrawCalled');\r\n        if (!ws.history.canUndo()) {\r\n            (el as HTMLElement).classList.add('disabled')\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_redo', {\r\n    showFor: ['ws', 'node', 'comment'],\r\n    label: 'Redo',\r\n    click: (t) => {\r\n        if (t instanceof NodeSvg) {\r\n            t.workspace?.history?.redo();\r\n        } else if (t instanceof CommentModel) {\r\n            t.getWorkspace()?.history?.redo();\r\n        } else if (t instanceof WorkspaceSvg) {\r\n            t.history.redo();\r\n        }\r\n    },\r\n    onDraw(el, ws, opt) {\r\n        console.log('onDrawCalled');\r\n        if (!ws.history.canRedo()) {\r\n            (el as HTMLElement).classList.add('disabled')\r\n        }\r\n    }\r\n})\r\nContextMenu.registerOption('k_deletecomment', {\r\n    showFor: 'comment',\r\n    label: 'Delete Comment',\r\n    click: (t) => {\r\n        const target = t as CommentModel;\r\n        if (target.isNodeComment() && target._parent instanceof NodeSvg) {\r\n            target._parent.removeComment();\r\n        } else {\r\n            target.getWorkspace().removeComment(target);\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_duplicate', {\r\n    showFor: 'node',\r\n    label: 'Duplicate',\r\n    click: t => {\r\n        const node = t as NodeSvg;\r\n        if (!node.workspace) return;\r\n        node.workspace.cloneNode(node);\r\n    }\r\n});\r\n\r\nexport { ContextMenu };\r\nexport default ContextOptsRegistry;\r\n","type WindowEventKeys =\r\n\t| 'resize'\r\n\t| 'scroll'\r\n\t| 'blur'\r\n\t| 'focus'\r\n\t| 'visibilitychange'\r\n\t| 'pointerlockchange'\r\n\t| 'beforeunload';\r\n\r\ntype WindowListenersMap = Record<WindowEventKeys, Array<(event: Event) => void>>;\r\n\r\nconst windowListeners: WindowListenersMap = {\r\n\tresize: [],\r\n\tscroll: [],\r\n\tblur: [],\r\n\tfocus: [],\r\n\tvisibilitychange: [],\r\n\tpointerlockchange: [],\r\n\tbeforeunload: [],\r\n};\r\n\r\nfunction handleEvent(type: WindowEventKeys, event: Event) {\r\n\tconst list = windowListeners[type];\r\n\tif (!list.length) return;\r\n\tfor (const fn of list) {\r\n\t\ttry {\r\n\t\t\tfn(event);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(`[Kabel] Error in window listener for '${type}':`, err);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// auto attach\r\n(Object.keys(windowListeners) as WindowEventKeys[]).forEach((type) => {\r\n\twindow.addEventListener(type, (e) => handleEvent(type, e));\r\n});\r\n\r\nexport function addWindowListener(\r\n\ttype: WindowEventKeys,\r\n\tfn: (event: Event) => void\r\n) {\r\n\twindowListeners[type].push(fn);\r\n}\r\n\r\nexport function removeWindowListener(\r\n\ttype: WindowEventKeys,\r\n\tfn: (event: Event) => void\r\n) {\r\n\tconst list = windowListeners[type];\r\n\tconst i = list.indexOf(fn);\r\n\tif (i !== -1) list.splice(i, 1);\r\n}\r\n\r\nexport function clearWindowListeners(type?: WindowEventKeys) {\r\n\tif (type) windowListeners[type].length = 0;\r\n\telse (Object.keys(windowListeners) as WindowEventKeys[]).forEach((k) => {\r\n\t\twindowListeners[k].length = 0;\r\n\t});\r\n}\r\n\r\nexport default windowListeners;\r\n","type EventHandler<T = any> = (payload: T) => void;\r\n\r\nclass EventEmitter<Events extends Record<string, any>> {\r\n\tprivate listeners: { [K in keyof Events]?: EventHandler<Events[K]>[] } = {};\r\n\r\n\ton<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) this.listeners[event] = [];\r\n\t\tthis.listeners[event]!.push(handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) return this;\r\n\t\tthis.listeners[event] = this.listeners[event]!.filter(h => h !== handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\temit<K extends keyof Events>(event: K, payload: Events[K]) {\r\n\t\tif (!this.listeners[event]) return false;\r\n\t\tthis.listeners[event]!.forEach(handler => handler(payload));\r\n\t\treturn true;\r\n\t}\r\n\r\n\tonce<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tconst wrapper = (payload: Events[K]) => {\r\n\t\t\thandler(payload);\r\n\t\t\tthis.off(event, wrapper);\r\n\t\t};\r\n\t\tthis.on(event, wrapper);\r\n\t\treturn this;\r\n\t}\r\n}\r\nexport default EventEmitter;","import Flyout from \"./flyout\";\r\nimport { InjectOptions, TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport WorkspaceSvg, { WSTheme } from \"./workspace-svg\";\r\nimport Category from \"./category\";\r\n\r\n/**\r\n * Represents the toolbox in a Kabel workspace.\r\n * The toolbox can be either a flyout or a category-based toolbox.\r\n */\r\nclass Toolbox {\r\n    /** Toolbox type: 1 = category toolbox, 2 = flyout toolbox */\r\n    type: 1 | 2;\r\n\r\n    /** Reference to the workspace this toolbox belongs to */\r\n    workspace: WorkspaceSvg;\r\n\r\n    /** Workspace options for initialization */\r\n    wsOptions: InjectOptions;\r\n\r\n    /** Flyout instance for node display */\r\n    _flyout: Flyout;\r\n\r\n    /** Contents of the toolbox (nodes or categories) */\r\n    _contents: TblxNodeStruct[] | TblxCategoryStruct[];\r\n\r\n    /** DOM container element for the toolbox */\r\n    container: HTMLDivElement;\r\n\r\n    /** List of categories (if using a category toolbox) */\r\n    _categories: Category[] = [];\r\n\r\n    /**\r\n     * Creates a new Toolbox instance attached to a workspace.\r\n     * @param workspace The workspace instance to attach this toolbox to\r\n     */\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n        this.wsOptions = this.getOptions();\r\n        this.type = this.wsOptions.toolbox?.type == \"flyout\" ? 2 : 1;\r\n        this._contents = this.wsOptions.toolbox?.contents ?? [];\r\n\r\n        // Pass toolbox reference to flyout\r\n        this._flyout = new Flyout(this);\r\n\r\n        // Create container element\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = \"KabelToolbox\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = \"0\";\r\n        this.container.style.top = \"0\";\r\n        this.container.style.width = \"20%\";\r\n        this.container.style.height = \"100%\";\r\n        this.container.style.background = \"rgba(240,240,240,0.9)\";\r\n        this.container.style.overflowY = \"auto\";\r\n\r\n        // Append to workspace top layer\r\n        workspace._wsTop.appendChild(this.container);\r\n\r\n        // Initialize toolbox depending on type\r\n        if (this.type === 1) this.initCategoryToolbox();\r\n        if (this.type === 2) this.initFlyoutToolbox();\r\n    }\r\n    /**\r\n     * Applies a WSTheme to the toolbox and flyout elements.\r\n     * @param theme The workspace theme to apply\r\n     */\r\n    updateStyles(theme: WSTheme) {\r\n        if (!theme?.UIStyles) return;\r\n\r\n        const { toolboxCategoriesBG, toolboxFlyoutBG } = theme.UIStyles;\r\n\r\n        const applyStyles = (el: HTMLElement, styles?: Partial<CSSStyleDeclaration>) => {\r\n            if (!styles) return;\r\n\r\n            for (const key in styles) {\r\n                const k = key as keyof CSSStyleDeclaration;\r\n                const v = styles[k];\r\n                // Only assign if value exists\r\n                if (v !== undefined) {\r\n                    // cast to any to avoid TS errors\r\n                    (el.style as any)[k] = v;\r\n                }\r\n            }\r\n        };\r\n\r\n        if (this.type === 1) applyStyles(this.container, toolboxCategoriesBG);\r\n        if (this._flyout?.container) applyStyles(this._flyout.container, toolboxFlyoutBG);\r\n    }\r\n\r\n\r\n    /**\r\n     * Retrieves the workspace options.\r\n     * @returns The workspace's InjectOptions\r\n     */\r\n    getOptions() {\r\n        return this.workspace.options;\r\n    }\r\n\r\n    /**\r\n     * Initializes a category-based toolbox.\r\n     * Converts the toolbox contents into Category instances and attaches them.\r\n     */\r\n    initCategoryToolbox() {\r\n        const categories = this._contents as TblxCategoryStruct[];\r\n        categories.forEach(cData => {\r\n            const category = new Category(this, cData);\r\n            this._categories.push(category);\r\n        });\r\n\r\n        // Hide flyout when workspace is clicked\r\n        this.workspace.svg.on(\"click\", () => this._flyout.hide());\r\n    }\r\n\r\n    /**\r\n     * Initializes a flyout toolbox.\r\n     * Fills the flyout with the node definitions from the toolbox contents.\r\n     */\r\n    initFlyoutToolbox() {\r\n        this.container.style.display = \"none\";\r\n        const nodes = this._contents as TblxNodeStruct[];\r\n        this._flyout.fill(nodes);\r\n    }\r\n}\r\n\r\nexport default Toolbox;\r\n","import Workspace from \"./workspace\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\n/**\r\n * Holds a reference to the main WorkspaceSvg instance.\r\n * Mimics Blockly's getMainWorkspace API for Kabel.\r\n */\r\nlet mainws: WorkspaceSvg | Workspace | null = null;\r\n\r\n/**\r\n * Returns the current main workspace instance.\r\n * \r\n * @returns The main WorkspaceSvg or null if none is set.\r\n */\r\nfunction getMainWorkspace(): WorkspaceSvg | Workspace | null {\r\n    return mainws;\r\n}\r\n\r\n/**\r\n * Sets the main workspace reference.\r\n * Calling this updates the global \"main workspace\" for Kabel.\r\n * \r\n * @param ws - The WorkspaceSvg instance to set as main, or null to clear.\r\n * @returns The workspace that was set.\r\n */\r\nfunction setMainWorkspace(ws: WorkspaceSvg | Workspace | null) {\r\n    return (mainws = ws);\r\n}\r\n\r\n/**\r\n * Clears the main workspace reference.\r\n * After calling, getMainWorkspace() will return null.\r\n * \r\n * @returns Always returns null.\r\n */\r\nfunction clearMainWorkspace() {\r\n    return (mainws = null);\r\n}\r\n\r\nexport {\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    clearMainWorkspace\r\n};\r\n\r\n/**\r\n * Note:\r\n * This mimics the Blockly.getMainWorkspace API.\r\n * When you inject a new workspace in Kabel, calling setMainWorkspace\r\n * sets the global main workspace reference, so you can easily retrieve it later.\r\n */\r\n","import { Element, G } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\nconst draggableStore: Record<string, { x: number, y: number }> = {};\r\n\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    let isDragging = false;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    // fallback to element itself if no drag handle is given\r\n    const dragTarget: Element = args.dragel ?? element;\r\n\r\n    // Restore position if previously stored (type 3)\r\n    if (args.type === 3 && args.id && draggableStore[args.id]) {\r\n        const pos = draggableStore[args.id];\r\n        if (pos) element.move(pos.x, pos.y);\r\n    }\r\n\r\n    function onMouseDown(e: MouseEvent) {\r\n        if (args.type === 2 && args.node) {\r\n            const ws : WorkspaceSvg = args.node.workspace;\r\n            if (!ws) return;\r\n\r\n            const start = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const nodePos = args.node.relativeCoords;\r\n\r\n            offsetX = start.x - nodePos.x;\r\n            offsetY = start.y - nodePos.y;\r\n            ws.beginDrag(args.node, start.x, start.y);\r\n            (args.group as G).front();\r\n            \r\n        } else {\r\n            const bbox = element.bbox();\r\n            offsetX = e.clientX - bbox.x;\r\n            offsetY = e.clientY - bbox.y;\r\n        }\r\n\r\n        isDragging = false;\r\n\r\n        // Mark user as dragging\r\n        userState.setState('dragging');\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        if (args.type === 1 && args.ondrag) args.ondrag(e);\r\n    }\r\n\r\n\r\n    function onMouseMove(e: MouseEvent) {\r\n        if (!isDragging) {\r\n            const dx = e.movementX || 0;\r\n            const dy = e.movementY || 0;\r\n            if (Math.abs(dx) > 2 || Math.abs(dy) > 2) isDragging = true;\r\n        }\r\n        if (!isDragging) return;\r\n\r\n        if (args.type === 2 && args.node && args.node instanceof NodeSvg) {\r\n            const ws: WorkspaceSvg = args.node.workspace as WorkspaceSvg;\r\n            if (!ws) return;\r\n\r\n            // Compute new workspace coordinates\r\n            const mouseWS = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const newX = mouseWS.x - offsetX;\r\n            const newY = mouseWS.y - offsetY;\r\n            args.node.relativeCoords.set(newX, newY);\r\n            ws.updateDrag(newX, newY);\r\n            ws.refresh();\r\n            // Move node visually\r\n            const screenPos = ws.workspaceToScreen(newX, newY);\r\n            element.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${ws.getZoom()})` });\r\n            \r\n            args.node.emit('NODE_DRAG', null);\r\n        } else if (args.type === 1 && args.onmove) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            args.onmove({ x: newX, y: newY });\r\n        } else if (args.type === 3 && args.id) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            draggableStore[args.id] = { x: newX, y: newY };\r\n        }\r\n    }\r\n\r\n    function onMouseUp(e: MouseEvent) {\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n\r\n        // Remove dragging state\r\n        userState.removeState('dragging');\r\n\r\n        if (args.type === 1 && args.enddrag) args.enddrag(e);\r\n        if (args.type === 2 && args.node && args.node instanceof NodeSvg) {\r\n            const ws: WorkspaceSvg = args.node.workspace as WorkspaceSvg;\r\n            if (!ws) return;\r\n            ws.emitChange();\r\n            ws.endDrag();\r\n        }\r\n        isDragging = false;\r\n    }\r\n\r\n    dragTarget.node.addEventListener('mousedown', onMouseDown);\r\n\r\n    // cleanup\r\n    return () => {\r\n        dragTarget.node.removeEventListener('mousedown', onMouseDown);\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draggable', initDraggable as EventSetupFn);\r\n","/**\r\n * Delays execution of a callback by a specified number of animation frames.\r\n *\r\n * Uses `requestAnimationFrame` to count frames, then calls the provided callback.\r\n *\r\n * @param {number} frames - The number of animation frames to wait before executing the callback.\r\n * @param {() => void} callback - The function to execute after the specified frames have passed.\r\n */\r\nfunction waitFrames(frames: number, callback: () => void): void {\r\n\tlet count = 0;\r\n\r\n\tfunction step() {\r\n\t\tcount++;\r\n\t\tif (count >= frames) {\r\n\t\t\tcallback();\r\n\t\t} else {\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t}\r\n\t}\r\n\r\n\trequestAnimationFrame(step);\r\n}\r\n\r\nexport default waitFrames;\r\n","import { NodePrototype } from \"./node-types\";\r\n\r\n/**\r\n * A registry of all node prototypes by name.\r\n * Maps a string key (node type name) to a NodePrototype object\r\n */\r\nconst NodePrototypes: { [key: string]: NodePrototype } = {};\r\n\r\nexport default NodePrototypes;\r\n","import { G } from \"@svgdotjs/svg.js\";\r\nimport Field, { AnyField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\n/**\r\n * Allowed owner types for the dropdown container.\r\n * Can be either a NodeSvg or a Field.\r\n */\r\nexport type AllowedOwner = NodeSvg | AnyField;\r\n\r\n/**\r\n * Get absolute position of an HTMLElement relative to the document.\r\n * @param el - The HTML element to measure.\r\n * @returns The bounding box with scroll offset.\r\n */\r\nfunction getAbsolutePosition(el: HTMLElement) {\r\n    const rect = el.getBoundingClientRect();\r\n    return {\r\n        x: rect.left + window.scrollX,\r\n        y: rect.top + window.scrollY,\r\n        width: rect.width,\r\n        height: rect.height,\r\n    };\r\n}\r\n\r\n/**\r\n * Options for creating a dropdown menu.\r\n */\r\nexport interface DropdownOptions {\r\n    /** List of items to display in the dropdown */\r\n    items: { label: string; value: string }[];\r\n    /** Callback when an item is selected */\r\n    onSelect?: (value: string, item: { label: string; value: string }) => void;\r\n    /** Optional fixed width of the dropdown */\r\n    width?: number;\r\n}\r\n\r\n/**\r\n * Dropdown container for NodeSvg or Field elements.\r\n * Supports singleton behavior (only one dropdown visible at a time).\r\n */\r\nclass DropdownContainer {\r\n    private static current: DropdownContainer | null = null;\r\n    private owner: AllowedOwner | null = null;\r\n    private rootEl: HTMLDivElement;\r\n    private options: DropdownOptions | null = null;\r\n    private constraint: { x: number; y: number; width: number; height: number };\r\n    private offset: { dx: number; dy: number };\r\n    private currentRemoveListener: (() => void) | null = null;\r\n    /**\r\n     * Creates the dropdown container and attaches it to the DOM.\r\n     */\r\n    constructor() {\r\n        this.rootEl = document.createElement(\"div\");\r\n        this.rootEl.className = \"KabelDropdownMenu\";\r\n        this.rootEl.style.position = \"absolute\";\r\n        this.rootEl.style.display = \"none\";\r\n        document.body.appendChild(this.rootEl);\r\n\r\n        this.constraint = { x: 0, y: 0, width: 0, height: 0 };\r\n        this.offset = { dx: 0, dy: 0 };\r\n    }\r\n\r\n    /**\r\n     * Move the dropdown by an offset.\r\n     * @param dx - horizontal offset\r\n     * @param dy - vertical offset\r\n     */\r\n    move(dx: number, dy: number) {\r\n        this.offset.dx = dx;\r\n        this.offset.dy = dy;\r\n        this.updatePosition();\r\n    }\r\n\r\n    /**\r\n     * Update the dropdown position based on constraint and offset.\r\n     */\r\n    private updatePosition() {\r\n        const { x, y, height } = this.constraint;\r\n        const { dx, dy } = this.offset;\r\n        this.rootEl.style.left = `${x + dx}px`;\r\n        this.rootEl.style.top = `${y + height + dy}px`; // anchored below\r\n    }\r\n\r\n    /**\r\n     * Set inner HTML content of the dropdown.\r\n     * @param html - HTML string\r\n     */\r\n    setContent(html: string) {\r\n        this.rootEl.innerHTML = html;\r\n    }\r\n\r\n    /**\r\n     * Append an element as a child to the dropdown.\r\n     * @param element - Element to append\r\n     * @returns The appended element\r\n     */\r\n    appendChild(element: Element) {\r\n        this.rootEl.appendChild(element);\r\n        return element;\r\n    }\r\n\r\n    /**\r\n     * Show the dropdown for a given owner.\r\n     * @param owner - NodeSvg or Field that owns this dropdown\r\n     * @param options - Dropdown configuration options\r\n     */\r\n    show(owner: AllowedOwner, options: DropdownOptions) {\r\n        if (!owner.svgGroup) return;\r\n        this.hide(); // close existing dropdown first\r\n        this.owner = owner;\r\n        if (options) this.options = options;\r\n        if (this.currentRemoveListener) this.currentRemoveListener();\r\n        this.currentRemoveListener = null;\r\n        const groupRect = owner.svgGroup.node.getBoundingClientRect();\r\n        this.constraint = {\r\n            x: groupRect.left + window.scrollX,\r\n            y: groupRect.top + window.scrollY,\r\n            width: groupRect.width,\r\n            height: groupRect.height,\r\n        };\r\n\r\n        this.offset = { dx: 0, dy: 0 };\r\n\r\n        this.rootEl.innerHTML = \"\";\r\n        if (options.width) this.rootEl.style.width = `${options.width}px`;\r\n        this.rootEl.style.display = \"block\";\r\n\r\n        // Render items\r\n        if (options.items) {\r\n            options.items.forEach((item) => {\r\n                const el = document.createElement(\"div\");\r\n                el.className = \"KabelDropdownItem\";\r\n                el.textContent = item.label;\r\n                el.onclick = () => {\r\n                    options.onSelect?.(item.value, item);\r\n                    this.hide();\r\n                };\r\n                this.rootEl.appendChild(el);\r\n            });\r\n        }\r\n        if (owner instanceof NodeSvg) {\r\n            // Add a move listener to the node's workspace.\r\n            const ws = owner.workspace;\r\n            let remove = ws?.addMoveListener(() => {\r\n                if (this.owner !== owner) {\r\n                    remove!(); // disconnect when owner changes.\r\n                    return;\r\n                }\r\n                this.hideIfOwner(owner)\r\n            });\r\n            this.currentRemoveListener = remove as () => void;\r\n        }\r\n        if (owner instanceof Field) {\r\n            // Add a move listener to the field's workspace.\r\n            const ws = owner.node!.workspace;\r\n            let remove = ws?.addMoveListener(() => {\r\n                if (this.owner !== owner) {\r\n                    console.log(\"Disconnecting..\");\r\n                    remove!(); // disconnect when owner changes.\r\n                    return;\r\n                }\r\n                console.log(\"Hiding..\");\r\n                this.hide();\r\n            });\r\n            this.currentRemoveListener = remove as () => void;\r\n        }\r\n        this.updatePosition();\r\n        DropdownContainer.current = this;\r\n    }\r\n\r\n    /**\r\n     * Hide this dropdown.\r\n     */\r\n    hide() {\r\n        if (DropdownContainer.current !== this) return;\r\n        this.rootEl.style.display = \"none\";\r\n        this.rootEl.innerHTML = \"\";\r\n        this.owner = null;\r\n        this.options = null;\r\n        DropdownContainer.current = null;\r\n        if (this.currentRemoveListener) this.currentRemoveListener();\r\n        this.currentRemoveListener = null;\r\n    }\r\n\r\n    /**\r\n     * Hide this dropdown if the given owner currently owns it.\r\n     * @param owner - The owner to check\r\n     */\r\n    hideIfOwner(owner: AllowedOwner) {\r\n        if (this.owner === owner) {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    /** @returns True if the dropdown is currently visible */\r\n    isVisible(): boolean {\r\n        return DropdownContainer.current === this;\r\n    }\r\n\r\n    /** @returns The current owner of the dropdown, or null if none */\r\n    getOwner(): AllowedOwner | null {\r\n        return this.owner;\r\n    }\r\n\r\n    /** @returns The currently visible dropdown container singleton */\r\n    static getCurrent(): DropdownContainer | null {\r\n        return DropdownContainer.current;\r\n    }\r\n}\r\n\r\n// Singleton export\r\nconst dropdownContainer = new DropdownContainer();\r\nexport default dropdownContainer;\r\nexport { DropdownContainer };\r\n","import { WidgetOptions } from \"./widget\";\r\n\r\n/**\r\n * A list of prototypes for widgets.\r\n */\r\nexport interface WidgetPrototypeList {\r\n    [key: string]: WidgetOptions\r\n}\r\n\r\nconst WidgetPrototypes: WidgetPrototypeList = {};\r\nexport default WidgetPrototypes;","import { Element } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport CommentModel from '../src/comment';\r\n\r\n/** The drag handle for comments */\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    const comment = args.comment as CommentModel;\r\n    if (!comment) return () => { };\r\n\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let startRelX = 0;\r\n    let startRelY = 0;\r\n\r\n    function onPointerDown(ev: PointerEvent) {\r\n        ev.preventDefault();\r\n\r\n        const ws = comment.getWorkspace();\r\n        const rel = comment.relativeCoords;\r\n\r\n        // Capture offset from pointer to comment in workspace coords\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n        startRelX = rel.x - pointerWS.x;\r\n        startRelY = rel.y - pointerWS.y;\r\n\r\n        document.addEventListener('pointermove', onPointerMove);\r\n        document.addEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    function onPointerMove(ev: PointerEvent) {\r\n        const ws = comment.getWorkspace();\r\n\r\n        // Map pointer to workspace\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n\r\n        // Add initial offset\r\n        comment.relativeCoords.set(pointerWS.x + startRelX, pointerWS.y + startRelY);\r\n\r\n        ws.refreshComments();\r\n    }\r\n\r\n\r\n\r\n    function onPointerUp() {\r\n        document.removeEventListener('pointermove', onPointerMove);\r\n        document.removeEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    element.node.addEventListener('pointerdown', onPointerDown);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n        element.node.removeEventListener('pointerdown', onPointerDown);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draghandle', initDraggable as EventSetupFn);\r\n","import { Svg, Rect, Circle, G, Path, Element } from '@svgdotjs/svg.js';\r\n\r\nexport type EventType = string;\r\nexport type EventArgs = Record<string, any>;\r\nexport type EventSetupFn = (el: Element, args?: EventArgs) => (() => void) | void;\r\n\r\nexport interface RegisteredEl {\r\n    tags: string[],\r\n    el: Element;\r\n    type: EventType;\r\n    args?: EventArgs | undefined;      // allow undefined explicitly\r\n    destroyFn?: (() => void) | undefined; // allow undefined explicitly\r\n}\r\n\r\n/**\r\n * Used by the Kabel renderer to tag svg.js elements as interactable with the kabel system.\r\n */\r\nclass Eventer {\r\n    private elements: RegisteredEl[] = [];\r\n    private eventRegistry: Map<EventType, EventSetupFn> = new Map();\r\n\r\n    // Register an event type with a setup function\r\n    registerEvent(type: EventType, setupFn: EventSetupFn) {\r\n        this.eventRegistry.set(type, setupFn);\r\n        return this; // allow chaining\r\n    }\r\n    tagElement(el: Element, tags?: string[] | string) {\r\n        if (!tags) return this;\r\n        const tagList = Array.isArray(tags) ? tags : [tags];\r\n\r\n        // Find the registered elements for this el\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el) {\r\n                for (const t of tagList) {\r\n                    if (!reg.tags.includes(t)) reg.tags.push(t);\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    destroyByTag(tag: string) {\r\n        let destroyed = false;\r\n        this.elements = this.elements.filter(reg => {\r\n            if (reg.tags.includes(tag)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                return false; // remove this element\r\n            }\r\n            return true; // keep element\r\n        });\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    // addElement\r\n    addElement(el: Element, types: EventType | EventType[], args?: EventArgs) {\r\n        const typeList = Array.isArray(types) ? types : [types];\r\n        for (const type of typeList) {\r\n            const destroyFn = this.setupElement(el, type, args) as (() => void) | undefined;\r\n            this.elements.push({\r\n                tags: [],\r\n                el,\r\n                type,\r\n                args,\r\n                destroyFn\r\n            });\r\n        }\r\n        return this;\r\n    }\r\n\r\n    // refresh\r\n    refresh() {\r\n        for (const reg of this.elements) {\r\n            if (reg.destroyFn) reg.destroyFn();\r\n            reg.destroyFn = this.setupElement(reg.el, reg.type, reg.args) as (() => void) | undefined;\r\n        }\r\n    }\r\n\r\n\r\n    // Destroy event(s) for an element\r\n    destroyElement(el: Element, type?: EventType) {\r\n        let destroyed = false;\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el && (!type || reg.type === type)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                // Remove from elements array\r\n                this.elements = this.elements.filter(r => r !== reg);\r\n            }\r\n        }\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    private setupElement(el: Element, type: EventType, args?: EventArgs): (() => void) | undefined {\r\n        const setupFn = this.eventRegistry.get(type);\r\n        if (!setupFn) return;\r\n        const destroyFn = setupFn(el, args);\r\n        return destroyFn instanceof Function ? destroyFn : undefined;\r\n    }\r\n}\r\n\r\nconst eventer = new Eventer();\r\nexport default eventer;\r\nexport { Eventer };\r\n","// Convert an arc to a sequence of cubic bzier curves\n//\n'use strict';\n\n\nvar TAU = Math.PI * 2;\n\n\n/* eslint-disable space-infix-ops */\n\n// Calculate an angle between two unit vectors\n//\n// Since we measure angle between radii of circular arcs,\n// we can use simplified math (without length normalization)\n//\nfunction unit_vector_angle(ux, uy, vx, vy) {\n  var sign = (ux * vy - uy * vx < 0) ? -1 : 1;\n  var dot  = ux * vx + uy * vy;\n\n  // Add this to work with arbitrary vectors:\n  // dot /= Math.sqrt(ux * ux + uy * uy) * Math.sqrt(vx * vx + vy * vy);\n\n  // rounding errors, e.g. -1.0000000000000002 can screw up this\n  if (dot >  1.0) { dot =  1.0; }\n  if (dot < -1.0) { dot = -1.0; }\n\n  return sign * Math.acos(dot);\n}\n\n\n// Convert from endpoint to center parameterization,\n// see http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n//\n// Return [cx, cy, theta1, delta_theta]\n//\nfunction get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi) {\n  // Step 1.\n  //\n  // Moving an ellipse so origin will be the middlepoint between our two\n  // points. After that, rotate it to line up ellipse axes with coordinate\n  // axes.\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  var rx_sq  =  rx * rx;\n  var ry_sq  =  ry * ry;\n  var x1p_sq = x1p * x1p;\n  var y1p_sq = y1p * y1p;\n\n  // Step 2.\n  //\n  // Compute coordinates of the centre of this ellipse (cx', cy')\n  // in the new coordinate system.\n  //\n  var radicant = (rx_sq * ry_sq) - (rx_sq * y1p_sq) - (ry_sq * x1p_sq);\n\n  if (radicant < 0) {\n    // due to rounding errors it might be e.g. -1.3877787807814457e-17\n    radicant = 0;\n  }\n\n  radicant /=   (rx_sq * y1p_sq) + (ry_sq * x1p_sq);\n  radicant = Math.sqrt(radicant) * (fa === fs ? -1 : 1);\n\n  var cxp = radicant *  rx/ry * y1p;\n  var cyp = radicant * -ry/rx * x1p;\n\n  // Step 3.\n  //\n  // Transform back to get centre coordinates (cx, cy) in the original\n  // coordinate system.\n  //\n  var cx = cos_phi*cxp - sin_phi*cyp + (x1+x2)/2;\n  var cy = sin_phi*cxp + cos_phi*cyp + (y1+y2)/2;\n\n  // Step 4.\n  //\n  // Compute angles (theta1, delta_theta).\n  //\n  var v1x =  (x1p - cxp) / rx;\n  var v1y =  (y1p - cyp) / ry;\n  var v2x = (-x1p - cxp) / rx;\n  var v2y = (-y1p - cyp) / ry;\n\n  var theta1 = unit_vector_angle(1, 0, v1x, v1y);\n  var delta_theta = unit_vector_angle(v1x, v1y, v2x, v2y);\n\n  if (fs === 0 && delta_theta > 0) {\n    delta_theta -= TAU;\n  }\n  if (fs === 1 && delta_theta < 0) {\n    delta_theta += TAU;\n  }\n\n  return [ cx, cy, theta1, delta_theta ];\n}\n\n//\n// Approximate one unit arc segment with bzier curves,\n// see http://math.stackexchange.com/questions/873224\n//\nfunction approximate_unit_arc(theta1, delta_theta) {\n  var alpha = 4/3 * Math.tan(delta_theta/4);\n\n  var x1 = Math.cos(theta1);\n  var y1 = Math.sin(theta1);\n  var x2 = Math.cos(theta1 + delta_theta);\n  var y2 = Math.sin(theta1 + delta_theta);\n\n  return [ x1, y1, x1 - y1*alpha, y1 + x1*alpha, x2 + y2*alpha, y2 - x2*alpha, x2, y2 ];\n}\n\nmodule.exports = function a2c(x1, y1, x2, y2, fa, fs, rx, ry, phi) {\n  var sin_phi = Math.sin(phi * TAU / 360);\n  var cos_phi = Math.cos(phi * TAU / 360);\n\n  // Make sure radii are valid\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  if (x1p === 0 && y1p === 0) {\n    // we're asked to draw line to itself\n    return [];\n  }\n\n  if (rx === 0 || ry === 0) {\n    // one of the radii is zero\n    return [];\n  }\n\n\n  // Compensate out-of-range radii\n  //\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n\n  var lambda = (x1p * x1p) / (rx * rx) + (y1p * y1p) / (ry * ry);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n\n  // Get center parameters (cx, cy, theta1, delta_theta)\n  //\n  var cc = get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi);\n\n  var result = [];\n  var theta1 = cc[2];\n  var delta_theta = cc[3];\n\n  // Split an arc to multiple segments, so each segment\n  // will be less than /4 (= 90)\n  //\n  var segments = Math.max(Math.ceil(Math.abs(delta_theta) / (TAU / 4)), 1);\n  delta_theta /= segments;\n\n  for (var i = 0; i < segments; i++) {\n    result.push(approximate_unit_arc(theta1, delta_theta));\n    theta1 += delta_theta;\n  }\n\n  // We have a bezier approximation of a unit circle,\n  // now need to transform back to the original ellipse\n  //\n  return result.map(function (curve) {\n    for (var i = 0; i < curve.length; i += 2) {\n      var x = curve[i + 0];\n      var y = curve[i + 1];\n\n      // scale\n      x *= rx;\n      y *= ry;\n\n      // rotate\n      var xp = cos_phi*x - sin_phi*y;\n      var yp = sin_phi*x + cos_phi*y;\n\n      // translate\n      curve[i + 0] = xp + cc[0];\n      curve[i + 1] = yp + cc[1];\n    }\n\n    return curve;\n  });\n};\n","'use strict';\n\nmodule.exports = require('./lib/svgpath');\n","/**\r\n * Kabel Core Export Module\r\n * ------------------------\r\n * Aggregates all core Kabel modules, types, utilities, and components,\r\n * and exports them under a single namespace.\r\n */\r\n\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport Renderer, { DrawState, ConnectorToFrom } from \"../renderers/renderer\";\r\nimport CategoryColors from \"./colors\";\r\nimport Connection, { Connectable } from \"./connection\";\r\nimport Coordinates from \"./coordinates\";\r\nimport Field, { \r\n    FieldOptions, FieldVisualInfo, AnyFieldCls, AnyField, DummyField, \r\n    FieldMap, NumberField, OptConnectField, TextField, ConnectableField, \r\n    FieldRawBoxData, FieldConnectionData \r\n} from \"./field\";\r\nimport inject, { \r\n    InjectMsg, InjectOptions, TblxCategoryStruct, TblxObjStruct, \r\n    TblxFieldStruct, TblxNodeStruct, GridOptions\r\n} from \"./inject\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport NodeSvg, { NodeJson, NodeEvents, InputFieldJson, SerializedNode } from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport WorkspaceCoords from \"./workspace-coords\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport eventer, { Eventer,  EventSetupFn, EventArgs, RegisteredEl } from \"../util/eventer\";\r\nimport hasProp from \"../util/has-prop\";\r\nimport EventEmitter from \"../util/emitter\";\r\nimport * as Path from \"../util/path\";\r\nimport * as SVG from \"@svgdotjs/svg.js\";\r\nimport * as UID from \"../util/uid\";\r\n\r\nimport K from \"./core\";\r\nimport Widget, { WidgetOptions } from \"./widget\";\r\nimport { WidgetPrototypeList } from \"./widget-prototypes\";\r\nimport Showable, { KabelInterface, KabelCommentRendering, KabelNodeRendering, KabelUIX, KabelUtils } from \"./types\";\r\n\r\n//@ts-ignore\r\nconst Kabel: KabelInterface = K;\r\nexport default Kabel;\r\n\r\n// Core types and utilities\r\nexport {\r\n    KabelInterface,\r\n    TblxCategoryStruct,\r\n    TblxNodeStruct,\r\n    TblxFieldStruct,\r\n    TblxObjStruct,\r\n    RendererConstants,\r\n    Renderer,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    ConnectableField,\r\n    FieldRawBoxData,\r\n    FieldConnectionData,\r\n    inject,\r\n    InjectMsg,\r\n    InjectOptions,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    NodePrototypes,\r\n    WorkspaceSvg,\r\n    WorkspaceCoords,\r\n    NodePrototype,\r\n    Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple,\r\n    NodeJson, NodeEvents, InputFieldJson,\r\n    SerializedNode,\r\n    Eventer,\r\n    EventSetupFn,\r\n    EventArgs,\r\n    Connectable,\r\n    DrawState,\r\n    ConnectorToFrom,\r\n    WidgetOptions,\r\n    WidgetPrototypeList,\r\n    KabelCommentRendering,\r\n    KabelNodeRendering,\r\n    KabelUIX,\r\n    KabelUtils,\r\n    Showable,\r\n    RegisteredEl,\r\n    GridOptions\r\n};\r\n\r\n// Core classes used by public API\r\nexport { default as CommentModel } from './comment';\r\n\r\nexport { default as Toolbox } from './toolbox';\r\nexport { default as ContextMenuHTML } from './context-menu';\r\nexport { default as Widget } from './widget';\r\nexport {  DropdownContainer } from './dropdown-menu';\r\nexport { RepresenterNode } from '../renderers/representer-node';\r\nexport { default as CommentRenderer } from '../comment-renderer/renderer';\r\nexport { default as Representer } from '../renderers/representer';\r\n\r\n// Controllers\r\nexport { default as WorkspaceController } from '../controllers/base';\r\nexport { default as WASDController } from '../controllers/wasd';\r\n","/**\r\n * Represents a 2D coordinate in space.\r\n */\r\nclass Coordinates {\r\n\t/** X position */\r\n\tx: number;\r\n\t/** Y position */\r\n\ty: number;\r\n\r\n\t/**\r\n\t * Creates a new Coordinates instance\r\n\t * @param x - The x value (default 0)\r\n\t * @param y - The y value (default 0)\r\n\t */\r\n\tconstructor(x: number = 0, y: number = 0) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the coordinates to new values\r\n\t * @param x - The new x value\r\n\t * @param y - The new y value\r\n\t */\r\n\tset(x: number, y: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this coordinate\r\n\t * @returns A new Coordinates instance with the same x and y\r\n\t */\r\n\tclone(): Coordinates {\r\n\t\treturn new Coordinates(this.x, this.y);\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the Euclidean distance to another coordinate\r\n\t * @param other - The target coordinate\r\n\t * @returns The distance as a number\r\n\t */\r\n\tdistanceTo(other: Coordinates): number {\r\n\t\tconst dx = this.x - other.x;\r\n\t\tconst dy = this.y - other.y;\r\n\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to a string representation\r\n\t * @returns A string like \"(x, y)\"\r\n\t */\r\n\ttoString(): string {\r\n\t\treturn `(${this.x}, ${this.y})`;\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to an array [x, y]\r\n\t * @returns Tuple of numbers [x, y]\r\n\t */\r\n\ttoArray(): [number, number] {\r\n\t\treturn [this.x, this.y];\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to an object { x, y }\r\n\t * @returns Object with x and y properties\r\n\t */\r\n\ttoObject(): { x: number; y: number } {\r\n\t\treturn { x: this.x, y: this.y };\r\n\t}\r\n}\r\n\r\nexport default Coordinates;\r\n","import { Color, Hex } from \"../src/visual-types\";\r\n\r\nclass RendererConstants {\r\n    CORNER_RADIUS!: number;\r\n    NODE_BASE_WIDTH!: number;\r\n    NODE_BASE_HEIGHT!: number;\r\n    TOPBAR_HEIGHT!: number;\r\n    FOOTER_HEIGHT!: number;\r\n    PADDING_BIG!: number;\r\n    PADDING_MEDIUM!: number;\r\n    PADDING_SMALL!: number;\r\n    FIELD_SPACEY!: number;\r\n    FIELD_SPACEX!: number;\r\n    FIELD_RAW_BASE_WIDTH!: number;\r\n    FIELD_RAW_BASE_HEIGHT!: number;\r\n    INPUT_BOX_PADDING!: number;\r\n    INPUT_BOX_TEXT_ANCHOR!: 'start' | 'middle';\r\n    LABEL_SPACING!: number;\r\n\r\n    FIELD_RAW_COLOR: Color = '#2b2d36ff';\r\n    FIELD_RAW_TEXT_COLOR: Color = '#e0e2e8ff';\r\n    FIELD_RAW_OUTLINE_COLOR: Color = '#1f2027ff';\r\n    FIELD_RAW_OUTLINE_STROKE!: number;\r\n    FIELD_CONN_COLOR: Color = '#0c7cccff'\r\n    NODE_BG_COLOR: Color = '#2c2d3aff';\r\n    NODE_OUTLINE_COLOR: Color = '#1d1e25ff';\r\n    CONNECTOR_TRIANGLE!: boolean;\r\n    CONNECTION_STROKE_WIDTH!: number;\r\n    CONNECTION_STROKE_COLOR_CHOICE!: number;\r\n    CONNECTOR_TRI_SIZE!: number;\r\n    CONNECTOR_RADIUS!: number;\r\n    FONT_FAMILY: string =\r\n        '\"Inter\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif';\r\n    FONT_SIZE!: number;\r\n    FONT_COLOR: Color = '#e0e2e8ff';\r\n\r\n    FIELD_MARGIN_X!: number;\r\n    FIELD_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_MARGIN_X!: number;\r\n    TOPBAR_LABEL_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_BOLDED!: boolean;\r\n    CONNECTOR_LINE_WIDTH: number = 6;\r\n    CONNECTOR_LINE_CURVED: boolean = true;\r\n    ZOOM_BASE: number = 1; // default scale factor for workspace\r\n\r\n    SHAPES: {\r\n        [key: string]: {\r\n            PathMain: string;\r\n            Width: number;\r\n            Height: number;\r\n        }\r\n    } = {}\r\n    constructor(overrides: Partial<RendererConstants> = {}) {\r\n        this.CONNECTOR_TRI_SIZE = 8;\r\n        this.CONNECTOR_RADIUS = 10;\r\n        this.CORNER_RADIUS = 6;\r\n        this.NODE_BASE_WIDTH = 200;\r\n        this.NODE_BASE_HEIGHT = 240;\r\n\r\n        this.TOPBAR_HEIGHT = 50;\r\n        this.FOOTER_HEIGHT = 25;\r\n        this.PADDING_BIG = 16;\r\n        this.PADDING_MEDIUM = 8;\r\n        this.PADDING_SMALL = 4;\r\n        this.FIELD_RAW_BASE_WIDTH = 80;\r\n        this.FIELD_RAW_BASE_HEIGHT = 42;\r\n        this.INPUT_BOX_PADDING = 6;\r\n        this.LABEL_SPACING = 5;\r\n        this.INPUT_BOX_TEXT_ANCHOR = 'middle';\r\n        this.CONNECTOR_TRIANGLE = false;\r\n        this.CONNECTION_STROKE_WIDTH = 2;\r\n        this.CONNECTION_STROKE_COLOR_CHOICE = 1;\r\n        this.FIELD_RAW_OUTLINE_STROKE = 2;\r\n        this.FIELD_SPACEY = 20;\r\n        this.FIELD_SPACEX = 20;\r\n        this.FONT_SIZE = 20;\r\n        this.TOPBAR_LABEL_BOLDED = true;\r\n        this.FIELD_MARGIN_X = 16;\r\n        this.FIELD_MARGIN_Y = 16;\r\n        this.TOPBAR_LABEL_MARGIN_X = 12;\r\n        this.TOPBAR_LABEL_MARGIN_Y = 0;\r\n\r\n        Object.assign(this, overrides);\r\n    }\r\n}\r\n\r\nexport default RendererConstants;\r\n","// SVG Path transformations library\n//\n// Usage:\n//\n//    SvgPath('...')\n//      .translate(-150, -100)\n//      .scale(0.5)\n//      .translate(-150, -100)\n//      .toFixed(1)\n//      .toString()\n//\n\n'use strict';\n\n\nvar pathParse      = require('./path_parse');\nvar transformParse = require('./transform_parse');\nvar matrix         = require('./matrix');\nvar a2c            = require('./a2c');\nvar ellipse        = require('./ellipse');\n\n\n// Class constructor\n//\nfunction SvgPath(path) {\n  if (!(this instanceof SvgPath)) { return new SvgPath(path); }\n\n  var pstate = pathParse(path);\n\n  // Array of path segments.\n  // Each segment is array [command, param1, param2, ...]\n  this.segments = pstate.segments;\n\n  // Error message on parse error.\n  this.err      = pstate.err;\n\n  // Transforms stack for lazy evaluation\n  this.__stack    = [];\n}\n\nSvgPath.from = function (src) {\n  if (typeof src === 'string') return new SvgPath(src);\n\n  if (src instanceof SvgPath) {\n    // Create empty object\n    var s = new SvgPath('');\n\n    // Clone properies\n    s.err = src.err;\n    s.segments = src.segments.map(function (sgm) { return sgm.slice(); });\n    s.__stack = src.__stack.map(function (m) {\n      return matrix().matrix(m.toArray());\n    });\n\n    return s;\n  }\n\n  throw new Error('SvgPath.from: invalid param type ' + src);\n};\n\n\nSvgPath.prototype.__matrix = function (m) {\n  var self = this, i;\n\n  // Quick leave for empty matrix\n  if (!m.queue.length) { return; }\n\n  this.iterate(function (s, index, x, y) {\n    var p, result, name, isRelative;\n\n    switch (s[0]) {\n\n      // Process 'assymetric' commands separately\n      case 'v':\n        p      = m.calc(0, s[1], true);\n        result = (p[0] === 0) ? [ 'v', p[1] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'V':\n        p      = m.calc(x, s[1], false);\n        result = (p[0] === m.calc(x, y, false)[0]) ? [ 'V', p[1] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'h':\n        p      = m.calc(s[1], 0, true);\n        result = (p[1] === 0) ? [ 'h', p[0] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'H':\n        p      = m.calc(s[1], y, false);\n        result = (p[1] === m.calc(x, y, false)[1]) ? [ 'H', p[0] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'a':\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n\n        // Drop segment if arc is empty (end point === start point)\n        /*if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          return [];\n        }*/\n\n        // Transform rx, ry and the x-axis-rotation\n        var ma = m.toArray();\n        var e = ellipse(s[1], s[2], s[3]).transform(ma);\n\n        // flip sweep-flag if matrix is not orientation-preserving\n        if (ma[0] * ma[3] - ma[1] * ma[2] < 0) {\n          s[5] = s[5] ? '0' : '1';\n        }\n\n        // Transform end point as usual (without translation for relative notation)\n        p = m.calc(s[6], s[7], s[0] === 'a');\n\n        // Empty arcs can be ignored by renderer, but should not be dropped\n        // to avoid collisions with `S A S` and so on. Replace with empty line.\n        if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n          break;\n        }\n\n        // if the resulting ellipse is (almost) a segment ...\n        if (e.isDegenerate()) {\n          // replace the arc by a line\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n        } else {\n          // if it is a real ellipse\n          // s[0], s[4] and s[5] are not modified\n          result = [ s[0], e.rx, e.ry, e.ax, s[4], s[5], p[0], p[1] ];\n        }\n\n        break;\n\n      case 'm':\n        // Edge case. The very first `m` should be processed as absolute, if happens.\n        // Make sense for coord shift transforms.\n        isRelative = index > 0;\n\n        p = m.calc(s[1], s[2], isRelative);\n        result = [ 'm', p[0], p[1] ];\n        break;\n\n      default:\n        name       = s[0];\n        result     = [ name ];\n        isRelative = (name.toLowerCase() === name);\n\n        // Apply transformations to the segment\n        for (i = 1; i < s.length; i += 2) {\n          p = m.calc(s[i], s[i + 1], isRelative);\n          result.push(p[0], p[1]);\n        }\n    }\n\n    self.segments[index] = result;\n  }, true);\n};\n\n\n// Apply stacked commands\n//\nSvgPath.prototype.__evaluateStack = function () {\n  var m, i;\n\n  if (!this.__stack.length) { return; }\n\n  if (this.__stack.length === 1) {\n    this.__matrix(this.__stack[0]);\n    this.__stack = [];\n    return;\n  }\n\n  m = matrix();\n  i = this.__stack.length;\n\n  while (--i >= 0) {\n    m.matrix(this.__stack[i].toArray());\n  }\n\n  this.__matrix(m);\n  this.__stack = [];\n};\n\n\n// Convert processed SVG Path back to string\n//\nSvgPath.prototype.toString = function () {\n  var result = '', prevCmd = '', cmdSkipped = false;\n\n  this.__evaluateStack();\n\n  for (var i = 0, len = this.segments.length; i < len; i++) {\n    var segment = this.segments[i];\n    var cmd = segment[0];\n\n    // Command not repeating => store\n    if (cmd !== prevCmd || cmd === 'm' || cmd === 'M') {\n      // workaround for FontForge SVG importing bug, keep space between \"z m\".\n      if (cmd === 'm' && prevCmd === 'z') result += ' ';\n      result += cmd;\n\n      cmdSkipped = false;\n    } else {\n      cmdSkipped = true;\n    }\n\n    // Store segment params\n    for (var pos = 1; pos < segment.length; pos++) {\n      var val = segment[pos];\n      // Space can be skipped\n      // 1. After command (always)\n      // 2. For negative value (with '-' at start)\n      if (pos === 1) {\n        if (cmdSkipped && val >= 0) result += ' ';\n      } else if (val >= 0) result += ' ';\n\n      result += val;\n    }\n\n    prevCmd = cmd;\n  }\n\n  return result;\n};\n\n\n// Translate path to (x [, y])\n//\nSvgPath.prototype.translate = function (x, y) {\n  this.__stack.push(matrix().translate(x, y || 0));\n  return this;\n};\n\n\n// Scale path to (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.scale = function (sx, sy) {\n  this.__stack.push(matrix().scale(sx, (!sy && (sy !== 0)) ? sx : sy));\n  return this;\n};\n\n\n// Rotate path around point (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.rotate = function (angle, rx, ry) {\n  this.__stack.push(matrix().rotate(angle, rx || 0, ry || 0));\n  return this;\n};\n\n\n// Skew path along the X axis by `degrees` angle\n//\nSvgPath.prototype.skewX = function (degrees) {\n  this.__stack.push(matrix().skewX(degrees));\n  return this;\n};\n\n\n// Skew path along the Y axis by `degrees` angle\n//\nSvgPath.prototype.skewY = function (degrees) {\n  this.__stack.push(matrix().skewY(degrees));\n  return this;\n};\n\n\n// Apply matrix transform (array of 6 elements)\n//\nSvgPath.prototype.matrix = function (m) {\n  this.__stack.push(matrix().matrix(m));\n  return this;\n};\n\n\n// Transform path according to \"transform\" attr of SVG spec\n//\nSvgPath.prototype.transform = function (transformString) {\n  if (!transformString.trim()) {\n    return this;\n  }\n  this.__stack.push(transformParse(transformString));\n  return this;\n};\n\n\n// Round coords with given decimal precition.\n// 0 by default (to integers)\n//\nSvgPath.prototype.round = function (d) {\n  var contourStartDeltaX = 0, contourStartDeltaY = 0, deltaX = 0, deltaY = 0, l;\n\n  d = d || 0;\n\n  this.__evaluateStack();\n\n  this.segments.forEach(function (s) {\n    var isRelative = (s[0].toLowerCase() === s[0]);\n\n    switch (s[0]) {\n      case 'H':\n      case 'h':\n        if (isRelative) { s[1] += deltaX; }\n        deltaX = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'V':\n      case 'v':\n        if (isRelative) { s[1] += deltaY; }\n        deltaY = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'Z':\n      case 'z':\n        deltaX = contourStartDeltaX;\n        deltaY = contourStartDeltaY;\n        return;\n\n      case 'M':\n      case 'm':\n        if (isRelative) {\n          s[1] += deltaX;\n          s[2] += deltaY;\n        }\n\n        deltaX = s[1] - s[1].toFixed(d);\n        deltaY = s[2] - s[2].toFixed(d);\n\n        contourStartDeltaX = deltaX;\n        contourStartDeltaY = deltaY;\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        return;\n\n      case 'A':\n      case 'a':\n        // [cmd, rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        if (isRelative) {\n          s[6] += deltaX;\n          s[7] += deltaY;\n        }\n\n        deltaX = s[6] - s[6].toFixed(d);\n        deltaY = s[7] - s[7].toFixed(d);\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        s[3] = +s[3].toFixed(d + 2); // better precision for rotation\n        s[6] = +s[6].toFixed(d);\n        s[7] = +s[7].toFixed(d);\n        return;\n\n      default:\n        // a c l q s t\n        l = s.length;\n\n        if (isRelative) {\n          s[l - 2] += deltaX;\n          s[l - 1] += deltaY;\n        }\n\n        deltaX = s[l - 2] - s[l - 2].toFixed(d);\n        deltaY = s[l - 1] - s[l - 1].toFixed(d);\n\n        s.forEach(function (val, i) {\n          if (!i) { return; }\n          s[i] = +s[i].toFixed(d);\n        });\n        return;\n    }\n  });\n\n  return this;\n};\n\n\n// Apply iterator function to all segments. If function returns result,\n// current segment will be replaced to array of returned segments.\n// If empty array is returned, current regment will be deleted.\n//\nSvgPath.prototype.iterate = function (iterator, keepLazyStack) {\n  var segments = this.segments,\n      replacements = {},\n      needReplace = false,\n      lastX = 0,\n      lastY = 0,\n      countourStartX = 0,\n      countourStartY = 0;\n  var i, j, newSegments;\n\n  if (!keepLazyStack) {\n    this.__evaluateStack();\n  }\n\n  segments.forEach(function (s, index) {\n\n    var res = iterator(s, index, lastX, lastY);\n\n    if (Array.isArray(res)) {\n      replacements[index] = res;\n      needReplace = true;\n    }\n\n    var isRelative = (s[0] === s[0].toLowerCase());\n\n    // calculate absolute X and Y\n    switch (s[0]) {\n      case 'm':\n      case 'M':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        lastY = s[2] + (isRelative ? lastY : 0);\n        countourStartX = lastX;\n        countourStartY = lastY;\n        return;\n\n      case 'h':\n      case 'H':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        return;\n\n      case 'v':\n      case 'V':\n        lastY = s[1] + (isRelative ? lastY : 0);\n        return;\n\n      case 'z':\n      case 'Z':\n        // That make sence for multiple contours\n        lastX = countourStartX;\n        lastY = countourStartY;\n        return;\n\n      default:\n        lastX = s[s.length - 2] + (isRelative ? lastX : 0);\n        lastY = s[s.length - 1] + (isRelative ? lastY : 0);\n    }\n  });\n\n  // Replace segments if iterator return results\n\n  if (!needReplace) { return this; }\n\n  newSegments = [];\n\n  for (i = 0; i < segments.length; i++) {\n    if (typeof replacements[i] !== 'undefined') {\n      for (j = 0; j < replacements[i].length; j++) {\n        newSegments.push(replacements[i][j]);\n      }\n    } else {\n      newSegments.push(segments[i]);\n    }\n  }\n\n  this.segments = newSegments;\n\n  return this;\n};\n\n\n// Converts segments from relative to absolute\n//\nSvgPath.prototype.abs = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameUC = name.toUpperCase(),\n        i;\n\n    // Skip absolute commands\n    if (name === nameUC) { return; }\n\n    s[0] = nameUC;\n\n    switch (name) {\n      case 'v':\n        // v has shifted coords parity\n        s[1] += y;\n        return;\n\n      case 'a':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] += x;\n        s[7] += y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] += i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts segments from absolute to relative\n//\nSvgPath.prototype.rel = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameLC = name.toLowerCase(),\n        i;\n\n    // Skip relative commands\n    if (name === nameLC) { return; }\n\n    // Don't touch the first M to avoid potential confusions.\n    if (index === 0 && name === 'M') { return; }\n\n    s[0] = nameLC;\n\n    switch (name) {\n      case 'V':\n        // V has shifted coords parity\n        s[1] -= y;\n        return;\n\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] -= x;\n        s[7] -= y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] -= i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts arcs to cubic bzier curves\n//\nSvgPath.prototype.unarc = function () {\n  this.iterate(function (s, index, x, y) {\n    var new_segments, nextX, nextY, result = [], name = s[0];\n\n    // Skip anything except arcs\n    if (name !== 'A' && name !== 'a') { return null; }\n\n    if (name === 'a') {\n      // convert relative arc coordinates to absolute\n      nextX = x + s[6];\n      nextY = y + s[7];\n    } else {\n      nextX = s[6];\n      nextY = s[7];\n    }\n\n    new_segments = a2c(x, y, nextX, nextY, s[4], s[5], s[1], s[2], s[3]);\n\n    // Degenerated arcs can be ignored by renderer, but should not be dropped\n    // to avoid collisions with `S A S` and so on. Replace with empty line.\n    if (new_segments.length === 0) {\n      return [ [ s[0] === 'a' ? 'l' : 'L', s[6], s[7] ] ];\n    }\n\n    new_segments.forEach(function (s) {\n      result.push([ 'C', s[2], s[3], s[4], s[5], s[6], s[7] ]);\n    });\n\n    return result;\n  });\n\n  return this;\n};\n\n\n// Converts smooth curves (with missed control point) to generic curves\n//\nSvgPath.prototype.unshort = function () {\n  var segments = this.segments;\n  var prevControlX, prevControlY, prevSegment;\n  var curControlX, curControlY;\n\n  // TODO: add lazy evaluation flag when relative commands supported\n\n  this.iterate(function (s, idx, x, y) {\n    var name = s[0], nameUC = name.toUpperCase(), isRelative;\n\n    // First command MUST be M|m, it's safe to skip.\n    // Protect from access to [-1] for sure.\n    if (!idx) { return; }\n\n    if (nameUC === 'T') { // quadratic curve\n      isRelative = (name === 't');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'Q') {\n        prevControlX = prevSegment[1] - x;\n        prevControlY = prevSegment[2] - y;\n      } else if (prevSegment[0] === 'q') {\n        prevControlX = prevSegment[1] - prevSegment[3];\n        prevControlY = prevSegment[2] - prevSegment[4];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'q' : 'Q',\n        curControlX, curControlY,\n        s[1], s[2]\n      ];\n\n    } else if (nameUC === 'S') { // cubic curve\n      isRelative = (name === 's');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'C') {\n        prevControlX = prevSegment[3] - x;\n        prevControlY = prevSegment[4] - y;\n      } else if (prevSegment[0] === 'c') {\n        prevControlX = prevSegment[3] - prevSegment[5];\n        prevControlY = prevSegment[4] - prevSegment[6];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'c' : 'C',\n        curControlX, curControlY,\n        s[1], s[2], s[3], s[4]\n      ];\n    }\n  });\n\n  return this;\n};\n\n\nmodule.exports = SvgPath;\n","export default \"/* Workspace wrapper: horizontal layout */\\r\\n.KabelWorkspaceWrapper {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #f0f0f0;\\r\\n    /* light gray background */\\r\\n    overflow: hidden;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n/* Toolbox panel (left) */\\r\\n.KabelToolbox {\\r\\n    width: 12%;\\r\\n    min-width: 150px;\\r\\n    height: 100%;\\r\\n    background: rgba(240, 240, 240, 0.95);\\r\\n    border-right: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    padding: 8px;\\r\\n    overflow-y: auto;\\r\\n}\\r\\n\\r\\n/* Context menu container */\\r\\n.KabelContextMenu {\\r\\n    position: absolute;\\r\\n    background: #1e1e2f;\\r\\n    color: #000000;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);\\r\\n    padding: 4px 0;\\r\\n    font-family: 'Segoe UI', sans-serif;\\r\\n    font-size: 14px;\\r\\n    min-width: 160px;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    overflow: visible;\\r\\n    height: auto;\\r\\n    transition: opacity 0.15s ease, transform 0.15s ease;\\r\\n    opacity: 0;\\r\\n    transform: scale(0.95);\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n}\\r\\n\\r\\n/* Show state */\\r\\n.KabelContextMenu.show {\\r\\n    opacity: 1;\\r\\n    transform: scale(1);\\r\\n}\\r\\n\\r\\n/* Individual option */\\r\\n.KabelContextOption {\\r\\n    padding: 8px 16px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s ease, color 0.15s ease;\\r\\n}\\r\\n.KabelContextOption:hover {\\r\\n    background: #b0adb0;\\r\\n    color: #fff;\\r\\n}\\r\\n.KabelContextOption.disabled {\\r\\n\\topacity: 0.35;\\r\\n\\tcursor: not-allowed;\\r\\n\\tcolor: #777; /* dim it so it's obviously off */\\r\\n\\tbackground: transparent;\\r\\n\\tpointer-events: none;\\r\\n}\\r\\n\\r\\n/* make sure hover never triggers visually */\\r\\n.KabelContextOption.disabled:hover {\\r\\n\\tbackground: transparent;\\r\\n\\tcolor: #777;\\r\\n}\\r\\n\\r\\n/* Optional: active click effect */\\r\\n.KabelContextOption:active {\\r\\n    background: #fff;\\r\\n    color: #000;\\r\\n}\\r\\n\\r\\n/* Scrollbar if too many options */\\r\\n.KabelContextMenu::-webkit-scrollbar {\\r\\n    width: 6px;\\r\\n}\\r\\n\\r\\n.KabelContextMenu::-webkit-scrollbar-thumb {\\r\\n    background: rgba(255, 255, 255, 0.2);\\r\\n    border-radius: 3px;\\r\\n}\\r\\n\\r\\n/* Category buttons */\\r\\n\\r\\n.KabelCategoryRow {\\r\\n    background: #fff;\\r\\n    border: 1px solid #ccc;\\r\\n    padding: 4px 8px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    height: 5%;\\r\\n    padding: 6px;\\r\\n    cursor: pointer;\\r\\n    text-align: left;\\r\\n    transition: background 0.2s, color 0.2s;\\r\\n}\\r\\n\\r\\n.KabelToolbox button:hover {\\r\\n    background: #e6e6e6;\\r\\n    color: #333;\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlight {\\r\\n    stroke: yellow !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 255, 0, 0.9));\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlightWrong {\\r\\n    stroke: rgb(255, 0, 0) !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 0, 0, 0.9));\\r\\n}\\r\\n\\r\\n/* Container */\\r\\n.KabelDropdownMenu {\\r\\n    position: absolute;\\r\\n    display: none;\\r\\n    background: #1e1e1e;\\r\\n    color: #f0f0f0;\\r\\n    font-family: sans-serif;\\r\\n    font-size: 14px;\\r\\n    border: 1px solid #333;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);\\r\\n    padding: 4px 0;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    animation: fadeIn 0.15s ease-out;\\r\\n}\\r\\n\\r\\n/* Dropdown items */\\r\\n.KabelDropdownItem {\\r\\n    padding: 6px 12px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s;\\r\\n}\\r\\n\\r\\n/* Hover + focus states */\\r\\n.KabelDropdownItem:hover,\\r\\n.KabelDropdownItem:focus {\\r\\n    background: #2d2d2d;\\r\\n}\\r\\n\\r\\n/* Active (clicked) state */\\r\\n.KabelDropdownItem:active {\\r\\n    background: #3a3a3a;\\r\\n}\\r\\n\\r\\n/* Optional: highlight selected value */\\r\\n.KabelDropdownItem.selected {\\r\\n    background: #444;\\r\\n    font-weight: 600;\\r\\n}\\r\\n\\r\\n/* Smooth open effect */\\r\\n@keyframes fadeIn {\\r\\n    from {\\r\\n        opacity: 0;\\r\\n        transform: translateY(-3px);\\r\\n    }\\r\\n\\r\\n    to {\\r\\n        opacity: 1;\\r\\n        transform: translateY(0);\\r\\n    }\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\n/* Flyout panel (right) */\\r\\n.KabelFlyout {\\r\\n    width: 20%;\\r\\n    height: 100%;\\r\\n    background: rgba(255, 255, 255, 0.95);\\r\\n    border-left: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    overflow-y: auto;\\r\\n    position: relative;\\r\\n    /* for absolute positioning of nodes inside */\\r\\n    display: none;\\r\\n    /* hidden by default */\\r\\n    padding: 8px;\\r\\n}\\r\\n\\r\\n/* Flyout nodes */\\r\\n.KabelFlyoutNode {\\r\\n    padding: 6px 10px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    cursor: pointer;\\r\\n    user-select: none;\\r\\n    transition: background 0.2s;\\r\\n}\\r\\n\\r\\n.KabelFlyoutNode:hover {\\r\\n    background: #e0e0e0;\\r\\n}\\r\\n\\r\\n/* SVG workspace area */\\r\\n.KabelWorkspaceWrapper svg {\\r\\n    flex: 1;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #fff;\\r\\n    /* white canvas background */\\r\\n    display: block;\\r\\n}\";","import { Element } from '@svgdotjs/svg.js';\r\nimport Connection, { Connectable } from '../src/connection';\r\nimport eventer, { EventArgs } from '../util/eventer';\r\nimport userState from '../util/user-state';\r\nimport Field, { AnyField } from '../src/field';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport waitFrames from '../util/wait-anim-frames';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\ninterface ConnectionV {\r\n    conn: Connection,\r\n    el: Element,\r\n    args?: EventArgs\r\n}\r\ninterface ConnectionState {\r\n    one: null | ConnectionV,\r\n    two: null | ConnectionV\r\n}\r\n\r\n\r\nconst cState: ConnectionState = {\r\n    one: null,\r\n    two: null\r\n}\r\n\r\n\r\nfunction initConnector(el: Element, args?: EventArgs) {\r\n    args = args as {\r\n        connection: Connection,\r\n        node?: NodeSvg,\r\n        field?: AnyField\r\n    };\r\n    if (args.field && !args.field?.canEditConnector) { // If editing isnt allowed, close the event early.\r\n        return; \r\n    }\r\n    el.on('click', () => {\r\n        const isPrev = args.connection.isPrevious;\r\n\r\n        // First click  must NOT be previous\r\n        if (!cState.one) {\r\n            if (isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            cState.one = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n            userState.setState('connecting')\r\n            return;\r\n        }\r\n\r\n        // Second click  must be previous\r\n        if (!cState.two && (args?.node !== cState.one?.args?.node)) {\r\n            if (!isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            if (cState.one.conn === args.connection) return; // ignore clicking the same again\r\n            cState.two = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n        }\r\n\r\n        // Both are filled  attempt to connect\r\n        if (cState.one && cState.two) {\r\n            if (cState.two.args?.node == cState.one.args?.node || cState.two.args?.node === cState.one?.args?.field?.node) {\r\n                cState.one.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                cState.two.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    if (!cState) return;\r\n                    if (!cState.one || !cState.two) return;\r\n                    cState.one.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.two.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.one = null;\r\n                    cState.two = null;\r\n                })\r\n                userState.removeState('connecting');\r\n                return;\r\n            }\r\n            const { conn: connA } = cState.one;\r\n            const { conn: connB } = cState.two;\r\n\r\n            connA.disconnectTo();\r\n            connB.disconnectFrom();\r\n\r\n            connA.to = cState.two.args?.node;\r\n            connB.from = cState.one.args?.node || cState.one.args?.field;\r\n\r\n            waitFrames(2, () => {\r\n                if (cState.one?.args?.node) {\r\n                    cState.one.args.node.workspace?.redraw();\r\n                    (cState.one.args.node.workspace as WorkspaceSvg).emitChange();\r\n                } else if (cState.two?.args?.node) {\r\n                    cState.two.args.node.workspace?.redraw();\r\n                    (cState!.two!.args.node!.workspace as WorkspaceSvg).emitChange();\r\n\r\n                }\r\n                \r\n                \r\n                cState.one = null;\r\n                cState.two = null;\r\n                userState.removeState('connecting');\r\n\r\n            });\r\n        }\r\n    });\r\n    return () => {\r\n        el.off('click'); // removes the click listener\r\n    };\r\n\r\n}\r\n\r\neventer.registerEvent('k_connectbubble', initConnector);\r\n","import { parseColor } from \"../util/parse-color\";\r\nimport { TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { Color } from \"./visual-types\";\r\n\r\n/**\r\n * Represents a category in the toolbox, containing nodes and a label.\r\n */\r\nclass Category {\r\n\t/** Display label for the category */\r\n\tlabel: string;\r\n\t/** Category color */\r\n\tcolor: Color;\r\n\t/** Nodes contained in this category */\r\n\tcontents: TblxNodeStruct[];\r\n\t/** HTML button element representing this category row */\r\n\t_rowDiv!: HTMLButtonElement;\r\n\t/** Reference to parent toolbox */\r\n\t_toolbox: Toolbox;\r\n\r\n\t/**\r\n\t * @param toolbox The parent Toolbox instance\r\n\t * @param cData Category data (label, color, nodes)\r\n\t */\r\n\tconstructor(toolbox: Toolbox, cData: TblxCategoryStruct) {\r\n\t\tthis.label = cData.name;\r\n\t\tthis.color = cData.color;\r\n\t\tthis.contents = cData.contents;\r\n\t\tthis._toolbox = toolbox;\r\n\t\tthis._makeDiv();\r\n\t}\r\n\r\n\t/** Creates the category button in the UI and attaches click events */\r\n\t_makeDiv() {\r\n\t\tconst btn = document.createElement(\"button\");\r\n\t\tbtn.textContent = this.label;\r\n\t\tbtn.className = \"KabelCategoryRow\";\r\n\t\tbtn.style.backgroundColor = parseColor(this.color);\r\n\t\tbtn.style.color = parseColor('#ffffff');\r\n\t\tthis._rowDiv = btn;\r\n\r\n\t\tbtn.addEventListener(\"click\", e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis._toolbox._flyout.clear();\r\n\t\t\tthis._toolbox._flyout.fill(this.contents);\r\n\t\t\tthis._toolbox._flyout.show();\r\n\t\t});\r\n\r\n\t\tthis._toolbox.container.appendChild(btn);\r\n\t}\r\n\r\n\t/**\r\n\t * Refreshes the category UI with new data\r\n\t * @param cData Partial data to update (name, color, contents)\r\n\t */\r\n\trefresh(cData: Partial<TblxCategoryStruct>) {\r\n\t\tif (cData.name !== undefined) {\r\n\t\t\tthis.label = cData.name;\r\n\t\t\tthis._rowDiv.textContent = this.label;\r\n\t\t}\r\n\t\tif (cData.color !== undefined) {\r\n\t\t\tthis.color = cData.color;\r\n\t\t\tthis._rowDiv.style.backgroundColor = parseColor(this.color);\r\n\t\t}\r\n\t\tif (cData.contents !== undefined) {\r\n\t\t\tthis.contents = cData.contents;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Remove category row from the toolbox */\r\n\tdestroy() {\r\n\t\tthis._rowDiv.remove();\r\n\t\tthis._toolbox = null as unknown as Toolbox;\r\n\t}\r\n\r\n\t/** Hide this category from the UI */\r\n\thide() {\r\n\t\tthis._rowDiv.style.display = \"none\";\r\n\t}\r\n\r\n\t/** Show this category in the UI */\r\n\tshow() {\r\n\t\tthis._rowDiv.style.display = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Enable or disable interaction with this category\r\n\t * @param disabled True to disable, false to enable\r\n\t */\r\n\tsetDisabled(disabled: boolean) {\r\n\t\tthis._rowDiv.disabled = disabled;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a plain object representation of this category\r\n\t * @returns JSON-compatible category object\r\n\t */\r\n\ttoJSON(): TblxCategoryStruct {\r\n\t\treturn {\r\n\t\t\tname: this.label,\r\n\t\t\tcolor: this.color,\r\n\t\t\tcontents: this.contents,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default Category;\r\n","import NodeSvg from '../src/nodesvg';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport { Element } from '@svgdotjs/svg.js';\r\nimport Renderer, { DrawState } from './renderer';\r\nimport RendererConstants from './constants';\r\nimport { parseColor } from '../util/parse-color';\r\nimport {Color} from '../src/visual-types';\r\n\r\nexport class RepresenterNode {\r\n\tnode: NodeSvg;\r\n\tstate: DrawState;\r\n    renderer: Renderer;\r\n\tconstructor(node: NodeSvg, svgState: DrawState, renderer: Renderer) {\r\n        this.renderer = renderer;\r\n\t\tthis.node = node;\r\n\t\tthis.state = svgState;\r\n\r\n\t\t// Attach this wrapper to the node for external access\r\n\t\tnode.svg = this;\r\n\t}\r\n    getConstant(name: keyof RendererConstants) {\r\n        return this.renderer._constants[name];\r\n    }\r\n\t/** Move node visually without changing its relativeCoords */\r\n\tmoveTo(x: number, y: number) {\r\n\t\tthis.state.group!.move(x, y);\r\n\t}\r\n\r\n\t/** Scale node visually */\r\n\tsetScale(scale: number) {\r\n\t\tthis.state.group!.scale(scale);\r\n\t}\r\n\r\n\t/** Apply raw transform string */\r\n\tapplyTransform(transform: string) {\r\n\t\tthis.state.group!.attr({ transform });\r\n\t}\r\n\r\n\t/** Access the raw SVG group */\r\n\tgetRaw() {\r\n\t\treturn this.state.group;\r\n\t}\r\n\r\n\t/** Optional: highlight node */\r\n\thighlight(color = '#ff0') {\r\n        if (!color || color.length == 0 || typeof color !== 'string') {\r\n            this.highlight(parseColor(this.getConstant('NODE_OUTLINE_COLOR') as Color) as string);\r\n            return;\r\n        }\r\n\t\tthis.state.bg!.stroke({ color, width: 2 });\r\n\t}\r\n}\r\n","import Field, { ConnectableField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\n/**\r\n * A node or field that can participate in a connection.\r\n */\r\nexport type Connectable = NodeSvg | null | Field;\r\n\r\n/**\r\n * Represents a connection between two connectable objects.\r\n */\r\nclass Connection {\r\n\t/** The source of the connection */\r\n\tfrom: Connectable;\r\n\t/** The target of the connection */\r\n\tto: Connectable;\r\n\t/** Whether this connection represents a previous connection (affects rendering/logic) */\r\n\tisPrevious: boolean;\r\n\r\n\t/**\r\n\t * Creates a new Connection.\r\n\t * @param from - The source NodeSvg or Field\r\n\t * @param to - The target NodeSvg or Field\r\n\t * @param isPrevious - True if this connection is a previous connection\r\n\t */\r\n\tconstructor(from: Connectable, to: Connectable, isPrevious: boolean = false) {\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\t\tthis.isPrevious = isPrevious;\r\n\t}\r\n\r\n\t/** Returns the target of the connection */\r\n\tgetTo(): Connectable {\r\n\t\treturn this.to;\r\n\t}\r\n\r\n\t/** Returns the source of the connection */\r\n\tgetFrom(): Connectable {\r\n\t\treturn this.from;\r\n\t}\r\n\r\n\t/**\r\n\t * Disconnects this connection from its target.\r\n\t * Safely handles NodeSvg chains and ConnectableFields.\r\n\t */\r\n\tdisconnectTo() {\r\n\t\tif (!this.to) return;\r\n\r\n\t\tif (this.to instanceof NodeSvg && this.to.previousConnection) {\r\n\t\t\tconst prevConn = this.to.previousConnection;\r\n\t\t\tconst prevFrom = prevConn.from;\r\n\r\n\t\t\t// Disconnect NodeSvg chain\r\n\t\t\tif (prevFrom instanceof NodeSvg && prevFrom.nextConnection?.to) {\r\n\t\t\t\tprevFrom.nextConnection.to = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Disconnect Field chain\r\n\t\t\tif (prevFrom instanceof Field && prevFrom.hasConnectable?.()) {\r\n\t\t\t\t(prevFrom as ConnectableField).disconnect();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.to = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Disconnects this connection from its source.\r\n\t * Safely handles NodeSvg chains and ConnectableFields.\r\n\t */\r\n\tdisconnectFrom() {\r\n\t\tif (!this.from) return;\r\n\r\n\t\tif (this.from instanceof NodeSvg && this.from.nextConnection) {\r\n\t\t\tconst next = this.from.nextConnection;\r\n\r\n\t\t\tif (next.to instanceof NodeSvg && next.to.previousConnection?.from) {\r\n\t\t\t\tnext.to.previousConnection.from = null;\r\n\t\t\t} else if (next.to instanceof Field && next.to.hasConnectable()) {\r\n\t\t\t\t(next.to as ConnectableField).disconnect();\r\n\t\t\t}\r\n\r\n\t\t\tnext.to = null;\r\n\t\t} else if (this.from instanceof Field && this.from.hasConnectable()) {\r\n\t\t\t(this.from as ConnectableField).disconnect();\r\n\t\t}\r\n\r\n\t\tthis.from = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the target of this connection (used during deserialization)\r\n\t * @param target - New connection target\r\n\t */\r\n\tsetTo(target: Connectable) {\r\n\t\tthis.to = target;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the source of this connection (used during deserialization)\r\n\t * @param source - New connection source\r\n\t */\r\n\tsetFrom(source: Connectable) {\r\n\t\tthis.from = source;\r\n\t}\r\n\r\n\t/** Completely isolates this connection, clearing both ends */\r\n\tisolate() {\r\n\t\tthis.from = null as any;\r\n\t\tthis.to = null as any;\r\n\t}\r\n}\r\n\r\nexport default Connection;\r\n","import { Color } from \"../../src/visual-types\";\r\nimport RendererConstants from \"../constants\";\r\n\r\n// Define the new Dogear shape\r\ntype DogearShape = {\r\n    PathMain: string;\r\n    Width: number;\r\n    Height: number;\r\n};\r\n\r\n// Extend the original SHAPES type\r\ntype ApolloShapes = RendererConstants['SHAPES'] & {\r\n    Dogear?: DogearShape;\r\n};\r\n\r\nclass ApolloConstants extends RendererConstants {\r\n    SHAPES: ApolloShapes = {};\r\n    CONNECTOR_COLOR: Color = '#9912e8ff'\r\n    FIELD_RAW_COLOR: Color = '#343745ff';\r\n    FIELD_RAW_TEXT_COLOR: Color = '#cfd4e4ff';\r\n    FIELD_RAW_OUTLINE_COLOR: Color = '#202128ff';\r\n    constructor(overrides: Partial<ApolloConstants>) {\r\n        super(overrides);\r\n        this.CONNECTOR_LINE_WIDTH = 2.5;\r\n        this.CORNER_RADIUS = 10;\r\n        this.FOOTER_HEIGHT = 25;\r\n        this.CONNECTOR_LINE_WIDTH = 7;\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.SHAPES.Dogear = {\r\n            PathMain: `M -1 1 Q -1 21 0 30 L 26 0 Q 2 -1 0 0 Z`,\r\n            Width: 26,\r\n            Height: 30\r\n        };\r\n    }\r\n}\r\n\r\nexport default ApolloConstants;\r\n","import { Element, Rect, Text } from \"@svgdotjs/svg.js\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\nimport { Renderer } from \"../src\";\r\n\r\nfunction initInputBox(element: Element, args: Record<string, any>) {\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = args.field.getDisplayValue?.() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length;\r\n    const txt: Text = args.text;\r\n    const rect: Rect = element as Rect;\r\n    const renderer = args.renderer as Renderer;\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n    let caretLine: Rect | null = null;\r\n    let selectionRect: Rect | null = null;\r\n    // @ts-ignore\r\n    txt!.style('user-select', 'none');\r\n    // @ts-ignore\r\n    rect!.style('user-select', 'none');\r\n\r\n    // Helper: measure width of text using renderer or fallback\r\n    function measureTextWidth(text: string) {\r\n\r\n        if (renderer.measureTextWidth) return renderer.measureTextWidth(text);\r\n        return text.length * 8; // rough fallback\r\n    }\r\n\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    function updateText() {\r\n        // redraw main text\r\n        txt.text(buffer);\r\n\r\n        const { start, end } = getSelectionRange();\r\n        const { width: totalWidth } = renderer.measureRawField(buffer);\r\n        const { height: rectHeight } = rect.bbox(); // actual rect height\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (rectHeight - textBBox.height) / 2; // center vertically\r\n\r\n        // --- selection highlight ---\r\n        if (hasSelection()) {\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n            const highlightX = args.startX + PADDING_X + measureTextWidth(textBeforeStart);\r\n            const highlightWidth = Math.max(measureTextWidth(textBeforeEnd) - measureTextWidth(textBeforeStart), 1);\r\n            const highlightY = offsetY; // use offsetY for vertical alignment\r\n\r\n            if (!selectionRect) {\r\n                // @ts-ignore\r\n                selectionRect = rect.parent()!.rect(highlightWidth, textBBox.height)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                selectionRect.size(highlightWidth, textBBox.height);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n        // --- caret ---\r\n        if (editing) {\r\n            const zoom = renderer.getWs().getZoom(); // workspace zoom\r\n            const caretX = (args.startX + PADDING_X + measureTextWidth(buffer.slice(0, cursorPos))); // scale pos\r\n            const caretH = textBBox.height;\r\n            // @ts-ignore\r\n            if (!caretLine) caretLine = rect.parent()!.rect(1, caretH).fill(renderer.constants.FIELD_RAW_TEXT_COLOR);\r\n            caretLine!.size(1, caretH).move(caretX, offsetY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n        // --- background rect ---\r\n        rect.size(Math.max(16, totalWidth + PADDING_X * 2), Math.max(rectHeight, textBBox.height + PADDING_Y * 2));\r\n        txt.move(args.startX + PADDING_X, offsetY);\r\n    }\r\n\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(); return; }\r\n        if (e.key === \"Enter\") { e.preventDefault(); stopEditing(); return; }\r\n\r\n        if (e.key === \"Backspace\") {\r\n            if (!deleteSelection() && cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            if (!deleteSelection() && cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        } else if (e.key === \"ArrowLeft\") {\r\n            if (e.shiftKey) cursorPos = Math.max(0, cursorPos - 1);\r\n            else { cursorPos = Math.max(0, cursorPos - 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            if (e.shiftKey) cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            else { cursorPos = Math.min(buffer.length, cursorPos + 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"Home\") {\r\n            if (!e.shiftKey) anchorPos = 0;\r\n            cursorPos = 0;\r\n        } else if (e.key === \"End\") {\r\n            if (!e.shiftKey) anchorPos = buffer.length;\r\n            cursorPos = buffer.length;\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        } else return;\r\n\r\n        e.preventDefault();\r\n        updateText();\r\n        args.field.setValue(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const target = ev.target as Node;\r\n        if (target !== rect.node && target !== txt.node) stopEditing();\r\n    }\r\n\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = args.field.getValue?.() ?? \"\";\r\n        cursorPos = buffer.length;\r\n        anchorPos = buffer.length;\r\n\r\n        userState.setState('typing');\r\n\r\n        if (ev) {\r\n            const rectBox = rect.node.getBoundingClientRect();\r\n            const zoom = renderer.getWs().getZoom(); // workspace zoom\r\n            const clickX = (ev.clientX - rectBox.left - PADDING_X) / zoom;\r\n\r\n            let cumulativeWidth = 0;\r\n            cursorPos = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                const charWidth = measureTextWidth(buffer[i]); // scale widths\r\n                if (cumulativeWidth + charWidth / 2 >= clickX) break;\r\n                cumulativeWidth += charWidth;\r\n                cursorPos = i + 1;\r\n            }\r\n        }\r\n\r\n        anchorPos = cursorPos;\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown);\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing() {\r\n        editing = false;\r\n        userState.removeState('typing');\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n        args.field.setValue(buffer);\r\n        updateText();\r\n        renderer.getWs().redraw();\r\n        renderer.getWs().emitChange();\r\n    }\r\n\r\n    rect.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n    txt.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", startEditing as EventListener);\r\n        txt.off(\"mousedown\", startEditing as EventListener);\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_inputbox\", initInputBox as EventSetupFn);\r\n","import NodeSvg from '../src/nodesvg';\r\nimport Renderer, { DrawState } from './renderer';\r\nimport { RepresenterNode } from './representer-node';\r\n\r\nexport default class Representer {\r\n\tnodes: Map<string, RepresenterNode> = new Map();\r\n\r\n\t/** Build a representer node for a drawn node */\r\n\tbuild(node: NodeSvg, renderer: Renderer, state: DrawState) {\r\n\t\tif (!node) return;\r\n\t\tconst repNode = new RepresenterNode(node, state, renderer);\r\n\t\tthis.nodes.set(node.id, repNode);\r\n\t\treturn repNode;\r\n\t}\r\n\r\n\t/** Get a representer node by node id */\r\n\tget(nodeId: string): RepresenterNode | undefined {\r\n\t\treturn this.nodes.get(nodeId);\r\n\t}\r\n\r\n\t/** Remove a node from the representer */\r\n\tremove(nodeId: string) {\r\n\t\tthis.nodes.delete(nodeId);\r\n\t}\r\n}\r\n","import WorkspaceController from \"../controllers/base\";\r\nimport unescapeAttr from \"../util/unescape-html\";\r\nimport CommentModel from \"./comment\";\r\nimport Coordinates from \"./coordinates\";\r\nimport ContextOptsRegistry from \"./ctx-menu-registry\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport Widget from \"./widget\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n/**\r\n * A list of types that a context menu item can show for.\r\n */\r\nexport type Showable = 'node' | 'ws' | 'html' | 'comment' | 'any';\r\n\r\n/**\r\n * Describes a context menu option.\r\n */\r\nexport interface ContextMenuOpts {\r\n    /** Function executed when the option is clicked */\r\n    click: (target: NodeSvg | WorkspaceSvg | CommentModel | HTMLElement) => void;\r\n    /** Optional hover start callback */\r\n    onHoverStart?: () => void;\r\n    /** Optional hover end callback */\r\n    onHoverEnd?: () => void;\r\n    /** Specifies which target types this option should appear for */\r\n    showFor?: Showable | Showable[];\r\n    /** Specifies extra logic for drawing */\r\n    onDraw?: (optEl: Node, ws: WorkspaceSvg, opt: ContextMenuOpts) => void;\r\n    /** Text label for the menu option */\r\n    label: string;\r\n    /** Unique ID for the option */\r\n    id: string;\r\n}\r\n\r\n/**\r\n * HTML context menu rendered on workspace right-click.\r\n */\r\nclass ContextMenuHTML {\r\n    /**\r\n     * The workspace.\r\n     */\r\n    workspace: WorkspaceSvg;\r\n    /**\r\n     * The workspace's controller\r\n     */\r\n    controller: WorkspaceController;\r\n    /**\r\n     * The widget in the workspace to display the menu on.\r\n     */\r\n    widget: Widget;\r\n    /**\r\n     * Options for the context menu.\r\n     */\r\n    options: ContextMenuOpts[];\r\n\r\n    /**\r\n     * Create a new context menu for a workspace.\r\n     * @param workspace - Workspace to attach the context menu to\r\n     */\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n        this.controller = this.workspace.controller;\r\n        this.widget = new Widget(this.workspace, {\r\n            coords: new Coordinates(0, 0),\r\n            name: 'k_contextmenu',\r\n            className: 'KabelContextMenu'\r\n        });\r\n\r\n        // Override show/hide methods to manipulate CSS\r\n        this.widget.show = () => {\r\n            this.widget.container.classList.add('show');\r\n            this.widget.container.style.display = 'flex';\r\n            this.widget.visible = true;\r\n        };\r\n        this.widget.hide = () => {\r\n            this.widget.container.classList.remove('show');\r\n            this.widget.container.style.display = 'none';\r\n            this.widget.visible = false;\r\n        };\r\n        this.widget.container.style.removeProperty('height');\r\n        this.widget.container.style.removeProperty('width');\r\n\r\n        this.widget.hide();\r\n        this.options = ContextOptsRegistry;\r\n        this.initListeners();\r\n    }\r\n\r\n    /**\r\n     * Renders context menu options for a given target.\r\n     * @param target - The object the context menu is for\r\n     */\r\n    renderOptions(target: NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null) {\r\n        this.widget.container.innerHTML = '';\r\n\r\n        const filteredOptions = this.options.filter(opt => {\r\n            if (!target) return false;\r\n            const showFor = Array.isArray(opt.showFor) ? opt.showFor : [opt.showFor];\r\n            if (showFor.includes('any')) return true;\r\n            if (target instanceof NodeSvg && showFor.includes('node')) return true;\r\n            if (target instanceof WorkspaceSvg && showFor.includes('ws')) return true;\r\n            if (target instanceof HTMLElement && !(target instanceof SVGSVGElement) && showFor.includes('html')) return true;\r\n            if (target instanceof CommentModel && showFor.includes('comment')) return true;\r\n            return false;\r\n        });\r\n\r\n        filteredOptions.forEach((opt, i) => {\r\n            const el = document.createElement('div');\r\n            el.className = 'KabelContextOption';\r\n            el.textContent = opt.label || 'Option ' + i;\r\n\r\n            el.addEventListener('click', () => {\r\n                if (target) opt.click(target);\r\n                this.hide();\r\n            });\r\n            if (opt.onDraw) opt.onDraw(el, this.workspace, opt);\r\n            if (opt.onHoverStart) el.addEventListener('mouseenter', () => opt.onHoverStart?.());\r\n            if (opt.onHoverEnd) el.addEventListener('mouseleave', () => opt.onHoverEnd?.());\r\n\r\n            this.widget.container.appendChild(el);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initializes event listeners for showing/hiding the menu.\r\n     */\r\n    initListeners() {\r\n        if (this.controller) {\r\n            this.controller.addMoveListener(() => {\r\n                if (this.widget.visible) this.hide();\r\n            })\r\n        }\r\n        this.workspace.svg.node.addEventListener('contextmenu', e => {\r\n            e.preventDefault();\r\n            const mouseX = e.clientX;\r\n            const mouseY = e.clientY;\r\n\r\n            this.widget.setCoords(new Coordinates(mouseX, mouseY));\r\n            this.renderOptions(this.target);\r\n            this.widget.show();\r\n        });\r\n\r\n        document.addEventListener('mousedown', e => {\r\n            if (!this.widget.container.contains(e.target as Node)) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    /** Hides the context menu */\r\n    hide() {\r\n        this.widget.hide();\r\n    }\r\n\r\n    /** Returns the current mouse position in workspace coordinates */\r\n    get mousePos(): { x: number, y: number } {\r\n        return this.controller.mousePos;\r\n    }\r\n\r\n    /**\r\n     * Returns the target element under the mouse for context menu.\r\n     */\r\n    get target(): NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null {\r\n        let el = document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n        if (!el) return null;\r\n        if ((el as unknown as SVGSVGElement) === this.workspace.svg.node) return this.workspace;\r\n\r\n        if (el && el.classList?.contains?.('WorkspaceBgPattern')) return this.workspace;\r\n\r\n        while (el && el !== document.body) {\r\n            if (el.tagName.toLowerCase() === 'g' && el.hasAttribute('data-node-id')) {\r\n                const nodeId = unescapeAttr(el.getAttribute('data-node-id') as string);\r\n                const node = this.workspace.getNode(nodeId);\r\n                if (node) return node;\r\n            }\r\n            if (el.tagName.toLowerCase() === 'g' && el.hasAttribute('comment-data')) {\r\n                const dta = JSON.parse(el.getAttribute('comment-data') as string);\r\n                if (!dta.id && !dta.isws) continue;\r\n                if (dta.isws) {\r\n                    for (let comment of this.workspace._commentDB) {\r\n                        if (comment.id === dta.id) return comment;\r\n                    }\r\n                } else {\r\n                    for (let [_, node] of this.workspace._nodeDB) {\r\n                        if (node.comment && node.comment.id == dta.id) return node.comment;\r\n                    }\r\n                }\r\n            }\r\n            el = el.parentElement;\r\n        }\r\n\r\n        return document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n    }\r\n}\r\n\r\nexport default ContextMenuHTML;\r\n","import type { WSTheme } from '../src/workspace-svg';\r\n\r\nconst KabelDarkTheme: WSTheme = {\r\n\tUIStyles: {\r\n\t\tworkspaceBGColor: '#121412ff',\r\n\t\ttoolboxCategoriesBG: {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tleft: '0',\r\n\t\t\ttop: '0',\r\n\t\t\twidth: '20%',\r\n\t\t\theight: '100%',\r\n\t\t\tbackground: '#1b1b1b',\r\n\t\t\tcolor: '#e0e0e0',\r\n\t\t\toverflowY: 'auto',\r\n\t\t\tborder: 'none',\r\n\t\t\toutline: 'none',\r\n\t\t},\r\n\t\ttoolboxFlyoutBG: {\r\n\t\t\tbackground: '#1e1e1e',\r\n\t\t\tcolor: '#e0e0e0',\r\n\t\t\toverflowY: 'auto',\r\n\t\t\tpadding: '4px', \r\n\t\t\tborderRadius: '4px',\r\n\t\t\tboxShadow: '0 2px 6px rgba(0,0,0,0.5)',\r\n\t\t\tborder: 'none',\r\n\t\t\toutline: 'none',\r\n\t\t},\r\n\t},\r\n};\r\n\r\nexport default KabelDarkTheme;\r\n","/*!\n* @svgdotjs/svg.js - A lightweight library for manipulating and animating SVG.\n* @version 3.2.4\n* https://svgjs.dev/\n*\n* @copyright Wout Fierens <wout@mick-wout.com>\n* @license MIT\n*\n* BUILT: Thu Jun 27 2024 12:00:16 GMT+0200 (Central European Summer Time)\n*/;\n'use strict';\n\nconst methods$1 = {};\nconst names = [];\nfunction registerMethods(name, m) {\n  if (Array.isArray(name)) {\n    for (const _name of name) {\n      registerMethods(_name, m);\n    }\n    return;\n  }\n  if (typeof name === 'object') {\n    for (const _name in name) {\n      registerMethods(_name, name[_name]);\n    }\n    return;\n  }\n  addMethodNames(Object.getOwnPropertyNames(m));\n  methods$1[name] = Object.assign(methods$1[name] || {}, m);\n}\nfunction getMethodsFor(name) {\n  return methods$1[name] || {};\n}\nfunction getMethodNames() {\n  return [...new Set(names)];\n}\nfunction addMethodNames(_names) {\n  names.push(..._names);\n}\n\n// Map function\nfunction map(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    result.push(block(array[i]));\n  }\n  return result;\n}\n\n// Filter function\nfunction filter(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    if (block(array[i])) {\n      result.push(array[i]);\n    }\n  }\n  return result;\n}\n\n// Degrees to radians\nfunction radians(d) {\n  return d % 360 * Math.PI / 180;\n}\n\n// Radians to degrees\nfunction degrees(r) {\n  return r * 180 / Math.PI % 360;\n}\n\n// Convert camel cased string to dash separated\nfunction unCamelCase(s) {\n  return s.replace(/([A-Z])/g, function (m, g) {\n    return '-' + g.toLowerCase();\n  });\n}\n\n// Capitalize first letter of a string\nfunction capitalize(s) {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\n// Calculate proportional width and height values when necessary\nfunction proportionalSize(element, width, height, box) {\n  if (width == null || height == null) {\n    box = box || element.bbox();\n    if (width == null) {\n      width = box.width / box.height * height;\n    } else if (height == null) {\n      height = box.height / box.width * width;\n    }\n  }\n  return {\n    width: width,\n    height: height\n  };\n}\n\n/**\n * This function adds support for string origins.\n * It searches for an origin in o.origin o.ox and o.originX.\n * This way, origin: {x: 'center', y: 50} can be passed as well as ox: 'center', oy: 50\n **/\nfunction getOrigin(o, element) {\n  const origin = o.origin;\n  // First check if origin is in ox or originX\n  let ox = o.ox != null ? o.ox : o.originX != null ? o.originX : 'center';\n  let oy = o.oy != null ? o.oy : o.originY != null ? o.originY : 'center';\n\n  // Then check if origin was used and overwrite in that case\n  if (origin != null) {\n    [ox, oy] = Array.isArray(origin) ? origin : typeof origin === 'object' ? [origin.x, origin.y] : [origin, origin];\n  }\n\n  // Make sure to only call bbox when actually needed\n  const condX = typeof ox === 'string';\n  const condY = typeof oy === 'string';\n  if (condX || condY) {\n    const {\n      height,\n      width,\n      x,\n      y\n    } = element.bbox();\n\n    // And only overwrite if string was passed for this specific axis\n    if (condX) {\n      ox = ox.includes('left') ? x : ox.includes('right') ? x + width : x + width / 2;\n    }\n    if (condY) {\n      oy = oy.includes('top') ? y : oy.includes('bottom') ? y + height : y + height / 2;\n    }\n  }\n\n  // Return the origin as it is if it wasn't a string\n  return [ox, oy];\n}\nconst descriptiveElements = new Set(['desc', 'metadata', 'title']);\nconst isDescriptive = element => descriptiveElements.has(element.nodeName);\nconst writeDataToDom = (element, data, defaults = {}) => {\n  const cloned = {\n    ...data\n  };\n  for (const key in cloned) {\n    if (cloned[key].valueOf() === defaults[key]) {\n      delete cloned[key];\n    }\n  }\n  if (Object.keys(cloned).length) {\n    element.node.setAttribute('data-svgjs', JSON.stringify(cloned)); // see #428\n  } else {\n    element.node.removeAttribute('data-svgjs');\n    element.node.removeAttribute('svgjs:data');\n  }\n};\n\nvar utils = {\n  __proto__: null,\n  capitalize: capitalize,\n  degrees: degrees,\n  filter: filter,\n  getOrigin: getOrigin,\n  isDescriptive: isDescriptive,\n  map: map,\n  proportionalSize: proportionalSize,\n  radians: radians,\n  unCamelCase: unCamelCase,\n  writeDataToDom: writeDataToDom\n};\n\n// Default namespaces\nconst svg = 'http://www.w3.org/2000/svg';\nconst html = 'http://www.w3.org/1999/xhtml';\nconst xmlns = 'http://www.w3.org/2000/xmlns/';\nconst xlink = 'http://www.w3.org/1999/xlink';\n\nvar namespaces = {\n  __proto__: null,\n  html: html,\n  svg: svg,\n  xlink: xlink,\n  xmlns: xmlns\n};\n\nconst globals = {\n  window: typeof window === 'undefined' ? null : window,\n  document: typeof document === 'undefined' ? null : document\n};\nfunction registerWindow(win = null, doc = null) {\n  globals.window = win;\n  globals.document = doc;\n}\nconst save = {};\nfunction saveWindow() {\n  save.window = globals.window;\n  save.document = globals.document;\n}\nfunction restoreWindow() {\n  globals.window = save.window;\n  globals.document = save.document;\n}\nfunction withWindow(win, fn) {\n  saveWindow();\n  registerWindow(win, win.document);\n  fn(win, win.document);\n  restoreWindow();\n}\nfunction getWindow() {\n  return globals.window;\n}\n\nclass Base {\n  // constructor (node/*, {extensions = []} */) {\n  //   // this.tags = []\n  //   //\n  //   // for (let extension of extensions) {\n  //   //   extension.setup.call(this, node)\n  //   //   this.tags.push(extension.name)\n  //   // }\n  // }\n}\n\nconst elements = {};\nconst root = '___SYMBOL___ROOT___';\n\n// Method for element creation\nfunction create(name, ns = svg) {\n  // create element\n  return globals.document.createElementNS(ns, name);\n}\nfunction makeInstance(element, isHTML = false) {\n  if (element instanceof Base) return element;\n  if (typeof element === 'object') {\n    return adopter(element);\n  }\n  if (element == null) {\n    return new elements[root]();\n  }\n  if (typeof element === 'string' && element.charAt(0) !== '<') {\n    return adopter(globals.document.querySelector(element));\n  }\n\n  // Make sure, that HTML elements are created with the correct namespace\n  const wrapper = isHTML ? globals.document.createElement('div') : create('svg');\n  wrapper.innerHTML = element;\n\n  // We can use firstChild here because we know,\n  // that the first char is < and thus an element\n  element = adopter(wrapper.firstChild);\n\n  // make sure, that element doesn't have its wrapper attached\n  wrapper.removeChild(wrapper.firstChild);\n  return element;\n}\nfunction nodeOrNew(name, node) {\n  return node && (node instanceof globals.window.Node || node.ownerDocument && node instanceof node.ownerDocument.defaultView.Node) ? node : create(name);\n}\n\n// Adopt existing svg elements\nfunction adopt(node) {\n  // check for presence of node\n  if (!node) return null;\n\n  // make sure a node isn't already adopted\n  if (node.instance instanceof Base) return node.instance;\n  if (node.nodeName === '#document-fragment') {\n    return new elements.Fragment(node);\n  }\n\n  // initialize variables\n  let className = capitalize(node.nodeName || 'Dom');\n\n  // Make sure that gradients are adopted correctly\n  if (className === 'LinearGradient' || className === 'RadialGradient') {\n    className = 'Gradient';\n\n    // Fallback to Dom if element is not known\n  } else if (!elements[className]) {\n    className = 'Dom';\n  }\n  return new elements[className](node);\n}\nlet adopter = adopt;\nfunction mockAdopt(mock = adopt) {\n  adopter = mock;\n}\nfunction register(element, name = element.name, asRoot = false) {\n  elements[name] = element;\n  if (asRoot) elements[root] = element;\n  addMethodNames(Object.getOwnPropertyNames(element.prototype));\n  return element;\n}\nfunction getClass(name) {\n  return elements[name];\n}\n\n// Element id sequence\nlet did = 1000;\n\n// Get next named element id\nfunction eid(name) {\n  return 'Svgjs' + capitalize(name) + did++;\n}\n\n// Deep new id assignment\nfunction assignNewId(node) {\n  // do the same for SVG child nodes as well\n  for (let i = node.children.length - 1; i >= 0; i--) {\n    assignNewId(node.children[i]);\n  }\n  if (node.id) {\n    node.id = eid(node.nodeName);\n    return node;\n  }\n  return node;\n}\n\n// Method for extending objects\nfunction extend(modules, methods) {\n  let key, i;\n  modules = Array.isArray(modules) ? modules : [modules];\n  for (i = modules.length - 1; i >= 0; i--) {\n    for (key in methods) {\n      modules[i].prototype[key] = methods[key];\n    }\n  }\n}\nfunction wrapWithAttrCheck(fn) {\n  return function (...args) {\n    const o = args[args.length - 1];\n    if (o && o.constructor === Object && !(o instanceof Array)) {\n      return fn.apply(this, args.slice(0, -1)).attr(o);\n    } else {\n      return fn.apply(this, args);\n    }\n  };\n}\n\n// Get all siblings, including myself\nfunction siblings() {\n  return this.parent().children();\n}\n\n// Get the current position siblings\nfunction position() {\n  return this.parent().index(this);\n}\n\n// Get the next element (will return null if there is none)\nfunction next() {\n  return this.siblings()[this.position() + 1];\n}\n\n// Get the next element (will return null if there is none)\nfunction prev() {\n  return this.siblings()[this.position() - 1];\n}\n\n// Send given element one step forward\nfunction forward() {\n  const i = this.position();\n  const p = this.parent();\n\n  // move node one step forward\n  p.add(this.remove(), i + 1);\n  return this;\n}\n\n// Send given element one step backward\nfunction backward() {\n  const i = this.position();\n  const p = this.parent();\n  p.add(this.remove(), i ? i - 1 : 0);\n  return this;\n}\n\n// Send given element all the way to the front\nfunction front() {\n  const p = this.parent();\n\n  // Move node forward\n  p.add(this.remove());\n  return this;\n}\n\n// Send given element all the way to the back\nfunction back() {\n  const p = this.parent();\n\n  // Move node back\n  p.add(this.remove(), 0);\n  return this;\n}\n\n// Inserts a given element before the targeted element\nfunction before(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i);\n  return this;\n}\n\n// Inserts a given element after the targeted element\nfunction after(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i + 1);\n  return this;\n}\nfunction insertBefore(element) {\n  element = makeInstance(element);\n  element.before(this);\n  return this;\n}\nfunction insertAfter(element) {\n  element = makeInstance(element);\n  element.after(this);\n  return this;\n}\nregisterMethods('Dom', {\n  siblings,\n  position,\n  next,\n  prev,\n  forward,\n  backward,\n  front,\n  back,\n  before,\n  after,\n  insertBefore,\n  insertAfter\n});\n\n// Parse unit value\nconst numberAndUnit = /^([+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?)([a-z%]*)$/i;\n\n// Parse hex value\nconst hex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\n\n// Parse rgb value\nconst rgb = /rgb\\((\\d+),(\\d+),(\\d+)\\)/;\n\n// Parse reference id\nconst reference = /(#[a-z_][a-z0-9\\-_]*)/i;\n\n// splits a transformation chain\nconst transforms = /\\)\\s*,?\\s*/;\n\n// Whitespace\nconst whitespace = /\\s/g;\n\n// Test hex value\nconst isHex = /^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i;\n\n// Test rgb value\nconst isRgb = /^rgb\\(/;\n\n// Test for blank string\nconst isBlank = /^(\\s+)?$/;\n\n// Test for numeric string\nconst isNumber = /^[+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n// Test for image url\nconst isImage = /\\.(jpg|jpeg|png|gif|svg)(\\?[^=]+.*)?/i;\n\n// split at whitespace and comma\nconst delimiter = /[\\s,]+/;\n\n// Test for path letter\nconst isPathLetter = /[MLHVCSQTAZ]/i;\n\nvar regex = {\n  __proto__: null,\n  delimiter: delimiter,\n  hex: hex,\n  isBlank: isBlank,\n  isHex: isHex,\n  isImage: isImage,\n  isNumber: isNumber,\n  isPathLetter: isPathLetter,\n  isRgb: isRgb,\n  numberAndUnit: numberAndUnit,\n  reference: reference,\n  rgb: rgb,\n  transforms: transforms,\n  whitespace: whitespace\n};\n\n// Return array of classes on the node\nfunction classes() {\n  const attr = this.attr('class');\n  return attr == null ? [] : attr.trim().split(delimiter);\n}\n\n// Return true if class exists on the node, false otherwise\nfunction hasClass(name) {\n  return this.classes().indexOf(name) !== -1;\n}\n\n// Add class to the node\nfunction addClass(name) {\n  if (!this.hasClass(name)) {\n    const array = this.classes();\n    array.push(name);\n    this.attr('class', array.join(' '));\n  }\n  return this;\n}\n\n// Remove class from the node\nfunction removeClass(name) {\n  if (this.hasClass(name)) {\n    this.attr('class', this.classes().filter(function (c) {\n      return c !== name;\n    }).join(' '));\n  }\n  return this;\n}\n\n// Toggle the presence of a class on the node\nfunction toggleClass(name) {\n  return this.hasClass(name) ? this.removeClass(name) : this.addClass(name);\n}\nregisterMethods('Dom', {\n  classes,\n  hasClass,\n  addClass,\n  removeClass,\n  toggleClass\n});\n\n// Dynamic style generator\nfunction css(style, val) {\n  const ret = {};\n  if (arguments.length === 0) {\n    // get full style as object\n    this.node.style.cssText.split(/\\s*;\\s*/).filter(function (el) {\n      return !!el.length;\n    }).forEach(function (el) {\n      const t = el.split(/\\s*:\\s*/);\n      ret[t[0]] = t[1];\n    });\n    return ret;\n  }\n  if (arguments.length < 2) {\n    // get style properties as array\n    if (Array.isArray(style)) {\n      for (const name of style) {\n        const cased = name;\n        ret[name] = this.node.style.getPropertyValue(cased);\n      }\n      return ret;\n    }\n\n    // get style for property\n    if (typeof style === 'string') {\n      return this.node.style.getPropertyValue(style);\n    }\n\n    // set styles in object\n    if (typeof style === 'object') {\n      for (const name in style) {\n        // set empty string if null/undefined/'' was given\n        this.node.style.setProperty(name, style[name] == null || isBlank.test(style[name]) ? '' : style[name]);\n      }\n    }\n  }\n\n  // set style for property\n  if (arguments.length === 2) {\n    this.node.style.setProperty(style, val == null || isBlank.test(val) ? '' : val);\n  }\n  return this;\n}\n\n// Show element\nfunction show() {\n  return this.css('display', '');\n}\n\n// Hide element\nfunction hide() {\n  return this.css('display', 'none');\n}\n\n// Is element visible?\nfunction visible() {\n  return this.css('display') !== 'none';\n}\nregisterMethods('Dom', {\n  css,\n  show,\n  hide,\n  visible\n});\n\n// Store data values on svg nodes\nfunction data(a, v, r) {\n  if (a == null) {\n    // get an object of attributes\n    return this.data(map(filter(this.node.attributes, el => el.nodeName.indexOf('data-') === 0), el => el.nodeName.slice(5)));\n  } else if (a instanceof Array) {\n    const data = {};\n    for (const key of a) {\n      data[key] = this.data(key);\n    }\n    return data;\n  } else if (typeof a === 'object') {\n    for (v in a) {\n      this.data(v, a[v]);\n    }\n  } else if (arguments.length < 2) {\n    try {\n      return JSON.parse(this.attr('data-' + a));\n    } catch (e) {\n      return this.attr('data-' + a);\n    }\n  } else {\n    this.attr('data-' + a, v === null ? null : r === true || typeof v === 'string' || typeof v === 'number' ? v : JSON.stringify(v));\n  }\n  return this;\n}\nregisterMethods('Dom', {\n  data\n});\n\n// Remember arbitrary data\nfunction remember(k, v) {\n  // remember every item in an object individually\n  if (typeof arguments[0] === 'object') {\n    for (const key in k) {\n      this.remember(key, k[key]);\n    }\n  } else if (arguments.length === 1) {\n    // retrieve memory\n    return this.memory()[k];\n  } else {\n    // store memory\n    this.memory()[k] = v;\n  }\n  return this;\n}\n\n// Erase a given memory\nfunction forget() {\n  if (arguments.length === 0) {\n    this._memory = {};\n  } else {\n    for (let i = arguments.length - 1; i >= 0; i--) {\n      delete this.memory()[arguments[i]];\n    }\n  }\n  return this;\n}\n\n// This triggers creation of a new hidden class which is not performant\n// However, this function is not rarely used so it will not happen frequently\n// Return local memory object\nfunction memory() {\n  return this._memory = this._memory || {};\n}\nregisterMethods('Dom', {\n  remember,\n  forget,\n  memory\n});\n\nfunction sixDigitHex(hex) {\n  return hex.length === 4 ? ['#', hex.substring(1, 2), hex.substring(1, 2), hex.substring(2, 3), hex.substring(2, 3), hex.substring(3, 4), hex.substring(3, 4)].join('') : hex;\n}\nfunction componentHex(component) {\n  const integer = Math.round(component);\n  const bounded = Math.max(0, Math.min(255, integer));\n  const hex = bounded.toString(16);\n  return hex.length === 1 ? '0' + hex : hex;\n}\nfunction is(object, space) {\n  for (let i = space.length; i--;) {\n    if (object[space[i]] == null) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction getParameters(a, b) {\n  const params = is(a, 'rgb') ? {\n    _a: a.r,\n    _b: a.g,\n    _c: a.b,\n    _d: 0,\n    space: 'rgb'\n  } : is(a, 'xyz') ? {\n    _a: a.x,\n    _b: a.y,\n    _c: a.z,\n    _d: 0,\n    space: 'xyz'\n  } : is(a, 'hsl') ? {\n    _a: a.h,\n    _b: a.s,\n    _c: a.l,\n    _d: 0,\n    space: 'hsl'\n  } : is(a, 'lab') ? {\n    _a: a.l,\n    _b: a.a,\n    _c: a.b,\n    _d: 0,\n    space: 'lab'\n  } : is(a, 'lch') ? {\n    _a: a.l,\n    _b: a.c,\n    _c: a.h,\n    _d: 0,\n    space: 'lch'\n  } : is(a, 'cmyk') ? {\n    _a: a.c,\n    _b: a.m,\n    _c: a.y,\n    _d: a.k,\n    space: 'cmyk'\n  } : {\n    _a: 0,\n    _b: 0,\n    _c: 0,\n    space: 'rgb'\n  };\n  params.space = b || params.space;\n  return params;\n}\nfunction cieSpace(space) {\n  if (space === 'lab' || space === 'xyz' || space === 'lch') {\n    return true;\n  } else {\n    return false;\n  }\n}\nfunction hueToRgb(p, q, t) {\n  if (t < 0) t += 1;\n  if (t > 1) t -= 1;\n  if (t < 1 / 6) return p + (q - p) * 6 * t;\n  if (t < 1 / 2) return q;\n  if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n  return p;\n}\nclass Color {\n  constructor(...inputs) {\n    this.init(...inputs);\n  }\n\n  // Test if given value is a color\n  static isColor(color) {\n    return color && (color instanceof Color || this.isRgb(color) || this.test(color));\n  }\n\n  // Test if given value is an rgb object\n  static isRgb(color) {\n    return color && typeof color.r === 'number' && typeof color.g === 'number' && typeof color.b === 'number';\n  }\n\n  /*\n  Generating random colors\n  */\n  static random(mode = 'vibrant', t) {\n    // Get the math modules\n    const {\n      random,\n      round,\n      sin,\n      PI: pi\n    } = Math;\n\n    // Run the correct generator\n    if (mode === 'vibrant') {\n      const l = (81 - 57) * random() + 57;\n      const c = (83 - 45) * random() + 45;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'sine') {\n      t = t == null ? random() : t;\n      const r = round(80 * sin(2 * pi * t / 0.5 + 0.01) + 150);\n      const g = round(50 * sin(2 * pi * t / 0.5 + 4.6) + 200);\n      const b = round(100 * sin(2 * pi * t / 0.5 + 2.3) + 150);\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'pastel') {\n      const l = (94 - 86) * random() + 86;\n      const c = (26 - 9) * random() + 9;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'dark') {\n      const l = 10 + 10 * random();\n      const c = (125 - 75) * random() + 86;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'rgb') {\n      const r = 255 * random();\n      const g = 255 * random();\n      const b = 255 * random();\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'lab') {\n      const l = 100 * random();\n      const a = 256 * random() - 128;\n      const b = 256 * random() - 128;\n      const color = new Color(l, a, b, 'lab');\n      return color;\n    } else if (mode === 'grey') {\n      const grey = 255 * random();\n      const color = new Color(grey, grey, grey);\n      return color;\n    } else {\n      throw new Error('Unsupported random color mode');\n    }\n  }\n\n  // Test if given value is a color string\n  static test(color) {\n    return typeof color === 'string' && (isHex.test(color) || isRgb.test(color));\n  }\n  cmyk() {\n    // Get the rgb values for the current color\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Get the cmyk values in an unbounded format\n    const k = Math.min(1 - r, 1 - g, 1 - b);\n    if (k === 1) {\n      // Catch the black case\n      return new Color(0, 0, 0, 1, 'cmyk');\n    }\n    const c = (1 - r - k) / (1 - k);\n    const m = (1 - g - k) / (1 - k);\n    const y = (1 - b - k) / (1 - k);\n\n    // Construct the new color\n    const color = new Color(c, m, y, k, 'cmyk');\n    return color;\n  }\n  hsl() {\n    // Get the rgb values\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Find the maximum and minimum values to get the lightness\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    const l = (max + min) / 2;\n\n    // If the r, g, v values are identical then we are grey\n    const isGrey = max === min;\n\n    // Calculate the hue and saturation\n    const delta = max - min;\n    const s = isGrey ? 0 : l > 0.5 ? delta / (2 - max - min) : delta / (max + min);\n    const h = isGrey ? 0 : max === r ? ((g - b) / delta + (g < b ? 6 : 0)) / 6 : max === g ? ((b - r) / delta + 2) / 6 : max === b ? ((r - g) / delta + 4) / 6 : 0;\n\n    // Construct and return the new color\n    const color = new Color(360 * h, 100 * s, 100 * l, 'hsl');\n    return color;\n  }\n  init(a = 0, b = 0, c = 0, d = 0, space = 'rgb') {\n    // This catches the case when a falsy value is passed like ''\n    a = !a ? 0 : a;\n\n    // Reset all values in case the init function is rerun with new color space\n    if (this.space) {\n      for (const component in this.space) {\n        delete this[this.space[component]];\n      }\n    }\n    if (typeof a === 'number') {\n      // Allow for the case that we don't need d...\n      space = typeof d === 'string' ? d : space;\n      d = typeof d === 'string' ? 0 : d;\n\n      // Assign the values straight to the color\n      Object.assign(this, {\n        _a: a,\n        _b: b,\n        _c: c,\n        _d: d,\n        space\n      });\n      // If the user gave us an array, make the color from it\n    } else if (a instanceof Array) {\n      this.space = b || (typeof a[3] === 'string' ? a[3] : a[4]) || 'rgb';\n      Object.assign(this, {\n        _a: a[0],\n        _b: a[1],\n        _c: a[2],\n        _d: a[3] || 0\n      });\n    } else if (a instanceof Object) {\n      // Set the object up and assign its values directly\n      const values = getParameters(a, b);\n      Object.assign(this, values);\n    } else if (typeof a === 'string') {\n      if (isRgb.test(a)) {\n        const noWhitespace = a.replace(whitespace, '');\n        const [_a, _b, _c] = rgb.exec(noWhitespace).slice(1, 4).map(v => parseInt(v));\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else if (isHex.test(a)) {\n        const hexParse = v => parseInt(v, 16);\n        const [, _a, _b, _c] = hex.exec(sixDigitHex(a)).map(hexParse);\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else throw Error(\"Unsupported string format, can't construct Color\");\n    }\n\n    // Now add the components as a convenience\n    const {\n      _a,\n      _b,\n      _c,\n      _d\n    } = this;\n    const components = this.space === 'rgb' ? {\n      r: _a,\n      g: _b,\n      b: _c\n    } : this.space === 'xyz' ? {\n      x: _a,\n      y: _b,\n      z: _c\n    } : this.space === 'hsl' ? {\n      h: _a,\n      s: _b,\n      l: _c\n    } : this.space === 'lab' ? {\n      l: _a,\n      a: _b,\n      b: _c\n    } : this.space === 'lch' ? {\n      l: _a,\n      c: _b,\n      h: _c\n    } : this.space === 'cmyk' ? {\n      c: _a,\n      m: _b,\n      y: _c,\n      k: _d\n    } : {};\n    Object.assign(this, components);\n  }\n  lab() {\n    // Get the xyz color\n    const {\n      x,\n      y,\n      z\n    } = this.xyz();\n\n    // Get the lab components\n    const l = 116 * y - 16;\n    const a = 500 * (x - y);\n    const b = 200 * (y - z);\n\n    // Construct and return a new color\n    const color = new Color(l, a, b, 'lab');\n    return color;\n  }\n  lch() {\n    // Get the lab color directly\n    const {\n      l,\n      a,\n      b\n    } = this.lab();\n\n    // Get the chromaticity and the hue using polar coordinates\n    const c = Math.sqrt(a ** 2 + b ** 2);\n    let h = 180 * Math.atan2(b, a) / Math.PI;\n    if (h < 0) {\n      h *= -1;\n      h = 360 - h;\n    }\n\n    // Make a new color and return it\n    const color = new Color(l, c, h, 'lch');\n    return color;\n  }\n  /*\n  Conversion Methods\n  */\n\n  rgb() {\n    if (this.space === 'rgb') {\n      return this;\n    } else if (cieSpace(this.space)) {\n      // Convert to the xyz color space\n      let {\n        x,\n        y,\n        z\n      } = this;\n      if (this.space === 'lab' || this.space === 'lch') {\n        // Get the values in the lab space\n        let {\n          l,\n          a,\n          b\n        } = this;\n        if (this.space === 'lch') {\n          const {\n            c,\n            h\n          } = this;\n          const dToR = Math.PI / 180;\n          a = c * Math.cos(dToR * h);\n          b = c * Math.sin(dToR * h);\n        }\n\n        // Undo the nonlinear function\n        const yL = (l + 16) / 116;\n        const xL = a / 500 + yL;\n        const zL = yL - b / 200;\n\n        // Get the xyz values\n        const ct = 16 / 116;\n        const mx = 0.008856;\n        const nm = 7.787;\n        x = 0.95047 * (xL ** 3 > mx ? xL ** 3 : (xL - ct) / nm);\n        y = 1.0 * (yL ** 3 > mx ? yL ** 3 : (yL - ct) / nm);\n        z = 1.08883 * (zL ** 3 > mx ? zL ** 3 : (zL - ct) / nm);\n      }\n\n      // Convert xyz to unbounded rgb values\n      const rU = x * 3.2406 + y * -1.5372 + z * -0.4986;\n      const gU = x * -0.9689 + y * 1.8758 + z * 0.0415;\n      const bU = x * 0.0557 + y * -0.204 + z * 1.057;\n\n      // Convert the values to true rgb values\n      const pow = Math.pow;\n      const bd = 0.0031308;\n      const r = rU > bd ? 1.055 * pow(rU, 1 / 2.4) - 0.055 : 12.92 * rU;\n      const g = gU > bd ? 1.055 * pow(gU, 1 / 2.4) - 0.055 : 12.92 * gU;\n      const b = bU > bd ? 1.055 * pow(bU, 1 / 2.4) - 0.055 : 12.92 * bU;\n\n      // Make and return the color\n      const color = new Color(255 * r, 255 * g, 255 * b);\n      return color;\n    } else if (this.space === 'hsl') {\n      // https://bgrins.github.io/TinyColor/docs/tinycolor.html\n      // Get the current hsl values\n      let {\n        h,\n        s,\n        l\n      } = this;\n      h /= 360;\n      s /= 100;\n      l /= 100;\n\n      // If we are grey, then just make the color directly\n      if (s === 0) {\n        l *= 255;\n        const color = new Color(l, l, l);\n        return color;\n      }\n\n      // TODO I have no idea what this does :D If you figure it out, tell me!\n      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      const p = 2 * l - q;\n\n      // Get the rgb values\n      const r = 255 * hueToRgb(p, q, h + 1 / 3);\n      const g = 255 * hueToRgb(p, q, h);\n      const b = 255 * hueToRgb(p, q, h - 1 / 3);\n\n      // Make a new color\n      const color = new Color(r, g, b);\n      return color;\n    } else if (this.space === 'cmyk') {\n      // https://gist.github.com/felipesabino/5066336\n      // Get the normalised cmyk values\n      const {\n        c,\n        m,\n        y,\n        k\n      } = this;\n\n      // Get the rgb values\n      const r = 255 * (1 - Math.min(1, c * (1 - k) + k));\n      const g = 255 * (1 - Math.min(1, m * (1 - k) + k));\n      const b = 255 * (1 - Math.min(1, y * (1 - k) + k));\n\n      // Form the color and return it\n      const color = new Color(r, g, b);\n      return color;\n    } else {\n      return this;\n    }\n  }\n  toArray() {\n    const {\n      _a,\n      _b,\n      _c,\n      _d,\n      space\n    } = this;\n    return [_a, _b, _c, _d, space];\n  }\n  toHex() {\n    const [r, g, b] = this._clamped().map(componentHex);\n    return `#${r}${g}${b}`;\n  }\n  toRgb() {\n    const [rV, gV, bV] = this._clamped();\n    const string = `rgb(${rV},${gV},${bV})`;\n    return string;\n  }\n  toString() {\n    return this.toHex();\n  }\n  xyz() {\n    // Normalise the red, green and blue values\n    const {\n      _a: r255,\n      _b: g255,\n      _c: b255\n    } = this.rgb();\n    const [r, g, b] = [r255, g255, b255].map(v => v / 255);\n\n    // Convert to the lab rgb space\n    const rL = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\n    const gL = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\n    const bL = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\n\n    // Convert to the xyz color space without bounding the values\n    const xU = (rL * 0.4124 + gL * 0.3576 + bL * 0.1805) / 0.95047;\n    const yU = (rL * 0.2126 + gL * 0.7152 + bL * 0.0722) / 1.0;\n    const zU = (rL * 0.0193 + gL * 0.1192 + bL * 0.9505) / 1.08883;\n\n    // Get the proper xyz values by applying the bounding\n    const x = xU > 0.008856 ? Math.pow(xU, 1 / 3) : 7.787 * xU + 16 / 116;\n    const y = yU > 0.008856 ? Math.pow(yU, 1 / 3) : 7.787 * yU + 16 / 116;\n    const z = zU > 0.008856 ? Math.pow(zU, 1 / 3) : 7.787 * zU + 16 / 116;\n\n    // Make and return the color\n    const color = new Color(x, y, z, 'xyz');\n    return color;\n  }\n\n  /*\n  Input and Output methods\n  */\n\n  _clamped() {\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const {\n      max,\n      min,\n      round\n    } = Math;\n    const format = v => max(0, min(round(v), 255));\n    return [_a, _b, _c].map(format);\n  }\n\n  /*\n  Constructing colors\n  */\n}\n\nclass Point {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n\n  // Clone point\n  clone() {\n    return new Point(this);\n  }\n  init(x, y) {\n    const base = {\n      x: 0,\n      y: 0\n    };\n\n    // ensure source as object\n    const source = Array.isArray(x) ? {\n      x: x[0],\n      y: x[1]\n    } : typeof x === 'object' ? {\n      x: x.x,\n      y: x.y\n    } : {\n      x: x,\n      y: y\n    };\n\n    // merge source\n    this.x = source.x == null ? base.x : source.x;\n    this.y = source.y == null ? base.y : source.y;\n    return this;\n  }\n  toArray() {\n    return [this.x, this.y];\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // Transform point with matrix\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    const {\n      x,\n      y\n    } = this;\n\n    // Perform the matrix multiplication\n    this.x = m.a * x + m.c * y + m.e;\n    this.y = m.b * x + m.d * y + m.f;\n    return this;\n  }\n}\nfunction point(x, y) {\n  return new Point(x, y).transformO(this.screenCTM().inverseO());\n}\n\nfunction closeEnough(a, b, threshold) {\n  return Math.abs(b - a) < (1e-6);\n}\nclass Matrix {\n  constructor(...args) {\n    this.init(...args);\n  }\n  static formatTransforms(o) {\n    // Get all of the parameters required to form the matrix\n    const flipBoth = o.flip === 'both' || o.flip === true;\n    const flipX = o.flip && (flipBoth || o.flip === 'x') ? -1 : 1;\n    const flipY = o.flip && (flipBoth || o.flip === 'y') ? -1 : 1;\n    const skewX = o.skew && o.skew.length ? o.skew[0] : isFinite(o.skew) ? o.skew : isFinite(o.skewX) ? o.skewX : 0;\n    const skewY = o.skew && o.skew.length ? o.skew[1] : isFinite(o.skew) ? o.skew : isFinite(o.skewY) ? o.skewY : 0;\n    const scaleX = o.scale && o.scale.length ? o.scale[0] * flipX : isFinite(o.scale) ? o.scale * flipX : isFinite(o.scaleX) ? o.scaleX * flipX : flipX;\n    const scaleY = o.scale && o.scale.length ? o.scale[1] * flipY : isFinite(o.scale) ? o.scale * flipY : isFinite(o.scaleY) ? o.scaleY * flipY : flipY;\n    const shear = o.shear || 0;\n    const theta = o.rotate || o.theta || 0;\n    const origin = new Point(o.origin || o.around || o.ox || o.originX, o.oy || o.originY);\n    const ox = origin.x;\n    const oy = origin.y;\n    // We need Point to be invalid if nothing was passed because we cannot default to 0 here. That is why NaN\n    const position = new Point(o.position || o.px || o.positionX || NaN, o.py || o.positionY || NaN);\n    const px = position.x;\n    const py = position.y;\n    const translate = new Point(o.translate || o.tx || o.translateX, o.ty || o.translateY);\n    const tx = translate.x;\n    const ty = translate.y;\n    const relative = new Point(o.relative || o.rx || o.relativeX, o.ry || o.relativeY);\n    const rx = relative.x;\n    const ry = relative.y;\n\n    // Populate all of the values\n    return {\n      scaleX,\n      scaleY,\n      skewX,\n      skewY,\n      shear,\n      theta,\n      rx,\n      ry,\n      tx,\n      ty,\n      ox,\n      oy,\n      px,\n      py\n    };\n  }\n  static fromArray(a) {\n    return {\n      a: a[0],\n      b: a[1],\n      c: a[2],\n      d: a[3],\n      e: a[4],\n      f: a[5]\n    };\n  }\n  static isMatrixLike(o) {\n    return o.a != null || o.b != null || o.c != null || o.d != null || o.e != null || o.f != null;\n  }\n\n  // left matrix, right matrix, target matrix which is overwritten\n  static matrixMultiply(l, r, o) {\n    // Work out the product directly\n    const a = l.a * r.a + l.c * r.b;\n    const b = l.b * r.a + l.d * r.b;\n    const c = l.a * r.c + l.c * r.d;\n    const d = l.b * r.c + l.d * r.d;\n    const e = l.e + l.a * r.e + l.c * r.f;\n    const f = l.f + l.b * r.e + l.d * r.f;\n\n    // make sure to use local variables because l/r and o could be the same\n    o.a = a;\n    o.b = b;\n    o.c = c;\n    o.d = d;\n    o.e = e;\n    o.f = f;\n    return o;\n  }\n  around(cx, cy, matrix) {\n    return this.clone().aroundO(cx, cy, matrix);\n  }\n\n  // Transform around a center point\n  aroundO(cx, cy, matrix) {\n    const dx = cx || 0;\n    const dy = cy || 0;\n    return this.translateO(-dx, -dy).lmultiplyO(matrix).translateO(dx, dy);\n  }\n\n  // Clones this matrix\n  clone() {\n    return new Matrix(this);\n  }\n\n  // Decomposes this matrix into its affine parameters\n  decompose(cx = 0, cy = 0) {\n    // Get the parameters from the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Figure out if the winding direction is clockwise or counterclockwise\n    const determinant = a * d - b * c;\n    const ccw = determinant > 0 ? 1 : -1;\n\n    // Since we only shear in x, we can use the x basis to get the x scale\n    // and the rotation of the resulting matrix\n    const sx = ccw * Math.sqrt(a * a + b * b);\n    const thetaRad = Math.atan2(ccw * b, ccw * a);\n    const theta = 180 / Math.PI * thetaRad;\n    const ct = Math.cos(thetaRad);\n    const st = Math.sin(thetaRad);\n\n    // We can then solve the y basis vector simultaneously to get the other\n    // two affine parameters directly from these parameters\n    const lam = (a * c + b * d) / determinant;\n    const sy = c * sx / (lam * a - b) || d * sx / (lam * b + a);\n\n    // Use the translations\n    const tx = e - cx + cx * ct * sx + cy * (lam * ct * sx - st * sy);\n    const ty = f - cy + cx * st * sx + cy * (lam * st * sx + ct * sy);\n\n    // Construct the decomposition and return it\n    return {\n      // Return the affine parameters\n      scaleX: sx,\n      scaleY: sy,\n      shear: lam,\n      rotate: theta,\n      translateX: tx,\n      translateY: ty,\n      originX: cx,\n      originY: cy,\n      // Return the matrix parameters\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n\n  // Check if two matrices are equal\n  equals(other) {\n    if (other === this) return true;\n    const comp = new Matrix(other);\n    return closeEnough(this.a, comp.a) && closeEnough(this.b, comp.b) && closeEnough(this.c, comp.c) && closeEnough(this.d, comp.d) && closeEnough(this.e, comp.e) && closeEnough(this.f, comp.f);\n  }\n\n  // Flip matrix on x or y, at a given offset\n  flip(axis, around) {\n    return this.clone().flipO(axis, around);\n  }\n  flipO(axis, around) {\n    return axis === 'x' ? this.scaleO(-1, 1, around, 0) : axis === 'y' ? this.scaleO(1, -1, 0, around) : this.scaleO(-1, -1, axis, around || axis); // Define an x, y flip point\n  }\n\n  // Initialize\n  init(source) {\n    const base = Matrix.fromArray([1, 0, 0, 1, 0, 0]);\n\n    // ensure source as object\n    source = source instanceof Element ? source.matrixify() : typeof source === 'string' ? Matrix.fromArray(source.split(delimiter).map(parseFloat)) : Array.isArray(source) ? Matrix.fromArray(source) : typeof source === 'object' && Matrix.isMatrixLike(source) ? source : typeof source === 'object' ? new Matrix().transform(source) : arguments.length === 6 ? Matrix.fromArray([].slice.call(arguments)) : base;\n\n    // Merge the source matrix with the base matrix\n    this.a = source.a != null ? source.a : base.a;\n    this.b = source.b != null ? source.b : base.b;\n    this.c = source.c != null ? source.c : base.c;\n    this.d = source.d != null ? source.d : base.d;\n    this.e = source.e != null ? source.e : base.e;\n    this.f = source.f != null ? source.f : base.f;\n    return this;\n  }\n  inverse() {\n    return this.clone().inverseO();\n  }\n\n  // Inverses matrix\n  inverseO() {\n    // Get the current parameters out of the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Invert the 2x2 matrix in the top left\n    const det = a * d - b * c;\n    if (!det) throw new Error('Cannot invert ' + this);\n\n    // Calculate the top 2x2 matrix\n    const na = d / det;\n    const nb = -b / det;\n    const nc = -c / det;\n    const nd = a / det;\n\n    // Apply the inverted matrix to the top right\n    const ne = -(na * e + nc * f);\n    const nf = -(nb * e + nd * f);\n\n    // Construct the inverted matrix\n    this.a = na;\n    this.b = nb;\n    this.c = nc;\n    this.d = nd;\n    this.e = ne;\n    this.f = nf;\n    return this;\n  }\n  lmultiply(matrix) {\n    return this.clone().lmultiplyO(matrix);\n  }\n  lmultiplyO(matrix) {\n    const r = this;\n    const l = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Left multiplies by the given matrix\n  multiply(matrix) {\n    return this.clone().multiplyO(matrix);\n  }\n  multiplyO(matrix) {\n    // Get the matrices\n    const l = this;\n    const r = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Rotate matrix\n  rotate(r, cx, cy) {\n    return this.clone().rotateO(r, cx, cy);\n  }\n  rotateO(r, cx = 0, cy = 0) {\n    // Convert degrees to radians\n    r = radians(r);\n    const cos = Math.cos(r);\n    const sin = Math.sin(r);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * cos - b * sin;\n    this.b = b * cos + a * sin;\n    this.c = c * cos - d * sin;\n    this.d = d * cos + c * sin;\n    this.e = e * cos - f * sin + cy * sin - cx * cos + cx;\n    this.f = f * cos + e * sin - cx * sin - cy * cos + cy;\n    return this;\n  }\n\n  // Scale matrix\n  scale() {\n    return this.clone().scaleO(...arguments);\n  }\n  scaleO(x, y = x, cx = 0, cy = 0) {\n    // Support uniform scaling\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * x;\n    this.b = b * y;\n    this.c = c * x;\n    this.d = d * y;\n    this.e = e * x - cx * x + cx;\n    this.f = f * y - cy * y + cy;\n    return this;\n  }\n\n  // Shear matrix\n  shear(a, cx, cy) {\n    return this.clone().shearO(a, cx, cy);\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  shearO(lx, cx = 0, cy = 0) {\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.c = c + d * lx;\n    this.e = e + f * lx - cy * lx;\n    return this;\n  }\n\n  // Skew Matrix\n  skew() {\n    return this.clone().skewO(...arguments);\n  }\n  skewO(x, y = x, cx = 0, cy = 0) {\n    // support uniformal skew\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n\n    // Convert degrees to radians\n    x = radians(x);\n    y = radians(y);\n    const lx = Math.tan(x);\n    const ly = Math.tan(y);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.b = b + a * ly;\n    this.c = c + d * lx;\n    this.d = d + c * ly;\n    this.e = e + f * lx - cy * lx;\n    this.f = f + e * ly - cx * ly;\n    return this;\n  }\n\n  // SkewX\n  skewX(x, cx, cy) {\n    return this.skew(x, 0, cx, cy);\n  }\n\n  // SkewY\n  skewY(y, cx, cy) {\n    return this.skew(0, y, cx, cy);\n  }\n  toArray() {\n    return [this.a, this.b, this.c, this.d, this.e, this.f];\n  }\n\n  // Convert matrix to string\n  toString() {\n    return 'matrix(' + this.a + ',' + this.b + ',' + this.c + ',' + this.d + ',' + this.e + ',' + this.f + ')';\n  }\n\n  // Transform a matrix into another matrix by manipulating the space\n  transform(o) {\n    // Check if o is a matrix and then left multiply it directly\n    if (Matrix.isMatrixLike(o)) {\n      const matrix = new Matrix(o);\n      return matrix.multiplyO(this);\n    }\n\n    // Get the proposed transformations and the current transformations\n    const t = Matrix.formatTransforms(o);\n    const current = this;\n    const {\n      x: ox,\n      y: oy\n    } = new Point(t.ox, t.oy).transform(current);\n\n    // Construct the resulting matrix\n    const transformer = new Matrix().translateO(t.rx, t.ry).lmultiplyO(current).translateO(-ox, -oy).scaleO(t.scaleX, t.scaleY).skewO(t.skewX, t.skewY).shearO(t.shear).rotateO(t.theta).translateO(ox, oy);\n\n    // If we want the origin at a particular place, we force it there\n    if (isFinite(t.px) || isFinite(t.py)) {\n      const origin = new Point(ox, oy).transform(transformer);\n      // TODO: Replace t.px with isFinite(t.px)\n      // Doesn't work because t.px is also 0 if it wasn't passed\n      const dx = isFinite(t.px) ? t.px - origin.x : 0;\n      const dy = isFinite(t.py) ? t.py - origin.y : 0;\n      transformer.translateO(dx, dy);\n    }\n\n    // Translate now after positioning\n    transformer.translateO(t.tx, t.ty);\n    return transformer;\n  }\n\n  // Translate matrix\n  translate(x, y) {\n    return this.clone().translateO(x, y);\n  }\n  translateO(x, y) {\n    this.e += x || 0;\n    this.f += y || 0;\n    return this;\n  }\n  valueOf() {\n    return {\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n}\nfunction ctm() {\n  return new Matrix(this.node.getCTM());\n}\nfunction screenCTM() {\n  try {\n    /* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537\n       This is needed because FF does not return the transformation matrix\n       for the inner coordinate system when getScreenCTM() is called on nested svgs.\n       However all other Browsers do that */\n    if (typeof this.isRoot === 'function' && !this.isRoot()) {\n      const rect = this.rect(1, 1);\n      const m = rect.node.getScreenCTM();\n      rect.remove();\n      return new Matrix(m);\n    }\n    return new Matrix(this.node.getScreenCTM());\n  } catch (e) {\n    console.warn(`Cannot get CTM from SVG node ${this.node.nodeName}. Is the element rendered?`);\n    return new Matrix();\n  }\n}\nregister(Matrix, 'Matrix');\n\nfunction parser() {\n  // Reuse cached element if possible\n  if (!parser.nodes) {\n    const svg = makeInstance().size(2, 0);\n    svg.node.style.cssText = ['opacity: 0', 'position: absolute', 'left: -100%', 'top: -100%', 'overflow: hidden'].join(';');\n    svg.attr('focusable', 'false');\n    svg.attr('aria-hidden', 'true');\n    const path = svg.path().node;\n    parser.nodes = {\n      svg,\n      path\n    };\n  }\n  if (!parser.nodes.svg.node.parentNode) {\n    const b = globals.document.body || globals.document.documentElement;\n    parser.nodes.svg.addTo(b);\n  }\n  return parser.nodes;\n}\n\nfunction isNulledBox(box) {\n  return !box.width && !box.height && !box.x && !box.y;\n}\nfunction domContains(node) {\n  return node === globals.document || (globals.document.documentElement.contains || function (node) {\n    // This is IE - it does not support contains() for top-level SVGs\n    while (node.parentNode) {\n      node = node.parentNode;\n    }\n    return node === globals.document;\n  }).call(globals.document.documentElement, node);\n}\nclass Box {\n  constructor(...args) {\n    this.init(...args);\n  }\n  addOffset() {\n    // offset by window scroll position, because getBoundingClientRect changes when window is scrolled\n    this.x += globals.window.pageXOffset;\n    this.y += globals.window.pageYOffset;\n    return new Box(this);\n  }\n  init(source) {\n    const base = [0, 0, 0, 0];\n    source = typeof source === 'string' ? source.split(delimiter).map(parseFloat) : Array.isArray(source) ? source : typeof source === 'object' ? [source.left != null ? source.left : source.x, source.top != null ? source.top : source.y, source.width, source.height] : arguments.length === 4 ? [].slice.call(arguments) : base;\n    this.x = source[0] || 0;\n    this.y = source[1] || 0;\n    this.width = this.w = source[2] || 0;\n    this.height = this.h = source[3] || 0;\n\n    // Add more bounding box properties\n    this.x2 = this.x + this.w;\n    this.y2 = this.y + this.h;\n    this.cx = this.x + this.w / 2;\n    this.cy = this.y + this.h / 2;\n    return this;\n  }\n  isNulled() {\n    return isNulledBox(this);\n  }\n\n  // Merge rect box with another, return a new instance\n  merge(box) {\n    const x = Math.min(this.x, box.x);\n    const y = Math.min(this.y, box.y);\n    const width = Math.max(this.x + this.width, box.x + box.width) - x;\n    const height = Math.max(this.y + this.height, box.y + box.height) - y;\n    return new Box(x, y, width, height);\n  }\n  toArray() {\n    return [this.x, this.y, this.width, this.height];\n  }\n  toString() {\n    return this.x + ' ' + this.y + ' ' + this.width + ' ' + this.height;\n  }\n  transform(m) {\n    if (!(m instanceof Matrix)) {\n      m = new Matrix(m);\n    }\n    let xMin = Infinity;\n    let xMax = -Infinity;\n    let yMin = Infinity;\n    let yMax = -Infinity;\n    const pts = [new Point(this.x, this.y), new Point(this.x2, this.y), new Point(this.x, this.y2), new Point(this.x2, this.y2)];\n    pts.forEach(function (p) {\n      p = p.transform(m);\n      xMin = Math.min(xMin, p.x);\n      xMax = Math.max(xMax, p.x);\n      yMin = Math.min(yMin, p.y);\n      yMax = Math.max(yMax, p.y);\n    });\n    return new Box(xMin, yMin, xMax - xMin, yMax - yMin);\n  }\n}\nfunction getBox(el, getBBoxFn, retry) {\n  let box;\n  try {\n    // Try to get the box with the provided function\n    box = getBBoxFn(el.node);\n\n    // If the box is worthless and not even in the dom, retry\n    // by throwing an error here...\n    if (isNulledBox(box) && !domContains(el.node)) {\n      throw new Error('Element not in the dom');\n    }\n  } catch (e) {\n    // ... and calling the retry handler here\n    box = retry(el);\n  }\n  return box;\n}\nfunction bbox() {\n  // Function to get bbox is getBBox()\n  const getBBox = node => node.getBBox();\n\n  // Take all measures so that a stupid browser renders the element\n  // so we can get the bbox from it when we try again\n  const retry = el => {\n    try {\n      const clone = el.clone().addTo(parser().svg).show();\n      const box = clone.node.getBBox();\n      clone.remove();\n      return box;\n    } catch (e) {\n      // We give up...\n      throw new Error(`Getting bbox of element \"${el.node.nodeName}\" is not possible: ${e.toString()}`);\n    }\n  };\n  const box = getBox(this, getBBox, retry);\n  const bbox = new Box(box);\n  return bbox;\n}\nfunction rbox(el) {\n  const getRBox = node => node.getBoundingClientRect();\n  const retry = el => {\n    // There is no point in trying tricks here because if we insert the element into the dom ourselves\n    // it obviously will be at the wrong position\n    throw new Error(`Getting rbox of element \"${el.node.nodeName}\" is not possible`);\n  };\n  const box = getBox(this, getRBox, retry);\n  const rbox = new Box(box);\n\n  // If an element was passed, we want the bbox in the coordinate system of that element\n  if (el) {\n    return rbox.transform(el.screenCTM().inverseO());\n  }\n\n  // Else we want it in absolute screen coordinates\n  // Therefore we need to add the scrollOffset\n  return rbox.addOffset();\n}\n\n// Checks whether the given point is inside the bounding box\nfunction inside(x, y) {\n  const box = this.bbox();\n  return x > box.x && y > box.y && x < box.x + box.width && y < box.y + box.height;\n}\nregisterMethods({\n  viewbox: {\n    viewbox(x, y, width, height) {\n      // act as getter\n      if (x == null) return new Box(this.attr('viewBox'));\n\n      // act as setter\n      return this.attr('viewBox', new Box(x, y, width, height));\n    },\n    zoom(level, point) {\n      // Its best to rely on the attributes here and here is why:\n      // clientXYZ: Doesn't work on non-root svgs because they dont have a CSSBox (silly!)\n      // getBoundingClientRect: Doesn't work because Chrome just ignores width and height of nested svgs completely\n      //                        that means, their clientRect is always as big as the content.\n      //                        Furthermore this size is incorrect if the element is further transformed by its parents\n      // computedStyle: Only returns meaningful values if css was used with px. We dont go this route here!\n      // getBBox: returns the bounding box of its content - that doesn't help!\n      let {\n        width,\n        height\n      } = this.attr(['width', 'height']);\n\n      // Width and height is a string when a number with a unit is present which we can't use\n      // So we try clientXYZ\n      if (!width && !height || typeof width === 'string' || typeof height === 'string') {\n        width = this.node.clientWidth;\n        height = this.node.clientHeight;\n      }\n\n      // Giving up...\n      if (!width || !height) {\n        throw new Error('Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element');\n      }\n      const v = this.viewbox();\n      const zoomX = width / v.width;\n      const zoomY = height / v.height;\n      const zoom = Math.min(zoomX, zoomY);\n      if (level == null) {\n        return zoom;\n      }\n      let zoomAmount = zoom / level;\n\n      // Set the zoomAmount to the highest value which is safe to process and recover from\n      // The * 100 is a bit of wiggle room for the matrix transformation\n      if (zoomAmount === Infinity) zoomAmount = Number.MAX_SAFE_INTEGER / 100;\n      point = point || new Point(width / 2 / zoomX + v.x, height / 2 / zoomY + v.y);\n      const box = new Box(v).transform(new Matrix({\n        scale: zoomAmount,\n        origin: point\n      }));\n      return this.viewbox(box);\n    }\n  }\n});\nregister(Box, 'Box');\n\n// import { subClassArray } from './ArrayPolyfill.js'\n\nclass List extends Array {\n  constructor(arr = [], ...args) {\n    super(arr, ...args);\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...arr);\n  }\n}\nextend([List], {\n  each(fnOrMethodName, ...args) {\n    if (typeof fnOrMethodName === 'function') {\n      return this.map((el, i, arr) => {\n        return fnOrMethodName.call(el, el, i, arr);\n      });\n    } else {\n      return this.map(el => {\n        return el[fnOrMethodName](...args);\n      });\n    }\n  },\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n});\nconst reserved = ['toArray', 'constructor', 'each'];\nList.extend = function (methods) {\n  methods = methods.reduce((obj, name) => {\n    // Don't overwrite own methods\n    if (reserved.includes(name)) return obj;\n\n    // Don't add private methods\n    if (name[0] === '_') return obj;\n\n    // Allow access to original Array methods through a prefix\n    if (name in Array.prototype) {\n      obj['$' + name] = Array.prototype[name];\n    }\n\n    // Relay every call to each()\n    obj[name] = function (...attrs) {\n      return this.each(name, ...attrs);\n    };\n    return obj;\n  }, {});\n  extend([List], methods);\n};\n\nfunction baseFind(query, parent) {\n  return new List(map((parent || globals.document).querySelectorAll(query), function (node) {\n    return adopt(node);\n  }));\n}\n\n// Scoped find method\nfunction find(query) {\n  return baseFind(query, this.node);\n}\nfunction findOne(query) {\n  return adopt(this.node.querySelector(query));\n}\n\nlet listenerId = 0;\nconst windowEvents = {};\nfunction getEvents(instance) {\n  let n = instance.getEventHolder();\n\n  // We dont want to save events in global space\n  if (n === globals.window) n = windowEvents;\n  if (!n.events) n.events = {};\n  return n.events;\n}\nfunction getEventTarget(instance) {\n  return instance.getEventTarget();\n}\nfunction clearEvents(instance) {\n  let n = instance.getEventHolder();\n  if (n === globals.window) n = windowEvents;\n  if (n.events) n.events = {};\n}\n\n// Add event binder in the SVG namespace\nfunction on(node, events, listener, binding, options) {\n  const l = listener.bind(binding || node);\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // events can be an array of events or a string of events\n  events = Array.isArray(events) ? events : events.split(delimiter);\n\n  // add id to listener\n  if (!listener._svgjsListenerId) {\n    listener._svgjsListenerId = ++listenerId;\n  }\n  events.forEach(function (event) {\n    const ev = event.split('.')[0];\n    const ns = event.split('.')[1] || '*';\n\n    // ensure valid object\n    bag[ev] = bag[ev] || {};\n    bag[ev][ns] = bag[ev][ns] || {};\n\n    // reference listener\n    bag[ev][ns][listener._svgjsListenerId] = l;\n\n    // add listener\n    n.addEventListener(ev, l, options || false);\n  });\n}\n\n// Add event unbinder in the SVG namespace\nfunction off(node, events, listener, options) {\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // listener can be a function or a number\n  if (typeof listener === 'function') {\n    listener = listener._svgjsListenerId;\n    if (!listener) return;\n  }\n\n  // events can be an array of events or a string or undefined\n  events = Array.isArray(events) ? events : (events || '').split(delimiter);\n  events.forEach(function (event) {\n    const ev = event && event.split('.')[0];\n    const ns = event && event.split('.')[1];\n    let namespace, l;\n    if (listener) {\n      // remove listener reference\n      if (bag[ev] && bag[ev][ns || '*']) {\n        // removeListener\n        n.removeEventListener(ev, bag[ev][ns || '*'][listener], options || false);\n        delete bag[ev][ns || '*'][listener];\n      }\n    } else if (ev && ns) {\n      // remove all listeners for a namespaced event\n      if (bag[ev] && bag[ev][ns]) {\n        for (l in bag[ev][ns]) {\n          off(n, [ev, ns].join('.'), l);\n        }\n        delete bag[ev][ns];\n      }\n    } else if (ns) {\n      // remove all listeners for a specific namespace\n      for (event in bag) {\n        for (namespace in bag[event]) {\n          if (ns === namespace) {\n            off(n, [event, ns].join('.'));\n          }\n        }\n      }\n    } else if (ev) {\n      // remove all listeners for the event\n      if (bag[ev]) {\n        for (namespace in bag[ev]) {\n          off(n, [ev, namespace].join('.'));\n        }\n        delete bag[ev];\n      }\n    } else {\n      // remove all listeners on a given node\n      for (event in bag) {\n        off(n, event);\n      }\n      clearEvents(instance);\n    }\n  });\n}\nfunction dispatch(node, event, data, options) {\n  const n = getEventTarget(node);\n\n  // Dispatch event\n  if (event instanceof globals.window.Event) {\n    n.dispatchEvent(event);\n  } else {\n    event = new globals.window.CustomEvent(event, {\n      detail: data,\n      cancelable: true,\n      ...options\n    });\n    n.dispatchEvent(event);\n  }\n  return event;\n}\n\nclass EventTarget extends Base {\n  addEventListener() {}\n  dispatch(event, data, options) {\n    return dispatch(this, event, data, options);\n  }\n  dispatchEvent(event) {\n    const bag = this.getEventHolder().events;\n    if (!bag) return true;\n    const events = bag[event.type];\n    for (const i in events) {\n      for (const j in events[i]) {\n        events[i][j](event);\n      }\n    }\n    return !event.defaultPrevented;\n  }\n\n  // Fire given event\n  fire(event, data, options) {\n    this.dispatch(event, data, options);\n    return this;\n  }\n  getEventHolder() {\n    return this;\n  }\n  getEventTarget() {\n    return this;\n  }\n\n  // Unbind event from listener\n  off(event, listener, options) {\n    off(this, event, listener, options);\n    return this;\n  }\n\n  // Bind given event to listener\n  on(event, listener, binding, options) {\n    on(this, event, listener, binding, options);\n    return this;\n  }\n  removeEventListener() {}\n}\nregister(EventTarget, 'EventTarget');\n\nfunction noop() {}\n\n// Default animation values\nconst timeline = {\n  duration: 400,\n  ease: '>',\n  delay: 0\n};\n\n// Default attribute values\nconst attrs = {\n  // fill and stroke\n  'fill-opacity': 1,\n  'stroke-opacity': 1,\n  'stroke-width': 0,\n  'stroke-linejoin': 'miter',\n  'stroke-linecap': 'butt',\n  fill: '#000000',\n  stroke: '#000000',\n  opacity: 1,\n  // position\n  x: 0,\n  y: 0,\n  cx: 0,\n  cy: 0,\n  // size\n  width: 0,\n  height: 0,\n  // radius\n  r: 0,\n  rx: 0,\n  ry: 0,\n  // gradient\n  offset: 0,\n  'stop-opacity': 1,\n  'stop-color': '#000000',\n  // text\n  'text-anchor': 'start'\n};\n\nvar defaults = {\n  __proto__: null,\n  attrs: attrs,\n  noop: noop,\n  timeline: timeline\n};\n\nclass SVGArray extends Array {\n  constructor(...args) {\n    super(...args);\n    this.init(...args);\n  }\n  clone() {\n    return new this.constructor(this);\n  }\n  init(arr) {\n    // This catches the case, that native map tries to create an array with new Array(1)\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...this.parse(arr));\n    return this;\n  }\n\n  // Parse whitespace separated string\n  parse(array = []) {\n    // If already is an array, no need to parse it\n    if (array instanceof Array) return array;\n    return array.trim().split(delimiter).map(parseFloat);\n  }\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n  toSet() {\n    return new Set(this);\n  }\n  toString() {\n    return this.join(' ');\n  }\n\n  // Flattens the array if needed\n  valueOf() {\n    const ret = [];\n    ret.push(...this);\n    return ret;\n  }\n}\n\n// Module for unit conversions\nclass SVGNumber {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n  convert(unit) {\n    return new SVGNumber(this.value, unit);\n  }\n\n  // Divide number\n  divide(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this / number, this.unit || number.unit);\n  }\n  init(value, unit) {\n    unit = Array.isArray(value) ? value[1] : unit;\n    value = Array.isArray(value) ? value[0] : value;\n\n    // initialize defaults\n    this.value = 0;\n    this.unit = unit || '';\n\n    // parse value\n    if (typeof value === 'number') {\n      // ensure a valid numeric value\n      this.value = isNaN(value) ? 0 : !isFinite(value) ? value < 0 ? -3.4e38 : +3.4e38 : value;\n    } else if (typeof value === 'string') {\n      unit = value.match(numberAndUnit);\n      if (unit) {\n        // make value numeric\n        this.value = parseFloat(unit[1]);\n\n        // normalize\n        if (unit[5] === '%') {\n          this.value /= 100;\n        } else if (unit[5] === 's') {\n          this.value *= 1000;\n        }\n\n        // store unit\n        this.unit = unit[5];\n      }\n    } else {\n      if (value instanceof SVGNumber) {\n        this.value = value.valueOf();\n        this.unit = value.unit;\n      }\n    }\n    return this;\n  }\n\n  // Subtract number\n  minus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this - number, this.unit || number.unit);\n  }\n\n  // Add number\n  plus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this + number, this.unit || number.unit);\n  }\n\n  // Multiply number\n  times(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this * number, this.unit || number.unit);\n  }\n  toArray() {\n    return [this.value, this.unit];\n  }\n  toJSON() {\n    return this.toString();\n  }\n  toString() {\n    return (this.unit === '%' ? ~~(this.value * 1e8) / 1e6 : this.unit === 's' ? this.value / 1e3 : this.value) + this.unit;\n  }\n  valueOf() {\n    return this.value;\n  }\n}\n\nconst colorAttributes = new Set(['fill', 'stroke', 'color', 'bgcolor', 'stop-color', 'flood-color', 'lighting-color']);\nconst hooks = [];\nfunction registerAttrHook(fn) {\n  hooks.push(fn);\n}\n\n// Set svg element attribute\nfunction attr(attr, val, ns) {\n  // act as full getter\n  if (attr == null) {\n    // get an object of attributes\n    attr = {};\n    val = this.node.attributes;\n    for (const node of val) {\n      attr[node.nodeName] = isNumber.test(node.nodeValue) ? parseFloat(node.nodeValue) : node.nodeValue;\n    }\n    return attr;\n  } else if (attr instanceof Array) {\n    // loop through array and get all values\n    return attr.reduce((last, curr) => {\n      last[curr] = this.attr(curr);\n      return last;\n    }, {});\n  } else if (typeof attr === 'object' && attr.constructor === Object) {\n    // apply every attribute individually if an object is passed\n    for (val in attr) this.attr(val, attr[val]);\n  } else if (val === null) {\n    // remove value\n    this.node.removeAttribute(attr);\n  } else if (val == null) {\n    // act as a getter if the first and only argument is not an object\n    val = this.node.getAttribute(attr);\n    return val == null ? attrs[attr] : isNumber.test(val) ? parseFloat(val) : val;\n  } else {\n    // Loop through hooks and execute them to convert value\n    val = hooks.reduce((_val, hook) => {\n      return hook(attr, _val, this);\n    }, val);\n\n    // ensure correct numeric values (also accepts NaN and Infinity)\n    if (typeof val === 'number') {\n      val = new SVGNumber(val);\n    } else if (colorAttributes.has(attr) && Color.isColor(val)) {\n      // ensure full hex color\n      val = new Color(val);\n    } else if (val.constructor === Array) {\n      // Check for plain arrays and parse array values\n      val = new SVGArray(val);\n    }\n\n    // if the passed attribute is leading...\n    if (attr === 'leading') {\n      // ... call the leading method instead\n      if (this.leading) {\n        this.leading(val);\n      }\n    } else {\n      // set given attribute on node\n      typeof ns === 'string' ? this.node.setAttributeNS(ns, attr, val.toString()) : this.node.setAttribute(attr, val.toString());\n    }\n\n    // rebuild if required\n    if (this.rebuild && (attr === 'font-size' || attr === 'x')) {\n      this.rebuild();\n    }\n  }\n  return this;\n}\n\nclass Dom extends EventTarget {\n  constructor(node, attrs) {\n    super();\n    this.node = node;\n    this.type = node.nodeName;\n    if (attrs && node !== attrs) {\n      this.attr(attrs);\n    }\n  }\n\n  // Add given element at a position\n  add(element, i) {\n    element = makeInstance(element);\n\n    // If non-root svg nodes are added we have to remove their namespaces\n    if (element.removeNamespace && this.node instanceof globals.window.SVGElement) {\n      element.removeNamespace();\n    }\n    if (i == null) {\n      this.node.appendChild(element.node);\n    } else if (element.node !== this.node.childNodes[i]) {\n      this.node.insertBefore(element.node, this.node.childNodes[i]);\n    }\n    return this;\n  }\n\n  // Add element to given container and return self\n  addTo(parent, i) {\n    return makeInstance(parent).put(this, i);\n  }\n\n  // Returns all child elements\n  children() {\n    return new List(map(this.node.children, function (node) {\n      return adopt(node);\n    }));\n  }\n\n  // Remove all elements in this container\n  clear() {\n    // remove children\n    while (this.node.hasChildNodes()) {\n      this.node.removeChild(this.node.lastChild);\n    }\n    return this;\n  }\n\n  // Clone element\n  clone(deep = true, assignNewIds = true) {\n    // write dom data to the dom so the clone can pickup the data\n    this.writeDataToDom();\n\n    // clone element\n    let nodeClone = this.node.cloneNode(deep);\n    if (assignNewIds) {\n      // assign new id\n      nodeClone = assignNewId(nodeClone);\n    }\n    return new this.constructor(nodeClone);\n  }\n\n  // Iterates over all children and invokes a given block\n  each(block, deep) {\n    const children = this.children();\n    let i, il;\n    for (i = 0, il = children.length; i < il; i++) {\n      block.apply(children[i], [i, children]);\n      if (deep) {\n        children[i].each(block, deep);\n      }\n    }\n    return this;\n  }\n  element(nodeName, attrs) {\n    return this.put(new Dom(create(nodeName), attrs));\n  }\n\n  // Get first child\n  first() {\n    return adopt(this.node.firstChild);\n  }\n\n  // Get a element at the given index\n  get(i) {\n    return adopt(this.node.childNodes[i]);\n  }\n  getEventHolder() {\n    return this.node;\n  }\n  getEventTarget() {\n    return this.node;\n  }\n\n  // Checks if the given element is a child\n  has(element) {\n    return this.index(element) >= 0;\n  }\n  html(htmlOrFn, outerHTML) {\n    return this.xml(htmlOrFn, outerHTML, html);\n  }\n\n  // Get / set id\n  id(id) {\n    // generate new id if no id set\n    if (typeof id === 'undefined' && !this.node.id) {\n      this.node.id = eid(this.type);\n    }\n\n    // don't set directly with this.node.id to make `null` work correctly\n    return this.attr('id', id);\n  }\n\n  // Gets index of given element\n  index(element) {\n    return [].slice.call(this.node.childNodes).indexOf(element.node);\n  }\n\n  // Get the last child\n  last() {\n    return adopt(this.node.lastChild);\n  }\n\n  // matches the element vs a css selector\n  matches(selector) {\n    const el = this.node;\n    const matcher = el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector || null;\n    return matcher && matcher.call(el, selector);\n  }\n\n  // Returns the parent element instance\n  parent(type) {\n    let parent = this;\n\n    // check for parent\n    if (!parent.node.parentNode) return null;\n\n    // get parent element\n    parent = adopt(parent.node.parentNode);\n    if (!type) return parent;\n\n    // loop through ancestors if type is given\n    do {\n      if (typeof type === 'string' ? parent.matches(type) : parent instanceof type) return parent;\n    } while (parent = adopt(parent.node.parentNode));\n    return parent;\n  }\n\n  // Basically does the same as `add()` but returns the added element instead\n  put(element, i) {\n    element = makeInstance(element);\n    this.add(element, i);\n    return element;\n  }\n\n  // Add element to given container and return container\n  putIn(parent, i) {\n    return makeInstance(parent).add(this, i);\n  }\n\n  // Remove element\n  remove() {\n    if (this.parent()) {\n      this.parent().removeElement(this);\n    }\n    return this;\n  }\n\n  // Remove a given child\n  removeElement(element) {\n    this.node.removeChild(element.node);\n    return this;\n  }\n\n  // Replace this with element\n  replace(element) {\n    element = makeInstance(element);\n    if (this.node.parentNode) {\n      this.node.parentNode.replaceChild(element.node, this.node);\n    }\n    return element;\n  }\n  round(precision = 2, map = null) {\n    const factor = 10 ** precision;\n    const attrs = this.attr(map);\n    for (const i in attrs) {\n      if (typeof attrs[i] === 'number') {\n        attrs[i] = Math.round(attrs[i] * factor) / factor;\n      }\n    }\n    this.attr(attrs);\n    return this;\n  }\n\n  // Import / Export raw svg\n  svg(svgOrFn, outerSVG) {\n    return this.xml(svgOrFn, outerSVG, svg);\n  }\n\n  // Return id on string conversion\n  toString() {\n    return this.id();\n  }\n  words(text) {\n    // This is faster than removing all children and adding a new one\n    this.node.textContent = text;\n    return this;\n  }\n  wrap(node) {\n    const parent = this.parent();\n    if (!parent) {\n      return this.addTo(node);\n    }\n    const position = parent.index(this);\n    return parent.put(node, position).put(this);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    // dump variables recursively\n    this.each(function () {\n      this.writeDataToDom();\n    });\n    return this;\n  }\n\n  // Import / Export raw svg\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // act as getter if no svg string is given\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      // The default for exports is, that the outerNode is included\n      outerXML = outerXML == null ? true : outerXML;\n\n      // write svgjs data to the dom\n      this.writeDataToDom();\n      let current = this;\n\n      // An export modifier was passed\n      if (xmlOrFn != null) {\n        current = adopt(current.node.cloneNode(true));\n\n        // If the user wants outerHTML we need to process this node, too\n        if (outerXML) {\n          const result = xmlOrFn(current);\n          current = result || current;\n\n          // The user does not want this node? Well, then he gets nothing\n          if (result === false) return '';\n        }\n\n        // Deep loop through all children and apply modifier\n        current.each(function () {\n          const result = xmlOrFn(this);\n          const _this = result || this;\n\n          // If modifier returns false, discard node\n          if (result === false) {\n            this.remove();\n\n            // If modifier returns new node, use it\n          } else if (result && this !== _this) {\n            this.replace(_this);\n          }\n        }, true);\n      }\n\n      // Return outer or inner content\n      return outerXML ? current.node.outerHTML : current.node.innerHTML;\n    }\n\n    // Act as setter if we got a string\n\n    // The default for import is, that the current node is not replaced\n    outerXML = outerXML == null ? false : outerXML;\n\n    // Create temporary holder\n    const well = create('wrapper', ns);\n    const fragment = globals.document.createDocumentFragment();\n\n    // Dump raw svg\n    well.innerHTML = xmlOrFn;\n\n    // Transplant nodes into the fragment\n    for (let len = well.children.length; len--;) {\n      fragment.appendChild(well.firstElementChild);\n    }\n    const parent = this.parent();\n\n    // Add the whole fragment at once\n    return outerXML ? this.replace(fragment) && parent : this.add(fragment);\n  }\n}\nextend(Dom, {\n  attr,\n  find,\n  findOne\n});\nregister(Dom, 'Dom');\n\nclass Element extends Dom {\n  constructor(node, attrs) {\n    super(node, attrs);\n\n    // initialize data object\n    this.dom = {};\n\n    // create circular reference\n    this.node.instance = this;\n    if (node.hasAttribute('data-svgjs') || node.hasAttribute('svgjs:data')) {\n      // pull svgjs data from the dom (getAttributeNS doesn't work in html5)\n      this.setData(JSON.parse(node.getAttribute('data-svgjs')) ?? JSON.parse(node.getAttribute('svgjs:data')) ?? {});\n    }\n  }\n\n  // Move element by its center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  }\n\n  // Move by center over x-axis\n  cx(x) {\n    return x == null ? this.x() + this.width() / 2 : this.x(x - this.width() / 2);\n  }\n\n  // Move by center over y-axis\n  cy(y) {\n    return y == null ? this.y() + this.height() / 2 : this.y(y - this.height() / 2);\n  }\n\n  // Get defs\n  defs() {\n    const root = this.root();\n    return root && root.defs();\n  }\n\n  // Relative move over x and y axes\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  }\n\n  // Relative move over x axis\n  dx(x = 0) {\n    return this.x(new SVGNumber(x).plus(this.x()));\n  }\n\n  // Relative move over y axis\n  dy(y = 0) {\n    return this.y(new SVGNumber(y).plus(this.y()));\n  }\n  getEventHolder() {\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('height', height);\n  }\n\n  // Move element to given x and y values\n  move(x, y) {\n    return this.x(x).y(y);\n  }\n\n  // return array of all ancestors of given type up to the root svg\n  parents(until = this.root()) {\n    const isSelector = typeof until === 'string';\n    if (!isSelector) {\n      until = makeInstance(until);\n    }\n    const parents = new List();\n    let parent = this;\n    while ((parent = parent.parent()) && parent.node !== globals.document && parent.nodeName !== '#document-fragment') {\n      parents.push(parent);\n      if (!isSelector && parent.node === until.node) {\n        break;\n      }\n      if (isSelector && parent.matches(until)) {\n        break;\n      }\n      if (parent.node === this.root().node) {\n        // We worked our way to the root and didn't match `until`\n        return null;\n      }\n    }\n    return parents;\n  }\n\n  // Get referenced element form attribute value\n  reference(attr) {\n    attr = this.attr(attr);\n    if (!attr) return null;\n    const m = (attr + '').match(reference);\n    return m ? makeInstance(m[1]) : null;\n  }\n\n  // Get parent document\n  root() {\n    const p = this.parent(getClass(root));\n    return p && p.root();\n  }\n\n  // set given data to the elements data property\n  setData(o) {\n    this.dom = o;\n    return this;\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.width(new SVGNumber(p.width)).height(new SVGNumber(p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('width', width);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    writeDataToDom(this, this.dom);\n    return super.writeDataToDom();\n  }\n\n  // Move over x-axis\n  x(x) {\n    return this.attr('x', x);\n  }\n\n  // Move over y-axis\n  y(y) {\n    return this.attr('y', y);\n  }\n}\nextend(Element, {\n  bbox,\n  rbox,\n  inside,\n  point,\n  ctm,\n  screenCTM\n});\nregister(Element, 'Element');\n\n// Define list of available attributes for stroke and fill\nconst sugar = {\n  stroke: ['color', 'width', 'opacity', 'linecap', 'linejoin', 'miterlimit', 'dasharray', 'dashoffset'],\n  fill: ['color', 'opacity', 'rule'],\n  prefix: function (t, a) {\n    return a === 'color' ? t : t + '-' + a;\n  }\n}\n\n// Add sugar for fill and stroke\n;\n['fill', 'stroke'].forEach(function (m) {\n  const extension = {};\n  let i;\n  extension[m] = function (o) {\n    if (typeof o === 'undefined') {\n      return this.attr(m);\n    }\n    if (typeof o === 'string' || o instanceof Color || Color.isRgb(o) || o instanceof Element) {\n      this.attr(m, o);\n    } else {\n      // set all attributes from sugar.fill and sugar.stroke list\n      for (i = sugar[m].length - 1; i >= 0; i--) {\n        if (o[sugar[m][i]] != null) {\n          this.attr(sugar.prefix(m, sugar[m][i]), o[sugar[m][i]]);\n        }\n      }\n    }\n    return this;\n  };\n  registerMethods(['Element', 'Runner'], extension);\n});\nregisterMethods(['Element', 'Runner'], {\n  // Let the user set the matrix directly\n  matrix: function (mat, b, c, d, e, f) {\n    // Act as a getter\n    if (mat == null) {\n      return new Matrix(this);\n    }\n\n    // Act as a setter, the user can pass a matrix or a set of numbers\n    return this.attr('transform', new Matrix(mat, b, c, d, e, f));\n  },\n  // Map rotation to transform\n  rotate: function (angle, cx, cy) {\n    return this.transform({\n      rotate: angle,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map skew to transform\n  skew: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      skew: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      skew: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  shear: function (lam, cx, cy) {\n    return this.transform({\n      shear: lam,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map scale to transform\n  scale: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      scale: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      scale: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map translate to transform\n  translate: function (x, y) {\n    return this.transform({\n      translate: [x, y]\n    }, true);\n  },\n  // Map relative translations to transform\n  relative: function (x, y) {\n    return this.transform({\n      relative: [x, y]\n    }, true);\n  },\n  // Map flip to transform\n  flip: function (direction = 'both', origin = 'center') {\n    if ('xybothtrue'.indexOf(direction) === -1) {\n      origin = direction;\n      direction = 'both';\n    }\n    return this.transform({\n      flip: direction,\n      origin: origin\n    }, true);\n  },\n  // Opacity\n  opacity: function (value) {\n    return this.attr('opacity', value);\n  }\n});\nregisterMethods('radius', {\n  // Add x and y radius\n  radius: function (x, y = x) {\n    const type = (this._element || this).type;\n    return type === 'radialGradient' ? this.attr('r', new SVGNumber(x)) : this.rx(x).ry(y);\n  }\n});\nregisterMethods('Path', {\n  // Get path length\n  length: function () {\n    return this.node.getTotalLength();\n  },\n  // Get point at length\n  pointAt: function (length) {\n    return new Point(this.node.getPointAtLength(length));\n  }\n});\nregisterMethods(['Element', 'Runner'], {\n  // Set font\n  font: function (a, v) {\n    if (typeof a === 'object') {\n      for (v in a) this.font(v, a[v]);\n      return this;\n    }\n    return a === 'leading' ? this.leading(v) : a === 'anchor' ? this.attr('text-anchor', v) : a === 'size' || a === 'family' || a === 'weight' || a === 'stretch' || a === 'variant' || a === 'style' ? this.attr('font-' + a, v) : this.attr(a, v);\n  }\n});\n\n// Add events to elements\nconst methods = ['click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'mousemove', 'mouseenter', 'mouseleave', 'touchstart', 'touchmove', 'touchleave', 'touchend', 'touchcancel', 'contextmenu', 'wheel', 'pointerdown', 'pointermove', 'pointerup', 'pointerleave', 'pointercancel'].reduce(function (last, event) {\n  // add event to Element\n  const fn = function (f) {\n    if (f === null) {\n      this.off(event);\n    } else {\n      this.on(event, f);\n    }\n    return this;\n  };\n  last[event] = fn;\n  return last;\n}, {});\nregisterMethods('Element', methods);\n\n// Reset all transformations\nfunction untransform() {\n  return this.attr('transform', null);\n}\n\n// merge the whole transformation chain into one matrix and returns it\nfunction matrixify() {\n  const matrix = (this.attr('transform') || ''\n  // split transformations\n  ).split(transforms).slice(0, -1).map(function (str) {\n    // generate key => value pairs\n    const kv = str.trim().split('(');\n    return [kv[0], kv[1].split(delimiter).map(function (str) {\n      return parseFloat(str);\n    })];\n  }).reverse()\n  // merge every transformation into one matrix\n  .reduce(function (matrix, transform) {\n    if (transform[0] === 'matrix') {\n      return matrix.lmultiply(Matrix.fromArray(transform[1]));\n    }\n    return matrix[transform[0]].apply(matrix, transform[1]);\n  }, new Matrix());\n  return matrix;\n}\n\n// add an element to another parent without changing the visual representation on the screen\nfunction toParent(parent, i) {\n  if (this === parent) return this;\n  if (isDescriptive(this.node)) return this.addTo(parent, i);\n  const ctm = this.screenCTM();\n  const pCtm = parent.screenCTM().inverse();\n  this.addTo(parent, i).untransform().transform(pCtm.multiply(ctm));\n  return this;\n}\n\n// same as above with parent equals root-svg\nfunction toRoot(i) {\n  return this.toParent(this.root(), i);\n}\n\n// Add transformations\nfunction transform(o, relative) {\n  // Act as a getter if no object was passed\n  if (o == null || typeof o === 'string') {\n    const decomposed = new Matrix(this).decompose();\n    return o == null ? decomposed : decomposed[o];\n  }\n  if (!Matrix.isMatrixLike(o)) {\n    // Set the origin according to the defined transform\n    o = {\n      ...o,\n      origin: getOrigin(o, this)\n    };\n  }\n\n  // The user can pass a boolean, an Element or an Matrix or nothing\n  const cleanRelative = relative === true ? this : relative || false;\n  const result = new Matrix(cleanRelative).transform(o);\n  return this.attr('transform', result);\n}\nregisterMethods('Element', {\n  untransform,\n  matrixify,\n  toParent,\n  toRoot,\n  transform\n});\n\nclass Container extends Element {\n  flatten() {\n    this.each(function () {\n      if (this instanceof Container) {\n        return this.flatten().ungroup();\n      }\n    });\n    return this;\n  }\n  ungroup(parent = this.parent(), index = parent.index(this)) {\n    // when parent != this, we want append all elements to the end\n    index = index === -1 ? parent.children().length : index;\n    this.each(function (i, children) {\n      // reverse each\n      return children[children.length - i - 1].toParent(parent, index);\n    });\n    return this.remove();\n  }\n}\nregister(Container, 'Container');\n\nclass Defs extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('defs', node), attrs);\n  }\n  flatten() {\n    return this;\n  }\n  ungroup() {\n    return this;\n  }\n}\nregister(Defs, 'Defs');\n\nclass Shape extends Element {}\nregister(Shape, 'Shape');\n\n// Radius x value\nfunction rx(rx) {\n  return this.attr('rx', rx);\n}\n\n// Radius y value\nfunction ry(ry) {\n  return this.attr('ry', ry);\n}\n\n// Move over x-axis\nfunction x$3(x) {\n  return x == null ? this.cx() - this.rx() : this.cx(x + this.rx());\n}\n\n// Move over y-axis\nfunction y$3(y) {\n  return y == null ? this.cy() - this.ry() : this.cy(y + this.ry());\n}\n\n// Move by center over x-axis\nfunction cx$1(x) {\n  return this.attr('cx', x);\n}\n\n// Move by center over y-axis\nfunction cy$1(y) {\n  return this.attr('cy', y);\n}\n\n// Set width of element\nfunction width$2(width) {\n  return width == null ? this.rx() * 2 : this.rx(new SVGNumber(width).divide(2));\n}\n\n// Set height of element\nfunction height$2(height) {\n  return height == null ? this.ry() * 2 : this.ry(new SVGNumber(height).divide(2));\n}\n\nvar circled = {\n  __proto__: null,\n  cx: cx$1,\n  cy: cy$1,\n  height: height$2,\n  rx: rx,\n  ry: ry,\n  width: width$2,\n  x: x$3,\n  y: y$3\n};\n\nclass Ellipse extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('ellipse', node), attrs);\n  }\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.rx(new SVGNumber(p.width).divide(2)).ry(new SVGNumber(p.height).divide(2));\n  }\n}\nextend(Ellipse, circled);\nregisterMethods('Container', {\n  // Create an ellipse\n  ellipse: wrapWithAttrCheck(function (width = 0, height = width) {\n    return this.put(new Ellipse()).size(width, height).move(0, 0);\n  })\n});\nregister(Ellipse, 'Ellipse');\n\nclass Fragment extends Dom {\n  constructor(node = globals.document.createDocumentFragment()) {\n    super(node);\n  }\n\n  // Import / Export raw xml\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // because this is a fragment we have to put all elements into a wrapper first\n    // before we can get the innerXML from it\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      const wrapper = new Dom(create('wrapper', ns));\n      wrapper.add(this.node.cloneNode(true));\n      return wrapper.xml(false, ns);\n    }\n\n    // Act as setter if we got a string\n    return super.xml(xmlOrFn, false, ns);\n  }\n}\nregister(Fragment, 'Fragment');\n\nfunction from(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    fx: new SVGNumber(x),\n    fy: new SVGNumber(y)\n  }) : this.attr({\n    x1: new SVGNumber(x),\n    y1: new SVGNumber(y)\n  });\n}\nfunction to(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    cx: new SVGNumber(x),\n    cy: new SVGNumber(y)\n  }) : this.attr({\n    x2: new SVGNumber(x),\n    y2: new SVGNumber(y)\n  });\n}\n\nvar gradiented = {\n  __proto__: null,\n  from: from,\n  to: to\n};\n\nclass Gradient extends Container {\n  constructor(type, attrs) {\n    super(nodeOrNew(type + 'Gradient', typeof type === 'string' ? null : type), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'gradientTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update gradient\n  update(block) {\n    // remove all stops\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nextend(Gradient, gradiented);\nregisterMethods({\n  Container: {\n    // Create gradient element in defs\n    gradient(...args) {\n      return this.defs().gradient(...args);\n    }\n  },\n  // define gradient\n  Defs: {\n    gradient: wrapWithAttrCheck(function (type, block) {\n      return this.put(new Gradient(type)).update(block);\n    })\n  }\n});\nregister(Gradient, 'Gradient');\n\nclass Pattern extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('pattern', node), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'patternTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update pattern by rebuilding\n  update(block) {\n    // remove content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nregisterMethods({\n  Container: {\n    // Create pattern element in defs\n    pattern(...args) {\n      return this.defs().pattern(...args);\n    }\n  },\n  Defs: {\n    pattern: wrapWithAttrCheck(function (width, height, block) {\n      return this.put(new Pattern()).update(block).attr({\n        x: 0,\n        y: 0,\n        width: width,\n        height: height,\n        patternUnits: 'userSpaceOnUse'\n      });\n    })\n  }\n});\nregister(Pattern, 'Pattern');\n\nclass Image extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('image', node), attrs);\n  }\n\n  // (re)load image\n  load(url, callback) {\n    if (!url) return this;\n    const img = new globals.window.Image();\n    on(img, 'load', function (e) {\n      const p = this.parent(Pattern);\n\n      // ensure image size\n      if (this.width() === 0 && this.height() === 0) {\n        this.size(img.width, img.height);\n      }\n      if (p instanceof Pattern) {\n        // ensure pattern size if not set\n        if (p.width() === 0 && p.height() === 0) {\n          p.size(this.width(), this.height());\n        }\n      }\n      if (typeof callback === 'function') {\n        callback.call(this, e);\n      }\n    }, this);\n    on(img, 'load error', function () {\n      // dont forget to unbind memory leaking events\n      off(img);\n    });\n    return this.attr('href', img.src = url, xlink);\n  }\n}\nregisterAttrHook(function (attr, val, _this) {\n  // convert image fill and stroke to patterns\n  if (attr === 'fill' || attr === 'stroke') {\n    if (isImage.test(val)) {\n      val = _this.root().defs().image(val);\n    }\n  }\n  if (val instanceof Image) {\n    val = _this.root().defs().pattern(0, 0, pattern => {\n      pattern.add(val);\n    });\n  }\n  return val;\n});\nregisterMethods({\n  Container: {\n    // create image element, load image and set its size\n    image: wrapWithAttrCheck(function (source, callback) {\n      return this.put(new Image()).size(0, 0).load(source, callback);\n    })\n  }\n});\nregister(Image, 'Image');\n\nclass PointArray extends SVGArray {\n  // Get bounding box of points\n  bbox() {\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    let minX = Infinity;\n    let minY = Infinity;\n    this.forEach(function (el) {\n      maxX = Math.max(el[0], maxX);\n      maxY = Math.max(el[1], maxY);\n      minX = Math.min(el[0], minX);\n      minY = Math.min(el[1], minY);\n    });\n    return new Box(minX, minY, maxX - minX, maxY - minY);\n  }\n\n  // Move point string\n  move(x, y) {\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n\n    // move every point\n    if (!isNaN(x) && !isNaN(y)) {\n      for (let i = this.length - 1; i >= 0; i--) {\n        this[i] = [this[i][0] + x, this[i][1] + y];\n      }\n    }\n    return this;\n  }\n\n  // Parse point string and flat array\n  parse(array = [0, 0]) {\n    const points = [];\n\n    // if it is an array, we flatten it and therefore clone it to 1 depths\n    if (array instanceof Array) {\n      array = Array.prototype.concat.apply([], array);\n    } else {\n      // Else, it is considered as a string\n      // parse points\n      array = array.trim().split(delimiter).map(parseFloat);\n    }\n\n    // validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints\n    // Odd number of coordinates is an error. In such cases, drop the last odd coordinate.\n    if (array.length % 2 !== 0) array.pop();\n\n    // wrap points in two-tuples\n    for (let i = 0, len = array.length; i < len; i = i + 2) {\n      points.push([array[i], array[i + 1]]);\n    }\n    return points;\n  }\n\n  // Resize poly string\n  size(width, height) {\n    let i;\n    const box = this.bbox();\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      if (box.width) this[i][0] = (this[i][0] - box.x) * width / box.width + box.x;\n      if (box.height) this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n    }\n    return this;\n  }\n\n  // Convert array to line object\n  toLine() {\n    return {\n      x1: this[0][0],\n      y1: this[0][1],\n      x2: this[1][0],\n      y2: this[1][1]\n    };\n  }\n\n  // Convert array to string\n  toString() {\n    const array = [];\n    // convert to a poly point string\n    for (let i = 0, il = this.length; i < il; i++) {\n      array.push(this[i].join(','));\n    }\n    return array.join(' ');\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // transform points with matrix (similar to Point.transform)\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    for (let i = this.length; i--;) {\n      // Perform the matrix multiplication\n      const [x, y] = this[i];\n      this[i][0] = m.a * x + m.c * y + m.e;\n      this[i][1] = m.b * x + m.d * y + m.f;\n    }\n    return this;\n  }\n}\n\nconst MorphArray = PointArray;\n\n// Move by left top corner over x-axis\nfunction x$2(x) {\n  return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n}\n\n// Move by left top corner over y-axis\nfunction y$2(y) {\n  return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n}\n\n// Set width of element\nfunction width$1(width) {\n  const b = this.bbox();\n  return width == null ? b.width : this.size(width, b.height);\n}\n\n// Set height of element\nfunction height$1(height) {\n  const b = this.bbox();\n  return height == null ? b.height : this.size(b.width, height);\n}\n\nvar pointed = {\n  __proto__: null,\n  MorphArray: MorphArray,\n  height: height$1,\n  width: width$1,\n  x: x$2,\n  y: y$2\n};\n\nclass Line extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('line', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return new PointArray([[this.attr('x1'), this.attr('y1')], [this.attr('x2'), this.attr('y2')]]);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr(this.array().move(x, y).toLine());\n  }\n\n  // Overwrite native plot() method\n  plot(x1, y1, x2, y2) {\n    if (x1 == null) {\n      return this.array();\n    } else if (typeof y1 !== 'undefined') {\n      x1 = {\n        x1,\n        y1,\n        x2,\n        y2\n      };\n    } else {\n      x1 = new PointArray(x1).toLine();\n    }\n    return this.attr(x1);\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr(this.array().size(p.width, p.height).toLine());\n  }\n}\nextend(Line, pointed);\nregisterMethods({\n  Container: {\n    // Create a line element\n    line: wrapWithAttrCheck(function (...args) {\n      // make sure plot is called as a setter\n      // x1 is not necessarily a number, it can also be an array, a string and a PointArray\n      return Line.prototype.plot.apply(this.put(new Line()), args[0] != null ? args : [0, 0, 0, 0]);\n    })\n  }\n});\nregister(Line, 'Line');\n\nclass Marker extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('marker', node), attrs);\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('markerHeight', height);\n  }\n  orient(orient) {\n    return this.attr('orient', orient);\n  }\n\n  // Set marker refX and refY\n  ref(x, y) {\n    return this.attr('refX', x).attr('refY', y);\n  }\n\n  // Return the fill id\n  toString() {\n    return 'url(#' + this.id() + ')';\n  }\n\n  // Update marker\n  update(block) {\n    // remove all content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('markerWidth', width);\n  }\n}\nregisterMethods({\n  Container: {\n    marker(...args) {\n      // Create marker element in defs\n      return this.defs().marker(...args);\n    }\n  },\n  Defs: {\n    // Create marker\n    marker: wrapWithAttrCheck(function (width, height, block) {\n      // Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto\n      return this.put(new Marker()).size(width, height).ref(width / 2, height / 2).viewbox(0, 0, width, height).attr('orient', 'auto').update(block);\n    })\n  },\n  marker: {\n    // Create and attach markers\n    marker(marker, width, height, block) {\n      let attr = ['marker'];\n\n      // Build attribute name\n      if (marker !== 'all') attr.push(marker);\n      attr = attr.join('-');\n\n      // Set marker attribute\n      marker = arguments[1] instanceof Marker ? arguments[1] : this.defs().marker(width, height, block);\n      return this.attr(attr, marker);\n    }\n  }\n});\nregister(Marker, 'Marker');\n\n/***\nBase Class\n==========\nThe base stepper class that will be\n***/\n\nfunction makeSetterGetter(k, f) {\n  return function (v) {\n    if (v == null) return this[k];\n    this[k] = v;\n    if (f) f.call(this);\n    return this;\n  };\n}\nconst easing = {\n  '-': function (pos) {\n    return pos;\n  },\n  '<>': function (pos) {\n    return -Math.cos(pos * Math.PI) / 2 + 0.5;\n  },\n  '>': function (pos) {\n    return Math.sin(pos * Math.PI / 2);\n  },\n  '<': function (pos) {\n    return -Math.cos(pos * Math.PI / 2) + 1;\n  },\n  bezier: function (x1, y1, x2, y2) {\n    // see https://www.w3.org/TR/css-easing-1/#cubic-bezier-algo\n    return function (t) {\n      if (t < 0) {\n        if (x1 > 0) {\n          return y1 / x1 * t;\n        } else if (x2 > 0) {\n          return y2 / x2 * t;\n        } else {\n          return 0;\n        }\n      } else if (t > 1) {\n        if (x2 < 1) {\n          return (1 - y2) / (1 - x2) * t + (y2 - x2) / (1 - x2);\n        } else if (x1 < 1) {\n          return (1 - y1) / (1 - x1) * t + (y1 - x1) / (1 - x1);\n        } else {\n          return 1;\n        }\n      } else {\n        return 3 * t * (1 - t) ** 2 * y1 + 3 * t ** 2 * (1 - t) * y2 + t ** 3;\n      }\n    };\n  },\n  // see https://www.w3.org/TR/css-easing-1/#step-timing-function-algo\n  steps: function (steps, stepPosition = 'end') {\n    // deal with \"jump-\" prefix\n    stepPosition = stepPosition.split('-').reverse()[0];\n    let jumps = steps;\n    if (stepPosition === 'none') {\n      --jumps;\n    } else if (stepPosition === 'both') {\n      ++jumps;\n    }\n\n    // The beforeFlag is essentially useless\n    return (t, beforeFlag = false) => {\n      // Step is called currentStep in referenced url\n      let step = Math.floor(t * steps);\n      const jumping = t * step % 1 === 0;\n      if (stepPosition === 'start' || stepPosition === 'both') {\n        ++step;\n      }\n      if (beforeFlag && jumping) {\n        --step;\n      }\n      if (t >= 0 && step < 0) {\n        step = 0;\n      }\n      if (t <= 1 && step > jumps) {\n        step = jumps;\n      }\n      return step / jumps;\n    };\n  }\n};\nclass Stepper {\n  done() {\n    return false;\n  }\n}\n\n/***\nEasing Functions\n================\n***/\n\nclass Ease extends Stepper {\n  constructor(fn = timeline.ease) {\n    super();\n    this.ease = easing[fn] || fn;\n  }\n  step(from, to, pos) {\n    if (typeof from !== 'number') {\n      return pos < 1 ? from : to;\n    }\n    return from + (to - from) * this.ease(pos);\n  }\n}\n\n/***\nController Types\n================\n***/\n\nclass Controller extends Stepper {\n  constructor(fn) {\n    super();\n    this.stepper = fn;\n  }\n  done(c) {\n    return c.done;\n  }\n  step(current, target, dt, c) {\n    return this.stepper(current, target, dt, c);\n  }\n}\nfunction recalculate() {\n  // Apply the default parameters\n  const duration = (this._duration || 500) / 1000;\n  const overshoot = this._overshoot || 0;\n\n  // Calculate the PID natural response\n  const eps = 1e-10;\n  const pi = Math.PI;\n  const os = Math.log(overshoot / 100 + eps);\n  const zeta = -os / Math.sqrt(pi * pi + os * os);\n  const wn = 3.9 / (zeta * duration);\n\n  // Calculate the Spring values\n  this.d = 2 * zeta * wn;\n  this.k = wn * wn;\n}\nclass Spring extends Controller {\n  constructor(duration = 500, overshoot = 0) {\n    super();\n    this.duration(duration).overshoot(overshoot);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    if (dt > 100) dt = 16;\n    dt /= 1000;\n\n    // Get the previous velocity\n    const velocity = c.velocity || 0;\n\n    // Apply the control to get the new position and store it\n    const acceleration = -this.d * velocity - this.k * (current - target);\n    const newPosition = current + velocity * dt + acceleration * dt * dt / 2;\n\n    // Store the velocity\n    c.velocity = velocity + acceleration * dt;\n\n    // Figure out if we have converged, and if so, pass the value\n    c.done = Math.abs(target - newPosition) + Math.abs(velocity) < 0.002;\n    return c.done ? target : newPosition;\n  }\n}\nextend(Spring, {\n  duration: makeSetterGetter('_duration', recalculate),\n  overshoot: makeSetterGetter('_overshoot', recalculate)\n});\nclass PID extends Controller {\n  constructor(p = 0.1, i = 0.01, d = 0, windup = 1000) {\n    super();\n    this.p(p).i(i).d(d).windup(windup);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    const p = target - current;\n    let i = (c.integral || 0) + p * dt;\n    const d = (p - (c.error || 0)) / dt;\n    const windup = this._windup;\n\n    // antiwindup\n    if (windup !== false) {\n      i = Math.max(-windup, Math.min(i, windup));\n    }\n    c.error = p;\n    c.integral = i;\n    c.done = Math.abs(p) < 0.001;\n    return c.done ? target : current + (this.P * p + this.I * i + this.D * d);\n  }\n}\nextend(PID, {\n  windup: makeSetterGetter('_windup'),\n  p: makeSetterGetter('P'),\n  i: makeSetterGetter('I'),\n  d: makeSetterGetter('D')\n});\n\nconst segmentParameters = {\n  M: 2,\n  L: 2,\n  H: 1,\n  V: 1,\n  C: 6,\n  S: 4,\n  Q: 4,\n  T: 2,\n  A: 7,\n  Z: 0\n};\nconst pathHandlers = {\n  M: function (c, p, p0) {\n    p.x = p0.x = c[0];\n    p.y = p0.y = c[1];\n    return ['M', p.x, p.y];\n  },\n  L: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['L', c[0], c[1]];\n  },\n  H: function (c, p) {\n    p.x = c[0];\n    return ['H', c[0]];\n  },\n  V: function (c, p) {\n    p.y = c[0];\n    return ['V', c[0]];\n  },\n  C: function (c, p) {\n    p.x = c[4];\n    p.y = c[5];\n    return ['C', c[0], c[1], c[2], c[3], c[4], c[5]];\n  },\n  S: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['S', c[0], c[1], c[2], c[3]];\n  },\n  Q: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['Q', c[0], c[1], c[2], c[3]];\n  },\n  T: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['T', c[0], c[1]];\n  },\n  Z: function (c, p, p0) {\n    p.x = p0.x;\n    p.y = p0.y;\n    return ['Z'];\n  },\n  A: function (c, p) {\n    p.x = c[5];\n    p.y = c[6];\n    return ['A', c[0], c[1], c[2], c[3], c[4], c[5], c[6]];\n  }\n};\nconst mlhvqtcsaz = 'mlhvqtcsaz'.split('');\nfor (let i = 0, il = mlhvqtcsaz.length; i < il; ++i) {\n  pathHandlers[mlhvqtcsaz[i]] = function (i) {\n    return function (c, p, p0) {\n      if (i === 'H') c[0] = c[0] + p.x;else if (i === 'V') c[0] = c[0] + p.y;else if (i === 'A') {\n        c[5] = c[5] + p.x;\n        c[6] = c[6] + p.y;\n      } else {\n        for (let j = 0, jl = c.length; j < jl; ++j) {\n          c[j] = c[j] + (j % 2 ? p.y : p.x);\n        }\n      }\n      return pathHandlers[i](c, p, p0);\n    };\n  }(mlhvqtcsaz[i].toUpperCase());\n}\nfunction makeAbsolut(parser) {\n  const command = parser.segment[0];\n  return pathHandlers[command](parser.segment.slice(1), parser.p, parser.p0);\n}\nfunction segmentComplete(parser) {\n  return parser.segment.length && parser.segment.length - 1 === segmentParameters[parser.segment[0].toUpperCase()];\n}\nfunction startNewSegment(parser, token) {\n  parser.inNumber && finalizeNumber(parser, false);\n  const pathLetter = isPathLetter.test(token);\n  if (pathLetter) {\n    parser.segment = [token];\n  } else {\n    const lastCommand = parser.lastCommand;\n    const small = lastCommand.toLowerCase();\n    const isSmall = lastCommand === small;\n    parser.segment = [small === 'm' ? isSmall ? 'l' : 'L' : lastCommand];\n  }\n  parser.inSegment = true;\n  parser.lastCommand = parser.segment[0];\n  return pathLetter;\n}\nfunction finalizeNumber(parser, inNumber) {\n  if (!parser.inNumber) throw new Error('Parser Error');\n  parser.number && parser.segment.push(parseFloat(parser.number));\n  parser.inNumber = inNumber;\n  parser.number = '';\n  parser.pointSeen = false;\n  parser.hasExponent = false;\n  if (segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n}\nfunction finalizeSegment(parser) {\n  parser.inSegment = false;\n  if (parser.absolute) {\n    parser.segment = makeAbsolut(parser);\n  }\n  parser.segments.push(parser.segment);\n}\nfunction isArcFlag(parser) {\n  if (!parser.segment.length) return false;\n  const isArc = parser.segment[0].toUpperCase() === 'A';\n  const length = parser.segment.length;\n  return isArc && (length === 4 || length === 5);\n}\nfunction isExponential(parser) {\n  return parser.lastToken.toUpperCase() === 'E';\n}\nconst pathDelimiters = new Set([' ', ',', '\\t', '\\n', '\\r', '\\f']);\nfunction pathParser(d, toAbsolute = true) {\n  let index = 0;\n  let token = '';\n  const parser = {\n    segment: [],\n    inNumber: false,\n    number: '',\n    lastToken: '',\n    inSegment: false,\n    segments: [],\n    pointSeen: false,\n    hasExponent: false,\n    absolute: toAbsolute,\n    p0: new Point(),\n    p: new Point()\n  };\n  while (parser.lastToken = token, token = d.charAt(index++)) {\n    if (!parser.inSegment) {\n      if (startNewSegment(parser, token)) {\n        continue;\n      }\n    }\n    if (token === '.') {\n      if (parser.pointSeen || parser.hasExponent) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.inNumber = true;\n      parser.pointSeen = true;\n      parser.number += token;\n      continue;\n    }\n    if (!isNaN(parseInt(token))) {\n      if (parser.number === '0' || isArcFlag(parser)) {\n        parser.inNumber = true;\n        parser.number = token;\n        finalizeNumber(parser, true);\n        continue;\n      }\n      parser.inNumber = true;\n      parser.number += token;\n      continue;\n    }\n    if (pathDelimiters.has(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      }\n      continue;\n    }\n    if (token === '-' || token === '+') {\n      if (parser.inNumber && !isExponential(parser)) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.number += token;\n      parser.inNumber = true;\n      continue;\n    }\n    if (token.toUpperCase() === 'E') {\n      parser.number += token;\n      parser.hasExponent = true;\n      continue;\n    }\n    if (isPathLetter.test(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      } else if (!segmentComplete(parser)) {\n        throw new Error('parser Error');\n      } else {\n        finalizeSegment(parser);\n      }\n      --index;\n    }\n  }\n  if (parser.inNumber) {\n    finalizeNumber(parser, false);\n  }\n  if (parser.inSegment && segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n  return parser.segments;\n}\n\nfunction arrayToString(a) {\n  let s = '';\n  for (let i = 0, il = a.length; i < il; i++) {\n    s += a[i][0];\n    if (a[i][1] != null) {\n      s += a[i][1];\n      if (a[i][2] != null) {\n        s += ' ';\n        s += a[i][2];\n        if (a[i][3] != null) {\n          s += ' ';\n          s += a[i][3];\n          s += ' ';\n          s += a[i][4];\n          if (a[i][5] != null) {\n            s += ' ';\n            s += a[i][5];\n            s += ' ';\n            s += a[i][6];\n            if (a[i][7] != null) {\n              s += ' ';\n              s += a[i][7];\n            }\n          }\n        }\n      }\n    }\n  }\n  return s + ' ';\n}\nclass PathArray extends SVGArray {\n  // Get bounding box of path\n  bbox() {\n    parser().path.setAttribute('d', this.toString());\n    return new Box(parser.nodes.path.getBBox());\n  }\n\n  // Move path string\n  move(x, y) {\n    // get bounding box of current situation\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n    if (!isNaN(x) && !isNaN(y)) {\n      // move every point\n      for (let l, i = this.length - 1; i >= 0; i--) {\n        l = this[i][0];\n        if (l === 'M' || l === 'L' || l === 'T') {\n          this[i][1] += x;\n          this[i][2] += y;\n        } else if (l === 'H') {\n          this[i][1] += x;\n        } else if (l === 'V') {\n          this[i][1] += y;\n        } else if (l === 'C' || l === 'S' || l === 'Q') {\n          this[i][1] += x;\n          this[i][2] += y;\n          this[i][3] += x;\n          this[i][4] += y;\n          if (l === 'C') {\n            this[i][5] += x;\n            this[i][6] += y;\n          }\n        } else if (l === 'A') {\n          this[i][6] += x;\n          this[i][7] += y;\n        }\n      }\n    }\n    return this;\n  }\n\n  // Absolutize and parse path to array\n  parse(d = 'M0 0') {\n    if (Array.isArray(d)) {\n      d = Array.prototype.concat.apply([], d).toString();\n    }\n    return pathParser(d);\n  }\n\n  // Resize path string\n  size(width, height) {\n    // get bounding box of current situation\n    const box = this.bbox();\n    let i, l;\n\n    // If the box width or height is 0 then we ignore\n    // transformations on the respective axis\n    box.width = box.width === 0 ? 1 : box.width;\n    box.height = box.height === 0 ? 1 : box.height;\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      l = this[i][0];\n      if (l === 'M' || l === 'L' || l === 'T') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n      } else if (l === 'H') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n      } else if (l === 'V') {\n        this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n      } else if (l === 'C' || l === 'S' || l === 'Q') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n        this[i][3] = (this[i][3] - box.x) * width / box.width + box.x;\n        this[i][4] = (this[i][4] - box.y) * height / box.height + box.y;\n        if (l === 'C') {\n          this[i][5] = (this[i][5] - box.x) * width / box.width + box.x;\n          this[i][6] = (this[i][6] - box.y) * height / box.height + box.y;\n        }\n      } else if (l === 'A') {\n        // resize radii\n        this[i][1] = this[i][1] * width / box.width;\n        this[i][2] = this[i][2] * height / box.height;\n\n        // move position values\n        this[i][6] = (this[i][6] - box.x) * width / box.width + box.x;\n        this[i][7] = (this[i][7] - box.y) * height / box.height + box.y;\n      }\n    }\n    return this;\n  }\n\n  // Convert array to string\n  toString() {\n    return arrayToString(this);\n  }\n}\n\nconst getClassForType = value => {\n  const type = typeof value;\n  if (type === 'number') {\n    return SVGNumber;\n  } else if (type === 'string') {\n    if (Color.isColor(value)) {\n      return Color;\n    } else if (delimiter.test(value)) {\n      return isPathLetter.test(value) ? PathArray : SVGArray;\n    } else if (numberAndUnit.test(value)) {\n      return SVGNumber;\n    } else {\n      return NonMorphable;\n    }\n  } else if (morphableTypes.indexOf(value.constructor) > -1) {\n    return value.constructor;\n  } else if (Array.isArray(value)) {\n    return SVGArray;\n  } else if (type === 'object') {\n    return ObjectBag;\n  } else {\n    return NonMorphable;\n  }\n};\nclass Morphable {\n  constructor(stepper) {\n    this._stepper = stepper || new Ease('-');\n    this._from = null;\n    this._to = null;\n    this._type = null;\n    this._context = null;\n    this._morphObj = null;\n  }\n  at(pos) {\n    return this._morphObj.morph(this._from, this._to, pos, this._stepper, this._context);\n  }\n  done() {\n    const complete = this._context.map(this._stepper.done).reduce(function (last, curr) {\n      return last && curr;\n    }, true);\n    return complete;\n  }\n  from(val) {\n    if (val == null) {\n      return this._from;\n    }\n    this._from = this._set(val);\n    return this;\n  }\n  stepper(stepper) {\n    if (stepper == null) return this._stepper;\n    this._stepper = stepper;\n    return this;\n  }\n  to(val) {\n    if (val == null) {\n      return this._to;\n    }\n    this._to = this._set(val);\n    return this;\n  }\n  type(type) {\n    // getter\n    if (type == null) {\n      return this._type;\n    }\n\n    // setter\n    this._type = type;\n    return this;\n  }\n  _set(value) {\n    if (!this._type) {\n      this.type(getClassForType(value));\n    }\n    let result = new this._type(value);\n    if (this._type === Color) {\n      result = this._to ? result[this._to[4]]() : this._from ? result[this._from[4]]() : result;\n    }\n    if (this._type === ObjectBag) {\n      result = this._to ? result.align(this._to) : this._from ? result.align(this._from) : result;\n    }\n    result = result.toConsumable();\n    this._morphObj = this._morphObj || new this._type();\n    this._context = this._context || Array.apply(null, Array(result.length)).map(Object).map(function (o) {\n      o.done = true;\n      return o;\n    });\n    return result;\n  }\n}\nclass NonMorphable {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(val) {\n    val = Array.isArray(val) ? val[0] : val;\n    this.value = val;\n    return this;\n  }\n  toArray() {\n    return [this.value];\n  }\n  valueOf() {\n    return this.value;\n  }\n}\nclass TransformBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(obj) {\n    if (Array.isArray(obj)) {\n      obj = {\n        scaleX: obj[0],\n        scaleY: obj[1],\n        shear: obj[2],\n        rotate: obj[3],\n        translateX: obj[4],\n        translateY: obj[5],\n        originX: obj[6],\n        originY: obj[7]\n      };\n    }\n    Object.assign(this, TransformBag.defaults, obj);\n    return this;\n  }\n  toArray() {\n    const v = this;\n    return [v.scaleX, v.scaleY, v.shear, v.rotate, v.translateX, v.translateY, v.originX, v.originY];\n  }\n}\nTransformBag.defaults = {\n  scaleX: 1,\n  scaleY: 1,\n  shear: 0,\n  rotate: 0,\n  translateX: 0,\n  translateY: 0,\n  originX: 0,\n  originY: 0\n};\nconst sortByKey = (a, b) => {\n  return a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0;\n};\nclass ObjectBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  align(other) {\n    const values = this.values;\n    for (let i = 0, il = values.length; i < il; ++i) {\n      // If the type is the same we only need to check if the color is in the correct format\n      if (values[i + 1] === other[i + 1]) {\n        if (values[i + 1] === Color && other[i + 7] !== values[i + 7]) {\n          const space = other[i + 7];\n          const color = new Color(this.values.splice(i + 3, 5))[space]().toArray();\n          this.values.splice(i + 3, 0, ...color);\n        }\n        i += values[i + 2] + 2;\n        continue;\n      }\n      if (!other[i + 1]) {\n        return this;\n      }\n\n      // The types differ, so we overwrite the new type with the old one\n      // And initialize it with the types default (e.g. black for color or 0 for number)\n      const defaultObject = new other[i + 1]().toArray();\n\n      // Than we fix the values array\n      const toDelete = values[i + 2] + 3;\n      values.splice(i, toDelete, other[i], other[i + 1], other[i + 2], ...defaultObject);\n      i += values[i + 2] + 2;\n    }\n    return this;\n  }\n  init(objOrArr) {\n    this.values = [];\n    if (Array.isArray(objOrArr)) {\n      this.values = objOrArr.slice();\n      return;\n    }\n    objOrArr = objOrArr || {};\n    const entries = [];\n    for (const i in objOrArr) {\n      const Type = getClassForType(objOrArr[i]);\n      const val = new Type(objOrArr[i]).toArray();\n      entries.push([i, Type, val.length, ...val]);\n    }\n    entries.sort(sortByKey);\n    this.values = entries.reduce((last, curr) => last.concat(curr), []);\n    return this;\n  }\n  toArray() {\n    return this.values;\n  }\n  valueOf() {\n    const obj = {};\n    const arr = this.values;\n\n    // for (var i = 0, len = arr.length; i < len; i += 2) {\n    while (arr.length) {\n      const key = arr.shift();\n      const Type = arr.shift();\n      const num = arr.shift();\n      const values = arr.splice(0, num);\n      obj[key] = new Type(values); // .valueOf()\n    }\n    return obj;\n  }\n}\nconst morphableTypes = [NonMorphable, TransformBag, ObjectBag];\nfunction registerMorphableType(type = []) {\n  morphableTypes.push(...[].concat(type));\n}\nfunction makeMorphable() {\n  extend(morphableTypes, {\n    to(val) {\n      return new Morphable().type(this.constructor).from(this.toArray()) // this.valueOf())\n      .to(val);\n    },\n    fromArray(arr) {\n      this.init(arr);\n      return this;\n    },\n    toConsumable() {\n      return this.toArray();\n    },\n    morph(from, to, pos, stepper, context) {\n      const mapper = function (i, index) {\n        return stepper.step(i, to[index], pos, context[index], context);\n      };\n      return this.fromArray(from.map(mapper));\n    }\n  });\n}\n\nclass Path extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('path', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return this._array || (this._array = new PathArray(this.attr('d')));\n  }\n\n  // Clear array cache\n  clear() {\n    delete this._array;\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return height == null ? this.bbox().height : this.size(this.bbox().width, height);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr('d', this.array().move(x, y));\n  }\n\n  // Plot new path\n  plot(d) {\n    return d == null ? this.array() : this.clear().attr('d', typeof d === 'string' ? d : this._array = new PathArray(d));\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr('d', this.array().size(p.width, p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return width == null ? this.bbox().width : this.size(width, this.bbox().height);\n  }\n\n  // Move by left top corner over x-axis\n  x(x) {\n    return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n  }\n\n  // Move by left top corner over y-axis\n  y(y) {\n    return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n  }\n}\n\n// Define morphable array\nPath.prototype.MorphArray = PathArray;\n\n// Add parent method\nregisterMethods({\n  Container: {\n    // Create a wrapped path element\n    path: wrapWithAttrCheck(function (d) {\n      // make sure plot is called as a setter\n      return this.put(new Path()).plot(d || new PathArray());\n    })\n  }\n});\nregister(Path, 'Path');\n\n// Get array\nfunction array() {\n  return this._array || (this._array = new PointArray(this.attr('points')));\n}\n\n// Clear array cache\nfunction clear() {\n  delete this._array;\n  return this;\n}\n\n// Move by left top corner\nfunction move$2(x, y) {\n  return this.attr('points', this.array().move(x, y));\n}\n\n// Plot new path\nfunction plot(p) {\n  return p == null ? this.array() : this.clear().attr('points', typeof p === 'string' ? p : this._array = new PointArray(p));\n}\n\n// Set element size to given width and height\nfunction size$1(width, height) {\n  const p = proportionalSize(this, width, height);\n  return this.attr('points', this.array().size(p.width, p.height));\n}\n\nvar poly = {\n  __proto__: null,\n  array: array,\n  clear: clear,\n  move: move$2,\n  plot: plot,\n  size: size$1\n};\n\nclass Polygon extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polygon', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polygon: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polygon()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polygon, pointed);\nextend(Polygon, poly);\nregister(Polygon, 'Polygon');\n\nclass Polyline extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polyline', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polyline: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polyline()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polyline, pointed);\nextend(Polyline, poly);\nregister(Polyline, 'Polyline');\n\nclass Rect extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('rect', node), attrs);\n  }\n}\nextend(Rect, {\n  rx,\n  ry\n});\nregisterMethods({\n  Container: {\n    // Create a rect element\n    rect: wrapWithAttrCheck(function (width, height) {\n      return this.put(new Rect()).size(width, height);\n    })\n  }\n});\nregister(Rect, 'Rect');\n\nclass Queue {\n  constructor() {\n    this._first = null;\n    this._last = null;\n  }\n\n  // Shows us the first item in the list\n  first() {\n    return this._first && this._first.value;\n  }\n\n  // Shows us the last item in the list\n  last() {\n    return this._last && this._last.value;\n  }\n  push(value) {\n    // An item stores an id and the provided value\n    const item = typeof value.next !== 'undefined' ? value : {\n      value: value,\n      next: null,\n      prev: null\n    };\n\n    // Deal with the queue being empty or populated\n    if (this._last) {\n      item.prev = this._last;\n      this._last.next = item;\n      this._last = item;\n    } else {\n      this._last = item;\n      this._first = item;\n    }\n\n    // Return the current item\n    return item;\n  }\n\n  // Removes the item that was returned from the push\n  remove(item) {\n    // Relink the previous item\n    if (item.prev) item.prev.next = item.next;\n    if (item.next) item.next.prev = item.prev;\n    if (item === this._last) this._last = item.prev;\n    if (item === this._first) this._first = item.next;\n\n    // Invalidate item\n    item.prev = null;\n    item.next = null;\n  }\n  shift() {\n    // Check if we have a value\n    const remove = this._first;\n    if (!remove) return null;\n\n    // If we do, remove it and relink things\n    this._first = remove.next;\n    if (this._first) this._first.prev = null;\n    this._last = this._first ? this._last : null;\n    return remove.value;\n  }\n}\n\nconst Animator = {\n  nextDraw: null,\n  frames: new Queue(),\n  timeouts: new Queue(),\n  immediates: new Queue(),\n  timer: () => globals.window.performance || globals.window.Date,\n  transforms: [],\n  frame(fn) {\n    // Store the node\n    const node = Animator.frames.push({\n      run: fn\n    });\n\n    // Request an animation frame if we don't have one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n\n    // Return the node so we can remove it easily\n    return node;\n  },\n  timeout(fn, delay) {\n    delay = delay || 0;\n\n    // Work out when the event should fire\n    const time = Animator.timer().now() + delay;\n\n    // Add the timeout to the end of the queue\n    const node = Animator.timeouts.push({\n      run: fn,\n      time: time\n    });\n\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  immediate(fn) {\n    // Add the immediate fn to the end of the queue\n    const node = Animator.immediates.push(fn);\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  cancelFrame(node) {\n    node != null && Animator.frames.remove(node);\n  },\n  clearTimeout(node) {\n    node != null && Animator.timeouts.remove(node);\n  },\n  cancelImmediate(node) {\n    node != null && Animator.immediates.remove(node);\n  },\n  _draw(now) {\n    // Run all the timeouts we can run, if they are not ready yet, add them\n    // to the end of the queue immediately! (bad timeouts!!! [sarcasm])\n    let nextTimeout = null;\n    const lastTimeout = Animator.timeouts.last();\n    while (nextTimeout = Animator.timeouts.shift()) {\n      // Run the timeout if its time, or push it to the end\n      if (now >= nextTimeout.time) {\n        nextTimeout.run();\n      } else {\n        Animator.timeouts.push(nextTimeout);\n      }\n\n      // If we hit the last item, we should stop shifting out more items\n      if (nextTimeout === lastTimeout) break;\n    }\n\n    // Run all of the animation frames\n    let nextFrame = null;\n    const lastFrame = Animator.frames.last();\n    while (nextFrame !== lastFrame && (nextFrame = Animator.frames.shift())) {\n      nextFrame.run(now);\n    }\n    let nextImmediate = null;\n    while (nextImmediate = Animator.immediates.shift()) {\n      nextImmediate();\n    }\n\n    // If we have remaining timeouts or frames, draw until we don't anymore\n    Animator.nextDraw = Animator.timeouts.first() || Animator.frames.first() ? globals.window.requestAnimationFrame(Animator._draw) : null;\n  }\n};\n\nconst makeSchedule = function (runnerInfo) {\n  const start = runnerInfo.start;\n  const duration = runnerInfo.runner.duration();\n  const end = start + duration;\n  return {\n    start: start,\n    duration: duration,\n    end: end,\n    runner: runnerInfo.runner\n  };\n};\nconst defaultSource = function () {\n  const w = globals.window;\n  return (w.performance || w.Date).now();\n};\nclass Timeline extends EventTarget {\n  // Construct a new timeline on the given element\n  constructor(timeSource = defaultSource) {\n    super();\n    this._timeSource = timeSource;\n\n    // terminate resets all variables to their initial state\n    this.terminate();\n  }\n  active() {\n    return !!this._nextFrame;\n  }\n  finish() {\n    // Go to end and pause\n    this.time(this.getEndTimeOfTimeline() + 1);\n    return this.pause();\n  }\n\n  // Calculates the end of the timeline\n  getEndTime() {\n    const lastRunnerInfo = this.getLastRunnerInfo();\n    const lastDuration = lastRunnerInfo ? lastRunnerInfo.runner.duration() : 0;\n    const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n    return lastStartTime + lastDuration;\n  }\n  getEndTimeOfTimeline() {\n    const endTimes = this._runners.map(i => i.start + i.runner.duration());\n    return Math.max(0, ...endTimes);\n  }\n  getLastRunnerInfo() {\n    return this.getRunnerInfoById(this._lastRunnerId);\n  }\n  getRunnerInfoById(id) {\n    return this._runners[this._runnerIds.indexOf(id)] || null;\n  }\n  pause() {\n    this._paused = true;\n    return this._continue();\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  play() {\n    // Now make sure we are not paused and continue the animation\n    this._paused = false;\n    return this.updateTime()._continue();\n  }\n  reverse(yes) {\n    const currentSpeed = this.speed();\n    if (yes == null) return this.speed(-currentSpeed);\n    const positive = Math.abs(currentSpeed);\n    return this.speed(yes ? -positive : positive);\n  }\n\n  // schedules a runner on the timeline\n  schedule(runner, delay, when) {\n    if (runner == null) {\n      return this._runners.map(makeSchedule);\n    }\n\n    // The start time for the next animation can either be given explicitly,\n    // derived from the current timeline time or it can be relative to the\n    // last start time to chain animations directly\n\n    let absoluteStartTime = 0;\n    const endTime = this.getEndTime();\n    delay = delay || 0;\n\n    // Work out when to start the animation\n    if (when == null || when === 'last' || when === 'after') {\n      // Take the last time and increment\n      absoluteStartTime = endTime;\n    } else if (when === 'absolute' || when === 'start') {\n      absoluteStartTime = delay;\n      delay = 0;\n    } else if (when === 'now') {\n      absoluteStartTime = this._time;\n    } else if (when === 'relative') {\n      const runnerInfo = this.getRunnerInfoById(runner.id);\n      if (runnerInfo) {\n        absoluteStartTime = runnerInfo.start + delay;\n        delay = 0;\n      }\n    } else if (when === 'with-last') {\n      const lastRunnerInfo = this.getLastRunnerInfo();\n      const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n      absoluteStartTime = lastStartTime;\n    } else {\n      throw new Error('Invalid value for the \"when\" parameter');\n    }\n\n    // Manage runner\n    runner.unschedule();\n    runner.timeline(this);\n    const persist = runner.persist();\n    const runnerInfo = {\n      persist: persist === null ? this._persist : persist,\n      start: absoluteStartTime + delay,\n      runner\n    };\n    this._lastRunnerId = runner.id;\n    this._runners.push(runnerInfo);\n    this._runners.sort((a, b) => a.start - b.start);\n    this._runnerIds = this._runners.map(info => info.runner.id);\n    this.updateTime()._continue();\n    return this;\n  }\n  seek(dt) {\n    return this.time(this._time + dt);\n  }\n  source(fn) {\n    if (fn == null) return this._timeSource;\n    this._timeSource = fn;\n    return this;\n  }\n  speed(speed) {\n    if (speed == null) return this._speed;\n    this._speed = speed;\n    return this;\n  }\n  stop() {\n    // Go to start and pause\n    this.time(0);\n    return this.pause();\n  }\n  time(time) {\n    if (time == null) return this._time;\n    this._time = time;\n    return this._continue(true);\n  }\n\n  // Remove the runner from this timeline\n  unschedule(runner) {\n    const index = this._runnerIds.indexOf(runner.id);\n    if (index < 0) return this;\n    this._runners.splice(index, 1);\n    this._runnerIds.splice(index, 1);\n    runner.timeline(null);\n    return this;\n  }\n\n  // Makes sure, that after pausing the time doesn't jump\n  updateTime() {\n    if (!this.active()) {\n      this._lastSourceTime = this._timeSource();\n    }\n    return this;\n  }\n\n  // Checks if we are running and continues the animation\n  _continue(immediateStep = false) {\n    Animator.cancelFrame(this._nextFrame);\n    this._nextFrame = null;\n    if (immediateStep) return this._stepImmediate();\n    if (this._paused) return this;\n    this._nextFrame = Animator.frame(this._step);\n    return this;\n  }\n  _stepFn(immediateStep = false) {\n    // Get the time delta from the last time and update the time\n    const time = this._timeSource();\n    let dtSource = time - this._lastSourceTime;\n    if (immediateStep) dtSource = 0;\n    const dtTime = this._speed * dtSource + (this._time - this._lastStepTime);\n    this._lastSourceTime = time;\n\n    // Only update the time if we use the timeSource.\n    // Otherwise use the current time\n    if (!immediateStep) {\n      // Update the time\n      this._time += dtTime;\n      this._time = this._time < 0 ? 0 : this._time;\n    }\n    this._lastStepTime = this._time;\n    this.fire('time', this._time);\n\n    // This is for the case that the timeline was seeked so that the time\n    // is now before the startTime of the runner. That is why we need to set\n    // the runner to position 0\n\n    // FIXME:\n    // However, resetting in insertion order leads to bugs. Considering the case,\n    // where 2 runners change the same attribute but in different times,\n    // resetting both of them will lead to the case where the later defined\n    // runner always wins the reset even if the other runner started earlier\n    // and therefore should win the attribute battle\n    // this can be solved by resetting them backwards\n    for (let k = this._runners.length; k--;) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[k];\n      const runner = runnerInfo.runner;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      // and try to reset it\n      if (dtToStart <= 0) {\n        runner.reset();\n      }\n    }\n\n    // Run all of the runners directly\n    let runnersLeft = false;\n    for (let i = 0, len = this._runners.length; i < len; i++) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[i];\n      const runner = runnerInfo.runner;\n      let dt = dtTime;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      if (dtToStart <= 0) {\n        runnersLeft = true;\n        continue;\n      } else if (dtToStart < dt) {\n        // Adjust dt to make sure that animation is on point\n        dt = dtToStart;\n      }\n      if (!runner.active()) continue;\n\n      // If this runner is still going, signal that we need another animation\n      // frame, otherwise, remove the completed runner\n      const finished = runner.step(dt).done;\n      if (!finished) {\n        runnersLeft = true;\n        // continue\n      } else if (runnerInfo.persist !== true) {\n        // runner is finished. And runner might get removed\n        const endTime = runner.duration() - runner.time() + this._time;\n        if (endTime + runnerInfo.persist < this._time) {\n          // Delete runner and correct index\n          runner.unschedule();\n          --i;\n          --len;\n        }\n      }\n    }\n\n    // Basically: we continue when there are runners right from us in time\n    // when -->, and when runners are left from us when <--\n    if (runnersLeft && !(this._speed < 0 && this._time === 0) || this._runnerIds.length && this._speed < 0 && this._time > 0) {\n      this._continue();\n    } else {\n      this.pause();\n      this.fire('finished');\n    }\n    return this;\n  }\n  terminate() {\n    // cleanup memory\n\n    // Store the timing variables\n    this._startTime = 0;\n    this._speed = 1.0;\n\n    // Determines how long a runner is hold in memory. Can be a dt or true/false\n    this._persist = 0;\n\n    // Keep track of the running animations and their starting parameters\n    this._nextFrame = null;\n    this._paused = true;\n    this._runners = [];\n    this._runnerIds = [];\n    this._lastRunnerId = -1;\n    this._time = 0;\n    this._lastSourceTime = 0;\n    this._lastStepTime = 0;\n\n    // Make sure that step is always called in class context\n    this._step = this._stepFn.bind(this, false);\n    this._stepImmediate = this._stepFn.bind(this, true);\n  }\n}\nregisterMethods({\n  Element: {\n    timeline: function (timeline) {\n      if (timeline == null) {\n        this._timeline = this._timeline || new Timeline();\n        return this._timeline;\n      } else {\n        this._timeline = timeline;\n        return this;\n      }\n    }\n  }\n});\n\nclass Runner extends EventTarget {\n  constructor(options) {\n    super();\n\n    // Store a unique id on the runner, so that we can identify it later\n    this.id = Runner.id++;\n\n    // Ensure a default value\n    options = options == null ? timeline.duration : options;\n\n    // Ensure that we get a controller\n    options = typeof options === 'function' ? new Controller(options) : options;\n\n    // Declare all of the variables\n    this._element = null;\n    this._timeline = null;\n    this.done = false;\n    this._queue = [];\n\n    // Work out the stepper and the duration\n    this._duration = typeof options === 'number' && options;\n    this._isDeclarative = options instanceof Controller;\n    this._stepper = this._isDeclarative ? options : new Ease();\n\n    // We copy the current values from the timeline because they can change\n    this._history = {};\n\n    // Store the state of the runner\n    this.enabled = true;\n    this._time = 0;\n    this._lastTime = 0;\n\n    // At creation, the runner is in reset state\n    this._reseted = true;\n\n    // Save transforms applied to this runner\n    this.transforms = new Matrix();\n    this.transformId = 1;\n\n    // Looping variables\n    this._haveReversed = false;\n    this._reverse = false;\n    this._loopsDone = 0;\n    this._swing = false;\n    this._wait = 0;\n    this._times = 1;\n    this._frameId = null;\n\n    // Stores how long a runner is stored after being done\n    this._persist = this._isDeclarative ? true : null;\n  }\n  static sanitise(duration, delay, when) {\n    // Initialise the default parameters\n    let times = 1;\n    let swing = false;\n    let wait = 0;\n    duration = duration ?? timeline.duration;\n    delay = delay ?? timeline.delay;\n    when = when || 'last';\n\n    // If we have an object, unpack the values\n    if (typeof duration === 'object' && !(duration instanceof Stepper)) {\n      delay = duration.delay ?? delay;\n      when = duration.when ?? when;\n      swing = duration.swing || swing;\n      times = duration.times ?? times;\n      wait = duration.wait ?? wait;\n      duration = duration.duration ?? timeline.duration;\n    }\n    return {\n      duration: duration,\n      delay: delay,\n      swing: swing,\n      times: times,\n      wait: wait,\n      when: when\n    };\n  }\n  active(enabled) {\n    if (enabled == null) return this.enabled;\n    this.enabled = enabled;\n    return this;\n  }\n\n  /*\n  Private Methods\n  ===============\n  Methods that shouldn't be used externally\n  */\n  addTransform(transform) {\n    this.transforms.lmultiplyO(transform);\n    return this;\n  }\n  after(fn) {\n    return this.on('finished', fn);\n  }\n  animate(duration, delay, when) {\n    const o = Runner.sanitise(duration, delay, when);\n    const runner = new Runner(o.duration);\n    if (this._timeline) runner.timeline(this._timeline);\n    if (this._element) runner.element(this._element);\n    return runner.loop(o).schedule(o.delay, o.when);\n  }\n  clearTransform() {\n    this.transforms = new Matrix();\n    return this;\n  }\n\n  // TODO: Keep track of all transformations so that deletion is faster\n  clearTransformsFromQueue() {\n    if (!this.done || !this._timeline || !this._timeline._runnerIds.includes(this.id)) {\n      this._queue = this._queue.filter(item => {\n        return !item.isTransform;\n      });\n    }\n  }\n  delay(delay) {\n    return this.animate(0, delay);\n  }\n  duration() {\n    return this._times * (this._wait + this._duration) - this._wait;\n  }\n  during(fn) {\n    return this.queue(null, fn);\n  }\n  ease(fn) {\n    this._stepper = new Ease(fn);\n    return this;\n  }\n  /*\n  Runner Definitions\n  ==================\n  These methods help us define the runtime behaviour of the Runner or they\n  help us make new runners from the current runner\n  */\n\n  element(element) {\n    if (element == null) return this._element;\n    this._element = element;\n    element._prepareRunner();\n    return this;\n  }\n  finish() {\n    return this.step(Infinity);\n  }\n  loop(times, swing, wait) {\n    // Deal with the user passing in an object\n    if (typeof times === 'object') {\n      swing = times.swing;\n      wait = times.wait;\n      times = times.times;\n    }\n\n    // Sanitise the values and store them\n    this._times = times || Infinity;\n    this._swing = swing || false;\n    this._wait = wait || 0;\n\n    // Allow true to be passed\n    if (this._times === true) {\n      this._times = Infinity;\n    }\n    return this;\n  }\n  loops(p) {\n    const loopDuration = this._duration + this._wait;\n    if (p == null) {\n      const loopsDone = Math.floor(this._time / loopDuration);\n      const relativeTime = this._time - loopsDone * loopDuration;\n      const position = relativeTime / this._duration;\n      return Math.min(loopsDone + position, this._times);\n    }\n    const whole = Math.floor(p);\n    const partial = p % 1;\n    const time = loopDuration * whole + this._duration * partial;\n    return this.time(time);\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  position(p) {\n    // Get all of the variables we need\n    const x = this._time;\n    const d = this._duration;\n    const w = this._wait;\n    const t = this._times;\n    const s = this._swing;\n    const r = this._reverse;\n    let position;\n    if (p == null) {\n      /*\n      This function converts a time to a position in the range [0, 1]\n      The full explanation can be found in this desmos demonstration\n        https://www.desmos.com/calculator/u4fbavgche\n      The logic is slightly simplified here because we can use booleans\n      */\n\n      // Figure out the value without thinking about the start or end time\n      const f = function (x) {\n        const swinging = s * Math.floor(x % (2 * (w + d)) / (w + d));\n        const backwards = swinging && !r || !swinging && r;\n        const uncliped = Math.pow(-1, backwards) * (x % (w + d)) / d + backwards;\n        const clipped = Math.max(Math.min(uncliped, 1), 0);\n        return clipped;\n      };\n\n      // Figure out the value by incorporating the start time\n      const endTime = t * (w + d) - w;\n      position = x <= 0 ? Math.round(f(1e-5)) : x < endTime ? f(x) : Math.round(f(endTime - 1e-5));\n      return position;\n    }\n\n    // Work out the loops done and add the position to the loops done\n    const loopsDone = Math.floor(this.loops());\n    const swingForward = s && loopsDone % 2 === 0;\n    const forwards = swingForward && !r || r && swingForward;\n    position = loopsDone + (forwards ? p : 1 - p);\n    return this.loops(position);\n  }\n  progress(p) {\n    if (p == null) {\n      return Math.min(1, this._time / this.duration());\n    }\n    return this.time(p * this.duration());\n  }\n\n  /*\n  Basic Functionality\n  ===================\n  These methods allow us to attach basic functions to the runner directly\n  */\n  queue(initFn, runFn, retargetFn, isTransform) {\n    this._queue.push({\n      initialiser: initFn || noop,\n      runner: runFn || noop,\n      retarget: retargetFn,\n      isTransform: isTransform,\n      initialised: false,\n      finished: false\n    });\n    const timeline = this.timeline();\n    timeline && this.timeline()._continue();\n    return this;\n  }\n  reset() {\n    if (this._reseted) return this;\n    this.time(0);\n    this._reseted = true;\n    return this;\n  }\n  reverse(reverse) {\n    this._reverse = reverse == null ? !this._reverse : reverse;\n    return this;\n  }\n  schedule(timeline, delay, when) {\n    // The user doesn't need to pass a timeline if we already have one\n    if (!(timeline instanceof Timeline)) {\n      when = delay;\n      delay = timeline;\n      timeline = this.timeline();\n    }\n\n    // If there is no timeline, yell at the user...\n    if (!timeline) {\n      throw Error('Runner cannot be scheduled without timeline');\n    }\n\n    // Schedule the runner on the timeline provided\n    timeline.schedule(this, delay, when);\n    return this;\n  }\n  step(dt) {\n    // If we are inactive, this stepper just gets skipped\n    if (!this.enabled) return this;\n\n    // Update the time and get the new position\n    dt = dt == null ? 16 : dt;\n    this._time += dt;\n    const position = this.position();\n\n    // Figure out if we need to run the stepper in this frame\n    const running = this._lastPosition !== position && this._time >= 0;\n    this._lastPosition = position;\n\n    // Figure out if we just started\n    const duration = this.duration();\n    const justStarted = this._lastTime <= 0 && this._time > 0;\n    const justFinished = this._lastTime < duration && this._time >= duration;\n    this._lastTime = this._time;\n    if (justStarted) {\n      this.fire('start', this);\n    }\n\n    // Work out if the runner is finished set the done flag here so animations\n    // know, that they are running in the last step (this is good for\n    // transformations which can be merged)\n    const declarative = this._isDeclarative;\n    this.done = !declarative && !justFinished && this._time >= duration;\n\n    // Runner is running. So its not in reset state anymore\n    this._reseted = false;\n    let converged = false;\n    // Call initialise and the run function\n    if (running || declarative) {\n      this._initialise(running);\n\n      // clear the transforms on this runner so they dont get added again and again\n      this.transforms = new Matrix();\n      converged = this._run(declarative ? dt : position);\n      this.fire('step', this);\n    }\n    // correct the done flag here\n    // declarative animations itself know when they converged\n    this.done = this.done || converged && declarative;\n    if (justFinished) {\n      this.fire('finished', this);\n    }\n    return this;\n  }\n\n  /*\n  Runner animation methods\n  ========================\n  Control how the animation plays\n  */\n  time(time) {\n    if (time == null) {\n      return this._time;\n    }\n    const dt = time - this._time;\n    this.step(dt);\n    return this;\n  }\n  timeline(timeline) {\n    // check explicitly for undefined so we can set the timeline to null\n    if (typeof timeline === 'undefined') return this._timeline;\n    this._timeline = timeline;\n    return this;\n  }\n  unschedule() {\n    const timeline = this.timeline();\n    timeline && timeline.unschedule(this);\n    return this;\n  }\n\n  // Run each initialise function in the runner if required\n  _initialise(running) {\n    // If we aren't running, we shouldn't initialise when not declarative\n    if (!running && !this._isDeclarative) return;\n\n    // Loop through all of the initialisers\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current initialiser\n      const current = this._queue[i];\n\n      // Determine whether we need to initialise\n      const needsIt = this._isDeclarative || !current.initialised && running;\n      running = !current.finished;\n\n      // Call the initialiser if we need to\n      if (needsIt && running) {\n        current.initialiser.call(this);\n        current.initialised = true;\n      }\n    }\n  }\n\n  // Save a morpher to the morpher list so that we can retarget it later\n  _rememberMorpher(method, morpher) {\n    this._history[method] = {\n      morpher: morpher,\n      caller: this._queue[this._queue.length - 1]\n    };\n\n    // We have to resume the timeline in case a controller\n    // is already done without being ever run\n    // This can happen when e.g. this is done:\n    //    anim = el.animate(new SVG.Spring)\n    // and later\n    //    anim.move(...)\n    if (this._isDeclarative) {\n      const timeline = this.timeline();\n      timeline && timeline.play();\n    }\n  }\n\n  // Try to set the target for a morpher if the morpher exists, otherwise\n  // Run each run function for the position or dt given\n  _run(positionOrDt) {\n    // Run all of the _queue directly\n    let allfinished = true;\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current function to run\n      const current = this._queue[i];\n\n      // Run the function if its not finished, we keep track of the finished\n      // flag for the sake of declarative _queue\n      const converged = current.runner.call(this, positionOrDt);\n      current.finished = current.finished || converged === true;\n      allfinished = allfinished && current.finished;\n    }\n\n    // We report when all of the constructors are finished\n    return allfinished;\n  }\n\n  // do nothing and return false\n  _tryRetarget(method, target, extra) {\n    if (this._history[method]) {\n      // if the last method wasn't even initialised, throw it away\n      if (!this._history[method].caller.initialised) {\n        const index = this._queue.indexOf(this._history[method].caller);\n        this._queue.splice(index, 1);\n        return false;\n      }\n\n      // for the case of transformations, we use the special retarget function\n      // which has access to the outer scope\n      if (this._history[method].caller.retarget) {\n        this._history[method].caller.retarget.call(this, target, extra);\n        // for everything else a simple morpher change is sufficient\n      } else {\n        this._history[method].morpher.to(target);\n      }\n      this._history[method].caller.finished = false;\n      const timeline = this.timeline();\n      timeline && timeline.play();\n      return true;\n    }\n    return false;\n  }\n}\nRunner.id = 0;\nclass FakeRunner {\n  constructor(transforms = new Matrix(), id = -1, done = true) {\n    this.transforms = transforms;\n    this.id = id;\n    this.done = done;\n  }\n  clearTransformsFromQueue() {}\n}\nextend([Runner, FakeRunner], {\n  mergeWith(runner) {\n    return new FakeRunner(runner.transforms.lmultiply(this.transforms), runner.id);\n  }\n});\n\n// FakeRunner.emptyRunner = new FakeRunner()\n\nconst lmultiply = (last, curr) => last.lmultiplyO(curr);\nconst getRunnerTransform = runner => runner.transforms;\nfunction mergeTransforms() {\n  // Find the matrix to apply to the element and apply it\n  const runners = this._transformationRunners.runners;\n  const netTransform = runners.map(getRunnerTransform).reduce(lmultiply, new Matrix());\n  this.transform(netTransform);\n  this._transformationRunners.merge();\n  if (this._transformationRunners.length() === 1) {\n    this._frameId = null;\n  }\n}\nclass RunnerArray {\n  constructor() {\n    this.runners = [];\n    this.ids = [];\n  }\n  add(runner) {\n    if (this.runners.includes(runner)) return;\n    const id = runner.id + 1;\n    this.runners.push(runner);\n    this.ids.push(id);\n    return this;\n  }\n  clearBefore(id) {\n    const deleteCnt = this.ids.indexOf(id + 1) || 1;\n    this.ids.splice(0, deleteCnt, 0);\n    this.runners.splice(0, deleteCnt, new FakeRunner()).forEach(r => r.clearTransformsFromQueue());\n    return this;\n  }\n  edit(id, newRunner) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1, id + 1);\n    this.runners.splice(index, 1, newRunner);\n    return this;\n  }\n  getByID(id) {\n    return this.runners[this.ids.indexOf(id + 1)];\n  }\n  length() {\n    return this.ids.length;\n  }\n  merge() {\n    let lastRunner = null;\n    for (let i = 0; i < this.runners.length; ++i) {\n      const runner = this.runners[i];\n      const condition = lastRunner && runner.done && lastRunner.done && (\n      // don't merge runner when persisted on timeline\n      !runner._timeline || !runner._timeline._runnerIds.includes(runner.id)) && (!lastRunner._timeline || !lastRunner._timeline._runnerIds.includes(lastRunner.id));\n      if (condition) {\n        // the +1 happens in the function\n        this.remove(runner.id);\n        const newRunner = runner.mergeWith(lastRunner);\n        this.edit(lastRunner.id, newRunner);\n        lastRunner = newRunner;\n        --i;\n      } else {\n        lastRunner = runner;\n      }\n    }\n    return this;\n  }\n  remove(id) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1);\n    this.runners.splice(index, 1);\n    return this;\n  }\n}\nregisterMethods({\n  Element: {\n    animate(duration, delay, when) {\n      const o = Runner.sanitise(duration, delay, when);\n      const timeline = this.timeline();\n      return new Runner(o.duration).loop(o).element(this).timeline(timeline.play()).schedule(o.delay, o.when);\n    },\n    delay(by, when) {\n      return this.animate(0, by, when);\n    },\n    // this function searches for all runners on the element and deletes the ones\n    // which run before the current one. This is because absolute transformations\n    // overwrite anything anyway so there is no need to waste time computing\n    // other runners\n    _clearTransformRunnersBefore(currentRunner) {\n      this._transformationRunners.clearBefore(currentRunner.id);\n    },\n    _currentTransform(current) {\n      return this._transformationRunners.runners\n      // we need the equal sign here to make sure, that also transformations\n      // on the same runner which execute before the current transformation are\n      // taken into account\n      .filter(runner => runner.id <= current.id).map(getRunnerTransform).reduce(lmultiply, new Matrix());\n    },\n    _addRunner(runner) {\n      this._transformationRunners.add(runner);\n\n      // Make sure that the runner merge is executed at the very end of\n      // all Animator functions. That is why we use immediate here to execute\n      // the merge right after all frames are run\n      Animator.cancelImmediate(this._frameId);\n      this._frameId = Animator.immediate(mergeTransforms.bind(this));\n    },\n    _prepareRunner() {\n      if (this._frameId == null) {\n        this._transformationRunners = new RunnerArray().add(new FakeRunner(new Matrix(this)));\n      }\n    }\n  }\n});\n\n// Will output the elements from array A that are not in the array B\nconst difference = (a, b) => a.filter(x => !b.includes(x));\nextend(Runner, {\n  attr(a, v) {\n    return this.styleAttr('attr', a, v);\n  },\n  // Add animatable styles\n  css(s, v) {\n    return this.styleAttr('css', s, v);\n  },\n  styleAttr(type, nameOrAttrs, val) {\n    if (typeof nameOrAttrs === 'string') {\n      return this.styleAttr(type, {\n        [nameOrAttrs]: val\n      });\n    }\n    let attrs = nameOrAttrs;\n    if (this._tryRetarget(type, attrs)) return this;\n    let morpher = new Morphable(this._stepper).to(attrs);\n    let keys = Object.keys(attrs);\n    this.queue(function () {\n      morpher = morpher.from(this.element()[type](keys));\n    }, function (pos) {\n      this.element()[type](morpher.at(pos).valueOf());\n      return morpher.done();\n    }, function (newToAttrs) {\n      // Check if any new keys were added\n      const newKeys = Object.keys(newToAttrs);\n      const differences = difference(newKeys, keys);\n\n      // If their are new keys, initialize them and add them to morpher\n      if (differences.length) {\n        // Get the values\n        const addedFromAttrs = this.element()[type](differences);\n\n        // Get the already initialized values\n        const oldFromAttrs = new ObjectBag(morpher.from()).valueOf();\n\n        // Merge old and new\n        Object.assign(oldFromAttrs, addedFromAttrs);\n        morpher.from(oldFromAttrs);\n      }\n\n      // Get the object from the morpher\n      const oldToAttrs = new ObjectBag(morpher.to()).valueOf();\n\n      // Merge in new attributes\n      Object.assign(oldToAttrs, newToAttrs);\n\n      // Change morpher target\n      morpher.to(oldToAttrs);\n\n      // Make sure that we save the work we did so we don't need it to do again\n      keys = newKeys;\n      attrs = newToAttrs;\n    });\n    this._rememberMorpher(type, morpher);\n    return this;\n  },\n  zoom(level, point) {\n    if (this._tryRetarget('zoom', level, point)) return this;\n    let morpher = new Morphable(this._stepper).to(new SVGNumber(level));\n    this.queue(function () {\n      morpher = morpher.from(this.element().zoom());\n    }, function (pos) {\n      this.element().zoom(morpher.at(pos), point);\n      return morpher.done();\n    }, function (newLevel, newPoint) {\n      point = newPoint;\n      morpher.to(newLevel);\n    });\n    this._rememberMorpher('zoom', morpher);\n    return this;\n  },\n  /**\n   ** absolute transformations\n   **/\n\n  //\n  // M v -----|-----(D M v = F v)------|----->  T v\n  //\n  // 1. define the final state (T) and decompose it (once)\n  //    t = [tx, ty, the, lam, sy, sx]\n  // 2. on every frame: pull the current state of all previous transforms\n  //    (M - m can change)\n  //   and then write this as m = [tx0, ty0, the0, lam0, sy0, sx0]\n  // 3. Find the interpolated matrix F(pos) = m + pos * (t - m)\n  //   - Note F(0) = M\n  //   - Note F(1) = T\n  // 4. Now you get the delta matrix as a result: D = F * inv(M)\n\n  transform(transforms, relative, affine) {\n    // If we have a declarative function, we should retarget it if possible\n    relative = transforms.relative || relative;\n    if (this._isDeclarative && !relative && this._tryRetarget('transform', transforms)) {\n      return this;\n    }\n\n    // Parse the parameters\n    const isMatrix = Matrix.isMatrixLike(transforms);\n    affine = transforms.affine != null ? transforms.affine : affine != null ? affine : !isMatrix;\n\n    // Create a morpher and set its type\n    const morpher = new Morphable(this._stepper).type(affine ? TransformBag : Matrix);\n    let origin;\n    let element;\n    let current;\n    let currentAngle;\n    let startTransform;\n    function setup() {\n      // make sure element and origin is defined\n      element = element || this.element();\n      origin = origin || getOrigin(transforms, element);\n      startTransform = new Matrix(relative ? undefined : element);\n\n      // add the runner to the element so it can merge transformations\n      element._addRunner(this);\n\n      // Deactivate all transforms that have run so far if we are absolute\n      if (!relative) {\n        element._clearTransformRunnersBefore(this);\n      }\n    }\n    function run(pos) {\n      // clear all other transforms before this in case something is saved\n      // on this runner. We are absolute. We dont need these!\n      if (!relative) this.clearTransform();\n      const {\n        x,\n        y\n      } = new Point(origin).transform(element._currentTransform(this));\n      let target = new Matrix({\n        ...transforms,\n        origin: [x, y]\n      });\n      let start = this._isDeclarative && current ? current : startTransform;\n      if (affine) {\n        target = target.decompose(x, y);\n        start = start.decompose(x, y);\n\n        // Get the current and target angle as it was set\n        const rTarget = target.rotate;\n        const rCurrent = start.rotate;\n\n        // Figure out the shortest path to rotate directly\n        const possibilities = [rTarget - 360, rTarget, rTarget + 360];\n        const distances = possibilities.map(a => Math.abs(a - rCurrent));\n        const shortest = Math.min(...distances);\n        const index = distances.indexOf(shortest);\n        target.rotate = possibilities[index];\n      }\n      if (relative) {\n        // we have to be careful here not to overwrite the rotation\n        // with the rotate method of Matrix\n        if (!isMatrix) {\n          target.rotate = transforms.rotate || 0;\n        }\n        if (this._isDeclarative && currentAngle) {\n          start.rotate = currentAngle;\n        }\n      }\n      morpher.from(start);\n      morpher.to(target);\n      const affineParameters = morpher.at(pos);\n      currentAngle = affineParameters.rotate;\n      current = new Matrix(affineParameters);\n      this.addTransform(current);\n      element._addRunner(this);\n      return morpher.done();\n    }\n    function retarget(newTransforms) {\n      // only get a new origin if it changed since the last call\n      if ((newTransforms.origin || 'center').toString() !== (transforms.origin || 'center').toString()) {\n        origin = getOrigin(newTransforms, element);\n      }\n\n      // overwrite the old transformations with the new ones\n      transforms = {\n        ...newTransforms,\n        origin\n      };\n    }\n    this.queue(setup, run, retarget, true);\n    this._isDeclarative && this._rememberMorpher('transform', morpher);\n    return this;\n  },\n  // Animatable x-axis\n  x(x) {\n    return this._queueNumber('x', x);\n  },\n  // Animatable y-axis\n  y(y) {\n    return this._queueNumber('y', y);\n  },\n  ax(x) {\n    return this._queueNumber('ax', x);\n  },\n  ay(y) {\n    return this._queueNumber('ay', y);\n  },\n  dx(x = 0) {\n    return this._queueNumberDelta('x', x);\n  },\n  dy(y = 0) {\n    return this._queueNumberDelta('y', y);\n  },\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  },\n  _queueNumberDelta(method, to) {\n    to = new SVGNumber(to);\n\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    let from = null;\n    this.queue(function () {\n      from = this.element()[method]();\n      morpher.from(from);\n      morpher.to(from + to);\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    }, function (newTo) {\n      morpher.to(from + new SVGNumber(newTo));\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueObject(method, to) {\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    this.queue(function () {\n      morpher.from(this.element()[method]());\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueNumber(method, value) {\n    return this._queueObject(method, new SVGNumber(value));\n  },\n  // Animatable center x-axis\n  cx(x) {\n    return this._queueNumber('cx', x);\n  },\n  // Animatable center y-axis\n  cy(y) {\n    return this._queueNumber('cy', y);\n  },\n  // Add animatable move\n  move(x, y) {\n    return this.x(x).y(y);\n  },\n  amove(x, y) {\n    return this.ax(x).ay(y);\n  },\n  // Add animatable center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  },\n  // Add animatable size\n  size(width, height) {\n    // animate bbox based size for all other elements\n    let box;\n    if (!width || !height) {\n      box = this._element.bbox();\n    }\n    if (!width) {\n      width = box.width / box.height * height;\n    }\n    if (!height) {\n      height = box.height / box.width * width;\n    }\n    return this.width(width).height(height);\n  },\n  // Add animatable width\n  width(width) {\n    return this._queueNumber('width', width);\n  },\n  // Add animatable height\n  height(height) {\n    return this._queueNumber('height', height);\n  },\n  // Add animatable plot\n  plot(a, b, c, d) {\n    // Lines can be plotted with 4 arguments\n    if (arguments.length === 4) {\n      return this.plot([a, b, c, d]);\n    }\n    if (this._tryRetarget('plot', a)) return this;\n    const morpher = new Morphable(this._stepper).type(this._element.MorphArray).to(a);\n    this.queue(function () {\n      morpher.from(this._element.array());\n    }, function (pos) {\n      this._element.plot(morpher.at(pos));\n      return morpher.done();\n    });\n    this._rememberMorpher('plot', morpher);\n    return this;\n  },\n  // Add leading method\n  leading(value) {\n    return this._queueNumber('leading', value);\n  },\n  // Add animatable viewbox\n  viewbox(x, y, width, height) {\n    return this._queueObject('viewbox', new Box(x, y, width, height));\n  },\n  update(o) {\n    if (typeof o !== 'object') {\n      return this.update({\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      });\n    }\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', o.offset);\n    return this;\n  }\n});\nextend(Runner, {\n  rx,\n  ry,\n  from,\n  to\n});\nregister(Runner, 'Runner');\n\nclass Svg extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('svg', node), attrs);\n    this.namespace();\n  }\n\n  // Creates and returns defs element\n  defs() {\n    if (!this.isRoot()) return this.root().defs();\n    return adopt(this.node.querySelector('defs')) || this.put(new Defs());\n  }\n  isRoot() {\n    return !this.node.parentNode || !(this.node.parentNode instanceof globals.window.SVGElement) && this.node.parentNode.nodeName !== '#document-fragment';\n  }\n\n  // Add namespaces\n  namespace() {\n    if (!this.isRoot()) return this.root().namespace();\n    return this.attr({\n      xmlns: svg,\n      version: '1.1'\n    }).attr('xmlns:xlink', xlink, xmlns);\n  }\n  removeNamespace() {\n    return this.attr({\n      xmlns: null,\n      version: null\n    }).attr('xmlns:xlink', null, xmlns).attr('xmlns:svgjs', null, xmlns);\n  }\n\n  // Check if this is a root svg\n  // If not, call root() from this element\n  root() {\n    if (this.isRoot()) return this;\n    return super.root();\n  }\n}\nregisterMethods({\n  Container: {\n    // Create nested svg document\n    nested: wrapWithAttrCheck(function () {\n      return this.put(new Svg());\n    })\n  }\n});\nregister(Svg, 'Svg', true);\n\nclass Symbol extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('symbol', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    symbol: wrapWithAttrCheck(function () {\n      return this.put(new Symbol());\n    })\n  }\n});\nregister(Symbol, 'Symbol');\n\n// Create plain text node\nfunction plain(text) {\n  // clear if build mode is disabled\n  if (this._build === false) {\n    this.clear();\n  }\n\n  // create text node\n  this.node.appendChild(globals.document.createTextNode(text));\n  return this;\n}\n\n// Get length of text element\nfunction length() {\n  return this.node.getComputedTextLength();\n}\n\n// Move over x-axis\n// Text is moved by its bounding box\n// text-anchor does NOT matter\nfunction x$1(x, box = this.bbox()) {\n  if (x == null) {\n    return box.x;\n  }\n  return this.attr('x', this.attr('x') + x - box.x);\n}\n\n// Move over y-axis\nfunction y$1(y, box = this.bbox()) {\n  if (y == null) {\n    return box.y;\n  }\n  return this.attr('y', this.attr('y') + y - box.y);\n}\nfunction move$1(x, y, box = this.bbox()) {\n  return this.x(x, box).y(y, box);\n}\n\n// Move center over x-axis\nfunction cx(x, box = this.bbox()) {\n  if (x == null) {\n    return box.cx;\n  }\n  return this.attr('x', this.attr('x') + x - box.cx);\n}\n\n// Move center over y-axis\nfunction cy(y, box = this.bbox()) {\n  if (y == null) {\n    return box.cy;\n  }\n  return this.attr('y', this.attr('y') + y - box.cy);\n}\nfunction center(x, y, box = this.bbox()) {\n  return this.cx(x, box).cy(y, box);\n}\nfunction ax(x) {\n  return this.attr('x', x);\n}\nfunction ay(y) {\n  return this.attr('y', y);\n}\nfunction amove(x, y) {\n  return this.ax(x).ay(y);\n}\n\n// Enable / disable build mode\nfunction build(build) {\n  this._build = !!build;\n  return this;\n}\n\nvar textable = {\n  __proto__: null,\n  amove: amove,\n  ax: ax,\n  ay: ay,\n  build: build,\n  center: center,\n  cx: cx,\n  cy: cy,\n  length: length,\n  move: move$1,\n  plain: plain,\n  x: x$1,\n  y: y$1\n};\n\nclass Text extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('text', node), attrs);\n    this.dom.leading = this.dom.leading ?? new SVGNumber(1.3); // store leading value for rebuilding\n    this._rebuild = true; // enable automatic updating of dy values\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Set / get leading\n  leading(value) {\n    // act as getter\n    if (value == null) {\n      return this.dom.leading;\n    }\n\n    // act as setter\n    this.dom.leading = new SVGNumber(value);\n    return this.rebuild();\n  }\n\n  // Rebuild appearance type\n  rebuild(rebuild) {\n    // store new rebuild flag if given\n    if (typeof rebuild === 'boolean') {\n      this._rebuild = rebuild;\n    }\n\n    // define position of all lines\n    if (this._rebuild) {\n      const self = this;\n      let blankLineOffset = 0;\n      const leading = this.dom.leading;\n      this.each(function (i) {\n        if (isDescriptive(this.node)) return;\n        const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n        const dy = leading * new SVGNumber(fontSize);\n        if (this.dom.newLined) {\n          this.attr('x', self.attr('x'));\n          if (this.text() === '\\n') {\n            blankLineOffset += dy;\n          } else {\n            this.attr('dy', i ? dy + blankLineOffset : 0);\n            blankLineOffset = 0;\n          }\n        }\n      });\n      this.fire('rebuild');\n    }\n    return this;\n  }\n\n  // overwrite method from parent to set data properly\n  setData(o) {\n    this.dom = o;\n    this.dom.leading = new SVGNumber(o.leading || 1.3);\n    return this;\n  }\n  writeDataToDom() {\n    writeDataToDom(this, this.dom, {\n      leading: 1.3\n    });\n    return this;\n  }\n\n  // Set the text content\n  text(text) {\n    // act as getter\n    if (text === undefined) {\n      const children = this.node.childNodes;\n      let firstLine = 0;\n      text = '';\n      for (let i = 0, len = children.length; i < len; ++i) {\n        // skip textPaths - they are no lines\n        if (children[i].nodeName === 'textPath' || isDescriptive(children[i])) {\n          if (i === 0) firstLine = i + 1;\n          continue;\n        }\n\n        // add newline if its not the first child and newLined is set to true\n        if (i !== firstLine && children[i].nodeType !== 3 && adopt(children[i]).dom.newLined === true) {\n          text += '\\n';\n        }\n\n        // add content of this node\n        text += children[i].textContent;\n      }\n      return text;\n    }\n\n    // remove existing content\n    this.clear().build(true);\n    if (typeof text === 'function') {\n      // call block\n      text.call(this, this);\n    } else {\n      // store text and make sure text is not blank\n      text = (text + '').split('\\n');\n\n      // build new lines\n      for (let j = 0, jl = text.length; j < jl; j++) {\n        this.newLine(text[j]);\n      }\n    }\n\n    // disable build mode and rebuild lines\n    return this.build(false).rebuild();\n  }\n}\nextend(Text, textable);\nregisterMethods({\n  Container: {\n    // Create text element\n    text: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).text(text);\n    }),\n    // Create plain text element\n    plain: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).plain(text);\n    })\n  }\n});\nregister(Text, 'Text');\n\nclass Tspan extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('tspan', node), attrs);\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Shortcut dx\n  dx(dx) {\n    return this.attr('dx', dx);\n  }\n\n  // Shortcut dy\n  dy(dy) {\n    return this.attr('dy', dy);\n  }\n\n  // Create new line\n  newLine() {\n    // mark new line\n    this.dom.newLined = true;\n\n    // fetch parent\n    const text = this.parent();\n\n    // early return in case we are not in a text element\n    if (!(text instanceof Text)) {\n      return this;\n    }\n    const i = text.index(this);\n    const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n    const dy = text.dom.leading * new SVGNumber(fontSize);\n\n    // apply new position\n    return this.dy(i ? dy : 0).attr('x', text.x());\n  }\n\n  // Set text content\n  text(text) {\n    if (text == null) return this.node.textContent + (this.dom.newLined ? '\\n' : '');\n    if (typeof text === 'function') {\n      this.clear().build(true);\n      text.call(this, this);\n      this.build(false);\n    } else {\n      this.plain(text);\n    }\n    return this;\n  }\n}\nextend(Tspan, textable);\nregisterMethods({\n  Tspan: {\n    tspan: wrapWithAttrCheck(function (text = '') {\n      const tspan = new Tspan();\n\n      // clear if build mode is disabled\n      if (!this._build) {\n        this.clear();\n      }\n\n      // add new tspan\n      return this.put(tspan).text(text);\n    })\n  },\n  Text: {\n    newLine: function (text = '') {\n      return this.tspan(text).newLine();\n    }\n  }\n});\nregister(Tspan, 'Tspan');\n\nclass Circle extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('circle', node), attrs);\n  }\n  radius(r) {\n    return this.attr('r', r);\n  }\n\n  // Radius x value\n  rx(rx) {\n    return this.attr('r', rx);\n  }\n\n  // Alias radius x value\n  ry(ry) {\n    return this.rx(ry);\n  }\n  size(size) {\n    return this.radius(new SVGNumber(size).divide(2));\n  }\n}\nextend(Circle, {\n  x: x$3,\n  y: y$3,\n  cx: cx$1,\n  cy: cy$1,\n  width: width$2,\n  height: height$2\n});\nregisterMethods({\n  Container: {\n    // Create circle element\n    circle: wrapWithAttrCheck(function (size = 0) {\n      return this.put(new Circle()).size(size).move(0, 0);\n    })\n  }\n});\nregister(Circle, 'Circle');\n\nclass ClipPath extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('clipPath', node), attrs);\n  }\n\n  // Unclip all clipped elements and remove itself\n  remove() {\n    // unclip all targets\n    this.targets().forEach(function (el) {\n      el.unclip();\n    });\n\n    // remove clipPath from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [clip-path*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    // Create clipping element\n    clip: wrapWithAttrCheck(function () {\n      return this.defs().put(new ClipPath());\n    })\n  },\n  Element: {\n    // Distribute clipPath to svg element\n    clipper() {\n      return this.reference('clip-path');\n    },\n    clipWith(element) {\n      // use given clip or create a new one\n      const clipper = element instanceof ClipPath ? element : this.parent().clip().add(element);\n\n      // apply mask\n      return this.attr('clip-path', 'url(#' + clipper.id() + ')');\n    },\n    // Unclip element\n    unclip() {\n      return this.attr('clip-path', null);\n    }\n  }\n});\nregister(ClipPath, 'ClipPath');\n\nclass ForeignObject extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('foreignObject', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    foreignObject: wrapWithAttrCheck(function (width, height) {\n      return this.put(new ForeignObject()).size(width, height);\n    })\n  }\n});\nregister(ForeignObject, 'ForeignObject');\n\nfunction dmove(dx, dy) {\n  this.children().forEach(child => {\n    let bbox;\n\n    // We have to wrap this for elements that dont have a bbox\n    // e.g. title and other descriptive elements\n    try {\n      // Get the childs bbox\n      // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1905039\n      // Because bbox for nested svgs returns the contents bbox in the coordinate space of the svg itself (weird!), we cant use bbox for svgs\n      // Therefore we have to use getBoundingClientRect. But THAT is broken (as explained in the bug).\n      // Funnily enough the broken behavior would work for us but that breaks it in chrome\n      // So we have to replicate the broken behavior of FF by just reading the attributes of the svg itself\n      bbox = child.node instanceof getWindow().SVGSVGElement ? new Box(child.attr(['x', 'y', 'width', 'height'])) : child.bbox();\n    } catch (e) {\n      return;\n    }\n\n    // Get childs matrix\n    const m = new Matrix(child);\n    // Translate childs matrix by amount and\n    // transform it back into parents space\n    const matrix = m.translate(dx, dy).transform(m.inverse());\n    // Calculate new x and y from old box\n    const p = new Point(bbox.x, bbox.y).transform(matrix);\n    // Move element\n    child.move(p.x, p.y);\n  });\n  return this;\n}\nfunction dx(dx) {\n  return this.dmove(dx, 0);\n}\nfunction dy(dy) {\n  return this.dmove(0, dy);\n}\nfunction height(height, box = this.bbox()) {\n  if (height == null) return box.height;\n  return this.size(box.width, height, box);\n}\nfunction move(x = 0, y = 0, box = this.bbox()) {\n  const dx = x - box.x;\n  const dy = y - box.y;\n  return this.dmove(dx, dy);\n}\nfunction size(width, height, box = this.bbox()) {\n  const p = proportionalSize(this, width, height, box);\n  const scaleX = p.width / box.width;\n  const scaleY = p.height / box.height;\n  this.children().forEach(child => {\n    const o = new Point(box).transform(new Matrix(child).inverse());\n    child.scale(scaleX, scaleY, o.x, o.y);\n  });\n  return this;\n}\nfunction width(width, box = this.bbox()) {\n  if (width == null) return box.width;\n  return this.size(width, box.height, box);\n}\nfunction x(x, box = this.bbox()) {\n  if (x == null) return box.x;\n  return this.move(x, box.y, box);\n}\nfunction y(y, box = this.bbox()) {\n  if (y == null) return box.y;\n  return this.move(box.x, y, box);\n}\n\nvar containerGeometry = {\n  __proto__: null,\n  dmove: dmove,\n  dx: dx,\n  dy: dy,\n  height: height,\n  move: move,\n  size: size,\n  width: width,\n  x: x,\n  y: y\n};\n\nclass G extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('g', node), attrs);\n  }\n}\nextend(G, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a group element\n    group: wrapWithAttrCheck(function () {\n      return this.put(new G());\n    })\n  }\n});\nregister(G, 'G');\n\nclass A extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('a', node), attrs);\n  }\n\n  // Link target attribute\n  target(target) {\n    return this.attr('target', target);\n  }\n\n  // Link url\n  to(url) {\n    return this.attr('href', url, xlink);\n  }\n}\nextend(A, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a hyperlink element\n    link: wrapWithAttrCheck(function (url) {\n      return this.put(new A()).to(url);\n    })\n  },\n  Element: {\n    unlink() {\n      const link = this.linker();\n      if (!link) return this;\n      const parent = link.parent();\n      if (!parent) {\n        return this.remove();\n      }\n      const index = parent.index(link);\n      parent.add(this, index);\n      link.remove();\n      return this;\n    },\n    linkTo(url) {\n      // reuse old link if possible\n      let link = this.linker();\n      if (!link) {\n        link = new A();\n        this.wrap(link);\n      }\n      if (typeof url === 'function') {\n        url.call(link, link);\n      } else {\n        link.to(url);\n      }\n      return this;\n    },\n    linker() {\n      const link = this.parent();\n      if (link && link.node.nodeName.toLowerCase() === 'a') {\n        return link;\n      }\n      return null;\n    }\n  }\n});\nregister(A, 'A');\n\nclass Mask extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('mask', node), attrs);\n  }\n\n  // Unmask all masked elements and remove itself\n  remove() {\n    // unmask all targets\n    this.targets().forEach(function (el) {\n      el.unmask();\n    });\n\n    // remove mask from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [mask*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    mask: wrapWithAttrCheck(function () {\n      return this.defs().put(new Mask());\n    })\n  },\n  Element: {\n    // Distribute mask to svg element\n    masker() {\n      return this.reference('mask');\n    },\n    maskWith(element) {\n      // use given mask or create a new one\n      const masker = element instanceof Mask ? element : this.parent().mask().add(element);\n\n      // apply mask\n      return this.attr('mask', 'url(#' + masker.id() + ')');\n    },\n    // Unmask element\n    unmask() {\n      return this.attr('mask', null);\n    }\n  }\n});\nregister(Mask, 'Mask');\n\nclass Stop extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('stop', node), attrs);\n  }\n\n  // add color stops\n  update(o) {\n    if (typeof o === 'number' || o instanceof SVGNumber) {\n      o = {\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      };\n    }\n\n    // set attributes\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', new SVGNumber(o.offset));\n    return this;\n  }\n}\nregisterMethods({\n  Gradient: {\n    // Add a color stop\n    stop: function (offset, color, opacity) {\n      return this.put(new Stop()).update(offset, color, opacity);\n    }\n  }\n});\nregister(Stop, 'Stop');\n\nfunction cssRule(selector, rule) {\n  if (!selector) return '';\n  if (!rule) return selector;\n  let ret = selector + '{';\n  for (const i in rule) {\n    ret += unCamelCase(i) + ':' + rule[i] + ';';\n  }\n  ret += '}';\n  return ret;\n}\nclass Style extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('style', node), attrs);\n  }\n  addText(w = '') {\n    this.node.textContent += w;\n    return this;\n  }\n  font(name, src, params = {}) {\n    return this.rule('@font-face', {\n      fontFamily: name,\n      src: src,\n      ...params\n    });\n  }\n  rule(selector, obj) {\n    return this.addText(cssRule(selector, obj));\n  }\n}\nregisterMethods('Dom', {\n  style(selector, obj) {\n    return this.put(new Style()).rule(selector, obj);\n  },\n  fontface(name, src, params) {\n    return this.put(new Style()).font(name, src, params);\n  }\n});\nregister(Style, 'Style');\n\nclass TextPath extends Text {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('textPath', node), attrs);\n  }\n\n  // return the array of the path track element\n  array() {\n    const track = this.track();\n    return track ? track.array() : null;\n  }\n\n  // Plot path if any\n  plot(d) {\n    const track = this.track();\n    let pathArray = null;\n    if (track) {\n      pathArray = track.plot(d);\n    }\n    return d == null ? pathArray : this;\n  }\n\n  // Get the path element\n  track() {\n    return this.reference('href');\n  }\n}\nregisterMethods({\n  Container: {\n    textPath: wrapWithAttrCheck(function (text, path) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = this.text(text);\n      }\n      return text.path(path);\n    })\n  },\n  Text: {\n    // Create path for text to run on\n    path: wrapWithAttrCheck(function (track, importNodes = true) {\n      const textPath = new TextPath();\n\n      // if track is a path, reuse it\n      if (!(track instanceof Path)) {\n        // create path element\n        track = this.defs().path(track);\n      }\n\n      // link textPath to path and add content\n      textPath.attr('href', '#' + track, xlink);\n\n      // Transplant all nodes from text to textPath\n      let node;\n      if (importNodes) {\n        while (node = this.node.firstChild) {\n          textPath.node.appendChild(node);\n        }\n      }\n\n      // add textPath element as child node and return textPath\n      return this.put(textPath);\n    }),\n    // Get the textPath children\n    textPath() {\n      return this.findOne('textPath');\n    }\n  },\n  Path: {\n    // creates a textPath from this path\n    text: wrapWithAttrCheck(function (text) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = new Text().addTo(this.parent()).text(text);\n      }\n\n      // Create textPath from text and path and return\n      return text.path(this);\n    }),\n    targets() {\n      return baseFind('svg textPath').filter(node => {\n        return (node.attr('href') || '').includes(this.id());\n      });\n\n      // Does not work in IE11. Use when IE support is dropped\n      // return baseFind('svg textPath[*|href*=' + this.id() + ']')\n    }\n  }\n});\nTextPath.prototype.MorphArray = PathArray;\nregister(TextPath, 'TextPath');\n\nclass Use extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('use', node), attrs);\n  }\n\n  // Use element as a reference\n  use(element, file) {\n    // Set lined element\n    return this.attr('href', (file || '') + '#' + element, xlink);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a use element\n    use: wrapWithAttrCheck(function (element, file) {\n      return this.put(new Use()).use(element, file);\n    })\n  }\n});\nregister(Use, 'Use');\n\n/* Optional Modules */\nconst SVG = makeInstance;\nextend([Svg, Symbol, Image, Pattern, Marker], getMethodsFor('viewbox'));\nextend([Line, Polyline, Polygon, Path], getMethodsFor('marker'));\nextend(Text, getMethodsFor('Text'));\nextend(Path, getMethodsFor('Path'));\nextend(Defs, getMethodsFor('Defs'));\nextend([Text, Tspan], getMethodsFor('Tspan'));\nextend([Rect, Ellipse, Gradient, Runner], getMethodsFor('radius'));\nextend(EventTarget, getMethodsFor('EventTarget'));\nextend(Dom, getMethodsFor('Dom'));\nextend(Element, getMethodsFor('Element'));\nextend(Shape, getMethodsFor('Shape'));\nextend([Container, Fragment], getMethodsFor('Container'));\nextend(Gradient, getMethodsFor('Gradient'));\nextend(Runner, getMethodsFor('Runner'));\nList.extend(getMethodNames());\nregisterMorphableType([SVGNumber, Color, Box, Matrix, SVGArray, PointArray, PathArray, Point]);\nmakeMorphable();\n\nexports.A = A;\nexports.Animator = Animator;\nexports.Array = SVGArray;\nexports.Box = Box;\nexports.Circle = Circle;\nexports.ClipPath = ClipPath;\nexports.Color = Color;\nexports.Container = Container;\nexports.Controller = Controller;\nexports.Defs = Defs;\nexports.Dom = Dom;\nexports.Ease = Ease;\nexports.Element = Element;\nexports.Ellipse = Ellipse;\nexports.EventTarget = EventTarget;\nexports.ForeignObject = ForeignObject;\nexports.Fragment = Fragment;\nexports.G = G;\nexports.Gradient = Gradient;\nexports.Image = Image;\nexports.Line = Line;\nexports.List = List;\nexports.Marker = Marker;\nexports.Mask = Mask;\nexports.Matrix = Matrix;\nexports.Morphable = Morphable;\nexports.NonMorphable = NonMorphable;\nexports.Number = SVGNumber;\nexports.ObjectBag = ObjectBag;\nexports.PID = PID;\nexports.Path = Path;\nexports.PathArray = PathArray;\nexports.Pattern = Pattern;\nexports.Point = Point;\nexports.PointArray = PointArray;\nexports.Polygon = Polygon;\nexports.Polyline = Polyline;\nexports.Queue = Queue;\nexports.Rect = Rect;\nexports.Runner = Runner;\nexports.SVG = SVG;\nexports.Shape = Shape;\nexports.Spring = Spring;\nexports.Stop = Stop;\nexports.Style = Style;\nexports.Svg = Svg;\nexports.Symbol = Symbol;\nexports.Text = Text;\nexports.TextPath = TextPath;\nexports.Timeline = Timeline;\nexports.TransformBag = TransformBag;\nexports.Tspan = Tspan;\nexports.Use = Use;\nexports.adopt = adopt;\nexports.assignNewId = assignNewId;\nexports.clearEvents = clearEvents;\nexports.create = create;\nexports.defaults = defaults;\nexports.dispatch = dispatch;\nexports.easing = easing;\nexports.eid = eid;\nexports.extend = extend;\nexports.find = baseFind;\nexports.getClass = getClass;\nexports.getEventTarget = getEventTarget;\nexports.getEvents = getEvents;\nexports.getWindow = getWindow;\nexports.makeInstance = makeInstance;\nexports.makeMorphable = makeMorphable;\nexports.mockAdopt = mockAdopt;\nexports.namespaces = namespaces;\nexports.nodeOrNew = nodeOrNew;\nexports.off = off;\nexports.on = on;\nexports.parser = parser;\nexports.regex = regex;\nexports.register = register;\nexports.registerMorphableType = registerMorphableType;\nexports.registerWindow = registerWindow;\nexports.restoreWindow = restoreWindow;\nexports.root = root;\nexports.saveWindow = saveWindow;\nexports.utils = utils;\nexports.windowEvents = windowEvents;\nexports.withWindow = withWindow;\nexports.wrapWithAttrCheck = wrapWithAttrCheck;\n//# sourceMappingURL=svg.node.cjs.map\n","import './draggable';\r\nimport './input-box';\r\nimport './node-x-btn';\r\nimport './connector';\r\nimport './comment-drag-handle';\r\nimport './comment-input';\r\nimport './connection-line';","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(8156);\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","moduleId","cachedModule","__webpack_module_cache__","undefined","__webpack_modules__","call","obj","name","Object","prototype","hasOwnProperty","Constants","Renderer","Representer","RepresenterNode","UserState","state","callbacks","constructor","Set","Map","setState","has","add","triggerCallbacks","removeState","delete","hasState","onStateChange","cb","set","get","push","addedOrRemoved","cbs","userState","container","visible","toolbox","document","createElement","className","workspace","_wsTop","appendChild","body","fill","nodes","clear","forEach","node","headlessNode","type","nodeEl","createNodeElement","show","textContent","labelText","applyNodeStyles","colors","primary","addEventListener","e","onNodeMouseDown","el","bgColor","style","backgroundColor","parseColor","padding","cursor","renderer","constants","c","fontFamily","FONT_FAMILY","fontSize","FONT_SIZE","color","FONT_COLOR","ghostEl","createGhostNode","moveGhost","ev","left","clientX","top","clientY","releaseGhost","removeEventListener","dropNode","remove","preventDefault","position","pointerEvents","rect","svg","getBoundingClientRect","right","bottom","x","wsX","y","wsY","screenToWorkspace","nodews","spawnAt","argName","arguments","setFieldValue","drawNode","id","display","hide","innerHTML","RendererMap","atlas","NAME","apollo","isBrowser","FontManager","loadGoogleFont","register","cls","FieldMap","unregister","Kabel","env","UIX","events","windowListeners","addWindowListener","removeWindowListener","clearWindowListeners","Themes","Classic","Dark","ContextMenu","Utils","Path","waitFrames","SVG","UID","EventEmitter","hasProp","styler","Styler","escapeHTML","unescapeHTML","Widget","CategoryColors","Connection","Coordinates","Field","DummyField","NumberField","OptConnectField","TextField","inject","injectHeadless","createHeadlessNode","InjectMsg","clearMainWorkspace","getMainWorkspace","setMainWorkspace","NodeSvg","Nodes","Widgets","WorkspaceSvg","Workspace","WorkspaceController","WASDController","nodeRendering","rendererMap","RMap","Apollo","Atlas","RendererConstants","commentRendering","CommentModel","CommentRenderer","Dropdown","defineProperty","v","UIStyles","workspaceBGColor","toolboxCategoriesBG","width","height","background","overflowY","toolboxFlyoutBG","borderRadius","boxShadow","initCommentInput","element","rawArgs","getSelectionRange","start","Math","min","cursorPos","anchorPos","end","max","hasSelection","deleteSelection","buffer","slice","measureTextWidth","text","tempText","getSvg","font","size","family","bbox","measureTextBbox","updateText","hasSel","txt","tspan","replace","attr","Array","from","childNodes","child","nodeType","setAttribute","leading","parseFloat","textBeforeStart","textBeforeEnd","highlightX","highlightWidth","highlightY","highlightH","selectionRect","parent","parentNode","insertBefore","move","editing","caretXOffset","caretY","caretH","caretLine","rectW","ceil","PADDING_X","rectH","PADDING_Y","comment","_tempInputBBox","textX","textY","startEditing","getText","length","rectBox","zoom","getWs","getZoom","clickX","cumulativeWidth","i","charWidth","skipNextClick","onKeyDown","onClickOutside","stopEditing","commit","capture","setTextNoRedraw","getWorkspace","redraw","key","shiftKey","ctrlKey","metaKey","targ","target","args","onRectDown","onTextDown","on","off","registerEvent","randBytes","len","cryptoAPI","getRandomValues","buf","Uint8Array","floor","random","uuidv4","g","globalThis","crypto","randomUUID","b","hex","toString","padStart","ulid","date","Date","now","time48","t","BigInt","Number","out","acc","bits","CROCK32","rnd","nanoid","alphabet","DEFAULT_ALPHABET","Error","mask","log2","idx","shortId","ts","_ctr","map","join","strategy","opts","s","_text","_isWorkspaceComment","_parent","svgGroup","relativeCoords","svgLine","generateUID","value","setText","res","isHeadless","clearComments","drawComments","isNodeComment","isWorkspaceComment","toJson","coords","fromJson","data","COMMENT_G_TAG","COMMENT_LINE_TAG","COMMENT_TEXT_EL","COMMENT_DRAG_EL","RENDERER_TAG_EL","encodeForSvg","ensureTspansPreserve","textEl","drawComment","_removeExistingElements","group","addClass","JSON","stringify","isws","displayEncoded","_createTextElement","_createBackgroundRect","dragHandle","_createDragHandle","_addEventer","screenPos","_computeScreenPosition","transform","_drawLineToNode","refreshCommentTransforms","getComments","_nodeDB","values","n","getComment","filter","userSelect","webkitUserSelect","msUserSelect","MozUserSelect","handleRadius","stroke","radius","back","circle","addElement","tagElement","workspaceX","workspaceY","nodePos","workspaceToScreen","ws","nodeWSPos","nodeBBox","nodeTopCenter","parentWSPos","commentRelPos","commentAbsX","commentAbsY","commentBBox","commentTopCenter","line","dasharray","clearAllComments","find","destroyByTag","_","clearCommentLines","drawAllComments","_constants","_currentNode","_nodeGroup","_nodeDraw","_ws","_drawStates","_commentDrawer","representer","constantOverrides","NODE_G_TAG","ELEMENT_TAG","CONN_LINE_TAG","CONNECTOR_TAG","LINE_X_MARK_TAG","BACKGROUND_PATTERN","overrides","init","initCommentRenderer","initRepresenter","initConstants","setConnect","pendingConnections","setConstants","assign","secondary","tertiary","restColors","getNodeBaseMeasurements","NODE_BASE_WIDTH","NODE_BASE_HEIGHT","anchor","opacity","measureTextHeight","measureRawField","textW","FIELD_RAW_BASE_WIDTH","INPUT_BOX_PADDING","FIELD_RAW_BASE_HEIGHT","measureLabel","field","label","getLabel","measureRaw","hasRaw","raw","getValue","measureCustom","isCustomEditor","m","measureMyself","getFieldMeasurementPadding","FIELD_SPACEX","measureField","parts","w","h","measureNodeDimensions","base","measureBaseAndLabel","fieldResult","measureFields","TOPBAR_HEIGHT","FIELD_SPACEY","FOOTER_HEIGHT","fields","startY","startWidth","startHeight","totalWidth","totalHeight","allFields","FIELD_MARGIN_X","FIELD_MARGIN_Y","labelW","TOPBAR_LABEL_MARGIN_X","renderNode","nodeIdOrNode","startNode","build","storeState","getNode","drawState","nodeGroup","fieldPosY","drawFieldRaw","fieldGroup","startX","getDisplayValue","FIELD_RAW_COLOR","FIELD_RAW_OUTLINE_COLOR","FIELD_RAW_OUTLINE_STROKE","INPUT_BOX_TEXT_ANCHOR","FIELD_RAW_TEXT_COLOR","rawBox","box","offsetY","drawFieldLabel","LABEL_SPACING","drawNodeXButton","measurements","btnSize","xGroup","class","weight","translateX","translateY","xButton","drawConnector","nodeBg","side","CONNECTOR_TRIANGLE","triSize","CONNECTOR_TRI_SIZE","path","roundedTri","rotatePath","tri","offsetX","CONNECTOR_RADIUS","circlePath","circ","drawNodeLabel","TOPBAR_LABEL_BOLDED","TOPBAR_LABEL_MARGIN_Y","createNodeGroup","drawNodeBase","drawNodeTopbar","getNodeColors","makeNodeDraggable","topbar","createFieldGroup","drawAllFieldsForNode","drawPreviousNextConnections","CORNER_RADIUS","bg","roundedRect","NODE_BG_COLOR","NODE_OUTLINE_COLOR","shadow","dragel","fieldsGroup","fieldCol","drawFieldForNode","fm","alignX","xUsed","drawMyself","measuredWidth","measuredHeight","rawData","cBubbleData","hasConnectable","connection","halfHeight","absY","c3","FIELD_CONN_COLOR","to","getTo","previousConnection","fromCircle","originCircle","originConn","connector","connState","onDraw","nodeMeasurements","cY","c1","resolveConnectable","getFrom","_fillOtherNodeConnectorCircle","nextConnection","c2","refreshComments","applyZoomToNode","nodeG","refreshNodeTransforms","nodeGroups","refreshConnectionLines","clearLines","drawLinesForAllNodes","tertirary","category","fillAllNodeConnectorBubbles","connPair","match","flatMap","p","toCircle","connectable","fromConn","isPrevious","conn","wsSvg","drawnCircles","fromEl","toEl","fromBBox","getBBox","toBBox","fromCTM","getScreenCTM","toCTM","endX","endY","pathStr","a","d","f","strokeWidth","CONNECTOR_LINE_WIDTH","toConn","mark","clearScreen","children","isBackground","hasClass","isDefs","tagName","isBgRect","classes","includes","BACKGROUND_CLASS","undoPendingConnsFor","conn0","rerenderNode","findIndex","pendingConn","splice","getRaw","isSpace","ch","SPECIAL_SPACES","indexOf","isDigit","code","isDigitStart","State","index","result","param","err","segmentStart","skipSpaces","charCodeAt","scanFlag","scanParam","zeroFirst","hasCeiling","hasDecimal","hasDot","finalizeSegment","cmd","cmdLC","toLowerCase","params","concat","paramCounts","scanSegment","cmdCode","is_arc","comma_found","need_params","isCommand","l","r","q","z","svgPath","segments","options","static","WIDGET_GLOBAL_ID","border","zIndex","html","setCoords","setHTML","reanimate","_addWidgetToDB","destroy","_delWidgetFromDB","undoStack","redoStack","isRecording","emitChange","recordHistory","undo","current","pop","prev","redo","entry","canUndo","canRedo","message","Ellipse","rx","ry","ax","epsilon","torad","PI","cos","sin","ma","J","K","D","JK","sqrt","L","l1","l2","abs","atan","isDegenerate","WorkspaceCoords","super","theme","grid","_camera","_root","_backgroundRect","noRedraw","controller","_widgetDB","_ctxMenu","_commentDB","history","recordHistoryRecord","_didMove","moveListeners","dragState","wsTop","addTo","RClass","resolve","rendererOverrides","themeKey","Controller","controls","wasd","resolveController","initUndoRedo","_initBackground","setTheme","structuredClone","updateStyles","didMove","setDragState","currentX","currentY","isDragging","lastX","lastY","deltaX","deltaY","beginDrag","updateDrag","endDrag","fireMoveListeners","addMoveListener","listener","removeMoveListener","toggleHistory","untoggleHistory","console","error","_updateBackgroundTransform","updateTransform","cloneNode","nodeSvg","fromNode","wdgt","newWidget","getWidget","getContentSize","getSize","refresh","drawAllNodes","nodeId","workX","workY","screenX","screenY","addNode","warn","newNode","derefNode","disconnectTo","ConnectableField","disconnect","next","disconnectFrom","removeNodeById","removeNode","pan","dx","dy","addComment","model","redrawComments","removeComment","commentOrId","json","recordBigEvent","entries","circular","deserialize","topLevel","serialize","startsWith","split","parseInt","trim","isArray","halfW","points","step","sides","angle","cx","cy","rotate","Matrix","operations","matrix","scale","translate","skewX","skewY","CMD_SPLIT_RE","PARAMS_SPLIT_RE","transformString","item","moveSpeed","doAccelerate","accelSpeed","friction","velocity","zoomSpeed","minZoom","maxZoom","isFalloff","wasdSmooth","wasdAccelerate","wasdFriction","onWheel","bind","passive","canMove","update","inputX","inputY","keysDown","_throttledFireDidMove","refreshPos","newZoom","mouseX","mouseY","wsMouse","setZoom","weights","loadedFonts","linkId","getElementById","link","rel","weightsParam","href","head","fontPromises","fonts","load","promise","Promise","all","then","handleClick","xMark","pair","midX","midY","center","editable","connectionBubble","canEditConnector","setEditable","val","canEdit","setName","Boolean","getName","setLabel","fieldVisualInfo","setValue","deep","alreadyProcessed","_deserialize","setTo","String","fldType","setFieldType","fld_type","DropdownField","_selected","_isOpen","toggle","toggleDropdown","click","getOwner","closeDropdown","openDropdown","items","option","onSelect","original","hideIfOwner","getSelected","setOptions","RendererCls","optName","list","keys","input","pattern","spacing","dotSize","defs","findOne","patternUnits","resize","scaledSpacing","scaledDot","cam","patternTransform","updateOptions","newOpts","xBtnGroup","onClick","combine","m1","m2","queue","cache","tx","ty","sx","sy","rad","tan","toArray","calc","isRelative","mouseBtns","mousePos","lastMousePos","wheelDelta","movedListeners","_lastMoveFire","_moveThrottleMs","_queuedMove","_moveTimeout","_updateInt","_setupListeners","setInterval","fireDidMove","queueMicrotask","performance","wait","setTimeout","window","button","setCamera","pos","centerOn","wsSize","stop","clearInterval","log","ApolloRenderer","ElEMENT_TAG","dogear","SHAPES","Dogear","cutW","Width","Height","drawDogEar","pathDef","PathMain","dogEar","front","drawPrimaryConnector","CONNECTOR_COLOR","textBBox","paddedWidth","styles","appendStyles","css","styleEl","removeStyles","hasStyles","kabelStyles","querySelector","contains","msg","wrn","info","proto","isNode","process","versions","isWebWorker","self","importScripts","_fieldColumn","getCommentText","setCommentText","getFieldByName","fld","getField","getFieldValue","getFieldDisplayValue","emit","INITING","removed","REMOVING","hasCategoryStyle","getCategoryName","getStyle","_appendFieldItem","jsonInit","primaryColor","secondaryColor","tertiaryColor","applyJsonArguments","FieldConstructor","appendConnection","appendNumber","appendText","appendOptLink","setCategoryName","setStyle","setColor","setLabelText","setConnection","prevOrNext","stringed","cast","other","newField","FieldCls","_serializeConnection","returned","connected","fieldNode","serialized","flat","processNode","copy","prevNode","nextNode","allNodes","explicit","fldData","setFrom","refId","maybe","ContextOptsRegistry","registerOption","opt","onHoverStart","onHoverEnd","showFor","unregisterOption","confirm","widget","classList","fn","k","scroll","blur","focus","visibilitychange","pointerlockchange","beforeunload","event","handleEvent","listeners","handler","payload","once","wrapper","wsOptions","_flyout","_contents","_categories","getOptions","contents","initCategoryToolbox","initFlyoutToolbox","applyStyles","cData","mainws","draggableStore","onMouseDown","onMouseMove","onMouseUp","ondrag","movementX","movementY","mouseWS","newX","newY","onmove","enddrag","dragTarget","frames","callback","count","requestAnimationFrame","DropdownContainer","owner","rootEl","constraint","offset","currentRemoveListener","updatePosition","setContent","groupRect","scrollX","scrollY","onclick","isVisible","getCurrent","dropdownContainer","onPointerDown","pointerWS","startRelX","startRelY","onPointerMove","onPointerUp","Eventer","elements","eventRegistry","setupFn","tags","tagList","reg","tag","destroyed","destroyFn","types","typeList","setupElement","destroyElement","Function","eventer","unit_vector_angle","ux","uy","vx","vy","dot","acos","approximate_unit_arc","theta1","delta_theta","alpha","x1","y1","x2","y2","TAU","fa","fs","phi","sin_phi","cos_phi","x1p","y1p","lambda","cc","rx_sq","ry_sq","x1p_sq","y1p_sq","radicant","cxp","cyp","v1x","v1y","v2x","v2y","get_arc_center","curve","xp","yp","NodePrototypes","default","clone","distanceTo","toObject","PADDING_BIG","PADDING_MEDIUM","PADDING_SMALL","CONNECTION_STROKE_WIDTH","CONNECTION_STROKE_COLOR_CHOICE","CONNECTOR_LINE_CURVED","ZOOM_BASE","SvgPath","pstate","pathParse","__stack","transformParse","a2c","ellipse","src","sgm","__matrix","iterate","__evaluateStack","prevCmd","cmdSkipped","segment","degrees","round","contourStartDeltaX","contourStartDeltaY","toFixed","iterator","keepLazyStack","j","newSegments","replacements","needReplace","countourStartX","countourStartY","nameUC","toUpperCase","nameLC","unarc","new_segments","nextX","nextY","unshort","prevControlX","prevControlY","prevSegment","curControlX","curControlY","cState","one","two","isPrev","removeClass","connA","connB","_rowDiv","_toolbox","_makeDiv","btn","stopPropagation","setDisabled","disabled","toJSON","svgState","getConstant","moveTo","setScale","applyTransform","highlight","prevFrom","source","isolate","ApolloConstants","rectHeight","caretX","repNode","removeProperty","initListeners","renderOptions","HTMLElement","SVGSVGElement","elementFromPoint","hasAttribute","getAttribute","dta","parse","parentElement","outline","registerMethods","_name","addMethodNames","getOwnPropertyNames","methods$1","getMethodsFor","_names","names","array","block","il","radians","unCamelCase","capitalize","charAt","proportionalSize","getOrigin","o","origin","ox","originX","oy","originY","condX","condY","registerWindow","win","doc","globals","saveWindow","save","restoreWindow","getWindow","create","ns","createElementNS","makeInstance","isHTML","Base","adopter","firstChild","removeChild","nodeOrNew","Node","ownerDocument","defaultView","adopt","instance","nodeName","Fragment","asRoot","getClass","eid","did","assignNewId","extend","modules","methods","wrapWithAttrCheck","apply","componentHex","component","integer","is","object","space","hueToRgb","closeEnough","parser","cssText","documentElement","isNulledBox","getBox","getBBoxFn","retry","baseFind","query","List","querySelectorAll","getEvents","getEventHolder","windowEvents","getEventTarget","clearEvents","binding","bag","delimiter","_svgjsListenerId","listenerId","namespace","dispatch","Event","CustomEvent","detail","cancelable","dispatchEvent","noop","x$3","y$3","cx$1","cy$1","width$2","SVGNumber","divide","height$2","_element","fx","fy","makeSetterGetter","recalculate","duration","_duration","overshoot","_overshoot","pi","os","zeta","wn","segmentComplete","segmentParameters","startNewSegment","token","inNumber","finalizeNumber","pathLetter","isPathLetter","test","lastCommand","small","isSmall","inSegment","number","pointSeen","hasExponent","absolute","command","pathHandlers","p0","makeAbsolut","isArcFlag","isArc","isExponential","lastToken","registerMorphableType","morphableTypes","makeMorphable","Morphable","fromArray","arr","toConsumable","morph","stepper","context","mergeTransforms","netTransform","_transformationRunners","runners","getRunnerTransform","reduce","lmultiply","merge","_frameId","descriptiveElements","isDescriptive","writeDataToDom","defaults","cloned","valueOf","removeAttribute","utils","__proto__","xmlns","xlink","namespaces","siblings","forward","backward","before","after","insertAfter","numberAndUnit","rgb","reference","transforms","whitespace","isHex","isRgb","isBlank","isNumber","isImage","regex","toggleClass","ret","cased","getPropertyValue","setProperty","attributes","remember","memory","forget","_memory","Color","inputs","isColor","mode","grey","cmyk","_a","_b","_c","hsl","isGrey","delta","_d","getParameters","noWhitespace","exec","hexParse","substring","sixDigitHex","components","lab","xyz","lch","atan2","dToR","yL","xL","zL","ct","mx","nm","rU","gU","bU","pow","bd","toHex","_clamped","toRgb","rV","gV","bV","r255","g255","b255","rL","gL","bL","xU","yU","zU","Point","transformO","isMatrixLike","formatTransforms","flipBoth","flip","flipX","flipY","skew","isFinite","scaleX","scaleY","shear","theta","around","px","positionX","NaN","py","positionY","relative","relativeX","relativeY","matrixMultiply","aroundO","translateO","lmultiplyO","decompose","determinant","ccw","thetaRad","st","lam","equals","comp","axis","flipO","scaleO","Element","matrixify","inverse","inverseO","det","na","nb","nc","nd","ne","nf","multiply","multiplyO","rotateO","shearO","lx","skewO","ly","transformer","Box","addOffset","pageXOffset","pageYOffset","isNulled","xMin","Infinity","xMax","yMin","yMax","viewbox","level","point","clientWidth","clientHeight","zoomX","zoomY","zoomAmount","MAX_SAFE_INTEGER","each","fnOrMethodName","reserved","attrs","EventTarget","defaultPrevented","fire","timeline","ease","delay","SVGArray","toSet","convert","unit","isNaN","minus","plus","times","colorAttributes","hooks","Dom","removeNamespace","SVGElement","put","hasChildNodes","lastChild","assignNewIds","nodeClone","first","htmlOrFn","outerHTML","xml","last","matches","selector","matcher","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","putIn","removeElement","replaceChild","precision","factor","svgOrFn","outerSVG","words","wrap","xmlOrFn","outerXML","_this","well","fragment","createDocumentFragment","firstElementChild","nodeValue","curr","_val","hook","setAttributeNS","rebuild","dom","setData","dmove","parents","until","isSelector","rbox","screenCTM","inside","ctm","getCTM","isRoot","sugar","prefix","extension","mat","direction","getTotalLength","pointAt","getPointAtLength","untransform","str","kv","reverse","toParent","pCtm","toRoot","decomposed","Container","flatten","ungroup","Defs","Shape","circled","gradiented","Gradient","targets","url","gradient","Pattern","Image","img","image","PointArray","maxX","maxY","minX","minY","toLine","pointed","MorphArray","Line","plot","Marker","orient","ref","marker","easing","bezier","steps","stepPosition","jumps","beforeFlag","jumping","Stepper","done","Ease","dt","Spring","acceleration","newPosition","PID","windup","integral","_windup","P","I","M","H","V","C","S","Q","T","A","Z","mlhvqtcsaz","jl","pathDelimiters","PathArray","toAbsolute","pathParser","arrayToString","getClassForType","NonMorphable","ObjectBag","_stepper","_from","_to","_type","_context","_morphObj","at","_set","align","TransformBag","sortByKey","defaultObject","toDelete","objOrArr","Type","sort","shift","num","_array","poly","Polygon","polygon","Polyline","polyline","Rect","Queue","_first","_last","Animator","nextDraw","timeouts","immediates","timer","frame","run","_draw","timeout","time","immediate","cancelFrame","clearTimeout","cancelImmediate","nextTimeout","lastTimeout","nextFrame","lastFrame","nextImmediate","makeSchedule","runnerInfo","runner","defaultSource","Timeline","timeSource","_timeSource","terminate","active","_nextFrame","finish","getEndTimeOfTimeline","pause","getEndTime","lastRunnerInfo","getLastRunnerInfo","lastDuration","_time","endTimes","_runners","getRunnerInfoById","_lastRunnerId","_runnerIds","_paused","_continue","persist","dtOrForever","_persist","play","updateTime","yes","currentSpeed","speed","positive","schedule","when","absoluteStartTime","endTime","unschedule","seek","_speed","_lastSourceTime","immediateStep","_stepImmediate","_step","_stepFn","dtSource","dtTime","_lastStepTime","reset","runnersLeft","dtToStart","_startTime","_timeline","Runner","_queue","_isDeclarative","_history","enabled","_lastTime","_reseted","transformId","_haveReversed","_reverse","_loopsDone","_swing","_wait","_times","sanitise","swing","addTransform","animate","loop","clearTransform","clearTransformsFromQueue","isTransform","during","_prepareRunner","loops","loopDuration","loopsDone","partial","swinging","backwards","uncliped","swingForward","progress","initFn","runFn","retargetFn","initialiser","retarget","initialised","finished","running","_lastPosition","justStarted","justFinished","declarative","converged","_initialise","_run","needsIt","_rememberMorpher","method","morpher","caller","positionOrDt","allfinished","_tryRetarget","extra","FakeRunner","mergeWith","RunnerArray","ids","clearBefore","deleteCnt","edit","newRunner","getByID","lastRunner","by","_clearTransformRunnersBefore","currentRunner","_currentTransform","_addRunner","styleAttr","nameOrAttrs","newToAttrs","newKeys","differences","addedFromAttrs","oldFromAttrs","oldToAttrs","newLevel","newPoint","affine","isMatrix","currentAngle","startTransform","rTarget","rCurrent","possibilities","distances","shortest","affineParameters","newTransforms","_queueNumber","ay","_queueNumberDelta","newTo","_queueObject","amove","Svg","version","nested","Symbol","symbol","textable","_build","getComputedTextLength","plain","createTextNode","Text","_rebuild","blankLineOffset","getComputedStyle","newLined","firstLine","newLine","Tspan","Circle","ClipPath","unclip","clip","clipper","clipWith","ForeignObject","foreignObject","containerGeometry","G","unlink","linker","linkTo","Mask","unmask","masker","maskWith","Stop","Style","addText","rule","cssRule","fontface","TextPath","track","pathArray","textPath","importNodes","Use","use","file","mockAdopt","mock","withWindow","definition","enumerable","prop","toStringTag"],"sourceRoot":""}