{"version":3,"file":"kabel.js","mappings":"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","sources":["webpack://Kabel/webpack/universalModuleDefinition","webpack://Kabel/webpack/bootstrap","webpack://Kabel/./util/has-prop.ts","webpack://Kabel/./util/user-state.ts","webpack://Kabel/./src/flyout.ts","webpack://Kabel/./src/core.ts","webpack://Kabel/./events/comment-input.ts","webpack://Kabel/./util/uid.ts","webpack://Kabel/./util/escape-html.ts","webpack://Kabel/./src/comment.ts","webpack://Kabel/./comment-renderer/renderer.ts","webpack://Kabel/./renderers/renderer.ts","webpack://Kabel/./node_modules/svgpath/lib/path_parse.js","webpack://Kabel/./util/unescape-html.ts","webpack://Kabel/./src/widget.ts","webpack://Kabel/./node_modules/svgpath/lib/ellipse.js","webpack://Kabel/./src/workspace-coords.ts","webpack://Kabel/./src/workspace-svg.ts","webpack://Kabel/./util/parse-color.ts","webpack://Kabel/./util/path.ts","webpack://Kabel/./node_modules/svgpath/lib/transform_parse.js","webpack://Kabel/./controllers/wasd.ts","webpack://Kabel/./events/connection-line.ts","webpack://Kabel/./src/field.ts","webpack://Kabel/./src/renderer-map.ts","webpack://Kabel/./events/node-x-btn.ts","webpack://Kabel/./src/colors.ts","webpack://Kabel/./node_modules/svgpath/lib/matrix.js","webpack://Kabel/./controllers/base.ts","webpack://Kabel/./util/styler.ts","webpack://Kabel/./src/inject.ts","webpack://Kabel/./src/headless-node.ts","webpack://Kabel/./src/nodesvg.ts","webpack://Kabel/./src/ctx-menu-registry.ts","webpack://Kabel/./util/emitter.ts","webpack://Kabel/./src/toolbox.ts","webpack://Kabel/./src/main-workspace.ts","webpack://Kabel/./events/draggable.ts","webpack://Kabel/./util/wait-anim-frames.ts","webpack://Kabel/./src/prototypes.ts","webpack://Kabel/./src/dropdown-menu.ts","webpack://Kabel/./src/widget-prototypes.ts","webpack://Kabel/./events/comment-drag-handle.ts","webpack://Kabel/./util/eventer.ts","webpack://Kabel/./node_modules/svgpath/lib/a2c.js","webpack://Kabel/./node_modules/svgpath/index.js","webpack://Kabel/./src/index.ts","webpack://Kabel/./src/coordinates.ts","webpack://Kabel/./renderers/constants.ts","webpack://Kabel/./node_modules/svgpath/lib/svgpath.js","webpack://Kabel/./src/styles.css","webpack://Kabel/./events/connector.ts","webpack://Kabel/./src/category.ts","webpack://Kabel/./renderers/representer-node.ts","webpack://Kabel/./src/connection.ts","webpack://Kabel/./events/input-box.ts","webpack://Kabel/./renderers/representer.ts","webpack://Kabel/./src/context-menu.ts","webpack://Kabel/./node_modules/@svgdotjs/svg.js/dist/svg.node.cjs","webpack://Kabel/./events/events.ts","webpack://Kabel/webpack/runtime/define property getters","webpack://Kabel/webpack/runtime/hasOwnProperty shorthand","webpack://Kabel/webpack/runtime/make namespace object","webpack://Kabel/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Kabel\"] = factory();\n\telse\n\t\troot[\"Kabel\"] = factory();\n})(this, () => {\nreturn ","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\r\nexport default function hasProp(obj: object, name: string) {\r\n    return Object.prototype.hasOwnProperty.call(obj, name)\r\n}","type StateChangeCallback = (addedOrRemoved: 0 | 1) => void;\r\n\r\nclass UserState {\r\n    private state: Set<string>;\r\n    private callbacks: Map<string, StateChangeCallback[]>;\r\n    /**\r\n     * Stores the user's current UIX state\r\n     * Ex: 'typing'\r\n     */\r\n    constructor() {\r\n        this.state = new Set();\r\n        this.callbacks = new Map();\r\n    }\r\n\r\n    /** \r\n     * Adds a state\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    setState(name: string) {\r\n        const wasPresent = this.state.has(name);\r\n        if (!wasPresent) {\r\n            this.state.add(name);\r\n            this.triggerCallbacks(name, 1);\r\n        }\r\n    }\r\n\r\n    /** \r\n     * Removes a state\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    removeState(name: string) {\r\n        const wasPresent = this.state.has(name);\r\n        if (wasPresent) {\r\n            this.state.delete(name);\r\n            this.triggerCallbacks(name, 0);\r\n        }\r\n    }\r\n\r\n    /** \r\n     * Checks if a state is active\r\n     * @param name - The name of the state (ex: 'typing')\r\n     */\r\n    hasState(name: string) {\r\n        return this.state.has(name);\r\n    }\r\n\r\n    /** \r\n     * Registers a callback for state changes \r\n     * @param name - Name of the state to check changes for.\r\n     * @param cb - Callback to call on state change.\r\n     */\r\n    onStateChange(name: string, cb: StateChangeCallback) {\r\n        if (!this.callbacks.has(name)) this.callbacks.set(name, []);\r\n        this.callbacks.get(name)!.push(cb);\r\n    }\r\n\r\n    /** Internal: triggers callbacks for a state */\r\n    private triggerCallbacks(name: string, addedOrRemoved: 0 | 1) {\r\n        const cbs = this.callbacks.get(name);\r\n        if (!cbs) return;\r\n        for (const cb of cbs) cb(addedOrRemoved);\r\n    }\r\n}\r\nconst userState = new UserState();\r\nexport default userState;\r\nexport {\r\n    UserState\r\n};","import newHeadlessNode from \"./headless-node\";\r\nimport { TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { parseColor } from \"../util/parse-color\";\r\n\r\n/**\r\n * Represents a flyout menu for a toolbox in Kabel.\r\n * Displays a list of nodes that can be dragged into a workspace.\r\n */\r\nclass Flyout {\r\n    /** HTML container element for the flyout */\r\n    container: HTMLDivElement;\r\n    /** Visibility state of the flyout */\r\n    visible: boolean;\r\n    /** Optional reference to the parent Toolbox */\r\n    toolbox?: Toolbox;\r\n\r\n    /**\r\n     * Creates a Flyout.\r\n     * @param toolbox - Optional parent toolbox to attach this flyout to.\r\n     */\r\n    constructor(toolbox?: Toolbox) {\r\n        this.toolbox = toolbox as Toolbox;\r\n\r\n        this.container = document.createElement('div');\r\n        this.container.className = 'KabelFlyout';\r\n\r\n        this.visible = false;\r\n\r\n        if (toolbox) {\r\n            toolbox.workspace._wsTop.appendChild(this.container);\r\n        } else {\r\n            document.body.appendChild(this.container);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Populates the flyout with a list of nodes.\r\n     * Each node becomes draggable into the workspace.\r\n     * @param nodes - Array of node structures to display in the flyout.\r\n     */\r\n    fill(nodes: TblxNodeStruct[]) {\r\n        this.container.innerHTML = '';\r\n        nodes.forEach(node => {\r\n            const _headlessNode = newHeadlessNode(node.type as string);\r\n            if (!_headlessNode) return;\r\n\r\n            const nodeEl = document.createElement('div');\r\n            nodeEl.className = 'KabelFlyoutNode';\r\n            nodeEl.textContent = _headlessNode.labelText;\r\n            nodeEl.style.backgroundColor = parseColor(_headlessNode.colors.primary);\r\n            nodeEl.style.padding = '4px 8px';\r\n            nodeEl.style.cursor = 'pointer';\r\n            nodeEl.style.fontFamily = this.toolbox!.workspace!.renderer!.constants.FONT_FAMILY;\r\n            nodeEl.style.fontSize = `${this.toolbox!.workspace!.renderer!.constants.FONT_SIZE}px`;\r\n            nodeEl.style.color = parseColor(this.toolbox!.workspace!.renderer!.constants!.FONT_COLOR);\r\n\r\n            /**\r\n             * Handles mousedown to start dragging a node from the flyout\r\n             */\r\n            nodeEl.addEventListener('mousedown', (e) => {\r\n                if (!this.toolbox) return;\r\n\r\n                // Create ghost element to follow mouse\r\n                const ghostEl = document.createElement('div');\r\n                ghostEl.className = 'KabelGhostNode';\r\n                ghostEl.textContent = _headlessNode.labelText;\r\n                ghostEl.style.position = 'absolute';\r\n                ghostEl.style.pointerEvents = 'none';\r\n                ghostEl.style.backgroundColor = parseColor(_headlessNode.colors.primary);\r\n                ghostEl.style.padding = '4px 8px';\r\n                ghostEl.style.fontFamily = this.toolbox!.workspace!.renderer!.constants.FONT_FAMILY;\r\n                ghostEl.style.fontSize = `${this.toolbox!.workspace!.renderer!.constants.FONT_SIZE}px`;\r\n                ghostEl.style.color = parseColor(this.toolbox!.workspace!.renderer!.constants!.FONT_COLOR);\r\n\r\n                document.body.appendChild(ghostEl);\r\n\r\n                const moveGhost = (ev: MouseEvent) => {\r\n                    ghostEl.style.left = ev.clientX + 4 + 'px';\r\n                    ghostEl.style.top = ev.clientY + 4 + 'px';\r\n                };\r\n\r\n                const releaseGhost = (ev: MouseEvent) => {\r\n                    document.removeEventListener('mousemove', moveGhost);\r\n                    document.removeEventListener('mouseup', releaseGhost);\r\n\r\n                    // Drop node into workspace if over workspace SVG\r\n                    const svg = this.toolbox!.workspace.svg.node as SVGSVGElement;\r\n                    const rect = svg.getBoundingClientRect();\r\n                    if (\r\n                        ev.clientX >= rect.left &&\r\n                        ev.clientX <= rect.right &&\r\n                        ev.clientY >= rect.top &&\r\n                        ev.clientY <= rect.bottom\r\n                    ) {\r\n                        const svgX = ev.clientX - rect.left;\r\n                        const svgY = ev.clientY - rect.top;\r\n\r\n                        const { x: wsX, y: wsY } = this.toolbox!.workspace.screenToWorkspace(svgX, svgY);\r\n\r\n                        this.toolbox!.workspace.spawnAt(node.type as string, wsX, wsY);\r\n                    }\r\n\r\n                    ghostEl.remove();\r\n                };\r\n\r\n                document.addEventListener('mousemove', moveGhost);\r\n                document.addEventListener('mouseup', releaseGhost);\r\n\r\n                e.preventDefault();\r\n            });\r\n\r\n            this.container.appendChild(nodeEl);\r\n        });\r\n\r\n        this.show();\r\n    }\r\n\r\n    /** Shows the flyout */\r\n    show() {\r\n        this.container.style.display = 'block';\r\n        this.visible = true;\r\n    }\r\n\r\n    /** Hides the flyout */\r\n    hide() {\r\n        this.container.style.display = 'none';\r\n        this.visible = false;\r\n    }\r\n\r\n    /** Clears all nodes from the flyout */\r\n    clear() {\r\n        this.container.innerHTML = '';\r\n    }\r\n}\r\n\r\nexport default Flyout;\r\n","import RendererConstants from '../renderers/constants'\r\nimport Renderer from '../renderers/renderer'\r\nimport CategoryColors from './colors'\r\nimport Connection, { Connectable } from './connection'\r\nimport Coordinates from './coordinates'\r\nimport Field, {\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField\r\n} from './field'\r\nimport inject, { InjectMsg, InjectOptions } from './inject'\r\nimport {\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace\r\n} from './main-workspace'\r\nimport NodeSvg, { NodeJson, NodeEvents, InputFieldJson } from './nodesvg'\r\nimport NodePrototypes from './prototypes'\r\nimport WorkspaceSvg from './workspace-svg'\r\nimport { NodePrototype } from './node-types'\r\nimport {\r\n    Color,\r\n    ColorStyle,\r\n    Hex,\r\n    RGBObject,\r\n    RGBString,\r\n    RGBTuple\r\n} from './visual-types'\r\nimport { parseColor } from '../util/parse-color'\r\nimport eventer, { Eventer } from '../util/eventer'\r\nimport * as Path from '../util/path'\r\nimport * as SVG from '@svgdotjs/svg.js'\r\nimport * as UID from '../util/uid'\r\nimport hasProp from '../util/has-prop'\r\nimport EventEmitter from '../util/emitter'\r\nimport userState from '../util/user-state'\r\nimport '../events/events'\r\nimport WorkspaceController from '../controllers/base'\r\nimport WASDController from '../controllers/wasd'\r\nimport { RMap } from './renderer-map'\r\nimport styler, { Styler } from '../util/styler'\r\nimport WidgetPrototypes from './widget-prototypes'\r\nimport Widget from './widget'\r\nimport ContextOptsRegistry, { ContextMenu } from './ctx-menu-registry'\r\nimport { Showable } from './context-menu'\r\nimport escapeAttr from '../util/escape-html'\r\nimport unescapeAttr from '../util/unescape-html'\r\nimport waitFrames from '../util/wait-anim-frames'\r\nimport CommentModel from './comment'\r\nimport CommentRenderer from '../comment-renderer/renderer'\r\nimport dropdownContainer from './dropdown-menu'\r\nimport Representer from '../renderers/representer'\r\nimport { RepresenterNode } from '../renderers/representer-node'\r\n\r\n/**\r\n * Utility method to register a field globally by name\r\n * @param name - Field identifier\r\n * @param cls - Class constructor for the field\r\n */\r\nField.register = function (name: string, cls: Function) {\r\n    FieldMap[name] = cls as AnyFieldCls\r\n}\r\n\r\n/**\r\n * Utility method to unregister a field globally by name\r\n * @param name - Field identifier\r\n */\r\nField.unregister = function (name: string) {\r\n    delete FieldMap[name]\r\n}\r\n\r\n/**\r\n * Central Kabel object exposing all main modules, utilities, and defaults\r\n */\r\nconst Kabel = {\r\n    UIX: {\r\n        events: eventer as Eventer,\r\n    /** * State Manager, Makes things possible: E.G (the 'typing' state when you type in a input box..) * Used in controllers so you dont move when typing characters like a w s or d etc. */ userState\r\n    },\r\n    ContextMenu,\r\n    Utils: {\r\n        Path,\r\n        waitFrames,\r\n        SVG,\r\n        parseColor,\r\n        UID,\r\n        EventEmitter,\r\n        hasProp,\r\n        styler,\r\n        Styler,\r\n        escapeHTML: escapeAttr,\r\n        unescapeHTML: unescapeAttr\r\n    },\r\n    Widget,\r\n    CategoryColors,\r\n    Connection,\r\n    Coordinates,\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n    inject,\r\n    InjectMsg,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    NodeSvg,\r\n    Nodes: NodePrototypes,\r\n    Widgets: WidgetPrototypes,\r\n    WorkspaceSvg,\r\n    WorkspaceController,\r\n    WASDController,\r\n    nodeRendering: {\r\n        rendererMap: RMap,\r\n        Renderer,\r\n        RendererConstants,\r\n        Representer,\r\n        RepresenterNode\r\n    },\r\n    commentRendering: { CommentModel, CommentRenderer },\r\n    Dropdown: dropdownContainer\r\n}\r\n\r\n/**\r\n * Provides a getter/setter for the main workspace\r\n * @property _mainWorkspace - Get or set the currently active workspace\r\n */\r\nObject.defineProperty(Kabel, '_mainWorkspace', {\r\n    get(): WorkspaceSvg | null {\r\n        return getMainWorkspace()\r\n    },\r\n    set(v: WorkspaceSvg | undefined | null | false | 0 | string) {\r\n        if (\r\n            v === undefined ||\r\n            v === null ||\r\n            v === false ||\r\n            v === 0 ||\r\n            typeof v === 'string'\r\n        ) {\r\n            return clearMainWorkspace()\r\n        }\r\n        return setMainWorkspace(v)\r\n    }\r\n})\r\n\r\nexport default Kabel\r\n","import { Element as SvgElement, Rect as SvgRect, Text as SvgText } from \"@svgdotjs/svg.js\";\r\nimport CommentModel from \"../src/comment\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\n\r\ntype InitArgs = {\r\n    comment: CommentModel;\r\n    text: SvgText;\r\n};\r\n\r\nfunction initCommentInput(element: SvgElement, rawArgs: any) {\r\n    const args = rawArgs as InitArgs;\r\n    const comment = args.comment;\r\n    const txt = args.text as SvgText;\r\n    const rect = element as unknown as SvgRect;\r\n    const ws = comment.getWorkspace();\r\n    const svg = ws.svg;\r\n    function measureTextWidth(text: string, fontSize: number, fontFamily: string): number {\r\n        if (!svg) return text.length * (fontSize) * 0.6;\r\n\r\n        // encode spaces so measurement matches display\r\n        const displayText = encodeForSvg(text);\r\n\r\n        const txt = svg.text(displayText)\r\n            .attr({ 'xml:space': 'preserve' })\r\n            .font({ family: fontFamily, size: fontSize, anchor: 'start' })\r\n            .opacity(0); // hide it\r\n\r\n        const width = txt.bbox().width;\r\n        txt.remove(); // clean up\r\n        return width;\r\n    }\r\n\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = comment.getText() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length; // selection anchor\r\n\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    // Helper: encode spaces into NBSPs for display so multiple spaces are visible.\r\n    // Simple and reliable: converts every regular space to NBSP.\r\n    // If you care about wrapping later we can make this fancier (only convert runs or leading spaces).\r\n    function encodeForSvg(s: string) {\r\n        // replace spaces with NBSPs\r\n        // replace newlines with SVG line breaks\r\n        return s.replace(/ /g, \"\\u00A0\").replace(/\\n/g, \"&#10;\");\r\n    }\r\n\r\n\r\n    function ensureTspansPreserve(node: Element) {\r\n        // set xml:space on all child elements (tspans)\r\n        Array.from(node.childNodes).forEach((child) => {\r\n            if (child.nodeType === 1) {\r\n                (child as Element).setAttribute(\"xml:space\", \"preserve\");\r\n            }\r\n        });\r\n    }\r\n\r\n    let caretLine: SvgRect | null = null;\r\n    let selectionRect: SvgRect | null = null;\r\n    let measureText: SvgText | null = null; // hidden measurement element\r\n\r\n    function updateText() {\r\n        const { start, end } = getSelectionRange();\r\n        const hasSel = hasSelection();\r\n\r\n        // --- redraw main text (full buffer, always) ---\r\n        txt.clear().tspan(encodeForSvg(buffer));\r\n        txt.attr({ \"xml:space\": \"preserve\" });\r\n\r\n\r\n        try { ensureTspansPreserve(txt.node as Element); } catch { }\r\n        txt.leading(1.2);\r\n\r\n        // --- selection highlight (same as before) ---\r\n        if (hasSel) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14;\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n\r\n            const { start, end } = getSelectionRange();\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n\r\n            const bbox = txt.bbox();\r\n            const highlightX = bbox.x + measureTextWidth(textBeforeStart, fontSize, fontFamily);\r\n            const highlightWidth = Math.max(\r\n                measureTextWidth(textBeforeEnd, fontSize, fontFamily) - measureTextWidth(textBeforeStart, fontSize, fontFamily),\r\n                1\r\n            );\r\n            const highlightY = bbox.y;\r\n            const highlightH = bbox.height;\r\n\r\n            if (!selectionRect) {\r\n                // explicitly append to parent so it actually exists in DOM\r\n                // @ts-ignore\r\n                selectionRect = rect!.parent()!.rect?.(highlightWidth, highlightH)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                console.log(highlightWidth, highlightH);\r\n                selectionRect.size(highlightWidth, highlightH);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n\r\n\r\n        // --- caret rect logic using measureTextWidth ---\r\n        if (editing) {\r\n            const fontSize = parseFloat(txt.attr('font-size') as string) || 14; // fallback if needed\r\n            const fontFamily = txt.attr('font-family') as string || 'Arial';\r\n\r\n            // get the width of all characters before the cursor\r\n            const textBeforeCaret = buffer.slice(0, cursorPos);\r\n            const caretXOffset = measureTextWidth(textBeforeCaret, fontSize, fontFamily);\r\n\r\n            // get bbox to know y and height\r\n            const bbox = txt.bbox();\r\n            const caretY = bbox.y;\r\n            const caretH = bbox.height;\r\n\r\n            if (!caretLine) {\r\n                // @ts-ignore\r\n                caretLine = rect.parent().rect(1, caretH).fill('#000');\r\n            }\r\n\r\n            caretLine!.size(1, caretH).move(bbox.x + caretXOffset, caretY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        // --- resize background rect ---\r\n        const bbox = txt.bbox();\r\n        const handleRadius = 6;\r\n        const textOffsetX = PADDING_X + handleRadius * 2 + 4;\r\n        const rectW = Math.max(16, Math.ceil(bbox.width) + textOffsetX + PADDING_X);\r\n        const rectH = Math.max(16, Math.ceil(bbox.height) + PADDING_Y * 2);\r\n        rect.size(rectW, rectH);\r\n\r\n        comment._tempInputBBox = {\r\n            width: rectW,\r\n            height: rectH,\r\n            textX: textOffsetX,\r\n            textY: PADDING_Y\r\n        };\r\n    }\r\n\r\n\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = comment.getText() ?? \"\";\r\n        cursorPos = buffer.length;\r\n\r\n        userState.setState(\"typing\");\r\n\r\n        if (ev && comment._tempInputBBox) {\r\n            let localX = ev.offsetX - comment._tempInputBBox.textX;\r\n            localX = Math.max(0, localX);\r\n            cursorPos = buffer.length / 2;\r\n            anchorPos = buffer.length / 2;\r\n        }\r\n\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing(commit = true) {\r\n        if (!editing) return;\r\n        editing = false;\r\n\r\n        userState.removeState(\"typing\");\r\n\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n\r\n        if (commit) comment.setTextNoRedraw(buffer);\r\n        updateText();\r\n        comment.getWorkspace()?.redraw?.();\r\n    }\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(false); return; }\r\n\r\n        if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            stopEditing(true);\r\n        } else if (e.key === \"Backspace\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            e.preventDefault();\r\n            if (hasSelection()) {\r\n                deleteSelection();\r\n            } else if (cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        }\r\n        else if (e.key === \"ArrowLeft\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection left\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.max(0, cursorPos - 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                // extend selection right\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            } else {\r\n                // collapse selection and move\r\n                cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Home\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = 0; // anchor unchanged\r\n            } else {\r\n                cursorPos = 0;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"End\") {\r\n            e.preventDefault();\r\n            if (e.shiftKey) {\r\n                cursorPos = buffer.length;\r\n            } else {\r\n                cursorPos = buffer.length;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            e.preventDefault();\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        }\r\n\r\n        updateText();\r\n        comment.setTextNoRedraw(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const targ = ev.target as Node;\r\n        if (targ !== rect.node && targ !== txt.node) stopEditing(true);\r\n    }\r\n\r\n    const onRectDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n    const onTextDown = (ev: Event) => startEditing(ev as MouseEvent);\r\n\r\n    rect.on(\"mousedown\", onRectDown as any);\r\n    txt.on(\"mousedown\", onTextDown as any);\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", onRectDown as any);\r\n        txt.off(\"mousedown\", onTextDown as any);\r\n        document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_commentinp\", initCommentInput as EventSetupFn);\r\nexport default initCommentInput;\r\n","// uid.ts\r\n\r\n/**\r\n * Strategy used to generate UIDs.\r\n */\r\nexport type UIDStrategy = \"uuidv4\" | \"ulid\" | \"nanoid\" | \"short\";\r\n\r\nexport interface UIDOptions {\r\n    /** For \"nanoid\": length of the id (default 21) */\r\n    size?: number;\r\n    /** For \"nanoid\": custom alphabet (default URL-safe) */\r\n    alphabet?: string;\r\n}\r\n\r\n/** Web Crypto shim (browser + Node 16+) */\r\nconst cryptoAPI: Crypto | null =\r\n    (typeof globalThis !== \"undefined\" && (globalThis as any).crypto) || null;\r\n\r\n/**\r\n * Returns a Uint8Array of random bytes.\r\n * Uses Web Crypto if available; falls back to Math.random otherwise (not cryptographically secure).\r\n *\r\n * @param {number} len - Number of random bytes to generate.\r\n * @returns {Uint8Array} Random bytes array.\r\n */\r\nfunction randBytes(len: number): Uint8Array {\r\n    if (cryptoAPI?.getRandomValues) {\r\n        const buf = new Uint8Array(len);\r\n        cryptoAPI.getRandomValues(buf);\r\n        return buf;\r\n    }\r\n    // Last resort (very old envs). Not cryptographically strong.\r\n    const buf = new Uint8Array(len);\r\n    for (let i = 0; i < len; i++) buf[i] = Math.floor(Math.random() * 256);\r\n    return buf;\r\n}\r\n\r\n/**\r\n * Generates an RFC4122-compliant UUID v4.\r\n * Uses `crypto.randomUUID` if available.\r\n *\r\n * @returns {string} UUID v4 string.\r\n */\r\nexport function uuidv4(): string {\r\n    const g: any = globalThis as any;\r\n    if (g?.crypto?.randomUUID) return g.crypto.randomUUID();\r\n\r\n    const b = randBytes(16);\r\n    // Per RFC: set version + variant bits\r\n    // @ts-ignore\r\n    b[6] = (b[6] & 0x0f) | 0x40;\r\n    // @ts-ignore\r\n    b[8] = (b[8] & 0x3f) | 0x80;\r\n\r\n    const hex: string[] = [];\r\n    for (let i = 0; i < 256; i++) hex.push(i.toString(16).padStart(2, \"0\"));\r\n\r\n    return (\r\n        // @ts-ignore\r\n        hex[b[0]] + hex[b[1]] + hex[b[2]] + hex[b[3]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[4]] + hex[b[5]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[6]] + hex[b[7]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[8]] + hex[b[9]] + \"-\" +\r\n        // @ts-ignore\r\n        hex[b[10]] + hex[b[11]] + hex[b[12]] + hex[b[13]] + hex[b[14]] + hex[b[15]]\r\n    );\r\n}\r\n\r\n/** Crockford Base32 alphabet for ULID */\r\nconst CROCK32 = \"0123456789ABCDEFGHJKMNPQRSTVWXYZ\"; // no I L O U\r\n\r\n/**\r\n * Generates a 26-character ULID (time-sortable unique ID).\r\n *\r\n * @param {number} [date] - Optional timestamp in milliseconds. Defaults to `Date.now()`.\r\n * @returns {string} ULID string.\r\n */\r\nexport function ulid(date?: number): string {\r\n    const time = (typeof date === \"number\" ? date : Date.now()) >>> 0; // low 32 bits\r\n    const timeHi = Math.floor((typeof date === \"number\" ? date : Date.now()) / 0x100000000) >>> 0; // high 32\r\n    // ULID uses 48-bit time; do base32 encode 48 bits\r\n    const time48 = new Uint8Array(6);\r\n    // write 48-bit big-endian\r\n    let t = BigInt(typeof date === \"number\" ? date : Date.now());\r\n    for (let i = 5; i >= 0; i--) {\r\n        time48[i] = Number(t & 0xffn);\r\n        t >>= 8n;\r\n    }\r\n    // first 10 chars = time\r\n    let out = \"\";\r\n    let acc = 0;\r\n    let bits = 0;\r\n    for (let i = 0; i < 6; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | time48[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n    out = out.slice(0, 10);\r\n\r\n    // last 16 chars = randomness (80 bits)\r\n    const rnd = randBytes(10);\r\n    acc = 0; bits = 0;\r\n    for (let i = 0; i < rnd.length; i++) {\r\n        // @ts-ignore\r\n        acc = (acc << 8) | rnd[i];\r\n        bits += 8;\r\n        while (bits >= 5) {\r\n            bits -= 5;\r\n            out += CROCK32[(acc >>> bits) & 31];\r\n        }\r\n    }\r\n    if (bits > 0) out += CROCK32[(acc << (5 - bits)) & 31];\r\n\r\n    return out.slice(0, 26);\r\n}\r\n\r\n/** NanoID-style: URL-safe alphabet by default, configurable length/alphabet */\r\nconst DEFAULT_ALPHABET =\r\n    \"_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n/**\r\n * Generates a NanoID-style string.\r\n *\r\n * @param {number} [size=21] - Length of the generated ID.\r\n * @param {string} [alphabet=DEFAULT_ALPHABET] - Alphabet to use.\r\n * @returns {string} Generated NanoID string.\r\n */\r\nexport function nanoid(size: number = 21, alphabet: string = DEFAULT_ALPHABET): string {\r\n    if (size <= 0) throw new Error(\"size must be > 0\");\r\n    const mask = (1 << Math.ceil(Math.log2(alphabet.length))) - 1;\r\n    let id = \"\";\r\n    while (id.length < size) {\r\n        const bytes = randBytes(1);\r\n        // @ts-ignore\r\n        const idx = bytes[0] & mask;\r\n        if (idx < alphabet.length) id += alphabet[idx];\r\n    }\r\n    return id;\r\n}\r\n\r\n/**\r\n * Generates a short, mostly-unique ID (timestamp + counter + random).\r\n * Not cryptographically strong.\r\n *\r\n * @returns {string} Short UID string.\r\n */\r\nlet _ctr = 0;\r\nexport function shortId(): string {\r\n    const ts = Date.now().toString(36);\r\n    _ctr = (_ctr + 1) & 0xfff; // 0..4095\r\n    const c = _ctr.toString(36).padStart(3, \"0\");\r\n    const r = Array.from(randBytes(3))\r\n        .map(b => (b & 0x3f).toString(36).padStart(2, \"0\"))\r\n        .join(\"\")\r\n        .slice(0, 4);\r\n    return `${ts}${c}${r}`;\r\n}\r\n\r\n/**\r\n * Generates a UID using the specified strategy.\r\n *\r\n * @param {UIDStrategy} [strategy=\"uuidv4\"] - The UID strategy to use.\r\n * @param {UIDOptions} [opts={}] - Options for the selected strategy.\r\n * @returns {string} Generated UID.\r\n */\r\nexport function generateUID(strategy: UIDStrategy = \"uuidv4\", opts: UIDOptions = {}): string {\r\n    switch (strategy) {\r\n        case \"uuidv4\": return uuidv4();\r\n        case \"ulid\": return ulid();\r\n        case \"nanoid\": return nanoid(opts.size ?? 21, opts.alphabet ?? DEFAULT_ALPHABET);\r\n        case \"short\": return shortId();\r\n        default: {\r\n            const _exhaustive: never = strategy;\r\n            return uuidv4();\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Escapes special characters in a string to their corresponding HTML entities.\r\n *\r\n * Specifically, it replaces:\r\n * - `&` with `&amp;`\r\n * - `'` with `&apos;`\r\n * - `\"` with `&quot;`\r\n * - `<` with `&lt;`\r\n * - `>` with `&gt;`\r\n *\r\n * @param {string} s - The string to escape.\r\n * @returns {string} The escaped string with special characters replaced by HTML entities.\r\n */\r\nfunction escapeAttr(s: string): string {\r\n    return s.replace(/&/g, \"&amp;\")\r\n            .replace(/'/g, \"&apos;\")\r\n            .replace(/\"/g, \"&quot;\")\r\n            .replace(/</g, \"&lt;\")\r\n            .replace(/>/g, \"&gt;\");\r\n}\r\n\r\nexport default escapeAttr;\r\n","import { G, Line } from \"@svgdotjs/svg.js\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\n\r\n/**\r\n * Represents a comment attached to either a NodeSvg or a WorkspaceSvg.\r\n */\r\nclass CommentModel {\r\n    /** The comment text */\r\n    _text: string;\r\n\r\n    /** True if this comment belongs to the workspace instead of a node */\r\n    _isWorkspaceComment: boolean;\r\n\r\n    /** Parent NodeSvg or WorkspaceSvg to which this comment belongs */\r\n    _parent: NodeSvg | WorkspaceSvg;\r\n\r\n    /** SVG group representing this comment in the DOM */\r\n    svgGroup?: G|undefined;\r\n\r\n    /** Coordinates relative to parent */\r\n    relativeCoords: Coordinates;\r\n\r\n    /** Optional SVG line connecting the comment to its node */\r\n    svgLine?: Line|undefined;\r\n\r\n    /** Temporary bounding box info for input handling */\r\n    _tempInputBBox?: { width: number; height: number; textX: number; textY: number };\r\n\r\n    /** Unique identifier for this comment */\r\n    id: string;\r\n\r\n    /**\r\n     * Creates a new comment attached to a node or workspace.\r\n     * @param parent - NodeSvg or WorkspaceSvg this comment belongs to\r\n     */\r\n    constructor(parent: NodeSvg | WorkspaceSvg) {\r\n        this._parent = parent;\r\n        this._isWorkspaceComment = parent instanceof WorkspaceSvg;\r\n        this._text = \"\";\r\n        this.relativeCoords = new Coordinates(0, 0); // Coordinates relative to this._parent\r\n        this.id = generateUID(\"nanoid\", {\r\n            alphabet: \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^\",\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sets the text of the comment without triggering a redraw.\r\n     * @param value - New text content\r\n     * @returns The updated text\r\n     */\r\n    setTextNoRedraw(value: string): string {\r\n        return (this._text = value);\r\n    }\r\n\r\n    /**\r\n     * Retrieves the current text of the comment.\r\n     * @returns The comment text\r\n     */\r\n    getText(): string {\r\n        return this._text;\r\n    }\r\n\r\n    /**\r\n     * Sets the text of the comment and triggers a redraw of all comments in the workspace.\r\n     * @param value - New text content\r\n     * @returns The updated text\r\n     */\r\n    setText(value: string): string {\r\n        const res = (this._text = value);\r\n        this.getWorkspace().renderer.clearComments();\r\n        this.getWorkspace().renderer.drawComments();\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns true if this comment is attached to a node.\r\n     */\r\n    isNodeComment(): boolean {\r\n        return !this._isWorkspaceComment;\r\n    }\r\n\r\n    /**\r\n     * Returns true if this comment is attached to the workspace.\r\n     */\r\n    isWorkspaceComment(): boolean {\r\n        return this._isWorkspaceComment;\r\n    }\r\n\r\n    /**\r\n     * Gets the workspace that owns this comment.\r\n     */\r\n    getWorkspace(): WorkspaceSvg {\r\n        if (this.isWorkspaceComment()) {\r\n            return this._parent as WorkspaceSvg;\r\n        } else {\r\n            return (this._parent as NodeSvg)?.workspace as WorkspaceSvg;\r\n        }\r\n    }\r\n}\r\n\r\nexport default CommentModel;\r\n","import Renderer from '../renderers/renderer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport CommentModel from '../src/comment';\r\nimport { Element, SVG, Svg } from '@svgdotjs/svg.js';\r\nimport eventer from '../util/eventer';\r\n\r\nclass CommentRenderer {\r\n    static get NAME() {\r\n        return 'cr_atlas';\r\n    }\r\n    static get COMMENT_G_TAG() {\r\n        return 'KabelCommentGroup';\r\n    }\r\n    static get COMMENT_LINE_TAG() {\r\n        return 'KabelCommentLine';\r\n    }\r\n    static get COMMENT_TEXT_EL() {\r\n        return 'KabelCommentText';\r\n    }\r\n    static get COMMENT_DRAG_EL() {\r\n        return 'KabelCommentDragHandle';\r\n    }\r\n    static get RENDERER_TAG_EL() {\r\n        return 'KabelCommentElTag'\r\n    }\r\n    workspace: WorkspaceSvg;\r\n\r\n    constructor(workspace: WorkspaceSvg) {\r\n        this.workspace = workspace;\r\n    }\r\n    encodeForSvg(s: string) {\r\n        // keep newline chars as-is; replace spaces with NBSP\r\n        return s.replace(/ /g, \"\\u00A0\");\r\n    }\r\n\r\n    ensureTspansPreserve(node: HTMLElement) {\r\n        // set xml:space on all child elements (tspans)\r\n        Array.from(node.childNodes).forEach((child) => {\r\n            if (child.nodeType === 1) {\r\n                (child as HTMLElement).setAttribute(\"xml:space\", \"preserve\");\r\n            }\r\n        });\r\n    }\r\n    drawComment(comment: CommentModel) {\r\n        const svg = this.getSvg();\r\n\r\n        if (comment.svgGroup) comment.svgGroup.remove();\r\n        if (comment.svgLine) comment.svgLine.remove();\r\n\r\n        const g = svg.group().addClass(CommentRenderer.COMMENT_G_TAG);\r\n        g.attr({\r\n            'comment-data': JSON.stringify({\r\n                id: comment.id,\r\n                isws: comment.isWorkspaceComment()\r\n            })\r\n        })\r\n        comment.svgGroup = g;\r\n\r\n        const padding = 4;\r\n        const handleRadius = 6;\r\n        const textOffsetX = padding + handleRadius * 2 + 4; // space for circle + small gap\r\n        const displayEncoded = this.encodeForSvg(comment.getText());\r\n        const textEl = g.text(displayEncoded)\r\n            .font({ family: 'Arial', size: 12 })\r\n            .fill('#000')\r\n            .move(textOffsetX, padding)\r\n            .addClass(CommentRenderer.COMMENT_TEXT_EL);\r\n        textEl.node.style.userSelect = 'none';          // standard\r\n        // @ts-ignore\r\n        textEl.node.style!.webkitUserSelect = 'none';    // Safari/Chrome\r\n        // @ts-ignore\r\n        textEl.node.style!.msUserSelect = 'none';        // IE/Edge\r\n        // @ts-ignore\r\n        textEl.node.style!.MozUserSelect = 'none';       // Firefox\r\n        const bbox = textEl.bbox();\r\n\r\n        // Background rectangle\r\n        const rect = g.rect(bbox.width + padding * 2 + handleRadius * 2 + 4, bbox.height + padding * 2)\r\n            .fill('#ffffcc')\r\n            .stroke({ color: '#cccc99', width: 1 })\r\n            .radius(4)\r\n            .back();\r\n\r\n        // Drag handle circle (just visual for now)\r\n        const dragHandle = g.circle(handleRadius * 2)\r\n            .fill('#adad7d')\r\n            .move(padding, padding + (bbox.height / 2) - handleRadius) // vertically centered with text\r\n            .addClass(CommentRenderer.COMMENT_DRAG_EL);\r\n\r\n        eventer.addElement(dragHandle, 'k_draghandle', {\r\n            comment\r\n        }).tagElement(dragHandle, CommentRenderer.RENDERER_TAG_EL)\r\n        eventer.addElement(rect, \"k_commentinp\", {\r\n            comment,\r\n            text: textEl\r\n        }).tagElement(rect, CommentRenderer.RENDERER_TAG_EL)\r\n\r\n        let workspaceX = comment.relativeCoords.x;\r\n        let workspaceY = comment.relativeCoords.y;\r\n\r\n        if (comment._parent instanceof NodeSvg) {\r\n            const nodePos = comment._parent.relativeCoords;\r\n            workspaceX += nodePos.x;\r\n            workspaceY += nodePos.y;\r\n        }\r\n\r\n        const screenPos = this.workspace.workspaceToScreen(workspaceX, workspaceY);\r\n        const zoom = this.workspace.getZoom();\r\n        g.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${zoom})` });\r\n\r\n\r\n        if (comment._parent instanceof NodeSvg && comment._parent.svgGroup) {\r\n            this._drawLineToNode(comment, padding);\r\n        }\r\n    }\r\n\r\n    refreshCommentTransforms() {\r\n        const svg = this.getSvg();\r\n\r\n        for (const comment of [\r\n            ...this.workspace.getComments(),\r\n            ...Array.from(this.workspace._nodeDB.values())\r\n                .map(n => n.getComment())\r\n                .filter(c => !!c) as CommentModel[]\r\n        ]) {\r\n            if (!comment.svgGroup) continue;\r\n\r\n            let workspaceX = comment.relativeCoords.x;\r\n            let workspaceY = comment.relativeCoords.y;\r\n\r\n            if (comment._parent instanceof NodeSvg) {\r\n                const nodePos = comment._parent.relativeCoords;\r\n                workspaceX += nodePos.x;\r\n                workspaceY += nodePos.y;\r\n            }\r\n\r\n            const screenPos = this.workspace.workspaceToScreen(workspaceX, workspaceY);\r\n\r\n            // Move comment group\r\n            const zoom = this.workspace.getZoom();\r\n            comment.svgGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${zoom})` });\r\n\r\n\r\n\r\n            // Remove line if it exists\r\n            if (comment.svgLine) {\r\n                comment.svgLine.remove();\r\n                comment.svgLine = undefined;\r\n            }\r\n            const textEl = comment.svgGroup.findOne(`.${CommentRenderer.COMMENT_TEXT_EL}`);\r\n            // Only redraw line if parent is a NodeSvg\r\n            if (comment._parent instanceof NodeSvg) {\r\n                const bbox = textEl ? (textEl as Element).bbox() : { width: 0, height: 0 };\r\n                this._drawLineToNode(comment, 4);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    private _drawLineToNode(comment: CommentModel, padding: number) {\r\n        if (!comment || !(comment._parent instanceof NodeSvg) || !comment.svgGroup) return;\r\n        const svg = this.getSvg();\r\n        const ws = this.workspace;\r\n\r\n        // Remove old line\r\n        if (comment.svgLine) comment.svgLine.remove();\r\n\r\n        // --- Node top-center in screen coordinates ---\r\n        const nodeWSPos = comment._parent.relativeCoords;\r\n        const nodeBBox = comment._parent.svgGroup!.bbox();\r\n        const nodeTopCenter = ws.workspaceToScreen(\r\n            nodeWSPos.x + nodeBBox.width / 2,\r\n            nodeWSPos.y\r\n        );\r\n\r\n        // --- Comment top-center in screen coordinates ---\r\n        const parentWSPos = comment._parent.relativeCoords; // parent position\r\n        const commentRelPos = comment.relativeCoords;       // comment relative to parent\r\n        const commentAbsX = parentWSPos.x + commentRelPos.x;\r\n        const commentAbsY = parentWSPos.y + commentRelPos.y;\r\n        const commentBBox = comment.svgGroup!.bbox();\r\n        const commentTopCenter = ws.workspaceToScreen(\r\n            commentAbsX + (commentBBox.width + padding * 2) / 2,\r\n            commentAbsY\r\n        );\r\n\r\n        // Draw line\r\n        comment.svgLine = svg.line(\r\n            nodeTopCenter.x, nodeTopCenter.y,\r\n            commentTopCenter.x, commentTopCenter.y\r\n        )\r\n            .stroke({ color: '#888', width: 1, dasharray: '3,2' })\r\n            .addClass(CommentRenderer.COMMENT_LINE_TAG)\r\n            .back();\r\n    }\r\n\r\n\r\n    clearAllComments() {\r\n        const svg = this.getSvg();\r\n        svg.find(`.${CommentRenderer.COMMENT_G_TAG}`).forEach(el => el.remove());\r\n        svg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n        eventer.destroyByTag(CommentRenderer.RENDERER_TAG_EL)\r\n        for (let [_, node] of this.workspace._nodeDB) {\r\n            const comment = node.getComment();\r\n            if (comment) comment.svgGroup = undefined;\r\n        }\r\n        for (const comment of this.workspace.getComments()) {\r\n            comment.svgGroup = undefined;\r\n        }\r\n    }\r\n    clearCommentLines() {\r\n        const svg = this.getSvg();\r\n        svg.find(`.${CommentRenderer.COMMENT_LINE_TAG}`).forEach(el => el.remove());\r\n    }\r\n    drawAllComments() {\r\n        for (const comment of this.workspace.getComments()) this.drawComment(comment);\r\n        for (let [_, node] of this.workspace._nodeDB) {\r\n            const comment = node.getComment();\r\n            if (comment) this.drawComment(comment);\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    getSvg(): Svg {\r\n        return this.workspace.svg;\r\n    }\r\n}\r\n\r\nexport default CommentRenderer;\r\n","import RendererConstants from \"./constants\";\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport * as Path from '../util/path';\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport { G, Path as SvgPath, Svg, StrokeData, Element, List, Rect } from \"@svgdotjs/svg.js\";\r\nimport { Color, ColorStyle, Hex } from \"../src/visual-types\";\r\nimport Field, { AnyField, ConnectableField, DummyField, FieldRawBoxData, OptConnectField } from \"../src/field\";\r\nimport eventer from '../util/eventer';\r\nimport Connection, { Connectable } from \"../src/connection\";\r\nimport escapeAttr from '../util/escape-html';\r\nimport unescapeAttr from '../util/unescape-html';\r\nimport CommentRenderer from \"../comment-renderer/renderer\";\r\nimport { FieldVisualInfo } from \"../src/field\";\r\nimport { RepresenterNode } from \"./representer-node\";\r\n\r\nexport interface ConnectorToFrom {\r\n    to: Connection,\r\n    from: Connection,\r\n    fromCircle?: SvgPath,\r\n    toCircle?: SvgPath,\r\n    originConn: Connection,\r\n    originCircle: SvgPath\r\n}\r\nexport interface DrawState {\r\n    id: string;\r\n    topbar?: SvgPath | null;\r\n    bg?: SvgPath | null;\r\n    group?: G | null;\r\n    fieldCol?: G | null;\r\n    fieldPosY?: number | null; // starts under topbar, goes down by field height each time one is drawn. This determines position\r\n    xButton?: G;\r\n    pendingConnections: ConnectorToFrom[]\r\n}\r\n\r\nfunction drawState(nodeGroup: G, id: string): DrawState {\r\n    return {\r\n        id,\r\n        group: nodeGroup,\r\n        fieldPosY: 0,\r\n        pendingConnections: []\r\n    }\r\n}\r\n\r\nclass Renderer {\r\n    _constants: RendererConstants;\r\n    _currentNode: NodeSvg | null;\r\n    _nodeGroup: G | null;\r\n    _nodeDraw: DrawState | null;\r\n    _ws: WorkspaceSvg;\r\n    _drawStates: DrawState[];\r\n    _commentDrawer!: CommentRenderer;\r\n\trepresenter!: import('./representer').default;\r\n    static get NODE_G_TAG() {\r\n        return 'AtlasNodeSVG';\r\n    }\r\n    static get ELEMENT_TAG() {\r\n        return 'AtlasElement'\r\n    }\r\n    static get CONN_LINE_TAG() {\r\n        return 'AtlasConnectionLine';\r\n    }\r\n    static get CONNECTOR_TAG() {\r\n        return 'AtlasConnectionBubble';\r\n    }\r\n    static get LINE_X_MARK_TAG() {\r\n        return 'AtlasLineXMark';\r\n    }\r\n    static get NAME() {\r\n        return 'atlas'; // default is called atlas.\r\n    }\r\n\r\n    constructor(workspace: WorkspaceSvg, overrides: Partial<RendererConstants> = {}) {\r\n        this._ws = workspace;\r\n        this._currentNode = null;\r\n        this._constants = new RendererConstants(overrides);\r\n        this._nodeGroup = null;\r\n        this._nodeDraw = null;\r\n        this._drawStates = [];\r\n        this.initCommentRenderer();\r\n        this.initRepresenter();\r\n\r\n    }\r\n    initRepresenter() {\r\n        const Representer = (require('./representer').default);\r\n        this.representer = new Representer();\r\n    }\r\n    initCommentRenderer() {\r\n        this._commentDrawer = new CommentRenderer(this.getWs());\r\n    }\r\n    enqueueSetConnect(c: ConnectorToFrom) {\r\n        this.state?.pendingConnections?.push?.(c);\r\n    }\r\n    setConstants(c: Partial<RendererConstants> = {}) {\r\n        return Object.assign(this._constants, c);\r\n    }\r\n    get constants(): RendererConstants {\r\n        if (!this.node) return this._constants;\r\n\r\n        const { primary, secondary, tertiary, ...restColors } = this.node.colors;\r\n\r\n        return {\r\n            ...this._constants,\r\n            ...restColors\r\n        };\r\n    }\r\n\r\n    set constants(c: Partial<RendererConstants>) {\r\n        this.setConstants(c);\r\n    }\r\n    get node() {\r\n        return this._currentNode;\r\n    }\r\n    get svg(): Svg {\r\n        return this.getWs().svg; // Svg.js instance\r\n    }\r\n    get state(): null | undefined | DrawState {\r\n        return this._nodeDraw;\r\n    }\r\n    getWs() {\r\n        return this._ws;\r\n    }\r\n    getNodeBaseMeasurements() {\r\n        const c = this.constants;\r\n        return {\r\n            width: c.NODE_BASE_WIDTH,\r\n            height: c.NODE_BASE_HEIGHT\r\n        }\r\n    }\r\n    measureTextWidth(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return text.length * (fontSize ?? c.FONT_SIZE) * 0.6;\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const width = txt.bbox().width;\r\n        txt.remove(); // clean up\r\n        return width;\r\n    }\r\n    measureTextHeight(text: string, fontSize?: number, fontFamily?: string): number {\r\n        const c = this.constants;\r\n\r\n        // fallback in case SVG is not ready\r\n        if (!this.svg) return (fontSize ?? c.FONT_SIZE);\r\n\r\n        const txt = this.svg.text(text)\r\n            .font({\r\n                family: fontFamily ?? c.FONT_FAMILY,\r\n                size: fontSize ?? c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .opacity(0); // hide it\r\n\r\n        const height = txt.bbox().height;\r\n        txt.remove(); // clean up\r\n        return height;\r\n    }\r\n\r\n\r\n\r\n    measureRawField(text: string = \"\") {\r\n        const c = this.constants;\r\n        const textW = this.measureTextWidth(text);\r\n        const width = Math.max(c.FIELD_RAW_BASE_WIDTH, textW + c.INPUT_BOX_PADDING * 2);\r\n        const height = c.FIELD_RAW_BASE_HEIGHT;\r\n        return { width, height };\r\n    }\r\n    private measureLabel(field: AnyField): { width: number, height: number } {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return { width: 0, height: 0 };\r\n\r\n        const width = this.measureTextWidth(label);\r\n        const height = this.measureTextHeight(label);\r\n\r\n        return { width, height };\r\n    }\r\n\r\n    private measureRaw(field: AnyField): { width: number, height: number } {\r\n        if (!field.hasRaw()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const raw = this.measureRawField(field.getValue?.() ?? \"\");\r\n        return {\r\n            width: raw.width,\r\n            height: raw.height\r\n        };\r\n    }\r\n\r\n    private measureCustom(field: AnyField): { width: number, height: number } {\r\n        if (!field.isCustomEditor()) return { width: 0, height: 0 };\r\n\r\n        const c = this.constants;\r\n        const m = field.measureMyself();\r\n        if (!m) return { width: 0, height: 0 };\r\n\r\n        let width = m.width as number;\r\n        let height = m.height as number;\r\n\r\n        return { width, height };\r\n    }\r\n    getFieldMeasurementPadding() {\r\n        return { width: this.constants.FIELD_SPACEX, height: 0 }\r\n    }\r\n    measureField(field: AnyField) {\r\n\r\n        const parts = [\r\n            this.getFieldMeasurementPadding(),\r\n            this.measureLabel(field),\r\n            this.measureRaw(field),\r\n            this.measureCustom(field),\r\n            this.getFieldMeasurementPadding()\r\n        ];\r\n\r\n        let width = 0, height = 0;\r\n        for (const { width: w, height: h } of parts) {\r\n            width += w;\r\n            height = Math.max(height, h);\r\n        }\r\n\r\n        return { width, height };\r\n    }\r\n\r\n    measureNodeDimensions() {\r\n        if (!this.node) return;\r\n\r\n        const c = this.constants;\r\n        const node: NodeSvg = this.node;\r\n        const fieldMeasurements: { width: number; height: number }[] = [];\r\n\r\n        const BASE = this.getNodeBaseMeasurements();\r\n        let totalWidth = BASE.width;\r\n        let totalHeight = BASE.height; // start at base\r\n        if (node.labelText) {\r\n            const labelW = this.measureTextWidth(node.labelText, c.FONT_SIZE, c.FONT_FAMILY);\r\n            totalWidth = Math.max(\r\n                totalWidth,\r\n                labelW + c.TOPBAR_LABEL_MARGIN_X * 2  // add left/right margin\r\n            );\r\n        }\r\n\r\n        let y = c.TOPBAR_HEIGHT + c.FIELD_SPACEY; // current y position for fields\r\n\r\n        for (let field of node.allFields()) {\r\n            let width = 0, height = 0;\r\n\r\n            const fldM = this.measureField(field);\r\n            width = fldM.width;\r\n            height = fldM.height;\r\n            // This adds to a list of all the like widths and heights for a field\r\n            fieldMeasurements.push(fldM);\r\n            totalWidth = Math.max(totalWidth, width + c.FIELD_MARGIN_X * 2);\r\n\r\n            // Check if this field goes beyond current totalHeight\r\n            const bottomOfField = y + height;\r\n            if (bottomOfField + c.FIELD_MARGIN_Y > totalHeight) {\r\n                totalHeight = bottomOfField + c.FIELD_MARGIN_Y; // grow node only if needed\r\n            }\r\n\r\n            y += height + c.FIELD_MARGIN_Y;\r\n        }\r\n        totalHeight += c.FOOTER_HEIGHT\r\n        return {\r\n            width: totalWidth,\r\n            height: totalHeight,\r\n            fields: fieldMeasurements\r\n        };\r\n    }\r\n    renderNode(nodeIdOrNode: NodeSvg | string) {\r\n        this.startNode(nodeIdOrNode);\r\n        if (!this.node) return;\r\n        this.drawNode();\r\n        this.representer.build(this.node as NodeSvg, this, this.state as DrawState);\r\n        this.storeState();\r\n    }\r\n    startNode(nodeIdOrNode: NodeSvg | string) {\r\n        const ws = this.getWs();\r\n        if (nodeIdOrNode instanceof NodeSvg) {\r\n            this._currentNode = nodeIdOrNode;\r\n        } else {\r\n            const node = ws.getNode(nodeIdOrNode);\r\n            if (node instanceof NodeSvg) {\r\n                this._currentNode = node;\r\n            } else {\r\n                this._currentNode = null;\r\n            }\r\n        }\r\n    }\r\n    storeState() {\r\n        this._drawStates.push(this.state as DrawState);\r\n    }\r\n    drawFieldRaw(fieldGroup: G, field: AnyField, startX: number = 0) {\r\n        const c = this.constants;\r\n        const value = field.getDisplayValue?.() ?? \"\";\r\n        const { width, height } = this.measureRawField(value);\r\n\r\n        const rect = fieldGroup.rect(width, height)\r\n            .fill(parseColor(c.FIELD_RAW_COLOR))\r\n            .stroke({ color: parseColor(c.FIELD_RAW_OUTLINE_COLOR), width: c.FIELD_RAW_OUTLINE_STROKE })\r\n            .radius(3);\r\n\r\n        const txt = fieldGroup.text(value)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: c.INPUT_BOX_TEXT_ANCHOR\r\n            })\r\n            .fill(parseColor(c.FIELD_RAW_TEXT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n\r\n        const rawBox: FieldRawBoxData = {\r\n            box: rect,\r\n            txt\r\n        }\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (height - textBBox.height) / 2;\r\n\r\n        // move relative to startX (after label)\r\n        rect.move(startX, 0);\r\n        txt.move(startX + c.INPUT_BOX_PADDING, offsetY);\r\n        eventer.addElement(rect, \"k_inputbox\", {\r\n            field,      // the field object that has .getValue() and .setValue(v)\r\n            text: txt,       // the svg.js Text element you drew\r\n            renderer: this,   // the renderer instance, must have .measureRawField and .constants\r\n            startX   // x-offset where the box should start (after label)\r\n        }).tagElement(rect, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${this.node!.id}`])\r\n\r\n        return { rect, txt, rawBox };\r\n    }\r\n\r\n\r\n\r\n    drawFieldLabel(fieldGroup: G, field: AnyField, startX: number = 0): number {\r\n        const c = this.constants;\r\n        const label = field.getLabel?.();\r\n        if (!label) return 0;\r\n\r\n        const txt = fieldGroup.text(label)\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: c.FONT_SIZE,\r\n                anchor: 'start'\r\n            })\r\n            .fill(parseColor(c.FONT_COLOR));\r\n        txt.node.style.userSelect = 'none';\r\n        const bbox = txt.bbox();\r\n        const offsetY = (Math.max(c.FIELD_RAW_BASE_HEIGHT, bbox.height) - bbox.height) / 2;\r\n\r\n        // move label relative to startX\r\n        txt.move(startX, offsetY);\r\n\r\n        // return width used for next element\r\n        return bbox.width + c.LABEL_SPACING;\r\n    }\r\n\r\n    drawNodeXButton() {\r\n        const node = this.node;\r\n        const state = this._nodeDraw;\r\n        if (!node || !state || !state.topbar || !state.group) return;\r\n\r\n        const c = this.constants;\r\n\r\n        const measurements = this.measureNodeDimensions();\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n\r\n        const btnSize = c.TOPBAR_HEIGHT * 0.6;\r\n        const padding = (c.TOPBAR_HEIGHT - btnSize) / 2;\r\n\r\n        // Button group\r\n        const xGroup = state.group.group().attr({ class: 'node-x-clse' });\r\n        eventer.addElement(xGroup, 'k_closenode', {\r\n            workspace: this.getWs(),\r\n            node\r\n        }).tagElement(xGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n        // Background\r\n        xGroup.rect(btnSize, btnSize)\r\n            .fill('#ffffff00')\r\n            .radius(2)\r\n            .move(width - btnSize - padding, padding);\r\n\r\n        // X mark\r\n        const txt = xGroup.text('')\r\n            .font({\r\n                family: c.FONT_FAMILY,\r\n                size: btnSize * 0.8,\r\n                weight: 'bold',\r\n                anchor: 'middle'\r\n            })\r\n            .fill('#fff')\r\n            .attr({\r\n                'text-anchor': 'middle',        // horizontal centering\r\n                'dominant-baseline': 'middle'   // vertical centering\r\n            });\r\n        txt.node.style.userSelect = 'none';\r\n        // Apply transform to center it inside the button\r\n        txt.transform({\r\n            translateX: width - btnSize / 2 - padding,\r\n            translateY: padding + btnSize / 2\r\n        });\r\n\r\n        state.xButton = xGroup;\r\n    }\r\n\r\n    drawConnector(nodeGroup: G, nodeBg: SvgPath, y: number, side: 'left' | 'right', color: string): SvgPath | void | undefined | null {\r\n        const c = this.constants;\r\n        if (!nodeGroup || !nodeBg) return null;\r\n\r\n        const bbox = nodeBg.bbox(); // get dimensions of the background\r\n        const group = nodeGroup;     // attach connector to top-level node group\r\n        const x = side === 'left' ? 0 : bbox.width;\r\n\r\n        if (c.CONNECTOR_TRIANGLE) {\r\n            // small triangle connector\r\n            const triSize = c.CONNECTOR_TRI_SIZE;\r\n            let path = Path.roundedTri(triSize, triSize, 1);\r\n\r\n            // flip triangle horizontally for left side\r\n            if (side === 'left') path = Path.rotatePath(path, 180, triSize / 2, triSize / 2);\r\n\r\n            const tri = group.path(path)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 });\r\n            tri.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            const offsetX = side === 'left' ? -triSize : 0;\r\n            tri.transform({ translateX: x + offsetX, translateY: y - triSize / 2 });\r\n\r\n            return tri;\r\n        } else {\r\n            // circle connector\r\n            const radius = c.CONNECTOR_RADIUS;\r\n            const circlePath = Path.circle(radius);\r\n\r\n            const circ = group.path(circlePath)\r\n                .fill(parseColor(color as Hex))\r\n                .stroke({ color: parseColor('#00000000'), width: 0 })\r\n                .move(x - radius, y - radius); // center circle at (x, y)\r\n            circ.attr({\r\n                class: (this.constructor as typeof Renderer).CONNECTOR_TAG\r\n            })\r\n            return circ;\r\n        }\r\n    }\r\n\r\n\r\n    drawNodeLabel(nodeGroup: G) {\r\n        const node = this.node;\r\n        const c = this.constants;\r\n        if (!node) return;\r\n\r\n        if (node.labelText) {\r\n            const txt = nodeGroup.text(node.labelText)\r\n                .font({\r\n                    family: c.FONT_FAMILY,\r\n                    size: c.FONT_SIZE,\r\n                    anchor: 'start',\r\n                    weight: c.TOPBAR_LABEL_BOLDED ? '600' : 'normal'\r\n                })\r\n                .fill(parseColor(c.FONT_COLOR));\r\n\r\n            txt.node.style.userSelect = 'none';\r\n\r\n            const bbox = txt.bbox();\r\n            const offsetY = (c.TOPBAR_HEIGHT - bbox.height) / 2;\r\n\r\n            txt.move(c.TOPBAR_LABEL_MARGIN_X, offsetY + c.TOPBAR_LABEL_MARGIN_Y);\r\n        }\r\n    }\r\n    resolveConnectable(connectable: Connectable, fromConn: Connection): Connection | null | undefined {\r\n        if (!connectable || !fromConn) return undefined;\r\n\r\n        // If the connection is an input (previous), return the connectable's output (next) connection\r\n        if (fromConn.isPrevious) {\r\n\r\n            if (connectable instanceof NodeSvg) return connectable.nextConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n\r\n        // If the connection is an output (next), return the connectable's input (previous) connection\r\n        if (!fromConn.isPrevious) {\r\n            if (connectable instanceof NodeSvg) return connectable.previousConnection;\r\n            // @ts-ignore\r\n            if (connectable instanceof Field) return connectable.connection;\r\n        }\r\n    }\r\n    private _fillOtherNodeConnectorCircle(conn: Connection, circle: SvgPath, isPrevious: boolean) {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                // Only fill if the connection actually matches\r\n                if (isPrevious) {\r\n                    // fill toCircle if this connPair expects 'conn' as its 'to'\r\n                    if (connPair.to === conn && !connPair.toCircle) {\r\n                        connPair.toCircle = circle;\r\n                    }\r\n                } else {\r\n                    // fill fromCircle if this connPair expects 'conn' as its 'from'\r\n                    if (connPair.from === conn && !connPair.fromCircle) {\r\n                        connPair.fromCircle = circle;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    refreshComments() {\r\n        return this._commentDrawer?.refreshCommentTransforms?.();\r\n    }\r\n    clearComments() {\r\n        return this._commentDrawer?.clearAllComments?.();\r\n    }\r\n    drawComments() {\r\n        return this._commentDrawer?.drawAllComments?.();\r\n    }\r\n    getZoom() {\r\n        return this._ws.getZoom() ?? 1;\r\n    }\r\n\r\n    applyZoomToNode(nodeG: G, node: NodeSvg) {\r\n        const zoom = this.getZoom();\r\n        const { x, y } = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n        nodeG.attr({ transform: `translate(${x}, ${y}) scale(${zoom})` });\r\n    }\r\n\r\n    refreshNodeTransforms() {\r\n        const nodeGroups = this.svg.find(`.${(this.constructor as typeof Renderer).NODE_G_TAG}`);\r\n        const zoom = this.getZoom();\r\n\r\n        for (let nodeG of nodeGroups) {\r\n            const node = this._ws.getNode(unescapeAttr(nodeG.attr('data-node-id')));\r\n            if (!node) continue;\r\n            const { x, y } = this._ws.workspaceToScreen(node.relativeCoords.x, node.relativeCoords.y);\r\n            nodeG.attr({ transform: `translate(${x}, ${y}) scale(${zoom})` });\r\n        }\r\n\r\n        this.refreshConnectionLines();\r\n        this.refreshComments();\r\n    }\r\n\r\n\r\n    refreshConnectionLines() {\r\n        this.clearLines();\r\n        this.drawLinesForAllNodes();\r\n    }\r\n    createNodeDrawState(nodeGroup: G, id: string): DrawState {\r\n        return drawState(nodeGroup, id); // wraps this method so you can define your own drawstates by overriding this method\r\n    }\r\n    drawNode() {\r\n        if (!this.node) return;\r\n\r\n        const node: NodeSvg = this.node;\r\n        const c = this.constants;\r\n        const colors: ColorStyle = node.colors ?? {\r\n            primary: '#000',\r\n            secondary: '#000',\r\n            tertirary: '#000',\r\n            category: ''\r\n        };\r\n\r\n        // Main node group\r\n        const nodeGroup = this.svg.group().attr({ 'data-node-id': escapeAttr(node.id), 'class': (this.constructor as typeof Renderer).NODE_G_TAG });\r\n        // compute screen position from workspace-space relativeCoords\r\n        const screenPos = this._ws.workspaceToScreen(\r\n            node.relativeCoords.x,\r\n            node.relativeCoords.y\r\n        );\r\n\r\n        // apply it to the top-level node group\r\n        nodeGroup.attr({ transform: `translate(${screenPos.x}, ${screenPos.y})` });\r\n\r\n        const state = this.createNodeDrawState(nodeGroup, node.id);\r\n        this._nodeDraw = state;\r\n\r\n        // Measure node\r\n        const measurements = this.measureNodeDimensions();\r\n        const width = measurements?.width ?? c.NODE_BASE_WIDTH;\r\n        const height = measurements?.height ?? c.NODE_BASE_HEIGHT;\r\n\r\n        // Base rectangle\r\n        const radius = c.CORNER_RADIUS;\r\n        state.bg = nodeGroup.path(Path.roundedRect(width, height, radius))\r\n            .fill(parseColor(c.NODE_BG_COLOR))\r\n            .stroke({ color: parseColor(c.NODE_OUTLINE_COLOR), width: 2 } as StrokeData);\r\n\r\n        // Topbar\r\n        state.topbar = nodeGroup.path(Path.roundedRect(width, c.TOPBAR_HEIGHT, radius))\r\n            .fill(parseColor(colors.primary))\r\n            .stroke({ color: parseColor(colors.tertiary), width: 2 } as StrokeData);\r\n\r\n        // add the X button\r\n        this.drawNodeXButton();\r\n        this.drawNodeLabel(nodeGroup);\r\n        eventer.addElement(nodeGroup, 'k_draggable', {\r\n            dragel: state.topbar, // the handle\r\n            group: nodeGroup,\r\n            node: node,     // NodeSvg instance\r\n            type: 2\r\n        }).tagElement(nodeGroup, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n        // Outer fields group positioned under topbar using transform\r\n        const fieldsGroup = nodeGroup.group();\r\n        fieldsGroup.attr({ transform: `translate(0, ${c.TOPBAR_HEIGHT + c.FIELD_SPACEY})` });\r\n        state.fieldCol = fieldsGroup;\r\n\r\n\r\n        let y = 0;\r\n        node.allFields().forEach((field, idx) => {\r\n            const fm = measurements?.fields[idx];\r\n            if (!fm) return;\r\n\r\n            // default left alignment\r\n            let alignX = c.FIELD_MARGIN_X;\r\n\r\n            const fieldGroup = fieldsGroup.group();\r\n            fieldGroup.attr({ transform: `translate(${alignX}, ${y})` });\r\n            field.svgGroup = fieldGroup;\r\n            state.fieldPosY = y;\r\n\r\n            // draw label first, get its used width\r\n            const xUsed = this.drawFieldLabel(fieldGroup, field);\r\n            if (field.isCustomEditor()) {\r\n                // field fully owns drawing\r\n                field.drawMyself({\r\n                    measuredWidth: fm.width,\r\n                    measuredHeight: fm.height,\r\n                    xUsed,\r\n                    fieldGroup,\r\n                    nodeGroup,\r\n                    svg: this.svg,\r\n                    background: state!.bg as unknown as Rect\r\n                });\r\n            } else {\r\n                let rawData, cBubbleData = undefined;\r\n                // if raw, draw right after label\r\n                if (field.hasRaw()) {\r\n                    const { rawBox } = this.drawFieldRaw(fieldGroup, field, xUsed);\r\n                    rawData = rawBox;\r\n                }\r\n                // @ts-ignore\r\n                if (field.hasConnectable() && field!.connection) {\r\n                    // @ts-ignore\r\n                    const halfHeight = (fm.height + (field.hasRaw() ? 0 : c.FIELD_MARGIN_Y)) / 2;\r\n                    const absY = c.TOPBAR_HEIGHT + c.FIELD_SPACEY + y + halfHeight;\r\n\r\n\r\n                    const c3 = this.drawConnector(\r\n                        nodeGroup,\r\n                        state.bg as SvgPath,\r\n                        absY,\r\n                        'right',\r\n                        parseColor(c.FIELD_CONN_COLOR)\r\n                    );\r\n                    if (c3) {\r\n                        const c = {\r\n                            // @ts-ignore\r\n                            from: field!.connection as Connection,\r\n                            // @ts-ignore (typescript intellisense mad that field.connection isnt on some field types, so we ignore it.)\r\n                            to: field!.connection.getTo()?.previousConnection as Connection,\r\n                            fromCircle: c3 as SvgPath,\r\n                            originCircle: c3 as SvgPath,\r\n                            // @ts-ignore\r\n                            originConn: field!.connection as Connection\r\n                        };\r\n                        cBubbleData = {\r\n                            connector: c3,\r\n                            connState: c\r\n                        }\r\n                        this.enqueueSetConnect(c);\r\n                        eventer.addElement(c3, 'k_connectbubble', {\r\n                            // @ts-ignore\r\n                            connection: field!.connection,\r\n                            field\r\n                        }).tagElement(c3, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                    }\r\n                }\r\n                field.onDraw(rawData, cBubbleData);\r\n            }\r\n            y += fm.height + c.FIELD_MARGIN_Y;\r\n        });\r\n\r\n        state.fieldPosY = y;\r\n\r\n        /**\r\n         * Draw connectors.\r\n         */\r\n        const bbox = state.bg?.bbox();\r\n        const cY = (bbox?.height ?? height) - c.FOOTER_HEIGHT;\r\n\r\n        // Previous connection (left)\r\n        if (node.previousConnection) {\r\n            const c1 = this.drawConnector(nodeGroup, state.bg, cY, 'left', colors.primary as string);\r\n            if (c1) {\r\n                const c = ({\r\n                    from: node.previousConnection,\r\n                    to: this.resolveConnectable(node.previousConnection.getFrom(), node.previousConnection) as Connection,\r\n                    fromCircle: c1 as SvgPath,\r\n                    originConn: node.previousConnection,\r\n                    originCircle: c1\r\n                });\r\n                this.enqueueSetConnect(c);\r\n                eventer.addElement(c1, 'k_connectbubble', {\r\n                    connection: node.previousConnection,\r\n                    node\r\n                }).tagElement(c1, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.previousConnection, c1 as SvgPath, true);\r\n            }\r\n        }\r\n\r\n        // Next connection (right)\r\n        if (node.nextConnection) {\r\n            const c2 = this.drawConnector(nodeGroup, state.bg, cY, 'right', colors.primary as string);\r\n            if (c2) {\r\n                const c = ({\r\n                    from: node.nextConnection,\r\n                    to: this.resolveConnectable(node.nextConnection.getTo(), node.nextConnection) as Connection,\r\n                    fromCircle: c2 as SvgPath,\r\n                    originConn: node.nextConnection,\r\n                    originCircle: c2\r\n                });\r\n                this.enqueueSetConnect(c);\r\n                eventer.addElement(c2, 'k_connectbubble', {\r\n                    connection: node.nextConnection,\r\n                    node\r\n                }).tagElement(c2, [(this.constructor as typeof Renderer).ELEMENT_TAG, `node_${node.id}`]);\r\n                // fill any waiting connectors from other nodes\r\n                this._fillOtherNodeConnectorCircle(node.nextConnection, c2 as SvgPath, false);\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n    fillAllNodeConnectorBubbles() {\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { originConn } = connPair;\r\n                if (!originConn) continue;\r\n\r\n                // Only try to fill missing sides with real circles from other pending connections\r\n                if (!connPair.fromCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.from && p.originCircle);\r\n                    if (match) connPair.fromCircle = match.originCircle;\r\n                }\r\n\r\n                if (!connPair.toCircle) {\r\n                    const match = this._drawStates\r\n                        .flatMap(s => s.pendingConnections)\r\n                        .find(p => p.originConn === connPair.to && p.originCircle);\r\n                    if (match) connPair.toCircle = match.originCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    drawLinesForAllNodes() {\r\n        const c = this.constants;\r\n        const wsSvg = this._ws.svg;\r\n\r\n        this.fillAllNodeConnectorBubbles();\r\n        const drawnCircles = new Set<SvgPath>(); // store circles we've already drawn lines from/to\r\n\r\n        for (const state of this._drawStates) {\r\n            for (const connPair of state.pendingConnections) {\r\n                const { fromCircle, toCircle } = connPair;\r\n                if (connPair.from !== connPair.originConn) continue;\r\n                if (!fromCircle || !toCircle) continue;\r\n\r\n                // skip if either circle was already used\r\n                if (drawnCircles.has(fromCircle) || drawnCircles.has(toCircle)) continue;\r\n\r\n                // mark circles as used\r\n                drawnCircles.add(fromCircle);\r\n                drawnCircles.add(toCircle);\r\n                // Get DOM elements\r\n                const fromEl = fromCircle.node as SVGPathElement;\r\n                const toEl = toCircle.node as SVGPathElement;\r\n\r\n                // Use getBBox + getScreenCTM for absolute coordinates\r\n                const fromBBox = fromEl.getBBox();\r\n                const toBBox = toEl.getBBox();\r\n\r\n                const fromCTM = fromEl.getScreenCTM()!;\r\n                const toCTM = toEl.getScreenCTM()!;\r\n\r\n                const startX = fromBBox.x + fromBBox.width / 2;\r\n                const startY = fromBBox.y + fromBBox.height / 2;\r\n                const endX = toBBox.x + toBBox.width / 2;\r\n                const endY = toBBox.y + toBBox.height / 2;\r\n\r\n                // Transform to screen coordinates\r\n                const absStartX = startX * fromCTM.a + startY * fromCTM.c + fromCTM.e;\r\n                const absStartY = startX * fromCTM.b + startY * fromCTM.d + fromCTM.f;\r\n                const absEndX = endX * toCTM.a + endY * toCTM.c + toCTM.e;\r\n                const absEndY = endX * toCTM.b + endY * toCTM.d + toCTM.f;\r\n\r\n                // Draw the line\r\n                let pathStr: string;\r\n                if (c.CONNECTOR_LINE_CURVED) {\r\n                    const dx = Math.abs(absEndX - absStartX);\r\n                    const cp1x = absStartX + Math.sign(absEndX - absStartX) * Math.max(30, dx * 0.3);\r\n                    const cp2x = absEndX - Math.sign(absEndX - absStartX) * Math.max(30, dx * 0.3);\r\n                    pathStr = `M ${absStartX} ${absStartY} C ${cp1x} ${absStartY}, ${cp2x} ${absEndY}, ${absEndX} ${absEndY}`;\r\n                } else {\r\n                    pathStr = `M ${absStartX} ${absStartY} L ${absEndX} ${absEndY}`;\r\n                }\r\n                const zoom = this._ws.getZoom();\r\n                const strokeWidth = c.CONNECTOR_LINE_WIDTH * zoom;\r\n                const line = wsSvg.path(pathStr)\r\n                    .stroke({ color: parseColor(fromCircle.fill() as Color), width: strokeWidth })\r\n                    .fill('none')\r\n                    .attr({ class: (this.constructor as typeof Renderer).CONN_LINE_TAG });\r\n\r\n                eventer.addElement(line, 'k_connline', {\r\n                    fromConn: connPair.from,\r\n                    toConn: connPair.to,\r\n                    renderer: this\r\n                }).tagElement(line, [(this.constructor as typeof Renderer).ELEMENT_TAG, (this.constructor as typeof Renderer).LINE_X_MARK_TAG]);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    clearLines() {\r\n        for (let line of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).CONN_LINE_TAG}`)) {\r\n            line.remove();\r\n        }\r\n        for (let mark of this.getWs().svg.find(`.${(this.constructor as typeof Renderer).LINE_X_MARK_TAG}`)) {\r\n            mark.remove();\r\n        }\r\n    }\r\n\r\n    clearScreen() {\r\n        eventer.destroyByTag((this.constructor as typeof Renderer).ELEMENT_TAG)\r\n        this._ws.svg.clear();\r\n        this._drawStates = [];\r\n    }\r\n    undoPendingConnsFor(conn: ConnectorToFrom) {\r\n        for (let state of this._drawStates) {\r\n            for (let conn0 of state.pendingConnections) {\r\n                if (conn0.toCircle == conn.originCircle) {\r\n                    delete conn0.toCircle;\r\n                }\r\n                if (conn0.fromCircle == conn.originCircle) {\r\n                    delete conn0.fromCircle;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    rerenderNode(node: NodeSvg) {\r\n        // wipe old drawstate + events for this node\r\n        const idx = this._drawStates.findIndex(s => s.id === node.id);\r\n        if (idx !== -1) {\r\n            const state = this._drawStates[idx];\r\n            for (let pendingConn of state!.pendingConnections) {\r\n                this.undoPendingConnsFor(pendingConn);\r\n            }\r\n            state!.group?.remove();\r\n            eventer.destroyByTag(`node_${node.id}`);\r\n            this._drawStates.splice(idx, 1);\r\n        }\r\n\r\n        // rebuild node\r\n        this.startNode(node);\r\n        this.drawNode();\r\n        this.representer.build(this.node as NodeSvg, this, this.state as DrawState);\r\n        this.storeState();\r\n\r\n        // refresh *all* lines once the node is back in place\r\n        this.refreshNodeTransforms();\r\n        return (node.svg as RepresenterNode).getRaw();\r\n    }\r\n\r\n}\r\n\r\nexport default Renderer;\r\n","'use strict';\n\n\nvar paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0 };\n\nvar SPECIAL_SPACES = [\n  0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006,\n  0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF\n];\n\nfunction isSpace(ch) {\n  return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029) || // Line terminators\n    // White spaces\n    (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n    (ch >= 0x1680 && SPECIAL_SPACES.indexOf(ch) >= 0);\n}\n\nfunction isCommand(code) {\n  /*eslint-disable no-bitwise*/\n  switch (code | 0x20) {\n    case 0x6D/* m */:\n    case 0x7A/* z */:\n    case 0x6C/* l */:\n    case 0x68/* h */:\n    case 0x76/* v */:\n    case 0x63/* c */:\n    case 0x73/* s */:\n    case 0x71/* q */:\n    case 0x74/* t */:\n    case 0x61/* a */:\n    case 0x72/* r */:\n      return true;\n  }\n  return false;\n}\n\nfunction isArc(code) {\n  return (code | 0x20) === 0x61;\n}\n\nfunction isDigit(code) {\n  return (code >= 48 && code <= 57);   // 0..9\n}\n\nfunction isDigitStart(code) {\n  return (code >= 48 && code <= 57) || /* 0..9 */\n          code === 0x2B || /* + */\n          code === 0x2D || /* - */\n          code === 0x2E;   /* . */\n}\n\n\nfunction State(path) {\n  this.index  = 0;\n  this.path   = path;\n  this.max    = path.length;\n  this.result = [];\n  this.param  = 0.0;\n  this.err    = '';\n  this.segmentStart = 0;\n  this.data   = [];\n}\n\nfunction skipSpaces(state) {\n  while (state.index < state.max && isSpace(state.path.charCodeAt(state.index))) {\n    state.index++;\n  }\n}\n\n\nfunction scanFlag(state) {\n  var ch = state.path.charCodeAt(state.index);\n\n  if (ch === 0x30/* 0 */) {\n    state.param = 0;\n    state.index++;\n    return;\n  }\n\n  if (ch === 0x31/* 1 */) {\n    state.param = 1;\n    state.index++;\n    return;\n  }\n\n  state.err = 'SvgPath: arc flag can be 0 or 1 only (at pos ' + state.index + ')';\n}\n\n\nfunction scanParam(state) {\n  var start = state.index,\n      index = start,\n      max = state.max,\n      zeroFirst = false,\n      hasCeiling = false,\n      hasDecimal = false,\n      hasDot = false,\n      ch;\n\n  if (index >= max) {\n    state.err = 'SvgPath: missed param (at pos ' + index + ')';\n    return;\n  }\n  ch = state.path.charCodeAt(index);\n\n  if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n    index++;\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  // This logic is shamelessly borrowed from Esprima\n  // https://github.com/ariya/esprimas\n  //\n  if (!isDigit(ch) && ch !== 0x2E/* . */) {\n    state.err = 'SvgPath: param should start with 0..9 or `.` (at pos ' + index + ')';\n    return;\n  }\n\n  if (ch !== 0x2E/* . */) {\n    zeroFirst = (ch === 0x30/* 0 */);\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n\n    if (zeroFirst && index < max) {\n      // decimal number starts with '0' such as '09' is illegal.\n      if (ch && isDigit(ch)) {\n        state.err = 'SvgPath: numbers started with `0` such as `09` are illegal (at pos ' + start + ')';\n        return;\n      }\n    }\n\n    while (index < max && isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasCeiling = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x2E/* . */) {\n    hasDot = true;\n    index++;\n    while (isDigit(state.path.charCodeAt(index))) {\n      index++;\n      hasDecimal = true;\n    }\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n  }\n\n  if (ch === 0x65/* e */ || ch === 0x45/* E */) {\n    if (hasDot && !hasCeiling && !hasDecimal) {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n\n    index++;\n\n    ch = (index < max) ? state.path.charCodeAt(index) : 0;\n    if (ch === 0x2B/* + */ || ch === 0x2D/* - */) {\n      index++;\n    }\n    if (index < max && isDigit(state.path.charCodeAt(index))) {\n      while (index < max && isDigit(state.path.charCodeAt(index))) {\n        index++;\n      }\n    } else {\n      state.err = 'SvgPath: invalid float exponent (at pos ' + index + ')';\n      return;\n    }\n  }\n\n  state.index = index;\n  state.param = parseFloat(state.path.slice(start, index)) + 0.0;\n}\n\n\nfunction finalizeSegment(state) {\n  var cmd, cmdLC;\n\n  // Process duplicated commands (without comand name)\n\n  // This logic is shamelessly borrowed from Raphael\n  // https://github.com/DmitryBaranovskiy/raphael/\n  //\n  cmd   = state.path[state.segmentStart];\n  cmdLC = cmd.toLowerCase();\n\n  var params = state.data;\n\n  if (cmdLC === 'm' && params.length > 2) {\n    state.result.push([ cmd, params[0], params[1] ]);\n    params = params.slice(2);\n    cmdLC = 'l';\n    cmd = (cmd === 'm') ? 'l' : 'L';\n  }\n\n  if (cmdLC === 'r') {\n    state.result.push([ cmd ].concat(params));\n  } else {\n\n    while (params.length >= paramCounts[cmdLC]) {\n      state.result.push([ cmd ].concat(params.splice(0, paramCounts[cmdLC])));\n      if (!paramCounts[cmdLC]) {\n        break;\n      }\n    }\n  }\n}\n\n\nfunction scanSegment(state) {\n  var max = state.max,\n      cmdCode, is_arc, comma_found, need_params, i;\n\n  state.segmentStart = state.index;\n  cmdCode = state.path.charCodeAt(state.index);\n  is_arc = isArc(cmdCode);\n\n  if (!isCommand(cmdCode)) {\n    state.err = 'SvgPath: bad command ' + state.path[state.index] + ' (at pos ' + state.index + ')';\n    return;\n  }\n\n  need_params = paramCounts[state.path[state.index].toLowerCase()];\n\n  state.index++;\n  skipSpaces(state);\n\n  state.data = [];\n\n  if (!need_params) {\n    // Z\n    finalizeSegment(state);\n    return;\n  }\n\n  comma_found = false;\n\n  for (;;) {\n    for (i = need_params; i > 0; i--) {\n      if (is_arc && (i === 3 || i === 4)) scanFlag(state);\n      else scanParam(state);\n\n      if (state.err.length) {\n        finalizeSegment(state);\n        return;\n      }\n      state.data.push(state.param);\n\n      skipSpaces(state);\n      comma_found = false;\n\n      if (state.index < max && state.path.charCodeAt(state.index) === 0x2C/* , */) {\n        state.index++;\n        skipSpaces(state);\n        comma_found = true;\n      }\n    }\n\n    // after ',' param is mandatory\n    if (comma_found) {\n      continue;\n    }\n\n    if (state.index >= state.max) {\n      break;\n    }\n\n    // Stop on next segment\n    if (!isDigitStart(state.path.charCodeAt(state.index))) {\n      break;\n    }\n  }\n\n  finalizeSegment(state);\n}\n\n\n/* Returns array of segments:\n *\n * [\n *   [ command, coord1, coord2, ... ]\n * ]\n */\nmodule.exports = function pathParse(svgPath) {\n  var state = new State(svgPath);\n  var max = state.max;\n\n  skipSpaces(state);\n\n  while (state.index < max && !state.err.length) {\n    scanSegment(state);\n  }\n\n  if (state.result.length) {\n    if ('mM'.indexOf(state.result[0][0]) < 0) {\n      state.err = 'SvgPath: string should start with `M` or `m`';\n      state.result = [];\n    } else {\n      state.result[0][0] = 'M';\n    }\n  }\n\n  return {\n    err: state.err,\n    segments: state.result\n  };\n};\n","/**\r\n * Converts HTML-escaped characters in a string back to their literal form.\r\n *\r\n * Specifically, it replaces:\r\n * - `&lt;` with `<`\r\n * - `&gt;` with `>`\r\n * - `&quot;` with `\"`\r\n * - `&apos;` with `'`\r\n * - `&amp;` with `&`\r\n *\r\n * @param {string} s - The string containing HTML-escaped characters.\r\n * @returns {string} The unescaped string with HTML entities replaced by their literal characters.\r\n */\r\nfunction unescapeAttr(s: string): string {\r\n\treturn s.replace(/&lt;/g, \"<\")\r\n\t\t\t.replace(/&gt;/g, \">\")\r\n\t\t\t.replace(/&quot;/g, '\"')\r\n\t\t\t.replace(/&apos;/g, \"'\")\r\n\t\t\t.replace(/&amp;/g, \"&\");\r\n}\r\n\r\nexport default unescapeAttr;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\n\r\nexport interface WidgetOptions {\r\n    /**\r\n     * Widget class to instantiate for the widget, by default it uses Kabel's\r\n     */\r\n    cls?: typeof Widget;\r\n    /**\r\n     * Coordinates to spawn the widget at.\r\n     */\r\n    coords?: Coordinates;      // where to position the widget\r\n    /**\r\n     * Width of the widget\r\n     */\r\n    width?: number;            // optional width\r\n    /**\r\n     * Height of the widget.\r\n     */\r\n    height?: number;           // optional height\r\n    /**\r\n     * Class to give the widget's html container.\r\n     */\r\n    className?: string;        // optional CSS class\r\n    /**\r\n     * Widget inner HTML default content.\r\n     */\r\n    html?: string;             // inner HTML\r\n    /**\r\n     * Widget name\r\n     */\r\n    name: string;\r\n    /**\r\n     * Sets up a new widget of this type\r\n     * @param this - This context of the function points to widget.\r\n     * @param widget - The widget this function is called on.\r\n     * @param html - The html container of the widget.\r\n     * @returns - Void.\r\n     */\r\n    init?: (this: WidgetOptions, widget: Widget, html: HTMLElement) => void;\r\n}\r\nclass Widget {\r\n    workspace: WorkspaceSvg;\r\n    container: HTMLDivElement;\r\n    coords: Coordinates;\r\n    width: number;\r\n    height: number;\r\n    visible: boolean;\r\n    name: string;\r\n    id: string;\r\n    options: WidgetOptions;\r\n    static WIDGET_GLOBAL_ID = 0;\r\n    constructor(workspace: WorkspaceSvg, options: WidgetOptions = { name: `Untitled(${Widget.WIDGET_GLOBAL_ID++})` }) {\r\n        this.workspace = workspace;\r\n        this.coords = options.coords ?? new Coordinates(0, 0);\r\n        this.width = options.width ?? 200;\r\n        this.height = options.height ?? 100;\r\n        this.visible = false;\r\n        this.name = options.name;\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        this.options = options;\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n\r\n        if (options.html) this.container.innerHTML = options.html;\r\n\r\n        this.workspace._wsTop.appendChild(this.container);\r\n        this.hide();\r\n        if (typeof options.init !== 'undefined' && options.init) {\r\n            options.init(this, this.container);\r\n        }\r\n    }\r\n\r\n    // Show the widget\r\n    show() {\r\n        this.container.style.display = \"block\";\r\n        this.visible = true;\r\n    }\r\n\r\n    // Hide the widget\r\n    hide() {\r\n        this.container.style.display = \"none\";\r\n        this.visible = false;\r\n    }\r\n\r\n    // Move the widget to new coords\r\n    setCoords(coords: Coordinates) {\r\n        this.coords = coords;\r\n        this.container.style.left = `${coords.x}px`;\r\n        this.container.style.top = `${coords.y}px`;\r\n    }\r\n\r\n    // Update the HTML content\r\n    setHTML(html: string) {\r\n        this.container.innerHTML = html;\r\n    }\r\n    // Bring widget back from the dead after a .destroy call\r\n    reanimate() {\r\n        this.container = document.createElement(\"div\");\r\n        this.container.className = this.options.className ?? \"KabelWidget\";\r\n        this.container.style.position = \"absolute\";\r\n        this.container.style.left = `${this.coords.x}px`;\r\n        this.container.style.top = `${this.coords.y}px`;\r\n        this.container.style.width = `${this.width}px`;\r\n        this.container.style.height = `${this.height}px`;\r\n        this.container.style.background = \"rgba(255,255,255,0.9)\";\r\n        this.container.style.border = \"1px solid #aaa\";\r\n        this.container.style.borderRadius = \"4px\";\r\n        this.container.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.2)\";\r\n        this.container.style.pointerEvents = \"auto\";\r\n        this.container.style.zIndex = \"1000\"; // overlays nodes\r\n        \r\n        if (this.options.html) this.container.innerHTML = this.options.html;\r\n\r\n        this.workspace._wsTop.appendChild(this.container);\r\n        this.workspace._addWidgetToDB(this);\r\n    }\r\n    // Destroy widget & cleanup.\r\n    destroy() {\r\n        this.container.remove();\r\n        this.workspace._delWidgetFromDB(this);\r\n    }\r\n}\r\n\r\nexport default Widget;\r\n","'use strict';\n\n/* eslint-disable space-infix-ops */\n\n// The precision used to consider an ellipse as a circle\n//\nvar epsilon = 0.0000000001;\n\n// To convert degree in radians\n//\nvar torad = Math.PI / 180;\n\n// Class constructor :\n//  an ellipse centred at 0 with radii rx,ry and x - axis - angle ax.\n//\nfunction Ellipse(rx, ry, ax) {\n  if (!(this instanceof Ellipse)) { return new Ellipse(rx, ry, ax); }\n  this.rx = rx;\n  this.ry = ry;\n  this.ax = ax;\n}\n\n// Apply a linear transform m to the ellipse\n// m is an array representing a matrix :\n//    -         -\n//   | m[0] m[2] |\n//   | m[1] m[3] |\n//    -         -\n//\nEllipse.prototype.transform = function (m) {\n  // We consider the current ellipse as image of the unit circle\n  // by first scale(rx,ry) and then rotate(ax) ...\n  // So we apply ma =  m x rotate(ax) x scale(rx,ry) to the unit circle.\n  var c = Math.cos(this.ax * torad), s = Math.sin(this.ax * torad);\n  var ma = [\n    this.rx * (m[0]*c + m[2]*s),\n    this.rx * (m[1]*c + m[3]*s),\n    this.ry * (-m[0]*s + m[2]*c),\n    this.ry * (-m[1]*s + m[3]*c)\n  ];\n\n  // ma * transpose(ma) = [ J L ]\n  //                      [ L K ]\n  // L is calculated later (if the image is not a circle)\n  var J = ma[0]*ma[0] + ma[2]*ma[2],\n      K = ma[1]*ma[1] + ma[3]*ma[3];\n\n  // the discriminant of the characteristic polynomial of ma * transpose(ma)\n  var D = ((ma[0]-ma[3])*(ma[0]-ma[3]) + (ma[2]+ma[1])*(ma[2]+ma[1])) *\n          ((ma[0]+ma[3])*(ma[0]+ma[3]) + (ma[2]-ma[1])*(ma[2]-ma[1]));\n\n  // the \"mean eigenvalue\"\n  var JK = (J + K) / 2;\n\n  // check if the image is (almost) a circle\n  if (D < epsilon * JK) {\n    // if it is\n    this.rx = this.ry = Math.sqrt(JK);\n    this.ax = 0;\n    return this;\n  }\n\n  // if it is not a circle\n  var L = ma[0]*ma[1] + ma[2]*ma[3];\n\n  D = Math.sqrt(D);\n\n  // {l1,l2} = the two eigen values of ma * transpose(ma)\n  var l1 = JK + D/2,\n      l2 = JK - D/2;\n  // the x - axis - rotation angle is the argument of the l1 - eigenvector\n  /*eslint-disable indent*/\n  this.ax = (Math.abs(L) < epsilon && Math.abs(l1 - K) < epsilon) ?\n    90\n  :\n    Math.atan(Math.abs(L) > Math.abs(l1 - K) ?\n      (l1 - J) / L\n    :\n      L / (l1 - K)\n    ) * 180 / Math.PI;\n  /*eslint-enable indent*/\n\n  // if ax > 0 => rx = sqrt(l1), ry = sqrt(l2), else exchange axes and ax += 90\n  if (this.ax >= 0) {\n    // if ax in [0,90]\n    this.rx = Math.sqrt(l1);\n    this.ry = Math.sqrt(l2);\n  } else {\n    // if ax in ]-90,0[ => exchange axes\n    this.ax += 90;\n    this.rx = Math.sqrt(l2);\n    this.ry = Math.sqrt(l1);\n  }\n\n  return this;\n};\n\n// Check if the ellipse is (almost) degenerate, i.e. rx = 0 or ry = 0\n//\nEllipse.prototype.isDegenerate = function () {\n  return (this.rx < epsilon * this.ry || this.ry < epsilon * this.rx);\n};\n\nmodule.exports = Ellipse;\n","import Coordinates from \"./coordinates\";\r\n\r\n\r\n\r\n/**\r\n * A class that represents Workspace Camera Coords.\r\n * May be used in the future, right now its a no-op Coords wrapper.\r\n */\r\nclass WorkspaceCoords extends Coordinates {\r\n    constructor(x = 0, y = 0) {\r\n        super(x, y);\r\n    }\r\n}\r\nexport default WorkspaceCoords;","import Coordinates from \"./coordinates\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { Svg, SVG } from '@svgdotjs/svg.js';\r\nimport Renderer from '../renderers/renderer';\r\nimport { InjectOptions } from \"./inject\";\r\nimport WorkspaceCoords from \"./workspace-coords\";\r\nimport WorkspaceController from '../controllers/base';\r\nimport WASDController from '../controllers/wasd';\r\nimport { RMap } from \"./renderer-map\";\r\nimport Toolbox from \"./toolbox\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport newHeadlessNode from \"./headless-node\";\r\nimport Widget from \"./widget\";\r\nimport WidgetPrototypes from \"./widget-prototypes\";\r\nimport ContextMenuHTML from \"./context-menu\";\r\nimport CommentModel from \"./comment\";\r\nimport Field, { ConnectableField } from \"./field\";\r\n\r\n\r\nfunction resolveController(options: InjectOptions): typeof WorkspaceController {\r\n    if (options?.controls) {\r\n        if (options?.controls.wasd) {\r\n            return WASDController;\r\n        }\r\n    }\r\n    return WorkspaceController;\r\n}\r\n/** \r\n * Represents the visual workspace containing nodes and connections.\r\n * Handles rendering, panning, and coordinate transformations.\r\n */\r\nclass WorkspaceSvg {\r\n    /** Top-left offset of the workspace viewport */\r\n    _camera: WorkspaceCoords;\r\n\r\n    /** Node storage by unique ID */\r\n    _nodeDB: Map<string, NodeSvg>;\r\n\r\n    /** Root HTML container for the workspace */\r\n    _root: HTMLElement;\r\n\r\n    /** Top-level wrapper for the SVG */\r\n    _wsTop: HTMLElement;\r\n\r\n    /** SVG.js instance for rendering */\r\n    svg: Svg;\r\n\r\n    /** Renderer instance for drawing nodes and connections */\r\n    renderer: Renderer;\r\n\r\n    /** Options for workspace behavior and rendering overrides */\r\n    options: InjectOptions;\r\n\r\n    /** Flag to temporarily prevent redraws */\r\n    noRedraw: boolean;\r\n    /**\r\n     * A class instance that moves the camera based on user interactions.\r\n     */\r\n    controller: WorkspaceController;\r\n    /**\r\n     * Toolbox for the workspace.\r\n     */\r\n    toolbox?: Toolbox;\r\n    /**\r\n     * A list of widgets active in this workspace\r\n     */\r\n    _widgetDB: Map<string, Widget>\r\n\r\n    /**\r\n     * A manager for the context menu widget\r\n     */\r\n    _ctxMenu: ContextMenuHTML\r\n    /**\r\n     * A list of comments for this workspace.\r\n     */\r\n    _commentDB: Set<CommentModel>;\r\n    /**\r\n     * Creates a new WorkspaceSvg instance.\r\n     * @param root - The root HTML element containing the workspace.\r\n     * @param wsTop - The top-level wrapper element for the SVG.\r\n     * @param options - Configuration and renderer override options.\r\n     */\r\n    constructor(root: HTMLElement, wsTop: HTMLElement, options: InjectOptions) {\r\n        wsTop.style.width = '100%';\r\n        wsTop.style.height = '100%';\r\n\r\n        this._root = root;\r\n        this._wsTop = wsTop;\r\n        this.svg = SVG().addTo(this._wsTop).size('100%', '100%');\r\n        this.options = options;\r\n        let RClass: typeof Renderer = RMap.resolve(options.renderer);\r\n        this.renderer = new RClass(this, this.options.rendererOverrides || {});\r\n        if (this.options.toolbox) {\r\n            this.toolbox = new Toolbox(this);\r\n        }\r\n        this._camera = new WorkspaceCoords(0, 0);\r\n        this._nodeDB = new Map();\r\n        this.noRedraw = false;\r\n        this.controller = new (options.Controller ?? resolveController(options))(this);\r\n        this._widgetDB = new Map();\r\n        this._ctxMenu = new ContextMenuHTML(this);\r\n        this._commentDB = new Set();\r\n    }\r\n    getZoom() {\r\n        return this.controller.getZoom();\r\n    }\r\n    /**\r\n     * Refresh comments.\r\n     */\r\n    refreshComments() {\r\n        this.renderer.refreshComments();\r\n    }\r\n    /**\r\n     * Get all comments\r\n     * @returns {CommentModel[]}\r\n     */\r\n    getComments() {\r\n        return Array.from(this._commentDB);\r\n    }\r\n    /**\r\n     * Duplicate node data from one to another\r\n     * @param nodeSvg - The node\r\n     */\r\n    cloneNode(nodeSvg: NodeSvg) {\r\n        const n = new NodeSvg(nodeSvg.prototype, this);\r\n        n.init();\r\n        n.fromNode(nodeSvg);\r\n        this.redraw();\r\n    }\r\n    /**\r\n     * Internal: Add widget to DB\r\n     * @param wdgt - The widget\r\n     */\r\n    _addWidgetToDB(wdgt: Widget) {\r\n        this._widgetDB.set(wdgt.id, wdgt);\r\n    }\r\n    /**\r\n     * Internal: Delete a widget from DB.\r\n     * @param wdgt - Widget to delete\r\n     */\r\n    _delWidgetFromDB(wdgt: Widget) {\r\n        this._widgetDB.delete(wdgt.id);\r\n    }\r\n    /**\r\n     * Create a new widget of type.\r\n     * @param type - The prototype\r\n     * @returns {Widget|void}\r\n     */\r\n    newWidget(type: string): void | Widget {\r\n        const opts = WidgetPrototypes[type];\r\n        if (!opts) return;\r\n        if (opts.cls) {\r\n            const wdgt = new (opts.cls)(this, opts);\r\n            this._addWidgetToDB(wdgt);\r\n            return wdgt;\r\n        }\r\n        const wdgt = new Widget(this, opts);\r\n        this._addWidgetToDB(wdgt);\r\n        return wdgt;\r\n    }\r\n    /**\r\n     * Get a widget\r\n     * @param id - Identifier\r\n     * @returns {Widget|undefined} - A widget\r\n     */\r\n    getWidget(id: string): Widget | undefined {\r\n        if (this._widgetDB.has(id)) return this._widgetDB.get(id);\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace's svg content size in pixels.\r\n     * Useful for camera positioning.\r\n     */\r\n    getContentSize(): { width: number; height: number } {\r\n        const bbox = this.svg.bbox();\r\n        return { width: bbox.width, height: bbox.height };\r\n    }\r\n    /**\r\n     * Returns the current width and height of the workspace in pixels.\r\n     * Useful for camera centering, zoom calculations, and viewport sizing.\r\n     */\r\n    getSize(): { width: number; height: number } {\r\n        const rect = this._wsTop.getBoundingClientRect();\r\n        return { width: rect.width, height: rect.height };\r\n    }\r\n\r\n    /**\r\n     * Updates all connection lines & node screen positions without a full redraw.\r\n     * Used when nodes are dragged or the camera moves.\r\n     */\r\n    refresh() {\r\n        this.renderer.refreshNodeTransforms();\r\n    }\r\n\r\n    /** Draws all nodes in the workspace. Very heavy. */\r\n    drawAllNodes() {\r\n        for (let [nodeId, _] of this._nodeDB) {\r\n            this.drawNode(nodeId);\r\n        }\r\n    }\r\n\r\n    /** Redraws the entire workspace unless noRedraw is set. */\r\n    redraw() {\r\n        if (this.noRedraw) return;\r\n        this.renderer.clearScreen();\r\n        this.drawAllNodes();\r\n        this.refresh();\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n\r\n    /**\r\n     * Converts workspace coordinates to screen (SVG) coordinates.\r\n     * @param x - X position in workspace coordinates.\r\n     * @param y - Y position in workspace coordinates.\r\n     * @returns Screen coordinates as a Coordinates instance.\r\n     */\r\n    workspaceToScreen(workX: number, workY: number) {\r\n        const zoom = this.getZoom();\r\n        // _camera represents the top-left of the visible viewport in workspace coords\r\n        const x = (workX - this._camera.x) * zoom;\r\n        const y = (workY - this._camera.y) * zoom;\r\n        return { x, y };\r\n    }\r\n\r\n    /**\r\n     * Converts screen (SVG) coordinates to workspace coordinates.\r\n     * @param x - X position in screen coordinates.\r\n     * @param y - Y position in screen coordinates.\r\n     * @returns Workspace coordinates as a Coordinates instance.\r\n     */\r\n    screenToWorkspace(screenX: number, screenY: number) {\r\n        const zoom = this.getZoom();\r\n        const workX = screenX / zoom + this._camera.x;\r\n        const workY = screenY / zoom + this._camera.y;\r\n        return { x: workX, y: workY };\r\n    }\r\n\r\n    /**\r\n     * Draws a node by its ID.\r\n     * @param id - The ID of the node to render.\r\n     * @returns The rendered node.\r\n     */\r\n    drawNode(id: string) {\r\n        return this.renderer.rerenderNode(this._nodeDB.get(id) as NodeSvg);\r\n    }\r\n\r\n    /**\r\n     * Adds a node to the workspace.\r\n     * @param node - The node instance to add.\r\n     * @param nodeId - Optional custom ID to use instead of node.id.\r\n     */\r\n    addNode(node: NodeSvg, nodeId?: string) {\r\n        let id = nodeId || node.id;\r\n        if (this._nodeDB.has(id)) {\r\n            console.warn(`Node with id ${id} already exists, overwriting.`);\r\n        }\r\n        if (node.workspace !== this) {\r\n            node.workspace = this;\r\n        }\r\n        this._nodeDB.set(id, node);\r\n        this.drawNode(id);\r\n    }\r\n\r\n    /**\r\n     * Create a new node of *type*.\r\n     * @param type - The node's prototype name.\r\n     */\r\n    newNode(type: keyof typeof NodePrototypes): NodeSvg | undefined {\r\n        if (!NodePrototypes[type]) return;\r\n        const node = newHeadlessNode(type as string);\r\n        if (!node) return;\r\n        this.addNode(node);\r\n        return node;\r\n    }\r\n    /**\r\n     * Spawns a node at x, y of prototype type\r\n     * @param type - The node prototype name\r\n     * @param x - X position\r\n     * @param y - Y position\r\n     * @returns {Node} - The new node\r\n     */\r\n    spawnAt(type: keyof typeof NodePrototypes, x: number, y: number): NodeSvg | undefined {\r\n        const node = this.newNode(type);\r\n        if (!node) return;\r\n        node.relativeCoords.set(x, y);\r\n        this.drawNode(node.id);\r\n        return node;\r\n    }\r\n    /**\r\n     * Dereference a node from all of its connected neighbors\r\n     */\r\n    derefNode(node: NodeSvg) {\r\n        // Disconnect from previous node or field\r\n        const prev = node.previousConnection?.getFrom?.();\r\n        if (prev instanceof NodeSvg) {\r\n            prev.nextConnection?.disconnectTo();\r\n        } else if (prev instanceof ConnectableField && prev.hasConnectable()) {\r\n            prev.disconnect();\r\n        }\r\n\r\n        // Disconnect from next node\r\n        const next = node.nextConnection?.getTo?.();\r\n        if (next instanceof NodeSvg) {\r\n            next.previousConnection?.disconnectFrom();\r\n        }\r\n\r\n        // Disconnect all fields\r\n        for (let field of node.allFields()) {\r\n            if ((field as ConnectableField).hasConnectable?.()) {\r\n                (field as ConnectableField).disconnect();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Removes a node by its ID.\r\n     * @param id - The ID of the node to remove.\r\n     */\r\n    removeNodeById(id: string) {\r\n        const node = this._nodeDB.get(id);\r\n        if (!node) return;\r\n        this.derefNode(node);\r\n        this._nodeDB.delete(id);\r\n        this.redraw();\r\n    }\r\n\r\n    /**\r\n     * Removes a node by its instance.\r\n     * @param node - The node instance to remove.\r\n     */\r\n    removeNode(node: NodeSvg) {\r\n        if (!node) return;\r\n        this.removeNodeById(node.id);\r\n    }\r\n\r\n    /**\r\n     * Retrieves a node by its ID.\r\n     * @param id - The ID of the node.\r\n     * @returns The NodeSvg instance or undefined if not found.\r\n     */\r\n    getNode(id: string): NodeSvg | undefined {\r\n        return this._nodeDB.get(id);\r\n    }\r\n\r\n    /**\r\n     * Pans the camera by the given delta values.\r\n     * @param dx - Change in X direction.\r\n     * @param dy - Change in Y direction.\r\n     */\r\n    pan(dx: number, dy: number) {\r\n        this._camera.x += dx;\r\n        this._camera.y += dy;\r\n    }\r\n    /**\r\n     * Comment methods\r\n     */\r\n\r\n    /**\r\n     * Adds a comment, returns the model.\r\n     */\r\n    addComment() {\r\n        const model = new CommentModel(this);\r\n        this._commentDB.add(model);\r\n        this.redrawComments();\r\n        return model;\r\n    }\r\n    /**\r\n     * Gets a comment by id\r\n     * @param id - The comment id.\r\n     */\r\n    getComment(id: string) {\r\n        return Array.from(this._commentDB).find(e => e.id === id);\r\n    }\r\n    /**\r\n     * Remove a comment by its instance or id.\r\n     * @param commentOrId - The comment instance or its id.\r\n     */\r\n    removeComment(commentOrId: CommentModel | string) {\r\n        let comment: CommentModel | undefined;\r\n\r\n        if (typeof commentOrId === \"string\") {\r\n            comment = this.getComment(commentOrId);\r\n        } else {\r\n            comment = commentOrId;\r\n        }\r\n\r\n        if (!comment) return false;\r\n\r\n        this._commentDB.delete(comment);\r\n        this.redrawComments();\r\n        return true;\r\n    }\r\n    /**\r\n     * Redraw all comments in this workspace.\r\n     */\r\n    redrawComments() {\r\n        this.renderer.clearComments();\r\n        this.renderer.drawComments();\r\n    }\r\n    /**\r\n     * Deserialize this workspace from json data.\r\n     * @param json - Serialized workspace\r\n     */\r\n    fromJson(json: {nodes: any[], circular: boolean }) {\r\n        if (json.circular) {\r\n            for (let node of json.nodes) {\r\n                NodeSvg.deserialize(node, this);\r\n            }\r\n        } else {\r\n            for (let node of json.nodes) {\r\n                NodeSvg.fromJson(node, this);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Serialize this workspace, optionally using circular references.\r\n     */\r\n    toJson(circular: boolean) {\r\n        const nodes = [];\r\n        if (circular) {\r\n            for (let [id, node] of this._nodeDB) {\r\n                if (node.topLevel) {\r\n                    nodes.push(node.serialize());\r\n                }\r\n            }\r\n        } else {\r\n            for (let [id, node] of this._nodeDB) {\r\n                if (node.topLevel) {\r\n                    nodes.push(node.toJson());\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            circular,\r\n            nodes\r\n        }\r\n    }\r\n}\r\n\r\nexport default WorkspaceSvg;\r\n","// color-utils.ts\r\nimport type { Color, Hex } from '../src/visual-types';\r\n\r\n/**\r\n * Parse any Color type into a hex string \"#RRGGBB\"\r\n */\r\nexport function parseColor(color: Color): Hex {\r\n\tif (typeof color === 'string') {\r\n\t\tif (color.startsWith('#')) {\r\n\t\t\t// Already a hex string, normalize to full #RRGGBB\r\n\t\t\tlet hex = color.slice(1);\r\n\t\t\tif (hex.length === 3) hex = hex.split('').map(c => c + c).join('');\r\n\t\t\treturn `#${hex}`;\r\n\t\t} else {\r\n\t\t\t// RGB string \"r, g, b\"\r\n\t\t\tconst parts = color.split(',').map(s => parseInt(s.trim(), 10));\r\n\t\t\tif (parts.length !== 3) throw new Error(`Invalid RGB string: ${color}`);\r\n\t\t\tconst [r, g, b] = parts;\r\n            if (!r || !g || !b) {\r\n                console.warn(\r\n                    \"Invalid RGB tuple\"\r\n                );\r\n                return \"#000\";\r\n            }\r\n\t\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t\t.toString(16)\r\n\t\t\t\t.padStart(2, '0')}`;\r\n\t\t}\r\n\t} else if (Array.isArray(color)) {\r\n\t\t// RGBTuple [r,g,b]\r\n\t\tconst [r, g, b] = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t} else {\r\n\t\t// RGBObject {r,g,b}\r\n\t\tconst { r, g, b } = color;\r\n\t\treturn `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b\r\n\t\t\t.toString(16)\r\n\t\t\t.padStart(2, '0')}`;\r\n\t}\r\n}\r\n","// path.ts\r\n/**\r\n * Utility functions to generate SVG path strings or translate them.\r\n */\r\n\r\n/** Rounded rectangle */\r\nexport function roundedRect(width: number, height: number, radius: number): string {\r\n\tradius = Math.min(radius, width / 2, height / 2);\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tH${width - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width},${radius}\r\n\t\tV${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius},${height}\r\n\t\tH${radius}\r\n\t\tA${radius},${radius} 0 0 1 0,${height - radius}\r\n\t\tV${radius}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Rounded triangle pointing up */\r\nexport function roundedTri(width: number, height: number, radius: number): string {\r\n\tconst halfW = width / 2;\r\n\tradius = Math.min(radius, halfW, height / 2);\r\n\treturn `\r\n\t\tM${halfW},0\r\n\t\tL${width - radius},${height - radius}\r\n\t\tA${radius},${radius} 0 0 1 ${width - radius*2},${height}\r\n\t\tL${radius*2},${height}\r\n\t\tA${radius},${radius} 0 0 1 ${radius},${height - radius}\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Circle */\r\nexport function circle(radius: number): string {\r\n\treturn `\r\n\t\tM${radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${-radius},0\r\n\t\tA${radius},${radius} 0 1,0 ${radius},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Ellipse */\r\nexport function ellipse(rx: number, ry: number): string {\r\n\treturn `\r\n\t\tM${rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${-rx},0\r\n\t\tA${rx},${ry} 0 1,0 ${rx},0\r\n\t\tZ\r\n\t`.replace(/\\s+/g, ' ').trim();\r\n}\r\n\r\n/** Star with n points */\r\nexport function star(radius: number, points: number = 5): string {\r\n\tif (points < 2) throw new Error('Star must have at least 2 points');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / (points * 2);\r\n\tfor (let i = 0; i < points * 2; i++) {\r\n\t\tconst r = i % 2 === 0 ? radius : radius / 2;\r\n\t\tconst x = r * Math.sin(i * step);\r\n\t\tconst y = -r * Math.cos(i * step);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\n\r\n/** Regular polygon (triangle, pentagon, hexagon, etc) */\r\nexport function polygon(radius: number, sides: number = 3): string {\r\n\tif (sides < 3) throw new Error('Polygon must have at least 3 sides');\r\n\tlet path = '';\r\n\tconst step = (Math.PI * 2) / sides;\r\n\tfor (let i = 0; i < sides; i++) {\r\n\t\tconst x = radius * Math.cos(i * step - Math.PI / 2);\r\n\t\tconst y = radius * Math.sin(i * step - Math.PI / 2);\r\n\t\tpath += i === 0 ? `M${x},${y}` : ` L${x},${y}`;\r\n\t}\r\n\tpath += ' Z';\r\n\treturn path;\r\n}\r\nimport SvgPath from 'svgpath';\r\n\r\n/**\r\n * Rotate an SVG path string around a given point\r\n * @param path - SVG path string\r\n * @param angle - rotation angle in degrees\r\n * @param cx - x-coordinate of rotation center (default 0)\r\n * @param cy - y-coordinate of rotation center (default 0)\r\n * @returns new rotated SVG path string\r\n */\r\nexport function rotatePath(path: string, angle: number, cx = 0, cy = 0): string {\r\n\treturn new SvgPath(path)\r\n\t\t.rotate(angle, cx, cy)\r\n\t\t.toString();\r\n}\r\n","'use strict';\n\n\nvar Matrix = require('./matrix');\n\nvar operations = {\n  matrix: true,\n  scale: true,\n  rotate: true,\n  translate: true,\n  skewX: true,\n  skewY: true\n};\n\nvar CMD_SPLIT_RE    = /\\s*(matrix|translate|scale|rotate|skewX|skewY)\\s*\\(\\s*(.+?)\\s*\\)[\\s,]*/;\nvar PARAMS_SPLIT_RE = /[\\s,]+/;\n\n\nmodule.exports = function transformParse(transformString) {\n  var matrix = new Matrix();\n  var cmd, params;\n\n  // Split value into ['', 'translate', '10 50', '', 'scale', '2', '', 'rotate',  '-45', '']\n  transformString.split(CMD_SPLIT_RE).forEach(function (item) {\n\n    // Skip empty elements\n    if (!item.length) { return; }\n\n    // remember operation\n    if (typeof operations[item] !== 'undefined') {\n      cmd = item;\n      return;\n    }\n\n    // extract params & att operation to matrix\n    params = item.split(PARAMS_SPLIT_RE).map(function (i) {\n      return +i || 0;\n    });\n\n    // If params count is not correct - ignore command\n    switch (cmd) {\n      case 'matrix':\n        if (params.length === 6) {\n          matrix.matrix(params);\n        }\n        return;\n\n      case 'scale':\n        if (params.length === 1) {\n          matrix.scale(params[0], params[0]);\n        } else if (params.length === 2) {\n          matrix.scale(params[0], params[1]);\n        }\n        return;\n\n      case 'rotate':\n        if (params.length === 1) {\n          matrix.rotate(params[0], 0, 0);\n        } else if (params.length === 3) {\n          matrix.rotate(params[0], params[1], params[2]);\n        }\n        return;\n\n      case 'translate':\n        if (params.length === 1) {\n          matrix.translate(params[0], 0);\n        } else if (params.length === 2) {\n          matrix.translate(params[0], params[1]);\n        }\n        return;\n\n      case 'skewX':\n        if (params.length === 1) {\n          matrix.skewX(params[0]);\n        }\n        return;\n\n      case 'skewY':\n        if (params.length === 1) {\n          matrix.skewY(params[0]);\n        }\n        return;\n    }\n  });\n\n  return matrix;\n};\n","import WorkspaceController from './base';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WASDController extends WorkspaceController {\r\n\tmoveSpeed: number;\r\n\tdoAccelerate?: boolean;\r\n\taccelSpeed: number;\r\n\tfriction: number;\r\n\tvelocity: Vec2;\r\n    zoom: number = 1;\r\n\tzoomSpeed: number;\r\n\tminZoom: number;\r\n\tmaxZoom: number;\r\n\r\n\tconstructor(workspace: WorkspaceSvg, moveSpeed?: number) {\r\n\t\tsuper(workspace);\r\n\t\tthis.moveSpeed = workspace.options.moveSpeed || moveSpeed || 5;\r\n\r\n\t\tthis.doAccelerate = workspace.options?.controls?.wasdSmooth ?? false;\r\n\t\tthis.accelSpeed = workspace.options?.controls?.wasdAccelerate ?? 0.2;\r\n\t\tthis.friction = workspace.options?.controls?.wasdFriction ?? 0.85;\r\n\r\n\t\tthis.velocity = { x: 0, y: 0 };\r\n\r\n\t\t// Zoom settings\r\n\t\tthis.zoomSpeed = workspace.options?.controls?.zoomSpeed ?? 0.1;\r\n\t\tthis.minZoom = workspace.options?.controls?.minZoom ?? 0.1;\r\n\t\tthis.maxZoom = workspace.options?.controls?.maxZoom ?? 4;\r\n        this.zoom = 1;\r\n\t\t// Bind wheel for zoom\r\n\t\tworkspace._wsTop.addEventListener('wheel', this.onWheel.bind(this), { passive: false });\r\n\t}\r\n\r\n\tcanMove() {\r\n\t\treturn !userState.hasState('typing');\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tsuper.update();\r\n\t\tif (!this.canMove()) return;\r\n\r\n\t\tlet inputX = 0;\r\n\t\tlet inputY = 0;\r\n\r\n\t\tif (this.keysDown.has('w') || this.keysDown.has('ArrowUp')) inputY -= 1;\r\n\t\tif (this.keysDown.has('s') || this.keysDown.has('ArrowDown')) inputY += 1;\r\n\t\tif (this.keysDown.has('a') || this.keysDown.has('ArrowLeft')) inputX -= 1;\r\n\t\tif (this.keysDown.has('d') || this.keysDown.has('ArrowRight')) inputX += 1;\r\n\r\n\t\tif (this.doAccelerate) {\r\n\t\t\t// Accelerate velocity towards input direction\r\n\t\t\tthis.velocity.x += inputX * this.accelSpeed;\r\n\t\t\tthis.velocity.y += inputY * this.accelSpeed;\r\n\r\n\t\t\t// Apply friction\r\n\t\t\tthis.velocity.x *= this.friction;\r\n\t\t\tthis.velocity.y *= this.friction;\r\n\r\n\t\t\t// Only pan if velocity is noticeable\r\n\t\t\tif (Math.abs(this.velocity.x) > 0.01 || Math.abs(this.velocity.y) > 0.01) {\r\n\t\t\t\tthis.pan(this.velocity.x, this.velocity.y);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Instant movement\r\n\t\t\tconst dx = inputX * this.moveSpeed;\r\n\t\t\tconst dy = inputY * this.moveSpeed;\r\n\t\t\tif (dx !== 0 || dy !== 0) this.pan(dx, dy);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles wheel events for zooming.\r\n\t * Zooms around the mouse position for intuitive zooming.\r\n\t */\r\n\tonWheel(e: WheelEvent) {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst oldZoom = this.getZoom();\r\n\t\tlet delta = -e.deltaY * this.zoomSpeed * 0.01; // normalize wheel\r\n\t\tlet newZoom = oldZoom * (1 + delta);\r\n\r\n\t\t// Clamp zoom\r\n\t\tnewZoom = Math.max(this.minZoom, Math.min(this.maxZoom, newZoom));\r\n\r\n\t\t// Zoom around cursor\r\n\t\tconst mouseX = e.clientX;\r\n\t\tconst mouseY = e.clientY;\r\n\r\n\t\tconst wsMouse = this.workspace.screenToWorkspace(mouseX, mouseY);\r\n\r\n\t\t// Apply new zoom\r\n\t\tthis.setZoom(newZoom);\r\n\r\n\t\t// Adjust camera so the point under cursor stays stable\r\n\t\tthis.workspace._camera.x = wsMouse.x - mouseX / newZoom;\r\n\t\tthis.workspace._camera.y = wsMouse.y - mouseY / newZoom;\r\n\r\n\t\tthis.workspace.refresh();\r\n\t}\r\n\r\n\t/** Returns current zoom level */\r\n\tgetZoom() {\r\n\t\treturn this.zoom;\r\n\t}\r\n\r\n\t/** Sets zoom directly */\r\n\tsetZoom(zoom: number) {\r\n\t\tthis.zoom = zoom;\r\n\t}\r\n}\r\n","import { Element, Svg } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport Renderer, { ConnectorToFrom, DrawState } from '../renderers/renderer';\r\n\r\nfunction initConnectionLine(element: Element, args: Record<string, any>): () => void {\r\n    // click destroys the line\r\n    const handleClick = () => {\r\n        args.fromConn.disconnectTo();\r\n        args.toConn.disconnectFrom();\r\n        element.remove();\r\n        xMark.remove();\r\n        const remove: ConnectorToFrom[] = [];\r\n        for (let state of args.renderer._drawStates as DrawState[]) {\r\n            for (let pair of state.pendingConnections) {\r\n                if (pair.from == args.fromConn && pair.to == args.toConn) {\r\n                    remove.push(pair);\r\n                }\r\n                if (pair.from = args.toConn && pair.to == args.fromConn) {\r\n                    remove.push(pair);\r\n                }\r\n            }\r\n            state.pendingConnections = state.pendingConnections.filter(e => !remove.includes(e));\r\n        }\r\n    };\r\n\r\n    // create X element\r\n    const bbox = element.bbox();\r\n    const midX = bbox.x + bbox.width / 2;\r\n    const midY = bbox.y + bbox.height / 2;\r\n    const xMark = (element.parent()! as Svg).text('X').font({\r\n        family: 'Arial, Helvetica, sans-serif',\r\n        size: 46,\r\n        weight: 'bold',\r\n        anchor: 'middle',\r\n        leading: '1em'\r\n    })\r\n        .addClass((args.renderer.constructor as typeof Renderer).LINE_X_MARK_TAG)\r\n        .center(midX, midY)\r\n        .fill('#fff')           // white fill\r\n        .stroke({ color: '#000', width: 2 })  // black outline\r\n        .hide();\r\n\r\n    xMark.on('click', handleClick)\r\n    xMark.node.style.userSelect = 'none';\r\n    // show X on hover\r\n    element.on('mouseover', () => xMark.show());\r\n    element.on('mouseout', () => xMark.hide());\r\n\r\n    // attach click event\r\n    element.on('click', handleClick);\r\n\r\n    // cleanup function\r\n    return () => {\r\n        element.off('click', handleClick);\r\n        element.off('mouseover');\r\n        element.off('mouseout');\r\n        xMark.off('click', handleClick);\r\n        xMark.remove();\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_connline', initConnectionLine as EventSetupFn);\r\n","import Connection, { Connectable } from \"./connection\";\r\nimport { G, Path, Rect, Svg, SVG, Text } from '@svgdotjs/svg.js';\r\nimport NodeSvg from \"./nodesvg\";\r\nimport { ConnectorToFrom } from \"../renderers/renderer\";\r\nimport dropdownContainer, { DropdownOptions } from \"./dropdown-menu\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n/**\r\n * Options used to initialize a Field.\r\n */\r\nexport interface FieldOptions {    /** Name of the field */\r\n    name: string;\r\n    /** Human-readable label for the field */\r\n    label: string;\r\n    /** Key used to identify the field type in FieldTypesMap */\r\n    type: string;\r\n    /** Field value (optional) */\r\n    value?: any;\r\n    /** Only used by OptConnectField to determine internal value type */\r\n    fld_type?: \"number\" | \"string\";\r\n    [key: string]: any;\r\n};\r\n\r\nexport interface FieldVisualInfo {\r\n    measuredWidth: number; // The width approximated by the field itself.\r\n    measuredHeight: number; // The height approximated by the field itself.\r\n    background: Rect; // The node's background element.\r\n    svg: Svg; // The workspace's SVG.js svg\r\n    nodeGroup: G; // Group for the node\r\n    fieldGroup: G; // A group containing the label & input.\r\n    xUsed: number; // The amount of x space used up by the label.\r\n}\r\nexport interface FieldRawBoxData {\r\n    box: Rect;\r\n    txt: Text;\r\n}\r\nexport interface FieldConnectionData {\r\n    connector: Path;\r\n    connState: ConnectorToFrom\r\n}\r\n/**\r\n * Base class for all fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nclass Field<T = any> {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n    protected value: T | null;\r\n    static register(name: string, cls: Function) { };\r\n    static unregister(name: string) { };\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.value = null;\r\n        this.editable = true;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n        if (json.value !== undefined) this.value = json.value;\r\n        if (json.editable) this.setEditable(Boolean(json.editable));\r\n    }\r\n\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: null, height: null }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /** @returns The stored value */\r\n    getValue(): T | null {\r\n        return this.value;\r\n    }\r\n\r\n    /**\r\n     * Set the stored value\r\n     * @param val New value\r\n     */\r\n    setValue(val: T) {\r\n        this.value = val;\r\n    }\r\n\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue(): T | null {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Used when you want just a label with no actual value. Any value related methods are no-op.\r\n */\r\nexport class DummyField {\r\n    label: string;\r\n    name: string;\r\n    type: string;\r\n    node?: NodeSvg;\r\n    editable: boolean;\r\n    svgGroup?: G;\r\n\r\n    constructor() {\r\n        this.label = '';\r\n        this.name = '';\r\n        this.type = '';\r\n        this.editable = false;\r\n    }\r\n    onDraw(rawBox?: FieldRawBoxData, connectionBubble?: FieldConnectionData) {\r\n\r\n    }\r\n    canEditConnector() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Set whether or not you can edit this field.\r\n     * @param val - The value to set to.\r\n     */\r\n    setEditable(val: boolean) {\r\n        this.editable = val;\r\n        if (this.node) {\r\n            this.node?.workspace?.renderer?.rerenderNode?.(this.node)\r\n        }\r\n    }\r\n    /**\r\n     * Ask whether or not we can edit this field.\r\n     */\r\n    canEdit() {\r\n        return this.editable;\r\n    }\r\n    /**\r\n     * Set field name to something else.\r\n     * @param name string\r\n     * @returns the new name.\r\n     */\r\n    setName(name: string) {\r\n        return this.name = name;\r\n    }\r\n    /**\r\n     * Initialize the field from JSON options.\r\n     * @param json FieldOptions object\r\n     */\r\n    fromJson(json: FieldOptions) {\r\n        if (json.name !== undefined) this.name = json.name;\r\n        if (json.label !== undefined) this.label = json.label;\r\n        if (json.type !== undefined) this.type = json.type;\r\n    }\r\n    /** @returns Whether this field is a raw value field (text/number) */\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** @returns Whether this field supports connections */\r\n    hasConnectable(): boolean {\r\n        return false;\r\n    }\r\n    /** @returns The field's name/key */\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    /** @returns The human-readable label */\r\n    getLabel(): string {\r\n        return this.label;\r\n    }\r\n    /**\r\n     * Set the human-readable label\r\n     * @param label New label\r\n     * @returns The updated label\r\n     */\r\n    setLabel(label: string): string {\r\n        return this.label = label;\r\n    }\r\n    /** @returns Whether we have a custom editor/input look */\r\n    isCustomEditor(): boolean {\r\n        return false;\r\n    }\r\n    /**\r\n     * Make the input's custom look.\r\n     * @param fieldVisualInfo - The visual info of the field, mutate this if needed.\r\n     */\r\n    drawMyself(fieldVisualInfo: FieldVisualInfo) {\r\n        return;\r\n    }\r\n    /** Return width & height of your field's custom editor */\r\n    measureMyself() {\r\n        return { width: 0, height: 0 }; // if either is null then the renderer measures for us (meaning we have a connection or other type of raw field.)\r\n    }\r\n    /**\r\n     * Dummy fields have no value.\r\n     * @returns {null}\r\n     */\r\n    getValue() {\r\n        return null;\r\n    }\r\n    /**\r\n     * No-op for dummy fields\r\n     */\r\n    setValue(_: any) { }\r\n    /** @returns The value as it should be displayed (can differ from internal value) */\r\n    getDisplayValue() {\r\n        return this.getValue();\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return {\r\n            name: this.name,\r\n            label: this.label,\r\n            type: this.type,\r\n            value: this.getValue()\r\n        };\r\n    }\r\n}\r\n/**\r\n * Base class for fields that can be connected to other fields.\r\n * @template T The type of the value stored in the field\r\n */\r\nexport class ConnectableField<T = any> extends Field<T> {\r\n    connection: Connection;\r\n\r\n    constructor() {\r\n        super();\r\n        this.connection = new Connection(this, null);\r\n        this.value = null as T;\r\n    }\r\n    hasConnectable(): boolean {\r\n        return true;\r\n    }\r\n\r\n    hasRaw(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** Disconnect this field from any connected Connectable */\r\n    disconnect() {\r\n        const to = this.connection.to;\r\n        if (to instanceof NodeSvg && to?.previousConnection?.from) {\r\n            to.previousConnection.from = null;\r\n            this.connection.to = null;\r\n        }\r\n    }\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        super.fromJson(json);\r\n\r\n        // If the value is a serialized node, rebuild it\r\n        if (json.value && typeof json.value === \"object\" && json.value.id) {\r\n            this.value = NodeSvg._deserialize(json.value, {}, workspace) as any;\r\n            this.connection.setTo(this.value as Connectable);\r\n        } else if (json.value instanceof NodeSvg) {\r\n            this.value = json.value as any;\r\n            this.connection.setTo(this.value as Connectable);\r\n        } else {\r\n            this.value = json.value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: alreadyProcessed[val.id] ? (deep ? alreadyProcessed[val.id] : val.id) : val.serialize(alreadyProcessed) };\r\n\r\n        return {\r\n            ...super.toJson(true, alreadyProcessed),\r\n            value: val\r\n        };\r\n    }\r\n}\r\n\r\n/** Field storing a numeric value */\r\nexport class NumberField extends Field<number> {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        if (json.value !== undefined) this.setValue(Number(json.value));\r\n    }\r\n    setValue(val: number) {\r\n        this.value = Number(val);\r\n    }\r\n}\r\n\r\n/** Field storing a string value */\r\nexport class TextField extends Field<string> {\r\n    constructor() {\r\n        super();\r\n    }\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        if (json.value !== undefined) this.setValue(String(json.value));\r\n    }\r\n    setValue(val: string) {\r\n        this.value = String(val);\r\n    }\r\n}\r\n\r\n/**\r\n * Optional connectable field.\r\n * Can store either a number or string depending on fld_type.\r\n */\r\nexport class OptConnectField extends ConnectableField<number | string | NodeSvg> {\r\n    fldType: \"number\" | \"string\";\r\n\r\n    constructor() {\r\n        super();\r\n        this.fldType = \"string\";\r\n    }\r\n    canEditConnector(): boolean {\r\n        return true;\r\n    }\r\n    canEdit() {\r\n        if (this.getValue() instanceof NodeSvg) {\r\n            return false;\r\n        }\r\n        return this.editable;\r\n    }\r\n    getValue(): string | number | NodeSvg | null {\r\n        if (this.connection && this.connection.getTo()) {\r\n            return this.connection.getTo() as NodeSvg;\r\n        } else {\r\n            return this.value;\r\n        }\r\n    }\r\n    hasRaw() {\r\n        return true;\r\n    }\r\n    hasConnectable() {\r\n        return true;\r\n    }\r\n    /**\r\n     * Set field type.\r\n     * @param type \"number\"|\"string\"\r\n     */\r\n    setFieldType(type: \"number\" | \"string\") {\r\n        this.fldType = type;\r\n    }\r\n    /**\r\n     * Initialize from JSON, respecting fld_type\r\n     * @param json FieldOptions\r\n     */\r\n    fromJson(json: FieldOptions, workspace?: WorkspaceSvg) {\r\n        super.fromJson(json, workspace);\r\n        this.fldType = json.fld_type || \"string\";\r\n        if (this.value != null && typeof this.value === this.fldType) {\r\n            this.setValue(this.value as number | string);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set the value, converting to number or string depending on fld_type\r\n     * @param val The new value\r\n     */\r\n    setValue(val: number | string) {\r\n        if (this.fldType === \"number\") this.value = Number(val);\r\n        else this.value = String(val);\r\n    }\r\n\r\n    /**\r\n     * @returns Display value for UI purposes (never null)\r\n     */\r\n    getDisplayValue(): string {\r\n        if (this.value == null) return this.fldType === \"number\" ? \"0\" : \"\";\r\n        if (this.getValue() instanceof NodeSvg) return '[NODE]'; // If theres a connection\r\n        return String(this.value);\r\n    }\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        let val: any = this.getValue();\r\n        // If it's connected to a node, store it's serialized form.\r\n        if (val instanceof NodeSvg) val = { node: deep ? val.serialize(alreadyProcessed) : val.id };\r\n\r\n        return {\r\n            ...super.toJson(true, alreadyProcessed),\r\n            fld_type: this.fldType,\r\n            value: val\r\n        };\r\n    }\r\n}\r\nexport type DropdownItem = { text: string, value: string } | string\r\nexport class DropdownField extends Field<string> {\r\n    options: DropdownItem[] | null;\r\n    _selected: DropdownItem | null;\r\n    _isOpen: boolean;\r\n\r\n    constructor() {\r\n        super();\r\n        this.options = null;\r\n        this._selected = null;\r\n        this._isOpen = false;\r\n    }\r\n\r\n    onDraw(rawBox?: FieldRawBoxData) {\r\n        if (!rawBox || !this.options) return;\r\n\r\n        const { box, txt } = rawBox;\r\n        const toggle = () => this.toggleDropdown(rawBox);\r\n        box.click(toggle);\r\n        txt.click(toggle);\r\n    }\r\n\r\n    private toggleDropdown(rawBox: FieldRawBoxData) {\r\n        if (dropdownContainer.getOwner() === this) {\r\n            this.closeDropdown();\r\n        } else {\r\n            this.openDropdown(rawBox);\r\n        }\r\n        rawBox.txt.text(this.getDisplayValue());\r\n    }\r\n\r\n    private openDropdown(rawBox: FieldRawBoxData) {\r\n        if (!this.options) return;\r\n\r\n        const items = this.options.map(option => ({\r\n            label: typeof option === 'string' ? option : option.text,\r\n            value: typeof option === 'string' ? option : option.value\r\n        }));\r\n\r\n        dropdownContainer.show(this, {\r\n            items,\r\n            width: rawBox.box.bbox().width * 2,\r\n            onSelect: (value: string) => {\r\n                if (!this.options) return;\r\n                const original = this.options.find(\r\n                    e => e === value || (typeof e !== 'string' && e.value === value)\r\n                );\r\n                if (original) {\r\n                    this._selected = original;\r\n                    this.setValue(value);\r\n                    this.closeDropdown();\r\n                    this?.node?.workspace?.renderer?.rerenderNode?.(this.node);\r\n                }\r\n            }\r\n        } as DropdownOptions);\r\n    }\r\n\r\n    private closeDropdown() {\r\n        dropdownContainer.hideIfOwner(this);\r\n    }\r\n\r\n    canEdit() {\r\n        return false;\r\n    }\r\n\r\n    getSelected() {\r\n        return this._selected;\r\n    }\r\n    fromJson(json: FieldOptions) {\r\n        super.fromJson(json);\r\n        this.options = json.options as DropdownItem[] || null;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(typeof this._selected === 'string' ? this._selected : this._selected.value);\r\n    }\r\n\r\n    /**\r\n     * Display value of dropdowns.\r\n     * @returns - Display value\r\n     */\r\n    getDisplayValue(): string {\r\n        const text = typeof this._selected === 'string' ? this._selected : this._selected?.text || '';\r\n        const arrow = dropdownContainer.getOwner() == this ? '' : ''; // toggles open/closed\r\n        return text + '  ' + arrow;\r\n    }\r\n\r\n    /**\r\n     * Set options on this dropdown\r\n     * @param options - List of options\r\n     */\r\n    setOptions(options: DropdownItem[]) {\r\n        this.options = options;\r\n        this._selected = this.options?.[0] ?? null;\r\n        if (this._selected) this.setValue(\r\n            typeof this._selected === 'string' ? this._selected : this._selected.value\r\n        );\r\n    }\r\n    /**\r\n     * \r\n     * @param deep - Whether to recursive it.\r\n     * @param alreadyProcessed - Map of already serialized nodes.\r\n     * @returns - Json of this field.\r\n     */\r\n    toJson(deep: boolean, alreadyProcessed: { [key: string]: any }): FieldOptions {\r\n        return { ...super.toJson(deep, alreadyProcessed), options: this.options };\r\n    }\r\n}\r\n\r\n/**\r\n * Any field instance type\r\n */\r\nexport type AnyField = Field | OptConnectField | NumberField | TextField | DummyField | ConnectableField;\r\n/**\r\n * Any field class type\r\n */\r\nexport type AnyFieldCls = typeof Field | typeof OptConnectField | typeof ConnectableField | typeof NumberField | typeof TextField | typeof DummyField;\r\nexport const FieldMap: {\r\n    field_both: typeof OptConnectField;\r\n    field_string: typeof TextField;\r\n    field_num: typeof NumberField;\r\n    field_dummy: typeof DummyField;\r\n    field_str: typeof TextField;\r\n    connection: typeof ConnectableField;\r\n    [key: string]: AnyFieldCls;\r\n} = {\r\n    'field_both': OptConnectField,\r\n    'field_string': TextField,\r\n    'field_num': NumberField,\r\n    'field_dummy': DummyField,\r\n    'field_str': TextField,\r\n    'connection': ConnectableField,\r\n    'dropdown': DropdownField\r\n}\r\n\r\n\r\nexport default Field;\r\n","import type RendererType from \"../renderers/renderer\";\r\n\r\n/**\r\n * Interface for the renderer map.\r\n * Maps a string key (renderer name) to a renderer class.\r\n */\r\ninterface RendererMapInterface {\r\n\t[key: string]: typeof RendererType;\r\n}\r\n\r\n// Top-level renderer map storage\r\nconst RendererMap: RendererMapInterface = {};\r\n\r\n/**\r\n * Class for managing registered renderer classes.\r\n * Provides methods to register, delete, get, list, and resolve renderers.\r\n */\r\nclass RMap {\r\n\t/**\r\n\t * Registers a renderer class under a given name.\r\n\t * @param RendererCls The renderer class to register\r\n\t * @param optName Optional name to register under. Defaults to `RendererCls.NAME`\r\n\t */\r\n\tstatic register(RendererCls: typeof RendererType, optName?: string) {\r\n\t\tconst name = optName ?? RendererCls.NAME;\r\n\t\tRendererMap[name] = RendererCls;\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes a renderer from the map by name.\r\n\t * Cannot delete the \"default\" renderer.\r\n\t * @param name The name of the renderer to delete\r\n\t * @returns `true` if deleted, `false` otherwise\r\n\t */\r\n\tstatic delete(name: string) {\r\n\t\tif (name === 'default') return false;\r\n\t\tif (RendererMap[name]) {\r\n\t\t\tdelete RendererMap[name];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves a renderer class by name.\r\n\t * Returns the default renderer if the name is not found.\r\n\t * @param name The name of the renderer to get\r\n\t * @returns The renderer class\r\n\t */\r\n\tstatic get(name: string): typeof RendererType {\r\n\t\tconst Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n\t\treturn RendererMap[name] ?? RendererMap['default'] ?? Renderer;\r\n\t}\r\n\r\n\t/**\r\n\t * Lists all registered renderer names.\r\n\t * @returns Array of registered renderer names\r\n\t */\r\n\tstatic list() {\r\n\t\treturn Object.keys(RendererMap);\r\n\t}\r\n\r\n\t/**\r\n\t * Resolves input into a renderer class.\r\n\t * - If `input` is undefined, returns the default renderer\r\n\t * - If `input` is a string, returns the renderer with that name\r\n\t * - If `input` is a class, returns the class itself\r\n\t * @param input Optional renderer name or class\r\n\t * @returns Renderer class\r\n\t */\r\n\tstatic resolve(input?: string | typeof RendererType): typeof RendererType {\r\n\t\tconst Renderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\n\r\n\t\tif (!input) return RendererMap['default'] ?? Renderer;\r\n\r\n\t\tif (typeof input === 'string') return RMap.get(input);\r\n\r\n\t\tif (typeof input === 'function') return input as typeof RendererType;\r\n\r\n\t\treturn RendererMap['default'] ?? Renderer;\r\n\t}\r\n}\r\n\r\n// Pre-register default renderers\r\nconst DefaultRenderer = require(\"../renderers/renderer\").default as typeof RendererType;\r\nRendererMap['atlas'] = DefaultRenderer;\r\nRendererMap['default'] = DefaultRenderer;\r\n\r\nexport { RMap, RendererMap };\r\n","import { Element, G } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer, { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\n\r\nfunction initXButton(element: Element, args: Record<string, any>): () => void {\r\n\tconst xBtnGroup = element as G;\r\n\tconst ws: WorkspaceSvg = args.workspace;\r\n\r\n\t// click handler\r\n\tconst onClick = () => {\r\n\t\tws.removeNode(args.node);\r\n\t};\r\n\r\n\t// attach\r\n\txBtnGroup.on('click', onClick);\r\n\r\n\t// return cleanup function\r\n\treturn () => {\r\n\t\txBtnGroup.off('click', onClick);\r\n\t};\r\n}\r\n\r\n// register as Kabel event\r\neventer.registerEvent('k_closenode', initXButton as EventSetupFn);\r\n","import { Color, ColorStyle } from \"./visual-types\";\r\n\r\n/**\r\n * Stores color styles for node categories.\r\n * \r\n * Each key is a category name, and the value is a ColorStyle object\r\n * containing colors like primary, secondary, and tertiary.\r\n * \r\n * Example:\r\n * ```ts\r\n * CategoryColors[\"logic\"] = {\r\n *   primary: \"#FF0000\",\r\n *   secondary: \"#00FF00\",\r\n *   tertiary: \"#0000FF\"\r\n * };\r\n * ```\r\n */\r\nconst CategoryColors: { [key: string]: ColorStyle } = {};\r\n\r\nexport default CategoryColors;\r\n","'use strict';\n\n// combine 2 matrixes\n// m1, m2 - [a, b, c, d, e, g]\n//\nfunction combine(m1, m2) {\n  return [\n    m1[0] * m2[0] + m1[2] * m2[1],\n    m1[1] * m2[0] + m1[3] * m2[1],\n    m1[0] * m2[2] + m1[2] * m2[3],\n    m1[1] * m2[2] + m1[3] * m2[3],\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\n  ];\n}\n\n\nfunction Matrix() {\n  if (!(this instanceof Matrix)) { return new Matrix(); }\n  this.queue = [];   // list of matrixes to apply\n  this.cache = null; // combined matrix cache\n}\n\n\nMatrix.prototype.matrix = function (m) {\n  if (m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0) {\n    return this;\n  }\n  this.cache = null;\n  this.queue.push(m);\n  return this;\n};\n\n\nMatrix.prototype.translate = function (tx, ty) {\n  if (tx !== 0 || ty !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, 0, 1, tx, ty ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.scale = function (sx, sy) {\n  if (sx !== 1 || sy !== 1) {\n    this.cache = null;\n    this.queue.push([ sx, 0, 0, sy, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.rotate = function (angle, rx, ry) {\n  var rad, cos, sin;\n\n  if (angle !== 0) {\n    this.translate(rx, ry);\n\n    rad = angle * Math.PI / 180;\n    cos = Math.cos(rad);\n    sin = Math.sin(rad);\n\n    this.queue.push([ cos, sin, -sin, cos, 0, 0 ]);\n    this.cache = null;\n\n    this.translate(-rx, -ry);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewX = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, 0, Math.tan(angle * Math.PI / 180), 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\nMatrix.prototype.skewY = function (angle) {\n  if (angle !== 0) {\n    this.cache = null;\n    this.queue.push([ 1, Math.tan(angle * Math.PI / 180), 0, 1, 0, 0 ]);\n  }\n  return this;\n};\n\n\n// Flatten queue\n//\nMatrix.prototype.toArray = function () {\n  if (this.cache) {\n    return this.cache;\n  }\n\n  if (!this.queue.length) {\n    this.cache = [ 1, 0, 0, 1, 0, 0 ];\n    return this.cache;\n  }\n\n  this.cache = this.queue[0];\n\n  if (this.queue.length === 1) {\n    return this.cache;\n  }\n\n  for (var i = 1; i < this.queue.length; i++) {\n    this.cache = combine(this.cache, this.queue[i]);\n  }\n\n  return this.cache;\n};\n\n\n// Apply list of matrixes to (x,y) point.\n// If `isRelative` set, `translate` component of matrix will be skipped\n//\nMatrix.prototype.calc = function (x, y, isRelative) {\n  var m;\n\n  // Don't change point on empty transforms queue\n  if (!this.queue.length) { return [ x, y ]; }\n\n  // Calculate final matrix, if not exists\n  //\n  // NB. if you deside to apply transforms to point one-by-one,\n  // they should be taken in reverse order\n\n  if (!this.cache) {\n    this.cache = this.toArray();\n  }\n\n  m = this.cache;\n\n  // Apply matrix to point\n  return [\n    x * m[0] + y * m[2] + (isRelative ? 0 : m[4]),\n    x * m[1] + y * m[3] + (isRelative ? 0 : m[5])\n  ];\n};\n\n\nmodule.exports = Matrix;\n","import WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\ninterface Vec2 { x: number; y: number; }\r\n\r\nexport default class WorkspaceController {\r\n\tworkspace: WorkspaceSvg;\r\n\r\n\tkeysDown: Set<string>;\r\n\tmouseBtns: Set<number>;\r\n\tmousePos: Vec2;\r\n\tlastMousePos: Vec2;\r\n\tisDragging: boolean;\r\n\r\n\twheelDelta: number;\r\n\r\n\tprivate _updateInt: any;\r\n\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\r\n\t\tthis.keysDown = new Set();\r\n\t\tthis.mouseBtns = new Set();\r\n\t\tthis.mousePos = { x: 0, y: 0 };\r\n\t\tthis.lastMousePos = { x: 0, y: 0 };\r\n\t\tthis.isDragging = false;\r\n        this.wheelDelta = 0;\r\n\r\n\t\tthis._setupListeners();\r\n\r\n\t\tthis._updateInt = setInterval(() => this.update(), 16);\r\n\t}\r\n    getZoom() {\r\n        return 1;\r\n    }\r\n    canMove() {\r\n        return true;\r\n    }\r\n\tprivate _setupListeners() {\r\n\t\twindow.addEventListener('keydown', e => this.keysDown.add(e.key));\r\n\t\twindow.addEventListener('keyup', e => this.keysDown.delete(e.key));\r\n\r\n\t\twindow.addEventListener('mousedown', e => this.mouseBtns.add(e.button));\r\n\t\twindow.addEventListener('mouseup', e => this.mouseBtns.delete(e.button));\r\n\r\n\t\twindow.addEventListener('mousemove', e => {\r\n\t\t\tthis.lastMousePos = { ...this.mousePos };\r\n\t\t\tthis.mousePos = { x: e.clientX, y: e.clientY };\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('wheel', e => {\r\n\t\t\tthis.wheelDelta = e.deltaY;\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('mousedown', e => {\r\n\t\t\tif (e.button === 0) this.isDragging = true;\r\n\t\t});\r\n\t\twindow.addEventListener('mouseup', e => {\r\n\t\t\tif (e.button === 0) this.isDragging = false;\r\n\t\t});\r\n\t}\r\n\r\n\tupdate() {\r\n\t\t// Can handle keyboard shortcuts or auto-pan here\r\n\t}\r\n\r\n\t// --- Camera methods ---\r\n\tpan(dx: number, dy: number) {\r\n\t\tthis.workspace._camera.x += dx;\r\n\t\tthis.workspace._camera.y += dy;\r\n\t\tthis.refreshPos();\r\n\t}\r\n\r\n\tsetCamera(pos: Vec2) {\r\n\t\tthis.workspace._camera.x = pos.x;\r\n\t\tthis.workspace._camera.y = pos.y;\r\n\t\tthis.refreshPos();\r\n\t}\r\n\r\n\tcenterOn(pos: Vec2) {\r\n\t\tconst wsSize = this.workspace.getSize?.() ?? { width: 0, height: 0 };\r\n\t\tthis.setCamera({\r\n\t\t\tx: pos.x - wsSize.width / 2,\r\n\t\t\ty: pos.y - wsSize.height / 2\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\t// --- Coordinate conversion ---\r\n\tscreenToWorkspace(x: number, y: number): Vec2 {\r\n\t\tconst cam = this.workspace._camera;\r\n\t\treturn {\r\n\t\t\tx: x + cam.x,\r\n\t\t\ty: y + cam.y\r\n\t\t};\r\n\t}\r\n\r\n\tworkspaceToScreen(x: number, y: number): Vec2 {\r\n\t\tconst cam = this.workspace._camera;\r\n\t\treturn {\r\n\t\t\tx: (x - cam.x),\r\n\t\t\ty: (y - cam.y)\r\n\t\t};\r\n\t}\r\n\r\n\t// --- Refresh ---\r\n\trefreshPos() {\r\n\t\tthis.workspace.refresh?.();\r\n\t}\r\n\r\n\tredraw() {\r\n\t\tthis.workspace.redraw?.();\r\n\t}\r\n\r\n\t// --- Cleanup ---\r\n\tstop() {\r\n\t\tclearInterval(this._updateInt);\r\n\t}\r\n}\r\n","class Styler {\r\n\tprivate styles: Map<string, HTMLStyleElement>;\r\n\r\n\tconstructor() {\r\n\t\tthis.styles = new Map();\r\n\t}\r\n\r\n\tappendStyles(id: string, css: string): void {\r\n\t\tif (this.styles.has(id)) return; // Do not append if id exists\r\n\r\n\t\tconst styleEl = document.createElement('style');\r\n\t\tstyleEl.id = id;\r\n\t\tstyleEl.textContent = css;\r\n\t\tdocument.head.appendChild(styleEl);\r\n\t\tthis.styles.set(id, styleEl);\r\n\t}\r\n\r\n\tremoveStyles(id: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.remove();\r\n\t\tthis.styles.delete(id);\r\n\t}\r\n\r\n\tupdateStyles(id: string, css: string): void {\r\n\t\tconst styleEl = this.styles.get(id);\r\n\t\tif (!styleEl) return;\r\n\r\n\t\tstyleEl.textContent = css;\r\n\t}\r\n\r\n\thasStyles(id: string): boolean {\r\n\t\treturn this.styles.has(id);\r\n\t}\r\n}\r\nexport {\r\n    Styler\r\n}\r\nconst styler = new Styler();\r\nexport default styler;","import WorkspaceController from \"../controllers/base\";\r\nimport Renderer from \"../renderers/renderer\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport NodePrototypes from \"./prototypes\"; // Object\r\nimport { FieldOptions } from \"./field\";\r\nimport { Color } from \"./visual-types\";\r\nimport styler from '../util/styler';\r\n// @ts-ignore\r\nimport _kabelStyles from './styles.css';\r\n\r\nconst kabelStyles: string = _kabelStyles;\r\n\r\n/**\r\n * Represents a field in a toolbox node.\r\n * Can contain any extra properties as needed by the field type.\r\n */\r\nexport interface TblxFieldStruct {\r\n    /** Field value */\r\n    value: any;\r\n\r\n    /** Additional field-specific properties */\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents a node in a toolbox.\r\n */\r\nexport interface TblxNodeStruct {\r\n    /** Node type (matches NodePrototypes key or arbitrary string) */\r\n    type: keyof typeof NodePrototypes | string;\r\n\r\n    /** Map of field names to field data */\r\n    arguments: {\r\n        [key: string]: TblxFieldStruct;\r\n    };\r\n}\r\n\r\n/**\r\n * Represents a category in the toolbox, which contains multiple nodes.\r\n */\r\nexport interface TblxCategoryStruct {\r\n    /** Category name */\r\n    name: string;\r\n\r\n    /** Category color */\r\n    color: Color;\r\n\r\n    /** Nodes contained in this category */\r\n    contents: TblxNodeStruct[];\r\n}\r\n\r\n/**\r\n * Discriminated union type representing possible toolbox structures.\r\n * Can be a flyout (list of nodes) or a categorized toolbox.\r\n */\r\nexport type TblxObjStruct =\r\n    | {\r\n        /** Flyout toolbox type */\r\n        type: 'flyout';\r\n        contents: TblxNodeStruct[];\r\n    }\r\n    | {\r\n        /** Categorized toolbox type */\r\n        type?: 'category';\r\n        contents: TblxCategoryStruct[];\r\n    }\r\n    | {\r\n        /** When type is omitted, defaults to categories */\r\n        type?: undefined;\r\n        contents: TblxCategoryStruct[];\r\n    };\r\n\r\n/**\r\n * Options used when injecting a new workspace.\r\n */\r\nexport interface InjectOptions {\r\n    /** Optional renderer overrides */\r\n    rendererOverrides?: { [key: string]: any };\r\n\r\n    /** Optional custom controller class */\r\n    Controller?: typeof WorkspaceController;\r\n\r\n    /** Optional controls configuration */\r\n    controls?: {\r\n        zoomSpeed?: number;\r\n        minZoom?: number;\r\n        maxZoom?: number;\r\n        wasd?: boolean;\r\n        wasdSmooth?: boolean;\r\n        wasdAccelerate?: number;\r\n        wasdFriction?: number;\r\n    };\r\n\r\n    /** Optional toolbox structure */\r\n    toolbox?: TblxObjStruct;\r\n\r\n    /** Optional movement speed of the workspace */\r\n    moveSpeed?: number;\r\n\r\n    /** Optional renderer: name string or class */\r\n    renderer?: string | typeof Renderer;\r\n}\r\n\r\n/**\r\n * Utility class for logging injection messages in a structured way.\r\n */\r\nexport class InjectMsg {\r\n    /** Message content */\r\n    msg: string;\r\n\r\n    /**\r\n     * Creates a new InjectMsg instance.\r\n     * @param msg - Message text\r\n     */\r\n    constructor(msg: string) {\r\n        this.msg = msg;\r\n    }\r\n\r\n    /** Log as error */\r\n    err() {\r\n        console.error(`Failed to inject workspace: ${this.msg}`);\r\n    }\r\n\r\n    /** Log as warning */\r\n    wrn() {\r\n        console.warn(`Inject warning: ${this.msg}`);\r\n    }\r\n\r\n    /** Log as info */\r\n    info() {\r\n        console.info(`Inject info: ${this.msg}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Injects a new Kabel workspace into the document.\r\n * Appends the workspace container to the given element (or element ID) and\r\n * sets it as the main workspace.\r\n *\r\n * @param element - HTMLElement or string ID to attach the workspace to\r\n * @param options - Optional InjectOptions to configure the workspace\r\n * @returns The newly created WorkspaceSvg instance, or undefined if injection failed\r\n */\r\nexport default function inject(\r\n    element: HTMLElement | string,\r\n    options: InjectOptions = {}\r\n): WorkspaceSvg | undefined {\r\n    // Apply global Kabel styles\r\n    styler.appendStyles('KabelStyles', kabelStyles);\r\n\r\n    const root =\r\n        typeof element === 'string'\r\n            ? document.querySelector(`#${element}`) as HTMLElement\r\n            : element as HTMLElement;\r\n\r\n    if (!root) {\r\n        new InjectMsg(`Document does not contain root element (Check element ID).`).err();\r\n        return;\r\n    }\r\n\r\n    if (!document.contains(root)) {\r\n        new InjectMsg(`Document does not contain root element.`).err();\r\n        return;\r\n    }\r\n\r\n    // Create workspace wrapper element\r\n    const wsTop = document.createElement('div');\r\n    wsTop.className = `KabelWorkspaceWrapper`;\r\n    root.appendChild(wsTop);\r\n\r\n    // Initialize workspace\r\n    const ws = new WorkspaceSvg(root, wsTop, options);\r\n\r\n    // Set as the main workspace globally\r\n    setMainWorkspace(ws);\r\n\r\n    return ws;\r\n}\r\n","import { NodePrototype } from \"./node-types\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\n\r\n/**\r\n * Creates a new headless NodeSvg instance without attaching it to a workspace.\r\n * This is useful for programmatic node generation, testing, or serialization.\r\n *\r\n * @param type - The type of node to create. Must exist in NodePrototypes.\r\n * @returns The initialized NodeSvg instance, or `undefined` if the prototype does not exist.\r\n */\r\nfunction newHeadlessNode(type: string): NodeSvg | undefined {\r\n    const proto: NodePrototype = NodePrototypes[type as string] as NodePrototype;\r\n\r\n    // Return undefined if prototype not found\r\n    if (!proto) return;\r\n\r\n    // Create a new node instance\r\n    const node = new NodeSvg(proto);\r\n\r\n    // Initialize the node (calls prototype init, sets defaults)\r\n    node.init();\r\n\r\n    return node;\r\n}\r\n\r\nexport default newHeadlessNode;\r\n","import Connection, { Connectable } from \"./connection\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { ColorStyle, Color } from './visual-types';\r\nimport hasProp from '../util/has-prop';\r\nimport Field, { AnyField, AnyFieldCls, DummyField, FieldMap, FieldOptions } from \"./field\";\r\nimport CategoryColors from \"./colors\";\r\nimport Coordinates from \"./coordinates\";\r\nimport { generateUID } from \"../util/uid\";\r\nimport EventEmitter from '../util/emitter';\r\nimport { G } from \"@svgdotjs/svg.js\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport CommentModel from \"./comment\";\r\nimport { RepresenterNode } from '../renderers/representer-node';\r\nimport NodePrototypes from \"./prototypes\";\r\n/**\r\n * Represents the JSON structure used to initialize a field on a node.\r\n * Each field has a type, label, and name. Additional properties can be included for field-specific configuration.\r\n */\r\nexport interface InputFieldJson {\r\n    /** Human-readable label for the field, shown on the node UI */\r\n    label: string;\r\n\r\n    /** Field type identifier, corresponding to a field constructor in FieldMap */\r\n    type: string;\r\n\r\n    /** Unique field name within the node */\r\n    name: string;\r\n\r\n    /**\r\n     * Optional additional properties for field initialization.\r\n     * Can include type-specific options like min/max for number fields,\r\n     * default values, dropdown options, etc.\r\n     */\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents a JSON structure for initializing a NodeSvg instance.\r\n * Includes colors, connections, label, fields, category, and type information.\r\n */\r\nexport interface NodeJson {\r\n    /** Primary color of the node (e.g., top bar, main connections) */\r\n    primaryColor?: Color | undefined;\r\n\r\n    /** Secondary color of the node (e.g., field backgrounds) */\r\n    secondaryColor?: Color | undefined;\r\n\r\n    /** Tertiary color of the node (e.g., outlines) */\r\n    tertiaryColor?: Color | undefined;\r\n\r\n    /**\r\n     * Optional previous connection data.\r\n     * Presence triggers creation of a previous connection when initializing NodeSvg.\r\n     */\r\n    previousConnection?: any | undefined;\r\n\r\n    /**\r\n     * Optional next connection data.\r\n     * Presence triggers creation of a next connection when initializing NodeSvg.\r\n     */\r\n    nextConnection?: any | undefined;\r\n\r\n    /** Optional node label text to display */\r\n    labelText?: string | undefined;\r\n\r\n    /** Array of field definitions (InputFieldJson) to attach to this node */\r\n    arguments?: InputFieldJson[] | undefined;\r\n\r\n    /** Optional category name for color theming */\r\n    category?: string | undefined;\r\n\r\n    /** Node type identifier, used to look up the NodePrototype */\r\n    type: string;\r\n}\r\n\r\n/**\r\n * Represents a fully serialized node including its fields, colors, coordinates, connections, and optional comment.\r\n * Used for saving or transferring node data.\r\n */\r\nexport interface SerializedNode {\r\n    /** Node type string */\r\n    type: string;\r\n\r\n    /** Unique node ID */\r\n    id: string;\r\n\r\n    /** Display label of the node */\r\n    label: string;\r\n\r\n    /** Node colors including primary, secondary, tertiary, and category */\r\n    colors: ColorStyle;\r\n\r\n    /** Coordinates of the node relative to its workspace */\r\n    relativeCoords: { x: number; y: number };\r\n\r\n    /** Optional comment text attached to the node */\r\n    comment?: string | undefined;\r\n\r\n    /** Array of serialized fields, may contain any field-specific structure */\r\n    fields?: any[] | undefined;\r\n\r\n    /**\r\n     * Serialized representation of the previous connection.\r\n     * If `field` is true, the connection originates from a field rather than a node.\r\n     */\r\n    previousConnection?: { field?: boolean|undefined; node?: SerializedNode | undefined } | undefined;\r\n\r\n    /**\r\n     * Serialized representation of the next connection.\r\n     * If `field` is true, the connection originates from a field rather than a node.\r\n     */\r\n    nextConnection?: { field?: boolean|undefined; node?: SerializedNode | undefined } | undefined;\r\n}\r\n\r\n/**\r\n * NodeStyle represents the styling configuration of a node.\r\n * Includes ColorStyle properties plus optional renderer-specific constants and arbitrary additional fields.\r\n */\r\nexport type NodeStyle = ColorStyle &\r\n{\r\n    /** Optional renderer-specific constants from RendererConstants */\r\n    [key in keyof RendererConstants]?: RendererConstants[key];\r\n} &\r\n{\r\n    /** Any additional style properties supported by extensions or custom renderers */\r\n    [key: string]: any;\r\n};\r\n\r\n/**\r\n * Events emitted by NodeSvg instances.\r\n * Consumers can listen to these events to react to node lifecycle changes.\r\n */\r\nexport interface NodeEvents {\r\n    /** Triggered before the node is removed from the workspace */\r\n    \"REMOVING\": null;\r\n\r\n    /** Triggered immediately after node initialization */\r\n    \"INITING\": null;\r\n\r\n    /** Triggered while the node is being dragged */\r\n    \"NODE_DRAG\": null;\r\n}\r\n\r\n/**\r\n * Represents a node in the workspace.\r\n * Handles connections, fields, colors, serialization, and events.\r\n */\r\nclass NodeSvg extends EventEmitter<NodeEvents> {\r\n    /** The previous connection for this node (null if none) */\r\n    previousConnection: Connection | null;\r\n    /** The next connection for this node (null if none) */\r\n    nextConnection: Connection | null;\r\n    /** Node type string, usually derived from prototype */\r\n    type: string | null;\r\n    /** Prototype object providing behavior for this node */\r\n    prototype: NodePrototype | null;\r\n    /** Node color style object */\r\n    colors: NodeStyle;      // Node's color scheme\r\n    /** Displayed label text for this node */\r\n    labelText: string;       // Displayed node label\r\n    /** Set of fields attached to this node */\r\n    _fieldColumn: Set<AnyField>; // Stores attached fields\r\n    /** Node coordinates relative to workspace */\r\n    relativeCoords: Coordinates;\r\n    /** Unique node ID */\r\n    id: string;\r\n    /** SVG representation of this node */\r\n    svg?: RepresenterNode | object | null = null;\r\n    /** Workspace this node belongs to */\r\n    workspace: WorkspaceSvg | null = null;\r\n    /** Optional comment attached to this node */\r\n    comment: CommentModel | null\r\n    /** Event key: \"REMOVING\" */\r\n    static REMOVING: keyof NodeEvents = \"REMOVING\";\r\n\r\n    /** Event key: \"INITING\" */\r\n    static INITING: keyof NodeEvents = \"INITING\";\r\n    /**\r\n     * Creates a NodeSvg instance.\r\n     * @param prototype Optional NodePrototype to associate with this node.\r\n     * @param workspace Optional WorkspaceSvg this node belongs to.\r\n     * @param svgGroup Optional SVG group to attach node visuals.\r\n     */\r\n    constructor(prototype: NodePrototype | null, workspace?: WorkspaceSvg, svgGroup?: G) {\r\n        super();\r\n        this.type = null;\r\n        this.comment = null;\r\n        this.prototype = prototype;\r\n        this.colors = {\r\n            primary: '#000000',   // Topbar & connection color\r\n            secondary: '#000000', // Field & dropdown backgrounds\r\n            tertiary: '#000000', // Outline color\r\n            category: ''          // Node category name (optional)\r\n        };\r\n        this.previousConnection = new Connection(null, this, true); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.nextConnection = new Connection(this, null, false); //1st arg is from, 2nd is to, third is if this conn is prev\r\n        this.labelText = '';\r\n        this._fieldColumn = new Set();\r\n        this.relativeCoords = new Coordinates(0, 0);\r\n        this.id = generateUID('nanoid', { alphabet: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0129384756!)@(#*$&%^' });\r\n        if (workspace) {\r\n            this.workspace = workspace;\r\n        }\r\n        if (svgGroup) {\r\n            this.svg = new RepresenterNode(this, {\r\n                id: this.id,\r\n                pendingConnections: [],\r\n                group: svgGroup\r\n            }, workspace!.renderer)\r\n        }\r\n    }\r\n    /** Returns true if this node has no previous connection (i.e., top-level node) */\r\n    get topLevel() {\r\n        return !(this.previousConnection?.getFrom());\r\n    }\r\n    /** Returns the raw SVG group element if present */\r\n    get svgGroup() {\r\n        return (this.svg as RepresenterNode)?.getRaw?.();\r\n    }\r\n    /** Returns the text of the node's comment, if any */\r\n    getCommentText() {\r\n        return this.comment?.getText?.();\r\n    }\r\n    /** Returns the CommentModel instance for this node, if any */\r\n    getComment() {\r\n        return this.comment;\r\n    }\r\n    /** Adds a new comment to this node if none exists */\r\n    addComment() {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n            return;\r\n        }\r\n        console.warn('Comment already exists.')\r\n    }\r\n    /** Sets the text for the node's comment, creating one if needed */\r\n    setCommentText(text: string) {\r\n        if (!this.comment) {\r\n            this.comment = new CommentModel(this);\r\n        }\r\n        this.comment.setText(text);\r\n    }\r\n    /** Removes the comment from the node and triggers workspace redraw */\r\n    removeComment() {\r\n        this.comment = null;\r\n        this.workspace?.redrawComments?.();\r\n    }\r\n    /** Returns an array of all fields attached to this node */\r\n    allFields() {\r\n        return Array.from(this._fieldColumn);\r\n    }\r\n    /** Retrieves a field by name from this node */\r\n    getFieldByName(name: string): AnyField | null | undefined {\r\n        let field: AnyField | null | undefined = this.allFields().find(fld => fld.getName() === name);\r\n\r\n        return field;\r\n    }\r\n    /** Alias for getFieldByName */\r\n    getField(name: string): AnyField | null | undefined {\r\n        return this.getFieldByName(name);\r\n    }\r\n    /** Retrieves the current value of a field by name */\r\n    getFieldValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /** Retrieves the display value of a field by name */\r\n    getFieldDisplayValue(name: string): any | undefined {\r\n        const fld: AnyField | null | undefined = this.getFieldByName(name);\r\n        if (fld) {\r\n            return fld.getDisplayValue();\r\n        }\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Initiates the node, calling prototype methods.\r\n     */\r\n    init() {\r\n        this.emit(NodeSvg.INITING, null);\r\n        if (this.prototype) {\r\n            if (this.prototype.init) this.prototype.init.call(this, this.prototype, this);\r\n            if (this.workspace) {\r\n                this.workspace.addNode(this)\r\n            }\r\n            if (this.prototype.removed) {\r\n                this.on(NodeSvg.REMOVING, () => {\r\n                    this.prototype?.removed.call(this, this.prototype, this);\r\n                })\r\n            }\r\n        } else {\r\n            console.warn(`Node with id ${this.id} is missing a prototype.`)\r\n        }\r\n    }\r\n    /** Returns whether this node has a category style applied */\r\n    hasCategoryStyle() {\r\n        return !!this.colors?.category && this.colors?.category?.length > 0;\r\n    }\r\n\r\n    /** Returns the category name or null if none */\r\n    getCategoryName() {\r\n        return this.colors?.category || null;\r\n    }\r\n\r\n    /** Returns the node's current ColorStyle */\r\n    getStyle() {\r\n        return this.colors;\r\n    }\r\n\r\n    /** Internal helper: attach a field to this node */\r\n    _appendFieldItem(field: AnyField) {\r\n        if (!field) console.warn(\"Falsey field passed to _appendFieldItem.\");\r\n        this._fieldColumn.add(field);\r\n    }\r\n\r\n    /** Initialize node from a NodeJson object */\r\n    jsonInit(json: NodeJson) {\r\n        if (json.primaryColor) this.colors.primary = json.primaryColor;\r\n        if (json.secondaryColor) this.colors.secondary = json.secondaryColor;\r\n        if (json.tertiaryColor) this.colors.tertiary = json.tertiaryColor;\r\n\r\n        // Apply category colors if defined\r\n        if (json.category && CategoryColors[json.category]) {\r\n            const style: ColorStyle = CategoryColors[json.category] as ColorStyle;\r\n            Object.assign(this.colors, { category: json.category }, style);\r\n        }\r\n\r\n        this.previousConnection = hasProp(json, 'previousConnection') ? new Connection(null, this, true) : null;\r\n        this.nextConnection = hasProp(json, 'nextConnection') ? new Connection(this, null, false) : null;\r\n\r\n        if (json.labelText) this.labelText = json.labelText;\r\n        if (json.arguments) this.applyJsonArguments(json.arguments);\r\n        if (json.type) {\r\n            this.type = json.type;\r\n        }\r\n    }\r\n\r\n    /* JAVASCRIPT API */\r\n\r\n    /** Apply field definitions from a JSON-like array without full NodeJson */\r\n    applyJsonArguments(args: InputFieldJson[]) {\r\n        for (let field of args) {\r\n            if (!field.type || !field.name) {\r\n                console.warn(`Invalid argument definition at: ${args.indexOf(field)}.`);\r\n                continue;\r\n            }\r\n\r\n            const FieldConstructor: AnyFieldCls | undefined = FieldMap[field.type] as AnyFieldCls | undefined;\r\n            if (!FieldConstructor) {\r\n                console.warn(`Missing field constructor for ${field.type}!`);\r\n                continue;\r\n            }\r\n\r\n            const fld: AnyField = new FieldConstructor();\r\n            fld.fromJson(field); // initialize field\r\n            fld.node = this;\r\n            this._appendFieldItem(fld);\r\n        }\r\n        return this;\r\n    }\r\n    /** Appends a connection field to this node */\r\n    appendConnection(name: string): Field {\r\n        const fld = new (FieldMap['connection'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Appends a numeric input field to this node */\r\n    appendNumber(name: string): Field {\r\n        const fld = new (FieldMap['field_num'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Appends a text input field to this node */\r\n    appendText(name: string): Field {\r\n        const fld = new (FieldMap['field_str'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n\r\n    /** Appends a field that can hold a connection or raw value */\r\n    appendOptLink(name: string): Field {\r\n        const fld = new (FieldMap['field_both'])();\r\n        this._appendFieldItem(fld);\r\n        fld.setName(name);\r\n        fld.node = this;\r\n        return fld;\r\n    }\r\n    /** Sets the category name for the node */\r\n    setCategoryName(name: string) {\r\n        this.colors.category = name;\r\n        return this;\r\n    }\r\n    /** Applies a ColorStyle to the node */\r\n    setStyle(style: ColorStyle) {\r\n        // apply properties from style into this.colors\r\n        Object.assign(this.colors, style);\r\n        return this;\r\n    }\r\n\r\n    /** Sets primary, secondary, and tertiary colors for the node */\r\n    setColor(primary: Color, secondary: Color, tertiary: Color) {\r\n        this.setStyle({ primary, secondary, tertiary });\r\n        return this;\r\n    }\r\n    /** Sets the label text for the node */\r\n    setLabelText(text: string) {\r\n        this.labelText = text;\r\n        return this;\r\n    }\r\n\r\n    /** Add or replace a previous/next connection based on argument */\r\n    setConnection(prevOrNext: string | number | boolean) {\r\n        const stringed = String(prevOrNext).toLowerCase();\r\n        const cast = stringed == '0' ? 0 : (stringed == '1' ? 1 : (stringed == 'true' ? 1 : (stringed == 'false' ? 0 : 3)));\r\n\r\n        if (cast === 0) {\r\n            this.previousConnection = new Connection(null, this, true);\r\n        } else if (cast === 1) {\r\n            this.nextConnection = new Connection(this, null, false);\r\n        } else {\r\n            console.warn('Invalid prevOrNext argument for NodeSvg.setConnection');\r\n        }\r\n        return this;\r\n    }\r\n    /** Copies another NodeSvg into this node */\r\n    fromNode(other: NodeSvg) {\r\n        if (!other) return;\r\n\r\n        // Copy primitive props\r\n        this.type = other.type;\r\n        this.labelText = other.labelText;\r\n        this.relativeCoords = new Coordinates(other.relativeCoords.x, other.relativeCoords.y);\r\n\r\n        // Copy colors\r\n        this.colors = { ...other.colors };\r\n\r\n        // Copy connections\r\n        this.previousConnection = other.previousConnection\r\n            ? new Connection(null, this, true)\r\n            : null;\r\n        this.nextConnection = other.nextConnection\r\n            ? new Connection(this, null, false)\r\n            : null;\r\n\r\n        // Copy fields\r\n        this._fieldColumn.clear();\r\n        for (let field of other._fieldColumn) {\r\n            const FieldCls = field.constructor as AnyFieldCls;\r\n            const newField = (new FieldCls()) as any;\r\n\r\n            // Copy basic properties\r\n            newField.setName(field.getName());\r\n            if ('getValue' in field && 'setValue' in newField) {\r\n                newField.setValue(field.getValue());\r\n            }\r\n            if ('getLabel' in field && 'setLabel' in newField) {\r\n                newField.setLabel(field.getLabel())\r\n            }\r\n            this._appendFieldItem(newField);\r\n        }\r\n\r\n        // Copy workspace reference\r\n        this.workspace = other.workspace;\r\n\r\n        // Copy prototype reference\r\n        this.prototype = other.prototype;\r\n\r\n\r\n        return this;\r\n    }\r\n    /** Serializes a Connection object, handling fields and nested nodes */\r\n    _serializeConnection(\r\n        c: Connection,\r\n        alreadyProcessed: { [key: string]: SerializedNode }\r\n    ): { field?: boolean | undefined; node?: SerializedNode | undefined } {\r\n        const returned: { field?: boolean; node?: SerializedNode } = {};\r\n        let connected: NodeSvg | AnyField | null = c.isPrevious ? c.getFrom() : c.getTo();\r\n\r\n        if (!connected) return returned;\r\n\r\n        if (connected instanceof NodeSvg) {\r\n            // Avoid serializing the same node twice\r\n            if (alreadyProcessed[connected.id]) {\r\n                return { node: alreadyProcessed[connected.id] };\r\n            }\r\n            returned.node = connected.serialize(alreadyProcessed);\r\n        } else {\r\n            // Field serialization\r\n            const fld = connected as AnyField;\r\n            // If the field has a node, we serialize the node first\r\n            let fieldNode: SerializedNode | undefined;\r\n            if (fld.node) {\r\n                if (alreadyProcessed[fld.node.id]) {\r\n                    fieldNode = alreadyProcessed[fld.node.id];\r\n                } else {\r\n                    fieldNode = fld.node.serialize(alreadyProcessed);\r\n                }\r\n            }\r\n            returned.field = true;\r\n            if (fieldNode) returned.node = fieldNode;\r\n        }\r\n\r\n        return returned;\r\n    }\r\n\r\n    /**\r\n     * Serialize a node, this includes circular references. use toJson to avoid those.\r\n     * @param alreadyProcessed - Internal.\r\n     * @returns \r\n     */\r\n    serialize(alreadyProcessed: { [key: string]: SerializedNode } = {}): SerializedNode {\r\n        if (alreadyProcessed[this.id]) {\r\n            return alreadyProcessed[this.id] as SerializedNode;\r\n        }\r\n\r\n        // Put a placeholder in map *before* serializing connections\r\n        const serialized: SerializedNode = {\r\n            id: this.id,\r\n            type: this.type || '',\r\n            colors: { primary: this.colors.primary, secondary: this.colors.secondary, tertiary: this.colors.tertiary, category: this.colors.category } as ColorStyle,\r\n            label: this.labelText,\r\n            previousConnection: undefined,\r\n            nextConnection: undefined,\r\n            relativeCoords: { x: this.relativeCoords.x, y: this.relativeCoords.y },\r\n            comment: this.comment?.getText?.(),\r\n            fields: [], // fill after placeholder\r\n        };\r\n        alreadyProcessed[this.id] = serialized;\r\n\r\n        // Now safely fill in the heavy parts\r\n        serialized.fields = this.allFields().map(fld =>\r\n            fld.toJson\r\n                ? fld.toJson(true, alreadyProcessed)\r\n                : {\r\n                    name: fld.getName(),\r\n                    type: fld.constructor.name,\r\n                    value: fld.getValue ? fld.getValue() : undefined,\r\n                }\r\n        );\r\n\r\n        serialized.previousConnection = this.previousConnection\r\n            ? this._serializeConnection(this.previousConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        serialized.nextConnection = this.nextConnection\r\n            ? this._serializeConnection(this.nextConnection, alreadyProcessed)\r\n            : undefined;\r\n\r\n        return serialized;\r\n    }\r\n\r\n    /**\r\n     * Return a flattened version of the serialized node structure, which is non-circular.\r\n     * Any node reference inside connections or fields is replaced by its ID.\r\n     */\r\n    toJson(): {\r\n        [id: string]: Omit<SerializedNode, 'previousConnection' | 'nextConnection'> & {\r\n            previousConnection?: { field?: FieldOptions; node?: string };\r\n            nextConnection?: { field?: FieldOptions; node?: string };\r\n        }\r\n    } {\r\n        const serialized = this.serialize();\r\n        const flat: { [id: string]: any } = {};\r\n\r\n        const processNode = (node: SerializedNode) => {\r\n            if (flat[node.id]) return;\r\n\r\n            const copy: any = {\r\n                ...node,\r\n                previousConnection: node.previousConnection ? { ...node.previousConnection } : undefined,\r\n                nextConnection: node.nextConnection ? { ...node.nextConnection } : undefined,\r\n            };\r\n\r\n            flat[node.id] = copy;\r\n\r\n            // Handle connections\r\n            if (copy.previousConnection?.node) {\r\n                const prevNode = copy.previousConnection.node;\r\n                copy.previousConnection.node = prevNode.id;\r\n                processNode(prevNode);\r\n            }\r\n            if (copy.nextConnection?.node) {\r\n                const nextNode = copy.nextConnection.node;\r\n                copy.nextConnection.node = nextNode.id;\r\n                processNode(nextNode);\r\n            }\r\n\r\n            // Handle fields recursively\r\n            if (Array.isArray(copy.fields)) {\r\n                for (let fld of copy.fields) {\r\n                    if (fld.node) {\r\n                        processNode(fld.node);\r\n                        fld.node = fld.node.id;\r\n                    }\r\n                    for (let key in fld) {\r\n                        if (fld[key]?.node) {\r\n                            processNode(fld[key]?.node);\r\n                            fld[key].node = fld[key].node.id;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        processNode(serialized);\r\n        return flat;\r\n    }\r\n\r\n    /**\r\n      * Reconstruct a NodeSvg from a SerializedNode structure (handles circular references)\r\n      */\r\n    static _deserialize(\r\n        data: SerializedNode,\r\n        allNodes: { [id: string]: NodeSvg } = {},\r\n        workspace?: WorkspaceSvg\r\n    ): NodeSvg {\r\n        // If already created, return the existing instance\r\n        if (allNodes[data.id]) return allNodes[data.id] as NodeSvg;\r\n\r\n        // Create a new node with minimal prototype info (can be patched later)\r\n        const node = new NodeSvg(NodePrototypes[data.type] as NodePrototype, workspace);\r\n        node.id = data.id;\r\n        node.init();\r\n        node.type = data.type;\r\n        node.relativeCoords = new Coordinates(data.relativeCoords.x, data.relativeCoords.y);\r\n        node.labelText = data.label || '';\r\n        if (data.comment) {\r\n            node.setCommentText(data.comment);\r\n\r\n        }\r\n        // IMPORTANT: restore colors from serialized data (if present)\r\n        if (data.colors) {\r\n            // Start with category colors if a category is present and known\r\n            if (data.colors.category && CategoryColors[data.colors.category]) {\r\n                const style: ColorStyle = CategoryColors[data.colors.category] as ColorStyle;\r\n                Object.assign(node.colors, style, { category: data.colors.category });\r\n            }\r\n            // Then override with explicit serialized colors (primary/secondary/tertiary)\r\n            // This preserves explicit color values even when a category was saved\r\n            const explicit: Partial<ColorStyle> = {};\r\n            if (data.colors.primary) explicit.primary = data.colors.primary;\r\n            if (data.colors.secondary) explicit.secondary = data.colors.secondary;\r\n            if (data.colors.tertiary) explicit.tertiary = data.colors.tertiary;\r\n            if (data.colors.category) explicit.category = data.colors.category;\r\n            node.setStyle(explicit as ColorStyle);\r\n        }\r\n        // Register placeholder before deserializing connections to handle circular refs\r\n        allNodes[node.id] = node;\r\n\r\n        // Deserialize fields\r\n        if (Array.isArray(data.fields)) {\r\n            node._fieldColumn = new Set();\r\n            for (let fldData of data.fields) {\r\n                const FieldConstructor = FieldMap[fldData.type];\r\n                if (!FieldConstructor) continue;\r\n\r\n                const fld: AnyField = new FieldConstructor();\r\n                fld.fromJson(fldData, workspace); // ONLY fldData and workspace\r\n                fld.node = node;\r\n                node._appendFieldItem(fld);\r\n            }\r\n        }\r\n\r\n        // Deserialize previous/next connections\r\n        if (data.previousConnection?.node) {\r\n            node.previousConnection = new Connection(null, node, true);\r\n            node.previousConnection.setFrom(NodeSvg._deserialize(data.previousConnection.node, allNodes, workspace));\r\n        }\r\n\r\n        if (data.nextConnection?.node) {\r\n            node.nextConnection = new Connection(node, null, false);\r\n            node.nextConnection.setTo(NodeSvg._deserialize(data.nextConnection.node, allNodes, workspace));\r\n        }\r\n        workspace?.redraw();\r\n        return node;\r\n    }\r\n    /** Public: Deserialize a SerializedNode or plain object into a NodeSvg attached to a workspace */\r\n    static deserialize(json: SerializedNode | any, workspace: WorkspaceSvg) {\r\n        return this._deserialize(json as SerializedNode, {}, workspace);\r\n    }\r\n    /** Reconstructs nodes from a flattened JSON structure into a NodeSvg tree */\r\n    static fromJson(flat: Record<string, any>, workspace: WorkspaceSvg): any {\r\n        const nodes: Record<string, any> = {};\r\n\r\n        // shallow clone so we can safely mutate\r\n        for (const id in flat)\r\n            nodes[id] = { ...flat[id] };\r\n\r\n        // rebuild references\r\n        for (const id in nodes) {\r\n            const node = nodes[id];\r\n\r\n            // fix connection refs\r\n            if (node.previousConnection?.node) {\r\n                const refId = node.previousConnection.node as string;\r\n                node.previousConnection = {\r\n                    ...node.previousConnection,\r\n                    node: nodes[refId],\r\n                };\r\n            }\r\n            if (node.nextConnection?.node) {\r\n                const refId = node.nextConnection.node as string;\r\n                node.nextConnection = {\r\n                    ...node.nextConnection,\r\n                    node: nodes[refId],\r\n                };\r\n            }\r\n\r\n            // fix fields\r\n            if (Array.isArray(node.fields)) {\r\n                for (const fld of node.fields) {\r\n                    if (typeof fld.node === 'string')\r\n                        fld.node = nodes[fld.node];\r\n\r\n                    for (const key in fld) {\r\n                        const maybe = fld[key];\r\n                        if (maybe?.node && typeof maybe.node === 'string')\r\n                            maybe.node = nodes[maybe.node];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // the root is just the one w/ no previousConnection\r\n        const root = Object.values(nodes).find(n => !n.previousConnection?.node) ?? null;\r\n        return this._deserialize(root, {}, workspace);\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default NodeSvg;\r\n","import CommentModel from \"./comment\";\r\nimport { ContextMenuOpts, Showable } from \"./context-menu\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\n/** Registry for all context menu options */\r\nconst ContextOptsRegistry: ContextMenuOpts[] = [];\r\n\r\n/**\r\n * Global context menu manager\r\n */\r\nconst ContextMenu = {\r\n    /**\r\n     * Register a new context menu option\r\n     * @param id - Unique identifier for the option\r\n     * @param option - Configuration for the context menu item\r\n     */\r\n    registerOption(id: string, option: {\r\n        /** Callback when the option is clicked */\r\n        click: (target: NodeSvg | WorkspaceSvg | HTMLElement | CommentModel) => void;\r\n        /** Callback when hovering starts */\r\n        onHoverStart?: () => void;\r\n        /** Callback when hovering ends */\r\n        onHoverEnd?: () => void;\r\n        /** Label text for the menu item */\r\n        label: string;\r\n        /** Target type(s) the option should appear for */\r\n        showFor: Showable | Showable[];\r\n    }) {\r\n        const opt = {\r\n            id,\r\n            click: option.click,\r\n            label: option.label,\r\n            onHoverStart: option.onHoverStart || (() => { }),\r\n            onHoverEnd: option.onHoverEnd || (() => { }),\r\n            showFor: option.showFor || undefined\r\n        };\r\n        ContextOptsRegistry.push(opt);\r\n    },\r\n\r\n    /**\r\n     * Unregister an existing context menu option by ID\r\n     * @param id - ID of the option to remove\r\n     */\r\n    unregisterOption(id: string) {\r\n        const index = ContextOptsRegistry.findIndex(opt => opt.id === id);\r\n        if (index >= 0) ContextOptsRegistry.splice(index, 1);\r\n    }\r\n};\r\n\r\n// ----- Default options -----\r\n\r\nContextMenu.registerOption('k_delete', {\r\n    showFor: 'node',\r\n    label: 'Delete',\r\n    click: (t) => {\r\n        const target = t as NodeSvg;\r\n        if (!target.workspace) return;\r\n        target.workspace.removeNode(target);\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_deleteall', {\r\n    showFor: 'ws',\r\n    label: 'Delete all',\r\n    click: (t) => {\r\n        const target = t as WorkspaceSvg;\r\n        const isSure = window.confirm(`Are you sure you want to delete ${Array.from(target._nodeDB.keys()).length} nodes?`);\r\n        if (!isSure) return;\r\n        for (let [id, _] of target._nodeDB) {\r\n            target.removeNodeById(id);\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_addcomment', {\r\n    showFor: ['ws', 'node'],\r\n    label: 'Add Comment',\r\n    click: (t) => {\r\n        const target = t;\r\n        if (target instanceof NodeSvg) {\r\n            target.addComment();\r\n            target.setCommentText('Comment!');\r\n        } else if (target instanceof WorkspaceSvg) {\r\n            const model = target.addComment();\r\n            const pos = target.screenToWorkspace(target._ctxMenu.widget.coords.x, target._ctxMenu.widget.coords.y);\r\n            model.relativeCoords.set(pos.x, pos.y);\r\n            model.setText('Comment!');\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_deletecomment', {\r\n    showFor: 'comment',\r\n    label: 'Delete Comment',\r\n    click: (t) => {\r\n        const target = t as CommentModel;\r\n        if (target.isNodeComment() && target._parent instanceof NodeSvg) {\r\n            target._parent.removeComment();\r\n        } else {\r\n            target.getWorkspace().removeComment(target);\r\n        }\r\n    }\r\n});\r\n\r\nContextMenu.registerOption('k_duplicate', {\r\n    showFor: 'node',\r\n    label: 'Duplicate',\r\n    click: t => {\r\n        const node = t as NodeSvg;\r\n        if (!node.workspace) return;\r\n        node.workspace.cloneNode(node);\r\n    }\r\n});\r\n\r\nexport { ContextMenu };\r\nexport default ContextOptsRegistry;\r\n","type EventHandler<T = any> = (payload: T) => void;\r\n\r\nclass EventEmitter<Events extends Record<string, any>> {\r\n\tprivate listeners: { [K in keyof Events]?: EventHandler<Events[K]>[] } = {};\r\n\r\n\ton<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) this.listeners[event] = [];\r\n\t\tthis.listeners[event]!.push(handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tif (!this.listeners[event]) return this;\r\n\t\tthis.listeners[event] = this.listeners[event]!.filter(h => h !== handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\temit<K extends keyof Events>(event: K, payload: Events[K]) {\r\n\t\tif (!this.listeners[event]) return false;\r\n\t\tthis.listeners[event]!.forEach(handler => handler(payload));\r\n\t\treturn true;\r\n\t}\r\n\r\n\tonce<K extends keyof Events>(event: K, handler: EventHandler<Events[K]>) {\r\n\t\tconst wrapper = (payload: Events[K]) => {\r\n\t\t\thandler(payload);\r\n\t\t\tthis.off(event, wrapper);\r\n\t\t};\r\n\t\tthis.on(event, wrapper);\r\n\t\treturn this;\r\n\t}\r\n}\r\nexport default EventEmitter;","import Flyout from \"./flyout\";\r\nimport { InjectOptions, TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport Category from \"./category\";\r\n\r\n/**\r\n * Represents the toolbox in a Kabel workspace.\r\n * The toolbox can be either a flyout or a category-based toolbox.\r\n */\r\nclass Toolbox {\r\n\t/** Toolbox type: 1 = category toolbox, 2 = flyout toolbox */\r\n\ttype: 1 | 2;\r\n\r\n\t/** Reference to the workspace this toolbox belongs to */\r\n\tworkspace: WorkspaceSvg;\r\n\r\n\t/** Workspace options for initialization */\r\n\twsOptions: InjectOptions;\r\n\r\n\t/** Flyout instance for node display */\r\n\t_flyout: Flyout;\r\n\r\n\t/** Contents of the toolbox (nodes or categories) */\r\n\t_contents: TblxNodeStruct[] | TblxCategoryStruct[];\r\n\r\n\t/** DOM container element for the toolbox */\r\n\tcontainer: HTMLDivElement;\r\n\r\n\t/** List of categories (if using a category toolbox) */\r\n\t_categories: Category[] = [];\r\n\r\n\t/**\r\n\t * Creates a new Toolbox instance attached to a workspace.\r\n\t * @param workspace The workspace instance to attach this toolbox to\r\n\t */\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\t\tthis.wsOptions = this.getOptions();\r\n\t\tthis.type = this.wsOptions.toolbox?.type == \"flyout\" ? 2 : 1;\r\n\t\tthis._contents = this.wsOptions.toolbox?.contents ?? [];\r\n\r\n\t\t// Pass toolbox reference to flyout\r\n\t\tthis._flyout = new Flyout(this);\r\n\r\n\t\t// Create container element\r\n\t\tthis.container = document.createElement(\"div\");\r\n\t\tthis.container.className = \"KabelToolbox\";\r\n\t\tthis.container.style.position = \"absolute\";\r\n\t\tthis.container.style.left = \"0\";\r\n\t\tthis.container.style.top = \"0\";\r\n\t\tthis.container.style.width = \"20%\";\r\n\t\tthis.container.style.height = \"100%\";\r\n\t\tthis.container.style.background = \"rgba(240,240,240,0.9)\";\r\n\t\tthis.container.style.overflowY = \"auto\";\r\n\r\n\t\t// Append to workspace top layer\r\n\t\tworkspace._wsTop.appendChild(this.container);\r\n\r\n\t\t// Initialize toolbox depending on type\r\n\t\tif (this.type === 1) this.initCategoryToolbox();\r\n\t\tif (this.type === 2) this.initFlyoutToolbox();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the workspace options.\r\n\t * @returns The workspace's InjectOptions\r\n\t */\r\n\tgetOptions() {\r\n\t\treturn this.workspace.options;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes a category-based toolbox.\r\n\t * Converts the toolbox contents into Category instances and attaches them.\r\n\t */\r\n\tinitCategoryToolbox() {\r\n\t\tconst categories = this._contents as TblxCategoryStruct[];\r\n\t\tcategories.forEach(cData => {\r\n\t\t\tconst category = new Category(this, cData);\r\n\t\t\tthis._categories.push(category);\r\n\t\t});\r\n\r\n\t\t// Hide flyout when workspace is clicked\r\n\t\tthis.workspace.svg.on(\"click\", () => this._flyout.hide());\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes a flyout toolbox.\r\n\t * Fills the flyout with the node definitions from the toolbox contents.\r\n\t */\r\n\tinitFlyoutToolbox() {\r\n\t\tthis.container.style.display = \"none\";\r\n\t\tconst nodes = this._contents as TblxNodeStruct[];\r\n\t\tthis._flyout.fill(nodes);\r\n\t}\r\n}\r\n\r\nexport default Toolbox;\r\n","import WorkspaceSvg from \"./workspace-svg\";\r\n\r\n/**\r\n * Holds a reference to the main WorkspaceSvg instance.\r\n * Mimics Blockly's getMainWorkspace API for Kabel.\r\n */\r\nlet mainws: WorkspaceSvg | null = null;\r\n\r\n/**\r\n * Returns the current main workspace instance.\r\n * \r\n * @returns The main WorkspaceSvg or null if none is set.\r\n */\r\nfunction getMainWorkspace(): WorkspaceSvg | null {\r\n    return mainws;\r\n}\r\n\r\n/**\r\n * Sets the main workspace reference.\r\n * Calling this updates the global \"main workspace\" for Kabel.\r\n * \r\n * @param ws - The WorkspaceSvg instance to set as main, or null to clear.\r\n * @returns The workspace that was set.\r\n */\r\nfunction setMainWorkspace(ws: WorkspaceSvg | null) {\r\n    return (mainws = ws);\r\n}\r\n\r\n/**\r\n * Clears the main workspace reference.\r\n * After calling, getMainWorkspace() will return null.\r\n * \r\n * @returns Always returns null.\r\n */\r\nfunction clearMainWorkspace() {\r\n    return (mainws = null);\r\n}\r\n\r\nexport {\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n    clearMainWorkspace\r\n};\r\n\r\n/**\r\n * Note:\r\n * This mimics the Blockly.getMainWorkspace API.\r\n * When you inject a new workspace in Kabel, calling setMainWorkspace\r\n * sets the global main workspace reference, so you can easily retrieve it later.\r\n */\r\n","import { Element } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\n\r\nconst draggableStore: Record<string, { x: number, y: number }> = {};\r\n\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    let isDragging = false;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    // fallback to element itself if no drag handle is given\r\n    const dragTarget: Element = args.dragel ?? element;\r\n\r\n    // Restore position if previously stored (type 3)\r\n    if (args.type === 3 && args.id && draggableStore[args.id]) {\r\n        const pos = draggableStore[args.id];\r\n        if (pos) element.move(pos.x, pos.y);\r\n    }\r\n\r\n    function onMouseDown(e: MouseEvent) {\r\n        if (args.type === 2 && args.node) {\r\n            const ws = args.node.workspace;\r\n            if (!ws) return;\r\n\r\n            const start = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const nodePos = args.node.relativeCoords;\r\n\r\n            offsetX = start.x - nodePos.x;\r\n            offsetY = start.y - nodePos.y;\r\n        } else {\r\n            const bbox = element.bbox();\r\n            offsetX = e.clientX - bbox.x;\r\n            offsetY = e.clientY - bbox.y;\r\n        }\r\n\r\n        isDragging = false;\r\n\r\n        // Mark user as dragging\r\n        userState.setState('dragging');\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        if (args.type === 1 && args.ondrag) args.ondrag(e);\r\n    }\r\n\r\n\r\n    function onMouseMove(e: MouseEvent) {\r\n        if (!isDragging) {\r\n            const dx = e.movementX || 0;\r\n            const dy = e.movementY || 0;\r\n            if (Math.abs(dx) > 2 || Math.abs(dy) > 2) isDragging = true;\r\n        }\r\n        if (!isDragging) return;\r\n\r\n        if (args.type === 2 && args.node && args.node instanceof NodeSvg) {\r\n            const ws: WorkspaceSvg = args.node.workspace as WorkspaceSvg;\r\n            if (!ws) return;\r\n\r\n            // Compute new workspace coordinates\r\n            const mouseWS = ws.screenToWorkspace(e.clientX, e.clientY);\r\n            const newX = mouseWS.x - offsetX;\r\n            const newY = mouseWS.y - offsetY;\r\n\r\n            args.node.relativeCoords.set(newX, newY);\r\n            ws.refresh();\r\n            // Move node visually\r\n            const screenPos = ws.workspaceToScreen(newX, newY);\r\n            element.attr({ transform: `translate(${screenPos.x}, ${screenPos.y}) scale(${ws.getZoom()})` });\r\n\r\n            args.node.emit('NODE_DRAG', null);\r\n        } else if (args.type === 1 && args.onmove) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            args.onmove({ x: newX, y: newY });\r\n        } else if (args.type === 3 && args.id) {\r\n            const newX = e.clientX - offsetX;\r\n            const newY = e.clientY - offsetY;\r\n            element.move(newX, newY);\r\n            draggableStore[args.id] = { x: newX, y: newY };\r\n        }\r\n    }\r\n\r\n    function onMouseUp(e: MouseEvent) {\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n\r\n        // Remove dragging state\r\n        userState.removeState('dragging');\r\n\r\n        if (args.type === 1 && args.enddrag) args.enddrag(e);\r\n        isDragging = false;\r\n    }\r\n\r\n    dragTarget.node.addEventListener('mousedown', onMouseDown);\r\n\r\n    // cleanup\r\n    return () => {\r\n        dragTarget.node.removeEventListener('mousedown', onMouseDown);\r\n        document.removeEventListener('mousemove', onMouseMove);\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draggable', initDraggable as EventSetupFn);\r\n","/**\r\n * Delays execution of a callback by a specified number of animation frames.\r\n *\r\n * Uses `requestAnimationFrame` to count frames, then calls the provided callback.\r\n *\r\n * @param {number} frames - The number of animation frames to wait before executing the callback.\r\n * @param {() => void} callback - The function to execute after the specified frames have passed.\r\n */\r\nfunction waitFrames(frames: number, callback: () => void): void {\r\n\tlet count = 0;\r\n\r\n\tfunction step() {\r\n\t\tcount++;\r\n\t\tif (count >= frames) {\r\n\t\t\tcallback();\r\n\t\t} else {\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t}\r\n\t}\r\n\r\n\trequestAnimationFrame(step);\r\n}\r\n\r\nexport default waitFrames;\r\n","import { NodePrototype } from \"./node-types\";\r\n\r\n/**\r\n * A registry of all node prototypes by name.\r\n * Maps a string key (node type name) to a NodePrototype object\r\n */\r\nconst NodePrototypes: { [key: string]: NodePrototype } = {};\r\n\r\nexport default NodePrototypes;\r\n","import { G } from \"@svgdotjs/svg.js\";\r\nimport Field, { AnyField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\n/**\r\n * Allowed owner types for the dropdown container.\r\n * Can be either a NodeSvg or a Field.\r\n */\r\nexport type AllowedOwner = NodeSvg | AnyField;\r\n\r\n/**\r\n * Get absolute position of an HTMLElement relative to the document.\r\n * @param el - The HTML element to measure.\r\n * @returns The bounding box with scroll offset.\r\n */\r\nfunction getAbsolutePosition(el: HTMLElement) {\r\n    const rect = el.getBoundingClientRect();\r\n    return {\r\n        x: rect.left + window.scrollX,\r\n        y: rect.top + window.scrollY,\r\n        width: rect.width,\r\n        height: rect.height,\r\n    };\r\n}\r\n\r\n/**\r\n * Options for creating a dropdown menu.\r\n */\r\nexport interface DropdownOptions {\r\n    /** List of items to display in the dropdown */\r\n    items: { label: string; value: string }[];\r\n    /** Callback when an item is selected */\r\n    onSelect?: (value: string, item: { label: string; value: string }) => void;\r\n    /** Optional fixed width of the dropdown */\r\n    width?: number;\r\n}\r\n\r\n/**\r\n * Dropdown container for NodeSvg or Field elements.\r\n * Supports singleton behavior (only one dropdown visible at a time).\r\n */\r\nclass DropdownContainer {\r\n    private static current: DropdownContainer | null = null;\r\n    private owner: AllowedOwner | null = null;\r\n    private rootEl: HTMLDivElement;\r\n    private options: DropdownOptions | null = null;\r\n    private constraint: { x: number; y: number; width: number; height: number };\r\n    private offset: { dx: number; dy: number };\r\n\r\n    /**\r\n     * Creates the dropdown container and attaches it to the DOM.\r\n     */\r\n    constructor() {\r\n        this.rootEl = document.createElement(\"div\");\r\n        this.rootEl.className = \"KabelDropdownMenu\";\r\n        this.rootEl.style.position = \"absolute\";\r\n        this.rootEl.style.display = \"none\";\r\n        document.body.appendChild(this.rootEl);\r\n\r\n        this.constraint = { x: 0, y: 0, width: 0, height: 0 };\r\n        this.offset = { dx: 0, dy: 0 };\r\n    }\r\n\r\n    /**\r\n     * Move the dropdown by an offset.\r\n     * @param dx - horizontal offset\r\n     * @param dy - vertical offset\r\n     */\r\n    move(dx: number, dy: number) {\r\n        this.offset.dx = dx;\r\n        this.offset.dy = dy;\r\n        this.updatePosition();\r\n    }\r\n\r\n    /**\r\n     * Update the dropdown position based on constraint and offset.\r\n     */\r\n    private updatePosition() {\r\n        const { x, y, height } = this.constraint;\r\n        const { dx, dy } = this.offset;\r\n        this.rootEl.style.left = `${x + dx}px`;\r\n        this.rootEl.style.top = `${y + height + dy}px`; // anchored below\r\n    }\r\n\r\n    /**\r\n     * Set inner HTML content of the dropdown.\r\n     * @param html - HTML string\r\n     */\r\n    setContent(html: string) {\r\n        this.rootEl.innerHTML = html;\r\n    }\r\n\r\n    /**\r\n     * Append an element as a child to the dropdown.\r\n     * @param element - Element to append\r\n     * @returns The appended element\r\n     */\r\n    appendChild(element: Element) {\r\n        this.rootEl.appendChild(element);\r\n        return element;\r\n    }\r\n\r\n    /**\r\n     * Show the dropdown for a given owner.\r\n     * @param owner - NodeSvg or Field that owns this dropdown\r\n     * @param options - Dropdown configuration options\r\n     */\r\n    show(owner: AllowedOwner, options: DropdownOptions) {\r\n        if (!owner.svgGroup) return;\r\n        this.hide(); // close existing dropdown first\r\n        this.owner = owner;\r\n        if (options) this.options = options;\r\n\r\n        const groupRect = owner.svgGroup.node.getBoundingClientRect();\r\n        this.constraint = {\r\n            x: groupRect.left + window.scrollX,\r\n            y: groupRect.top + window.scrollY,\r\n            width: groupRect.width,\r\n            height: groupRect.height,\r\n        };\r\n\r\n        this.offset = { dx: 0, dy: 0 };\r\n\r\n        this.rootEl.innerHTML = \"\";\r\n        if (options.width) this.rootEl.style.width = `${options.width}px`;\r\n        this.rootEl.style.display = \"block\";\r\n\r\n        // Render items\r\n        if (options.items) {\r\n            options.items.forEach((item) => {\r\n                const el = document.createElement(\"div\");\r\n                el.className = \"KabelDropdownItem\";\r\n                el.textContent = item.label;\r\n                el.onclick = () => {\r\n                    options.onSelect?.(item.value, item);\r\n                    this.hide();\r\n                };\r\n                this.rootEl.appendChild(el);\r\n            });\r\n        }\r\n\r\n        this.updatePosition();\r\n        DropdownContainer.current = this;\r\n    }\r\n\r\n    /**\r\n     * Hide this dropdown.\r\n     */\r\n    hide() {\r\n        if (DropdownContainer.current !== this) return;\r\n        this.rootEl.style.display = \"none\";\r\n        this.rootEl.innerHTML = \"\";\r\n        this.owner = null;\r\n        this.options = null;\r\n        DropdownContainer.current = null;\r\n    }\r\n\r\n    /**\r\n     * Hide this dropdown if the given owner currently owns it.\r\n     * @param owner - The owner to check\r\n     */\r\n    hideIfOwner(owner: AllowedOwner) {\r\n        if (this.owner === owner) {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    /** @returns True if the dropdown is currently visible */\r\n    isVisible(): boolean {\r\n        return DropdownContainer.current === this;\r\n    }\r\n\r\n    /** @returns The current owner of the dropdown, or null if none */\r\n    getOwner(): AllowedOwner | null {\r\n        return this.owner;\r\n    }\r\n\r\n    /** @returns The currently visible dropdown container singleton */\r\n    static getCurrent(): DropdownContainer | null {\r\n        return DropdownContainer.current;\r\n    }\r\n}\r\n\r\n// Singleton export\r\nconst dropdownContainer = new DropdownContainer();\r\nexport default dropdownContainer;\r\nexport { DropdownContainer };\r\n","import { WidgetOptions } from \"./widget\";\r\n\r\n/**\r\n * A list of prototypes for widgets.\r\n */\r\nexport interface WidgetPrototypeList {\r\n    [key: string]: WidgetOptions\r\n}\r\n\r\nconst WidgetPrototypes: WidgetPrototypeList = {};\r\nexport default WidgetPrototypes;","import { Element } from '@svgdotjs/svg.js';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport eventer from '../util/eventer';\r\nimport type { EventSetupFn } from '../util/eventer';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport userState from '../util/user-state';\r\nimport CommentModel from '../src/comment';\r\n\r\n\r\nfunction initDraggable(element: Element, args: Record<string, any>): () => void {\r\n    const comment = args.comment as CommentModel;\r\n    if (!comment) return () => { };\r\n\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let startRelX = 0;\r\n    let startRelY = 0;\r\n\r\n    function onPointerDown(ev: PointerEvent) {\r\n        ev.preventDefault();\r\n\r\n        const ws = comment.getWorkspace();\r\n        const rel = comment.relativeCoords;\r\n\r\n        // Capture offset from pointer to comment in workspace coords\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n        startRelX = rel.x - pointerWS.x;\r\n        startRelY = rel.y - pointerWS.y;\r\n\r\n        document.addEventListener('pointermove', onPointerMove);\r\n        document.addEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    function onPointerMove(ev: PointerEvent) {\r\n        const ws = comment.getWorkspace();\r\n\r\n        // Map pointer to workspace\r\n        const pointerWS = ws.screenToWorkspace(ev.clientX, ev.clientY);\r\n\r\n        // Add initial offset\r\n        comment.relativeCoords.set(pointerWS.x + startRelX, pointerWS.y + startRelY);\r\n\r\n        ws.refreshComments();\r\n    }\r\n\r\n\r\n\r\n    function onPointerUp() {\r\n        document.removeEventListener('pointermove', onPointerMove);\r\n        document.removeEventListener('pointerup', onPointerUp);\r\n    }\r\n\r\n    element.node.addEventListener('pointerdown', onPointerDown);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n        element.node.removeEventListener('pointerdown', onPointerDown);\r\n    };\r\n}\r\n\r\neventer.registerEvent('k_draghandle', initDraggable as EventSetupFn);\r\n","import { Svg, Rect, Circle, G, Path, Element } from '@svgdotjs/svg.js';\r\n\r\nexport type EventType = string;\r\nexport type EventArgs = Record<string, any>;\r\nexport type EventSetupFn = (el: Element, args?: EventArgs) => (() => void) | void;\r\n\r\ninterface RegisteredEl {\r\n    tags: string[],\r\n    el: Element;\r\n    type: EventType;\r\n    args?: EventArgs | undefined;      // allow undefined explicitly\r\n    destroyFn?: (() => void) | undefined; // allow undefined explicitly\r\n}\r\n\r\n/**\r\n * Used by the Kabel renderer to tag svg.js elements as interactable with the kabel system.\r\n */\r\nclass Eventer {\r\n    private elements: RegisteredEl[] = [];\r\n    private eventRegistry: Map<EventType, EventSetupFn> = new Map();\r\n\r\n    // Register an event type with a setup function\r\n    registerEvent(type: EventType, setupFn: EventSetupFn) {\r\n        this.eventRegistry.set(type, setupFn);\r\n        return this; // allow chaining\r\n    }\r\n    tagElement(el: Element, tags?: string[] | string) {\r\n        if (!tags) return this;\r\n        const tagList = Array.isArray(tags) ? tags : [tags];\r\n\r\n        // Find the registered elements for this el\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el) {\r\n                for (const t of tagList) {\r\n                    if (!reg.tags.includes(t)) reg.tags.push(t);\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    destroyByTag(tag: string) {\r\n        let destroyed = false;\r\n        this.elements = this.elements.filter(reg => {\r\n            if (reg.tags.includes(tag)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                return false; // remove this element\r\n            }\r\n            return true; // keep element\r\n        });\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    // addElement\r\n    addElement(el: Element, types: EventType | EventType[], args?: EventArgs) {\r\n        const typeList = Array.isArray(types) ? types : [types];\r\n        for (const type of typeList) {\r\n            const destroyFn = this.setupElement(el, type, args) as (() => void) | undefined;\r\n            this.elements.push({\r\n                tags: [],\r\n                el,\r\n                type,\r\n                args,\r\n                destroyFn\r\n            });\r\n        }\r\n        return this;\r\n    }\r\n\r\n    // refresh\r\n    refresh() {\r\n        for (const reg of this.elements) {\r\n            if (reg.destroyFn) reg.destroyFn();\r\n            reg.destroyFn = this.setupElement(reg.el, reg.type, reg.args) as (() => void) | undefined;\r\n        }\r\n    }\r\n\r\n\r\n    // Destroy event(s) for an element\r\n    destroyElement(el: Element, type?: EventType) {\r\n        let destroyed = false;\r\n        for (const reg of this.elements) {\r\n            if (reg.el === el && (!type || reg.type === type)) {\r\n                if (reg.destroyFn) {\r\n                    reg.destroyFn();\r\n                    destroyed = true;\r\n                }\r\n                // Remove from elements array\r\n                this.elements = this.elements.filter(r => r !== reg);\r\n            }\r\n        }\r\n        return destroyed ? 1 : 0;\r\n    }\r\n\r\n    private setupElement(el: Element, type: EventType, args?: EventArgs): (() => void) | undefined {\r\n        const setupFn = this.eventRegistry.get(type);\r\n        if (!setupFn) return;\r\n        const destroyFn = setupFn(el, args);\r\n        return destroyFn instanceof Function ? destroyFn : undefined;\r\n    }\r\n}\r\n\r\nconst eventer = new Eventer();\r\nexport default eventer;\r\nexport { Eventer };\r\n","// Convert an arc to a sequence of cubic bzier curves\n//\n'use strict';\n\n\nvar TAU = Math.PI * 2;\n\n\n/* eslint-disable space-infix-ops */\n\n// Calculate an angle between two unit vectors\n//\n// Since we measure angle between radii of circular arcs,\n// we can use simplified math (without length normalization)\n//\nfunction unit_vector_angle(ux, uy, vx, vy) {\n  var sign = (ux * vy - uy * vx < 0) ? -1 : 1;\n  var dot  = ux * vx + uy * vy;\n\n  // Add this to work with arbitrary vectors:\n  // dot /= Math.sqrt(ux * ux + uy * uy) * Math.sqrt(vx * vx + vy * vy);\n\n  // rounding errors, e.g. -1.0000000000000002 can screw up this\n  if (dot >  1.0) { dot =  1.0; }\n  if (dot < -1.0) { dot = -1.0; }\n\n  return sign * Math.acos(dot);\n}\n\n\n// Convert from endpoint to center parameterization,\n// see http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n//\n// Return [cx, cy, theta1, delta_theta]\n//\nfunction get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi) {\n  // Step 1.\n  //\n  // Moving an ellipse so origin will be the middlepoint between our two\n  // points. After that, rotate it to line up ellipse axes with coordinate\n  // axes.\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  var rx_sq  =  rx * rx;\n  var ry_sq  =  ry * ry;\n  var x1p_sq = x1p * x1p;\n  var y1p_sq = y1p * y1p;\n\n  // Step 2.\n  //\n  // Compute coordinates of the centre of this ellipse (cx', cy')\n  // in the new coordinate system.\n  //\n  var radicant = (rx_sq * ry_sq) - (rx_sq * y1p_sq) - (ry_sq * x1p_sq);\n\n  if (radicant < 0) {\n    // due to rounding errors it might be e.g. -1.3877787807814457e-17\n    radicant = 0;\n  }\n\n  radicant /=   (rx_sq * y1p_sq) + (ry_sq * x1p_sq);\n  radicant = Math.sqrt(radicant) * (fa === fs ? -1 : 1);\n\n  var cxp = radicant *  rx/ry * y1p;\n  var cyp = radicant * -ry/rx * x1p;\n\n  // Step 3.\n  //\n  // Transform back to get centre coordinates (cx, cy) in the original\n  // coordinate system.\n  //\n  var cx = cos_phi*cxp - sin_phi*cyp + (x1+x2)/2;\n  var cy = sin_phi*cxp + cos_phi*cyp + (y1+y2)/2;\n\n  // Step 4.\n  //\n  // Compute angles (theta1, delta_theta).\n  //\n  var v1x =  (x1p - cxp) / rx;\n  var v1y =  (y1p - cyp) / ry;\n  var v2x = (-x1p - cxp) / rx;\n  var v2y = (-y1p - cyp) / ry;\n\n  var theta1 = unit_vector_angle(1, 0, v1x, v1y);\n  var delta_theta = unit_vector_angle(v1x, v1y, v2x, v2y);\n\n  if (fs === 0 && delta_theta > 0) {\n    delta_theta -= TAU;\n  }\n  if (fs === 1 && delta_theta < 0) {\n    delta_theta += TAU;\n  }\n\n  return [ cx, cy, theta1, delta_theta ];\n}\n\n//\n// Approximate one unit arc segment with bzier curves,\n// see http://math.stackexchange.com/questions/873224\n//\nfunction approximate_unit_arc(theta1, delta_theta) {\n  var alpha = 4/3 * Math.tan(delta_theta/4);\n\n  var x1 = Math.cos(theta1);\n  var y1 = Math.sin(theta1);\n  var x2 = Math.cos(theta1 + delta_theta);\n  var y2 = Math.sin(theta1 + delta_theta);\n\n  return [ x1, y1, x1 - y1*alpha, y1 + x1*alpha, x2 + y2*alpha, y2 - x2*alpha, x2, y2 ];\n}\n\nmodule.exports = function a2c(x1, y1, x2, y2, fa, fs, rx, ry, phi) {\n  var sin_phi = Math.sin(phi * TAU / 360);\n  var cos_phi = Math.cos(phi * TAU / 360);\n\n  // Make sure radii are valid\n  //\n  var x1p =  cos_phi*(x1-x2)/2 + sin_phi*(y1-y2)/2;\n  var y1p = -sin_phi*(x1-x2)/2 + cos_phi*(y1-y2)/2;\n\n  if (x1p === 0 && y1p === 0) {\n    // we're asked to draw line to itself\n    return [];\n  }\n\n  if (rx === 0 || ry === 0) {\n    // one of the radii is zero\n    return [];\n  }\n\n\n  // Compensate out-of-range radii\n  //\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n\n  var lambda = (x1p * x1p) / (rx * rx) + (y1p * y1p) / (ry * ry);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n\n  // Get center parameters (cx, cy, theta1, delta_theta)\n  //\n  var cc = get_arc_center(x1, y1, x2, y2, fa, fs, rx, ry, sin_phi, cos_phi);\n\n  var result = [];\n  var theta1 = cc[2];\n  var delta_theta = cc[3];\n\n  // Split an arc to multiple segments, so each segment\n  // will be less than /4 (= 90)\n  //\n  var segments = Math.max(Math.ceil(Math.abs(delta_theta) / (TAU / 4)), 1);\n  delta_theta /= segments;\n\n  for (var i = 0; i < segments; i++) {\n    result.push(approximate_unit_arc(theta1, delta_theta));\n    theta1 += delta_theta;\n  }\n\n  // We have a bezier approximation of a unit circle,\n  // now need to transform back to the original ellipse\n  //\n  return result.map(function (curve) {\n    for (var i = 0; i < curve.length; i += 2) {\n      var x = curve[i + 0];\n      var y = curve[i + 1];\n\n      // scale\n      x *= rx;\n      y *= ry;\n\n      // rotate\n      var xp = cos_phi*x - sin_phi*y;\n      var yp = sin_phi*x + cos_phi*y;\n\n      // translate\n      curve[i + 0] = xp + cc[0];\n      curve[i + 1] = yp + cc[1];\n    }\n\n    return curve;\n  });\n};\n","'use strict';\n\nmodule.exports = require('./lib/svgpath');\n","/**\r\n * Kabel Core Export Module\r\n * ------------------------\r\n * This file aggregates all core Kabel modules, types, utilities, and components,\r\n * and exports them under a single namespace. This allows consumers to import\r\n * everything from 'kabel' without deep paths.\r\n */\r\n\r\nimport RendererConstants from \"../renderers/constants\";\r\nimport Renderer, { DrawState, ConnectorToFrom } from \"../renderers/renderer\";\r\nimport CategoryColors from \"./colors\";\r\nimport Connection, { Connectable } from \"./connection\";\r\nimport Coordinates from \"./coordinates\";\r\nimport Field, { \r\n    FieldOptions, FieldVisualInfo, AnyFieldCls, AnyField, DummyField, \r\n    FieldMap, NumberField, OptConnectField, TextField \r\n} from \"./field\";\r\nimport inject, { \r\n    InjectMsg, InjectOptions, TblxCategoryStruct, TblxObjStruct, \r\n    TblxFieldStruct, TblxNodeStruct \r\n} from \"./inject\";\r\nimport { clearMainWorkspace, getMainWorkspace, setMainWorkspace } from \"./main-workspace\";\r\nimport NodeSvg, { NodeJson, NodeEvents, InputFieldJson } from \"./nodesvg\";\r\nimport NodePrototypes from \"./prototypes\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\nimport { NodePrototype } from \"./node-types\";\r\nimport { Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple } from \"./visual-types\";\r\nimport { parseColor } from \"../util/parse-color\";\r\nimport eventer, { Eventer } from \"../util/eventer\";\r\nimport * as Path from '../util/path';\r\nimport * as SVG from '@svgdotjs/svg.js';\r\nimport * as UID from '../util/uid';\r\nimport hasProp from \"../util/has-prop\";\r\nimport EventEmitter from \"../util/emitter\";\r\n\r\nimport K from './core';\r\nimport { WidgetOptions } from \"./widget\";\r\nimport { WidgetPrototypeList } from \"./widget-prototypes\";\r\nimport KabelInterface from \"./types\";\r\n\r\n//@ts-ignore\r\nconst Kabel: KabelInterface = K;\r\n\r\nexport default Kabel;\r\n\r\n/**\r\n * Core exported types and utilities for Kabel.\r\n */\r\nexport type {\r\n    /** Main Kabel interface */\r\n    KabelInterface,\r\n\r\n    /** Toolbox category structure */\r\n    TblxCategoryStruct,\r\n    /** Toolbox node structure */\r\n    TblxNodeStruct,\r\n    /** Toolbox field structure */\r\n    TblxFieldStruct,\r\n    /** Toolbox contents union type */\r\n    TblxObjStruct,\r\n\r\n    /** Renderer constants */\r\n    RendererConstants,\r\n    /** Renderer class */\r\n    Renderer,\r\n    /** Category color definitions */\r\n    CategoryColors,\r\n    /** Node connection */\r\n    Connection,\r\n    /** 2D coordinates helper */\r\n    Coordinates,\r\n\r\n    /** Base Field classes and helpers */\r\n    Field,\r\n    DummyField,\r\n    FieldMap,\r\n    NumberField,\r\n    OptConnectField,\r\n    TextField,\r\n\r\n    /** Workspace injection helpers */\r\n    inject,\r\n    InjectMsg,\r\n    clearMainWorkspace,\r\n    getMainWorkspace,\r\n    setMainWorkspace,\r\n\r\n    /** Node system */\r\n    NodeSvg,\r\n    NodePrototypes,\r\n    WorkspaceSvg,\r\n    AnyFieldCls,\r\n    AnyField,\r\n    InjectOptions,\r\n\r\n    /** Node visual types */\r\n    Color, ColorStyle, Hex, RGBObject, RGBString, RGBTuple,\r\n    NodePrototype,\r\n    FieldOptions,\r\n    FieldVisualInfo,\r\n\r\n    /** Node JSON / serialization types */\r\n    NodeJson, NodeEvents, InputFieldJson,\r\n\r\n    /** Eventing */\r\n    Eventer,\r\n    Connectable,\r\n    DrawState,\r\n    ConnectorToFrom,\r\n\r\n    /** Widget system */\r\n    WidgetOptions,\r\n    WidgetPrototypeList\r\n};\r\n","/**\r\n * Represents a 2D coordinate in space.\r\n */\r\nclass Coordinates {\r\n\t/** X position */\r\n\tx: number;\r\n\t/** Y position */\r\n\ty: number;\r\n\r\n\t/**\r\n\t * Creates a new Coordinates instance\r\n\t * @param x - The x value (default 0)\r\n\t * @param y - The y value (default 0)\r\n\t */\r\n\tconstructor(x: number = 0, y: number = 0) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the coordinates to new values\r\n\t * @param x - The new x value\r\n\t * @param y - The new y value\r\n\t */\r\n\tset(x: number, y: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this coordinate\r\n\t * @returns A new Coordinates instance with the same x and y\r\n\t */\r\n\tclone(): Coordinates {\r\n\t\treturn new Coordinates(this.x, this.y);\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the Euclidean distance to another coordinate\r\n\t * @param other - The target coordinate\r\n\t * @returns The distance as a number\r\n\t */\r\n\tdistanceTo(other: Coordinates): number {\r\n\t\tconst dx = this.x - other.x;\r\n\t\tconst dy = this.y - other.y;\r\n\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to a string representation\r\n\t * @returns A string like \"(x, y)\"\r\n\t */\r\n\ttoString(): string {\r\n\t\treturn `(${this.x}, ${this.y})`;\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to an array [x, y]\r\n\t * @returns Tuple of numbers [x, y]\r\n\t */\r\n\ttoArray(): [number, number] {\r\n\t\treturn [this.x, this.y];\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the coordinate to an object { x, y }\r\n\t * @returns Object with x and y properties\r\n\t */\r\n\ttoObject(): { x: number; y: number } {\r\n\t\treturn { x: this.x, y: this.y };\r\n\t}\r\n}\r\n\r\nexport default Coordinates;\r\n","import { Color, Hex } from \"../src/visual-types\";\r\n\r\nclass RendererConstants {\r\n    CORNER_RADIUS!: number;\r\n    NODE_BASE_WIDTH!: number;\r\n    NODE_BASE_HEIGHT!: number;\r\n    TOPBAR_HEIGHT!: number;\r\n    FOOTER_HEIGHT!: number;\r\n    PADDING_BIG!: number;\r\n    PADDING_MEDIUM!: number;\r\n    PADDING_SMALL!: number;\r\n    FIELD_SPACEY!: number;\r\n    FIELD_SPACEX!: number;\r\n    FIELD_RAW_BASE_WIDTH!: number;\r\n    FIELD_RAW_BASE_HEIGHT!: number;\r\n    INPUT_BOX_PADDING!: number;\r\n    INPUT_BOX_TEXT_ANCHOR!: 'start' | 'middle';\r\n    LABEL_SPACING!: number;\r\n\r\n    FIELD_RAW_COLOR: Color = '#2b2d36ff';\r\n    FIELD_RAW_TEXT_COLOR: Color = '#e0e2e8ff';\r\n    FIELD_RAW_OUTLINE_COLOR: Color = '#1f2027ff';\r\n    FIELD_RAW_OUTLINE_STROKE!: number;\r\n    FIELD_CONN_COLOR: Color = '#0c7cccff'\r\n    NODE_BG_COLOR: Color = '#2c2d3aff';\r\n    NODE_OUTLINE_COLOR: Color = '#1d1e25ff';\r\n    CONNECTOR_TRIANGLE!: boolean;\r\n    CONNECTION_STROKE_WIDTH!: number;\r\n    CONNECTION_STROKE_COLOR_CHOICE!: number;\r\n    CONNECTOR_TRI_SIZE!: number;\r\n    CONNECTOR_RADIUS!: number;\r\n    FONT_FAMILY: string =\r\n        '\"Inter\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif';\r\n    FONT_SIZE!: number;\r\n    FONT_COLOR: Color = '#e0e2e8ff';\r\n\r\n    FIELD_MARGIN_X!: number;\r\n    FIELD_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_MARGIN_X!: number;\r\n    TOPBAR_LABEL_MARGIN_Y!: number;\r\n    TOPBAR_LABEL_BOLDED!: boolean;\r\n    CONNECTOR_LINE_WIDTH: number = 6;\r\n    CONNECTOR_LINE_CURVED: boolean = true;\r\n    ZOOM_BASE: number = 1; // default scale factor for workspace\r\n\r\n    constructor(overrides: Partial<RendererConstants> = {}) {\r\n        this.CONNECTOR_TRI_SIZE = 8;\r\n        this.CONNECTOR_RADIUS = 10;\r\n        this.CORNER_RADIUS = 6;\r\n        this.NODE_BASE_WIDTH = 200;\r\n        this.NODE_BASE_HEIGHT = 240;\r\n\r\n        this.TOPBAR_HEIGHT = 50;\r\n        this.FOOTER_HEIGHT = 25;\r\n        this.PADDING_BIG = 16;\r\n        this.PADDING_MEDIUM = 8;\r\n        this.PADDING_SMALL = 4;\r\n        this.FIELD_RAW_BASE_WIDTH = 80;\r\n        this.FIELD_RAW_BASE_HEIGHT = 42;\r\n        this.INPUT_BOX_PADDING = 6;\r\n        this.LABEL_SPACING = 5;\r\n        this.INPUT_BOX_TEXT_ANCHOR = 'middle';\r\n        this.CONNECTOR_TRIANGLE = false;\r\n        this.CONNECTION_STROKE_WIDTH = 2;\r\n        this.CONNECTION_STROKE_COLOR_CHOICE = 1;\r\n        this.FIELD_RAW_OUTLINE_STROKE = 2;\r\n        this.FIELD_SPACEY = 20;\r\n        this.FIELD_SPACEX = 20;\r\n        this.FONT_SIZE = 20;\r\n        this.TOPBAR_LABEL_BOLDED = true;\r\n        this.FIELD_MARGIN_X = 16;\r\n        this.FIELD_MARGIN_Y = 16;\r\n        this.TOPBAR_LABEL_MARGIN_X = 12;\r\n        this.TOPBAR_LABEL_MARGIN_Y = 0;\r\n\r\n        Object.assign(this, overrides);\r\n    }\r\n}\r\n\r\nexport default RendererConstants;\r\n","// SVG Path transformations library\n//\n// Usage:\n//\n//    SvgPath('...')\n//      .translate(-150, -100)\n//      .scale(0.5)\n//      .translate(-150, -100)\n//      .toFixed(1)\n//      .toString()\n//\n\n'use strict';\n\n\nvar pathParse      = require('./path_parse');\nvar transformParse = require('./transform_parse');\nvar matrix         = require('./matrix');\nvar a2c            = require('./a2c');\nvar ellipse        = require('./ellipse');\n\n\n// Class constructor\n//\nfunction SvgPath(path) {\n  if (!(this instanceof SvgPath)) { return new SvgPath(path); }\n\n  var pstate = pathParse(path);\n\n  // Array of path segments.\n  // Each segment is array [command, param1, param2, ...]\n  this.segments = pstate.segments;\n\n  // Error message on parse error.\n  this.err      = pstate.err;\n\n  // Transforms stack for lazy evaluation\n  this.__stack    = [];\n}\n\nSvgPath.from = function (src) {\n  if (typeof src === 'string') return new SvgPath(src);\n\n  if (src instanceof SvgPath) {\n    // Create empty object\n    var s = new SvgPath('');\n\n    // Clone properies\n    s.err = src.err;\n    s.segments = src.segments.map(function (sgm) { return sgm.slice(); });\n    s.__stack = src.__stack.map(function (m) {\n      return matrix().matrix(m.toArray());\n    });\n\n    return s;\n  }\n\n  throw new Error('SvgPath.from: invalid param type ' + src);\n};\n\n\nSvgPath.prototype.__matrix = function (m) {\n  var self = this, i;\n\n  // Quick leave for empty matrix\n  if (!m.queue.length) { return; }\n\n  this.iterate(function (s, index, x, y) {\n    var p, result, name, isRelative;\n\n    switch (s[0]) {\n\n      // Process 'assymetric' commands separately\n      case 'v':\n        p      = m.calc(0, s[1], true);\n        result = (p[0] === 0) ? [ 'v', p[1] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'V':\n        p      = m.calc(x, s[1], false);\n        result = (p[0] === m.calc(x, y, false)[0]) ? [ 'V', p[1] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'h':\n        p      = m.calc(s[1], 0, true);\n        result = (p[1] === 0) ? [ 'h', p[0] ] : [ 'l', p[0], p[1] ];\n        break;\n\n      case 'H':\n        p      = m.calc(s[1], y, false);\n        result = (p[1] === m.calc(x, y, false)[1]) ? [ 'H', p[0] ] : [ 'L', p[0], p[1] ];\n        break;\n\n      case 'a':\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n\n        // Drop segment if arc is empty (end point === start point)\n        /*if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          return [];\n        }*/\n\n        // Transform rx, ry and the x-axis-rotation\n        var ma = m.toArray();\n        var e = ellipse(s[1], s[2], s[3]).transform(ma);\n\n        // flip sweep-flag if matrix is not orientation-preserving\n        if (ma[0] * ma[3] - ma[1] * ma[2] < 0) {\n          s[5] = s[5] ? '0' : '1';\n        }\n\n        // Transform end point as usual (without translation for relative notation)\n        p = m.calc(s[6], s[7], s[0] === 'a');\n\n        // Empty arcs can be ignored by renderer, but should not be dropped\n        // to avoid collisions with `S A S` and so on. Replace with empty line.\n        if ((s[0] === 'A' && s[6] === x && s[7] === y) ||\n            (s[0] === 'a' && s[6] === 0 && s[7] === 0)) {\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n          break;\n        }\n\n        // if the resulting ellipse is (almost) a segment ...\n        if (e.isDegenerate()) {\n          // replace the arc by a line\n          result = [ s[0] === 'a' ? 'l' : 'L', p[0], p[1] ];\n        } else {\n          // if it is a real ellipse\n          // s[0], s[4] and s[5] are not modified\n          result = [ s[0], e.rx, e.ry, e.ax, s[4], s[5], p[0], p[1] ];\n        }\n\n        break;\n\n      case 'm':\n        // Edge case. The very first `m` should be processed as absolute, if happens.\n        // Make sense for coord shift transforms.\n        isRelative = index > 0;\n\n        p = m.calc(s[1], s[2], isRelative);\n        result = [ 'm', p[0], p[1] ];\n        break;\n\n      default:\n        name       = s[0];\n        result     = [ name ];\n        isRelative = (name.toLowerCase() === name);\n\n        // Apply transformations to the segment\n        for (i = 1; i < s.length; i += 2) {\n          p = m.calc(s[i], s[i + 1], isRelative);\n          result.push(p[0], p[1]);\n        }\n    }\n\n    self.segments[index] = result;\n  }, true);\n};\n\n\n// Apply stacked commands\n//\nSvgPath.prototype.__evaluateStack = function () {\n  var m, i;\n\n  if (!this.__stack.length) { return; }\n\n  if (this.__stack.length === 1) {\n    this.__matrix(this.__stack[0]);\n    this.__stack = [];\n    return;\n  }\n\n  m = matrix();\n  i = this.__stack.length;\n\n  while (--i >= 0) {\n    m.matrix(this.__stack[i].toArray());\n  }\n\n  this.__matrix(m);\n  this.__stack = [];\n};\n\n\n// Convert processed SVG Path back to string\n//\nSvgPath.prototype.toString = function () {\n  var result = '', prevCmd = '', cmdSkipped = false;\n\n  this.__evaluateStack();\n\n  for (var i = 0, len = this.segments.length; i < len; i++) {\n    var segment = this.segments[i];\n    var cmd = segment[0];\n\n    // Command not repeating => store\n    if (cmd !== prevCmd || cmd === 'm' || cmd === 'M') {\n      // workaround for FontForge SVG importing bug, keep space between \"z m\".\n      if (cmd === 'm' && prevCmd === 'z') result += ' ';\n      result += cmd;\n\n      cmdSkipped = false;\n    } else {\n      cmdSkipped = true;\n    }\n\n    // Store segment params\n    for (var pos = 1; pos < segment.length; pos++) {\n      var val = segment[pos];\n      // Space can be skipped\n      // 1. After command (always)\n      // 2. For negative value (with '-' at start)\n      if (pos === 1) {\n        if (cmdSkipped && val >= 0) result += ' ';\n      } else if (val >= 0) result += ' ';\n\n      result += val;\n    }\n\n    prevCmd = cmd;\n  }\n\n  return result;\n};\n\n\n// Translate path to (x [, y])\n//\nSvgPath.prototype.translate = function (x, y) {\n  this.__stack.push(matrix().translate(x, y || 0));\n  return this;\n};\n\n\n// Scale path to (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.scale = function (sx, sy) {\n  this.__stack.push(matrix().scale(sx, (!sy && (sy !== 0)) ? sx : sy));\n  return this;\n};\n\n\n// Rotate path around point (sx [, sy])\n// sy = sx if not defined\n//\nSvgPath.prototype.rotate = function (angle, rx, ry) {\n  this.__stack.push(matrix().rotate(angle, rx || 0, ry || 0));\n  return this;\n};\n\n\n// Skew path along the X axis by `degrees` angle\n//\nSvgPath.prototype.skewX = function (degrees) {\n  this.__stack.push(matrix().skewX(degrees));\n  return this;\n};\n\n\n// Skew path along the Y axis by `degrees` angle\n//\nSvgPath.prototype.skewY = function (degrees) {\n  this.__stack.push(matrix().skewY(degrees));\n  return this;\n};\n\n\n// Apply matrix transform (array of 6 elements)\n//\nSvgPath.prototype.matrix = function (m) {\n  this.__stack.push(matrix().matrix(m));\n  return this;\n};\n\n\n// Transform path according to \"transform\" attr of SVG spec\n//\nSvgPath.prototype.transform = function (transformString) {\n  if (!transformString.trim()) {\n    return this;\n  }\n  this.__stack.push(transformParse(transformString));\n  return this;\n};\n\n\n// Round coords with given decimal precition.\n// 0 by default (to integers)\n//\nSvgPath.prototype.round = function (d) {\n  var contourStartDeltaX = 0, contourStartDeltaY = 0, deltaX = 0, deltaY = 0, l;\n\n  d = d || 0;\n\n  this.__evaluateStack();\n\n  this.segments.forEach(function (s) {\n    var isRelative = (s[0].toLowerCase() === s[0]);\n\n    switch (s[0]) {\n      case 'H':\n      case 'h':\n        if (isRelative) { s[1] += deltaX; }\n        deltaX = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'V':\n      case 'v':\n        if (isRelative) { s[1] += deltaY; }\n        deltaY = s[1] - s[1].toFixed(d);\n        s[1] = +s[1].toFixed(d);\n        return;\n\n      case 'Z':\n      case 'z':\n        deltaX = contourStartDeltaX;\n        deltaY = contourStartDeltaY;\n        return;\n\n      case 'M':\n      case 'm':\n        if (isRelative) {\n          s[1] += deltaX;\n          s[2] += deltaY;\n        }\n\n        deltaX = s[1] - s[1].toFixed(d);\n        deltaY = s[2] - s[2].toFixed(d);\n\n        contourStartDeltaX = deltaX;\n        contourStartDeltaY = deltaY;\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        return;\n\n      case 'A':\n      case 'a':\n        // [cmd, rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        if (isRelative) {\n          s[6] += deltaX;\n          s[7] += deltaY;\n        }\n\n        deltaX = s[6] - s[6].toFixed(d);\n        deltaY = s[7] - s[7].toFixed(d);\n\n        s[1] = +s[1].toFixed(d);\n        s[2] = +s[2].toFixed(d);\n        s[3] = +s[3].toFixed(d + 2); // better precision for rotation\n        s[6] = +s[6].toFixed(d);\n        s[7] = +s[7].toFixed(d);\n        return;\n\n      default:\n        // a c l q s t\n        l = s.length;\n\n        if (isRelative) {\n          s[l - 2] += deltaX;\n          s[l - 1] += deltaY;\n        }\n\n        deltaX = s[l - 2] - s[l - 2].toFixed(d);\n        deltaY = s[l - 1] - s[l - 1].toFixed(d);\n\n        s.forEach(function (val, i) {\n          if (!i) { return; }\n          s[i] = +s[i].toFixed(d);\n        });\n        return;\n    }\n  });\n\n  return this;\n};\n\n\n// Apply iterator function to all segments. If function returns result,\n// current segment will be replaced to array of returned segments.\n// If empty array is returned, current regment will be deleted.\n//\nSvgPath.prototype.iterate = function (iterator, keepLazyStack) {\n  var segments = this.segments,\n      replacements = {},\n      needReplace = false,\n      lastX = 0,\n      lastY = 0,\n      countourStartX = 0,\n      countourStartY = 0;\n  var i, j, newSegments;\n\n  if (!keepLazyStack) {\n    this.__evaluateStack();\n  }\n\n  segments.forEach(function (s, index) {\n\n    var res = iterator(s, index, lastX, lastY);\n\n    if (Array.isArray(res)) {\n      replacements[index] = res;\n      needReplace = true;\n    }\n\n    var isRelative = (s[0] === s[0].toLowerCase());\n\n    // calculate absolute X and Y\n    switch (s[0]) {\n      case 'm':\n      case 'M':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        lastY = s[2] + (isRelative ? lastY : 0);\n        countourStartX = lastX;\n        countourStartY = lastY;\n        return;\n\n      case 'h':\n      case 'H':\n        lastX = s[1] + (isRelative ? lastX : 0);\n        return;\n\n      case 'v':\n      case 'V':\n        lastY = s[1] + (isRelative ? lastY : 0);\n        return;\n\n      case 'z':\n      case 'Z':\n        // That make sence for multiple contours\n        lastX = countourStartX;\n        lastY = countourStartY;\n        return;\n\n      default:\n        lastX = s[s.length - 2] + (isRelative ? lastX : 0);\n        lastY = s[s.length - 1] + (isRelative ? lastY : 0);\n    }\n  });\n\n  // Replace segments if iterator return results\n\n  if (!needReplace) { return this; }\n\n  newSegments = [];\n\n  for (i = 0; i < segments.length; i++) {\n    if (typeof replacements[i] !== 'undefined') {\n      for (j = 0; j < replacements[i].length; j++) {\n        newSegments.push(replacements[i][j]);\n      }\n    } else {\n      newSegments.push(segments[i]);\n    }\n  }\n\n  this.segments = newSegments;\n\n  return this;\n};\n\n\n// Converts segments from relative to absolute\n//\nSvgPath.prototype.abs = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameUC = name.toUpperCase(),\n        i;\n\n    // Skip absolute commands\n    if (name === nameUC) { return; }\n\n    s[0] = nameUC;\n\n    switch (name) {\n      case 'v':\n        // v has shifted coords parity\n        s[1] += y;\n        return;\n\n      case 'a':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] += x;\n        s[7] += y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] += i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts segments from absolute to relative\n//\nSvgPath.prototype.rel = function () {\n\n  this.iterate(function (s, index, x, y) {\n    var name = s[0],\n        nameLC = name.toLowerCase(),\n        i;\n\n    // Skip relative commands\n    if (name === nameLC) { return; }\n\n    // Don't touch the first M to avoid potential confusions.\n    if (index === 0 && name === 'M') { return; }\n\n    s[0] = nameLC;\n\n    switch (name) {\n      case 'V':\n        // V has shifted coords parity\n        s[1] -= y;\n        return;\n\n      case 'A':\n        // ARC is: ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\n        // touch x, y only\n        s[6] -= x;\n        s[7] -= y;\n        return;\n\n      default:\n        for (i = 1; i < s.length; i++) {\n          s[i] -= i % 2 ? x : y; // odd values are X, even - Y\n        }\n    }\n  }, true);\n\n  return this;\n};\n\n\n// Converts arcs to cubic bzier curves\n//\nSvgPath.prototype.unarc = function () {\n  this.iterate(function (s, index, x, y) {\n    var new_segments, nextX, nextY, result = [], name = s[0];\n\n    // Skip anything except arcs\n    if (name !== 'A' && name !== 'a') { return null; }\n\n    if (name === 'a') {\n      // convert relative arc coordinates to absolute\n      nextX = x + s[6];\n      nextY = y + s[7];\n    } else {\n      nextX = s[6];\n      nextY = s[7];\n    }\n\n    new_segments = a2c(x, y, nextX, nextY, s[4], s[5], s[1], s[2], s[3]);\n\n    // Degenerated arcs can be ignored by renderer, but should not be dropped\n    // to avoid collisions with `S A S` and so on. Replace with empty line.\n    if (new_segments.length === 0) {\n      return [ [ s[0] === 'a' ? 'l' : 'L', s[6], s[7] ] ];\n    }\n\n    new_segments.forEach(function (s) {\n      result.push([ 'C', s[2], s[3], s[4], s[5], s[6], s[7] ]);\n    });\n\n    return result;\n  });\n\n  return this;\n};\n\n\n// Converts smooth curves (with missed control point) to generic curves\n//\nSvgPath.prototype.unshort = function () {\n  var segments = this.segments;\n  var prevControlX, prevControlY, prevSegment;\n  var curControlX, curControlY;\n\n  // TODO: add lazy evaluation flag when relative commands supported\n\n  this.iterate(function (s, idx, x, y) {\n    var name = s[0], nameUC = name.toUpperCase(), isRelative;\n\n    // First command MUST be M|m, it's safe to skip.\n    // Protect from access to [-1] for sure.\n    if (!idx) { return; }\n\n    if (nameUC === 'T') { // quadratic curve\n      isRelative = (name === 't');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'Q') {\n        prevControlX = prevSegment[1] - x;\n        prevControlY = prevSegment[2] - y;\n      } else if (prevSegment[0] === 'q') {\n        prevControlX = prevSegment[1] - prevSegment[3];\n        prevControlY = prevSegment[2] - prevSegment[4];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'q' : 'Q',\n        curControlX, curControlY,\n        s[1], s[2]\n      ];\n\n    } else if (nameUC === 'S') { // cubic curve\n      isRelative = (name === 's');\n\n      prevSegment = segments[idx - 1];\n\n      if (prevSegment[0] === 'C') {\n        prevControlX = prevSegment[3] - x;\n        prevControlY = prevSegment[4] - y;\n      } else if (prevSegment[0] === 'c') {\n        prevControlX = prevSegment[3] - prevSegment[5];\n        prevControlY = prevSegment[4] - prevSegment[6];\n      } else {\n        prevControlX = 0;\n        prevControlY = 0;\n      }\n\n      curControlX = -prevControlX;\n      curControlY = -prevControlY;\n\n      if (!isRelative) {\n        curControlX += x;\n        curControlY += y;\n      }\n\n      segments[idx] = [\n        isRelative ? 'c' : 'C',\n        curControlX, curControlY,\n        s[1], s[2], s[3], s[4]\n      ];\n    }\n  });\n\n  return this;\n};\n\n\nmodule.exports = SvgPath;\n","export default \"/* Workspace wrapper: horizontal layout */\\r\\n.KabelWorkspaceWrapper {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #f0f0f0;\\r\\n    /* light gray background */\\r\\n    overflow: hidden;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n/* Toolbox panel (left) */\\r\\n.KabelToolbox {\\r\\n    width: 12%;\\r\\n    min-width: 150px;\\r\\n    height: 100%;\\r\\n    background: rgba(240, 240, 240, 0.95);\\r\\n    border-right: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    padding: 8px;\\r\\n    overflow-y: auto;\\r\\n}\\r\\n\\r\\n/* Context menu container */\\r\\n.KabelContextMenu {\\r\\n    position: absolute;\\r\\n    background: #1e1e2f;\\r\\n    color: #000000;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);\\r\\n    padding: 4px 0;\\r\\n    font-family: 'Segoe UI', sans-serif;\\r\\n    font-size: 14px;\\r\\n    min-width: 160px;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    overflow: visible;\\r\\n    height: auto;\\r\\n    transition: opacity 0.15s ease, transform 0.15s ease;\\r\\n    opacity: 0;\\r\\n    transform: scale(0.95);\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n}\\r\\n\\r\\n/* Show state */\\r\\n.KabelContextMenu.show {\\r\\n    opacity: 1;\\r\\n    transform: scale(1);\\r\\n}\\r\\n\\r\\n/* Individual option */\\r\\n.KabelContextOption {\\r\\n    padding: 8px 16px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s ease, color 0.15s ease;\\r\\n}\\r\\n\\r\\n.KabelContextOption:hover {\\r\\n    background: #b0adb0;\\r\\n    color: #fff;\\r\\n}\\r\\n\\r\\n/* Optional: active click effect */\\r\\n.KabelContextOption:active {\\r\\n    background: #fff;\\r\\n    color: #000;\\r\\n}\\r\\n\\r\\n/* Scrollbar if too many options */\\r\\n.KabelContextMenu::-webkit-scrollbar {\\r\\n    width: 6px;\\r\\n}\\r\\n\\r\\n.KabelContextMenu::-webkit-scrollbar-thumb {\\r\\n    background: rgba(255, 255, 255, 0.2);\\r\\n    border-radius: 3px;\\r\\n}\\r\\n\\r\\n/* Category buttons */\\r\\n\\r\\n.KabelCategoryRow {\\r\\n    background: #fff;\\r\\n    border: 1px solid #ccc;\\r\\n    padding: 4px 8px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    height: 5%;\\r\\n    padding: 6px;\\r\\n    cursor: pointer;\\r\\n    text-align: left;\\r\\n    transition: background 0.2s, color 0.2s;\\r\\n}\\r\\n\\r\\n.KabelToolbox button:hover {\\r\\n    background: #e6e6e6;\\r\\n    color: #333;\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlight {\\r\\n    stroke: yellow !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 255, 0, 0.9));\\r\\n}\\r\\n\\r\\n.KabelConnectionBubbleHighlightWrong {\\r\\n    stroke: rgb(255, 0, 0) !important;\\r\\n    stroke-width: 6px !important;\\r\\n    stroke-linejoin: round;\\r\\n    stroke-linecap: round;\\r\\n    filter: drop-shadow(0 0 6px rgba(255, 0, 0, 0.9));\\r\\n}\\r\\n\\r\\n/* Container */\\r\\n.KabelDropdownMenu {\\r\\n    position: absolute;\\r\\n    display: none;\\r\\n    background: #1e1e1e;\\r\\n    color: #f0f0f0;\\r\\n    font-family: sans-serif;\\r\\n    font-size: 14px;\\r\\n    border: 1px solid #333;\\r\\n    border-radius: 6px;\\r\\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);\\r\\n    padding: 4px 0;\\r\\n    z-index: 9999;\\r\\n    user-select: none;\\r\\n    animation: fadeIn 0.15s ease-out;\\r\\n}\\r\\n\\r\\n/* Dropdown items */\\r\\n.KabelDropdownItem {\\r\\n    padding: 6px 12px;\\r\\n    cursor: pointer;\\r\\n    transition: background 0.15s;\\r\\n}\\r\\n\\r\\n/* Hover + focus states */\\r\\n.KabelDropdownItem:hover,\\r\\n.KabelDropdownItem:focus {\\r\\n    background: #2d2d2d;\\r\\n}\\r\\n\\r\\n/* Active (clicked) state */\\r\\n.KabelDropdownItem:active {\\r\\n    background: #3a3a3a;\\r\\n}\\r\\n\\r\\n/* Optional: highlight selected value */\\r\\n.KabelDropdownItem.selected {\\r\\n    background: #444;\\r\\n    font-weight: 600;\\r\\n}\\r\\n\\r\\n/* Smooth open effect */\\r\\n@keyframes fadeIn {\\r\\n    from {\\r\\n        opacity: 0;\\r\\n        transform: translateY(-3px);\\r\\n    }\\r\\n\\r\\n    to {\\r\\n        opacity: 1;\\r\\n        transform: translateY(0);\\r\\n    }\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\n/* Flyout panel (right) */\\r\\n.KabelFlyout {\\r\\n    width: 20%;\\r\\n    height: 100%;\\r\\n    background: rgba(255, 255, 255, 0.95);\\r\\n    border-left: 1px solid #ccc;\\r\\n    box-sizing: border-box;\\r\\n    overflow-y: auto;\\r\\n    position: relative;\\r\\n    /* for absolute positioning of nodes inside */\\r\\n    display: none;\\r\\n    /* hidden by default */\\r\\n    padding: 8px;\\r\\n}\\r\\n\\r\\n/* Flyout nodes */\\r\\n.KabelFlyoutNode {\\r\\n    padding: 6px 10px;\\r\\n    margin-bottom: 4px;\\r\\n    border-radius: 4px;\\r\\n    cursor: pointer;\\r\\n    user-select: none;\\r\\n    transition: background 0.2s;\\r\\n}\\r\\n\\r\\n.KabelFlyoutNode:hover {\\r\\n    background: #e0e0e0;\\r\\n}\\r\\n\\r\\n/* SVG workspace area */\\r\\n.KabelWorkspaceWrapper svg {\\r\\n    flex: 1;\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background: #fff;\\r\\n    /* white canvas background */\\r\\n    display: block;\\r\\n}\";","import { Element } from '@svgdotjs/svg.js';\r\nimport Connection, { Connectable } from '../src/connection';\r\nimport eventer, { EventArgs } from '../util/eventer';\r\nimport userState from '../util/user-state';\r\nimport Field, { AnyField } from '../src/field';\r\nimport NodeSvg from '../src/nodesvg';\r\nimport waitFrames from '../util/wait-anim-frames';\r\ninterface ConnectionV {\r\n    conn: Connection,\r\n    el: Element,\r\n    args?: EventArgs\r\n}\r\ninterface ConnectionState {\r\n    one: null | ConnectionV,\r\n    two: null | ConnectionV\r\n}\r\n\r\n\r\nconst cState: ConnectionState = {\r\n    one: null,\r\n    two: null\r\n}\r\n\r\n\r\nfunction initConnector(el: Element, args?: EventArgs) {\r\n    args = args as {\r\n        connection: Connection,\r\n        node?: NodeSvg,\r\n        field?: AnyField\r\n    };\r\n    if (args.field && !args.field?.canEditConnector) { // If editing isnt allowed, close the event early.\r\n        return; \r\n    }\r\n    el.on('click', () => {\r\n        const isPrev = args.connection.isPrevious;\r\n\r\n        // First click  must NOT be previous\r\n        if (!cState.one) {\r\n            if (isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            cState.one = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n            userState.setState('connecting')\r\n            return;\r\n        }\r\n\r\n        // Second click  must be previous\r\n        if (!cState.two && (args?.node !== cState.one?.args?.node)) {\r\n            if (!isPrev) {\r\n                el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                })\r\n                return;\r\n            }\r\n            if (cState.one.conn === args.connection) return; // ignore clicking the same again\r\n            cState.two = { conn: args.connection, el, args };\r\n            el.addClass('KabelConnectionBubbleHighlight');\r\n        }\r\n\r\n        // Both are filled  attempt to connect\r\n        if (cState.one && cState.two) {\r\n            if (cState.two.args?.node == cState.one.args?.node || cState.two.args?.node === cState.one?.args?.field?.node) {\r\n                cState.one.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                cState.two.el.addClass('KabelConnectionBubbleHighlightWrong');\r\n                waitFrames(10, () => {\r\n                    if (!cState) return;\r\n                    if (!cState.one || !cState.two) return;\r\n                    cState.one.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.two.el.removeClass('KabelConnectionBubbleHighlightWrong');\r\n                    cState.one = null;\r\n                    cState.two = null;\r\n                })\r\n                userState.removeState('connecting');\r\n                return;\r\n            }\r\n            const { conn: connA } = cState.one;\r\n            const { conn: connB } = cState.two;\r\n\r\n            connA.disconnectTo();\r\n            connB.disconnectFrom();\r\n\r\n            connA.to = cState.two.args?.node;\r\n            connB.from = cState.one.args?.node || cState.one.args?.field;\r\n\r\n            waitFrames(2, () => {\r\n                if (cState.one?.args?.node) {\r\n                    cState.one.args.node.workspace?.redraw();\r\n                } else if (cState.two?.args?.node) {\r\n                    cState.two.args.node.workspace?.redraw();\r\n                }\r\n                cState.one = null;\r\n                cState.two = null;\r\n                userState.removeState('connecting');\r\n            });\r\n        }\r\n    });\r\n    return () => {\r\n        el.off('click'); // removes the click listener\r\n    };\r\n\r\n}\r\n\r\neventer.registerEvent('k_connectbubble', initConnector);\r\n","import { parseColor } from \"../util/parse-color\";\r\nimport { TblxCategoryStruct, TblxNodeStruct } from \"./inject\";\r\nimport Toolbox from \"./toolbox\";\r\nimport { Color } from \"./visual-types\";\r\n\r\n/**\r\n * Represents a category in the toolbox, containing nodes and a label.\r\n */\r\nclass Category {\r\n\t/** Display label for the category */\r\n\tlabel: string;\r\n\t/** Category color */\r\n\tcolor: Color;\r\n\t/** Nodes contained in this category */\r\n\tcontents: TblxNodeStruct[];\r\n\t/** HTML button element representing this category row */\r\n\t_rowDiv!: HTMLButtonElement;\r\n\t/** Reference to parent toolbox */\r\n\t_toolbox: Toolbox;\r\n\r\n\t/**\r\n\t * @param toolbox The parent Toolbox instance\r\n\t * @param cData Category data (label, color, nodes)\r\n\t */\r\n\tconstructor(toolbox: Toolbox, cData: TblxCategoryStruct) {\r\n\t\tthis.label = cData.name;\r\n\t\tthis.color = cData.color;\r\n\t\tthis.contents = cData.contents;\r\n\t\tthis._toolbox = toolbox;\r\n\t\tthis._makeDiv();\r\n\t}\r\n\r\n\t/** Creates the category button in the UI and attaches click events */\r\n\t_makeDiv() {\r\n\t\tconst btn = document.createElement(\"button\");\r\n\t\tbtn.textContent = this.label;\r\n\t\tbtn.className = \"KabelCategoryRow\";\r\n\t\tbtn.style.backgroundColor = parseColor(this.color);\r\n\t\tbtn.style.color = parseColor('#ffffff');\r\n\t\tthis._rowDiv = btn;\r\n\r\n\t\tbtn.addEventListener(\"click\", e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis._toolbox._flyout.clear();\r\n\t\t\tthis._toolbox._flyout.fill(this.contents);\r\n\t\t\tthis._toolbox._flyout.show();\r\n\t\t});\r\n\r\n\t\tthis._toolbox.container.appendChild(btn);\r\n\t}\r\n\r\n\t/**\r\n\t * Refreshes the category UI with new data\r\n\t * @param cData Partial data to update (name, color, contents)\r\n\t */\r\n\trefresh(cData: Partial<TblxCategoryStruct>) {\r\n\t\tif (cData.name !== undefined) {\r\n\t\t\tthis.label = cData.name;\r\n\t\t\tthis._rowDiv.textContent = this.label;\r\n\t\t}\r\n\t\tif (cData.color !== undefined) {\r\n\t\t\tthis.color = cData.color;\r\n\t\t\tthis._rowDiv.style.backgroundColor = parseColor(this.color);\r\n\t\t}\r\n\t\tif (cData.contents !== undefined) {\r\n\t\t\tthis.contents = cData.contents;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Remove category row from the toolbox */\r\n\tdestroy() {\r\n\t\tthis._rowDiv.remove();\r\n\t\tthis._toolbox = null as unknown as Toolbox;\r\n\t}\r\n\r\n\t/** Hide this category from the UI */\r\n\thide() {\r\n\t\tthis._rowDiv.style.display = \"none\";\r\n\t}\r\n\r\n\t/** Show this category in the UI */\r\n\tshow() {\r\n\t\tthis._rowDiv.style.display = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Enable or disable interaction with this category\r\n\t * @param disabled True to disable, false to enable\r\n\t */\r\n\tsetDisabled(disabled: boolean) {\r\n\t\tthis._rowDiv.disabled = disabled;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a plain object representation of this category\r\n\t * @returns JSON-compatible category object\r\n\t */\r\n\ttoJSON(): TblxCategoryStruct {\r\n\t\treturn {\r\n\t\t\tname: this.label,\r\n\t\t\tcolor: this.color,\r\n\t\t\tcontents: this.contents,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default Category;\r\n","import NodeSvg from '../src/nodesvg';\r\nimport WorkspaceSvg from '../src/workspace-svg';\r\nimport { Element } from '@svgdotjs/svg.js';\r\nimport Renderer, { DrawState } from './renderer';\r\nimport RendererConstants from './constants';\r\nimport { parseColor } from '../util/parse-color';\r\nimport {Color} from '../src/visual-types';\r\n\r\nexport class RepresenterNode {\r\n\tnode: NodeSvg;\r\n\tstate: DrawState;\r\n    renderer: Renderer;\r\n\tconstructor(node: NodeSvg, svgState: DrawState, renderer: Renderer) {\r\n        this.renderer = renderer;\r\n\t\tthis.node = node;\r\n\t\tthis.state = svgState;\r\n\r\n\t\t// Attach this wrapper to the node for external access\r\n\t\tnode.svg = this;\r\n\t}\r\n    getConstant(name: keyof RendererConstants) {\r\n        return this.renderer._constants[name];\r\n    }\r\n\t/** Move node visually without changing its relativeCoords */\r\n\tmoveTo(x: number, y: number) {\r\n\t\tthis.state.group!.move(x, y);\r\n\t}\r\n\r\n\t/** Scale node visually */\r\n\tsetScale(scale: number) {\r\n\t\tthis.state.group!.scale(scale);\r\n\t}\r\n\r\n\t/** Apply raw transform string */\r\n\tapplyTransform(transform: string) {\r\n\t\tthis.state.group!.attr({ transform });\r\n\t}\r\n\r\n\t/** Access the raw SVG group */\r\n\tgetRaw() {\r\n\t\treturn this.state.group;\r\n\t}\r\n\r\n\t/** Optional: highlight node */\r\n\thighlight(color = '#ff0') {\r\n        if (!color || color.length == 0 || typeof color !== 'string') {\r\n            this.highlight(parseColor(this.getConstant('NODE_OUTLINE_COLOR') as Color) as string);\r\n            return;\r\n        }\r\n\t\tthis.state.bg!.stroke({ color, width: 2 });\r\n\t}\r\n}\r\n","import Field, { ConnectableField } from \"./field\";\r\nimport NodeSvg from \"./nodesvg\";\r\n\r\n/**\r\n * A node or field that can participate in a connection.\r\n */\r\nexport type Connectable = NodeSvg | null | Field;\r\n\r\n/**\r\n * Represents a connection between two connectable objects.\r\n */\r\nclass Connection {\r\n\t/** The source of the connection */\r\n\tfrom: Connectable;\r\n\t/** The target of the connection */\r\n\tto: Connectable;\r\n\t/** Whether this connection represents a previous connection (affects rendering/logic) */\r\n\tisPrevious: boolean;\r\n\r\n\t/**\r\n\t * Creates a new Connection.\r\n\t * @param from - The source NodeSvg or Field\r\n\t * @param to - The target NodeSvg or Field\r\n\t * @param isPrevious - True if this connection is a previous connection\r\n\t */\r\n\tconstructor(from: Connectable, to: Connectable, isPrevious: boolean = false) {\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\t\tthis.isPrevious = isPrevious;\r\n\t}\r\n\r\n\t/** Returns the target of the connection */\r\n\tgetTo(): Connectable {\r\n\t\treturn this.to;\r\n\t}\r\n\r\n\t/** Returns the source of the connection */\r\n\tgetFrom(): Connectable {\r\n\t\treturn this.from;\r\n\t}\r\n\r\n\t/**\r\n\t * Disconnects this connection from its target.\r\n\t * Safely handles NodeSvg chains and ConnectableFields.\r\n\t */\r\n\tdisconnectTo() {\r\n\t\tif (!this.to) return;\r\n\r\n\t\tif (this.to instanceof NodeSvg && this.to.previousConnection) {\r\n\t\t\tconst prevConn = this.to.previousConnection;\r\n\t\t\tconst prevFrom = prevConn.from;\r\n\r\n\t\t\t// Disconnect NodeSvg chain\r\n\t\t\tif (prevFrom instanceof NodeSvg && prevFrom.nextConnection?.to) {\r\n\t\t\t\tprevFrom.nextConnection.to = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Disconnect Field chain\r\n\t\t\tif (prevFrom instanceof Field && prevFrom.hasConnectable?.()) {\r\n\t\t\t\t(prevFrom as ConnectableField).disconnect();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.to = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Disconnects this connection from its source.\r\n\t * Safely handles NodeSvg chains and ConnectableFields.\r\n\t */\r\n\tdisconnectFrom() {\r\n\t\tif (!this.from) return;\r\n\r\n\t\tif (this.from instanceof NodeSvg && this.from.nextConnection) {\r\n\t\t\tconst next = this.from.nextConnection;\r\n\r\n\t\t\tif (next.to instanceof NodeSvg && next.to.previousConnection?.from) {\r\n\t\t\t\tnext.to.previousConnection.from = null;\r\n\t\t\t} else if (next.to instanceof Field && next.to.hasConnectable()) {\r\n\t\t\t\t(next.to as ConnectableField).disconnect();\r\n\t\t\t}\r\n\r\n\t\t\tnext.to = null;\r\n\t\t} else if (this.from instanceof Field && this.from.hasConnectable()) {\r\n\t\t\t(this.from as ConnectableField).disconnect();\r\n\t\t}\r\n\r\n\t\tthis.from = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the target of this connection (used during deserialization)\r\n\t * @param target - New connection target\r\n\t */\r\n\tsetTo(target: Connectable) {\r\n\t\tthis.to = target;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the source of this connection (used during deserialization)\r\n\t * @param source - New connection source\r\n\t */\r\n\tsetFrom(source: Connectable) {\r\n\t\tthis.from = source;\r\n\t}\r\n\r\n\t/** Completely isolates this connection, clearing both ends */\r\n\tisolate() {\r\n\t\tthis.from = null as any;\r\n\t\tthis.to = null as any;\r\n\t}\r\n}\r\n\r\nexport default Connection;\r\n","import { Element, Rect, Text } from \"@svgdotjs/svg.js\";\r\nimport eventer, { EventSetupFn } from \"../util/eventer\";\r\nimport userState from '../util/user-state';\r\nimport { Renderer } from \"../src\";\r\n\r\nfunction initInputBox(element: Element, args: Record<string, any>) {\r\n    let editing = false;\r\n    let skipNextClick = false;\r\n    let buffer = args.field.getDisplayValue?.() ?? \"\";\r\n    let cursorPos = buffer.length;\r\n    let anchorPos = buffer.length;\r\n    const txt: Text = args.text;\r\n    const rect: Rect = element as Rect;\r\n    const renderer = args.renderer as Renderer;\r\n    const PADDING_X = 4;\r\n    const PADDING_Y = 4;\r\n    let caretLine: Rect | null = null;\r\n    let selectionRect: Rect | null = null;\r\n    // @ts-ignore\r\n    txt!.style('user-select', 'none');\r\n    // @ts-ignore\r\n    rect!.style('user-select', 'none');\r\n\r\n    // Helper: measure width of text using renderer or fallback\r\n    function measureTextWidth(text: string) {\r\n\r\n        if (renderer.measureTextWidth) return renderer.measureTextWidth(text);\r\n        return text.length * 8; // rough fallback\r\n    }\r\n\r\n    function getSelectionRange() {\r\n        const start = Math.min(cursorPos, anchorPos);\r\n        const end = Math.max(cursorPos, anchorPos);\r\n        return { start, end };\r\n    }\r\n\r\n    function hasSelection() {\r\n        return cursorPos !== anchorPos;\r\n    }\r\n\r\n    function deleteSelection() {\r\n        if (!hasSelection()) return false;\r\n        const { start, end } = getSelectionRange();\r\n        buffer = buffer.slice(0, start) + buffer.slice(end);\r\n        cursorPos = start;\r\n        anchorPos = start;\r\n        return true;\r\n    }\r\n\r\n    function updateText() {\r\n        // redraw main text\r\n        txt.text(buffer);\r\n\r\n        const { start, end } = getSelectionRange();\r\n        const { width: totalWidth } = renderer.measureRawField(buffer);\r\n        const { height: rectHeight } = rect.bbox(); // actual rect height\r\n\r\n        const textBBox = txt.bbox();\r\n        const offsetY = (rectHeight - textBBox.height) / 2; // center vertically\r\n\r\n        // --- selection highlight ---\r\n        if (hasSelection()) {\r\n            const textBeforeStart = buffer.slice(0, start);\r\n            const textBeforeEnd = buffer.slice(0, end);\r\n            const highlightX = args.startX + PADDING_X + measureTextWidth(textBeforeStart);\r\n            const highlightWidth = Math.max(measureTextWidth(textBeforeEnd) - measureTextWidth(textBeforeStart), 1);\r\n            const highlightY = offsetY; // use offsetY for vertical alignment\r\n\r\n            if (!selectionRect) {\r\n                // @ts-ignore\r\n                selectionRect = rect.parent()!.rect(highlightWidth, textBBox.height)\r\n                    .fill('#3390ff')\r\n                    .attr({ 'fill-opacity': 0.35 });\r\n                selectionRect!.node.parentNode!.insertBefore(selectionRect!.node, txt.node);\r\n            } else {\r\n                selectionRect.size(highlightWidth, textBBox.height);\r\n            }\r\n\r\n            selectionRect!.move(highlightX, highlightY);\r\n        } else {\r\n            if (selectionRect) { selectionRect.remove(); selectionRect = null; }\r\n        }\r\n\r\n        // --- caret ---\r\n        if (editing) {\r\n            const caretX = args.startX + PADDING_X + measureTextWidth(buffer.slice(0, cursorPos));\r\n            const caretH = textBBox.height;\r\n            // @ts-ignore\r\n            if (!caretLine) caretLine = rect.parent()!.rect(1, caretH).fill(renderer.constants.FIELD_RAW_TEXT_COLOR);\r\n            caretLine!.size(1, caretH).move(caretX, offsetY);\r\n        } else {\r\n            if (caretLine) { caretLine.remove(); caretLine = null; }\r\n        }\r\n\r\n        // --- background rect ---\r\n        rect.size(Math.max(16, totalWidth + PADDING_X * 2), Math.max(rectHeight, textBBox.height + PADDING_Y * 2));\r\n        txt.move(args.startX + PADDING_X, offsetY);\r\n    }\r\n\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (!editing) return;\r\n\r\n        if (e.key === \"Escape\") { e.preventDefault(); stopEditing(); return; }\r\n        if (e.key === \"Enter\") { e.preventDefault(); stopEditing(); return; }\r\n\r\n        if (e.key === \"Backspace\") {\r\n            if (!deleteSelection() && cursorPos > 0) {\r\n                buffer = buffer.slice(0, cursorPos - 1) + buffer.slice(cursorPos);\r\n                cursorPos--;\r\n                anchorPos = cursorPos;\r\n            }\r\n        } else if (e.key === \"Delete\") {\r\n            if (!deleteSelection() && cursorPos < buffer.length) {\r\n                buffer = buffer.slice(0, cursorPos) + buffer.slice(cursorPos + 1);\r\n            }\r\n        } else if (e.key === \"ArrowLeft\") {\r\n            if (e.shiftKey) cursorPos = Math.max(0, cursorPos - 1);\r\n            else { cursorPos = Math.max(0, cursorPos - 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"ArrowRight\") {\r\n            if (e.shiftKey) cursorPos = Math.min(buffer.length, cursorPos + 1);\r\n            else { cursorPos = Math.min(buffer.length, cursorPos + 1); anchorPos = cursorPos; }\r\n        } else if (e.key === \"Home\") {\r\n            if (!e.shiftKey) anchorPos = 0;\r\n            cursorPos = 0;\r\n        } else if (e.key === \"End\") {\r\n            if (!e.shiftKey) anchorPos = buffer.length;\r\n            cursorPos = buffer.length;\r\n        } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {\r\n            if (hasSelection()) deleteSelection();\r\n            buffer = buffer.slice(0, cursorPos) + e.key + buffer.slice(cursorPos);\r\n            cursorPos++;\r\n            anchorPos = cursorPos;\r\n        } else return;\r\n\r\n        e.preventDefault();\r\n        updateText();\r\n        args.field.setValue(buffer);\r\n    }\r\n\r\n    function onClickOutside(ev: MouseEvent) {\r\n        if (!editing) return;\r\n        if (skipNextClick) { skipNextClick = false; return; }\r\n        const target = ev.target as Node;\r\n        if (target !== rect.node && target !== txt.node) stopEditing();\r\n    }\r\n\r\n    function startEditing(ev?: MouseEvent) {\r\n        if (!args.field.canEdit()) { // If editing isnt allowed, close the event early.\r\n            if (editing) stopEditing();\r\n            return;\r\n        }\r\n        if (editing) return;\r\n        editing = true;\r\n        buffer = args.field.getValue?.() ?? \"\";\r\n        cursorPos = buffer.length;\r\n        anchorPos = buffer.length;\r\n\r\n        userState.setState('typing');\r\n\r\n        if (ev) {\r\n            const rectBox = rect.node.getBoundingClientRect();\r\n            const zoom = renderer.getWs().getZoom(); // workspace zoom\r\n            const clickX = (ev.clientX - rectBox.left - PADDING_X) / zoom; // divide by zoom\r\n\r\n            let cumulativeWidth = 0;\r\n            cursorPos = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                const charWidth = measureTextWidth(buffer[i]) / zoom; // scale widths\r\n                if (cumulativeWidth + charWidth / 2 >= clickX) break;\r\n                cumulativeWidth += charWidth;\r\n                cursorPos = i + 1;\r\n            }\r\n        }\r\n\r\n        anchorPos = cursorPos;\r\n        updateText();\r\n        skipNextClick = true;\r\n\r\n        document.addEventListener(\"keydown\", onKeyDown);\r\n        document.addEventListener(\"mousedown\", onClickOutside);\r\n    }\r\n\r\n    function stopEditing() {\r\n        editing = false;\r\n        userState.removeState('typing');\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n        args.field.setValue(buffer);\r\n        updateText();\r\n        renderer.getWs().redraw();\r\n    }\r\n\r\n    rect.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n    txt.on(\"mousedown\", (ev: Event) => startEditing(ev as MouseEvent));\r\n\r\n    updateText();\r\n\r\n    return () => {\r\n        rect.off(\"mousedown\", startEditing as EventListener);\r\n        txt.off(\"mousedown\", startEditing as EventListener);\r\n        document.removeEventListener(\"keydown\", onKeyDown);\r\n        document.removeEventListener(\"mousedown\", onClickOutside);\r\n    };\r\n}\r\n\r\neventer.registerEvent(\"k_inputbox\", initInputBox as EventSetupFn);\r\n","import NodeSvg from '../src/nodesvg';\r\nimport Renderer, { DrawState } from './renderer';\r\nimport { RepresenterNode } from './representer-node';\r\n\r\nexport default class Representer {\r\n\tnodes: Map<string, RepresenterNode> = new Map();\r\n\r\n\t/** Build a representer node for a drawn node */\r\n\tbuild(node: NodeSvg, renderer: Renderer, state: DrawState) {\r\n\t\tif (!node) return;\r\n\t\tconst repNode = new RepresenterNode(node, state, renderer);\r\n\t\tthis.nodes.set(node.id, repNode);\r\n\t\treturn repNode;\r\n\t}\r\n\r\n\t/** Get a representer node by node id */\r\n\tget(nodeId: string): RepresenterNode | undefined {\r\n\t\treturn this.nodes.get(nodeId);\r\n\t}\r\n\r\n\t/** Remove a node from the representer */\r\n\tremove(nodeId: string) {\r\n\t\tthis.nodes.delete(nodeId);\r\n\t}\r\n}\r\n","import WorkspaceController from \"../controllers/base\";\r\nimport unescapeAttr from \"../util/unescape-html\";\r\nimport CommentModel from \"./comment\";\r\nimport Coordinates from \"./coordinates\";\r\nimport ContextOptsRegistry from \"./ctx-menu-registry\";\r\nimport NodeSvg from \"./nodesvg\";\r\nimport Widget from \"./widget\";\r\nimport WorkspaceSvg from \"./workspace-svg\";\r\n\r\nexport type Showable = 'node' | 'ws' | 'html' | 'comment';\r\n\r\n/**\r\n * Describes a context menu option.\r\n */\r\nexport interface ContextMenuOpts {\r\n\t/** Function executed when the option is clicked */\r\n\tclick: (target: NodeSvg | WorkspaceSvg | CommentModel | HTMLElement) => void;\r\n\t/** Optional hover start callback */\r\n\tonHoverStart?: () => void;\r\n\t/** Optional hover end callback */\r\n\tonHoverEnd?: () => void;\r\n\t/** Specifies which target types this option should appear for */\r\n\tshowFor?: Showable | Showable[];\r\n\t/** Text label for the menu option */\r\n\tlabel: string;\r\n\t/** Unique ID for the option */\r\n\tid: string;\r\n}\r\n\r\n/**\r\n * HTML context menu rendered on workspace right-click.\r\n */\r\nclass ContextMenuHTML {\r\n\tworkspace: WorkspaceSvg;\r\n\tcontroller: WorkspaceController;\r\n\twidget: Widget;\r\n\toptions: ContextMenuOpts[];\r\n\r\n\t/**\r\n\t * Create a new context menu for a workspace.\r\n\t * @param workspace - Workspace to attach the context menu to\r\n\t */\r\n\tconstructor(workspace: WorkspaceSvg) {\r\n\t\tthis.workspace = workspace;\r\n\t\tthis.controller = this.workspace.controller;\r\n\t\tthis.widget = new Widget(this.workspace, {\r\n\t\t\tcoords: new Coordinates(0, 0),\r\n\t\t\tname: 'k_contextmenu',\r\n\t\t\tclassName: 'KabelContextMenu'\r\n\t\t});\r\n\r\n\t\t// Override show/hide methods to manipulate CSS\r\n\t\tthis.widget.show = () => {\r\n\t\t\tthis.widget.container.classList.add('show');\r\n\t\t\tthis.widget.container.style.display = 'flex';\r\n\t\t\tthis.widget.visible = true;\r\n\t\t};\r\n\t\tthis.widget.hide = () => {\r\n\t\t\tthis.widget.container.classList.remove('show');\r\n\t\t\tthis.widget.container.style.display = 'none';\r\n\t\t\tthis.widget.visible = false;\r\n\t\t};\r\n\t\tthis.widget.container.style.removeProperty('height');\r\n\t\tthis.widget.container.style.removeProperty('width');\r\n\r\n\t\tthis.widget.hide();\r\n\t\tthis.options = ContextOptsRegistry;\r\n\t\tthis.initListeners();\r\n\t}\r\n\r\n\t/**\r\n\t * Renders context menu options for a given target.\r\n\t * @param target - The object the context menu is for\r\n\t */\r\n\trenderOptions(target: NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null) {\r\n\t\tthis.widget.container.innerHTML = '';\r\n\r\n\t\tconst filteredOptions = this.options.filter(opt => {\r\n\t\t\tif (!target) return false;\r\n\t\t\tconst showFor = Array.isArray(opt.showFor) ? opt.showFor : [opt.showFor];\r\n\r\n\t\t\tif (target instanceof NodeSvg && showFor.includes('node')) return true;\r\n\t\t\tif (target instanceof WorkspaceSvg && showFor.includes('ws')) return true;\r\n\t\t\tif (target instanceof HTMLElement && !(target instanceof SVGSVGElement) && showFor.includes('html')) return true;\r\n\t\t\tif (target instanceof CommentModel && showFor.includes('comment')) return true;\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tfilteredOptions.forEach((opt, i) => {\r\n\t\t\tconst el = document.createElement('div');\r\n\t\t\tel.className = 'KabelContextOption';\r\n\t\t\tel.textContent = opt.label || 'Option ' + i;\r\n\r\n\t\t\tel.addEventListener('click', () => {\r\n\t\t\t\tif (target) opt.click(target);\r\n\t\t\t\tthis.hide();\r\n\t\t\t});\r\n\t\t\tif (opt.onHoverStart) el.addEventListener('mouseenter', () => opt.onHoverStart?.());\r\n\t\t\tif (opt.onHoverEnd) el.addEventListener('mouseleave', () => opt.onHoverEnd?.());\r\n\r\n\t\t\tthis.widget.container.appendChild(el);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes event listeners for showing/hiding the menu.\r\n\t */\r\n\tinitListeners() {\r\n\t\tthis.workspace.svg.node.addEventListener('contextmenu', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tconst mouseX = e.clientX;\r\n\t\t\tconst mouseY = e.clientY;\r\n\r\n\t\t\tthis.widget.setCoords(new Coordinates(mouseX, mouseY));\r\n\t\t\tthis.renderOptions(this.target);\r\n\t\t\tthis.widget.show();\r\n\t\t});\r\n\r\n\t\tdocument.addEventListener('mousedown', e => {\r\n\t\t\tif (!this.widget.container.contains(e.target as Node)) {\r\n\t\t\t\tthis.hide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/** Hides the context menu */\r\n\thide() {\r\n\t\tthis.widget.hide();\r\n\t}\r\n\r\n\t/** Returns the current mouse position in workspace coordinates */\r\n\tget mousePos(): { x: number, y: number } {\r\n\t\treturn this.controller.mousePos;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the target element under the mouse for context menu.\r\n\t */\r\n\tget target(): NodeSvg | WorkspaceSvg | HTMLElement | CommentModel | null {\r\n\t\tlet el = document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n\r\n\t\tif ((el as unknown as SVGSVGElement) === this.workspace.svg.node) return this.workspace;\r\n\r\n\t\twhile (el && el !== document.body) {\r\n\t\t\tif (el.tagName.toLowerCase() === 'g' && el.hasAttribute('data-node-id')) {\r\n\t\t\t\tconst nodeId = unescapeAttr(el.getAttribute('data-node-id') as string);\r\n\t\t\t\tconst node = this.workspace.getNode(nodeId);\r\n\t\t\t\tif (node) return node;\r\n\t\t\t}\r\n\t\t\tif (el.tagName.toLowerCase() === 'g' && el.hasAttribute('comment-data')) {\r\n\t\t\t\tconst dta = JSON.parse(el.getAttribute('comment-data') as string);\r\n\t\t\t\tif (!dta.id && !dta.isws) continue;\r\n\t\t\t\tif (dta.isws) {\r\n\t\t\t\t\tfor (let comment of this.workspace._commentDB) {\r\n\t\t\t\t\t\tif (comment.id === dta.id) return comment;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let [_, node] of this.workspace._nodeDB) {\r\n\t\t\t\t\t\tif (node.comment && node.comment.id == dta.id) return node.comment;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tel = el.parentElement;\r\n\t\t}\r\n\r\n\t\treturn document.elementFromPoint(this.mousePos.x, this.mousePos.y) as HTMLElement | null;\r\n\t}\r\n}\r\n\r\nexport default ContextMenuHTML;\r\n","/*!\n* @svgdotjs/svg.js - A lightweight library for manipulating and animating SVG.\n* @version 3.2.4\n* https://svgjs.dev/\n*\n* @copyright Wout Fierens <wout@mick-wout.com>\n* @license MIT\n*\n* BUILT: Thu Jun 27 2024 12:00:16 GMT+0200 (Central European Summer Time)\n*/;\n'use strict';\n\nconst methods$1 = {};\nconst names = [];\nfunction registerMethods(name, m) {\n  if (Array.isArray(name)) {\n    for (const _name of name) {\n      registerMethods(_name, m);\n    }\n    return;\n  }\n  if (typeof name === 'object') {\n    for (const _name in name) {\n      registerMethods(_name, name[_name]);\n    }\n    return;\n  }\n  addMethodNames(Object.getOwnPropertyNames(m));\n  methods$1[name] = Object.assign(methods$1[name] || {}, m);\n}\nfunction getMethodsFor(name) {\n  return methods$1[name] || {};\n}\nfunction getMethodNames() {\n  return [...new Set(names)];\n}\nfunction addMethodNames(_names) {\n  names.push(..._names);\n}\n\n// Map function\nfunction map(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    result.push(block(array[i]));\n  }\n  return result;\n}\n\n// Filter function\nfunction filter(array, block) {\n  let i;\n  const il = array.length;\n  const result = [];\n  for (i = 0; i < il; i++) {\n    if (block(array[i])) {\n      result.push(array[i]);\n    }\n  }\n  return result;\n}\n\n// Degrees to radians\nfunction radians(d) {\n  return d % 360 * Math.PI / 180;\n}\n\n// Radians to degrees\nfunction degrees(r) {\n  return r * 180 / Math.PI % 360;\n}\n\n// Convert camel cased string to dash separated\nfunction unCamelCase(s) {\n  return s.replace(/([A-Z])/g, function (m, g) {\n    return '-' + g.toLowerCase();\n  });\n}\n\n// Capitalize first letter of a string\nfunction capitalize(s) {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\n// Calculate proportional width and height values when necessary\nfunction proportionalSize(element, width, height, box) {\n  if (width == null || height == null) {\n    box = box || element.bbox();\n    if (width == null) {\n      width = box.width / box.height * height;\n    } else if (height == null) {\n      height = box.height / box.width * width;\n    }\n  }\n  return {\n    width: width,\n    height: height\n  };\n}\n\n/**\n * This function adds support for string origins.\n * It searches for an origin in o.origin o.ox and o.originX.\n * This way, origin: {x: 'center', y: 50} can be passed as well as ox: 'center', oy: 50\n **/\nfunction getOrigin(o, element) {\n  const origin = o.origin;\n  // First check if origin is in ox or originX\n  let ox = o.ox != null ? o.ox : o.originX != null ? o.originX : 'center';\n  let oy = o.oy != null ? o.oy : o.originY != null ? o.originY : 'center';\n\n  // Then check if origin was used and overwrite in that case\n  if (origin != null) {\n    [ox, oy] = Array.isArray(origin) ? origin : typeof origin === 'object' ? [origin.x, origin.y] : [origin, origin];\n  }\n\n  // Make sure to only call bbox when actually needed\n  const condX = typeof ox === 'string';\n  const condY = typeof oy === 'string';\n  if (condX || condY) {\n    const {\n      height,\n      width,\n      x,\n      y\n    } = element.bbox();\n\n    // And only overwrite if string was passed for this specific axis\n    if (condX) {\n      ox = ox.includes('left') ? x : ox.includes('right') ? x + width : x + width / 2;\n    }\n    if (condY) {\n      oy = oy.includes('top') ? y : oy.includes('bottom') ? y + height : y + height / 2;\n    }\n  }\n\n  // Return the origin as it is if it wasn't a string\n  return [ox, oy];\n}\nconst descriptiveElements = new Set(['desc', 'metadata', 'title']);\nconst isDescriptive = element => descriptiveElements.has(element.nodeName);\nconst writeDataToDom = (element, data, defaults = {}) => {\n  const cloned = {\n    ...data\n  };\n  for (const key in cloned) {\n    if (cloned[key].valueOf() === defaults[key]) {\n      delete cloned[key];\n    }\n  }\n  if (Object.keys(cloned).length) {\n    element.node.setAttribute('data-svgjs', JSON.stringify(cloned)); // see #428\n  } else {\n    element.node.removeAttribute('data-svgjs');\n    element.node.removeAttribute('svgjs:data');\n  }\n};\n\nvar utils = {\n  __proto__: null,\n  capitalize: capitalize,\n  degrees: degrees,\n  filter: filter,\n  getOrigin: getOrigin,\n  isDescriptive: isDescriptive,\n  map: map,\n  proportionalSize: proportionalSize,\n  radians: radians,\n  unCamelCase: unCamelCase,\n  writeDataToDom: writeDataToDom\n};\n\n// Default namespaces\nconst svg = 'http://www.w3.org/2000/svg';\nconst html = 'http://www.w3.org/1999/xhtml';\nconst xmlns = 'http://www.w3.org/2000/xmlns/';\nconst xlink = 'http://www.w3.org/1999/xlink';\n\nvar namespaces = {\n  __proto__: null,\n  html: html,\n  svg: svg,\n  xlink: xlink,\n  xmlns: xmlns\n};\n\nconst globals = {\n  window: typeof window === 'undefined' ? null : window,\n  document: typeof document === 'undefined' ? null : document\n};\nfunction registerWindow(win = null, doc = null) {\n  globals.window = win;\n  globals.document = doc;\n}\nconst save = {};\nfunction saveWindow() {\n  save.window = globals.window;\n  save.document = globals.document;\n}\nfunction restoreWindow() {\n  globals.window = save.window;\n  globals.document = save.document;\n}\nfunction withWindow(win, fn) {\n  saveWindow();\n  registerWindow(win, win.document);\n  fn(win, win.document);\n  restoreWindow();\n}\nfunction getWindow() {\n  return globals.window;\n}\n\nclass Base {\n  // constructor (node/*, {extensions = []} */) {\n  //   // this.tags = []\n  //   //\n  //   // for (let extension of extensions) {\n  //   //   extension.setup.call(this, node)\n  //   //   this.tags.push(extension.name)\n  //   // }\n  // }\n}\n\nconst elements = {};\nconst root = '___SYMBOL___ROOT___';\n\n// Method for element creation\nfunction create(name, ns = svg) {\n  // create element\n  return globals.document.createElementNS(ns, name);\n}\nfunction makeInstance(element, isHTML = false) {\n  if (element instanceof Base) return element;\n  if (typeof element === 'object') {\n    return adopter(element);\n  }\n  if (element == null) {\n    return new elements[root]();\n  }\n  if (typeof element === 'string' && element.charAt(0) !== '<') {\n    return adopter(globals.document.querySelector(element));\n  }\n\n  // Make sure, that HTML elements are created with the correct namespace\n  const wrapper = isHTML ? globals.document.createElement('div') : create('svg');\n  wrapper.innerHTML = element;\n\n  // We can use firstChild here because we know,\n  // that the first char is < and thus an element\n  element = adopter(wrapper.firstChild);\n\n  // make sure, that element doesn't have its wrapper attached\n  wrapper.removeChild(wrapper.firstChild);\n  return element;\n}\nfunction nodeOrNew(name, node) {\n  return node && (node instanceof globals.window.Node || node.ownerDocument && node instanceof node.ownerDocument.defaultView.Node) ? node : create(name);\n}\n\n// Adopt existing svg elements\nfunction adopt(node) {\n  // check for presence of node\n  if (!node) return null;\n\n  // make sure a node isn't already adopted\n  if (node.instance instanceof Base) return node.instance;\n  if (node.nodeName === '#document-fragment') {\n    return new elements.Fragment(node);\n  }\n\n  // initialize variables\n  let className = capitalize(node.nodeName || 'Dom');\n\n  // Make sure that gradients are adopted correctly\n  if (className === 'LinearGradient' || className === 'RadialGradient') {\n    className = 'Gradient';\n\n    // Fallback to Dom if element is not known\n  } else if (!elements[className]) {\n    className = 'Dom';\n  }\n  return new elements[className](node);\n}\nlet adopter = adopt;\nfunction mockAdopt(mock = adopt) {\n  adopter = mock;\n}\nfunction register(element, name = element.name, asRoot = false) {\n  elements[name] = element;\n  if (asRoot) elements[root] = element;\n  addMethodNames(Object.getOwnPropertyNames(element.prototype));\n  return element;\n}\nfunction getClass(name) {\n  return elements[name];\n}\n\n// Element id sequence\nlet did = 1000;\n\n// Get next named element id\nfunction eid(name) {\n  return 'Svgjs' + capitalize(name) + did++;\n}\n\n// Deep new id assignment\nfunction assignNewId(node) {\n  // do the same for SVG child nodes as well\n  for (let i = node.children.length - 1; i >= 0; i--) {\n    assignNewId(node.children[i]);\n  }\n  if (node.id) {\n    node.id = eid(node.nodeName);\n    return node;\n  }\n  return node;\n}\n\n// Method for extending objects\nfunction extend(modules, methods) {\n  let key, i;\n  modules = Array.isArray(modules) ? modules : [modules];\n  for (i = modules.length - 1; i >= 0; i--) {\n    for (key in methods) {\n      modules[i].prototype[key] = methods[key];\n    }\n  }\n}\nfunction wrapWithAttrCheck(fn) {\n  return function (...args) {\n    const o = args[args.length - 1];\n    if (o && o.constructor === Object && !(o instanceof Array)) {\n      return fn.apply(this, args.slice(0, -1)).attr(o);\n    } else {\n      return fn.apply(this, args);\n    }\n  };\n}\n\n// Get all siblings, including myself\nfunction siblings() {\n  return this.parent().children();\n}\n\n// Get the current position siblings\nfunction position() {\n  return this.parent().index(this);\n}\n\n// Get the next element (will return null if there is none)\nfunction next() {\n  return this.siblings()[this.position() + 1];\n}\n\n// Get the next element (will return null if there is none)\nfunction prev() {\n  return this.siblings()[this.position() - 1];\n}\n\n// Send given element one step forward\nfunction forward() {\n  const i = this.position();\n  const p = this.parent();\n\n  // move node one step forward\n  p.add(this.remove(), i + 1);\n  return this;\n}\n\n// Send given element one step backward\nfunction backward() {\n  const i = this.position();\n  const p = this.parent();\n  p.add(this.remove(), i ? i - 1 : 0);\n  return this;\n}\n\n// Send given element all the way to the front\nfunction front() {\n  const p = this.parent();\n\n  // Move node forward\n  p.add(this.remove());\n  return this;\n}\n\n// Send given element all the way to the back\nfunction back() {\n  const p = this.parent();\n\n  // Move node back\n  p.add(this.remove(), 0);\n  return this;\n}\n\n// Inserts a given element before the targeted element\nfunction before(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i);\n  return this;\n}\n\n// Inserts a given element after the targeted element\nfunction after(element) {\n  element = makeInstance(element);\n  element.remove();\n  const i = this.position();\n  this.parent().add(element, i + 1);\n  return this;\n}\nfunction insertBefore(element) {\n  element = makeInstance(element);\n  element.before(this);\n  return this;\n}\nfunction insertAfter(element) {\n  element = makeInstance(element);\n  element.after(this);\n  return this;\n}\nregisterMethods('Dom', {\n  siblings,\n  position,\n  next,\n  prev,\n  forward,\n  backward,\n  front,\n  back,\n  before,\n  after,\n  insertBefore,\n  insertAfter\n});\n\n// Parse unit value\nconst numberAndUnit = /^([+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?)([a-z%]*)$/i;\n\n// Parse hex value\nconst hex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\n\n// Parse rgb value\nconst rgb = /rgb\\((\\d+),(\\d+),(\\d+)\\)/;\n\n// Parse reference id\nconst reference = /(#[a-z_][a-z0-9\\-_]*)/i;\n\n// splits a transformation chain\nconst transforms = /\\)\\s*,?\\s*/;\n\n// Whitespace\nconst whitespace = /\\s/g;\n\n// Test hex value\nconst isHex = /^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i;\n\n// Test rgb value\nconst isRgb = /^rgb\\(/;\n\n// Test for blank string\nconst isBlank = /^(\\s+)?$/;\n\n// Test for numeric string\nconst isNumber = /^[+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n// Test for image url\nconst isImage = /\\.(jpg|jpeg|png|gif|svg)(\\?[^=]+.*)?/i;\n\n// split at whitespace and comma\nconst delimiter = /[\\s,]+/;\n\n// Test for path letter\nconst isPathLetter = /[MLHVCSQTAZ]/i;\n\nvar regex = {\n  __proto__: null,\n  delimiter: delimiter,\n  hex: hex,\n  isBlank: isBlank,\n  isHex: isHex,\n  isImage: isImage,\n  isNumber: isNumber,\n  isPathLetter: isPathLetter,\n  isRgb: isRgb,\n  numberAndUnit: numberAndUnit,\n  reference: reference,\n  rgb: rgb,\n  transforms: transforms,\n  whitespace: whitespace\n};\n\n// Return array of classes on the node\nfunction classes() {\n  const attr = this.attr('class');\n  return attr == null ? [] : attr.trim().split(delimiter);\n}\n\n// Return true if class exists on the node, false otherwise\nfunction hasClass(name) {\n  return this.classes().indexOf(name) !== -1;\n}\n\n// Add class to the node\nfunction addClass(name) {\n  if (!this.hasClass(name)) {\n    const array = this.classes();\n    array.push(name);\n    this.attr('class', array.join(' '));\n  }\n  return this;\n}\n\n// Remove class from the node\nfunction removeClass(name) {\n  if (this.hasClass(name)) {\n    this.attr('class', this.classes().filter(function (c) {\n      return c !== name;\n    }).join(' '));\n  }\n  return this;\n}\n\n// Toggle the presence of a class on the node\nfunction toggleClass(name) {\n  return this.hasClass(name) ? this.removeClass(name) : this.addClass(name);\n}\nregisterMethods('Dom', {\n  classes,\n  hasClass,\n  addClass,\n  removeClass,\n  toggleClass\n});\n\n// Dynamic style generator\nfunction css(style, val) {\n  const ret = {};\n  if (arguments.length === 0) {\n    // get full style as object\n    this.node.style.cssText.split(/\\s*;\\s*/).filter(function (el) {\n      return !!el.length;\n    }).forEach(function (el) {\n      const t = el.split(/\\s*:\\s*/);\n      ret[t[0]] = t[1];\n    });\n    return ret;\n  }\n  if (arguments.length < 2) {\n    // get style properties as array\n    if (Array.isArray(style)) {\n      for (const name of style) {\n        const cased = name;\n        ret[name] = this.node.style.getPropertyValue(cased);\n      }\n      return ret;\n    }\n\n    // get style for property\n    if (typeof style === 'string') {\n      return this.node.style.getPropertyValue(style);\n    }\n\n    // set styles in object\n    if (typeof style === 'object') {\n      for (const name in style) {\n        // set empty string if null/undefined/'' was given\n        this.node.style.setProperty(name, style[name] == null || isBlank.test(style[name]) ? '' : style[name]);\n      }\n    }\n  }\n\n  // set style for property\n  if (arguments.length === 2) {\n    this.node.style.setProperty(style, val == null || isBlank.test(val) ? '' : val);\n  }\n  return this;\n}\n\n// Show element\nfunction show() {\n  return this.css('display', '');\n}\n\n// Hide element\nfunction hide() {\n  return this.css('display', 'none');\n}\n\n// Is element visible?\nfunction visible() {\n  return this.css('display') !== 'none';\n}\nregisterMethods('Dom', {\n  css,\n  show,\n  hide,\n  visible\n});\n\n// Store data values on svg nodes\nfunction data(a, v, r) {\n  if (a == null) {\n    // get an object of attributes\n    return this.data(map(filter(this.node.attributes, el => el.nodeName.indexOf('data-') === 0), el => el.nodeName.slice(5)));\n  } else if (a instanceof Array) {\n    const data = {};\n    for (const key of a) {\n      data[key] = this.data(key);\n    }\n    return data;\n  } else if (typeof a === 'object') {\n    for (v in a) {\n      this.data(v, a[v]);\n    }\n  } else if (arguments.length < 2) {\n    try {\n      return JSON.parse(this.attr('data-' + a));\n    } catch (e) {\n      return this.attr('data-' + a);\n    }\n  } else {\n    this.attr('data-' + a, v === null ? null : r === true || typeof v === 'string' || typeof v === 'number' ? v : JSON.stringify(v));\n  }\n  return this;\n}\nregisterMethods('Dom', {\n  data\n});\n\n// Remember arbitrary data\nfunction remember(k, v) {\n  // remember every item in an object individually\n  if (typeof arguments[0] === 'object') {\n    for (const key in k) {\n      this.remember(key, k[key]);\n    }\n  } else if (arguments.length === 1) {\n    // retrieve memory\n    return this.memory()[k];\n  } else {\n    // store memory\n    this.memory()[k] = v;\n  }\n  return this;\n}\n\n// Erase a given memory\nfunction forget() {\n  if (arguments.length === 0) {\n    this._memory = {};\n  } else {\n    for (let i = arguments.length - 1; i >= 0; i--) {\n      delete this.memory()[arguments[i]];\n    }\n  }\n  return this;\n}\n\n// This triggers creation of a new hidden class which is not performant\n// However, this function is not rarely used so it will not happen frequently\n// Return local memory object\nfunction memory() {\n  return this._memory = this._memory || {};\n}\nregisterMethods('Dom', {\n  remember,\n  forget,\n  memory\n});\n\nfunction sixDigitHex(hex) {\n  return hex.length === 4 ? ['#', hex.substring(1, 2), hex.substring(1, 2), hex.substring(2, 3), hex.substring(2, 3), hex.substring(3, 4), hex.substring(3, 4)].join('') : hex;\n}\nfunction componentHex(component) {\n  const integer = Math.round(component);\n  const bounded = Math.max(0, Math.min(255, integer));\n  const hex = bounded.toString(16);\n  return hex.length === 1 ? '0' + hex : hex;\n}\nfunction is(object, space) {\n  for (let i = space.length; i--;) {\n    if (object[space[i]] == null) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction getParameters(a, b) {\n  const params = is(a, 'rgb') ? {\n    _a: a.r,\n    _b: a.g,\n    _c: a.b,\n    _d: 0,\n    space: 'rgb'\n  } : is(a, 'xyz') ? {\n    _a: a.x,\n    _b: a.y,\n    _c: a.z,\n    _d: 0,\n    space: 'xyz'\n  } : is(a, 'hsl') ? {\n    _a: a.h,\n    _b: a.s,\n    _c: a.l,\n    _d: 0,\n    space: 'hsl'\n  } : is(a, 'lab') ? {\n    _a: a.l,\n    _b: a.a,\n    _c: a.b,\n    _d: 0,\n    space: 'lab'\n  } : is(a, 'lch') ? {\n    _a: a.l,\n    _b: a.c,\n    _c: a.h,\n    _d: 0,\n    space: 'lch'\n  } : is(a, 'cmyk') ? {\n    _a: a.c,\n    _b: a.m,\n    _c: a.y,\n    _d: a.k,\n    space: 'cmyk'\n  } : {\n    _a: 0,\n    _b: 0,\n    _c: 0,\n    space: 'rgb'\n  };\n  params.space = b || params.space;\n  return params;\n}\nfunction cieSpace(space) {\n  if (space === 'lab' || space === 'xyz' || space === 'lch') {\n    return true;\n  } else {\n    return false;\n  }\n}\nfunction hueToRgb(p, q, t) {\n  if (t < 0) t += 1;\n  if (t > 1) t -= 1;\n  if (t < 1 / 6) return p + (q - p) * 6 * t;\n  if (t < 1 / 2) return q;\n  if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n  return p;\n}\nclass Color {\n  constructor(...inputs) {\n    this.init(...inputs);\n  }\n\n  // Test if given value is a color\n  static isColor(color) {\n    return color && (color instanceof Color || this.isRgb(color) || this.test(color));\n  }\n\n  // Test if given value is an rgb object\n  static isRgb(color) {\n    return color && typeof color.r === 'number' && typeof color.g === 'number' && typeof color.b === 'number';\n  }\n\n  /*\n  Generating random colors\n  */\n  static random(mode = 'vibrant', t) {\n    // Get the math modules\n    const {\n      random,\n      round,\n      sin,\n      PI: pi\n    } = Math;\n\n    // Run the correct generator\n    if (mode === 'vibrant') {\n      const l = (81 - 57) * random() + 57;\n      const c = (83 - 45) * random() + 45;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'sine') {\n      t = t == null ? random() : t;\n      const r = round(80 * sin(2 * pi * t / 0.5 + 0.01) + 150);\n      const g = round(50 * sin(2 * pi * t / 0.5 + 4.6) + 200);\n      const b = round(100 * sin(2 * pi * t / 0.5 + 2.3) + 150);\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'pastel') {\n      const l = (94 - 86) * random() + 86;\n      const c = (26 - 9) * random() + 9;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'dark') {\n      const l = 10 + 10 * random();\n      const c = (125 - 75) * random() + 86;\n      const h = 360 * random();\n      const color = new Color(l, c, h, 'lch');\n      return color;\n    } else if (mode === 'rgb') {\n      const r = 255 * random();\n      const g = 255 * random();\n      const b = 255 * random();\n      const color = new Color(r, g, b);\n      return color;\n    } else if (mode === 'lab') {\n      const l = 100 * random();\n      const a = 256 * random() - 128;\n      const b = 256 * random() - 128;\n      const color = new Color(l, a, b, 'lab');\n      return color;\n    } else if (mode === 'grey') {\n      const grey = 255 * random();\n      const color = new Color(grey, grey, grey);\n      return color;\n    } else {\n      throw new Error('Unsupported random color mode');\n    }\n  }\n\n  // Test if given value is a color string\n  static test(color) {\n    return typeof color === 'string' && (isHex.test(color) || isRgb.test(color));\n  }\n  cmyk() {\n    // Get the rgb values for the current color\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Get the cmyk values in an unbounded format\n    const k = Math.min(1 - r, 1 - g, 1 - b);\n    if (k === 1) {\n      // Catch the black case\n      return new Color(0, 0, 0, 1, 'cmyk');\n    }\n    const c = (1 - r - k) / (1 - k);\n    const m = (1 - g - k) / (1 - k);\n    const y = (1 - b - k) / (1 - k);\n\n    // Construct the new color\n    const color = new Color(c, m, y, k, 'cmyk');\n    return color;\n  }\n  hsl() {\n    // Get the rgb values\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const [r, g, b] = [_a, _b, _c].map(v => v / 255);\n\n    // Find the maximum and minimum values to get the lightness\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    const l = (max + min) / 2;\n\n    // If the r, g, v values are identical then we are grey\n    const isGrey = max === min;\n\n    // Calculate the hue and saturation\n    const delta = max - min;\n    const s = isGrey ? 0 : l > 0.5 ? delta / (2 - max - min) : delta / (max + min);\n    const h = isGrey ? 0 : max === r ? ((g - b) / delta + (g < b ? 6 : 0)) / 6 : max === g ? ((b - r) / delta + 2) / 6 : max === b ? ((r - g) / delta + 4) / 6 : 0;\n\n    // Construct and return the new color\n    const color = new Color(360 * h, 100 * s, 100 * l, 'hsl');\n    return color;\n  }\n  init(a = 0, b = 0, c = 0, d = 0, space = 'rgb') {\n    // This catches the case when a falsy value is passed like ''\n    a = !a ? 0 : a;\n\n    // Reset all values in case the init function is rerun with new color space\n    if (this.space) {\n      for (const component in this.space) {\n        delete this[this.space[component]];\n      }\n    }\n    if (typeof a === 'number') {\n      // Allow for the case that we don't need d...\n      space = typeof d === 'string' ? d : space;\n      d = typeof d === 'string' ? 0 : d;\n\n      // Assign the values straight to the color\n      Object.assign(this, {\n        _a: a,\n        _b: b,\n        _c: c,\n        _d: d,\n        space\n      });\n      // If the user gave us an array, make the color from it\n    } else if (a instanceof Array) {\n      this.space = b || (typeof a[3] === 'string' ? a[3] : a[4]) || 'rgb';\n      Object.assign(this, {\n        _a: a[0],\n        _b: a[1],\n        _c: a[2],\n        _d: a[3] || 0\n      });\n    } else if (a instanceof Object) {\n      // Set the object up and assign its values directly\n      const values = getParameters(a, b);\n      Object.assign(this, values);\n    } else if (typeof a === 'string') {\n      if (isRgb.test(a)) {\n        const noWhitespace = a.replace(whitespace, '');\n        const [_a, _b, _c] = rgb.exec(noWhitespace).slice(1, 4).map(v => parseInt(v));\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else if (isHex.test(a)) {\n        const hexParse = v => parseInt(v, 16);\n        const [, _a, _b, _c] = hex.exec(sixDigitHex(a)).map(hexParse);\n        Object.assign(this, {\n          _a,\n          _b,\n          _c,\n          _d: 0,\n          space: 'rgb'\n        });\n      } else throw Error(\"Unsupported string format, can't construct Color\");\n    }\n\n    // Now add the components as a convenience\n    const {\n      _a,\n      _b,\n      _c,\n      _d\n    } = this;\n    const components = this.space === 'rgb' ? {\n      r: _a,\n      g: _b,\n      b: _c\n    } : this.space === 'xyz' ? {\n      x: _a,\n      y: _b,\n      z: _c\n    } : this.space === 'hsl' ? {\n      h: _a,\n      s: _b,\n      l: _c\n    } : this.space === 'lab' ? {\n      l: _a,\n      a: _b,\n      b: _c\n    } : this.space === 'lch' ? {\n      l: _a,\n      c: _b,\n      h: _c\n    } : this.space === 'cmyk' ? {\n      c: _a,\n      m: _b,\n      y: _c,\n      k: _d\n    } : {};\n    Object.assign(this, components);\n  }\n  lab() {\n    // Get the xyz color\n    const {\n      x,\n      y,\n      z\n    } = this.xyz();\n\n    // Get the lab components\n    const l = 116 * y - 16;\n    const a = 500 * (x - y);\n    const b = 200 * (y - z);\n\n    // Construct and return a new color\n    const color = new Color(l, a, b, 'lab');\n    return color;\n  }\n  lch() {\n    // Get the lab color directly\n    const {\n      l,\n      a,\n      b\n    } = this.lab();\n\n    // Get the chromaticity and the hue using polar coordinates\n    const c = Math.sqrt(a ** 2 + b ** 2);\n    let h = 180 * Math.atan2(b, a) / Math.PI;\n    if (h < 0) {\n      h *= -1;\n      h = 360 - h;\n    }\n\n    // Make a new color and return it\n    const color = new Color(l, c, h, 'lch');\n    return color;\n  }\n  /*\n  Conversion Methods\n  */\n\n  rgb() {\n    if (this.space === 'rgb') {\n      return this;\n    } else if (cieSpace(this.space)) {\n      // Convert to the xyz color space\n      let {\n        x,\n        y,\n        z\n      } = this;\n      if (this.space === 'lab' || this.space === 'lch') {\n        // Get the values in the lab space\n        let {\n          l,\n          a,\n          b\n        } = this;\n        if (this.space === 'lch') {\n          const {\n            c,\n            h\n          } = this;\n          const dToR = Math.PI / 180;\n          a = c * Math.cos(dToR * h);\n          b = c * Math.sin(dToR * h);\n        }\n\n        // Undo the nonlinear function\n        const yL = (l + 16) / 116;\n        const xL = a / 500 + yL;\n        const zL = yL - b / 200;\n\n        // Get the xyz values\n        const ct = 16 / 116;\n        const mx = 0.008856;\n        const nm = 7.787;\n        x = 0.95047 * (xL ** 3 > mx ? xL ** 3 : (xL - ct) / nm);\n        y = 1.0 * (yL ** 3 > mx ? yL ** 3 : (yL - ct) / nm);\n        z = 1.08883 * (zL ** 3 > mx ? zL ** 3 : (zL - ct) / nm);\n      }\n\n      // Convert xyz to unbounded rgb values\n      const rU = x * 3.2406 + y * -1.5372 + z * -0.4986;\n      const gU = x * -0.9689 + y * 1.8758 + z * 0.0415;\n      const bU = x * 0.0557 + y * -0.204 + z * 1.057;\n\n      // Convert the values to true rgb values\n      const pow = Math.pow;\n      const bd = 0.0031308;\n      const r = rU > bd ? 1.055 * pow(rU, 1 / 2.4) - 0.055 : 12.92 * rU;\n      const g = gU > bd ? 1.055 * pow(gU, 1 / 2.4) - 0.055 : 12.92 * gU;\n      const b = bU > bd ? 1.055 * pow(bU, 1 / 2.4) - 0.055 : 12.92 * bU;\n\n      // Make and return the color\n      const color = new Color(255 * r, 255 * g, 255 * b);\n      return color;\n    } else if (this.space === 'hsl') {\n      // https://bgrins.github.io/TinyColor/docs/tinycolor.html\n      // Get the current hsl values\n      let {\n        h,\n        s,\n        l\n      } = this;\n      h /= 360;\n      s /= 100;\n      l /= 100;\n\n      // If we are grey, then just make the color directly\n      if (s === 0) {\n        l *= 255;\n        const color = new Color(l, l, l);\n        return color;\n      }\n\n      // TODO I have no idea what this does :D If you figure it out, tell me!\n      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      const p = 2 * l - q;\n\n      // Get the rgb values\n      const r = 255 * hueToRgb(p, q, h + 1 / 3);\n      const g = 255 * hueToRgb(p, q, h);\n      const b = 255 * hueToRgb(p, q, h - 1 / 3);\n\n      // Make a new color\n      const color = new Color(r, g, b);\n      return color;\n    } else if (this.space === 'cmyk') {\n      // https://gist.github.com/felipesabino/5066336\n      // Get the normalised cmyk values\n      const {\n        c,\n        m,\n        y,\n        k\n      } = this;\n\n      // Get the rgb values\n      const r = 255 * (1 - Math.min(1, c * (1 - k) + k));\n      const g = 255 * (1 - Math.min(1, m * (1 - k) + k));\n      const b = 255 * (1 - Math.min(1, y * (1 - k) + k));\n\n      // Form the color and return it\n      const color = new Color(r, g, b);\n      return color;\n    } else {\n      return this;\n    }\n  }\n  toArray() {\n    const {\n      _a,\n      _b,\n      _c,\n      _d,\n      space\n    } = this;\n    return [_a, _b, _c, _d, space];\n  }\n  toHex() {\n    const [r, g, b] = this._clamped().map(componentHex);\n    return `#${r}${g}${b}`;\n  }\n  toRgb() {\n    const [rV, gV, bV] = this._clamped();\n    const string = `rgb(${rV},${gV},${bV})`;\n    return string;\n  }\n  toString() {\n    return this.toHex();\n  }\n  xyz() {\n    // Normalise the red, green and blue values\n    const {\n      _a: r255,\n      _b: g255,\n      _c: b255\n    } = this.rgb();\n    const [r, g, b] = [r255, g255, b255].map(v => v / 255);\n\n    // Convert to the lab rgb space\n    const rL = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;\n    const gL = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;\n    const bL = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;\n\n    // Convert to the xyz color space without bounding the values\n    const xU = (rL * 0.4124 + gL * 0.3576 + bL * 0.1805) / 0.95047;\n    const yU = (rL * 0.2126 + gL * 0.7152 + bL * 0.0722) / 1.0;\n    const zU = (rL * 0.0193 + gL * 0.1192 + bL * 0.9505) / 1.08883;\n\n    // Get the proper xyz values by applying the bounding\n    const x = xU > 0.008856 ? Math.pow(xU, 1 / 3) : 7.787 * xU + 16 / 116;\n    const y = yU > 0.008856 ? Math.pow(yU, 1 / 3) : 7.787 * yU + 16 / 116;\n    const z = zU > 0.008856 ? Math.pow(zU, 1 / 3) : 7.787 * zU + 16 / 116;\n\n    // Make and return the color\n    const color = new Color(x, y, z, 'xyz');\n    return color;\n  }\n\n  /*\n  Input and Output methods\n  */\n\n  _clamped() {\n    const {\n      _a,\n      _b,\n      _c\n    } = this.rgb();\n    const {\n      max,\n      min,\n      round\n    } = Math;\n    const format = v => max(0, min(round(v), 255));\n    return [_a, _b, _c].map(format);\n  }\n\n  /*\n  Constructing colors\n  */\n}\n\nclass Point {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n\n  // Clone point\n  clone() {\n    return new Point(this);\n  }\n  init(x, y) {\n    const base = {\n      x: 0,\n      y: 0\n    };\n\n    // ensure source as object\n    const source = Array.isArray(x) ? {\n      x: x[0],\n      y: x[1]\n    } : typeof x === 'object' ? {\n      x: x.x,\n      y: x.y\n    } : {\n      x: x,\n      y: y\n    };\n\n    // merge source\n    this.x = source.x == null ? base.x : source.x;\n    this.y = source.y == null ? base.y : source.y;\n    return this;\n  }\n  toArray() {\n    return [this.x, this.y];\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // Transform point with matrix\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    const {\n      x,\n      y\n    } = this;\n\n    // Perform the matrix multiplication\n    this.x = m.a * x + m.c * y + m.e;\n    this.y = m.b * x + m.d * y + m.f;\n    return this;\n  }\n}\nfunction point(x, y) {\n  return new Point(x, y).transformO(this.screenCTM().inverseO());\n}\n\nfunction closeEnough(a, b, threshold) {\n  return Math.abs(b - a) < (1e-6);\n}\nclass Matrix {\n  constructor(...args) {\n    this.init(...args);\n  }\n  static formatTransforms(o) {\n    // Get all of the parameters required to form the matrix\n    const flipBoth = o.flip === 'both' || o.flip === true;\n    const flipX = o.flip && (flipBoth || o.flip === 'x') ? -1 : 1;\n    const flipY = o.flip && (flipBoth || o.flip === 'y') ? -1 : 1;\n    const skewX = o.skew && o.skew.length ? o.skew[0] : isFinite(o.skew) ? o.skew : isFinite(o.skewX) ? o.skewX : 0;\n    const skewY = o.skew && o.skew.length ? o.skew[1] : isFinite(o.skew) ? o.skew : isFinite(o.skewY) ? o.skewY : 0;\n    const scaleX = o.scale && o.scale.length ? o.scale[0] * flipX : isFinite(o.scale) ? o.scale * flipX : isFinite(o.scaleX) ? o.scaleX * flipX : flipX;\n    const scaleY = o.scale && o.scale.length ? o.scale[1] * flipY : isFinite(o.scale) ? o.scale * flipY : isFinite(o.scaleY) ? o.scaleY * flipY : flipY;\n    const shear = o.shear || 0;\n    const theta = o.rotate || o.theta || 0;\n    const origin = new Point(o.origin || o.around || o.ox || o.originX, o.oy || o.originY);\n    const ox = origin.x;\n    const oy = origin.y;\n    // We need Point to be invalid if nothing was passed because we cannot default to 0 here. That is why NaN\n    const position = new Point(o.position || o.px || o.positionX || NaN, o.py || o.positionY || NaN);\n    const px = position.x;\n    const py = position.y;\n    const translate = new Point(o.translate || o.tx || o.translateX, o.ty || o.translateY);\n    const tx = translate.x;\n    const ty = translate.y;\n    const relative = new Point(o.relative || o.rx || o.relativeX, o.ry || o.relativeY);\n    const rx = relative.x;\n    const ry = relative.y;\n\n    // Populate all of the values\n    return {\n      scaleX,\n      scaleY,\n      skewX,\n      skewY,\n      shear,\n      theta,\n      rx,\n      ry,\n      tx,\n      ty,\n      ox,\n      oy,\n      px,\n      py\n    };\n  }\n  static fromArray(a) {\n    return {\n      a: a[0],\n      b: a[1],\n      c: a[2],\n      d: a[3],\n      e: a[4],\n      f: a[5]\n    };\n  }\n  static isMatrixLike(o) {\n    return o.a != null || o.b != null || o.c != null || o.d != null || o.e != null || o.f != null;\n  }\n\n  // left matrix, right matrix, target matrix which is overwritten\n  static matrixMultiply(l, r, o) {\n    // Work out the product directly\n    const a = l.a * r.a + l.c * r.b;\n    const b = l.b * r.a + l.d * r.b;\n    const c = l.a * r.c + l.c * r.d;\n    const d = l.b * r.c + l.d * r.d;\n    const e = l.e + l.a * r.e + l.c * r.f;\n    const f = l.f + l.b * r.e + l.d * r.f;\n\n    // make sure to use local variables because l/r and o could be the same\n    o.a = a;\n    o.b = b;\n    o.c = c;\n    o.d = d;\n    o.e = e;\n    o.f = f;\n    return o;\n  }\n  around(cx, cy, matrix) {\n    return this.clone().aroundO(cx, cy, matrix);\n  }\n\n  // Transform around a center point\n  aroundO(cx, cy, matrix) {\n    const dx = cx || 0;\n    const dy = cy || 0;\n    return this.translateO(-dx, -dy).lmultiplyO(matrix).translateO(dx, dy);\n  }\n\n  // Clones this matrix\n  clone() {\n    return new Matrix(this);\n  }\n\n  // Decomposes this matrix into its affine parameters\n  decompose(cx = 0, cy = 0) {\n    // Get the parameters from the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Figure out if the winding direction is clockwise or counterclockwise\n    const determinant = a * d - b * c;\n    const ccw = determinant > 0 ? 1 : -1;\n\n    // Since we only shear in x, we can use the x basis to get the x scale\n    // and the rotation of the resulting matrix\n    const sx = ccw * Math.sqrt(a * a + b * b);\n    const thetaRad = Math.atan2(ccw * b, ccw * a);\n    const theta = 180 / Math.PI * thetaRad;\n    const ct = Math.cos(thetaRad);\n    const st = Math.sin(thetaRad);\n\n    // We can then solve the y basis vector simultaneously to get the other\n    // two affine parameters directly from these parameters\n    const lam = (a * c + b * d) / determinant;\n    const sy = c * sx / (lam * a - b) || d * sx / (lam * b + a);\n\n    // Use the translations\n    const tx = e - cx + cx * ct * sx + cy * (lam * ct * sx - st * sy);\n    const ty = f - cy + cx * st * sx + cy * (lam * st * sx + ct * sy);\n\n    // Construct the decomposition and return it\n    return {\n      // Return the affine parameters\n      scaleX: sx,\n      scaleY: sy,\n      shear: lam,\n      rotate: theta,\n      translateX: tx,\n      translateY: ty,\n      originX: cx,\n      originY: cy,\n      // Return the matrix parameters\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n\n  // Check if two matrices are equal\n  equals(other) {\n    if (other === this) return true;\n    const comp = new Matrix(other);\n    return closeEnough(this.a, comp.a) && closeEnough(this.b, comp.b) && closeEnough(this.c, comp.c) && closeEnough(this.d, comp.d) && closeEnough(this.e, comp.e) && closeEnough(this.f, comp.f);\n  }\n\n  // Flip matrix on x or y, at a given offset\n  flip(axis, around) {\n    return this.clone().flipO(axis, around);\n  }\n  flipO(axis, around) {\n    return axis === 'x' ? this.scaleO(-1, 1, around, 0) : axis === 'y' ? this.scaleO(1, -1, 0, around) : this.scaleO(-1, -1, axis, around || axis); // Define an x, y flip point\n  }\n\n  // Initialize\n  init(source) {\n    const base = Matrix.fromArray([1, 0, 0, 1, 0, 0]);\n\n    // ensure source as object\n    source = source instanceof Element ? source.matrixify() : typeof source === 'string' ? Matrix.fromArray(source.split(delimiter).map(parseFloat)) : Array.isArray(source) ? Matrix.fromArray(source) : typeof source === 'object' && Matrix.isMatrixLike(source) ? source : typeof source === 'object' ? new Matrix().transform(source) : arguments.length === 6 ? Matrix.fromArray([].slice.call(arguments)) : base;\n\n    // Merge the source matrix with the base matrix\n    this.a = source.a != null ? source.a : base.a;\n    this.b = source.b != null ? source.b : base.b;\n    this.c = source.c != null ? source.c : base.c;\n    this.d = source.d != null ? source.d : base.d;\n    this.e = source.e != null ? source.e : base.e;\n    this.f = source.f != null ? source.f : base.f;\n    return this;\n  }\n  inverse() {\n    return this.clone().inverseO();\n  }\n\n  // Inverses matrix\n  inverseO() {\n    // Get the current parameters out of the matrix\n    const a = this.a;\n    const b = this.b;\n    const c = this.c;\n    const d = this.d;\n    const e = this.e;\n    const f = this.f;\n\n    // Invert the 2x2 matrix in the top left\n    const det = a * d - b * c;\n    if (!det) throw new Error('Cannot invert ' + this);\n\n    // Calculate the top 2x2 matrix\n    const na = d / det;\n    const nb = -b / det;\n    const nc = -c / det;\n    const nd = a / det;\n\n    // Apply the inverted matrix to the top right\n    const ne = -(na * e + nc * f);\n    const nf = -(nb * e + nd * f);\n\n    // Construct the inverted matrix\n    this.a = na;\n    this.b = nb;\n    this.c = nc;\n    this.d = nd;\n    this.e = ne;\n    this.f = nf;\n    return this;\n  }\n  lmultiply(matrix) {\n    return this.clone().lmultiplyO(matrix);\n  }\n  lmultiplyO(matrix) {\n    const r = this;\n    const l = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Left multiplies by the given matrix\n  multiply(matrix) {\n    return this.clone().multiplyO(matrix);\n  }\n  multiplyO(matrix) {\n    // Get the matrices\n    const l = this;\n    const r = matrix instanceof Matrix ? matrix : new Matrix(matrix);\n    return Matrix.matrixMultiply(l, r, this);\n  }\n\n  // Rotate matrix\n  rotate(r, cx, cy) {\n    return this.clone().rotateO(r, cx, cy);\n  }\n  rotateO(r, cx = 0, cy = 0) {\n    // Convert degrees to radians\n    r = radians(r);\n    const cos = Math.cos(r);\n    const sin = Math.sin(r);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * cos - b * sin;\n    this.b = b * cos + a * sin;\n    this.c = c * cos - d * sin;\n    this.d = d * cos + c * sin;\n    this.e = e * cos - f * sin + cy * sin - cx * cos + cx;\n    this.f = f * cos + e * sin - cx * sin - cy * cos + cy;\n    return this;\n  }\n\n  // Scale matrix\n  scale() {\n    return this.clone().scaleO(...arguments);\n  }\n  scaleO(x, y = x, cx = 0, cy = 0) {\n    // Support uniform scaling\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a * x;\n    this.b = b * y;\n    this.c = c * x;\n    this.d = d * y;\n    this.e = e * x - cx * x + cx;\n    this.f = f * y - cy * y + cy;\n    return this;\n  }\n\n  // Shear matrix\n  shear(a, cx, cy) {\n    return this.clone().shearO(a, cx, cy);\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  shearO(lx, cx = 0, cy = 0) {\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.c = c + d * lx;\n    this.e = e + f * lx - cy * lx;\n    return this;\n  }\n\n  // Skew Matrix\n  skew() {\n    return this.clone().skewO(...arguments);\n  }\n  skewO(x, y = x, cx = 0, cy = 0) {\n    // support uniformal skew\n    if (arguments.length === 3) {\n      cy = cx;\n      cx = y;\n      y = x;\n    }\n\n    // Convert degrees to radians\n    x = radians(x);\n    y = radians(y);\n    const lx = Math.tan(x);\n    const ly = Math.tan(y);\n    const {\n      a,\n      b,\n      c,\n      d,\n      e,\n      f\n    } = this;\n    this.a = a + b * lx;\n    this.b = b + a * ly;\n    this.c = c + d * lx;\n    this.d = d + c * ly;\n    this.e = e + f * lx - cy * lx;\n    this.f = f + e * ly - cx * ly;\n    return this;\n  }\n\n  // SkewX\n  skewX(x, cx, cy) {\n    return this.skew(x, 0, cx, cy);\n  }\n\n  // SkewY\n  skewY(y, cx, cy) {\n    return this.skew(0, y, cx, cy);\n  }\n  toArray() {\n    return [this.a, this.b, this.c, this.d, this.e, this.f];\n  }\n\n  // Convert matrix to string\n  toString() {\n    return 'matrix(' + this.a + ',' + this.b + ',' + this.c + ',' + this.d + ',' + this.e + ',' + this.f + ')';\n  }\n\n  // Transform a matrix into another matrix by manipulating the space\n  transform(o) {\n    // Check if o is a matrix and then left multiply it directly\n    if (Matrix.isMatrixLike(o)) {\n      const matrix = new Matrix(o);\n      return matrix.multiplyO(this);\n    }\n\n    // Get the proposed transformations and the current transformations\n    const t = Matrix.formatTransforms(o);\n    const current = this;\n    const {\n      x: ox,\n      y: oy\n    } = new Point(t.ox, t.oy).transform(current);\n\n    // Construct the resulting matrix\n    const transformer = new Matrix().translateO(t.rx, t.ry).lmultiplyO(current).translateO(-ox, -oy).scaleO(t.scaleX, t.scaleY).skewO(t.skewX, t.skewY).shearO(t.shear).rotateO(t.theta).translateO(ox, oy);\n\n    // If we want the origin at a particular place, we force it there\n    if (isFinite(t.px) || isFinite(t.py)) {\n      const origin = new Point(ox, oy).transform(transformer);\n      // TODO: Replace t.px with isFinite(t.px)\n      // Doesn't work because t.px is also 0 if it wasn't passed\n      const dx = isFinite(t.px) ? t.px - origin.x : 0;\n      const dy = isFinite(t.py) ? t.py - origin.y : 0;\n      transformer.translateO(dx, dy);\n    }\n\n    // Translate now after positioning\n    transformer.translateO(t.tx, t.ty);\n    return transformer;\n  }\n\n  // Translate matrix\n  translate(x, y) {\n    return this.clone().translateO(x, y);\n  }\n  translateO(x, y) {\n    this.e += x || 0;\n    this.f += y || 0;\n    return this;\n  }\n  valueOf() {\n    return {\n      a: this.a,\n      b: this.b,\n      c: this.c,\n      d: this.d,\n      e: this.e,\n      f: this.f\n    };\n  }\n}\nfunction ctm() {\n  return new Matrix(this.node.getCTM());\n}\nfunction screenCTM() {\n  try {\n    /* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537\n       This is needed because FF does not return the transformation matrix\n       for the inner coordinate system when getScreenCTM() is called on nested svgs.\n       However all other Browsers do that */\n    if (typeof this.isRoot === 'function' && !this.isRoot()) {\n      const rect = this.rect(1, 1);\n      const m = rect.node.getScreenCTM();\n      rect.remove();\n      return new Matrix(m);\n    }\n    return new Matrix(this.node.getScreenCTM());\n  } catch (e) {\n    console.warn(`Cannot get CTM from SVG node ${this.node.nodeName}. Is the element rendered?`);\n    return new Matrix();\n  }\n}\nregister(Matrix, 'Matrix');\n\nfunction parser() {\n  // Reuse cached element if possible\n  if (!parser.nodes) {\n    const svg = makeInstance().size(2, 0);\n    svg.node.style.cssText = ['opacity: 0', 'position: absolute', 'left: -100%', 'top: -100%', 'overflow: hidden'].join(';');\n    svg.attr('focusable', 'false');\n    svg.attr('aria-hidden', 'true');\n    const path = svg.path().node;\n    parser.nodes = {\n      svg,\n      path\n    };\n  }\n  if (!parser.nodes.svg.node.parentNode) {\n    const b = globals.document.body || globals.document.documentElement;\n    parser.nodes.svg.addTo(b);\n  }\n  return parser.nodes;\n}\n\nfunction isNulledBox(box) {\n  return !box.width && !box.height && !box.x && !box.y;\n}\nfunction domContains(node) {\n  return node === globals.document || (globals.document.documentElement.contains || function (node) {\n    // This is IE - it does not support contains() for top-level SVGs\n    while (node.parentNode) {\n      node = node.parentNode;\n    }\n    return node === globals.document;\n  }).call(globals.document.documentElement, node);\n}\nclass Box {\n  constructor(...args) {\n    this.init(...args);\n  }\n  addOffset() {\n    // offset by window scroll position, because getBoundingClientRect changes when window is scrolled\n    this.x += globals.window.pageXOffset;\n    this.y += globals.window.pageYOffset;\n    return new Box(this);\n  }\n  init(source) {\n    const base = [0, 0, 0, 0];\n    source = typeof source === 'string' ? source.split(delimiter).map(parseFloat) : Array.isArray(source) ? source : typeof source === 'object' ? [source.left != null ? source.left : source.x, source.top != null ? source.top : source.y, source.width, source.height] : arguments.length === 4 ? [].slice.call(arguments) : base;\n    this.x = source[0] || 0;\n    this.y = source[1] || 0;\n    this.width = this.w = source[2] || 0;\n    this.height = this.h = source[3] || 0;\n\n    // Add more bounding box properties\n    this.x2 = this.x + this.w;\n    this.y2 = this.y + this.h;\n    this.cx = this.x + this.w / 2;\n    this.cy = this.y + this.h / 2;\n    return this;\n  }\n  isNulled() {\n    return isNulledBox(this);\n  }\n\n  // Merge rect box with another, return a new instance\n  merge(box) {\n    const x = Math.min(this.x, box.x);\n    const y = Math.min(this.y, box.y);\n    const width = Math.max(this.x + this.width, box.x + box.width) - x;\n    const height = Math.max(this.y + this.height, box.y + box.height) - y;\n    return new Box(x, y, width, height);\n  }\n  toArray() {\n    return [this.x, this.y, this.width, this.height];\n  }\n  toString() {\n    return this.x + ' ' + this.y + ' ' + this.width + ' ' + this.height;\n  }\n  transform(m) {\n    if (!(m instanceof Matrix)) {\n      m = new Matrix(m);\n    }\n    let xMin = Infinity;\n    let xMax = -Infinity;\n    let yMin = Infinity;\n    let yMax = -Infinity;\n    const pts = [new Point(this.x, this.y), new Point(this.x2, this.y), new Point(this.x, this.y2), new Point(this.x2, this.y2)];\n    pts.forEach(function (p) {\n      p = p.transform(m);\n      xMin = Math.min(xMin, p.x);\n      xMax = Math.max(xMax, p.x);\n      yMin = Math.min(yMin, p.y);\n      yMax = Math.max(yMax, p.y);\n    });\n    return new Box(xMin, yMin, xMax - xMin, yMax - yMin);\n  }\n}\nfunction getBox(el, getBBoxFn, retry) {\n  let box;\n  try {\n    // Try to get the box with the provided function\n    box = getBBoxFn(el.node);\n\n    // If the box is worthless and not even in the dom, retry\n    // by throwing an error here...\n    if (isNulledBox(box) && !domContains(el.node)) {\n      throw new Error('Element not in the dom');\n    }\n  } catch (e) {\n    // ... and calling the retry handler here\n    box = retry(el);\n  }\n  return box;\n}\nfunction bbox() {\n  // Function to get bbox is getBBox()\n  const getBBox = node => node.getBBox();\n\n  // Take all measures so that a stupid browser renders the element\n  // so we can get the bbox from it when we try again\n  const retry = el => {\n    try {\n      const clone = el.clone().addTo(parser().svg).show();\n      const box = clone.node.getBBox();\n      clone.remove();\n      return box;\n    } catch (e) {\n      // We give up...\n      throw new Error(`Getting bbox of element \"${el.node.nodeName}\" is not possible: ${e.toString()}`);\n    }\n  };\n  const box = getBox(this, getBBox, retry);\n  const bbox = new Box(box);\n  return bbox;\n}\nfunction rbox(el) {\n  const getRBox = node => node.getBoundingClientRect();\n  const retry = el => {\n    // There is no point in trying tricks here because if we insert the element into the dom ourselves\n    // it obviously will be at the wrong position\n    throw new Error(`Getting rbox of element \"${el.node.nodeName}\" is not possible`);\n  };\n  const box = getBox(this, getRBox, retry);\n  const rbox = new Box(box);\n\n  // If an element was passed, we want the bbox in the coordinate system of that element\n  if (el) {\n    return rbox.transform(el.screenCTM().inverseO());\n  }\n\n  // Else we want it in absolute screen coordinates\n  // Therefore we need to add the scrollOffset\n  return rbox.addOffset();\n}\n\n// Checks whether the given point is inside the bounding box\nfunction inside(x, y) {\n  const box = this.bbox();\n  return x > box.x && y > box.y && x < box.x + box.width && y < box.y + box.height;\n}\nregisterMethods({\n  viewbox: {\n    viewbox(x, y, width, height) {\n      // act as getter\n      if (x == null) return new Box(this.attr('viewBox'));\n\n      // act as setter\n      return this.attr('viewBox', new Box(x, y, width, height));\n    },\n    zoom(level, point) {\n      // Its best to rely on the attributes here and here is why:\n      // clientXYZ: Doesn't work on non-root svgs because they dont have a CSSBox (silly!)\n      // getBoundingClientRect: Doesn't work because Chrome just ignores width and height of nested svgs completely\n      //                        that means, their clientRect is always as big as the content.\n      //                        Furthermore this size is incorrect if the element is further transformed by its parents\n      // computedStyle: Only returns meaningful values if css was used with px. We dont go this route here!\n      // getBBox: returns the bounding box of its content - that doesn't help!\n      let {\n        width,\n        height\n      } = this.attr(['width', 'height']);\n\n      // Width and height is a string when a number with a unit is present which we can't use\n      // So we try clientXYZ\n      if (!width && !height || typeof width === 'string' || typeof height === 'string') {\n        width = this.node.clientWidth;\n        height = this.node.clientHeight;\n      }\n\n      // Giving up...\n      if (!width || !height) {\n        throw new Error('Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element');\n      }\n      const v = this.viewbox();\n      const zoomX = width / v.width;\n      const zoomY = height / v.height;\n      const zoom = Math.min(zoomX, zoomY);\n      if (level == null) {\n        return zoom;\n      }\n      let zoomAmount = zoom / level;\n\n      // Set the zoomAmount to the highest value which is safe to process and recover from\n      // The * 100 is a bit of wiggle room for the matrix transformation\n      if (zoomAmount === Infinity) zoomAmount = Number.MAX_SAFE_INTEGER / 100;\n      point = point || new Point(width / 2 / zoomX + v.x, height / 2 / zoomY + v.y);\n      const box = new Box(v).transform(new Matrix({\n        scale: zoomAmount,\n        origin: point\n      }));\n      return this.viewbox(box);\n    }\n  }\n});\nregister(Box, 'Box');\n\n// import { subClassArray } from './ArrayPolyfill.js'\n\nclass List extends Array {\n  constructor(arr = [], ...args) {\n    super(arr, ...args);\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...arr);\n  }\n}\nextend([List], {\n  each(fnOrMethodName, ...args) {\n    if (typeof fnOrMethodName === 'function') {\n      return this.map((el, i, arr) => {\n        return fnOrMethodName.call(el, el, i, arr);\n      });\n    } else {\n      return this.map(el => {\n        return el[fnOrMethodName](...args);\n      });\n    }\n  },\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n});\nconst reserved = ['toArray', 'constructor', 'each'];\nList.extend = function (methods) {\n  methods = methods.reduce((obj, name) => {\n    // Don't overwrite own methods\n    if (reserved.includes(name)) return obj;\n\n    // Don't add private methods\n    if (name[0] === '_') return obj;\n\n    // Allow access to original Array methods through a prefix\n    if (name in Array.prototype) {\n      obj['$' + name] = Array.prototype[name];\n    }\n\n    // Relay every call to each()\n    obj[name] = function (...attrs) {\n      return this.each(name, ...attrs);\n    };\n    return obj;\n  }, {});\n  extend([List], methods);\n};\n\nfunction baseFind(query, parent) {\n  return new List(map((parent || globals.document).querySelectorAll(query), function (node) {\n    return adopt(node);\n  }));\n}\n\n// Scoped find method\nfunction find(query) {\n  return baseFind(query, this.node);\n}\nfunction findOne(query) {\n  return adopt(this.node.querySelector(query));\n}\n\nlet listenerId = 0;\nconst windowEvents = {};\nfunction getEvents(instance) {\n  let n = instance.getEventHolder();\n\n  // We dont want to save events in global space\n  if (n === globals.window) n = windowEvents;\n  if (!n.events) n.events = {};\n  return n.events;\n}\nfunction getEventTarget(instance) {\n  return instance.getEventTarget();\n}\nfunction clearEvents(instance) {\n  let n = instance.getEventHolder();\n  if (n === globals.window) n = windowEvents;\n  if (n.events) n.events = {};\n}\n\n// Add event binder in the SVG namespace\nfunction on(node, events, listener, binding, options) {\n  const l = listener.bind(binding || node);\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // events can be an array of events or a string of events\n  events = Array.isArray(events) ? events : events.split(delimiter);\n\n  // add id to listener\n  if (!listener._svgjsListenerId) {\n    listener._svgjsListenerId = ++listenerId;\n  }\n  events.forEach(function (event) {\n    const ev = event.split('.')[0];\n    const ns = event.split('.')[1] || '*';\n\n    // ensure valid object\n    bag[ev] = bag[ev] || {};\n    bag[ev][ns] = bag[ev][ns] || {};\n\n    // reference listener\n    bag[ev][ns][listener._svgjsListenerId] = l;\n\n    // add listener\n    n.addEventListener(ev, l, options || false);\n  });\n}\n\n// Add event unbinder in the SVG namespace\nfunction off(node, events, listener, options) {\n  const instance = makeInstance(node);\n  const bag = getEvents(instance);\n  const n = getEventTarget(instance);\n\n  // listener can be a function or a number\n  if (typeof listener === 'function') {\n    listener = listener._svgjsListenerId;\n    if (!listener) return;\n  }\n\n  // events can be an array of events or a string or undefined\n  events = Array.isArray(events) ? events : (events || '').split(delimiter);\n  events.forEach(function (event) {\n    const ev = event && event.split('.')[0];\n    const ns = event && event.split('.')[1];\n    let namespace, l;\n    if (listener) {\n      // remove listener reference\n      if (bag[ev] && bag[ev][ns || '*']) {\n        // removeListener\n        n.removeEventListener(ev, bag[ev][ns || '*'][listener], options || false);\n        delete bag[ev][ns || '*'][listener];\n      }\n    } else if (ev && ns) {\n      // remove all listeners for a namespaced event\n      if (bag[ev] && bag[ev][ns]) {\n        for (l in bag[ev][ns]) {\n          off(n, [ev, ns].join('.'), l);\n        }\n        delete bag[ev][ns];\n      }\n    } else if (ns) {\n      // remove all listeners for a specific namespace\n      for (event in bag) {\n        for (namespace in bag[event]) {\n          if (ns === namespace) {\n            off(n, [event, ns].join('.'));\n          }\n        }\n      }\n    } else if (ev) {\n      // remove all listeners for the event\n      if (bag[ev]) {\n        for (namespace in bag[ev]) {\n          off(n, [ev, namespace].join('.'));\n        }\n        delete bag[ev];\n      }\n    } else {\n      // remove all listeners on a given node\n      for (event in bag) {\n        off(n, event);\n      }\n      clearEvents(instance);\n    }\n  });\n}\nfunction dispatch(node, event, data, options) {\n  const n = getEventTarget(node);\n\n  // Dispatch event\n  if (event instanceof globals.window.Event) {\n    n.dispatchEvent(event);\n  } else {\n    event = new globals.window.CustomEvent(event, {\n      detail: data,\n      cancelable: true,\n      ...options\n    });\n    n.dispatchEvent(event);\n  }\n  return event;\n}\n\nclass EventTarget extends Base {\n  addEventListener() {}\n  dispatch(event, data, options) {\n    return dispatch(this, event, data, options);\n  }\n  dispatchEvent(event) {\n    const bag = this.getEventHolder().events;\n    if (!bag) return true;\n    const events = bag[event.type];\n    for (const i in events) {\n      for (const j in events[i]) {\n        events[i][j](event);\n      }\n    }\n    return !event.defaultPrevented;\n  }\n\n  // Fire given event\n  fire(event, data, options) {\n    this.dispatch(event, data, options);\n    return this;\n  }\n  getEventHolder() {\n    return this;\n  }\n  getEventTarget() {\n    return this;\n  }\n\n  // Unbind event from listener\n  off(event, listener, options) {\n    off(this, event, listener, options);\n    return this;\n  }\n\n  // Bind given event to listener\n  on(event, listener, binding, options) {\n    on(this, event, listener, binding, options);\n    return this;\n  }\n  removeEventListener() {}\n}\nregister(EventTarget, 'EventTarget');\n\nfunction noop() {}\n\n// Default animation values\nconst timeline = {\n  duration: 400,\n  ease: '>',\n  delay: 0\n};\n\n// Default attribute values\nconst attrs = {\n  // fill and stroke\n  'fill-opacity': 1,\n  'stroke-opacity': 1,\n  'stroke-width': 0,\n  'stroke-linejoin': 'miter',\n  'stroke-linecap': 'butt',\n  fill: '#000000',\n  stroke: '#000000',\n  opacity: 1,\n  // position\n  x: 0,\n  y: 0,\n  cx: 0,\n  cy: 0,\n  // size\n  width: 0,\n  height: 0,\n  // radius\n  r: 0,\n  rx: 0,\n  ry: 0,\n  // gradient\n  offset: 0,\n  'stop-opacity': 1,\n  'stop-color': '#000000',\n  // text\n  'text-anchor': 'start'\n};\n\nvar defaults = {\n  __proto__: null,\n  attrs: attrs,\n  noop: noop,\n  timeline: timeline\n};\n\nclass SVGArray extends Array {\n  constructor(...args) {\n    super(...args);\n    this.init(...args);\n  }\n  clone() {\n    return new this.constructor(this);\n  }\n  init(arr) {\n    // This catches the case, that native map tries to create an array with new Array(1)\n    if (typeof arr === 'number') return this;\n    this.length = 0;\n    this.push(...this.parse(arr));\n    return this;\n  }\n\n  // Parse whitespace separated string\n  parse(array = []) {\n    // If already is an array, no need to parse it\n    if (array instanceof Array) return array;\n    return array.trim().split(delimiter).map(parseFloat);\n  }\n  toArray() {\n    return Array.prototype.concat.apply([], this);\n  }\n  toSet() {\n    return new Set(this);\n  }\n  toString() {\n    return this.join(' ');\n  }\n\n  // Flattens the array if needed\n  valueOf() {\n    const ret = [];\n    ret.push(...this);\n    return ret;\n  }\n}\n\n// Module for unit conversions\nclass SVGNumber {\n  // Initialize\n  constructor(...args) {\n    this.init(...args);\n  }\n  convert(unit) {\n    return new SVGNumber(this.value, unit);\n  }\n\n  // Divide number\n  divide(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this / number, this.unit || number.unit);\n  }\n  init(value, unit) {\n    unit = Array.isArray(value) ? value[1] : unit;\n    value = Array.isArray(value) ? value[0] : value;\n\n    // initialize defaults\n    this.value = 0;\n    this.unit = unit || '';\n\n    // parse value\n    if (typeof value === 'number') {\n      // ensure a valid numeric value\n      this.value = isNaN(value) ? 0 : !isFinite(value) ? value < 0 ? -3.4e38 : +3.4e38 : value;\n    } else if (typeof value === 'string') {\n      unit = value.match(numberAndUnit);\n      if (unit) {\n        // make value numeric\n        this.value = parseFloat(unit[1]);\n\n        // normalize\n        if (unit[5] === '%') {\n          this.value /= 100;\n        } else if (unit[5] === 's') {\n          this.value *= 1000;\n        }\n\n        // store unit\n        this.unit = unit[5];\n      }\n    } else {\n      if (value instanceof SVGNumber) {\n        this.value = value.valueOf();\n        this.unit = value.unit;\n      }\n    }\n    return this;\n  }\n\n  // Subtract number\n  minus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this - number, this.unit || number.unit);\n  }\n\n  // Add number\n  plus(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this + number, this.unit || number.unit);\n  }\n\n  // Multiply number\n  times(number) {\n    number = new SVGNumber(number);\n    return new SVGNumber(this * number, this.unit || number.unit);\n  }\n  toArray() {\n    return [this.value, this.unit];\n  }\n  toJSON() {\n    return this.toString();\n  }\n  toString() {\n    return (this.unit === '%' ? ~~(this.value * 1e8) / 1e6 : this.unit === 's' ? this.value / 1e3 : this.value) + this.unit;\n  }\n  valueOf() {\n    return this.value;\n  }\n}\n\nconst colorAttributes = new Set(['fill', 'stroke', 'color', 'bgcolor', 'stop-color', 'flood-color', 'lighting-color']);\nconst hooks = [];\nfunction registerAttrHook(fn) {\n  hooks.push(fn);\n}\n\n// Set svg element attribute\nfunction attr(attr, val, ns) {\n  // act as full getter\n  if (attr == null) {\n    // get an object of attributes\n    attr = {};\n    val = this.node.attributes;\n    for (const node of val) {\n      attr[node.nodeName] = isNumber.test(node.nodeValue) ? parseFloat(node.nodeValue) : node.nodeValue;\n    }\n    return attr;\n  } else if (attr instanceof Array) {\n    // loop through array and get all values\n    return attr.reduce((last, curr) => {\n      last[curr] = this.attr(curr);\n      return last;\n    }, {});\n  } else if (typeof attr === 'object' && attr.constructor === Object) {\n    // apply every attribute individually if an object is passed\n    for (val in attr) this.attr(val, attr[val]);\n  } else if (val === null) {\n    // remove value\n    this.node.removeAttribute(attr);\n  } else if (val == null) {\n    // act as a getter if the first and only argument is not an object\n    val = this.node.getAttribute(attr);\n    return val == null ? attrs[attr] : isNumber.test(val) ? parseFloat(val) : val;\n  } else {\n    // Loop through hooks and execute them to convert value\n    val = hooks.reduce((_val, hook) => {\n      return hook(attr, _val, this);\n    }, val);\n\n    // ensure correct numeric values (also accepts NaN and Infinity)\n    if (typeof val === 'number') {\n      val = new SVGNumber(val);\n    } else if (colorAttributes.has(attr) && Color.isColor(val)) {\n      // ensure full hex color\n      val = new Color(val);\n    } else if (val.constructor === Array) {\n      // Check for plain arrays and parse array values\n      val = new SVGArray(val);\n    }\n\n    // if the passed attribute is leading...\n    if (attr === 'leading') {\n      // ... call the leading method instead\n      if (this.leading) {\n        this.leading(val);\n      }\n    } else {\n      // set given attribute on node\n      typeof ns === 'string' ? this.node.setAttributeNS(ns, attr, val.toString()) : this.node.setAttribute(attr, val.toString());\n    }\n\n    // rebuild if required\n    if (this.rebuild && (attr === 'font-size' || attr === 'x')) {\n      this.rebuild();\n    }\n  }\n  return this;\n}\n\nclass Dom extends EventTarget {\n  constructor(node, attrs) {\n    super();\n    this.node = node;\n    this.type = node.nodeName;\n    if (attrs && node !== attrs) {\n      this.attr(attrs);\n    }\n  }\n\n  // Add given element at a position\n  add(element, i) {\n    element = makeInstance(element);\n\n    // If non-root svg nodes are added we have to remove their namespaces\n    if (element.removeNamespace && this.node instanceof globals.window.SVGElement) {\n      element.removeNamespace();\n    }\n    if (i == null) {\n      this.node.appendChild(element.node);\n    } else if (element.node !== this.node.childNodes[i]) {\n      this.node.insertBefore(element.node, this.node.childNodes[i]);\n    }\n    return this;\n  }\n\n  // Add element to given container and return self\n  addTo(parent, i) {\n    return makeInstance(parent).put(this, i);\n  }\n\n  // Returns all child elements\n  children() {\n    return new List(map(this.node.children, function (node) {\n      return adopt(node);\n    }));\n  }\n\n  // Remove all elements in this container\n  clear() {\n    // remove children\n    while (this.node.hasChildNodes()) {\n      this.node.removeChild(this.node.lastChild);\n    }\n    return this;\n  }\n\n  // Clone element\n  clone(deep = true, assignNewIds = true) {\n    // write dom data to the dom so the clone can pickup the data\n    this.writeDataToDom();\n\n    // clone element\n    let nodeClone = this.node.cloneNode(deep);\n    if (assignNewIds) {\n      // assign new id\n      nodeClone = assignNewId(nodeClone);\n    }\n    return new this.constructor(nodeClone);\n  }\n\n  // Iterates over all children and invokes a given block\n  each(block, deep) {\n    const children = this.children();\n    let i, il;\n    for (i = 0, il = children.length; i < il; i++) {\n      block.apply(children[i], [i, children]);\n      if (deep) {\n        children[i].each(block, deep);\n      }\n    }\n    return this;\n  }\n  element(nodeName, attrs) {\n    return this.put(new Dom(create(nodeName), attrs));\n  }\n\n  // Get first child\n  first() {\n    return adopt(this.node.firstChild);\n  }\n\n  // Get a element at the given index\n  get(i) {\n    return adopt(this.node.childNodes[i]);\n  }\n  getEventHolder() {\n    return this.node;\n  }\n  getEventTarget() {\n    return this.node;\n  }\n\n  // Checks if the given element is a child\n  has(element) {\n    return this.index(element) >= 0;\n  }\n  html(htmlOrFn, outerHTML) {\n    return this.xml(htmlOrFn, outerHTML, html);\n  }\n\n  // Get / set id\n  id(id) {\n    // generate new id if no id set\n    if (typeof id === 'undefined' && !this.node.id) {\n      this.node.id = eid(this.type);\n    }\n\n    // don't set directly with this.node.id to make `null` work correctly\n    return this.attr('id', id);\n  }\n\n  // Gets index of given element\n  index(element) {\n    return [].slice.call(this.node.childNodes).indexOf(element.node);\n  }\n\n  // Get the last child\n  last() {\n    return adopt(this.node.lastChild);\n  }\n\n  // matches the element vs a css selector\n  matches(selector) {\n    const el = this.node;\n    const matcher = el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector || null;\n    return matcher && matcher.call(el, selector);\n  }\n\n  // Returns the parent element instance\n  parent(type) {\n    let parent = this;\n\n    // check for parent\n    if (!parent.node.parentNode) return null;\n\n    // get parent element\n    parent = adopt(parent.node.parentNode);\n    if (!type) return parent;\n\n    // loop through ancestors if type is given\n    do {\n      if (typeof type === 'string' ? parent.matches(type) : parent instanceof type) return parent;\n    } while (parent = adopt(parent.node.parentNode));\n    return parent;\n  }\n\n  // Basically does the same as `add()` but returns the added element instead\n  put(element, i) {\n    element = makeInstance(element);\n    this.add(element, i);\n    return element;\n  }\n\n  // Add element to given container and return container\n  putIn(parent, i) {\n    return makeInstance(parent).add(this, i);\n  }\n\n  // Remove element\n  remove() {\n    if (this.parent()) {\n      this.parent().removeElement(this);\n    }\n    return this;\n  }\n\n  // Remove a given child\n  removeElement(element) {\n    this.node.removeChild(element.node);\n    return this;\n  }\n\n  // Replace this with element\n  replace(element) {\n    element = makeInstance(element);\n    if (this.node.parentNode) {\n      this.node.parentNode.replaceChild(element.node, this.node);\n    }\n    return element;\n  }\n  round(precision = 2, map = null) {\n    const factor = 10 ** precision;\n    const attrs = this.attr(map);\n    for (const i in attrs) {\n      if (typeof attrs[i] === 'number') {\n        attrs[i] = Math.round(attrs[i] * factor) / factor;\n      }\n    }\n    this.attr(attrs);\n    return this;\n  }\n\n  // Import / Export raw svg\n  svg(svgOrFn, outerSVG) {\n    return this.xml(svgOrFn, outerSVG, svg);\n  }\n\n  // Return id on string conversion\n  toString() {\n    return this.id();\n  }\n  words(text) {\n    // This is faster than removing all children and adding a new one\n    this.node.textContent = text;\n    return this;\n  }\n  wrap(node) {\n    const parent = this.parent();\n    if (!parent) {\n      return this.addTo(node);\n    }\n    const position = parent.index(this);\n    return parent.put(node, position).put(this);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    // dump variables recursively\n    this.each(function () {\n      this.writeDataToDom();\n    });\n    return this;\n  }\n\n  // Import / Export raw svg\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // act as getter if no svg string is given\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      // The default for exports is, that the outerNode is included\n      outerXML = outerXML == null ? true : outerXML;\n\n      // write svgjs data to the dom\n      this.writeDataToDom();\n      let current = this;\n\n      // An export modifier was passed\n      if (xmlOrFn != null) {\n        current = adopt(current.node.cloneNode(true));\n\n        // If the user wants outerHTML we need to process this node, too\n        if (outerXML) {\n          const result = xmlOrFn(current);\n          current = result || current;\n\n          // The user does not want this node? Well, then he gets nothing\n          if (result === false) return '';\n        }\n\n        // Deep loop through all children and apply modifier\n        current.each(function () {\n          const result = xmlOrFn(this);\n          const _this = result || this;\n\n          // If modifier returns false, discard node\n          if (result === false) {\n            this.remove();\n\n            // If modifier returns new node, use it\n          } else if (result && this !== _this) {\n            this.replace(_this);\n          }\n        }, true);\n      }\n\n      // Return outer or inner content\n      return outerXML ? current.node.outerHTML : current.node.innerHTML;\n    }\n\n    // Act as setter if we got a string\n\n    // The default for import is, that the current node is not replaced\n    outerXML = outerXML == null ? false : outerXML;\n\n    // Create temporary holder\n    const well = create('wrapper', ns);\n    const fragment = globals.document.createDocumentFragment();\n\n    // Dump raw svg\n    well.innerHTML = xmlOrFn;\n\n    // Transplant nodes into the fragment\n    for (let len = well.children.length; len--;) {\n      fragment.appendChild(well.firstElementChild);\n    }\n    const parent = this.parent();\n\n    // Add the whole fragment at once\n    return outerXML ? this.replace(fragment) && parent : this.add(fragment);\n  }\n}\nextend(Dom, {\n  attr,\n  find,\n  findOne\n});\nregister(Dom, 'Dom');\n\nclass Element extends Dom {\n  constructor(node, attrs) {\n    super(node, attrs);\n\n    // initialize data object\n    this.dom = {};\n\n    // create circular reference\n    this.node.instance = this;\n    if (node.hasAttribute('data-svgjs') || node.hasAttribute('svgjs:data')) {\n      // pull svgjs data from the dom (getAttributeNS doesn't work in html5)\n      this.setData(JSON.parse(node.getAttribute('data-svgjs')) ?? JSON.parse(node.getAttribute('svgjs:data')) ?? {});\n    }\n  }\n\n  // Move element by its center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  }\n\n  // Move by center over x-axis\n  cx(x) {\n    return x == null ? this.x() + this.width() / 2 : this.x(x - this.width() / 2);\n  }\n\n  // Move by center over y-axis\n  cy(y) {\n    return y == null ? this.y() + this.height() / 2 : this.y(y - this.height() / 2);\n  }\n\n  // Get defs\n  defs() {\n    const root = this.root();\n    return root && root.defs();\n  }\n\n  // Relative move over x and y axes\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  }\n\n  // Relative move over x axis\n  dx(x = 0) {\n    return this.x(new SVGNumber(x).plus(this.x()));\n  }\n\n  // Relative move over y axis\n  dy(y = 0) {\n    return this.y(new SVGNumber(y).plus(this.y()));\n  }\n  getEventHolder() {\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('height', height);\n  }\n\n  // Move element to given x and y values\n  move(x, y) {\n    return this.x(x).y(y);\n  }\n\n  // return array of all ancestors of given type up to the root svg\n  parents(until = this.root()) {\n    const isSelector = typeof until === 'string';\n    if (!isSelector) {\n      until = makeInstance(until);\n    }\n    const parents = new List();\n    let parent = this;\n    while ((parent = parent.parent()) && parent.node !== globals.document && parent.nodeName !== '#document-fragment') {\n      parents.push(parent);\n      if (!isSelector && parent.node === until.node) {\n        break;\n      }\n      if (isSelector && parent.matches(until)) {\n        break;\n      }\n      if (parent.node === this.root().node) {\n        // We worked our way to the root and didn't match `until`\n        return null;\n      }\n    }\n    return parents;\n  }\n\n  // Get referenced element form attribute value\n  reference(attr) {\n    attr = this.attr(attr);\n    if (!attr) return null;\n    const m = (attr + '').match(reference);\n    return m ? makeInstance(m[1]) : null;\n  }\n\n  // Get parent document\n  root() {\n    const p = this.parent(getClass(root));\n    return p && p.root();\n  }\n\n  // set given data to the elements data property\n  setData(o) {\n    this.dom = o;\n    return this;\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.width(new SVGNumber(p.width)).height(new SVGNumber(p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('width', width);\n  }\n\n  // write svgjs data to the dom\n  writeDataToDom() {\n    writeDataToDom(this, this.dom);\n    return super.writeDataToDom();\n  }\n\n  // Move over x-axis\n  x(x) {\n    return this.attr('x', x);\n  }\n\n  // Move over y-axis\n  y(y) {\n    return this.attr('y', y);\n  }\n}\nextend(Element, {\n  bbox,\n  rbox,\n  inside,\n  point,\n  ctm,\n  screenCTM\n});\nregister(Element, 'Element');\n\n// Define list of available attributes for stroke and fill\nconst sugar = {\n  stroke: ['color', 'width', 'opacity', 'linecap', 'linejoin', 'miterlimit', 'dasharray', 'dashoffset'],\n  fill: ['color', 'opacity', 'rule'],\n  prefix: function (t, a) {\n    return a === 'color' ? t : t + '-' + a;\n  }\n}\n\n// Add sugar for fill and stroke\n;\n['fill', 'stroke'].forEach(function (m) {\n  const extension = {};\n  let i;\n  extension[m] = function (o) {\n    if (typeof o === 'undefined') {\n      return this.attr(m);\n    }\n    if (typeof o === 'string' || o instanceof Color || Color.isRgb(o) || o instanceof Element) {\n      this.attr(m, o);\n    } else {\n      // set all attributes from sugar.fill and sugar.stroke list\n      for (i = sugar[m].length - 1; i >= 0; i--) {\n        if (o[sugar[m][i]] != null) {\n          this.attr(sugar.prefix(m, sugar[m][i]), o[sugar[m][i]]);\n        }\n      }\n    }\n    return this;\n  };\n  registerMethods(['Element', 'Runner'], extension);\n});\nregisterMethods(['Element', 'Runner'], {\n  // Let the user set the matrix directly\n  matrix: function (mat, b, c, d, e, f) {\n    // Act as a getter\n    if (mat == null) {\n      return new Matrix(this);\n    }\n\n    // Act as a setter, the user can pass a matrix or a set of numbers\n    return this.attr('transform', new Matrix(mat, b, c, d, e, f));\n  },\n  // Map rotation to transform\n  rotate: function (angle, cx, cy) {\n    return this.transform({\n      rotate: angle,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map skew to transform\n  skew: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      skew: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      skew: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  shear: function (lam, cx, cy) {\n    return this.transform({\n      shear: lam,\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map scale to transform\n  scale: function (x, y, cx, cy) {\n    return arguments.length === 1 || arguments.length === 3 ? this.transform({\n      scale: x,\n      ox: y,\n      oy: cx\n    }, true) : this.transform({\n      scale: [x, y],\n      ox: cx,\n      oy: cy\n    }, true);\n  },\n  // Map translate to transform\n  translate: function (x, y) {\n    return this.transform({\n      translate: [x, y]\n    }, true);\n  },\n  // Map relative translations to transform\n  relative: function (x, y) {\n    return this.transform({\n      relative: [x, y]\n    }, true);\n  },\n  // Map flip to transform\n  flip: function (direction = 'both', origin = 'center') {\n    if ('xybothtrue'.indexOf(direction) === -1) {\n      origin = direction;\n      direction = 'both';\n    }\n    return this.transform({\n      flip: direction,\n      origin: origin\n    }, true);\n  },\n  // Opacity\n  opacity: function (value) {\n    return this.attr('opacity', value);\n  }\n});\nregisterMethods('radius', {\n  // Add x and y radius\n  radius: function (x, y = x) {\n    const type = (this._element || this).type;\n    return type === 'radialGradient' ? this.attr('r', new SVGNumber(x)) : this.rx(x).ry(y);\n  }\n});\nregisterMethods('Path', {\n  // Get path length\n  length: function () {\n    return this.node.getTotalLength();\n  },\n  // Get point at length\n  pointAt: function (length) {\n    return new Point(this.node.getPointAtLength(length));\n  }\n});\nregisterMethods(['Element', 'Runner'], {\n  // Set font\n  font: function (a, v) {\n    if (typeof a === 'object') {\n      for (v in a) this.font(v, a[v]);\n      return this;\n    }\n    return a === 'leading' ? this.leading(v) : a === 'anchor' ? this.attr('text-anchor', v) : a === 'size' || a === 'family' || a === 'weight' || a === 'stretch' || a === 'variant' || a === 'style' ? this.attr('font-' + a, v) : this.attr(a, v);\n  }\n});\n\n// Add events to elements\nconst methods = ['click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'mousemove', 'mouseenter', 'mouseleave', 'touchstart', 'touchmove', 'touchleave', 'touchend', 'touchcancel', 'contextmenu', 'wheel', 'pointerdown', 'pointermove', 'pointerup', 'pointerleave', 'pointercancel'].reduce(function (last, event) {\n  // add event to Element\n  const fn = function (f) {\n    if (f === null) {\n      this.off(event);\n    } else {\n      this.on(event, f);\n    }\n    return this;\n  };\n  last[event] = fn;\n  return last;\n}, {});\nregisterMethods('Element', methods);\n\n// Reset all transformations\nfunction untransform() {\n  return this.attr('transform', null);\n}\n\n// merge the whole transformation chain into one matrix and returns it\nfunction matrixify() {\n  const matrix = (this.attr('transform') || ''\n  // split transformations\n  ).split(transforms).slice(0, -1).map(function (str) {\n    // generate key => value pairs\n    const kv = str.trim().split('(');\n    return [kv[0], kv[1].split(delimiter).map(function (str) {\n      return parseFloat(str);\n    })];\n  }).reverse()\n  // merge every transformation into one matrix\n  .reduce(function (matrix, transform) {\n    if (transform[0] === 'matrix') {\n      return matrix.lmultiply(Matrix.fromArray(transform[1]));\n    }\n    return matrix[transform[0]].apply(matrix, transform[1]);\n  }, new Matrix());\n  return matrix;\n}\n\n// add an element to another parent without changing the visual representation on the screen\nfunction toParent(parent, i) {\n  if (this === parent) return this;\n  if (isDescriptive(this.node)) return this.addTo(parent, i);\n  const ctm = this.screenCTM();\n  const pCtm = parent.screenCTM().inverse();\n  this.addTo(parent, i).untransform().transform(pCtm.multiply(ctm));\n  return this;\n}\n\n// same as above with parent equals root-svg\nfunction toRoot(i) {\n  return this.toParent(this.root(), i);\n}\n\n// Add transformations\nfunction transform(o, relative) {\n  // Act as a getter if no object was passed\n  if (o == null || typeof o === 'string') {\n    const decomposed = new Matrix(this).decompose();\n    return o == null ? decomposed : decomposed[o];\n  }\n  if (!Matrix.isMatrixLike(o)) {\n    // Set the origin according to the defined transform\n    o = {\n      ...o,\n      origin: getOrigin(o, this)\n    };\n  }\n\n  // The user can pass a boolean, an Element or an Matrix or nothing\n  const cleanRelative = relative === true ? this : relative || false;\n  const result = new Matrix(cleanRelative).transform(o);\n  return this.attr('transform', result);\n}\nregisterMethods('Element', {\n  untransform,\n  matrixify,\n  toParent,\n  toRoot,\n  transform\n});\n\nclass Container extends Element {\n  flatten() {\n    this.each(function () {\n      if (this instanceof Container) {\n        return this.flatten().ungroup();\n      }\n    });\n    return this;\n  }\n  ungroup(parent = this.parent(), index = parent.index(this)) {\n    // when parent != this, we want append all elements to the end\n    index = index === -1 ? parent.children().length : index;\n    this.each(function (i, children) {\n      // reverse each\n      return children[children.length - i - 1].toParent(parent, index);\n    });\n    return this.remove();\n  }\n}\nregister(Container, 'Container');\n\nclass Defs extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('defs', node), attrs);\n  }\n  flatten() {\n    return this;\n  }\n  ungroup() {\n    return this;\n  }\n}\nregister(Defs, 'Defs');\n\nclass Shape extends Element {}\nregister(Shape, 'Shape');\n\n// Radius x value\nfunction rx(rx) {\n  return this.attr('rx', rx);\n}\n\n// Radius y value\nfunction ry(ry) {\n  return this.attr('ry', ry);\n}\n\n// Move over x-axis\nfunction x$3(x) {\n  return x == null ? this.cx() - this.rx() : this.cx(x + this.rx());\n}\n\n// Move over y-axis\nfunction y$3(y) {\n  return y == null ? this.cy() - this.ry() : this.cy(y + this.ry());\n}\n\n// Move by center over x-axis\nfunction cx$1(x) {\n  return this.attr('cx', x);\n}\n\n// Move by center over y-axis\nfunction cy$1(y) {\n  return this.attr('cy', y);\n}\n\n// Set width of element\nfunction width$2(width) {\n  return width == null ? this.rx() * 2 : this.rx(new SVGNumber(width).divide(2));\n}\n\n// Set height of element\nfunction height$2(height) {\n  return height == null ? this.ry() * 2 : this.ry(new SVGNumber(height).divide(2));\n}\n\nvar circled = {\n  __proto__: null,\n  cx: cx$1,\n  cy: cy$1,\n  height: height$2,\n  rx: rx,\n  ry: ry,\n  width: width$2,\n  x: x$3,\n  y: y$3\n};\n\nclass Ellipse extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('ellipse', node), attrs);\n  }\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.rx(new SVGNumber(p.width).divide(2)).ry(new SVGNumber(p.height).divide(2));\n  }\n}\nextend(Ellipse, circled);\nregisterMethods('Container', {\n  // Create an ellipse\n  ellipse: wrapWithAttrCheck(function (width = 0, height = width) {\n    return this.put(new Ellipse()).size(width, height).move(0, 0);\n  })\n});\nregister(Ellipse, 'Ellipse');\n\nclass Fragment extends Dom {\n  constructor(node = globals.document.createDocumentFragment()) {\n    super(node);\n  }\n\n  // Import / Export raw xml\n  xml(xmlOrFn, outerXML, ns) {\n    if (typeof xmlOrFn === 'boolean') {\n      ns = outerXML;\n      outerXML = xmlOrFn;\n      xmlOrFn = null;\n    }\n\n    // because this is a fragment we have to put all elements into a wrapper first\n    // before we can get the innerXML from it\n    if (xmlOrFn == null || typeof xmlOrFn === 'function') {\n      const wrapper = new Dom(create('wrapper', ns));\n      wrapper.add(this.node.cloneNode(true));\n      return wrapper.xml(false, ns);\n    }\n\n    // Act as setter if we got a string\n    return super.xml(xmlOrFn, false, ns);\n  }\n}\nregister(Fragment, 'Fragment');\n\nfunction from(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    fx: new SVGNumber(x),\n    fy: new SVGNumber(y)\n  }) : this.attr({\n    x1: new SVGNumber(x),\n    y1: new SVGNumber(y)\n  });\n}\nfunction to(x, y) {\n  return (this._element || this).type === 'radialGradient' ? this.attr({\n    cx: new SVGNumber(x),\n    cy: new SVGNumber(y)\n  }) : this.attr({\n    x2: new SVGNumber(x),\n    y2: new SVGNumber(y)\n  });\n}\n\nvar gradiented = {\n  __proto__: null,\n  from: from,\n  to: to\n};\n\nclass Gradient extends Container {\n  constructor(type, attrs) {\n    super(nodeOrNew(type + 'Gradient', typeof type === 'string' ? null : type), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'gradientTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update gradient\n  update(block) {\n    // remove all stops\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nextend(Gradient, gradiented);\nregisterMethods({\n  Container: {\n    // Create gradient element in defs\n    gradient(...args) {\n      return this.defs().gradient(...args);\n    }\n  },\n  // define gradient\n  Defs: {\n    gradient: wrapWithAttrCheck(function (type, block) {\n      return this.put(new Gradient(type)).update(block);\n    })\n  }\n});\nregister(Gradient, 'Gradient');\n\nclass Pattern extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('pattern', node), attrs);\n  }\n\n  // custom attr to handle transform\n  attr(a, b, c) {\n    if (a === 'transform') a = 'patternTransform';\n    return super.attr(a, b, c);\n  }\n  bbox() {\n    return new Box();\n  }\n  targets() {\n    return baseFind('svg [fill*=' + this.id() + ']');\n  }\n\n  // Alias string conversion to fill\n  toString() {\n    return this.url();\n  }\n\n  // Update pattern by rebuilding\n  update(block) {\n    // remove content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Return the fill id\n  url() {\n    return 'url(#' + this.id() + ')';\n  }\n}\nregisterMethods({\n  Container: {\n    // Create pattern element in defs\n    pattern(...args) {\n      return this.defs().pattern(...args);\n    }\n  },\n  Defs: {\n    pattern: wrapWithAttrCheck(function (width, height, block) {\n      return this.put(new Pattern()).update(block).attr({\n        x: 0,\n        y: 0,\n        width: width,\n        height: height,\n        patternUnits: 'userSpaceOnUse'\n      });\n    })\n  }\n});\nregister(Pattern, 'Pattern');\n\nclass Image extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('image', node), attrs);\n  }\n\n  // (re)load image\n  load(url, callback) {\n    if (!url) return this;\n    const img = new globals.window.Image();\n    on(img, 'load', function (e) {\n      const p = this.parent(Pattern);\n\n      // ensure image size\n      if (this.width() === 0 && this.height() === 0) {\n        this.size(img.width, img.height);\n      }\n      if (p instanceof Pattern) {\n        // ensure pattern size if not set\n        if (p.width() === 0 && p.height() === 0) {\n          p.size(this.width(), this.height());\n        }\n      }\n      if (typeof callback === 'function') {\n        callback.call(this, e);\n      }\n    }, this);\n    on(img, 'load error', function () {\n      // dont forget to unbind memory leaking events\n      off(img);\n    });\n    return this.attr('href', img.src = url, xlink);\n  }\n}\nregisterAttrHook(function (attr, val, _this) {\n  // convert image fill and stroke to patterns\n  if (attr === 'fill' || attr === 'stroke') {\n    if (isImage.test(val)) {\n      val = _this.root().defs().image(val);\n    }\n  }\n  if (val instanceof Image) {\n    val = _this.root().defs().pattern(0, 0, pattern => {\n      pattern.add(val);\n    });\n  }\n  return val;\n});\nregisterMethods({\n  Container: {\n    // create image element, load image and set its size\n    image: wrapWithAttrCheck(function (source, callback) {\n      return this.put(new Image()).size(0, 0).load(source, callback);\n    })\n  }\n});\nregister(Image, 'Image');\n\nclass PointArray extends SVGArray {\n  // Get bounding box of points\n  bbox() {\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    let minX = Infinity;\n    let minY = Infinity;\n    this.forEach(function (el) {\n      maxX = Math.max(el[0], maxX);\n      maxY = Math.max(el[1], maxY);\n      minX = Math.min(el[0], minX);\n      minY = Math.min(el[1], minY);\n    });\n    return new Box(minX, minY, maxX - minX, maxY - minY);\n  }\n\n  // Move point string\n  move(x, y) {\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n\n    // move every point\n    if (!isNaN(x) && !isNaN(y)) {\n      for (let i = this.length - 1; i >= 0; i--) {\n        this[i] = [this[i][0] + x, this[i][1] + y];\n      }\n    }\n    return this;\n  }\n\n  // Parse point string and flat array\n  parse(array = [0, 0]) {\n    const points = [];\n\n    // if it is an array, we flatten it and therefore clone it to 1 depths\n    if (array instanceof Array) {\n      array = Array.prototype.concat.apply([], array);\n    } else {\n      // Else, it is considered as a string\n      // parse points\n      array = array.trim().split(delimiter).map(parseFloat);\n    }\n\n    // validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints\n    // Odd number of coordinates is an error. In such cases, drop the last odd coordinate.\n    if (array.length % 2 !== 0) array.pop();\n\n    // wrap points in two-tuples\n    for (let i = 0, len = array.length; i < len; i = i + 2) {\n      points.push([array[i], array[i + 1]]);\n    }\n    return points;\n  }\n\n  // Resize poly string\n  size(width, height) {\n    let i;\n    const box = this.bbox();\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      if (box.width) this[i][0] = (this[i][0] - box.x) * width / box.width + box.x;\n      if (box.height) this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n    }\n    return this;\n  }\n\n  // Convert array to line object\n  toLine() {\n    return {\n      x1: this[0][0],\n      y1: this[0][1],\n      x2: this[1][0],\n      y2: this[1][1]\n    };\n  }\n\n  // Convert array to string\n  toString() {\n    const array = [];\n    // convert to a poly point string\n    for (let i = 0, il = this.length; i < il; i++) {\n      array.push(this[i].join(','));\n    }\n    return array.join(' ');\n  }\n  transform(m) {\n    return this.clone().transformO(m);\n  }\n\n  // transform points with matrix (similar to Point.transform)\n  transformO(m) {\n    if (!Matrix.isMatrixLike(m)) {\n      m = new Matrix(m);\n    }\n    for (let i = this.length; i--;) {\n      // Perform the matrix multiplication\n      const [x, y] = this[i];\n      this[i][0] = m.a * x + m.c * y + m.e;\n      this[i][1] = m.b * x + m.d * y + m.f;\n    }\n    return this;\n  }\n}\n\nconst MorphArray = PointArray;\n\n// Move by left top corner over x-axis\nfunction x$2(x) {\n  return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n}\n\n// Move by left top corner over y-axis\nfunction y$2(y) {\n  return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n}\n\n// Set width of element\nfunction width$1(width) {\n  const b = this.bbox();\n  return width == null ? b.width : this.size(width, b.height);\n}\n\n// Set height of element\nfunction height$1(height) {\n  const b = this.bbox();\n  return height == null ? b.height : this.size(b.width, height);\n}\n\nvar pointed = {\n  __proto__: null,\n  MorphArray: MorphArray,\n  height: height$1,\n  width: width$1,\n  x: x$2,\n  y: y$2\n};\n\nclass Line extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('line', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return new PointArray([[this.attr('x1'), this.attr('y1')], [this.attr('x2'), this.attr('y2')]]);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr(this.array().move(x, y).toLine());\n  }\n\n  // Overwrite native plot() method\n  plot(x1, y1, x2, y2) {\n    if (x1 == null) {\n      return this.array();\n    } else if (typeof y1 !== 'undefined') {\n      x1 = {\n        x1,\n        y1,\n        x2,\n        y2\n      };\n    } else {\n      x1 = new PointArray(x1).toLine();\n    }\n    return this.attr(x1);\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr(this.array().size(p.width, p.height).toLine());\n  }\n}\nextend(Line, pointed);\nregisterMethods({\n  Container: {\n    // Create a line element\n    line: wrapWithAttrCheck(function (...args) {\n      // make sure plot is called as a setter\n      // x1 is not necessarily a number, it can also be an array, a string and a PointArray\n      return Line.prototype.plot.apply(this.put(new Line()), args[0] != null ? args : [0, 0, 0, 0]);\n    })\n  }\n});\nregister(Line, 'Line');\n\nclass Marker extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('marker', node), attrs);\n  }\n\n  // Set height of element\n  height(height) {\n    return this.attr('markerHeight', height);\n  }\n  orient(orient) {\n    return this.attr('orient', orient);\n  }\n\n  // Set marker refX and refY\n  ref(x, y) {\n    return this.attr('refX', x).attr('refY', y);\n  }\n\n  // Return the fill id\n  toString() {\n    return 'url(#' + this.id() + ')';\n  }\n\n  // Update marker\n  update(block) {\n    // remove all content\n    this.clear();\n\n    // invoke passed block\n    if (typeof block === 'function') {\n      block.call(this, this);\n    }\n    return this;\n  }\n\n  // Set width of element\n  width(width) {\n    return this.attr('markerWidth', width);\n  }\n}\nregisterMethods({\n  Container: {\n    marker(...args) {\n      // Create marker element in defs\n      return this.defs().marker(...args);\n    }\n  },\n  Defs: {\n    // Create marker\n    marker: wrapWithAttrCheck(function (width, height, block) {\n      // Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto\n      return this.put(new Marker()).size(width, height).ref(width / 2, height / 2).viewbox(0, 0, width, height).attr('orient', 'auto').update(block);\n    })\n  },\n  marker: {\n    // Create and attach markers\n    marker(marker, width, height, block) {\n      let attr = ['marker'];\n\n      // Build attribute name\n      if (marker !== 'all') attr.push(marker);\n      attr = attr.join('-');\n\n      // Set marker attribute\n      marker = arguments[1] instanceof Marker ? arguments[1] : this.defs().marker(width, height, block);\n      return this.attr(attr, marker);\n    }\n  }\n});\nregister(Marker, 'Marker');\n\n/***\nBase Class\n==========\nThe base stepper class that will be\n***/\n\nfunction makeSetterGetter(k, f) {\n  return function (v) {\n    if (v == null) return this[k];\n    this[k] = v;\n    if (f) f.call(this);\n    return this;\n  };\n}\nconst easing = {\n  '-': function (pos) {\n    return pos;\n  },\n  '<>': function (pos) {\n    return -Math.cos(pos * Math.PI) / 2 + 0.5;\n  },\n  '>': function (pos) {\n    return Math.sin(pos * Math.PI / 2);\n  },\n  '<': function (pos) {\n    return -Math.cos(pos * Math.PI / 2) + 1;\n  },\n  bezier: function (x1, y1, x2, y2) {\n    // see https://www.w3.org/TR/css-easing-1/#cubic-bezier-algo\n    return function (t) {\n      if (t < 0) {\n        if (x1 > 0) {\n          return y1 / x1 * t;\n        } else if (x2 > 0) {\n          return y2 / x2 * t;\n        } else {\n          return 0;\n        }\n      } else if (t > 1) {\n        if (x2 < 1) {\n          return (1 - y2) / (1 - x2) * t + (y2 - x2) / (1 - x2);\n        } else if (x1 < 1) {\n          return (1 - y1) / (1 - x1) * t + (y1 - x1) / (1 - x1);\n        } else {\n          return 1;\n        }\n      } else {\n        return 3 * t * (1 - t) ** 2 * y1 + 3 * t ** 2 * (1 - t) * y2 + t ** 3;\n      }\n    };\n  },\n  // see https://www.w3.org/TR/css-easing-1/#step-timing-function-algo\n  steps: function (steps, stepPosition = 'end') {\n    // deal with \"jump-\" prefix\n    stepPosition = stepPosition.split('-').reverse()[0];\n    let jumps = steps;\n    if (stepPosition === 'none') {\n      --jumps;\n    } else if (stepPosition === 'both') {\n      ++jumps;\n    }\n\n    // The beforeFlag is essentially useless\n    return (t, beforeFlag = false) => {\n      // Step is called currentStep in referenced url\n      let step = Math.floor(t * steps);\n      const jumping = t * step % 1 === 0;\n      if (stepPosition === 'start' || stepPosition === 'both') {\n        ++step;\n      }\n      if (beforeFlag && jumping) {\n        --step;\n      }\n      if (t >= 0 && step < 0) {\n        step = 0;\n      }\n      if (t <= 1 && step > jumps) {\n        step = jumps;\n      }\n      return step / jumps;\n    };\n  }\n};\nclass Stepper {\n  done() {\n    return false;\n  }\n}\n\n/***\nEasing Functions\n================\n***/\n\nclass Ease extends Stepper {\n  constructor(fn = timeline.ease) {\n    super();\n    this.ease = easing[fn] || fn;\n  }\n  step(from, to, pos) {\n    if (typeof from !== 'number') {\n      return pos < 1 ? from : to;\n    }\n    return from + (to - from) * this.ease(pos);\n  }\n}\n\n/***\nController Types\n================\n***/\n\nclass Controller extends Stepper {\n  constructor(fn) {\n    super();\n    this.stepper = fn;\n  }\n  done(c) {\n    return c.done;\n  }\n  step(current, target, dt, c) {\n    return this.stepper(current, target, dt, c);\n  }\n}\nfunction recalculate() {\n  // Apply the default parameters\n  const duration = (this._duration || 500) / 1000;\n  const overshoot = this._overshoot || 0;\n\n  // Calculate the PID natural response\n  const eps = 1e-10;\n  const pi = Math.PI;\n  const os = Math.log(overshoot / 100 + eps);\n  const zeta = -os / Math.sqrt(pi * pi + os * os);\n  const wn = 3.9 / (zeta * duration);\n\n  // Calculate the Spring values\n  this.d = 2 * zeta * wn;\n  this.k = wn * wn;\n}\nclass Spring extends Controller {\n  constructor(duration = 500, overshoot = 0) {\n    super();\n    this.duration(duration).overshoot(overshoot);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    if (dt > 100) dt = 16;\n    dt /= 1000;\n\n    // Get the previous velocity\n    const velocity = c.velocity || 0;\n\n    // Apply the control to get the new position and store it\n    const acceleration = -this.d * velocity - this.k * (current - target);\n    const newPosition = current + velocity * dt + acceleration * dt * dt / 2;\n\n    // Store the velocity\n    c.velocity = velocity + acceleration * dt;\n\n    // Figure out if we have converged, and if so, pass the value\n    c.done = Math.abs(target - newPosition) + Math.abs(velocity) < 0.002;\n    return c.done ? target : newPosition;\n  }\n}\nextend(Spring, {\n  duration: makeSetterGetter('_duration', recalculate),\n  overshoot: makeSetterGetter('_overshoot', recalculate)\n});\nclass PID extends Controller {\n  constructor(p = 0.1, i = 0.01, d = 0, windup = 1000) {\n    super();\n    this.p(p).i(i).d(d).windup(windup);\n  }\n  step(current, target, dt, c) {\n    if (typeof current === 'string') return current;\n    c.done = dt === Infinity;\n    if (dt === Infinity) return target;\n    if (dt === 0) return current;\n    const p = target - current;\n    let i = (c.integral || 0) + p * dt;\n    const d = (p - (c.error || 0)) / dt;\n    const windup = this._windup;\n\n    // antiwindup\n    if (windup !== false) {\n      i = Math.max(-windup, Math.min(i, windup));\n    }\n    c.error = p;\n    c.integral = i;\n    c.done = Math.abs(p) < 0.001;\n    return c.done ? target : current + (this.P * p + this.I * i + this.D * d);\n  }\n}\nextend(PID, {\n  windup: makeSetterGetter('_windup'),\n  p: makeSetterGetter('P'),\n  i: makeSetterGetter('I'),\n  d: makeSetterGetter('D')\n});\n\nconst segmentParameters = {\n  M: 2,\n  L: 2,\n  H: 1,\n  V: 1,\n  C: 6,\n  S: 4,\n  Q: 4,\n  T: 2,\n  A: 7,\n  Z: 0\n};\nconst pathHandlers = {\n  M: function (c, p, p0) {\n    p.x = p0.x = c[0];\n    p.y = p0.y = c[1];\n    return ['M', p.x, p.y];\n  },\n  L: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['L', c[0], c[1]];\n  },\n  H: function (c, p) {\n    p.x = c[0];\n    return ['H', c[0]];\n  },\n  V: function (c, p) {\n    p.y = c[0];\n    return ['V', c[0]];\n  },\n  C: function (c, p) {\n    p.x = c[4];\n    p.y = c[5];\n    return ['C', c[0], c[1], c[2], c[3], c[4], c[5]];\n  },\n  S: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['S', c[0], c[1], c[2], c[3]];\n  },\n  Q: function (c, p) {\n    p.x = c[2];\n    p.y = c[3];\n    return ['Q', c[0], c[1], c[2], c[3]];\n  },\n  T: function (c, p) {\n    p.x = c[0];\n    p.y = c[1];\n    return ['T', c[0], c[1]];\n  },\n  Z: function (c, p, p0) {\n    p.x = p0.x;\n    p.y = p0.y;\n    return ['Z'];\n  },\n  A: function (c, p) {\n    p.x = c[5];\n    p.y = c[6];\n    return ['A', c[0], c[1], c[2], c[3], c[4], c[5], c[6]];\n  }\n};\nconst mlhvqtcsaz = 'mlhvqtcsaz'.split('');\nfor (let i = 0, il = mlhvqtcsaz.length; i < il; ++i) {\n  pathHandlers[mlhvqtcsaz[i]] = function (i) {\n    return function (c, p, p0) {\n      if (i === 'H') c[0] = c[0] + p.x;else if (i === 'V') c[0] = c[0] + p.y;else if (i === 'A') {\n        c[5] = c[5] + p.x;\n        c[6] = c[6] + p.y;\n      } else {\n        for (let j = 0, jl = c.length; j < jl; ++j) {\n          c[j] = c[j] + (j % 2 ? p.y : p.x);\n        }\n      }\n      return pathHandlers[i](c, p, p0);\n    };\n  }(mlhvqtcsaz[i].toUpperCase());\n}\nfunction makeAbsolut(parser) {\n  const command = parser.segment[0];\n  return pathHandlers[command](parser.segment.slice(1), parser.p, parser.p0);\n}\nfunction segmentComplete(parser) {\n  return parser.segment.length && parser.segment.length - 1 === segmentParameters[parser.segment[0].toUpperCase()];\n}\nfunction startNewSegment(parser, token) {\n  parser.inNumber && finalizeNumber(parser, false);\n  const pathLetter = isPathLetter.test(token);\n  if (pathLetter) {\n    parser.segment = [token];\n  } else {\n    const lastCommand = parser.lastCommand;\n    const small = lastCommand.toLowerCase();\n    const isSmall = lastCommand === small;\n    parser.segment = [small === 'm' ? isSmall ? 'l' : 'L' : lastCommand];\n  }\n  parser.inSegment = true;\n  parser.lastCommand = parser.segment[0];\n  return pathLetter;\n}\nfunction finalizeNumber(parser, inNumber) {\n  if (!parser.inNumber) throw new Error('Parser Error');\n  parser.number && parser.segment.push(parseFloat(parser.number));\n  parser.inNumber = inNumber;\n  parser.number = '';\n  parser.pointSeen = false;\n  parser.hasExponent = false;\n  if (segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n}\nfunction finalizeSegment(parser) {\n  parser.inSegment = false;\n  if (parser.absolute) {\n    parser.segment = makeAbsolut(parser);\n  }\n  parser.segments.push(parser.segment);\n}\nfunction isArcFlag(parser) {\n  if (!parser.segment.length) return false;\n  const isArc = parser.segment[0].toUpperCase() === 'A';\n  const length = parser.segment.length;\n  return isArc && (length === 4 || length === 5);\n}\nfunction isExponential(parser) {\n  return parser.lastToken.toUpperCase() === 'E';\n}\nconst pathDelimiters = new Set([' ', ',', '\\t', '\\n', '\\r', '\\f']);\nfunction pathParser(d, toAbsolute = true) {\n  let index = 0;\n  let token = '';\n  const parser = {\n    segment: [],\n    inNumber: false,\n    number: '',\n    lastToken: '',\n    inSegment: false,\n    segments: [],\n    pointSeen: false,\n    hasExponent: false,\n    absolute: toAbsolute,\n    p0: new Point(),\n    p: new Point()\n  };\n  while (parser.lastToken = token, token = d.charAt(index++)) {\n    if (!parser.inSegment) {\n      if (startNewSegment(parser, token)) {\n        continue;\n      }\n    }\n    if (token === '.') {\n      if (parser.pointSeen || parser.hasExponent) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.inNumber = true;\n      parser.pointSeen = true;\n      parser.number += token;\n      continue;\n    }\n    if (!isNaN(parseInt(token))) {\n      if (parser.number === '0' || isArcFlag(parser)) {\n        parser.inNumber = true;\n        parser.number = token;\n        finalizeNumber(parser, true);\n        continue;\n      }\n      parser.inNumber = true;\n      parser.number += token;\n      continue;\n    }\n    if (pathDelimiters.has(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      }\n      continue;\n    }\n    if (token === '-' || token === '+') {\n      if (parser.inNumber && !isExponential(parser)) {\n        finalizeNumber(parser, false);\n        --index;\n        continue;\n      }\n      parser.number += token;\n      parser.inNumber = true;\n      continue;\n    }\n    if (token.toUpperCase() === 'E') {\n      parser.number += token;\n      parser.hasExponent = true;\n      continue;\n    }\n    if (isPathLetter.test(token)) {\n      if (parser.inNumber) {\n        finalizeNumber(parser, false);\n      } else if (!segmentComplete(parser)) {\n        throw new Error('parser Error');\n      } else {\n        finalizeSegment(parser);\n      }\n      --index;\n    }\n  }\n  if (parser.inNumber) {\n    finalizeNumber(parser, false);\n  }\n  if (parser.inSegment && segmentComplete(parser)) {\n    finalizeSegment(parser);\n  }\n  return parser.segments;\n}\n\nfunction arrayToString(a) {\n  let s = '';\n  for (let i = 0, il = a.length; i < il; i++) {\n    s += a[i][0];\n    if (a[i][1] != null) {\n      s += a[i][1];\n      if (a[i][2] != null) {\n        s += ' ';\n        s += a[i][2];\n        if (a[i][3] != null) {\n          s += ' ';\n          s += a[i][3];\n          s += ' ';\n          s += a[i][4];\n          if (a[i][5] != null) {\n            s += ' ';\n            s += a[i][5];\n            s += ' ';\n            s += a[i][6];\n            if (a[i][7] != null) {\n              s += ' ';\n              s += a[i][7];\n            }\n          }\n        }\n      }\n    }\n  }\n  return s + ' ';\n}\nclass PathArray extends SVGArray {\n  // Get bounding box of path\n  bbox() {\n    parser().path.setAttribute('d', this.toString());\n    return new Box(parser.nodes.path.getBBox());\n  }\n\n  // Move path string\n  move(x, y) {\n    // get bounding box of current situation\n    const box = this.bbox();\n\n    // get relative offset\n    x -= box.x;\n    y -= box.y;\n    if (!isNaN(x) && !isNaN(y)) {\n      // move every point\n      for (let l, i = this.length - 1; i >= 0; i--) {\n        l = this[i][0];\n        if (l === 'M' || l === 'L' || l === 'T') {\n          this[i][1] += x;\n          this[i][2] += y;\n        } else if (l === 'H') {\n          this[i][1] += x;\n        } else if (l === 'V') {\n          this[i][1] += y;\n        } else if (l === 'C' || l === 'S' || l === 'Q') {\n          this[i][1] += x;\n          this[i][2] += y;\n          this[i][3] += x;\n          this[i][4] += y;\n          if (l === 'C') {\n            this[i][5] += x;\n            this[i][6] += y;\n          }\n        } else if (l === 'A') {\n          this[i][6] += x;\n          this[i][7] += y;\n        }\n      }\n    }\n    return this;\n  }\n\n  // Absolutize and parse path to array\n  parse(d = 'M0 0') {\n    if (Array.isArray(d)) {\n      d = Array.prototype.concat.apply([], d).toString();\n    }\n    return pathParser(d);\n  }\n\n  // Resize path string\n  size(width, height) {\n    // get bounding box of current situation\n    const box = this.bbox();\n    let i, l;\n\n    // If the box width or height is 0 then we ignore\n    // transformations on the respective axis\n    box.width = box.width === 0 ? 1 : box.width;\n    box.height = box.height === 0 ? 1 : box.height;\n\n    // recalculate position of all points according to new size\n    for (i = this.length - 1; i >= 0; i--) {\n      l = this[i][0];\n      if (l === 'M' || l === 'L' || l === 'T') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n      } else if (l === 'H') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n      } else if (l === 'V') {\n        this[i][1] = (this[i][1] - box.y) * height / box.height + box.y;\n      } else if (l === 'C' || l === 'S' || l === 'Q') {\n        this[i][1] = (this[i][1] - box.x) * width / box.width + box.x;\n        this[i][2] = (this[i][2] - box.y) * height / box.height + box.y;\n        this[i][3] = (this[i][3] - box.x) * width / box.width + box.x;\n        this[i][4] = (this[i][4] - box.y) * height / box.height + box.y;\n        if (l === 'C') {\n          this[i][5] = (this[i][5] - box.x) * width / box.width + box.x;\n          this[i][6] = (this[i][6] - box.y) * height / box.height + box.y;\n        }\n      } else if (l === 'A') {\n        // resize radii\n        this[i][1] = this[i][1] * width / box.width;\n        this[i][2] = this[i][2] * height / box.height;\n\n        // move position values\n        this[i][6] = (this[i][6] - box.x) * width / box.width + box.x;\n        this[i][7] = (this[i][7] - box.y) * height / box.height + box.y;\n      }\n    }\n    return this;\n  }\n\n  // Convert array to string\n  toString() {\n    return arrayToString(this);\n  }\n}\n\nconst getClassForType = value => {\n  const type = typeof value;\n  if (type === 'number') {\n    return SVGNumber;\n  } else if (type === 'string') {\n    if (Color.isColor(value)) {\n      return Color;\n    } else if (delimiter.test(value)) {\n      return isPathLetter.test(value) ? PathArray : SVGArray;\n    } else if (numberAndUnit.test(value)) {\n      return SVGNumber;\n    } else {\n      return NonMorphable;\n    }\n  } else if (morphableTypes.indexOf(value.constructor) > -1) {\n    return value.constructor;\n  } else if (Array.isArray(value)) {\n    return SVGArray;\n  } else if (type === 'object') {\n    return ObjectBag;\n  } else {\n    return NonMorphable;\n  }\n};\nclass Morphable {\n  constructor(stepper) {\n    this._stepper = stepper || new Ease('-');\n    this._from = null;\n    this._to = null;\n    this._type = null;\n    this._context = null;\n    this._morphObj = null;\n  }\n  at(pos) {\n    return this._morphObj.morph(this._from, this._to, pos, this._stepper, this._context);\n  }\n  done() {\n    const complete = this._context.map(this._stepper.done).reduce(function (last, curr) {\n      return last && curr;\n    }, true);\n    return complete;\n  }\n  from(val) {\n    if (val == null) {\n      return this._from;\n    }\n    this._from = this._set(val);\n    return this;\n  }\n  stepper(stepper) {\n    if (stepper == null) return this._stepper;\n    this._stepper = stepper;\n    return this;\n  }\n  to(val) {\n    if (val == null) {\n      return this._to;\n    }\n    this._to = this._set(val);\n    return this;\n  }\n  type(type) {\n    // getter\n    if (type == null) {\n      return this._type;\n    }\n\n    // setter\n    this._type = type;\n    return this;\n  }\n  _set(value) {\n    if (!this._type) {\n      this.type(getClassForType(value));\n    }\n    let result = new this._type(value);\n    if (this._type === Color) {\n      result = this._to ? result[this._to[4]]() : this._from ? result[this._from[4]]() : result;\n    }\n    if (this._type === ObjectBag) {\n      result = this._to ? result.align(this._to) : this._from ? result.align(this._from) : result;\n    }\n    result = result.toConsumable();\n    this._morphObj = this._morphObj || new this._type();\n    this._context = this._context || Array.apply(null, Array(result.length)).map(Object).map(function (o) {\n      o.done = true;\n      return o;\n    });\n    return result;\n  }\n}\nclass NonMorphable {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(val) {\n    val = Array.isArray(val) ? val[0] : val;\n    this.value = val;\n    return this;\n  }\n  toArray() {\n    return [this.value];\n  }\n  valueOf() {\n    return this.value;\n  }\n}\nclass TransformBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  init(obj) {\n    if (Array.isArray(obj)) {\n      obj = {\n        scaleX: obj[0],\n        scaleY: obj[1],\n        shear: obj[2],\n        rotate: obj[3],\n        translateX: obj[4],\n        translateY: obj[5],\n        originX: obj[6],\n        originY: obj[7]\n      };\n    }\n    Object.assign(this, TransformBag.defaults, obj);\n    return this;\n  }\n  toArray() {\n    const v = this;\n    return [v.scaleX, v.scaleY, v.shear, v.rotate, v.translateX, v.translateY, v.originX, v.originY];\n  }\n}\nTransformBag.defaults = {\n  scaleX: 1,\n  scaleY: 1,\n  shear: 0,\n  rotate: 0,\n  translateX: 0,\n  translateY: 0,\n  originX: 0,\n  originY: 0\n};\nconst sortByKey = (a, b) => {\n  return a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0;\n};\nclass ObjectBag {\n  constructor(...args) {\n    this.init(...args);\n  }\n  align(other) {\n    const values = this.values;\n    for (let i = 0, il = values.length; i < il; ++i) {\n      // If the type is the same we only need to check if the color is in the correct format\n      if (values[i + 1] === other[i + 1]) {\n        if (values[i + 1] === Color && other[i + 7] !== values[i + 7]) {\n          const space = other[i + 7];\n          const color = new Color(this.values.splice(i + 3, 5))[space]().toArray();\n          this.values.splice(i + 3, 0, ...color);\n        }\n        i += values[i + 2] + 2;\n        continue;\n      }\n      if (!other[i + 1]) {\n        return this;\n      }\n\n      // The types differ, so we overwrite the new type with the old one\n      // And initialize it with the types default (e.g. black for color or 0 for number)\n      const defaultObject = new other[i + 1]().toArray();\n\n      // Than we fix the values array\n      const toDelete = values[i + 2] + 3;\n      values.splice(i, toDelete, other[i], other[i + 1], other[i + 2], ...defaultObject);\n      i += values[i + 2] + 2;\n    }\n    return this;\n  }\n  init(objOrArr) {\n    this.values = [];\n    if (Array.isArray(objOrArr)) {\n      this.values = objOrArr.slice();\n      return;\n    }\n    objOrArr = objOrArr || {};\n    const entries = [];\n    for (const i in objOrArr) {\n      const Type = getClassForType(objOrArr[i]);\n      const val = new Type(objOrArr[i]).toArray();\n      entries.push([i, Type, val.length, ...val]);\n    }\n    entries.sort(sortByKey);\n    this.values = entries.reduce((last, curr) => last.concat(curr), []);\n    return this;\n  }\n  toArray() {\n    return this.values;\n  }\n  valueOf() {\n    const obj = {};\n    const arr = this.values;\n\n    // for (var i = 0, len = arr.length; i < len; i += 2) {\n    while (arr.length) {\n      const key = arr.shift();\n      const Type = arr.shift();\n      const num = arr.shift();\n      const values = arr.splice(0, num);\n      obj[key] = new Type(values); // .valueOf()\n    }\n    return obj;\n  }\n}\nconst morphableTypes = [NonMorphable, TransformBag, ObjectBag];\nfunction registerMorphableType(type = []) {\n  morphableTypes.push(...[].concat(type));\n}\nfunction makeMorphable() {\n  extend(morphableTypes, {\n    to(val) {\n      return new Morphable().type(this.constructor).from(this.toArray()) // this.valueOf())\n      .to(val);\n    },\n    fromArray(arr) {\n      this.init(arr);\n      return this;\n    },\n    toConsumable() {\n      return this.toArray();\n    },\n    morph(from, to, pos, stepper, context) {\n      const mapper = function (i, index) {\n        return stepper.step(i, to[index], pos, context[index], context);\n      };\n      return this.fromArray(from.map(mapper));\n    }\n  });\n}\n\nclass Path extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('path', node), attrs);\n  }\n\n  // Get array\n  array() {\n    return this._array || (this._array = new PathArray(this.attr('d')));\n  }\n\n  // Clear array cache\n  clear() {\n    delete this._array;\n    return this;\n  }\n\n  // Set height of element\n  height(height) {\n    return height == null ? this.bbox().height : this.size(this.bbox().width, height);\n  }\n\n  // Move by left top corner\n  move(x, y) {\n    return this.attr('d', this.array().move(x, y));\n  }\n\n  // Plot new path\n  plot(d) {\n    return d == null ? this.array() : this.clear().attr('d', typeof d === 'string' ? d : this._array = new PathArray(d));\n  }\n\n  // Set element size to given width and height\n  size(width, height) {\n    const p = proportionalSize(this, width, height);\n    return this.attr('d', this.array().size(p.width, p.height));\n  }\n\n  // Set width of element\n  width(width) {\n    return width == null ? this.bbox().width : this.size(width, this.bbox().height);\n  }\n\n  // Move by left top corner over x-axis\n  x(x) {\n    return x == null ? this.bbox().x : this.move(x, this.bbox().y);\n  }\n\n  // Move by left top corner over y-axis\n  y(y) {\n    return y == null ? this.bbox().y : this.move(this.bbox().x, y);\n  }\n}\n\n// Define morphable array\nPath.prototype.MorphArray = PathArray;\n\n// Add parent method\nregisterMethods({\n  Container: {\n    // Create a wrapped path element\n    path: wrapWithAttrCheck(function (d) {\n      // make sure plot is called as a setter\n      return this.put(new Path()).plot(d || new PathArray());\n    })\n  }\n});\nregister(Path, 'Path');\n\n// Get array\nfunction array() {\n  return this._array || (this._array = new PointArray(this.attr('points')));\n}\n\n// Clear array cache\nfunction clear() {\n  delete this._array;\n  return this;\n}\n\n// Move by left top corner\nfunction move$2(x, y) {\n  return this.attr('points', this.array().move(x, y));\n}\n\n// Plot new path\nfunction plot(p) {\n  return p == null ? this.array() : this.clear().attr('points', typeof p === 'string' ? p : this._array = new PointArray(p));\n}\n\n// Set element size to given width and height\nfunction size$1(width, height) {\n  const p = proportionalSize(this, width, height);\n  return this.attr('points', this.array().size(p.width, p.height));\n}\n\nvar poly = {\n  __proto__: null,\n  array: array,\n  clear: clear,\n  move: move$2,\n  plot: plot,\n  size: size$1\n};\n\nclass Polygon extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polygon', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polygon: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polygon()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polygon, pointed);\nextend(Polygon, poly);\nregister(Polygon, 'Polygon');\n\nclass Polyline extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('polyline', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a wrapped polygon element\n    polyline: wrapWithAttrCheck(function (p) {\n      // make sure plot is called as a setter\n      return this.put(new Polyline()).plot(p || new PointArray());\n    })\n  }\n});\nextend(Polyline, pointed);\nextend(Polyline, poly);\nregister(Polyline, 'Polyline');\n\nclass Rect extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('rect', node), attrs);\n  }\n}\nextend(Rect, {\n  rx,\n  ry\n});\nregisterMethods({\n  Container: {\n    // Create a rect element\n    rect: wrapWithAttrCheck(function (width, height) {\n      return this.put(new Rect()).size(width, height);\n    })\n  }\n});\nregister(Rect, 'Rect');\n\nclass Queue {\n  constructor() {\n    this._first = null;\n    this._last = null;\n  }\n\n  // Shows us the first item in the list\n  first() {\n    return this._first && this._first.value;\n  }\n\n  // Shows us the last item in the list\n  last() {\n    return this._last && this._last.value;\n  }\n  push(value) {\n    // An item stores an id and the provided value\n    const item = typeof value.next !== 'undefined' ? value : {\n      value: value,\n      next: null,\n      prev: null\n    };\n\n    // Deal with the queue being empty or populated\n    if (this._last) {\n      item.prev = this._last;\n      this._last.next = item;\n      this._last = item;\n    } else {\n      this._last = item;\n      this._first = item;\n    }\n\n    // Return the current item\n    return item;\n  }\n\n  // Removes the item that was returned from the push\n  remove(item) {\n    // Relink the previous item\n    if (item.prev) item.prev.next = item.next;\n    if (item.next) item.next.prev = item.prev;\n    if (item === this._last) this._last = item.prev;\n    if (item === this._first) this._first = item.next;\n\n    // Invalidate item\n    item.prev = null;\n    item.next = null;\n  }\n  shift() {\n    // Check if we have a value\n    const remove = this._first;\n    if (!remove) return null;\n\n    // If we do, remove it and relink things\n    this._first = remove.next;\n    if (this._first) this._first.prev = null;\n    this._last = this._first ? this._last : null;\n    return remove.value;\n  }\n}\n\nconst Animator = {\n  nextDraw: null,\n  frames: new Queue(),\n  timeouts: new Queue(),\n  immediates: new Queue(),\n  timer: () => globals.window.performance || globals.window.Date,\n  transforms: [],\n  frame(fn) {\n    // Store the node\n    const node = Animator.frames.push({\n      run: fn\n    });\n\n    // Request an animation frame if we don't have one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n\n    // Return the node so we can remove it easily\n    return node;\n  },\n  timeout(fn, delay) {\n    delay = delay || 0;\n\n    // Work out when the event should fire\n    const time = Animator.timer().now() + delay;\n\n    // Add the timeout to the end of the queue\n    const node = Animator.timeouts.push({\n      run: fn,\n      time: time\n    });\n\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  immediate(fn) {\n    // Add the immediate fn to the end of the queue\n    const node = Animator.immediates.push(fn);\n    // Request another animation frame if we need one\n    if (Animator.nextDraw === null) {\n      Animator.nextDraw = globals.window.requestAnimationFrame(Animator._draw);\n    }\n    return node;\n  },\n  cancelFrame(node) {\n    node != null && Animator.frames.remove(node);\n  },\n  clearTimeout(node) {\n    node != null && Animator.timeouts.remove(node);\n  },\n  cancelImmediate(node) {\n    node != null && Animator.immediates.remove(node);\n  },\n  _draw(now) {\n    // Run all the timeouts we can run, if they are not ready yet, add them\n    // to the end of the queue immediately! (bad timeouts!!! [sarcasm])\n    let nextTimeout = null;\n    const lastTimeout = Animator.timeouts.last();\n    while (nextTimeout = Animator.timeouts.shift()) {\n      // Run the timeout if its time, or push it to the end\n      if (now >= nextTimeout.time) {\n        nextTimeout.run();\n      } else {\n        Animator.timeouts.push(nextTimeout);\n      }\n\n      // If we hit the last item, we should stop shifting out more items\n      if (nextTimeout === lastTimeout) break;\n    }\n\n    // Run all of the animation frames\n    let nextFrame = null;\n    const lastFrame = Animator.frames.last();\n    while (nextFrame !== lastFrame && (nextFrame = Animator.frames.shift())) {\n      nextFrame.run(now);\n    }\n    let nextImmediate = null;\n    while (nextImmediate = Animator.immediates.shift()) {\n      nextImmediate();\n    }\n\n    // If we have remaining timeouts or frames, draw until we don't anymore\n    Animator.nextDraw = Animator.timeouts.first() || Animator.frames.first() ? globals.window.requestAnimationFrame(Animator._draw) : null;\n  }\n};\n\nconst makeSchedule = function (runnerInfo) {\n  const start = runnerInfo.start;\n  const duration = runnerInfo.runner.duration();\n  const end = start + duration;\n  return {\n    start: start,\n    duration: duration,\n    end: end,\n    runner: runnerInfo.runner\n  };\n};\nconst defaultSource = function () {\n  const w = globals.window;\n  return (w.performance || w.Date).now();\n};\nclass Timeline extends EventTarget {\n  // Construct a new timeline on the given element\n  constructor(timeSource = defaultSource) {\n    super();\n    this._timeSource = timeSource;\n\n    // terminate resets all variables to their initial state\n    this.terminate();\n  }\n  active() {\n    return !!this._nextFrame;\n  }\n  finish() {\n    // Go to end and pause\n    this.time(this.getEndTimeOfTimeline() + 1);\n    return this.pause();\n  }\n\n  // Calculates the end of the timeline\n  getEndTime() {\n    const lastRunnerInfo = this.getLastRunnerInfo();\n    const lastDuration = lastRunnerInfo ? lastRunnerInfo.runner.duration() : 0;\n    const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n    return lastStartTime + lastDuration;\n  }\n  getEndTimeOfTimeline() {\n    const endTimes = this._runners.map(i => i.start + i.runner.duration());\n    return Math.max(0, ...endTimes);\n  }\n  getLastRunnerInfo() {\n    return this.getRunnerInfoById(this._lastRunnerId);\n  }\n  getRunnerInfoById(id) {\n    return this._runners[this._runnerIds.indexOf(id)] || null;\n  }\n  pause() {\n    this._paused = true;\n    return this._continue();\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  play() {\n    // Now make sure we are not paused and continue the animation\n    this._paused = false;\n    return this.updateTime()._continue();\n  }\n  reverse(yes) {\n    const currentSpeed = this.speed();\n    if (yes == null) return this.speed(-currentSpeed);\n    const positive = Math.abs(currentSpeed);\n    return this.speed(yes ? -positive : positive);\n  }\n\n  // schedules a runner on the timeline\n  schedule(runner, delay, when) {\n    if (runner == null) {\n      return this._runners.map(makeSchedule);\n    }\n\n    // The start time for the next animation can either be given explicitly,\n    // derived from the current timeline time or it can be relative to the\n    // last start time to chain animations directly\n\n    let absoluteStartTime = 0;\n    const endTime = this.getEndTime();\n    delay = delay || 0;\n\n    // Work out when to start the animation\n    if (when == null || when === 'last' || when === 'after') {\n      // Take the last time and increment\n      absoluteStartTime = endTime;\n    } else if (when === 'absolute' || when === 'start') {\n      absoluteStartTime = delay;\n      delay = 0;\n    } else if (when === 'now') {\n      absoluteStartTime = this._time;\n    } else if (when === 'relative') {\n      const runnerInfo = this.getRunnerInfoById(runner.id);\n      if (runnerInfo) {\n        absoluteStartTime = runnerInfo.start + delay;\n        delay = 0;\n      }\n    } else if (when === 'with-last') {\n      const lastRunnerInfo = this.getLastRunnerInfo();\n      const lastStartTime = lastRunnerInfo ? lastRunnerInfo.start : this._time;\n      absoluteStartTime = lastStartTime;\n    } else {\n      throw new Error('Invalid value for the \"when\" parameter');\n    }\n\n    // Manage runner\n    runner.unschedule();\n    runner.timeline(this);\n    const persist = runner.persist();\n    const runnerInfo = {\n      persist: persist === null ? this._persist : persist,\n      start: absoluteStartTime + delay,\n      runner\n    };\n    this._lastRunnerId = runner.id;\n    this._runners.push(runnerInfo);\n    this._runners.sort((a, b) => a.start - b.start);\n    this._runnerIds = this._runners.map(info => info.runner.id);\n    this.updateTime()._continue();\n    return this;\n  }\n  seek(dt) {\n    return this.time(this._time + dt);\n  }\n  source(fn) {\n    if (fn == null) return this._timeSource;\n    this._timeSource = fn;\n    return this;\n  }\n  speed(speed) {\n    if (speed == null) return this._speed;\n    this._speed = speed;\n    return this;\n  }\n  stop() {\n    // Go to start and pause\n    this.time(0);\n    return this.pause();\n  }\n  time(time) {\n    if (time == null) return this._time;\n    this._time = time;\n    return this._continue(true);\n  }\n\n  // Remove the runner from this timeline\n  unschedule(runner) {\n    const index = this._runnerIds.indexOf(runner.id);\n    if (index < 0) return this;\n    this._runners.splice(index, 1);\n    this._runnerIds.splice(index, 1);\n    runner.timeline(null);\n    return this;\n  }\n\n  // Makes sure, that after pausing the time doesn't jump\n  updateTime() {\n    if (!this.active()) {\n      this._lastSourceTime = this._timeSource();\n    }\n    return this;\n  }\n\n  // Checks if we are running and continues the animation\n  _continue(immediateStep = false) {\n    Animator.cancelFrame(this._nextFrame);\n    this._nextFrame = null;\n    if (immediateStep) return this._stepImmediate();\n    if (this._paused) return this;\n    this._nextFrame = Animator.frame(this._step);\n    return this;\n  }\n  _stepFn(immediateStep = false) {\n    // Get the time delta from the last time and update the time\n    const time = this._timeSource();\n    let dtSource = time - this._lastSourceTime;\n    if (immediateStep) dtSource = 0;\n    const dtTime = this._speed * dtSource + (this._time - this._lastStepTime);\n    this._lastSourceTime = time;\n\n    // Only update the time if we use the timeSource.\n    // Otherwise use the current time\n    if (!immediateStep) {\n      // Update the time\n      this._time += dtTime;\n      this._time = this._time < 0 ? 0 : this._time;\n    }\n    this._lastStepTime = this._time;\n    this.fire('time', this._time);\n\n    // This is for the case that the timeline was seeked so that the time\n    // is now before the startTime of the runner. That is why we need to set\n    // the runner to position 0\n\n    // FIXME:\n    // However, resetting in insertion order leads to bugs. Considering the case,\n    // where 2 runners change the same attribute but in different times,\n    // resetting both of them will lead to the case where the later defined\n    // runner always wins the reset even if the other runner started earlier\n    // and therefore should win the attribute battle\n    // this can be solved by resetting them backwards\n    for (let k = this._runners.length; k--;) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[k];\n      const runner = runnerInfo.runner;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      // and try to reset it\n      if (dtToStart <= 0) {\n        runner.reset();\n      }\n    }\n\n    // Run all of the runners directly\n    let runnersLeft = false;\n    for (let i = 0, len = this._runners.length; i < len; i++) {\n      // Get and run the current runner and ignore it if its inactive\n      const runnerInfo = this._runners[i];\n      const runner = runnerInfo.runner;\n      let dt = dtTime;\n\n      // Make sure that we give the actual difference\n      // between runner start time and now\n      const dtToStart = this._time - runnerInfo.start;\n\n      // Dont run runner if not started yet\n      if (dtToStart <= 0) {\n        runnersLeft = true;\n        continue;\n      } else if (dtToStart < dt) {\n        // Adjust dt to make sure that animation is on point\n        dt = dtToStart;\n      }\n      if (!runner.active()) continue;\n\n      // If this runner is still going, signal that we need another animation\n      // frame, otherwise, remove the completed runner\n      const finished = runner.step(dt).done;\n      if (!finished) {\n        runnersLeft = true;\n        // continue\n      } else if (runnerInfo.persist !== true) {\n        // runner is finished. And runner might get removed\n        const endTime = runner.duration() - runner.time() + this._time;\n        if (endTime + runnerInfo.persist < this._time) {\n          // Delete runner and correct index\n          runner.unschedule();\n          --i;\n          --len;\n        }\n      }\n    }\n\n    // Basically: we continue when there are runners right from us in time\n    // when -->, and when runners are left from us when <--\n    if (runnersLeft && !(this._speed < 0 && this._time === 0) || this._runnerIds.length && this._speed < 0 && this._time > 0) {\n      this._continue();\n    } else {\n      this.pause();\n      this.fire('finished');\n    }\n    return this;\n  }\n  terminate() {\n    // cleanup memory\n\n    // Store the timing variables\n    this._startTime = 0;\n    this._speed = 1.0;\n\n    // Determines how long a runner is hold in memory. Can be a dt or true/false\n    this._persist = 0;\n\n    // Keep track of the running animations and their starting parameters\n    this._nextFrame = null;\n    this._paused = true;\n    this._runners = [];\n    this._runnerIds = [];\n    this._lastRunnerId = -1;\n    this._time = 0;\n    this._lastSourceTime = 0;\n    this._lastStepTime = 0;\n\n    // Make sure that step is always called in class context\n    this._step = this._stepFn.bind(this, false);\n    this._stepImmediate = this._stepFn.bind(this, true);\n  }\n}\nregisterMethods({\n  Element: {\n    timeline: function (timeline) {\n      if (timeline == null) {\n        this._timeline = this._timeline || new Timeline();\n        return this._timeline;\n      } else {\n        this._timeline = timeline;\n        return this;\n      }\n    }\n  }\n});\n\nclass Runner extends EventTarget {\n  constructor(options) {\n    super();\n\n    // Store a unique id on the runner, so that we can identify it later\n    this.id = Runner.id++;\n\n    // Ensure a default value\n    options = options == null ? timeline.duration : options;\n\n    // Ensure that we get a controller\n    options = typeof options === 'function' ? new Controller(options) : options;\n\n    // Declare all of the variables\n    this._element = null;\n    this._timeline = null;\n    this.done = false;\n    this._queue = [];\n\n    // Work out the stepper and the duration\n    this._duration = typeof options === 'number' && options;\n    this._isDeclarative = options instanceof Controller;\n    this._stepper = this._isDeclarative ? options : new Ease();\n\n    // We copy the current values from the timeline because they can change\n    this._history = {};\n\n    // Store the state of the runner\n    this.enabled = true;\n    this._time = 0;\n    this._lastTime = 0;\n\n    // At creation, the runner is in reset state\n    this._reseted = true;\n\n    // Save transforms applied to this runner\n    this.transforms = new Matrix();\n    this.transformId = 1;\n\n    // Looping variables\n    this._haveReversed = false;\n    this._reverse = false;\n    this._loopsDone = 0;\n    this._swing = false;\n    this._wait = 0;\n    this._times = 1;\n    this._frameId = null;\n\n    // Stores how long a runner is stored after being done\n    this._persist = this._isDeclarative ? true : null;\n  }\n  static sanitise(duration, delay, when) {\n    // Initialise the default parameters\n    let times = 1;\n    let swing = false;\n    let wait = 0;\n    duration = duration ?? timeline.duration;\n    delay = delay ?? timeline.delay;\n    when = when || 'last';\n\n    // If we have an object, unpack the values\n    if (typeof duration === 'object' && !(duration instanceof Stepper)) {\n      delay = duration.delay ?? delay;\n      when = duration.when ?? when;\n      swing = duration.swing || swing;\n      times = duration.times ?? times;\n      wait = duration.wait ?? wait;\n      duration = duration.duration ?? timeline.duration;\n    }\n    return {\n      duration: duration,\n      delay: delay,\n      swing: swing,\n      times: times,\n      wait: wait,\n      when: when\n    };\n  }\n  active(enabled) {\n    if (enabled == null) return this.enabled;\n    this.enabled = enabled;\n    return this;\n  }\n\n  /*\n  Private Methods\n  ===============\n  Methods that shouldn't be used externally\n  */\n  addTransform(transform) {\n    this.transforms.lmultiplyO(transform);\n    return this;\n  }\n  after(fn) {\n    return this.on('finished', fn);\n  }\n  animate(duration, delay, when) {\n    const o = Runner.sanitise(duration, delay, when);\n    const runner = new Runner(o.duration);\n    if (this._timeline) runner.timeline(this._timeline);\n    if (this._element) runner.element(this._element);\n    return runner.loop(o).schedule(o.delay, o.when);\n  }\n  clearTransform() {\n    this.transforms = new Matrix();\n    return this;\n  }\n\n  // TODO: Keep track of all transformations so that deletion is faster\n  clearTransformsFromQueue() {\n    if (!this.done || !this._timeline || !this._timeline._runnerIds.includes(this.id)) {\n      this._queue = this._queue.filter(item => {\n        return !item.isTransform;\n      });\n    }\n  }\n  delay(delay) {\n    return this.animate(0, delay);\n  }\n  duration() {\n    return this._times * (this._wait + this._duration) - this._wait;\n  }\n  during(fn) {\n    return this.queue(null, fn);\n  }\n  ease(fn) {\n    this._stepper = new Ease(fn);\n    return this;\n  }\n  /*\n  Runner Definitions\n  ==================\n  These methods help us define the runtime behaviour of the Runner or they\n  help us make new runners from the current runner\n  */\n\n  element(element) {\n    if (element == null) return this._element;\n    this._element = element;\n    element._prepareRunner();\n    return this;\n  }\n  finish() {\n    return this.step(Infinity);\n  }\n  loop(times, swing, wait) {\n    // Deal with the user passing in an object\n    if (typeof times === 'object') {\n      swing = times.swing;\n      wait = times.wait;\n      times = times.times;\n    }\n\n    // Sanitise the values and store them\n    this._times = times || Infinity;\n    this._swing = swing || false;\n    this._wait = wait || 0;\n\n    // Allow true to be passed\n    if (this._times === true) {\n      this._times = Infinity;\n    }\n    return this;\n  }\n  loops(p) {\n    const loopDuration = this._duration + this._wait;\n    if (p == null) {\n      const loopsDone = Math.floor(this._time / loopDuration);\n      const relativeTime = this._time - loopsDone * loopDuration;\n      const position = relativeTime / this._duration;\n      return Math.min(loopsDone + position, this._times);\n    }\n    const whole = Math.floor(p);\n    const partial = p % 1;\n    const time = loopDuration * whole + this._duration * partial;\n    return this.time(time);\n  }\n  persist(dtOrForever) {\n    if (dtOrForever == null) return this._persist;\n    this._persist = dtOrForever;\n    return this;\n  }\n  position(p) {\n    // Get all of the variables we need\n    const x = this._time;\n    const d = this._duration;\n    const w = this._wait;\n    const t = this._times;\n    const s = this._swing;\n    const r = this._reverse;\n    let position;\n    if (p == null) {\n      /*\n      This function converts a time to a position in the range [0, 1]\n      The full explanation can be found in this desmos demonstration\n        https://www.desmos.com/calculator/u4fbavgche\n      The logic is slightly simplified here because we can use booleans\n      */\n\n      // Figure out the value without thinking about the start or end time\n      const f = function (x) {\n        const swinging = s * Math.floor(x % (2 * (w + d)) / (w + d));\n        const backwards = swinging && !r || !swinging && r;\n        const uncliped = Math.pow(-1, backwards) * (x % (w + d)) / d + backwards;\n        const clipped = Math.max(Math.min(uncliped, 1), 0);\n        return clipped;\n      };\n\n      // Figure out the value by incorporating the start time\n      const endTime = t * (w + d) - w;\n      position = x <= 0 ? Math.round(f(1e-5)) : x < endTime ? f(x) : Math.round(f(endTime - 1e-5));\n      return position;\n    }\n\n    // Work out the loops done and add the position to the loops done\n    const loopsDone = Math.floor(this.loops());\n    const swingForward = s && loopsDone % 2 === 0;\n    const forwards = swingForward && !r || r && swingForward;\n    position = loopsDone + (forwards ? p : 1 - p);\n    return this.loops(position);\n  }\n  progress(p) {\n    if (p == null) {\n      return Math.min(1, this._time / this.duration());\n    }\n    return this.time(p * this.duration());\n  }\n\n  /*\n  Basic Functionality\n  ===================\n  These methods allow us to attach basic functions to the runner directly\n  */\n  queue(initFn, runFn, retargetFn, isTransform) {\n    this._queue.push({\n      initialiser: initFn || noop,\n      runner: runFn || noop,\n      retarget: retargetFn,\n      isTransform: isTransform,\n      initialised: false,\n      finished: false\n    });\n    const timeline = this.timeline();\n    timeline && this.timeline()._continue();\n    return this;\n  }\n  reset() {\n    if (this._reseted) return this;\n    this.time(0);\n    this._reseted = true;\n    return this;\n  }\n  reverse(reverse) {\n    this._reverse = reverse == null ? !this._reverse : reverse;\n    return this;\n  }\n  schedule(timeline, delay, when) {\n    // The user doesn't need to pass a timeline if we already have one\n    if (!(timeline instanceof Timeline)) {\n      when = delay;\n      delay = timeline;\n      timeline = this.timeline();\n    }\n\n    // If there is no timeline, yell at the user...\n    if (!timeline) {\n      throw Error('Runner cannot be scheduled without timeline');\n    }\n\n    // Schedule the runner on the timeline provided\n    timeline.schedule(this, delay, when);\n    return this;\n  }\n  step(dt) {\n    // If we are inactive, this stepper just gets skipped\n    if (!this.enabled) return this;\n\n    // Update the time and get the new position\n    dt = dt == null ? 16 : dt;\n    this._time += dt;\n    const position = this.position();\n\n    // Figure out if we need to run the stepper in this frame\n    const running = this._lastPosition !== position && this._time >= 0;\n    this._lastPosition = position;\n\n    // Figure out if we just started\n    const duration = this.duration();\n    const justStarted = this._lastTime <= 0 && this._time > 0;\n    const justFinished = this._lastTime < duration && this._time >= duration;\n    this._lastTime = this._time;\n    if (justStarted) {\n      this.fire('start', this);\n    }\n\n    // Work out if the runner is finished set the done flag here so animations\n    // know, that they are running in the last step (this is good for\n    // transformations which can be merged)\n    const declarative = this._isDeclarative;\n    this.done = !declarative && !justFinished && this._time >= duration;\n\n    // Runner is running. So its not in reset state anymore\n    this._reseted = false;\n    let converged = false;\n    // Call initialise and the run function\n    if (running || declarative) {\n      this._initialise(running);\n\n      // clear the transforms on this runner so they dont get added again and again\n      this.transforms = new Matrix();\n      converged = this._run(declarative ? dt : position);\n      this.fire('step', this);\n    }\n    // correct the done flag here\n    // declarative animations itself know when they converged\n    this.done = this.done || converged && declarative;\n    if (justFinished) {\n      this.fire('finished', this);\n    }\n    return this;\n  }\n\n  /*\n  Runner animation methods\n  ========================\n  Control how the animation plays\n  */\n  time(time) {\n    if (time == null) {\n      return this._time;\n    }\n    const dt = time - this._time;\n    this.step(dt);\n    return this;\n  }\n  timeline(timeline) {\n    // check explicitly for undefined so we can set the timeline to null\n    if (typeof timeline === 'undefined') return this._timeline;\n    this._timeline = timeline;\n    return this;\n  }\n  unschedule() {\n    const timeline = this.timeline();\n    timeline && timeline.unschedule(this);\n    return this;\n  }\n\n  // Run each initialise function in the runner if required\n  _initialise(running) {\n    // If we aren't running, we shouldn't initialise when not declarative\n    if (!running && !this._isDeclarative) return;\n\n    // Loop through all of the initialisers\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current initialiser\n      const current = this._queue[i];\n\n      // Determine whether we need to initialise\n      const needsIt = this._isDeclarative || !current.initialised && running;\n      running = !current.finished;\n\n      // Call the initialiser if we need to\n      if (needsIt && running) {\n        current.initialiser.call(this);\n        current.initialised = true;\n      }\n    }\n  }\n\n  // Save a morpher to the morpher list so that we can retarget it later\n  _rememberMorpher(method, morpher) {\n    this._history[method] = {\n      morpher: morpher,\n      caller: this._queue[this._queue.length - 1]\n    };\n\n    // We have to resume the timeline in case a controller\n    // is already done without being ever run\n    // This can happen when e.g. this is done:\n    //    anim = el.animate(new SVG.Spring)\n    // and later\n    //    anim.move(...)\n    if (this._isDeclarative) {\n      const timeline = this.timeline();\n      timeline && timeline.play();\n    }\n  }\n\n  // Try to set the target for a morpher if the morpher exists, otherwise\n  // Run each run function for the position or dt given\n  _run(positionOrDt) {\n    // Run all of the _queue directly\n    let allfinished = true;\n    for (let i = 0, len = this._queue.length; i < len; ++i) {\n      // Get the current function to run\n      const current = this._queue[i];\n\n      // Run the function if its not finished, we keep track of the finished\n      // flag for the sake of declarative _queue\n      const converged = current.runner.call(this, positionOrDt);\n      current.finished = current.finished || converged === true;\n      allfinished = allfinished && current.finished;\n    }\n\n    // We report when all of the constructors are finished\n    return allfinished;\n  }\n\n  // do nothing and return false\n  _tryRetarget(method, target, extra) {\n    if (this._history[method]) {\n      // if the last method wasn't even initialised, throw it away\n      if (!this._history[method].caller.initialised) {\n        const index = this._queue.indexOf(this._history[method].caller);\n        this._queue.splice(index, 1);\n        return false;\n      }\n\n      // for the case of transformations, we use the special retarget function\n      // which has access to the outer scope\n      if (this._history[method].caller.retarget) {\n        this._history[method].caller.retarget.call(this, target, extra);\n        // for everything else a simple morpher change is sufficient\n      } else {\n        this._history[method].morpher.to(target);\n      }\n      this._history[method].caller.finished = false;\n      const timeline = this.timeline();\n      timeline && timeline.play();\n      return true;\n    }\n    return false;\n  }\n}\nRunner.id = 0;\nclass FakeRunner {\n  constructor(transforms = new Matrix(), id = -1, done = true) {\n    this.transforms = transforms;\n    this.id = id;\n    this.done = done;\n  }\n  clearTransformsFromQueue() {}\n}\nextend([Runner, FakeRunner], {\n  mergeWith(runner) {\n    return new FakeRunner(runner.transforms.lmultiply(this.transforms), runner.id);\n  }\n});\n\n// FakeRunner.emptyRunner = new FakeRunner()\n\nconst lmultiply = (last, curr) => last.lmultiplyO(curr);\nconst getRunnerTransform = runner => runner.transforms;\nfunction mergeTransforms() {\n  // Find the matrix to apply to the element and apply it\n  const runners = this._transformationRunners.runners;\n  const netTransform = runners.map(getRunnerTransform).reduce(lmultiply, new Matrix());\n  this.transform(netTransform);\n  this._transformationRunners.merge();\n  if (this._transformationRunners.length() === 1) {\n    this._frameId = null;\n  }\n}\nclass RunnerArray {\n  constructor() {\n    this.runners = [];\n    this.ids = [];\n  }\n  add(runner) {\n    if (this.runners.includes(runner)) return;\n    const id = runner.id + 1;\n    this.runners.push(runner);\n    this.ids.push(id);\n    return this;\n  }\n  clearBefore(id) {\n    const deleteCnt = this.ids.indexOf(id + 1) || 1;\n    this.ids.splice(0, deleteCnt, 0);\n    this.runners.splice(0, deleteCnt, new FakeRunner()).forEach(r => r.clearTransformsFromQueue());\n    return this;\n  }\n  edit(id, newRunner) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1, id + 1);\n    this.runners.splice(index, 1, newRunner);\n    return this;\n  }\n  getByID(id) {\n    return this.runners[this.ids.indexOf(id + 1)];\n  }\n  length() {\n    return this.ids.length;\n  }\n  merge() {\n    let lastRunner = null;\n    for (let i = 0; i < this.runners.length; ++i) {\n      const runner = this.runners[i];\n      const condition = lastRunner && runner.done && lastRunner.done && (\n      // don't merge runner when persisted on timeline\n      !runner._timeline || !runner._timeline._runnerIds.includes(runner.id)) && (!lastRunner._timeline || !lastRunner._timeline._runnerIds.includes(lastRunner.id));\n      if (condition) {\n        // the +1 happens in the function\n        this.remove(runner.id);\n        const newRunner = runner.mergeWith(lastRunner);\n        this.edit(lastRunner.id, newRunner);\n        lastRunner = newRunner;\n        --i;\n      } else {\n        lastRunner = runner;\n      }\n    }\n    return this;\n  }\n  remove(id) {\n    const index = this.ids.indexOf(id + 1);\n    this.ids.splice(index, 1);\n    this.runners.splice(index, 1);\n    return this;\n  }\n}\nregisterMethods({\n  Element: {\n    animate(duration, delay, when) {\n      const o = Runner.sanitise(duration, delay, when);\n      const timeline = this.timeline();\n      return new Runner(o.duration).loop(o).element(this).timeline(timeline.play()).schedule(o.delay, o.when);\n    },\n    delay(by, when) {\n      return this.animate(0, by, when);\n    },\n    // this function searches for all runners on the element and deletes the ones\n    // which run before the current one. This is because absolute transformations\n    // overwrite anything anyway so there is no need to waste time computing\n    // other runners\n    _clearTransformRunnersBefore(currentRunner) {\n      this._transformationRunners.clearBefore(currentRunner.id);\n    },\n    _currentTransform(current) {\n      return this._transformationRunners.runners\n      // we need the equal sign here to make sure, that also transformations\n      // on the same runner which execute before the current transformation are\n      // taken into account\n      .filter(runner => runner.id <= current.id).map(getRunnerTransform).reduce(lmultiply, new Matrix());\n    },\n    _addRunner(runner) {\n      this._transformationRunners.add(runner);\n\n      // Make sure that the runner merge is executed at the very end of\n      // all Animator functions. That is why we use immediate here to execute\n      // the merge right after all frames are run\n      Animator.cancelImmediate(this._frameId);\n      this._frameId = Animator.immediate(mergeTransforms.bind(this));\n    },\n    _prepareRunner() {\n      if (this._frameId == null) {\n        this._transformationRunners = new RunnerArray().add(new FakeRunner(new Matrix(this)));\n      }\n    }\n  }\n});\n\n// Will output the elements from array A that are not in the array B\nconst difference = (a, b) => a.filter(x => !b.includes(x));\nextend(Runner, {\n  attr(a, v) {\n    return this.styleAttr('attr', a, v);\n  },\n  // Add animatable styles\n  css(s, v) {\n    return this.styleAttr('css', s, v);\n  },\n  styleAttr(type, nameOrAttrs, val) {\n    if (typeof nameOrAttrs === 'string') {\n      return this.styleAttr(type, {\n        [nameOrAttrs]: val\n      });\n    }\n    let attrs = nameOrAttrs;\n    if (this._tryRetarget(type, attrs)) return this;\n    let morpher = new Morphable(this._stepper).to(attrs);\n    let keys = Object.keys(attrs);\n    this.queue(function () {\n      morpher = morpher.from(this.element()[type](keys));\n    }, function (pos) {\n      this.element()[type](morpher.at(pos).valueOf());\n      return morpher.done();\n    }, function (newToAttrs) {\n      // Check if any new keys were added\n      const newKeys = Object.keys(newToAttrs);\n      const differences = difference(newKeys, keys);\n\n      // If their are new keys, initialize them and add them to morpher\n      if (differences.length) {\n        // Get the values\n        const addedFromAttrs = this.element()[type](differences);\n\n        // Get the already initialized values\n        const oldFromAttrs = new ObjectBag(morpher.from()).valueOf();\n\n        // Merge old and new\n        Object.assign(oldFromAttrs, addedFromAttrs);\n        morpher.from(oldFromAttrs);\n      }\n\n      // Get the object from the morpher\n      const oldToAttrs = new ObjectBag(morpher.to()).valueOf();\n\n      // Merge in new attributes\n      Object.assign(oldToAttrs, newToAttrs);\n\n      // Change morpher target\n      morpher.to(oldToAttrs);\n\n      // Make sure that we save the work we did so we don't need it to do again\n      keys = newKeys;\n      attrs = newToAttrs;\n    });\n    this._rememberMorpher(type, morpher);\n    return this;\n  },\n  zoom(level, point) {\n    if (this._tryRetarget('zoom', level, point)) return this;\n    let morpher = new Morphable(this._stepper).to(new SVGNumber(level));\n    this.queue(function () {\n      morpher = morpher.from(this.element().zoom());\n    }, function (pos) {\n      this.element().zoom(morpher.at(pos), point);\n      return morpher.done();\n    }, function (newLevel, newPoint) {\n      point = newPoint;\n      morpher.to(newLevel);\n    });\n    this._rememberMorpher('zoom', morpher);\n    return this;\n  },\n  /**\n   ** absolute transformations\n   **/\n\n  //\n  // M v -----|-----(D M v = F v)------|----->  T v\n  //\n  // 1. define the final state (T) and decompose it (once)\n  //    t = [tx, ty, the, lam, sy, sx]\n  // 2. on every frame: pull the current state of all previous transforms\n  //    (M - m can change)\n  //   and then write this as m = [tx0, ty0, the0, lam0, sy0, sx0]\n  // 3. Find the interpolated matrix F(pos) = m + pos * (t - m)\n  //   - Note F(0) = M\n  //   - Note F(1) = T\n  // 4. Now you get the delta matrix as a result: D = F * inv(M)\n\n  transform(transforms, relative, affine) {\n    // If we have a declarative function, we should retarget it if possible\n    relative = transforms.relative || relative;\n    if (this._isDeclarative && !relative && this._tryRetarget('transform', transforms)) {\n      return this;\n    }\n\n    // Parse the parameters\n    const isMatrix = Matrix.isMatrixLike(transforms);\n    affine = transforms.affine != null ? transforms.affine : affine != null ? affine : !isMatrix;\n\n    // Create a morpher and set its type\n    const morpher = new Morphable(this._stepper).type(affine ? TransformBag : Matrix);\n    let origin;\n    let element;\n    let current;\n    let currentAngle;\n    let startTransform;\n    function setup() {\n      // make sure element and origin is defined\n      element = element || this.element();\n      origin = origin || getOrigin(transforms, element);\n      startTransform = new Matrix(relative ? undefined : element);\n\n      // add the runner to the element so it can merge transformations\n      element._addRunner(this);\n\n      // Deactivate all transforms that have run so far if we are absolute\n      if (!relative) {\n        element._clearTransformRunnersBefore(this);\n      }\n    }\n    function run(pos) {\n      // clear all other transforms before this in case something is saved\n      // on this runner. We are absolute. We dont need these!\n      if (!relative) this.clearTransform();\n      const {\n        x,\n        y\n      } = new Point(origin).transform(element._currentTransform(this));\n      let target = new Matrix({\n        ...transforms,\n        origin: [x, y]\n      });\n      let start = this._isDeclarative && current ? current : startTransform;\n      if (affine) {\n        target = target.decompose(x, y);\n        start = start.decompose(x, y);\n\n        // Get the current and target angle as it was set\n        const rTarget = target.rotate;\n        const rCurrent = start.rotate;\n\n        // Figure out the shortest path to rotate directly\n        const possibilities = [rTarget - 360, rTarget, rTarget + 360];\n        const distances = possibilities.map(a => Math.abs(a - rCurrent));\n        const shortest = Math.min(...distances);\n        const index = distances.indexOf(shortest);\n        target.rotate = possibilities[index];\n      }\n      if (relative) {\n        // we have to be careful here not to overwrite the rotation\n        // with the rotate method of Matrix\n        if (!isMatrix) {\n          target.rotate = transforms.rotate || 0;\n        }\n        if (this._isDeclarative && currentAngle) {\n          start.rotate = currentAngle;\n        }\n      }\n      morpher.from(start);\n      morpher.to(target);\n      const affineParameters = morpher.at(pos);\n      currentAngle = affineParameters.rotate;\n      current = new Matrix(affineParameters);\n      this.addTransform(current);\n      element._addRunner(this);\n      return morpher.done();\n    }\n    function retarget(newTransforms) {\n      // only get a new origin if it changed since the last call\n      if ((newTransforms.origin || 'center').toString() !== (transforms.origin || 'center').toString()) {\n        origin = getOrigin(newTransforms, element);\n      }\n\n      // overwrite the old transformations with the new ones\n      transforms = {\n        ...newTransforms,\n        origin\n      };\n    }\n    this.queue(setup, run, retarget, true);\n    this._isDeclarative && this._rememberMorpher('transform', morpher);\n    return this;\n  },\n  // Animatable x-axis\n  x(x) {\n    return this._queueNumber('x', x);\n  },\n  // Animatable y-axis\n  y(y) {\n    return this._queueNumber('y', y);\n  },\n  ax(x) {\n    return this._queueNumber('ax', x);\n  },\n  ay(y) {\n    return this._queueNumber('ay', y);\n  },\n  dx(x = 0) {\n    return this._queueNumberDelta('x', x);\n  },\n  dy(y = 0) {\n    return this._queueNumberDelta('y', y);\n  },\n  dmove(x, y) {\n    return this.dx(x).dy(y);\n  },\n  _queueNumberDelta(method, to) {\n    to = new SVGNumber(to);\n\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    let from = null;\n    this.queue(function () {\n      from = this.element()[method]();\n      morpher.from(from);\n      morpher.to(from + to);\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    }, function (newTo) {\n      morpher.to(from + new SVGNumber(newTo));\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueObject(method, to) {\n    // Try to change the target if we have this method already registered\n    if (this._tryRetarget(method, to)) return this;\n\n    // Make a morpher and queue the animation\n    const morpher = new Morphable(this._stepper).to(to);\n    this.queue(function () {\n      morpher.from(this.element()[method]());\n    }, function (pos) {\n      this.element()[method](morpher.at(pos));\n      return morpher.done();\n    });\n\n    // Register the morpher so that if it is changed again, we can retarget it\n    this._rememberMorpher(method, morpher);\n    return this;\n  },\n  _queueNumber(method, value) {\n    return this._queueObject(method, new SVGNumber(value));\n  },\n  // Animatable center x-axis\n  cx(x) {\n    return this._queueNumber('cx', x);\n  },\n  // Animatable center y-axis\n  cy(y) {\n    return this._queueNumber('cy', y);\n  },\n  // Add animatable move\n  move(x, y) {\n    return this.x(x).y(y);\n  },\n  amove(x, y) {\n    return this.ax(x).ay(y);\n  },\n  // Add animatable center\n  center(x, y) {\n    return this.cx(x).cy(y);\n  },\n  // Add animatable size\n  size(width, height) {\n    // animate bbox based size for all other elements\n    let box;\n    if (!width || !height) {\n      box = this._element.bbox();\n    }\n    if (!width) {\n      width = box.width / box.height * height;\n    }\n    if (!height) {\n      height = box.height / box.width * width;\n    }\n    return this.width(width).height(height);\n  },\n  // Add animatable width\n  width(width) {\n    return this._queueNumber('width', width);\n  },\n  // Add animatable height\n  height(height) {\n    return this._queueNumber('height', height);\n  },\n  // Add animatable plot\n  plot(a, b, c, d) {\n    // Lines can be plotted with 4 arguments\n    if (arguments.length === 4) {\n      return this.plot([a, b, c, d]);\n    }\n    if (this._tryRetarget('plot', a)) return this;\n    const morpher = new Morphable(this._stepper).type(this._element.MorphArray).to(a);\n    this.queue(function () {\n      morpher.from(this._element.array());\n    }, function (pos) {\n      this._element.plot(morpher.at(pos));\n      return morpher.done();\n    });\n    this._rememberMorpher('plot', morpher);\n    return this;\n  },\n  // Add leading method\n  leading(value) {\n    return this._queueNumber('leading', value);\n  },\n  // Add animatable viewbox\n  viewbox(x, y, width, height) {\n    return this._queueObject('viewbox', new Box(x, y, width, height));\n  },\n  update(o) {\n    if (typeof o !== 'object') {\n      return this.update({\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      });\n    }\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', o.offset);\n    return this;\n  }\n});\nextend(Runner, {\n  rx,\n  ry,\n  from,\n  to\n});\nregister(Runner, 'Runner');\n\nclass Svg extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('svg', node), attrs);\n    this.namespace();\n  }\n\n  // Creates and returns defs element\n  defs() {\n    if (!this.isRoot()) return this.root().defs();\n    return adopt(this.node.querySelector('defs')) || this.put(new Defs());\n  }\n  isRoot() {\n    return !this.node.parentNode || !(this.node.parentNode instanceof globals.window.SVGElement) && this.node.parentNode.nodeName !== '#document-fragment';\n  }\n\n  // Add namespaces\n  namespace() {\n    if (!this.isRoot()) return this.root().namespace();\n    return this.attr({\n      xmlns: svg,\n      version: '1.1'\n    }).attr('xmlns:xlink', xlink, xmlns);\n  }\n  removeNamespace() {\n    return this.attr({\n      xmlns: null,\n      version: null\n    }).attr('xmlns:xlink', null, xmlns).attr('xmlns:svgjs', null, xmlns);\n  }\n\n  // Check if this is a root svg\n  // If not, call root() from this element\n  root() {\n    if (this.isRoot()) return this;\n    return super.root();\n  }\n}\nregisterMethods({\n  Container: {\n    // Create nested svg document\n    nested: wrapWithAttrCheck(function () {\n      return this.put(new Svg());\n    })\n  }\n});\nregister(Svg, 'Svg', true);\n\nclass Symbol extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('symbol', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    symbol: wrapWithAttrCheck(function () {\n      return this.put(new Symbol());\n    })\n  }\n});\nregister(Symbol, 'Symbol');\n\n// Create plain text node\nfunction plain(text) {\n  // clear if build mode is disabled\n  if (this._build === false) {\n    this.clear();\n  }\n\n  // create text node\n  this.node.appendChild(globals.document.createTextNode(text));\n  return this;\n}\n\n// Get length of text element\nfunction length() {\n  return this.node.getComputedTextLength();\n}\n\n// Move over x-axis\n// Text is moved by its bounding box\n// text-anchor does NOT matter\nfunction x$1(x, box = this.bbox()) {\n  if (x == null) {\n    return box.x;\n  }\n  return this.attr('x', this.attr('x') + x - box.x);\n}\n\n// Move over y-axis\nfunction y$1(y, box = this.bbox()) {\n  if (y == null) {\n    return box.y;\n  }\n  return this.attr('y', this.attr('y') + y - box.y);\n}\nfunction move$1(x, y, box = this.bbox()) {\n  return this.x(x, box).y(y, box);\n}\n\n// Move center over x-axis\nfunction cx(x, box = this.bbox()) {\n  if (x == null) {\n    return box.cx;\n  }\n  return this.attr('x', this.attr('x') + x - box.cx);\n}\n\n// Move center over y-axis\nfunction cy(y, box = this.bbox()) {\n  if (y == null) {\n    return box.cy;\n  }\n  return this.attr('y', this.attr('y') + y - box.cy);\n}\nfunction center(x, y, box = this.bbox()) {\n  return this.cx(x, box).cy(y, box);\n}\nfunction ax(x) {\n  return this.attr('x', x);\n}\nfunction ay(y) {\n  return this.attr('y', y);\n}\nfunction amove(x, y) {\n  return this.ax(x).ay(y);\n}\n\n// Enable / disable build mode\nfunction build(build) {\n  this._build = !!build;\n  return this;\n}\n\nvar textable = {\n  __proto__: null,\n  amove: amove,\n  ax: ax,\n  ay: ay,\n  build: build,\n  center: center,\n  cx: cx,\n  cy: cy,\n  length: length,\n  move: move$1,\n  plain: plain,\n  x: x$1,\n  y: y$1\n};\n\nclass Text extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('text', node), attrs);\n    this.dom.leading = this.dom.leading ?? new SVGNumber(1.3); // store leading value for rebuilding\n    this._rebuild = true; // enable automatic updating of dy values\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Set / get leading\n  leading(value) {\n    // act as getter\n    if (value == null) {\n      return this.dom.leading;\n    }\n\n    // act as setter\n    this.dom.leading = new SVGNumber(value);\n    return this.rebuild();\n  }\n\n  // Rebuild appearance type\n  rebuild(rebuild) {\n    // store new rebuild flag if given\n    if (typeof rebuild === 'boolean') {\n      this._rebuild = rebuild;\n    }\n\n    // define position of all lines\n    if (this._rebuild) {\n      const self = this;\n      let blankLineOffset = 0;\n      const leading = this.dom.leading;\n      this.each(function (i) {\n        if (isDescriptive(this.node)) return;\n        const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n        const dy = leading * new SVGNumber(fontSize);\n        if (this.dom.newLined) {\n          this.attr('x', self.attr('x'));\n          if (this.text() === '\\n') {\n            blankLineOffset += dy;\n          } else {\n            this.attr('dy', i ? dy + blankLineOffset : 0);\n            blankLineOffset = 0;\n          }\n        }\n      });\n      this.fire('rebuild');\n    }\n    return this;\n  }\n\n  // overwrite method from parent to set data properly\n  setData(o) {\n    this.dom = o;\n    this.dom.leading = new SVGNumber(o.leading || 1.3);\n    return this;\n  }\n  writeDataToDom() {\n    writeDataToDom(this, this.dom, {\n      leading: 1.3\n    });\n    return this;\n  }\n\n  // Set the text content\n  text(text) {\n    // act as getter\n    if (text === undefined) {\n      const children = this.node.childNodes;\n      let firstLine = 0;\n      text = '';\n      for (let i = 0, len = children.length; i < len; ++i) {\n        // skip textPaths - they are no lines\n        if (children[i].nodeName === 'textPath' || isDescriptive(children[i])) {\n          if (i === 0) firstLine = i + 1;\n          continue;\n        }\n\n        // add newline if its not the first child and newLined is set to true\n        if (i !== firstLine && children[i].nodeType !== 3 && adopt(children[i]).dom.newLined === true) {\n          text += '\\n';\n        }\n\n        // add content of this node\n        text += children[i].textContent;\n      }\n      return text;\n    }\n\n    // remove existing content\n    this.clear().build(true);\n    if (typeof text === 'function') {\n      // call block\n      text.call(this, this);\n    } else {\n      // store text and make sure text is not blank\n      text = (text + '').split('\\n');\n\n      // build new lines\n      for (let j = 0, jl = text.length; j < jl; j++) {\n        this.newLine(text[j]);\n      }\n    }\n\n    // disable build mode and rebuild lines\n    return this.build(false).rebuild();\n  }\n}\nextend(Text, textable);\nregisterMethods({\n  Container: {\n    // Create text element\n    text: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).text(text);\n    }),\n    // Create plain text element\n    plain: wrapWithAttrCheck(function (text = '') {\n      return this.put(new Text()).plain(text);\n    })\n  }\n});\nregister(Text, 'Text');\n\nclass Tspan extends Shape {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('tspan', node), attrs);\n    this._build = false; // disable build mode for adding multiple lines\n  }\n\n  // Shortcut dx\n  dx(dx) {\n    return this.attr('dx', dx);\n  }\n\n  // Shortcut dy\n  dy(dy) {\n    return this.attr('dy', dy);\n  }\n\n  // Create new line\n  newLine() {\n    // mark new line\n    this.dom.newLined = true;\n\n    // fetch parent\n    const text = this.parent();\n\n    // early return in case we are not in a text element\n    if (!(text instanceof Text)) {\n      return this;\n    }\n    const i = text.index(this);\n    const fontSize = globals.window.getComputedStyle(this.node).getPropertyValue('font-size');\n    const dy = text.dom.leading * new SVGNumber(fontSize);\n\n    // apply new position\n    return this.dy(i ? dy : 0).attr('x', text.x());\n  }\n\n  // Set text content\n  text(text) {\n    if (text == null) return this.node.textContent + (this.dom.newLined ? '\\n' : '');\n    if (typeof text === 'function') {\n      this.clear().build(true);\n      text.call(this, this);\n      this.build(false);\n    } else {\n      this.plain(text);\n    }\n    return this;\n  }\n}\nextend(Tspan, textable);\nregisterMethods({\n  Tspan: {\n    tspan: wrapWithAttrCheck(function (text = '') {\n      const tspan = new Tspan();\n\n      // clear if build mode is disabled\n      if (!this._build) {\n        this.clear();\n      }\n\n      // add new tspan\n      return this.put(tspan).text(text);\n    })\n  },\n  Text: {\n    newLine: function (text = '') {\n      return this.tspan(text).newLine();\n    }\n  }\n});\nregister(Tspan, 'Tspan');\n\nclass Circle extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('circle', node), attrs);\n  }\n  radius(r) {\n    return this.attr('r', r);\n  }\n\n  // Radius x value\n  rx(rx) {\n    return this.attr('r', rx);\n  }\n\n  // Alias radius x value\n  ry(ry) {\n    return this.rx(ry);\n  }\n  size(size) {\n    return this.radius(new SVGNumber(size).divide(2));\n  }\n}\nextend(Circle, {\n  x: x$3,\n  y: y$3,\n  cx: cx$1,\n  cy: cy$1,\n  width: width$2,\n  height: height$2\n});\nregisterMethods({\n  Container: {\n    // Create circle element\n    circle: wrapWithAttrCheck(function (size = 0) {\n      return this.put(new Circle()).size(size).move(0, 0);\n    })\n  }\n});\nregister(Circle, 'Circle');\n\nclass ClipPath extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('clipPath', node), attrs);\n  }\n\n  // Unclip all clipped elements and remove itself\n  remove() {\n    // unclip all targets\n    this.targets().forEach(function (el) {\n      el.unclip();\n    });\n\n    // remove clipPath from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [clip-path*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    // Create clipping element\n    clip: wrapWithAttrCheck(function () {\n      return this.defs().put(new ClipPath());\n    })\n  },\n  Element: {\n    // Distribute clipPath to svg element\n    clipper() {\n      return this.reference('clip-path');\n    },\n    clipWith(element) {\n      // use given clip or create a new one\n      const clipper = element instanceof ClipPath ? element : this.parent().clip().add(element);\n\n      // apply mask\n      return this.attr('clip-path', 'url(#' + clipper.id() + ')');\n    },\n    // Unclip element\n    unclip() {\n      return this.attr('clip-path', null);\n    }\n  }\n});\nregister(ClipPath, 'ClipPath');\n\nclass ForeignObject extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('foreignObject', node), attrs);\n  }\n}\nregisterMethods({\n  Container: {\n    foreignObject: wrapWithAttrCheck(function (width, height) {\n      return this.put(new ForeignObject()).size(width, height);\n    })\n  }\n});\nregister(ForeignObject, 'ForeignObject');\n\nfunction dmove(dx, dy) {\n  this.children().forEach(child => {\n    let bbox;\n\n    // We have to wrap this for elements that dont have a bbox\n    // e.g. title and other descriptive elements\n    try {\n      // Get the childs bbox\n      // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1905039\n      // Because bbox for nested svgs returns the contents bbox in the coordinate space of the svg itself (weird!), we cant use bbox for svgs\n      // Therefore we have to use getBoundingClientRect. But THAT is broken (as explained in the bug).\n      // Funnily enough the broken behavior would work for us but that breaks it in chrome\n      // So we have to replicate the broken behavior of FF by just reading the attributes of the svg itself\n      bbox = child.node instanceof getWindow().SVGSVGElement ? new Box(child.attr(['x', 'y', 'width', 'height'])) : child.bbox();\n    } catch (e) {\n      return;\n    }\n\n    // Get childs matrix\n    const m = new Matrix(child);\n    // Translate childs matrix by amount and\n    // transform it back into parents space\n    const matrix = m.translate(dx, dy).transform(m.inverse());\n    // Calculate new x and y from old box\n    const p = new Point(bbox.x, bbox.y).transform(matrix);\n    // Move element\n    child.move(p.x, p.y);\n  });\n  return this;\n}\nfunction dx(dx) {\n  return this.dmove(dx, 0);\n}\nfunction dy(dy) {\n  return this.dmove(0, dy);\n}\nfunction height(height, box = this.bbox()) {\n  if (height == null) return box.height;\n  return this.size(box.width, height, box);\n}\nfunction move(x = 0, y = 0, box = this.bbox()) {\n  const dx = x - box.x;\n  const dy = y - box.y;\n  return this.dmove(dx, dy);\n}\nfunction size(width, height, box = this.bbox()) {\n  const p = proportionalSize(this, width, height, box);\n  const scaleX = p.width / box.width;\n  const scaleY = p.height / box.height;\n  this.children().forEach(child => {\n    const o = new Point(box).transform(new Matrix(child).inverse());\n    child.scale(scaleX, scaleY, o.x, o.y);\n  });\n  return this;\n}\nfunction width(width, box = this.bbox()) {\n  if (width == null) return box.width;\n  return this.size(width, box.height, box);\n}\nfunction x(x, box = this.bbox()) {\n  if (x == null) return box.x;\n  return this.move(x, box.y, box);\n}\nfunction y(y, box = this.bbox()) {\n  if (y == null) return box.y;\n  return this.move(box.x, y, box);\n}\n\nvar containerGeometry = {\n  __proto__: null,\n  dmove: dmove,\n  dx: dx,\n  dy: dy,\n  height: height,\n  move: move,\n  size: size,\n  width: width,\n  x: x,\n  y: y\n};\n\nclass G extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('g', node), attrs);\n  }\n}\nextend(G, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a group element\n    group: wrapWithAttrCheck(function () {\n      return this.put(new G());\n    })\n  }\n});\nregister(G, 'G');\n\nclass A extends Container {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('a', node), attrs);\n  }\n\n  // Link target attribute\n  target(target) {\n    return this.attr('target', target);\n  }\n\n  // Link url\n  to(url) {\n    return this.attr('href', url, xlink);\n  }\n}\nextend(A, containerGeometry);\nregisterMethods({\n  Container: {\n    // Create a hyperlink element\n    link: wrapWithAttrCheck(function (url) {\n      return this.put(new A()).to(url);\n    })\n  },\n  Element: {\n    unlink() {\n      const link = this.linker();\n      if (!link) return this;\n      const parent = link.parent();\n      if (!parent) {\n        return this.remove();\n      }\n      const index = parent.index(link);\n      parent.add(this, index);\n      link.remove();\n      return this;\n    },\n    linkTo(url) {\n      // reuse old link if possible\n      let link = this.linker();\n      if (!link) {\n        link = new A();\n        this.wrap(link);\n      }\n      if (typeof url === 'function') {\n        url.call(link, link);\n      } else {\n        link.to(url);\n      }\n      return this;\n    },\n    linker() {\n      const link = this.parent();\n      if (link && link.node.nodeName.toLowerCase() === 'a') {\n        return link;\n      }\n      return null;\n    }\n  }\n});\nregister(A, 'A');\n\nclass Mask extends Container {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('mask', node), attrs);\n  }\n\n  // Unmask all masked elements and remove itself\n  remove() {\n    // unmask all targets\n    this.targets().forEach(function (el) {\n      el.unmask();\n    });\n\n    // remove mask from parent\n    return super.remove();\n  }\n  targets() {\n    return baseFind('svg [mask*=' + this.id() + ']');\n  }\n}\nregisterMethods({\n  Container: {\n    mask: wrapWithAttrCheck(function () {\n      return this.defs().put(new Mask());\n    })\n  },\n  Element: {\n    // Distribute mask to svg element\n    masker() {\n      return this.reference('mask');\n    },\n    maskWith(element) {\n      // use given mask or create a new one\n      const masker = element instanceof Mask ? element : this.parent().mask().add(element);\n\n      // apply mask\n      return this.attr('mask', 'url(#' + masker.id() + ')');\n    },\n    // Unmask element\n    unmask() {\n      return this.attr('mask', null);\n    }\n  }\n});\nregister(Mask, 'Mask');\n\nclass Stop extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('stop', node), attrs);\n  }\n\n  // add color stops\n  update(o) {\n    if (typeof o === 'number' || o instanceof SVGNumber) {\n      o = {\n        offset: arguments[0],\n        color: arguments[1],\n        opacity: arguments[2]\n      };\n    }\n\n    // set attributes\n    if (o.opacity != null) this.attr('stop-opacity', o.opacity);\n    if (o.color != null) this.attr('stop-color', o.color);\n    if (o.offset != null) this.attr('offset', new SVGNumber(o.offset));\n    return this;\n  }\n}\nregisterMethods({\n  Gradient: {\n    // Add a color stop\n    stop: function (offset, color, opacity) {\n      return this.put(new Stop()).update(offset, color, opacity);\n    }\n  }\n});\nregister(Stop, 'Stop');\n\nfunction cssRule(selector, rule) {\n  if (!selector) return '';\n  if (!rule) return selector;\n  let ret = selector + '{';\n  for (const i in rule) {\n    ret += unCamelCase(i) + ':' + rule[i] + ';';\n  }\n  ret += '}';\n  return ret;\n}\nclass Style extends Element {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('style', node), attrs);\n  }\n  addText(w = '') {\n    this.node.textContent += w;\n    return this;\n  }\n  font(name, src, params = {}) {\n    return this.rule('@font-face', {\n      fontFamily: name,\n      src: src,\n      ...params\n    });\n  }\n  rule(selector, obj) {\n    return this.addText(cssRule(selector, obj));\n  }\n}\nregisterMethods('Dom', {\n  style(selector, obj) {\n    return this.put(new Style()).rule(selector, obj);\n  },\n  fontface(name, src, params) {\n    return this.put(new Style()).font(name, src, params);\n  }\n});\nregister(Style, 'Style');\n\nclass TextPath extends Text {\n  // Initialize node\n  constructor(node, attrs = node) {\n    super(nodeOrNew('textPath', node), attrs);\n  }\n\n  // return the array of the path track element\n  array() {\n    const track = this.track();\n    return track ? track.array() : null;\n  }\n\n  // Plot path if any\n  plot(d) {\n    const track = this.track();\n    let pathArray = null;\n    if (track) {\n      pathArray = track.plot(d);\n    }\n    return d == null ? pathArray : this;\n  }\n\n  // Get the path element\n  track() {\n    return this.reference('href');\n  }\n}\nregisterMethods({\n  Container: {\n    textPath: wrapWithAttrCheck(function (text, path) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = this.text(text);\n      }\n      return text.path(path);\n    })\n  },\n  Text: {\n    // Create path for text to run on\n    path: wrapWithAttrCheck(function (track, importNodes = true) {\n      const textPath = new TextPath();\n\n      // if track is a path, reuse it\n      if (!(track instanceof Path)) {\n        // create path element\n        track = this.defs().path(track);\n      }\n\n      // link textPath to path and add content\n      textPath.attr('href', '#' + track, xlink);\n\n      // Transplant all nodes from text to textPath\n      let node;\n      if (importNodes) {\n        while (node = this.node.firstChild) {\n          textPath.node.appendChild(node);\n        }\n      }\n\n      // add textPath element as child node and return textPath\n      return this.put(textPath);\n    }),\n    // Get the textPath children\n    textPath() {\n      return this.findOne('textPath');\n    }\n  },\n  Path: {\n    // creates a textPath from this path\n    text: wrapWithAttrCheck(function (text) {\n      // Convert text to instance if needed\n      if (!(text instanceof Text)) {\n        text = new Text().addTo(this.parent()).text(text);\n      }\n\n      // Create textPath from text and path and return\n      return text.path(this);\n    }),\n    targets() {\n      return baseFind('svg textPath').filter(node => {\n        return (node.attr('href') || '').includes(this.id());\n      });\n\n      // Does not work in IE11. Use when IE support is dropped\n      // return baseFind('svg textPath[*|href*=' + this.id() + ']')\n    }\n  }\n});\nTextPath.prototype.MorphArray = PathArray;\nregister(TextPath, 'TextPath');\n\nclass Use extends Shape {\n  constructor(node, attrs = node) {\n    super(nodeOrNew('use', node), attrs);\n  }\n\n  // Use element as a reference\n  use(element, file) {\n    // Set lined element\n    return this.attr('href', (file || '') + '#' + element, xlink);\n  }\n}\nregisterMethods({\n  Container: {\n    // Create a use element\n    use: wrapWithAttrCheck(function (element, file) {\n      return this.put(new Use()).use(element, file);\n    })\n  }\n});\nregister(Use, 'Use');\n\n/* Optional Modules */\nconst SVG = makeInstance;\nextend([Svg, Symbol, Image, Pattern, Marker], getMethodsFor('viewbox'));\nextend([Line, Polyline, Polygon, Path], getMethodsFor('marker'));\nextend(Text, getMethodsFor('Text'));\nextend(Path, getMethodsFor('Path'));\nextend(Defs, getMethodsFor('Defs'));\nextend([Text, Tspan], getMethodsFor('Tspan'));\nextend([Rect, Ellipse, Gradient, Runner], getMethodsFor('radius'));\nextend(EventTarget, getMethodsFor('EventTarget'));\nextend(Dom, getMethodsFor('Dom'));\nextend(Element, getMethodsFor('Element'));\nextend(Shape, getMethodsFor('Shape'));\nextend([Container, Fragment], getMethodsFor('Container'));\nextend(Gradient, getMethodsFor('Gradient'));\nextend(Runner, getMethodsFor('Runner'));\nList.extend(getMethodNames());\nregisterMorphableType([SVGNumber, Color, Box, Matrix, SVGArray, PointArray, PathArray, Point]);\nmakeMorphable();\n\nexports.A = A;\nexports.Animator = Animator;\nexports.Array = SVGArray;\nexports.Box = Box;\nexports.Circle = Circle;\nexports.ClipPath = ClipPath;\nexports.Color = Color;\nexports.Container = Container;\nexports.Controller = Controller;\nexports.Defs = Defs;\nexports.Dom = Dom;\nexports.Ease = Ease;\nexports.Element = Element;\nexports.Ellipse = Ellipse;\nexports.EventTarget = EventTarget;\nexports.ForeignObject = ForeignObject;\nexports.Fragment = Fragment;\nexports.G = G;\nexports.Gradient = Gradient;\nexports.Image = Image;\nexports.Line = Line;\nexports.List = List;\nexports.Marker = Marker;\nexports.Mask = Mask;\nexports.Matrix = Matrix;\nexports.Morphable = Morphable;\nexports.NonMorphable = NonMorphable;\nexports.Number = SVGNumber;\nexports.ObjectBag = ObjectBag;\nexports.PID = PID;\nexports.Path = Path;\nexports.PathArray = PathArray;\nexports.Pattern = Pattern;\nexports.Point = Point;\nexports.PointArray = PointArray;\nexports.Polygon = Polygon;\nexports.Polyline = Polyline;\nexports.Queue = Queue;\nexports.Rect = Rect;\nexports.Runner = Runner;\nexports.SVG = SVG;\nexports.Shape = Shape;\nexports.Spring = Spring;\nexports.Stop = Stop;\nexports.Style = Style;\nexports.Svg = Svg;\nexports.Symbol = Symbol;\nexports.Text = Text;\nexports.TextPath = TextPath;\nexports.Timeline = Timeline;\nexports.TransformBag = TransformBag;\nexports.Tspan = Tspan;\nexports.Use = Use;\nexports.adopt = adopt;\nexports.assignNewId = assignNewId;\nexports.clearEvents = clearEvents;\nexports.create = create;\nexports.defaults = defaults;\nexports.dispatch = dispatch;\nexports.easing = easing;\nexports.eid = eid;\nexports.extend = extend;\nexports.find = baseFind;\nexports.getClass = getClass;\nexports.getEventTarget = getEventTarget;\nexports.getEvents = getEvents;\nexports.getWindow = getWindow;\nexports.makeInstance = makeInstance;\nexports.makeMorphable = makeMorphable;\nexports.mockAdopt = mockAdopt;\nexports.namespaces = namespaces;\nexports.nodeOrNew = nodeOrNew;\nexports.off = off;\nexports.on = on;\nexports.parser = parser;\nexports.regex = regex;\nexports.register = register;\nexports.registerMorphableType = registerMorphableType;\nexports.registerWindow = registerWindow;\nexports.restoreWindow = restoreWindow;\nexports.root = root;\nexports.saveWindow = saveWindow;\nexports.utils = utils;\nexports.windowEvents = windowEvents;\nexports.withWindow = withWindow;\nexports.wrapWithAttrCheck = wrapWithAttrCheck;\n//# sourceMappingURL=svg.node.cjs.map\n","import './draggable';\r\nimport './input-box';\r\nimport './node-x-btn';\r\nimport './connector';\r\nimport './comment-drag-handle';\r\nimport './comment-input';\r\nimport './connection-line';","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(8156);\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","moduleId","cachedModule","__webpack_module_cache__","undefined","__webpack_modules__","call","obj","name","Object","prototype","hasOwnProperty","UserState","state","callbacks","constructor","Set","Map","setState","has","add","triggerCallbacks","removeState","delete","hasState","onStateChange","cb","set","get","push","addedOrRemoved","cbs","userState","container","visible","toolbox","document","createElement","className","workspace","_wsTop","appendChild","body","fill","nodes","innerHTML","forEach","node","_headlessNode","type","nodeEl","textContent","labelText","style","backgroundColor","parseColor","colors","primary","padding","cursor","fontFamily","renderer","constants","FONT_FAMILY","fontSize","FONT_SIZE","color","FONT_COLOR","addEventListener","e","ghostEl","position","pointerEvents","moveGhost","ev","left","clientX","top","clientY","releaseGhost","removeEventListener","rect","svg","getBoundingClientRect","right","bottom","svgX","svgY","x","wsX","y","wsY","screenToWorkspace","spawnAt","remove","preventDefault","show","display","hide","clear","register","cls","FieldMap","unregister","Kabel","UIX","events","ContextMenu","Utils","Path","waitFrames","SVG","UID","EventEmitter","hasProp","styler","Styler","escapeHTML","unescapeHTML","Widget","CategoryColors","Connection","Coordinates","Field","DummyField","NumberField","OptConnectField","TextField","inject","InjectMsg","clearMainWorkspace","getMainWorkspace","setMainWorkspace","NodeSvg","Nodes","Widgets","WorkspaceSvg","WorkspaceController","WASDController","nodeRendering","rendererMap","RMap","Renderer","RendererConstants","Representer","RepresenterNode","commentRendering","CommentModel","CommentRenderer","Dropdown","defineProperty","v","initCommentInput","element","rawArgs","measureTextWidth","text","length","displayText","encodeForSvg","txt","attr","font","family","size","anchor","opacity","width","bbox","getSelectionRange","start","Math","min","cursorPos","anchorPos","end","max","hasSelection","deleteSelection","buffer","slice","s","replace","updateText","hasSel","tspan","Array","from","childNodes","child","nodeType","setAttribute","leading","parseFloat","textBeforeStart","textBeforeEnd","highlightX","highlightWidth","highlightY","highlightH","height","selectionRect","console","log","parent","parentNode","insertBefore","move","editing","caretXOffset","caretY","caretH","caretLine","rectW","ceil","PADDING_X","rectH","PADDING_Y","comment","_tempInputBBox","textX","textY","startEditing","getText","localX","offsetX","skipNextClick","onKeyDown","capture","onClickOutside","stopEditing","commit","setTextNoRedraw","getWorkspace","redraw","key","shiftKey","ctrlKey","metaKey","targ","target","args","onRectDown","onTextDown","on","off","registerEvent","randBytes","len","cryptoAPI","getRandomValues","buf","Uint8Array","i","floor","random","uuidv4","g","globalThis","crypto","randomUUID","b","hex","toString","padStart","ulid","date","Date","now","time48","t","BigInt","Number","out","acc","bits","CROCK32","rnd","nanoid","alphabet","DEFAULT_ALPHABET","Error","mask","log2","id","idx","shortId","ts","_ctr","map","join","strategy","opts","_text","_isWorkspaceComment","_parent","svgGroup","relativeCoords","svgLine","generateUID","value","setText","res","clearComments","drawComments","isNodeComment","isWorkspaceComment","NAME","COMMENT_G_TAG","COMMENT_LINE_TAG","COMMENT_TEXT_EL","COMMENT_DRAG_EL","RENDERER_TAG_EL","ensureTspansPreserve","drawComment","getSvg","group","addClass","JSON","stringify","isws","displayEncoded","textEl","userSelect","webkitUserSelect","msUserSelect","MozUserSelect","handleRadius","stroke","radius","back","dragHandle","circle","addElement","tagElement","workspaceX","workspaceY","nodePos","screenPos","workspaceToScreen","zoom","getZoom","transform","_drawLineToNode","refreshCommentTransforms","getComments","_nodeDB","values","n","getComment","filter","c","findOne","ws","nodeWSPos","nodeBBox","nodeTopCenter","parentWSPos","commentRelPos","commentAbsX","commentAbsY","commentBBox","commentTopCenter","line","dasharray","clearAllComments","find","el","destroyByTag","_","clearCommentLines","drawAllComments","_constants","_currentNode","_nodeGroup","_nodeDraw","_ws","_drawStates","_commentDrawer","representer","NODE_G_TAG","ELEMENT_TAG","CONN_LINE_TAG","CONNECTOR_TAG","LINE_X_MARK_TAG","overrides","initCommentRenderer","initRepresenter","getWs","enqueueSetConnect","pendingConnections","setConstants","assign","secondary","tertiary","restColors","getNodeBaseMeasurements","NODE_BASE_WIDTH","NODE_BASE_HEIGHT","measureTextHeight","measureRawField","textW","FIELD_RAW_BASE_WIDTH","INPUT_BOX_PADDING","FIELD_RAW_BASE_HEIGHT","measureLabel","field","label","getLabel","measureRaw","hasRaw","raw","getValue","measureCustom","isCustomEditor","m","measureMyself","getFieldMeasurementPadding","FIELD_SPACEX","measureField","parts","w","h","measureNodeDimensions","fieldMeasurements","BASE","totalWidth","totalHeight","labelW","TOPBAR_LABEL_MARGIN_X","TOPBAR_HEIGHT","FIELD_SPACEY","allFields","fldM","FIELD_MARGIN_X","bottomOfField","FIELD_MARGIN_Y","FOOTER_HEIGHT","fields","renderNode","nodeIdOrNode","startNode","drawNode","build","storeState","getNode","drawFieldRaw","fieldGroup","startX","getDisplayValue","FIELD_RAW_COLOR","FIELD_RAW_OUTLINE_COLOR","FIELD_RAW_OUTLINE_STROKE","INPUT_BOX_TEXT_ANCHOR","FIELD_RAW_TEXT_COLOR","rawBox","box","offsetY","drawFieldLabel","LABEL_SPACING","drawNodeXButton","topbar","measurements","btnSize","xGroup","class","weight","translateX","translateY","xButton","drawConnector","nodeGroup","nodeBg","side","CONNECTOR_TRIANGLE","triSize","CONNECTOR_TRI_SIZE","path","roundedTri","rotatePath","tri","CONNECTOR_RADIUS","circlePath","circ","drawNodeLabel","TOPBAR_LABEL_BOLDED","TOPBAR_LABEL_MARGIN_Y","resolveConnectable","connectable","fromConn","isPrevious","nextConnection","connection","previousConnection","_fillOtherNodeConnectorCircle","conn","connPair","to","toCircle","fromCircle","refreshComments","applyZoomToNode","nodeG","refreshNodeTransforms","nodeGroups","refreshConnectionLines","clearLines","drawLinesForAllNodes","createNodeDrawState","fieldPosY","drawState","tertirary","category","CORNER_RADIUS","bg","roundedRect","NODE_BG_COLOR","NODE_OUTLINE_COLOR","dragel","fieldsGroup","fieldCol","fm","alignX","xUsed","drawMyself","measuredWidth","measuredHeight","background","rawData","cBubbleData","hasConnectable","halfHeight","absY","c3","FIELD_CONN_COLOR","getTo","originCircle","originConn","connector","connState","onDraw","cY","c1","getFrom","c2","fillAllNodeConnectorBubbles","match","flatMap","p","wsSvg","drawnCircles","fromEl","toEl","fromBBox","getBBox","toBBox","fromCTM","getScreenCTM","toCTM","startY","endX","endY","absStartX","a","absStartY","d","f","absEndX","absEndY","pathStr","CONNECTOR_LINE_CURVED","dx","abs","sign","strokeWidth","CONNECTOR_LINE_WIDTH","toConn","mark","clearScreen","undoPendingConnsFor","conn0","rerenderNode","findIndex","pendingConn","splice","getRaw","isSpace","ch","SPECIAL_SPACES","indexOf","isDigit","code","isDigitStart","State","index","result","param","err","segmentStart","data","skipSpaces","charCodeAt","scanFlag","scanParam","zeroFirst","hasCeiling","hasDecimal","hasDot","finalizeSegment","cmd","cmdLC","toLowerCase","params","concat","paramCounts","scanSegment","cmdCode","is_arc","comma_found","need_params","isCommand","l","r","q","z","svgPath","segments","coords","options","static","WIDGET_GLOBAL_ID","border","borderRadius","boxShadow","zIndex","html","init","setCoords","setHTML","reanimate","_addWidgetToDB","destroy","_delWidgetFromDB","Ellipse","rx","ry","ax","epsilon","torad","PI","cos","sin","ma","J","K","D","JK","sqrt","L","l1","l2","atan","isDegenerate","WorkspaceCoords","super","_camera","_root","noRedraw","controller","_widgetDB","_ctxMenu","_commentDB","wsTop","addTo","RClass","resolve","rendererOverrides","Controller","controls","wasd","resolveController","cloneNode","nodeSvg","fromNode","wdgt","newWidget","getWidget","getContentSize","getSize","refresh","drawAllNodes","nodeId","workX","workY","screenX","screenY","addNode","warn","newNode","derefNode","prev","disconnectTo","ConnectableField","disconnect","next","disconnectFrom","removeNodeById","removeNode","pan","dy","addComment","model","redrawComments","removeComment","commentOrId","fromJson","json","circular","deserialize","toJson","topLevel","serialize","startsWith","split","parseInt","trim","isArray","halfW","points","step","sides","angle","cx","cy","rotate","Matrix","operations","matrix","scale","translate","skewX","skewY","CMD_SPLIT_RE","PARAMS_SPLIT_RE","transformString","item","moveSpeed","doAccelerate","accelSpeed","friction","velocity","zoomSpeed","minZoom","maxZoom","wasdSmooth","wasdAccelerate","wasdFriction","onWheel","bind","passive","canMove","update","inputX","inputY","keysDown","newZoom","deltaY","mouseX","mouseY","wsMouse","setZoom","handleClick","xMark","pair","includes","midX","midY","center","editable","connectionBubble","canEditConnector","setEditable","val","canEdit","setName","Boolean","getName","setLabel","fieldVisualInfo","setValue","deep","alreadyProcessed","_deserialize","setTo","String","fldType","setFieldType","fld_type","DropdownField","_selected","_isOpen","toggle","toggleDropdown","click","getOwner","closeDropdown","openDropdown","items","option","onSelect","original","hideIfOwner","getSelected","setOptions","RendererMap","RendererCls","optName","list","keys","input","DefaultRenderer","xBtnGroup","onClick","combine","m1","m2","queue","cache","tx","ty","sx","sy","rad","tan","toArray","calc","isRelative","mouseBtns","mousePos","lastMousePos","isDragging","wheelDelta","_updateInt","_setupListeners","setInterval","window","button","refreshPos","setCamera","pos","centerOn","wsSize","cam","stop","clearInterval","styles","appendStyles","css","styleEl","head","removeStyles","updateStyles","hasStyles","kabelStyles","querySelector","contains","msg","error","wrn","info","proto","_fieldColumn","getCommentText","setCommentText","getFieldByName","fld","getField","getFieldValue","getFieldDisplayValue","emit","INITING","removed","REMOVING","hasCategoryStyle","getCategoryName","getStyle","_appendFieldItem","jsonInit","primaryColor","secondaryColor","tertiaryColor","arguments","applyJsonArguments","FieldConstructor","appendConnection","appendNumber","appendText","appendOptLink","setCategoryName","setStyle","setColor","setLabelText","setConnection","prevOrNext","stringed","cast","other","newField","FieldCls","_serializeConnection","returned","connected","fieldNode","serialized","flat","processNode","copy","prevNode","nextNode","allNodes","explicit","fldData","setFrom","refId","maybe","ContextOptsRegistry","registerOption","opt","onHoverStart","onHoverEnd","showFor","unregisterOption","confirm","widget","listeners","event","handler","payload","once","wrapper","wsOptions","_flyout","_contents","_categories","getOptions","contents","overflowY","initCategoryToolbox","initFlyoutToolbox","cData","mainws","draggableStore","onMouseDown","onMouseMove","onMouseUp","ondrag","movementX","movementY","mouseWS","newX","newY","onmove","enddrag","dragTarget","frames","callback","count","requestAnimationFrame","DropdownContainer","owner","rootEl","constraint","offset","updatePosition","setContent","groupRect","scrollX","scrollY","onclick","current","isVisible","getCurrent","dropdownContainer","onPointerDown","rel","pointerWS","startRelX","startRelY","onPointerMove","onPointerUp","Eventer","elements","eventRegistry","setupFn","tags","tagList","reg","tag","destroyed","destroyFn","types","typeList","setupElement","destroyElement","Function","eventer","unit_vector_angle","ux","uy","vx","vy","dot","acos","approximate_unit_arc","theta1","delta_theta","alpha","x1","y1","x2","y2","TAU","fa","fs","phi","sin_phi","cos_phi","x1p","y1p","lambda","cc","rx_sq","ry_sq","x1p_sq","y1p_sq","radicant","cxp","cyp","v1x","v1y","v2x","v2y","get_arc_center","curve","xp","yp","clone","distanceTo","toObject","PADDING_BIG","PADDING_MEDIUM","PADDING_SMALL","CONNECTION_STROKE_WIDTH","CONNECTION_STROKE_COLOR_CHOICE","ZOOM_BASE","SvgPath","pstate","pathParse","__stack","transformParse","a2c","ellipse","src","sgm","__matrix","self","iterate","__evaluateStack","prevCmd","cmdSkipped","segment","degrees","round","contourStartDeltaX","contourStartDeltaY","deltaX","toFixed","iterator","keepLazyStack","j","newSegments","replacements","needReplace","lastX","lastY","countourStartX","countourStartY","nameUC","toUpperCase","nameLC","unarc","new_segments","nextX","nextY","unshort","prevControlX","prevControlY","prevSegment","curControlX","curControlY","cState","one","two","isPrev","removeClass","connA","connB","_rowDiv","_toolbox","_makeDiv","btn","stopPropagation","setDisabled","disabled","toJSON","svgState","getConstant","moveTo","setScale","applyTransform","highlight","prevFrom","source","isolate","rectHeight","textBBox","caretX","rectBox","clickX","cumulativeWidth","charWidth","repNode","classList","removeProperty","initListeners","renderOptions","HTMLElement","SVGSVGElement","elementFromPoint","tagName","hasAttribute","getAttribute","dta","parse","parentElement","registerMethods","_name","addMethodNames","getOwnPropertyNames","methods$1","getMethodsFor","_names","names","array","block","il","radians","unCamelCase","capitalize","charAt","proportionalSize","getOrigin","o","origin","ox","originX","oy","originY","condX","condY","registerWindow","win","doc","globals","saveWindow","save","restoreWindow","getWindow","create","ns","createElementNS","makeInstance","isHTML","Base","adopter","firstChild","removeChild","nodeOrNew","Node","ownerDocument","defaultView","adopt","instance","nodeName","Fragment","asRoot","getClass","eid","did","assignNewId","children","extend","modules","methods","wrapWithAttrCheck","fn","apply","componentHex","component","integer","is","object","space","hueToRgb","closeEnough","parser","cssText","documentElement","isNulledBox","getBox","getBBoxFn","retry","baseFind","query","List","querySelectorAll","getEvents","getEventHolder","windowEvents","getEventTarget","clearEvents","listener","binding","bag","delimiter","_svgjsListenerId","listenerId","namespace","dispatch","Event","CustomEvent","detail","cancelable","dispatchEvent","noop","x$3","y$3","cx$1","cy$1","width$2","SVGNumber","divide","height$2","_element","fx","fy","makeSetterGetter","k","recalculate","duration","_duration","overshoot","_overshoot","pi","os","zeta","wn","segmentComplete","segmentParameters","startNewSegment","token","inNumber","finalizeNumber","pathLetter","isPathLetter","test","lastCommand","small","isSmall","inSegment","number","pointSeen","hasExponent","absolute","command","pathHandlers","p0","makeAbsolut","isArcFlag","isArc","isExponential","lastToken","registerMorphableType","morphableTypes","makeMorphable","Morphable","fromArray","arr","toConsumable","morph","stepper","context","mergeTransforms","netTransform","_transformationRunners","runners","getRunnerTransform","reduce","lmultiply","merge","_frameId","descriptiveElements","isDescriptive","writeDataToDom","defaults","cloned","valueOf","removeAttribute","utils","__proto__","xmlns","xlink","namespaces","siblings","forward","backward","front","before","after","insertAfter","numberAndUnit","rgb","reference","transforms","whitespace","isHex","isRgb","isBlank","isNumber","isImage","regex","classes","hasClass","toggleClass","ret","cased","getPropertyValue","setProperty","attributes","remember","memory","forget","_memory","Color","inputs","isColor","mode","grey","cmyk","_a","_b","_c","hsl","isGrey","delta","_d","getParameters","noWhitespace","exec","hexParse","substring","sixDigitHex","components","lab","xyz","lch","atan2","dToR","yL","xL","zL","ct","mx","nm","rU","gU","bU","pow","bd","toHex","_clamped","toRgb","rV","gV","bV","r255","g255","b255","rL","gL","bL","xU","yU","zU","Point","transformO","isMatrixLike","formatTransforms","flipBoth","flip","flipX","flipY","skew","isFinite","scaleX","scaleY","shear","theta","around","px","positionX","NaN","py","positionY","relative","relativeX","relativeY","matrixMultiply","aroundO","translateO","lmultiplyO","decompose","determinant","ccw","thetaRad","st","lam","equals","comp","axis","flipO","scaleO","base","Element","matrixify","inverse","inverseO","det","na","nb","nc","nd","ne","nf","multiply","multiplyO","rotateO","shearO","lx","skewO","ly","transformer","Box","addOffset","pageXOffset","pageYOffset","isNulled","xMin","Infinity","xMax","yMin","yMax","viewbox","level","point","clientWidth","clientHeight","zoomX","zoomY","zoomAmount","MAX_SAFE_INTEGER","each","fnOrMethodName","reserved","attrs","EventTarget","defaultPrevented","fire","timeline","ease","delay","SVGArray","toSet","convert","unit","isNaN","minus","plus","times","colorAttributes","hooks","Dom","removeNamespace","SVGElement","put","hasChildNodes","lastChild","assignNewIds","nodeClone","first","htmlOrFn","outerHTML","xml","last","matches","selector","matcher","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","putIn","removeElement","replaceChild","precision","factor","svgOrFn","outerSVG","words","wrap","xmlOrFn","outerXML","_this","well","fragment","createDocumentFragment","firstElementChild","nodeValue","curr","_val","hook","setAttributeNS","rebuild","dom","setData","defs","dmove","parents","until","isSelector","rbox","screenCTM","inside","ctm","getCTM","isRoot","sugar","prefix","extension","mat","direction","getTotalLength","pointAt","getPointAtLength","untransform","str","kv","reverse","toParent","pCtm","toRoot","decomposed","Container","flatten","ungroup","Defs","Shape","circled","gradiented","Gradient","targets","url","gradient","Pattern","pattern","patternUnits","Image","load","img","image","PointArray","maxX","maxY","minX","minY","pop","toLine","pointed","MorphArray","Line","plot","Marker","orient","ref","marker","easing","bezier","steps","stepPosition","jumps","beforeFlag","jumping","Stepper","done","Ease","dt","Spring","acceleration","newPosition","PID","windup","integral","_windup","P","I","M","H","V","C","S","Q","T","A","Z","mlhvqtcsaz","jl","pathDelimiters","PathArray","toAbsolute","pathParser","arrayToString","getClassForType","NonMorphable","ObjectBag","_stepper","_from","_to","_type","_context","_morphObj","at","_set","align","TransformBag","sortByKey","defaultObject","toDelete","objOrArr","entries","Type","sort","shift","num","_array","poly","Polygon","polygon","Polyline","polyline","Rect","Queue","_first","_last","Animator","nextDraw","timeouts","immediates","timer","performance","frame","run","_draw","timeout","time","immediate","cancelFrame","clearTimeout","cancelImmediate","nextTimeout","lastTimeout","nextFrame","lastFrame","nextImmediate","makeSchedule","runnerInfo","runner","defaultSource","Timeline","timeSource","_timeSource","terminate","active","_nextFrame","finish","getEndTimeOfTimeline","pause","getEndTime","lastRunnerInfo","getLastRunnerInfo","lastDuration","_time","endTimes","_runners","getRunnerInfoById","_lastRunnerId","_runnerIds","_paused","_continue","persist","dtOrForever","_persist","play","updateTime","yes","currentSpeed","speed","positive","schedule","when","absoluteStartTime","endTime","unschedule","seek","_speed","_lastSourceTime","immediateStep","_stepImmediate","_step","_stepFn","dtSource","dtTime","_lastStepTime","reset","runnersLeft","dtToStart","_startTime","_timeline","Runner","_queue","_isDeclarative","_history","enabled","_lastTime","_reseted","transformId","_haveReversed","_reverse","_loopsDone","_swing","_wait","_times","sanitise","swing","wait","addTransform","animate","loop","clearTransform","clearTransformsFromQueue","isTransform","during","_prepareRunner","loops","loopDuration","loopsDone","partial","swinging","backwards","uncliped","swingForward","progress","initFn","runFn","retargetFn","initialiser","retarget","initialised","finished","running","_lastPosition","justStarted","justFinished","declarative","converged","_initialise","_run","needsIt","_rememberMorpher","method","morpher","caller","positionOrDt","allfinished","_tryRetarget","extra","FakeRunner","mergeWith","RunnerArray","ids","clearBefore","deleteCnt","edit","newRunner","getByID","lastRunner","by","_clearTransformRunnersBefore","currentRunner","_currentTransform","_addRunner","styleAttr","nameOrAttrs","newToAttrs","newKeys","differences","addedFromAttrs","oldFromAttrs","oldToAttrs","newLevel","newPoint","affine","isMatrix","currentAngle","startTransform","rTarget","rCurrent","possibilities","distances","shortest","affineParameters","newTransforms","_queueNumber","ay","_queueNumberDelta","newTo","_queueObject","amove","Svg","version","nested","Symbol","symbol","textable","_build","getComputedTextLength","plain","createTextNode","Text","_rebuild","blankLineOffset","getComputedStyle","newLined","firstLine","newLine","Tspan","Circle","ClipPath","unclip","clip","clipper","clipWith","ForeignObject","foreignObject","containerGeometry","G","link","unlink","linker","linkTo","Mask","unmask","masker","maskWith","Stop","Style","addText","rule","cssRule","fontface","TextPath","track","pathArray","textPath","importNodes","Use","use","file","mockAdopt","mock","withWindow","definition","enumerable","prop","toStringTag"],"sourceRoot":""}